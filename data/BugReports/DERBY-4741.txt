<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|133c54474aa8da53e50ecca872eb9dece58daccf|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"3c28f992f1a5d4\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-4741"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-4741] Make embedded Derby work reliably in the presence of thread interrupts - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-4741] Make embedded Derby work reliably in the presence of thread interrupts - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-4741">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-4741" href="/jira/browse/DERBY-4741" id="key-val" rel="12469090">DERBY-4741</a></li>
                </ol>
                <h1 id="summary-val">Make embedded Derby work reliably in the presence of thread interrupts</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-4741"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-4741/DERBY-4741.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-4741/DERBY-4741.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-4741/DERBY-4741.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-4741/DERBY-4741.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.2.1.6 ">10.2.1.6</span>, <span title="10.2.2.0 ">10.2.2.0</span>, <span title="10.3.1.4 ">10.3.1.4</span>, <span title="10.3.2.1 ">10.3.2.1</span>, <span title="10.3.3.0 ">10.3.3.0</span>, <span title="10.4.1.3 ">10.4.1.3</span>, <span title="10.4.2.0 ">10.4.2.0</span>, <span title="10.5.1.1 build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09">10.5.1.1</span>, <span title="10.5.2.0 10.5.2 Release July 30 2009 (794445) Now deprecated">10.5.2.0</span>, <span title="10.5.3.0 Next release after 10.5.2.0 release candidate #1">10.5.3.0</span>, <span title="10.6.1.0 Feature release">10.6.1.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.8.1.2" title="10.8.1.2 First release on the 10.8 branch">10.8.1.2</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+Store" title="Store ">Store</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <ul class="labels" id="labels-12469090-value"> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+derby_backport_reject_10_7" title="derby_backport_reject_10_7"><span>derby_backport_reject_10_7</span></a></li> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+derby_triage10_8" title="derby_triage10_8"><span>derby_triage10_8</span></a></li> 
                    </ul> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310050" class="item"> 
                     <div class="wrap"> 
                      <strong title="Urgency" class="name">Urgency:</strong> 
                      <div id="customfield_12310050-val" class="value type-select" data-fieldtype="select" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        Normal 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Regression</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>When not executing on a small device VM, Derby has been using the Java NIO classes java.nio.clannel.* for file io for extra concurrency.<br> If a thread is interrupted while executing blocking IO operations in NIO, the ClosedByInterruptException will get thrown. Unfortunately, Derby isn't current architected to retry and complete such operations (before passing on the interrupt), so the Derby database store can be left in an inconsistent state, although no data is corrupted, and we therefore have to return a database level error to perform shutdown and recovery. This means the applications can no longer access the database while a shutdown and reboot including a recovery is taking place.</p> 
                  <p>It would be nice if Derby could somehow detect and finish IO operations underway when thread interrupts happen before passing the exception on to the application. Derby embedded is sometimes embedded in applications that use Thread.interrupt to stop threads.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-4741?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-4741?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-4741?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-4741?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457234" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457234/derby.log" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12457234/derby.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457234/derby.log" title="Latest  15/Oct/10 05:08 - Lily Wei" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12457234/derby.log">derby.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-15T05:08:47.377Z">15/Oct/10 05:08</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Lily Wei
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12456935" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456935/derby.log" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12456935/derby.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456935/derby.log" title=" 12/Oct/10 05:00 - Lily Wei" draggable="true" data-downloadurl="text/plain:derby.log:https://issues.apache.org/jira/secure/attachment/12456935/derby.log">derby.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-12T05:00:42.424Z">12/Oct/10 05:00</time>
                   </dd>
                   <dd class="attachment-size">
                    27 kB
                   </dd>
                   <dd class="attachment-author">
                    Lily Wei
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457855" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457855/derby-4741-a-01-api-interruptstatus.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-01-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12457855/derby-4741-a-01-api-interruptstatus.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457855/derby-4741-a-01-api-interruptstatus.diff" title="Latest  22/Oct/10 18:25 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-01-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12457855/derby-4741-a-01-api-interruptstatus.diff">derby-4741-a-01-api-interruptstatus.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-22T18:25:59.004Z">22/Oct/10 18:25</time>
                   </dd>
                   <dd class="attachment-size">
                    39 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457856" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457856/derby-4741-a-01-api-interruptstatus.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-01-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12457856/derby-4741-a-01-api-interruptstatus.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457856/derby-4741-a-01-api-interruptstatus.stat" title="Latest  22/Oct/10 18:25 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-01-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12457856/derby-4741-a-01-api-interruptstatus.stat">derby-4741-a-01-api-interruptstatus.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-22T18:25:59.115Z">22/Oct/10 18:25</time>
                   </dd>
                   <dd class="attachment-size">
                    0.7 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12458171" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12458171/derby-4741-a-02-api-interruptstatus.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-02-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12458171/derby-4741-a-02-api-interruptstatus.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12458171/derby-4741-a-02-api-interruptstatus.diff" title="Latest  27/Oct/10 17:00 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-02-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12458171/derby-4741-a-02-api-interruptstatus.diff">derby-4741-a-02-api-interruptstatus.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-27T17:00:09.129Z">27/Oct/10 17:00</time>
                   </dd>
                   <dd class="attachment-size">
                    45 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12458172" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12458172/derby-4741-a-02-api-interruptstatus.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-02-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12458172/derby-4741-a-02-api-interruptstatus.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12458172/derby-4741-a-02-api-interruptstatus.stat" title="Latest  27/Oct/10 17:00 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-02-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12458172/derby-4741-a-02-api-interruptstatus.stat">derby-4741-a-02-api-interruptstatus.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-27T17:00:09.226Z">27/Oct/10 17:00</time>
                   </dd>
                   <dd class="attachment-size">
                    1.0 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12458227" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12458227/derby-4741-a-03-api-interruptstatus.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-03-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12458227/derby-4741-a-03-api-interruptstatus.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12458227/derby-4741-a-03-api-interruptstatus.diff" title="Latest  28/Oct/10 03:34 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-03-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12458227/derby-4741-a-03-api-interruptstatus.diff">derby-4741-a-03-api-interruptstatus.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-28T03:34:49.303Z">28/Oct/10 03:34</time>
                   </dd>
                   <dd class="attachment-size">
                    44 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12458228" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12458228/derby-4741-a-03-api-interruptstatus.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-03-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12458228/derby-4741-a-03-api-interruptstatus.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12458228/derby-4741-a-03-api-interruptstatus.stat" title="Latest  28/Oct/10 03:34 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-03-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12458228/derby-4741-a-03-api-interruptstatus.stat">derby-4741-a-03-api-interruptstatus.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-28T03:34:49.372Z">28/Oct/10 03:34</time>
                   </dd>
                   <dd class="attachment-size">
                    1.0 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12458672" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12458672/derby-4741-a-04-api-interruptstatus.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-04-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12458672/derby-4741-a-04-api-interruptstatus.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12458672/derby-4741-a-04-api-interruptstatus.diff" title="Latest  02/Nov/10 20:54 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-a-04-api-interruptstatus.diff:https://issues.apache.org/jira/secure/attachment/12458672/derby-4741-a-04-api-interruptstatus.diff">derby-4741-a-04-api-interruptstatus.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-02T20:54:32.134Z">02/Nov/10 20:54</time>
                   </dd>
                   <dd class="attachment-size">
                    43 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12458673" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12458673/derby-4741-a-04-api-interruptstatus.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-04-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12458673/derby-4741-a-04-api-interruptstatus.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12458673/derby-4741-a-04-api-interruptstatus.stat" title="Latest  02/Nov/10 20:54 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-a-04-api-interruptstatus.stat:https://issues.apache.org/jira/secure/attachment/12458673/derby-4741-a-04-api-interruptstatus.stat">derby-4741-a-04-api-interruptstatus.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-02T20:54:32.200Z">02/Nov/10 20:54</time>
                   </dd>
                   <dd class="attachment-size">
                    1.0 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457615" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457615/derby-4741-all%2Blenient%2Bresurrect.diff" draggable="true" data-downloadurl=":derby-4741-all+lenient+resurrect.diff:https://issues.apache.org/jira/secure/attachment/12457615/derby-4741-all%2Blenient%2Bresurrect.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457615/derby-4741-all%2Blenient%2Bresurrect.diff" title="Latest  19/Oct/10 22:48 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-all+lenient+resurrect.diff:https://issues.apache.org/jira/secure/attachment/12457615/derby-4741-all%2Blenient%2Bresurrect.diff">derby-4741-all+lenient+resurrect.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-19T22:48:15.414Z">19/Oct/10 22:48</time>
                   </dd>
                   <dd class="attachment-size">
                    116 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457616" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457616/derby-4741-all%2Blenient%2Bresurrect.stat" draggable="true" data-downloadurl=":derby-4741-all+lenient+resurrect.stat:https://issues.apache.org/jira/secure/attachment/12457616/derby-4741-all%2Blenient%2Bresurrect.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457616/derby-4741-all%2Blenient%2Bresurrect.stat" title="Latest  19/Oct/10 22:48 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-all+lenient+resurrect.stat:https://issues.apache.org/jira/secure/attachment/12457616/derby-4741-all%2Blenient%2Bresurrect.stat">derby-4741-all+lenient+resurrect.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-19T22:48:15.509Z">19/Oct/10 22:48</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459128" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459128/derby-4741-b-01-nio.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-01-nio.diff:https://issues.apache.org/jira/secure/attachment/12459128/derby-4741-b-01-nio.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459128/derby-4741-b-01-nio.diff" title="Latest  09/Nov/10 01:56 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-01-nio.diff:https://issues.apache.org/jira/secure/attachment/12459128/derby-4741-b-01-nio.diff">derby-4741-b-01-nio.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-09T01:56:12.566Z">09/Nov/10 01:56</time>
                   </dd>
                   <dd class="attachment-size">
                    61 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459129" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459129/derby-4741-b-01-nio.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-01-nio.stat:https://issues.apache.org/jira/secure/attachment/12459129/derby-4741-b-01-nio.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459129/derby-4741-b-01-nio.stat" title="Latest  09/Nov/10 01:56 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-01-nio.stat:https://issues.apache.org/jira/secure/attachment/12459129/derby-4741-b-01-nio.stat">derby-4741-b-01-nio.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-09T01:56:13.025Z">09/Nov/10 01:56</time>
                   </dd>
                   <dd class="attachment-size">
                    0.7 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459404" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459404/derby-4741-b-02-nio.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-02-nio.diff:https://issues.apache.org/jira/secure/attachment/12459404/derby-4741-b-02-nio.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459404/derby-4741-b-02-nio.diff" title="Latest  11/Nov/10 23:23 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-02-nio.diff:https://issues.apache.org/jira/secure/attachment/12459404/derby-4741-b-02-nio.diff">derby-4741-b-02-nio.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-11T23:23:17.290Z">11/Nov/10 23:23</time>
                   </dd>
                   <dd class="attachment-size">
                    61 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459405" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459405/derby-4741-b-02-nio.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-02-nio.stat:https://issues.apache.org/jira/secure/attachment/12459405/derby-4741-b-02-nio.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459405/derby-4741-b-02-nio.stat" title="Latest  11/Nov/10 23:23 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-02-nio.stat:https://issues.apache.org/jira/secure/attachment/12459405/derby-4741-b-02-nio.stat">derby-4741-b-02-nio.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-11T23:23:17.339Z">11/Nov/10 23:23</time>
                   </dd>
                   <dd class="attachment-size">
                    0.6 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459626" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459626/derby-4741-b-03-nio.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-03-nio.diff:https://issues.apache.org/jira/secure/attachment/12459626/derby-4741-b-03-nio.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459626/derby-4741-b-03-nio.diff" title="Latest  15/Nov/10 19:01 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-03-nio.diff:https://issues.apache.org/jira/secure/attachment/12459626/derby-4741-b-03-nio.diff">derby-4741-b-03-nio.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-15T19:01:14.524Z">15/Nov/10 19:01</time>
                   </dd>
                   <dd class="attachment-size">
                    63 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459627" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459627/derby-4741-b-03-nio.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-03-nio.stat:https://issues.apache.org/jira/secure/attachment/12459627/derby-4741-b-03-nio.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459627/derby-4741-b-03-nio.stat" title="Latest  15/Nov/10 19:01 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-03-nio.stat:https://issues.apache.org/jira/secure/attachment/12459627/derby-4741-b-03-nio.stat">derby-4741-b-03-nio.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-15T19:01:14.625Z">15/Nov/10 19:01</time>
                   </dd>
                   <dd class="attachment-size">
                    0.6 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12460329" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12460329/derby-4741-b-04-nio.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-04-nio.diff:https://issues.apache.org/jira/secure/attachment/12460329/derby-4741-b-04-nio.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12460329/derby-4741-b-04-nio.diff" title="Latest  24/Nov/10 01:56 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-b-04-nio.diff:https://issues.apache.org/jira/secure/attachment/12460329/derby-4741-b-04-nio.diff">derby-4741-b-04-nio.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-24T01:56:34.393Z">24/Nov/10 01:56</time>
                   </dd>
                   <dd class="attachment-size">
                    65 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12460330" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12460330/derby-4741-b-04-nio.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-04-nio.stat:https://issues.apache.org/jira/secure/attachment/12460330/derby-4741-b-04-nio.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12460330/derby-4741-b-04-nio.stat" title="Latest  24/Nov/10 01:56 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-b-04-nio.stat:https://issues.apache.org/jira/secure/attachment/12460330/derby-4741-b-04-nio.stat">derby-4741-b-04-nio.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-24T01:56:34.465Z">24/Nov/10 01:56</time>
                   </dd>
                   <dd class="attachment-size">
                    0.6 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12464822" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12464822/derby-4741-c-01-nio.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-c-01-nio.diff:https://issues.apache.org/jira/secure/attachment/12464822/derby-4741-c-01-nio.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12464822/derby-4741-c-01-nio.diff" title="Latest  29/Nov/10 00:46 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-c-01-nio.diff:https://issues.apache.org/jira/secure/attachment/12464822/derby-4741-c-01-nio.diff">derby-4741-c-01-nio.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-29T00:46:16.013Z">29/Nov/10 00:46</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12464823" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12464823/derby-4741-c-01-nio.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-c-01-nio.stat:https://issues.apache.org/jira/secure/attachment/12464823/derby-4741-c-01-nio.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12464823/derby-4741-c-01-nio.stat" title="Latest  29/Nov/10 00:46 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-c-01-nio.stat:https://issues.apache.org/jira/secure/attachment/12464823/derby-4741-c-01-nio.stat">derby-4741-c-01-nio.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-29T00:46:16.068Z">29/Nov/10 00:46</time>
                   </dd>
                   <dd class="attachment-size">
                    0.1 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471789" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471789/derby-4741-fix-compilation.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-fix-compilation.diff:https://issues.apache.org/jira/secure/attachment/12471789/derby-4741-fix-compilation.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471789/derby-4741-fix-compilation.diff" title="Latest  23/Feb/11 23:56 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-fix-compilation.diff:https://issues.apache.org/jira/secure/attachment/12471789/derby-4741-fix-compilation.diff">derby-4741-fix-compilation.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-23T23:56:36.992Z">23/Feb/11 23:56</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471790" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471790/derby-4741-fix-compilation.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-fix-compilation.stat:https://issues.apache.org/jira/secure/attachment/12471790/derby-4741-fix-compilation.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471790/derby-4741-fix-compilation.stat" title="Latest  23/Feb/11 23:56 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-fix-compilation.stat:https://issues.apache.org/jira/secure/attachment/12471790/derby-4741-fix-compilation.stat">derby-4741-fix-compilation.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-23T23:56:37.006Z">23/Feb/11 23:56</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12465744" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12465744/derby-4741-kristians-01.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-kristians-01.diff:https://issues.apache.org/jira/secure/attachment/12465744/derby-4741-kristians-01.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12465744/derby-4741-kristians-01.diff" title="Latest  07/Dec/10 22:15 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-kristians-01.diff:https://issues.apache.org/jira/secure/attachment/12465744/derby-4741-kristians-01.diff">derby-4741-kristians-01.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-12-07T22:15:49.156Z">07/Dec/10 22:15</time>
                   </dd>
                   <dd class="attachment-size">
                    4 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456608" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456608/derby-4741-nio-container%2Blog.diff" draggable="true" data-downloadurl=":derby-4741-nio-container+log.diff:https://issues.apache.org/jira/secure/attachment/12456608/derby-4741-nio-container%2Blog.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456608/derby-4741-nio-container%2Blog.diff" title="Latest  07/Oct/10 17:04 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log.diff:https://issues.apache.org/jira/secure/attachment/12456608/derby-4741-nio-container%2Blog.diff">derby-4741-nio-container+log.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-07T17:04:17.918Z">07/Oct/10 17:04</time>
                   </dd>
                   <dd class="attachment-size">
                    59 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456609" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456609/derby-4741-nio-container%2Blog.stat" draggable="true" data-downloadurl=":derby-4741-nio-container+log.stat:https://issues.apache.org/jira/secure/attachment/12456609/derby-4741-nio-container%2Blog.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456609/derby-4741-nio-container%2Blog.stat" title="Latest  07/Oct/10 17:04 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log.stat:https://issues.apache.org/jira/secure/attachment/12456609/derby-4741-nio-container%2Blog.stat">derby-4741-nio-container+log.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-07T17:04:18.002Z">07/Oct/10 17:04</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456704" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456704/derby-4741-nio-container%2Blog%2Bwaits.diff" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits.diff:https://issues.apache.org/jira/secure/attachment/12456704/derby-4741-nio-container%2Blog%2Bwaits.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456704/derby-4741-nio-container%2Blog%2Bwaits.diff" title="Latest  08/Oct/10 14:10 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits.diff:https://issues.apache.org/jira/secure/attachment/12456704/derby-4741-nio-container%2Blog%2Bwaits.diff">derby-4741-nio-container+log+waits.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-08T14:10:02.233Z">08/Oct/10 14:10</time>
                   </dd>
                   <dd class="attachment-size">
                    63 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456705" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456705/derby-4741-nio-container%2Blog%2Bwaits.stat" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits.stat:https://issues.apache.org/jira/secure/attachment/12456705/derby-4741-nio-container%2Blog%2Bwaits.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456705/derby-4741-nio-container%2Blog%2Bwaits.stat" title="Latest  08/Oct/10 14:10 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits.stat:https://issues.apache.org/jira/secure/attachment/12456705/derby-4741-nio-container%2Blog%2Bwaits.stat">derby-4741-nio-container+log+waits.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-08T14:10:02.306Z">08/Oct/10 14:10</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456744" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456744/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.diff" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks.diff:https://issues.apache.org/jira/secure/attachment/12456744/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456744/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.diff" title="Latest  08/Oct/10 22:46 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks.diff:https://issues.apache.org/jira/secure/attachment/12456744/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.diff">derby-4741-nio-container+log+waits+locks.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-08T22:46:12.076Z">08/Oct/10 22:46</time>
                   </dd>
                   <dd class="attachment-size">
                    73 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456745" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456745/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.stat" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks.stat:https://issues.apache.org/jira/secure/attachment/12456745/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456745/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.stat" title="Latest  08/Oct/10 22:46 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks.stat:https://issues.apache.org/jira/secure/attachment/12456745/derby-4741-nio-container%2Blog%2Bwaits%2Blocks.stat">derby-4741-nio-container+log+waits+locks.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-08T22:46:12.156Z">08/Oct/10 22:46</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457164" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457164/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.diff" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks+throws.diff:https://issues.apache.org/jira/secure/attachment/12457164/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457164/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.diff" title="Latest  14/Oct/10 16:00 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks+throws.diff:https://issues.apache.org/jira/secure/attachment/12457164/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.diff">derby-4741-nio-container+log+waits+locks+throws.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-14T16:00:45.219Z">14/Oct/10 16:00</time>
                   </dd>
                   <dd class="attachment-size">
                    100 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457119" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457119/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.stat" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks+throws.stat:https://issues.apache.org/jira/secure/attachment/12457119/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457119/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.stat" title="Latest  14/Oct/10 02:11 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks+throws.stat:https://issues.apache.org/jira/secure/attachment/12457119/derby-4741-nio-container%2Blog%2Bwaits%2Blocks%2Bthrows.stat">derby-4741-nio-container+log+waits+locks+throws.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-14T02:11:37.734Z">14/Oct/10 02:11</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457011" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457011/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.diff" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks-2.diff:https://issues.apache.org/jira/secure/attachment/12457011/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457011/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.diff" title="Latest  12/Oct/10 21:35 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks-2.diff:https://issues.apache.org/jira/secure/attachment/12457011/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.diff">derby-4741-nio-container+log+waits+locks-2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-12T21:35:25.250Z">12/Oct/10 21:35</time>
                   </dd>
                   <dd class="attachment-size">
                    80 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457012" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457012/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.stat" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks-2.stat:https://issues.apache.org/jira/secure/attachment/12457012/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457012/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.stat" title="Latest  12/Oct/10 21:35 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container+log+waits+locks-2.stat:https://issues.apache.org/jira/secure/attachment/12457012/derby-4741-nio-container%2Blog%2Bwaits%2Blocks-2.stat">derby-4741-nio-container+log+waits+locks-2.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-12T21:35:25.335Z">12/Oct/10 21:35</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456441" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456441/derby-4741-nio-container-2.diff" draggable="true" data-downloadurl=":derby-4741-nio-container-2.diff:https://issues.apache.org/jira/secure/attachment/12456441/derby-4741-nio-container-2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456441/derby-4741-nio-container-2.diff" title="Latest  05/Oct/10 22:18 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container-2.diff:https://issues.apache.org/jira/secure/attachment/12456441/derby-4741-nio-container-2.diff">derby-4741-nio-container-2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-05T22:18:21.429Z">05/Oct/10 22:18</time>
                   </dd>
                   <dd class="attachment-size">
                    25 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456443" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456443/derby-4741-nio-container-2.log" draggable="true" data-downloadurl=":derby-4741-nio-container-2.log:https://issues.apache.org/jira/secure/attachment/12456443/derby-4741-nio-container-2.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456443/derby-4741-nio-container-2.log" title="Latest  05/Oct/10 22:18 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container-2.log:https://issues.apache.org/jira/secure/attachment/12456443/derby-4741-nio-container-2.log">derby-4741-nio-container-2.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-05T22:18:21.555Z">05/Oct/10 22:18</time>
                   </dd>
                   <dd class="attachment-size">
                    55 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456442" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456442/derby-4741-nio-container-2.stat" draggable="true" data-downloadurl=":derby-4741-nio-container-2.stat:https://issues.apache.org/jira/secure/attachment/12456442/derby-4741-nio-container-2.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456442/derby-4741-nio-container-2.stat" title="Latest  05/Oct/10 22:18 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container-2.stat:https://issues.apache.org/jira/secure/attachment/12456442/derby-4741-nio-container-2.stat">derby-4741-nio-container-2.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-05T22:18:21.499Z">05/Oct/10 22:18</time>
                   </dd>
                   <dd class="attachment-size">
                    0.4 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456500" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456500/derby-4741-nio-container-2b.diff" draggable="true" data-downloadurl=":derby-4741-nio-container-2b.diff:https://issues.apache.org/jira/secure/attachment/12456500/derby-4741-nio-container-2b.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456500/derby-4741-nio-container-2b.diff" title="Latest  06/Oct/10 13:21 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container-2b.diff:https://issues.apache.org/jira/secure/attachment/12456500/derby-4741-nio-container-2b.diff">derby-4741-nio-container-2b.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-06T13:21:47.846Z">06/Oct/10 13:21</time>
                   </dd>
                   <dd class="attachment-size">
                    39 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456501" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456501/derby-4741-nio-container-2b.stat" draggable="true" data-downloadurl=":derby-4741-nio-container-2b.stat:https://issues.apache.org/jira/secure/attachment/12456501/derby-4741-nio-container-2b.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456501/derby-4741-nio-container-2b.stat" title="Latest  06/Oct/10 13:21 - Dag H. Wanvik" draggable="true" data-downloadurl=":derby-4741-nio-container-2b.stat:https://issues.apache.org/jira/secure/attachment/12456501/derby-4741-nio-container-2b.stat">derby-4741-nio-container-2b.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-06T13:21:47.954Z">06/Oct/10 13:21</time>
                   </dd>
                   <dd class="attachment-size">
                    0.4 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469023" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469023/derby-4741-raf-stresstest-1.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-1.diff:https://issues.apache.org/jira/secure/attachment/12469023/derby-4741-raf-stresstest-1.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469023/derby-4741-raf-stresstest-1.diff" title="Latest  22/Jan/11 01:58 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-1.diff:https://issues.apache.org/jira/secure/attachment/12469023/derby-4741-raf-stresstest-1.diff">derby-4741-raf-stresstest-1.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-22T01:58:43.036Z">22/Jan/11 01:58</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469024" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469024/derby-4741-raf-stresstest-1.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-1.stat:https://issues.apache.org/jira/secure/attachment/12469024/derby-4741-raf-stresstest-1.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469024/derby-4741-raf-stresstest-1.stat" title="Latest  22/Jan/11 01:58 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-1.stat:https://issues.apache.org/jira/secure/attachment/12469024/derby-4741-raf-stresstest-1.stat">derby-4741-raf-stresstest-1.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-22T01:58:43.091Z">22/Jan/11 01:58</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469328" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469328/derby-4741-raf-stresstest-2.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-2.diff:https://issues.apache.org/jira/secure/attachment/12469328/derby-4741-raf-stresstest-2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469328/derby-4741-raf-stresstest-2.diff" title="Latest  25/Jan/11 20:35 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-2.diff:https://issues.apache.org/jira/secure/attachment/12469328/derby-4741-raf-stresstest-2.diff">derby-4741-raf-stresstest-2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-25T20:35:51.166Z">25/Jan/11 20:35</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469329" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469329/derby-4741-raf-stresstest-2.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-2.stat:https://issues.apache.org/jira/secure/attachment/12469329/derby-4741-raf-stresstest-2.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469329/derby-4741-raf-stresstest-2.stat" title="Latest  25/Jan/11 20:35 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-2.stat:https://issues.apache.org/jira/secure/attachment/12469329/derby-4741-raf-stresstest-2.stat">derby-4741-raf-stresstest-2.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-25T20:35:51.250Z">25/Jan/11 20:35</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469370" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469370/derby-4741-raf-stresstest-3.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-3.diff:https://issues.apache.org/jira/secure/attachment/12469370/derby-4741-raf-stresstest-3.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469370/derby-4741-raf-stresstest-3.diff" title="Latest  26/Jan/11 01:47 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-3.diff:https://issues.apache.org/jira/secure/attachment/12469370/derby-4741-raf-stresstest-3.diff">derby-4741-raf-stresstest-3.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-26T01:47:48.166Z">26/Jan/11 01:47</time>
                   </dd>
                   <dd class="attachment-size">
                    20 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469371" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469371/derby-4741-raf-stresstest-3.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-3.stat:https://issues.apache.org/jira/secure/attachment/12469371/derby-4741-raf-stresstest-3.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469371/derby-4741-raf-stresstest-3.stat" title="Latest  26/Jan/11 01:47 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-3.stat:https://issues.apache.org/jira/secure/attachment/12469371/derby-4741-raf-stresstest-3.stat">derby-4741-raf-stresstest-3.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-26T01:47:48.227Z">26/Jan/11 01:47</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469503" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469503/derby-4741-raf-stresstest-4.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-4.diff:https://issues.apache.org/jira/secure/attachment/12469503/derby-4741-raf-stresstest-4.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469503/derby-4741-raf-stresstest-4.diff" title="Latest  27/Jan/11 01:55 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-raf-stresstest-4.diff:https://issues.apache.org/jira/secure/attachment/12469503/derby-4741-raf-stresstest-4.diff">derby-4741-raf-stresstest-4.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-27T01:55:53.751Z">27/Jan/11 01:55</time>
                   </dd>
                   <dd class="attachment-size">
                    23 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469504" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469504/derby-4741-raf-stresstest-4.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-4.stat:https://issues.apache.org/jira/secure/attachment/12469504/derby-4741-raf-stresstest-4.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469504/derby-4741-raf-stresstest-4.stat" title="Latest  27/Jan/11 01:55 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-raf-stresstest-4.stat:https://issues.apache.org/jira/secure/attachment/12469504/derby-4741-raf-stresstest-4.stat">derby-4741-raf-stresstest-4.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-27T01:55:53.810Z">27/Jan/11 01:55</time>
                   </dd>
                   <dd class="attachment-size">
                    0.4 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468142" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468142/derby-4741-sleeps-waits-1.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-1.diff:https://issues.apache.org/jira/secure/attachment/12468142/derby-4741-sleeps-waits-1.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468142/derby-4741-sleeps-waits-1.diff" title="Latest  12/Jan/11 17:56 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-1.diff:https://issues.apache.org/jira/secure/attachment/12468142/derby-4741-sleeps-waits-1.diff">derby-4741-sleeps-waits-1.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-12T17:56:23.093Z">12/Jan/11 17:56</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468143" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468143/derby-4741-sleeps-waits-1.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-1.stat:https://issues.apache.org/jira/secure/attachment/12468143/derby-4741-sleeps-waits-1.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468143/derby-4741-sleeps-waits-1.stat" title="Latest  12/Jan/11 17:56 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-1.stat:https://issues.apache.org/jira/secure/attachment/12468143/derby-4741-sleeps-waits-1.stat">derby-4741-sleeps-waits-1.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-12T17:56:23.122Z">12/Jan/11 17:56</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468707" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468707/derby-4741-sleeps-waits-2.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-2.diff:https://issues.apache.org/jira/secure/attachment/12468707/derby-4741-sleeps-waits-2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468707/derby-4741-sleeps-waits-2.diff" title="Latest  19/Jan/11 00:50 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-2.diff:https://issues.apache.org/jira/secure/attachment/12468707/derby-4741-sleeps-waits-2.diff">derby-4741-sleeps-waits-2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-19T00:50:48.701Z">19/Jan/11 00:50</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468708" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468708/derby-4741-sleeps-waits-2.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-2.stat:https://issues.apache.org/jira/secure/attachment/12468708/derby-4741-sleeps-waits-2.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468708/derby-4741-sleeps-waits-2.stat" title="Latest  19/Jan/11 00:50 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-2.stat:https://issues.apache.org/jira/secure/attachment/12468708/derby-4741-sleeps-waits-2.stat">derby-4741-sleeps-waits-2.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-19T00:50:48.738Z">19/Jan/11 00:50</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468796" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468796/derby-4741-sleeps-waits-3.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-3.diff:https://issues.apache.org/jira/secure/attachment/12468796/derby-4741-sleeps-waits-3.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468796/derby-4741-sleeps-waits-3.diff" title="Latest  19/Jan/11 23:47 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-3.diff:https://issues.apache.org/jira/secure/attachment/12468796/derby-4741-sleeps-waits-3.diff">derby-4741-sleeps-waits-3.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-19T23:47:22.546Z">19/Jan/11 23:47</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468797" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468797/derby-4741-sleeps-waits-3.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-3.stat:https://issues.apache.org/jira/secure/attachment/12468797/derby-4741-sleeps-waits-3.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468797/derby-4741-sleeps-waits-3.stat" title="Latest  19/Jan/11 23:47 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-3.stat:https://issues.apache.org/jira/secure/attachment/12468797/derby-4741-sleeps-waits-3.stat">derby-4741-sleeps-waits-3.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-19T23:47:22.618Z">19/Jan/11 23:47</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471034" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471034/derby-4741-sleeps-waits-more.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-more.diff:https://issues.apache.org/jira/secure/attachment/12471034/derby-4741-sleeps-waits-more.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471034/derby-4741-sleeps-waits-more.diff" title="Latest  15/Feb/11 00:03 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-sleeps-waits-more.diff:https://issues.apache.org/jira/secure/attachment/12471034/derby-4741-sleeps-waits-more.diff">derby-4741-sleeps-waits-more.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-15T00:03:08.570Z">15/Feb/11 00:03</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471035" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471035/derby-4741-sleeps-waits-more.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-more.stat:https://issues.apache.org/jira/secure/attachment/12471035/derby-4741-sleeps-waits-more.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471035/derby-4741-sleeps-waits-more.stat" title="Latest  15/Feb/11 00:03 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-sleeps-waits-more.stat:https://issues.apache.org/jira/secure/attachment/12471035/derby-4741-sleeps-waits-more.stat">derby-4741-sleeps-waits-more.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-15T00:03:08.578Z">15/Feb/11 00:03</time>
                   </dd>
                   <dd class="attachment-size">
                    0.5 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469986" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469986/derby-4741-testBatchInterrupt.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-testBatchInterrupt.diff:https://issues.apache.org/jira/secure/attachment/12469986/derby-4741-testBatchInterrupt.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469986/derby-4741-testBatchInterrupt.diff" title="Latest  01/Feb/11 22:15 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-testBatchInterrupt.diff:https://issues.apache.org/jira/secure/attachment/12469986/derby-4741-testBatchInterrupt.diff">derby-4741-testBatchInterrupt.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-01T22:15:27.135Z">01/Feb/11 22:15</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12470092" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12470092/derby-4741-testBatchInterrupt-b.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-testBatchInterrupt-b.diff:https://issues.apache.org/jira/secure/attachment/12470092/derby-4741-testBatchInterrupt-b.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12470092/derby-4741-testBatchInterrupt-b.diff" title="Latest  03/Feb/11 00:17 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-testBatchInterrupt-b.diff:https://issues.apache.org/jira/secure/attachment/12470092/derby-4741-testBatchInterrupt-b.diff">derby-4741-testBatchInterrupt-b.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-03T00:17:55.534Z">03/Feb/11 00:17</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469970" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469970/derby-4741-testQueryInterrupt.diff" draggable="true" data-downloadurl="text/x-patch:derby-4741-testQueryInterrupt.diff:https://issues.apache.org/jira/secure/attachment/12469970/derby-4741-testQueryInterrupt.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469970/derby-4741-testQueryInterrupt.diff" title="Latest  01/Feb/11 19:07 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:derby-4741-testQueryInterrupt.diff:https://issues.apache.org/jira/secure/attachment/12469970/derby-4741-testQueryInterrupt.diff">derby-4741-testQueryInterrupt.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-01T19:07:28.241Z">01/Feb/11 19:07</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12469971" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469971/derby-4741-testQueryInterrupt.stat" draggable="true" data-downloadurl="application/octet-stream:derby-4741-testQueryInterrupt.stat:https://issues.apache.org/jira/secure/attachment/12469971/derby-4741-testQueryInterrupt.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469971/derby-4741-testQueryInterrupt.stat" title="Latest  01/Feb/11 19:07 - Dag H. Wanvik" draggable="true" data-downloadurl="application/octet-stream:derby-4741-testQueryInterrupt.stat:https://issues.apache.org/jira/secure/attachment/12469971/derby-4741-testQueryInterrupt.stat">derby-4741-testQueryInterrupt.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-01T19:07:28.277Z">01/Feb/11 19:07</time>
                   </dd>
                   <dd class="attachment-size">
                    0.2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12459264" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459264/InterruptResilienceTest.java" draggable="true" data-downloadurl="application/x-:InterruptResilienceTest.java:https://issues.apache.org/jira/secure/attachment/12459264/InterruptResilienceTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459264/InterruptResilienceTest.java" title="Latest  10/Nov/10 18:10 - Lily Wei" draggable="true" data-downloadurl="application/x-:InterruptResilienceTest.java:https://issues.apache.org/jira/secure/attachment/12459264/InterruptResilienceTest.java">InterruptResilienceTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-10T18:10:13.610Z">10/Nov/10 18:10</time>
                   </dd>
                   <dd class="attachment-size">
                    9 kB
                   </dd>
                   <dd class="attachment-author">
                    Lily Wei
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471333" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471333/interrupts-fs.html" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12471333/interrupts-fs.html"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471333/interrupts-fs.html" title="Latest  17/Feb/11 21:07 - Dag H. Wanvik" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12471333/interrupts-fs.html">interrupts-fs.html</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-17T21:07:24.846Z">17/Feb/11 21:07</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12470815" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12470815/interrupts-fs.html" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12470815/interrupts-fs.html"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12470815/interrupts-fs.html" title=" 11/Feb/11 00:44 - Dag H. Wanvik" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12470815/interrupts-fs.html">interrupts-fs.html</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-11T00:44:13.496Z">11/Feb/11 00:44</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12469981" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469981/interrupts-fs.html" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12469981/interrupts-fs.html"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469981/interrupts-fs.html" title=" 01/Feb/11 21:18 - Dag H. Wanvik" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12469981/interrupts-fs.html">interrupts-fs.html</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-01T21:18:31.691Z">01/Feb/11 21:18</time>
                   </dd>
                   <dd class="attachment-size">
                    7 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12469614" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12469614/interrupts-fs.html" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12469614/interrupts-fs.html"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12469614/interrupts-fs.html" title=" 28/Jan/11 00:29 - Dag H. Wanvik" draggable="true" data-downloadurl="text/html:interrupts-fs.html:https://issues.apache.org/jira/secure/attachment/12469614/interrupts-fs.html">interrupts-fs.html</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-28T00:29:31.651Z">28/Jan/11 00:29</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12457271" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12457271/MicroAPITest.java" draggable="true" data-downloadurl="text/x-java:MicroAPITest.java:https://issues.apache.org/jira/secure/attachment/12457271/MicroAPITest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12457271/MicroAPITest.java" title="Latest  15/Oct/10 16:07 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-java:MicroAPITest.java:https://issues.apache.org/jira/secure/attachment/12457271/MicroAPITest.java">MicroAPITest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-15T16:07:35.904Z">15/Oct/10 16:07</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471036" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471036/sleep-1-usages.txt" draggable="true" data-downloadurl="text/plain:sleep-1-usages.txt:https://issues.apache.org/jira/secure/attachment/12471036/sleep-1-usages.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471036/sleep-1-usages.txt" title="Latest  15/Feb/11 00:06 - Dag H. Wanvik" draggable="true" data-downloadurl="text/plain:sleep-1-usages.txt:https://issues.apache.org/jira/secure/attachment/12471036/sleep-1-usages.txt">sleep-1-usages.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-15T00:06:04.718Z">15/Feb/11 00:06</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471038" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471038/wait-0-usages.txt" draggable="true" data-downloadurl="text/plain:wait-0-usages.txt:https://issues.apache.org/jira/secure/attachment/12471038/wait-0-usages.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471038/wait-0-usages.txt" title="Latest  15/Feb/11 00:06 - Dag H. Wanvik" draggable="true" data-downloadurl="text/plain:wait-0-usages.txt:https://issues.apache.org/jira/secure/attachment/12471038/wait-0-usages.txt">wait-0-usages.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-15T00:06:04.734Z">15/Feb/11 00:06</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12471037" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12471037/wait-1-usages.txt" draggable="true" data-downloadurl="text/plain:wait-1-usages.txt:https://issues.apache.org/jira/secure/attachment/12471037/wait-1-usages.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12471037/wait-1-usages.txt" title="Latest  15/Feb/11 00:06 - Dag H. Wanvik" draggable="true" data-downloadurl="text/plain:wait-1-usages.txt:https://issues.apache.org/jira/secure/attachment/12471037/wait-1-usages.txt">wait-1-usages.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-02-15T00:06:04.726Z">15/Feb/11 00:06</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12456610" data-issue-id="12469090" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12456610/xsbt0.log.gz" draggable="true" data-downloadurl="application/x-gzip:xsbt0.log.gz:https://issues.apache.org/jira/secure/attachment/12456610/xsbt0.log.gz"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12456610/xsbt0.log.gz" title="Latest  07/Oct/10 17:20 - Dag H. Wanvik" draggable="true" data-downloadurl="application/x-gzip:xsbt0.log.gz:https://issues.apache.org/jira/secure/attachment/12456610/xsbt0.log.gz">xsbt0.log.gz</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-10-07T17:20:31.944Z">07/Oct/10 17:20</time>
                   </dd>
                   <dd class="attachment-size">
                    23 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="incorporates">
                   incorporates
                  </dt> 
                  <dd id="internal-12494893_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4960: Race condition in FileContainer#allocCache when reopening RAFContainer after interrupt"> <a href="/jira/browse/DERBY-4960" data-issue-key="DERBY-4960" class="issue-link link-title resolution">DERBY-4960</a> <span class="link-summary">Race condition in FileContainer#allocCache when reopening RAFContainer after interrupt</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12495640_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4974: InterruptResilienceTest fails on Solaris with Sun VMs prior to 1.6"> <a href="/jira/browse/DERBY-4974" data-issue-key="DERBY-4974" class="issue-link link-title resolution">DERBY-4974</a> <span class="link-summary">InterruptResilienceTest fails on Solaris with Sun VMs prior to 1.6</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12496358_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4982: Retrying after interrupts in store pops a bug in derbyall/storeall/storeunit/T_RawStoreFactory in some cases"> <a href="/jira/browse/DERBY-4982" data-issue-key="DERBY-4982" class="issue-link link-title resolution">DERBY-4982</a> <span class="link-summary">Retrying after interrupts in store pops a bug in derbyall/storeall/storeunit/T_RawStoreFactory in some cases</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12506629_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5223: Thread's interrupted flag not always preserved after Derby returns from JDBC API call"> <a href="/jira/browse/DERBY-5223" data-issue-key="DERBY-5223" class="issue-link link-title resolution">DERBY-5223</a> <span class="link-summary">Thread's interrupted flag not always preserved after Derby returns from JDBC API call</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12507184_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5233: Interrupt of create table or index (i.e. a container) will throw XSDF1 under NIO - connection survives"> <a href="/jira/browse/DERBY-5233" data-issue-key="DERBY-5233" class="issue-link link-title resolution">DERBY-5233</a> <span class="link-summary">Interrupt of create table or index (i.e. a container) will throw XSDF1 under NIO - connection survives</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12512855_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5312: InterruptResilienceTest failed with ERROR 40XD1: Container was opened in read-only mode."> <a href="/jira/browse/DERBY-5312" data-issue-key="DERBY-5312" class="issue-link link-title resolution">DERBY-5312</a> <span class="link-summary">InterruptResilienceTest failed with ERROR 40XD1: Container was opened in read-only mode.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12513487_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5325: Checkpoint fails with ClosedChannelException in InterruptResilienceTest"> <a href="/jira/browse/DERBY-5325" data-issue-key="DERBY-5325" class="issue-link link-title resolution">DERBY-5325</a> <span class="link-summary">Checkpoint fails with ClosedChannelException in InterruptResilienceTest</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12502376_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5152: Shutting down db, information that the thread received an interrupt will not be restored to thread's interrupt flag"> <a href="/jira/browse/DERBY-5152" data-issue-key="DERBY-5152" class="issue-link link-title resolution">DERBY-5152</a> <span class="link-summary">Shutting down db, information that the thread received an interrupt will not be restored to thread's interrupt flag</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12514078_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5333: Intermittent assert failure in testInterruptShutdown: thread's interrupted flag lost after shutdown"> <a href="/jira/browse/DERBY-5333" data-issue-key="DERBY-5333" class="issue-link link-title resolution">DERBY-5333</a> <span class="link-summary">Intermittent assert failure in testInterruptShutdown: thread's interrupted flag lost after shutdown</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12495149_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-4963: Revert to FileDescriptor#sync from FileChannel#force to improve interrupt resilience"> <a href="/jira/browse/DERBY-4963" data-issue-key="DERBY-4963" class="issue-link link-title resolution">DERBY-4963</a> <span class="link-summary">Revert to FileDescriptor#sync from FileChannel#force to improve interrupt resilience</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12495293_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-4967: Handle interrupt received while waiting for database lock"> <a href="/jira/browse/DERBY-4967" data-issue-key="DERBY-4967" class="issue-link link-title resolution">DERBY-4967</a> <span class="link-summary">Handle interrupt received while waiting for database lock</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12495296_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-4968: Let query stop execution if an interrupt is seen, at same time as we check the query timeout"> <a href="/jira/browse/DERBY-4968" data-issue-key="DERBY-4968" class="issue-link link-title resolution">DERBY-4968</a> <span class="link-summary">Let query stop execution if an interrupt is seen, at same time as we check the query timeout</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12498366_12310010" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="DERBY-5024: Document the behavior of interrupt handling."> <a href="/jira/browse/DERBY-5024" data-issue-key="DERBY-5024" class="issue-link link-title resolution">DERBY-5024</a> <span class="link-summary">Document the behavior of interrupt handling.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list collapsed-links-list"> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12399349_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-3746: java.sql.SQLException: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression."> <a href="/jira/browse/DERBY-3746" data-issue-key="DERBY-3746" class="issue-link link-title">DERBY-3746</a> <span class="link-summary">java.sql.SQLException: The exception 'java.lang.NullPointerException' was thrown while evaluating an expression.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-30281_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-151: Thread termination -> XSDG after operation is 'complete'"> <a href="/jira/browse/DERBY-151" data-issue-key="DERBY-151" class="issue-link link-title resolution">DERBY-151</a> <span class="link-summary">Thread termination -&gt; XSDG after operation is 'complete'</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12480747_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4911: restoreIntrFlagIfSeen may throw ShutdownException causing confusing console stack trace at server shutdown"> <a href="/jira/browse/DERBY-4911" data-issue-key="DERBY-4911" class="issue-link link-title resolution">DERBY-4911</a> <span class="link-summary">restoreIntrFlagIfSeen may throw ShutdownException causing confusing console stack trace at server shutdown</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <div id="show-more-links"> 
                  <button class="aui-button aui-button-link" id="show-more-links-link">Show 11 more links</button> 
                  <span>(8 incorporates, 3 is related to)</span> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_dagw" rel="dagw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Dag H. Wanvik&quot;,&quot;emailAddress&quot;:&quot;dag.wanvik@oracle.com&quot;,&quot;username&quot;:&quot;dagw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="dagw"></span></span> Dag H. Wanvik </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_dagw" rel="dagw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Dag H. Wanvik&quot;,&quot;emailAddress&quot;:&quot;dag.wanvik@oracle.com&quot;,&quot;username&quot;:&quot;dagw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="dagw"></span></span> Dag H. Wanvik </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">1</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">2</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="12/Jul/10 18:37"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2010-07-12T18:37:58+0000">12/Jul/10 18:37</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="17/Jun/13 09:19"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-06-17T09:19:51+0000">17/Jun/13 09:19</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="26/Feb/11 03:44"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-02-26T03:44:16+0000">26/Feb/11 03:44</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4741?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-4741?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12910067\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12910067&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910067\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12910067_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910067_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Sep\\/10 09:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-16T09:42:41+0000\'\u003e16\\/Sep\\/10 09:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSince Derby used to handle interrupts in a better way before we switched to NIO, would it make sense to change the issue type to bug and flag it as a regression?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12910067_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910067_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Sep\\/10 09:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-16T09:42:41+0000\'\u003e16\\/Sep\\/10 09:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Since Derby used to handle interrupts in a better way before we switched to NIO, would it make sense to change the issue type to bug and flag it as a regression?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910135\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12910135&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910135\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12910135_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910135_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Sep\\/10 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-16T12:57:10+0000\'\u003e16\\/Sep\\/10 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, I agree, Knut. Just did it \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12910135_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910135_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Sep\\/10 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-16T12:57:10+0000\'\u003e16\\/Sep\\/10 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, I agree, Knut. Just did it                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12918258\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12918258&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12918258\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918258_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918258_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Oct\\/10 22:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-05T22:18:21+0000\'\u003e05\\/Oct\\/10 22:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading an experimental patch which upon seeing the container channel interrupted\\/closed, \u003cbr\\/\u003e\\ncloses and reopens the container to allow completion of the I\\/O.\u003c\\/p\u003e\\n\\n\u003cp\u003eUsing a modified Derby151Test, the trace on my box (OpenSolaris snv_148, Java 1.6) shows how\u003cbr\\/\u003e\\nthe RAFContainer4.java I\\/O code recovers. When an interrupt is detected (in the form of an interrupted channel),\u003cbr\\/\u003e\\nthe thread\'s interrupt flag is tucked away in a thread local variable for now, and the flag is reset, so the thread can continue and retry the I\\/O operation when the container has been resurrected. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe idea is that the thread local variable might be checked \\\"higher up\\\" somewhere, where throwing an exception would not make the database go down.\u003c\\/p\u003e\\n\\n\u003cp\u003eDuring this investigation, I have found numerous other locations at which an interrupt will make Derby go down, though, so RAFContainer4.java (or in deed NIO) is not the only weak spot we have.\u003cbr\\/\u003e\\nRunning the test on Windows, I see Derby choke on trying to switch log files, cf the enclosed derby.log file \\\"derby-4741-nio-container-2.log\\\" due to seeing a ChannelClosedException on the log file (NIO channel.force).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918258_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918258_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Oct\\/10 22:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-05T22:18:21+0000\'\u003e05\\/Oct\\/10 22:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading an experimental patch which upon seeing the container channel interrupted\\/closed,  \\ncloses and reopens the container to allow completion of the I\\/O. \\n\\n Using a modified Derby151Test, the trace on my box (OpenSolaris snv_148, Java 1.6) shows how \\nthe RAFContainer4.java I\\/O code recovers. When an interrupt is detected (in the form of an interrupted channel), \\nthe thread\'s interrupt flag is tucked away in a thread local variable for now, and the flag is reset, so the thread can continue and retry the I\\/O operation when the container has been resurrected.  \\n\\n The idea is that the thread local variable might be checked \\\"higher up\\\" somewhere, where throwing an exception would not make the database go down. \\n\\n During this investigation, I have found numerous other locations at which an interrupt will make Derby go down, though, so RAFContainer4.java (or in deed NIO) is not the only weak spot we have. \\nRunning the test on Windows, I see Derby choke on trying to switch log files, cf the enclosed derby.log file \\\"derby-4741-nio-container-2.log\\\" due to seeing a ChannelClosedException on the log file (NIO channel.force).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12918508\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12918508&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12918508\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918508_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918508_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Oct\\/10 13:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-06T13:21:48+0000\'\u003e06\\/Oct\\/10 13:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a modified version of the experimental patch, nio-container-2b, which also includes a standalone test I have been using to flush out effects of interrupts on threads.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918508_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918508_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Oct\\/10 13:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-06T13:21:48+0000\'\u003e06\\/Oct\\/10 13:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a modified version of the experimental patch, nio-container-2b, which also includes a standalone test I have been using to flush out effects of interrupts on threads.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12918975\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12918975&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12918975\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918975_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918975_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Oct\\/10 17:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-07T17:04:18+0000\'\u003e07\\/Oct\\/10 17:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading derby-4741-nio-container+log, which builds on the previous\u003cbr\\/\u003e\\nexperimental patch in the following ways:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eAdds logic to recover when switching the log file gets interrupted\u003cbr\\/\u003e\\n  (seen on Windows using Derby151Test). The retry had to precolate up\u003cbr\\/\u003e\\n  from the NIO code, so I use an internal exception (temporarily\u003cbr\\/\u003e\\n  borrow an exisiting one; should make a new one later)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eMakes RAFContainer4#getEmbryonicPage use a minion of readPage, so\u003cbr\\/\u003e\\n  getEmbryonicPage can take advantage of the recovery machinery as\u003cbr\\/\u003e\\n  well (it previously did a direct call to readFull, which made it\u003cbr\\/\u003e\\n  vulnerable to being interrupted; this was also seen on Windows.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  Unfortunately, the latter could lead to deadlocks, because when\u003cbr\\/\u003e\\n  getEmbryonicPage is called from writeRAFHeader, the thread has a\u003cbr\\/\u003e\\n  lock on \\\"this\\\".  If another thread is has been interrupted and is\u003cbr\\/\u003e\\n  about to do recovery, it would get stuck on waiting for the monitor\u003cbr\\/\u003e\\n  on \\\"this\\\", while the getEmbryonicPage reader would get stuck on\u003cbr\\/\u003e\\n  waiting on recovery to finish. To solve this, I had to let reads\u003cbr\\/\u003e\\n  from getEmbryonicPage throw an internal exception so it can back out\u003cbr\\/\u003e\\n  and release the monitor on \\\"this\\\" (in RAFContainer#clean), and do a\u003cbr\\/\u003e\\n  retry from that level.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch is just a snapshot of my experiments, only intended so\u003cbr\\/\u003e\\npeople could comment on the approach. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918975_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918975_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Oct\\/10 17:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-07T17:04:18+0000\'\u003e07\\/Oct\\/10 17:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading derby-4741-nio-container+log, which builds on the previous \\nexperimental patch in the following ways: \\n\\n \\n\\t Adds logic to recover when switching the log file gets interrupted \\n  (seen on Windows using Derby151Test). The retry had to precolate up \\n  from the NIO code, so I use an internal exception (temporarily \\n  borrow an exisiting one; should make a new one later) \\n \\n\\n\\n \\n\\t Makes RAFContainer4#getEmbryonicPage use a minion of readPage, so \\n  getEmbryonicPage can take advantage of the recovery machinery as \\n  well (it previously did a direct call to readFull, which made it \\n  vulnerable to being interrupted; this was also seen on Windows. \\n \\n\\n\\n   Unfortunately, the latter could lead to deadlocks, because when \\n  getEmbryonicPage is called from writeRAFHeader, the thread has a \\n  lock on \\\"this\\\".  If another thread is has been interrupted and is \\n  about to do recovery, it would get stuck on waiting for the monitor \\n  on \\\"this\\\", while the getEmbryonicPage reader would get stuck on \\n  waiting on recovery to finish. To solve this, I had to let reads \\n  from getEmbryonicPage throw an internal exception so it can back out \\n  and release the monitor on \\\"this\\\" (in RAFContainer#clean), and do a \\n  retry from that level. \\n\\n The patch is just a snapshot of my experiments, only intended so \\npeople could comment on the approach.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12918977\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12918977&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12918977\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918977_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918977_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Oct\\/10 17:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-07T17:16:19+0000\'\u003e07\\/Oct\\/10 17:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNow, heading back to Solaris after having flushed out NIO issues on Windows, I see that Derby falls over when it gets interrupted\u003cbr\\/\u003e\\nduring transaction abort (XSTB0), as a result of receving an interrupt during a log flush wait(LogToFile.java:4048). I saw this using InterruptedTest in the patch. The test tries to reconnect (reboot), but eventually I can no longer get a connection, because I  hit a NullPointerException in BaseDataFileFactory.java:639 (containerCache empty??). Cf enclosed xsbt0.log.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12918977_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12918977_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Oct\\/10 17:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-07T17:16:19+0000\'\u003e07\\/Oct\\/10 17:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Now, heading back to Solaris after having flushed out NIO issues on Windows, I see that Derby falls over when it gets interrupted \\nduring transaction abort (XSTB0), as a result of receving an interrupt during a log flush wait(LogToFile.java:4048). I saw this using InterruptedTest in the patch. The test tries to reconnect (reboot), but eventually I can no longer get a connection, because I  hit a NullPointerException in BaseDataFileFactory.java:639 (containerCache empty??). Cf enclosed xsbt0.log.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12919286\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12919286&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12919286\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919286_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919286_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 14:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T14:10:02+0000\'\u003e08\\/Oct\\/10 14:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a revised experimental patch, derby-4741-nio-container+log+waits, which intercepts and saves away interrupts in \u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eLogToFile#flush, when a thread is waiting for another thread to flush the log.\u003c\\/li\u003e\\n\\t\u003cli\u003eBasePage#setExclusive (2 places)\u003c\\/li\u003e\\n\\t\u003cli\u003eBasePage#setExclusiveNoWait\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt also fixes a bug in NIO getEmbryonicPage; the new implementation tried to decrypt when reading the embryonic page if the database were encrypted.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith these changes in place, the next issue that I sometime see is that we can get interrupted waiting for a lock.\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.lang.InterruptedException\u003cbr\\/\u003e\\n\\tat java.lang.Object.wait(Native Method)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.locks.ActiveLock.waitForGrant(ActiveLock.java:118)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:469)\u003c\\/p\u003e\\n\\n\u003cp\u003eIn turn this led to continual failure because I hit this ASSERT:\u003c\\/p\u003e\\n\\n\u003cp\u003eat org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147)\u003cbr\\/\u003e\\nat org.apache.derby.impl.services.locks.LockControl.addLock(LockControl.java:276)\u003c\\/p\u003e\\n\\n\u003cp\u003eKnut suggested to me we try to treat this situation similarly to how we handle lock time-outs and just throw an interrupted exception at safe place. Sounds good to me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919286_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919286_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 14:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T14:10:02+0000\'\u003e08\\/Oct\\/10 14:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a revised experimental patch, derby-4741-nio-container+log+waits, which intercepts and saves away interrupts in  \\n\\n \\n\\t LogToFile#flush, when a thread is waiting for another thread to flush the log. \\n\\t BasePage#setExclusive (2 places) \\n\\t BasePage#setExclusiveNoWait \\n \\n\\n\\n It also fixes a bug in NIO getEmbryonicPage; the new implementation tried to decrypt when reading the embryonic page if the database were encrypted. \\n\\n With these changes in place, the next issue that I sometime see is that we can get interrupted waiting for a lock. \\n\\n java.lang.InterruptedException \\n\\tat java.lang.Object.wait(Native Method) \\n\\tat org.apache.derby.impl.services.locks.ActiveLock.waitForGrant(ActiveLock.java:118) \\n\\tat org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(ConcurrentLockSet.java:469) \\n\\n In turn this led to continual failure because I hit this ASSERT: \\n\\n at org.apache.derby.shared.common.sanity.SanityManager.THROWASSERT(SanityManager.java:147) \\nat org.apache.derby.impl.services.locks.LockControl.addLock(LockControl.java:276) \\n\\n Knut suggested to me we try to treat this situation similarly to how we handle lock time-outs and just throw an interrupted exception at safe place. Sounds good to me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12919335\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12919335&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12919335\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12919335_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919335_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 17:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T17:51:51+0000\'\u003e08\\/Oct\\/10 17:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eso far your approach seems fine to me, and I think will help a lot of customers.  I was wondering if\u003cbr\\/\u003e\\nyou have a high level goal.  Basically what should derby do when it encounters an interrupt.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think it should always throw some sort of error back to caller, and would be nice if the error or \u003cbr\\/\u003e\\nthe nested error indicated clearly that it is being thrown because of a thread interrupt.  Many times\u003cbr\\/\u003e\\nwhen supporting this issue it takes awhile for the user to realize that they are the ones generating\u003cbr\\/\u003e\\nthe interrupt.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the error should not be database level, and with your retry on I\\/O and log it seems like we\u003cbr\\/\u003e\\ncan avoid that.  I am not sure if it should be session or statement level,\u003cbr\\/\u003e\\nI am leaning to it being session level, but would like to see a discussion.  I know often users are\u003cbr\\/\u003e\\ndoing the interrupt to stop a thread.  \u003c\\/p\u003e\\n\\n\u003cp\u003eUltimately do you plan on always reenabling the interrupt after retrying or getting to a safe place?\u003c\\/p\u003e\\n\\n\u003cp\u003eWe should definitely throw an error in the case of an interrupt during a lock wait, this seems like the\u003cbr\\/\u003e\\none valid case to send an interrupt to derby if a user thinks it is waiting too long.  Hopefully you can\u003cbr\\/\u003e\\ncode it to handle it, do processing, get to safe spot and then throw an error indicating a real user \u003cbr\\/\u003e\\ninterrupt during a wait.  \u003c\\/p\u003e\\n\\n\u003cp\u003eSomething to think about in the error throwing is the background thread.  What should we do if\u003cbr\\/\u003e\\nit encounters an interrupt.  Throwing an error there might shutdown the db, i am not sure what it\u003cbr\\/\u003e\\ndoes at top level with an error.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12919335_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919335_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 17:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T17:51:51+0000\'\u003e08\\/Oct\\/10 17:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    so far your approach seems fine to me, and I think will help a lot of customers.  I was wondering if \\nyou have a high level goal.  Basically what should derby do when it encounters an interrupt. \\n\\n I think it should always throw some sort of error back to caller, and would be nice if the error or  \\nthe nested error indicated clearly that it is being thrown because of a thread interrupt.  Many times \\nwhen supporting this issue it takes awhile for the user to realize that they are the ones generating \\nthe interrupt. \\n\\n I think the error should not be database level, and with your retry on I\\/O and log it seems like we \\ncan avoid that.  I am not sure if it should be session or statement level, \\nI am leaning to it being session level, but would like to see a discussion.  I know often users are \\ndoing the interrupt to stop a thread.   \\n\\n Ultimately do you plan on always reenabling the interrupt after retrying or getting to a safe place? \\n\\n We should definitely throw an error in the case of an interrupt during a lock wait, this seems like the \\none valid case to send an interrupt to derby if a user thinks it is waiting too long.  Hopefully you can \\ncode it to handle it, do processing, get to safe spot and then throw an error indicating a real user  \\ninterrupt during a wait.   \\n\\n Something to think about in the error throwing is the background thread.  What should we do if \\nit encounters an interrupt.  Throwing an error there might shutdown the db, i am not sure what it \\ndoes at top level with an error. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12919376\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12919376&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12919376\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919376_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919376_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T20:57:45+0000\'\u003e08\\/Oct\\/10 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Mike, thanks for looking at this!\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I was wondering if you have a high level\u003cbr\\/\u003e\\n&gt; goal. Basically what should derby do when it encounters an\u003cbr\\/\u003e\\n&gt; interrupt.\u003c\\/p\u003e\\n\\n\u003cp\u003eI started off merely trying to make the new IO pieces stand up as well\u003cbr\\/\u003e\\nas the old I\\/O, but I guess my ambitions grew a bit as I found many\u003cbr\\/\u003e\\nthings could bring Derby down..\u003c\\/p\u003e\\n\\n\u003cp\u003eMy thinking so far is that Derby should:\u003c\\/p\u003e\\n\\n\u003cp\u003ea) avoid having to shut down if a thread has been interrupted\u003c\\/p\u003e\\n\\n\u003cp\u003eb) throw \u003cb\u003esomething\u003c\\/b\u003e when it finds the thread has been interrupted,\u003cbr\\/\u003e\\npreferably as soon as possible, but not before the code has arrived at\u003cbr\\/\u003e\\na \\\"safe place\\\", so we can avoid Derby shutting down.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I think it should always throw some sort of error back to caller,\u003cbr\\/\u003e\\n&gt; and would be nice if the error or the nested error indicated clearly\u003cbr\\/\u003e\\n&gt; that it is being thrown because of a thread interrupt. Many times\u003cbr\\/\u003e\\n&gt; when supporting this issue it takes awhile for the user to realize\u003cbr\\/\u003e\\n&gt; that they are the ones generating the interrupt.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgreed. So far I have been thinking of just using the connection level error 08000,\u003cbr\\/\u003e\\nwrapping the original NIO channel exception, or InterruptedException.\u003cbr\\/\u003e\\nThis should make it clear what has happened, and unwrapping the exception would \u003cbr\\/\u003e\\nshow where Derby detected it.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e&gt; I think the error should not be database level, and with your retry\u003cbr\\/\u003e\\n&gt; on I\\/O and log it seems like we can avoid that. \u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s what I am trying to achieve, yes.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I am not sure if it should be session or statement level, I am\u003cbr\\/\u003e\\n&gt; leaning to it being session level, but would like to see a\u003cbr\\/\u003e\\n&gt; discussion. I know often users are doing the interrupt to stop a\u003cbr\\/\u003e\\n&gt; thread.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe existing code throws session level error 08000 already in many\u003cbr\\/\u003e\\nplaces, and I felt it\'s OK to require that the user reconnect when she\u003cbr\\/\u003e\\nhas done something as drastic as interrupting the thread \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/help_16.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Ultimately do you plan on always reenabling the interrupt after\u003cbr\\/\u003e\\n&gt; retrying or getting to a safe place?\u003c\\/p\u003e\\n\\n\u003cp\u003eI am still pondering this question. I \u003cb\u003ethink\u003c\\/b\u003e that by the principle of\u003cbr\\/\u003e\\nleast surprise to the user, we should set the interrupted flag of the\u003cbr\\/\u003e\\nthread again just before we throw the exception from the \\\"safe place\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eNote: the exisiting code does not resurrect the\u003cbr\\/\u003e\\nthread\'s interrupted flag when it detects an interrupt of a wait and throws\u003cbr\\/\u003e\\nStandardException.interrupt. (wait would have cleared the flag). \u003c\\/p\u003e\\n\\n\u003cp\u003eAn imminent problem is where would the \\\"safe place\\\" be? It would be\u003cbr\\/\u003e\\nnice to \u003cb\u003eavoid\u003c\\/b\u003e having to check in all JDBC API methods before we\u003cbr\\/\u003e\\nreturn if Derby has been interrupted during the API call, but I am not\u003cbr\\/\u003e\\nyet sure if I am able to determine conclusively which API code paths\u003cbr\\/\u003e\\ncould lead to Derby being interrupted.. One approach would be to throw\u003cbr\\/\u003e\\nas \\\"soon as possible\\\" from a \\\"safe place\\\" on the stack above the\u003cbr\\/\u003e\\nmethod that saw the interrupt, but it may be hard to always determine\u003cbr\\/\u003e\\nwhere that would be in all cases. I am open to suggestions here \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThe current experimental patch mostly doesn\'t throw yet (I didn\'t get\u003cbr\\/\u003e\\nthat far) - it just makes a note that an interrupt was detected. Nor\u003cbr\\/\u003e\\ndoes it resurrect the interrupted flag when it does throw - since I\u003cbr\\/\u003e\\nwas still torn on this.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; We should definitely throw an error in the case of an interrupt\u003cbr\\/\u003e\\n&gt; during a lock wait, this seems like the one valid case to send an\u003cbr\\/\u003e\\n&gt; interrupt to derby if a user thinks it is waiting too\u003cbr\\/\u003e\\n&gt; long. Hopefully you can code it to handle it, do processing, get to\u003cbr\\/\u003e\\n&gt; safe spot and then throw an error indicating a real user interrupt\u003cbr\\/\u003e\\n&gt; during a wait.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I am trying to do exactly that, agreed. \u003c\\/p\u003e\\n\\n\u003cp\u003eI also would like interrupts on queries to be detected no later that\u003cbr\\/\u003e\\nat the place where we check for query time-outs already,\u003cbr\\/\u003e\\ncf. BasicNoPutResultSetImpl#checkCancellationFlag.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Something to think about in the error throwing is the background\u003cbr\\/\u003e\\n&gt; thread. What should we do if it encounters an interrupt. Throwing an\u003cbr\\/\u003e\\n&gt; error there might shutdown the db, i am not sure what it does at top\u003cbr\\/\u003e\\n&gt; level with an error.\u003c\\/p\u003e\\n\\n\u003cp\u003eRight. A priori, I thought the most common use case would be user\u003cbr\\/\u003e\\nthreads getting interrupted, but I\'ll look into that. One approach\u003cbr\\/\u003e\\ncould be to shutdown, or possibly try to make it impervious and ignore\u003cbr\\/\u003e\\nall interrupts..\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919376_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919376_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T20:57:45+0000\'\u003e08\\/Oct\\/10 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Mike, thanks for looking at this! \\n\\n &gt; I was wondering if you have a high level \\n&gt; goal. Basically what should derby do when it encounters an \\n&gt; interrupt. \\n\\n I started off merely trying to make the new IO pieces stand up as well \\nas the old I\\/O, but I guess my ambitions grew a bit as I found many \\nthings could bring Derby down.. \\n\\n My thinking so far is that Derby should: \\n\\n a) avoid having to shut down if a thread has been interrupted \\n\\n b) throw  something  when it finds the thread has been interrupted, \\npreferably as soon as possible, but not before the code has arrived at \\na \\\"safe place\\\", so we can avoid Derby shutting down. \\n\\n &gt; I think it should always throw some sort of error back to caller, \\n&gt; and would be nice if the error or the nested error indicated clearly \\n&gt; that it is being thrown because of a thread interrupt. Many times \\n&gt; when supporting this issue it takes awhile for the user to realize \\n&gt; that they are the ones generating the interrupt. \\n\\n Agreed. So far I have been thinking of just using the connection level error 08000, \\nwrapping the original NIO channel exception, or InterruptedException. \\nThis should make it clear what has happened, and unwrapping the exception would  \\nshow where Derby detected it. \\n\\n\\n &gt; I think the error should not be database level, and with your retry \\n&gt; on I\\/O and log it seems like we can avoid that.  \\n\\n That\'s what I am trying to achieve, yes. \\n\\n &gt; I am not sure if it should be session or statement level, I am \\n&gt; leaning to it being session level, but would like to see a \\n&gt; discussion. I know often users are doing the interrupt to stop a \\n&gt; thread. \\n\\n The existing code throws session level error 08000 already in many \\nplaces, and I felt it\'s OK to require that the user reconnect when she \\nhas done something as drastic as interrupting the thread   \\n\\n &gt; Ultimately do you plan on always reenabling the interrupt after \\n&gt; retrying or getting to a safe place? \\n\\n I am still pondering this question. I  think  that by the principle of \\nleast surprise to the user, we should set the interrupted flag of the \\nthread again just before we throw the exception from the \\\"safe place\\\". \\n\\n Note: the exisiting code does not resurrect the \\nthread\'s interrupted flag when it detects an interrupt of a wait and throws \\nStandardException.interrupt. (wait would have cleared the flag).  \\n\\n An imminent problem is where would the \\\"safe place\\\" be? It would be \\nnice to  avoid  having to check in all JDBC API methods before we \\nreturn if Derby has been interrupted during the API call, but I am not \\nyet sure if I am able to determine conclusively which API code paths \\ncould lead to Derby being interrupted.. One approach would be to throw \\nas \\\"soon as possible\\\" from a \\\"safe place\\\" on the stack above the \\nmethod that saw the interrupt, but it may be hard to always determine \\nwhere that would be in all cases. I am open to suggestions here   \\n\\n The current experimental patch mostly doesn\'t throw yet (I didn\'t get \\nthat far) - it just makes a note that an interrupt was detected. Nor \\ndoes it resurrect the interrupted flag when it does throw - since I \\nwas still torn on this. \\n\\n &gt; We should definitely throw an error in the case of an interrupt \\n&gt; during a lock wait, this seems like the one valid case to send an \\n&gt; interrupt to derby if a user thinks it is waiting too \\n&gt; long. Hopefully you can code it to handle it, do processing, get to \\n&gt; safe spot and then throw an error indicating a real user interrupt \\n&gt; during a wait. \\n\\n Yes, I am trying to do exactly that, agreed.  \\n\\n I also would like interrupts on queries to be detected no later that \\nat the place where we check for query time-outs already, \\ncf. BasicNoPutResultSetImpl#checkCancellationFlag. \\n\\n &gt; Something to think about in the error throwing is the background \\n&gt; thread. What should we do if it encounters an interrupt. Throwing an \\n&gt; error there might shutdown the db, i am not sure what it does at top \\n&gt; level with an error. \\n\\n Right. A priori, I thought the most common use case would be user \\nthreads getting interrupted, but I\'ll look into that. One approach \\ncould be to shutdown, or possibly try to make it impervious and ignore \\nall interrupts..              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12919402\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12919402&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12919402\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919402_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919402_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 22:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T22:46:12+0000\'\u003e08\\/Oct\\/10 22:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a new version of the experimental patch, derby-4741-nio-container+log+waits+locks,\u003cbr\\/\u003e\\nwhich \u003c\\/p\u003e\\n\\n\u003cp\u003ea) handles interrupts during lock wait\u003cbr\\/\u003e\\nb) retries when LogToFile fails during call to switchLogFile#preAllocateNewLogFile\'s call to syncFile, which I also saw,\u003cbr\\/\u003e\\n   but there are probably more places where logging can fail\u003cbr\\/\u003e\\n c) adds a \\\"lock\\\" argument to InterruptTest to test safe throws for a)\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919402_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919402_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Oct\\/10 22:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-08T22:46:12+0000\'\u003e08\\/Oct\\/10 22:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a new version of the experimental patch, derby-4741-nio-container+log+waits+locks, \\nwhich  \\n\\n a) handles interrupts during lock wait \\nb) retries when LogToFile fails during call to switchLogFile#preAllocateNewLogFile\'s call to syncFile, which I also saw, \\n   but there are probably more places where logging can fail \\n c) adds a \\\"lock\\\" argument to InterruptTest to test safe throws for a) \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12919646\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12919646&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12919646\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12919646_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919646_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Oct\\/10 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-10T19:06:07+0000\'\u003e10\\/Oct\\/10 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Knut Anders Hatlen - 10\\/Oct\\/10 19:07\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Dag. The proposed plan sounds good to me.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs to what to do with the interrupt status after a retry, I\'d be happy as long as we always either fail or preserve the interrupt status. I don\'t have any strong opinions on whether or not we should set the interrupt flag when raising the exception. I see that the pre-NIO methods that may be interrupted (wait, sleep, join) will throw an exception and \u003cb\u003eclear\u003c\\/b\u003e the interrupt status, whereas the interruptible NIO methods will throw an exception and \u003cb\u003eset\u003c\\/b\u003e the interrupt status, so the precedence from the class library is ambiguous. I agree, though, that the user\'s intent is probably to stop the thread, and then preserving the interrupt status sounds reasonable in order to prevent that the thread just runs to the next blocking call and gets blocked there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12919646_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919646_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Oct\\/10 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-10T19:06:07+0000\'\u003e10\\/Oct\\/10 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Knut Anders Hatlen - 10\\/Oct\\/10 19:07\\\"\u003eedited\u003c\\/span\u003e                   Thanks Dag. The proposed plan sounds good to me. \\n\\n As to what to do with the interrupt status after a retry, I\'d be happy as long as we always either fail or preserve the interrupt status. I don\'t have any strong opinions on whether or not we should set the interrupt flag when raising the exception. I see that the pre-NIO methods that may be interrupted (wait, sleep, join) will throw an exception and  clear  the interrupt status, whereas the interruptible NIO methods will throw an exception and  set  the interrupt status, so the precedence from the class library is ambiguous. I agree, though, that the user\'s intent is probably to stop the thread, and then preserving the interrupt status sounds reasonable in order to prevent that the thread just runs to the next blocking call and gets blocked there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12919805\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12919805&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12919805\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919805_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919805_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Oct\\/10 12:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-11T12:47:52+0000\'\u003e11\\/Oct\\/10 12:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Knut! I agree it\'s a bit weird that the JRE is a little schizophrenic about the interrupt flag. I think we should try to be consistent when we throw, no matter where\\/after which Java API call Derby detects it. If we do retain the interrupt flag, I think it adds to the argument for making the exception session-level, since the user would need to undertake some cleaning up anyway, or else the next Derby call would fail as well. Probably this would be the use case for connection pools. As to arguments for making the error statement level, I guess if one just wants to stop a run-away query, one would possibly prefer that just the statement failed.  A thing to consider here is the new JDBC 4.1 method Connection#abort:\u003cbr\\/\u003e\\nThis would be the future portable way of stopping a run-away transaction. It will also close the the connection.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch passed regressions, for what it\'s worth.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12919805_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12919805_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Oct\\/10 12:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-11T12:47:52+0000\'\u003e11\\/Oct\\/10 12:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Knut! I agree it\'s a bit weird that the JRE is a little schizophrenic about the interrupt flag. I think we should try to be consistent when we throw, no matter where\\/after which Java API call Derby detects it. If we do retain the interrupt flag, I think it adds to the argument for making the exception session-level, since the user would need to undertake some cleaning up anyway, or else the next Derby call would fail as well. Probably this would be the use case for connection pools. As to arguments for making the error statement level, I guess if one just wants to stop a run-away query, one would possibly prefer that just the statement failed.  A thing to consider here is the new JDBC 4.1 method Connection#abort: \\nThis would be the future portable way of stopping a run-away transaction. It will also close the the connection. \\n\\n This patch passed regressions, for what it\'s worth.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920090\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920090&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920090\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12920090_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920090_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 05:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T05:00:42+0000\'\u003e12\\/Oct\\/10 05:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks to Dag for fixing this bug. It will benefit a lot of customers. As for making the exception on either session-level or statement level, I will prefer to have it stop a run-away query and have the exception jut s statement failed. For most web application, it could be easier to rewrite the interrupt near statement than session perspective. \u003cbr\\/\u003e\\nAs test for nio+container+log+waits+locks, it also passed suites.all on my windows 7 machine. However, when running mailjdbc tests, the test got exception on Error 40XD1: Container was opened in read-only mode for Browsing thread, on Error \'-1:java.lang.ArrayIndexOutOfBoundsException\' for Backup Thread. \u003cbr\\/\u003e\\nI am not totally sure why the different behavior for this patch. However, with derby-4741-nio-container+log patch, mailjdbc get deadlock exception. I am attach derby.log for reference point.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12920090_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920090_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 05:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T05:00:42+0000\'\u003e12\\/Oct\\/10 05:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks to Dag for fixing this bug. It will benefit a lot of customers. As for making the exception on either session-level or statement level, I will prefer to have it stop a run-away query and have the exception jut s statement failed. For most web application, it could be easier to rewrite the interrupt near statement than session perspective.  \\nAs test for nio+container+log+waits+locks, it also passed suites.all on my windows 7 machine. However, when running mailjdbc tests, the test got exception on Error 40XD1: Container was opened in read-only mode for Browsing thread, on Error \'-1:java.lang.ArrayIndexOutOfBoundsException\' for Backup Thread.  \\nI am not totally sure why the different behavior for this patch. However, with derby-4741-nio-container+log patch, mailjdbc get deadlock exception. I am attach derby.log for reference point.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920177\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920177&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920177\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920177_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920177_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T12:55:58+0000\'\u003e12\\/Oct\\/10 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Lily, thanks for test driving the patches \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  Du you know if mailjdbc uses interrupts in any way? I\'ll try to run it myself, maybe some of the changes changed behavior even in the absence of interrupts. Btw, there are still many holes, I have found more places especially in the logging system that are vulnerable to\u003cbr\\/\u003e\\ninterrupts, so I am still building out the experimental patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920177_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920177_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 12:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T12:55:58+0000\'\u003e12\\/Oct\\/10 12:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Lily, thanks for test driving the patches    Du you know if mailjdbc uses interrupts in any way? I\'ll try to run it myself, maybe some of the changes changed behavior even in the absence of interrupts. Btw, there are still many holes, I have found more places especially in the logging system that are vulnerable to \\ninterrupts, so I am still building out the experimental patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920186\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920186&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920186\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12920186_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920186_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 13:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T13:33:38+0000\'\u003e12\\/Oct\\/10 13:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag,\u003c\\/p\u003e\\n\\n\u003cp\u003eThere\'s some discussion about mailjdbc and interrupts on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3746\\\" title=\\\"java.sql.SQLException: The exception &#39;java.lang.NullPointerException&#39; was thrown while evaluating an expression.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3746\\\"\u003eDERBY-3746\u003c\\/a\u003e. The comments there seem to indicate that the test sometimes interrupts the worker threads.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12920186_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920186_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 13:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T13:33:38+0000\'\u003e12\\/Oct\\/10 13:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag, \\n\\n There\'s some discussion about mailjdbc and interrupts on  DERBY-3746 . The comments there seem to indicate that the test sometimes interrupts the worker threads.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920218\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920218&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920218\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12920218_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920218_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T14:24:27+0000\'\u003e12\\/Oct\\/10 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag:\u003cbr\\/\u003e\\n     Thank you. I am so exciting to help out testing and hope I can do more. Like Knut said, mailjdbc interrupts on Browse.java and more detail on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3746\\\" title=\\\"java.sql.SQLException: The exception &#39;java.lang.NullPointerException&#39; was thrown while evaluating an expression.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3746\\\"\u003eDERBY-3746\u003c\\/a\u003e and \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4166\\\" title=\\\"improvements to the mailjdbc test\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4166\\\"\u003e\u003cdel\u003eDERBY-4166\u003c\\/del\u003e\u003c\\/a\u003e, the portion of the code on Browse.java that call interrupt is: \u003cbr\\/\u003e\\n\\t\\t\\t\\t\\/\\/Checking whether Refresh thread is running after doing Browse work\u003cbr\\/\u003e\\n\\t\\t\\t\\t\\/\\/If Refresh is not running, interrupt the thread\u003cbr\\/\u003e\\n\\t\\t\\t\\tif (ThreadUtils.isThreadRunning(\\\"Refresh Thread\\\")) \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\t\\tMailJdbc.logAct.logMsg(\\\"******** Refresh is running\\\");\\n\\t\\t\\t\\t}\\n\u003cp\u003e else \u003c\\/p\u003e\\n{\\n\\t\\t\\t\\t\\tRefresh th = (Refresh) ThreadUtils\\n\\t\\t\\t\\t\\t\\t\\t.getThread(\\\"Refresh Thread\\\");\\n\\t\\t\\t\\t\\tth.interrupt();\\n\\t\\t\\t\\t}\\n\u003cp\u003e      Refresh thread and Brose thread are dealing with the same tables for mailjdbc application. I am also reading Derby151Test to see whether we should simplify the mailjdbc test to better fit testing this fix that will benefit a lot of customers. Thanks again. By the way, the read-only error on Browse thread and  ArrayIndexOutOfBoundsException from backup thread is from running mailjdbc with embedded server.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12920218_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920218_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T14:24:27+0000\'\u003e12\\/Oct\\/10 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag: \\n     Thank you. I am so exciting to help out testing and hope I can do more. Like Knut said, mailjdbc interrupts on Browse.java and more detail on  DERBY-3746  and   DERBY-4166  , the portion of the code on Browse.java that call interrupt is:  \\n\\t\\t\\t\\t\\/\\/Checking whether Refresh thread is running after doing Browse work \\n\\t\\t\\t\\t\\/\\/If Refresh is not running, interrupt the thread \\n\\t\\t\\t\\tif (ThreadUtils.isThreadRunning(\\\"Refresh Thread\\\"))  \\n{\\n\\t\\t\\t\\t\\tMailJdbc.logAct.logMsg(\\\"******** Refresh is running\\\");\\n\\t\\t\\t\\t}\\n  else  \\n{\\n\\t\\t\\t\\t\\tRefresh th = (Refresh) ThreadUtils\\n\\t\\t\\t\\t\\t\\t\\t.getThread(\\\"Refresh Thread\\\");\\n\\t\\t\\t\\t\\tth.interrupt();\\n\\t\\t\\t\\t}\\n       Refresh thread and Brose thread are dealing with the same tables for mailjdbc application. I am also reading Derby151Test to see whether we should simplify the mailjdbc test to better fit testing this fix that will benefit a lot of customers. Thanks again. By the way, the read-only error on Browse thread and  ArrayIndexOutOfBoundsException from backup thread is from running mailjdbc with embedded server.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920225\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920225&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920225\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920225_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920225_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 14:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T14:51:52+0000\'\u003e12\\/Oct\\/10 14:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Knut and Lily. \u003cbr\\/\u003e\\nOk, good to know that there is an interrupt involved when mailjdbc fails.  Lily, also please note that Derby151Test is its present form will probably change when I start to actually throw Derby exceptions when interrupts are detected. So far, they are mostly only noted in InterruptStatus (thread local) and normal operation continues. The latest patch has started to throw exceptions for interrupts while waiting for locks, though, cf. mods in LockSet.java\\/ConcurrentLockSet.java, since this seemed the obvious place to throw anyway.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920225_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920225_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 14:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T14:51:52+0000\'\u003e12\\/Oct\\/10 14:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Knut and Lily.  \\nOk, good to know that there is an interrupt involved when mailjdbc fails.  Lily, also please note that Derby151Test is its present form will probably change when I start to actually throw Derby exceptions when interrupts are detected. So far, they are mostly only noted in InterruptStatus (thread local) and normal operation continues. The latest patch has started to throw exceptions for interrupts while waiting for locks, though, cf. mods in LockSet.java\\/ConcurrentLockSet.java, since this seemed the obvious place to throw anyway.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920248\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920248&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920248\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920248_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920248_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T16:20:11+0000\'\u003e12\\/Oct\\/10 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLily, I looked at derby.log: The stack trace you see first: \\\"ERROR 40XD1: Container was opened in read-only mode.\\\" seems to happen \u003cbr\\/\u003e\\nwhile Derby is opening the conglomerate in the normal fashion and finds for some reason that it (or the directory) is not writable. It is not obvious to me that\u003cbr\\/\u003e\\nthis has to do with the patch, but it is not impossible, I suppose, since the patch does touch RAFContainer(4), e.g. by reopening the container if the channel has been closed by interrupts. But this seems to be a normal open, not a reopen called from RAFContainer4 (which is not on the stack).\u003cbr\\/\u003e\\nCf. RAFContainer#run, action OPEN_CONTAINER_ACTION, ca line 1447.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll see if I can run the test myself and reproduced the error.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920248_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920248_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T16:20:11+0000\'\u003e12\\/Oct\\/10 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lily, I looked at derby.log: The stack trace you see first: \\\"ERROR 40XD1: Container was opened in read-only mode.\\\" seems to happen  \\nwhile Derby is opening the conglomerate in the normal fashion and finds for some reason that it (or the directory) is not writable. It is not obvious to me that \\nthis has to do with the patch, but it is not impossible, I suppose, since the patch does touch RAFContainer(4), e.g. by reopening the container if the channel has been closed by interrupts. But this seems to be a normal open, not a reopen called from RAFContainer4 (which is not on the stack). \\nCf. RAFContainer#run, action OPEN_CONTAINER_ACTION, ca line 1447. \\n\\n I\'ll see if I can run the test myself and reproduced the error.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920357\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920357&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920357\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920357_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920357_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T21:35:25+0000\'\u003e12\\/Oct\\/10 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching derby-4741-nio-container+log+waits+locks-2, which adds more interrupt recovery logic, mainly to LogToFile.java and LogAccessFile. With this version I have not yet been able to make crash the database (i.e. provoke a database level error) using the three run modes of InterruptedTest - default, i.e. write, read and lock, so we are gettting more resilient.\u003c\\/p\u003e\\n\\n\u003cp\u003eOnly interrupted lock waits are added as new Derby exception cases yet, I\'ll start looking into where to throw more seriously now. Indeed, some existing cases where we did throw in LogToFile, don\'t throw in the current patch, we just take a note and retry.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920357_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920357_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Oct\\/10 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-12T21:35:25+0000\'\u003e12\\/Oct\\/10 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching derby-4741-nio-container+log+waits+locks-2, which adds more interrupt recovery logic, mainly to LogToFile.java and LogAccessFile. With this version I have not yet been able to make crash the database (i.e. provoke a database level error) using the three run modes of InterruptedTest - default, i.e. write, read and lock, so we are gettting more resilient. \\n\\n Only interrupted lock waits are added as new Derby exception cases yet, I\'ll start looking into where to throw more seriously now. Indeed, some existing cases where we did throw in LogToFile, don\'t throw in the current patch, we just take a note and retry.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920751\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920751&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920751\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920751_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920751_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/10 20:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-13T20:24:35+0000\'\u003e13\\/Oct\\/10 20:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLily, I ran mailjdbc test with my latest patch on Windows Vista for about 20 hours; I saw deadlocks, but not the read-only container error.\u003cbr\\/\u003e\\nI did see several mysterious lines in derby.log, e.g.\u003c\\/p\u003e\\n\\n\u003cp\u003e     \\\"not switching from an empty log file (870)\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003esimilar to what you had in your derby.log. I have no experience with this test, so I don\'t know if this is normal for this test or a sign that something is wrong; I\'ll try to run the test without the patch and compare.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920751_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920751_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/10 20:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-13T20:24:35+0000\'\u003e13\\/Oct\\/10 20:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lily, I ran mailjdbc test with my latest patch on Windows Vista for about 20 hours; I saw deadlocks, but not the read-only container error. \\nI did see several mysterious lines in derby.log, e.g. \\n\\n      \\\"not switching from an empty log file (870)\\\" \\n\\n similar to what you had in your derby.log. I have no experience with this test, so I don\'t know if this is normal for this test or a sign that something is wrong; I\'ll try to run the test without the patch and compare.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920769\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920769&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920769\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920769_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920769_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/10 21:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-13T21:16:06+0000\'\u003e13\\/Oct\\/10 21:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRe mailjdbc: It seems \\\"not switching from an empty log file\\\" in derby.log is normal for this test, at least I see it on trunk without the patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920769_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920769_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/10 21:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-13T21:16:06+0000\'\u003e13\\/Oct\\/10 21:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Re mailjdbc: It seems \\\"not switching from an empty log file\\\" in derby.log is normal for this test, at least I see it on trunk without the patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920790\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920790&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920790\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12920790_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920790_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/10 22:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-13T22:41:52+0000\'\u003e13\\/Oct\\/10 22:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Dag for spending time to look at mailjdbc. Yes, it is normal and I see it on trunk without the patch too. However, I haven\'t see the deadlock with the patch on my Windows 7 machine. I had been running 16 hours. It will be great for Derby if the deadlock is not normal. I will run more to see.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12920790_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920790_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Oct\\/10 22:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-13T22:41:52+0000\'\u003e13\\/Oct\\/10 22:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Dag for spending time to look at mailjdbc. Yes, it is normal and I see it on trunk without the patch too. However, I haven\'t see the deadlock with the patch on my Windows 7 machine. I had been running 16 hours. It will be great for Derby if the deadlock is not normal. I will run more to see.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920830\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920830&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920830\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920830_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920830_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/10 02:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-14T02:11:37+0000\'\u003e14\\/Oct\\/10 02:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading another experimental patch, derby-4741-nio-container+log+waits+locks+throws.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe change now is \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esome further generalizing of recovery logic in RAFContainer4, the readPage logic was missing some stuff I had added for writePage\u003c\\/li\u003e\\n\\t\u003cli\u003eintroduced InterruptTest#throwIf, which is a helper method to check &amp; reset the thread\'s interrupt status and throw an SQLException (08000 for now) if set.\u003c\\/li\u003e\\n\\t\u003cli\u003eadded throwIf next to Query timeout logic in BasicNoPutResultSetImpl#checkCancellationFlag\u003c\\/li\u003e\\n\\t\u003cli\u003eadded throwIf before all returns in impl\\/jdbc\\/*.java in methods which call (directly or indirectly) handleException(t), typically this pattern:\u003cbr\\/\u003e\\n       :\u003cbr\\/\u003e\\n       InterruptTest#throwIf()\u003cbr\\/\u003e\\n       return;\u003cbr\\/\u003e\\n} catch (Throwable t) {\u003cbr\\/\u003e\\n      throw handleException(t);\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThis will make sure Derby throws if it ever did see an interrupt during operation, which was intercepted for safety and postponed till a \\\"safe place\\\". This is a \\\"catch-all\\\", though, and I\'ll look for other  places closer to the\u003cbr\\/\u003e\\noriginating sites (container I\\/O, log I\\/O) so Derby could throw earlier. \u003c\\/p\u003e\\n\\n\u003cp\u003eFor example, commit can now throw if we see an interrupt during writing to log, cf. call to throwIf in EmbedConnection#commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eCurrently all interrupts throw 08000 which is session level, and none yet set the thread\'s intr flag. I will go over all usages of 08000 and set the flag next if we agree that\'s the right thing to do. Note that Derby151Test fails now, but InterruptTest should work and report all interrupts Derby see (some interrupts happen while the test is in application code; this is called out in the test\'s results). Btw, InterruptTest is not yet a JUnit test..\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch is getting a bit large and unwieldy now, but not to worry, the patch is just a proof of concept, I\'ll break it down into smaller pieces before any proposed commit. Rerunning regressions.\u003c\\/p\u003e\\n\\n\u003cp\u003eI see Lily would prefer statement level error, rather than session level. I am sticking to session level for now since that\'s what the exisiting 08000 currently is. I\'ll go over the remaining \u003cb\u003eexisting\u003c\\/b\u003e usages of 08000 which I didn\'t already replace with \\\"InterruptStatus.setInterrupted\\\" + retry logic. If all are ok to replace, we could probably choose to change the exception to statement level rather than session level. If not, it might be confusing to have two kinds of SQLExceptions for interrupts, with different severity...\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920830_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920830_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/10 02:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-14T02:11:37+0000\'\u003e14\\/Oct\\/10 02:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading another experimental patch, derby-4741-nio-container+log+waits+locks+throws. \\n\\n The change now is  \\n \\n\\t some further generalizing of recovery logic in RAFContainer4, the readPage logic was missing some stuff I had added for writePage \\n\\t introduced InterruptTest#throwIf, which is a helper method to check &amp; reset the thread\'s interrupt status and throw an SQLException (08000 for now) if set. \\n\\t added throwIf next to Query timeout logic in BasicNoPutResultSetImpl#checkCancellationFlag \\n\\t added throwIf before all returns in impl\\/jdbc\\/*.java in methods which call (directly or indirectly) handleException(t), typically this pattern: \\n       : \\n       InterruptTest#throwIf() \\n       return; \\n} catch (Throwable t) { \\n      throw handleException(t); \\n \\n\\n\\n This will make sure Derby throws if it ever did see an interrupt during operation, which was intercepted for safety and postponed till a \\\"safe place\\\". This is a \\\"catch-all\\\", though, and I\'ll look for other  places closer to the \\noriginating sites (container I\\/O, log I\\/O) so Derby could throw earlier.  \\n\\n For example, commit can now throw if we see an interrupt during writing to log, cf. call to throwIf in EmbedConnection#commit. \\n\\n Currently all interrupts throw 08000 which is session level, and none yet set the thread\'s intr flag. I will go over all usages of 08000 and set the flag next if we agree that\'s the right thing to do. Note that Derby151Test fails now, but InterruptTest should work and report all interrupts Derby see (some interrupts happen while the test is in application code; this is called out in the test\'s results). Btw, InterruptTest is not yet a JUnit test.. \\n\\n The patch is getting a bit large and unwieldy now, but not to worry, the patch is just a proof of concept, I\'ll break it down into smaller pieces before any proposed commit. Rerunning regressions. \\n\\n I see Lily would prefer statement level error, rather than session level. I am sticking to session level for now since that\'s what the exisiting 08000 currently is. I\'ll go over the remaining  existing  usages of 08000 which I didn\'t already replace with \\\"InterruptStatus.setInterrupted\\\" + retry logic. If all are ok to replace, we could probably choose to change the exception to statement level rather than session level. If not, it might be confusing to have two kinds of SQLExceptions for interrupts, with different severity... \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920996\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920996&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920996\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920996_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920996_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-14T16:00:45+0000\'\u003e14\\/Oct\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading the last patch again (derby-4741-nio-container+log+waits+locks+throws) - it had a small bug that broke LogSwitchFail.unit, fixed now \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920996_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920996_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-14T16:00:45+0000\'\u003e14\\/Oct\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading the last patch again (derby-4741-nio-container+log+waits+locks+throws) - it had a small bug that broke LogSwitchFail.unit, fixed now                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12920998\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12920998&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12920998\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920998_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920998_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/10 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-14T16:03:44+0000\'\u003e14\\/Oct\\/10 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA concern with additing the \\\"catch-all\\\" check is performance for fast API operations, like ResultSet#next, which usually only just fetches the next prefetched row (no I\\/O). I\'ll run some micro benchmarks to study if adding the interrupt check is too expensive in such a case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12920998_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12920998_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Oct\\/10 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-14T16:03:44+0000\'\u003e14\\/Oct\\/10 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A concern with additing the \\\"catch-all\\\" check is performance for fast API operations, like ResultSet#next, which usually only just fetches the next prefetched row (no I\\/O). I\'ll run some micro benchmarks to study if adding the interrupt check is too expensive in such a case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12921231\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12921231&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12921231\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12921231_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921231_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Oct\\/10 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-15T05:08:47+0000\'\u003e15\\/Oct\\/10 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Dag for giving such details about each change. It definitely helps people like me to learn and understand more. The patch is getting big and complicated. However,  I run mailjdbc again the latest derby-4741-nio-container+log+waits+locks+throws, the test run into Error ERROR 40001: A lock could not be obtained due to a deadlock.  derby.log is attached for reference. Do we need InterruptException on synchronized (slaveRecoveryMonitor) in LogToFile.recover(...)?  Will change interrupt exception to statement level rather than session level require more code changes? Such as code in impl\\/store\\/raw\\/xact\\/* I was just thinking statement level is more user friendly to application users.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12921231_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921231_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Oct\\/10 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-15T05:08:47+0000\'\u003e15\\/Oct\\/10 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Dag for giving such details about each change. It definitely helps people like me to learn and understand more. The patch is getting big and complicated. However,  I run mailjdbc again the latest derby-4741-nio-container+log+waits+locks+throws, the test run into Error ERROR 40001: A lock could not be obtained due to a deadlock.  derby.log is attached for reference. Do we need InterruptException on synchronized (slaveRecoveryMonitor) in LogToFile.recover(...)?  Will change interrupt exception to statement level rather than session level require more code changes? Such as code in impl\\/store\\/raw\\/xact\\/* I was just thinking statement level is more user friendly to application users.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12921418\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12921418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12921418\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12921418_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921418_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Oct\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-15T16:00:10+0000\'\u003e15\\/Oct\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Lily,\u003c\\/p\u003e\\n\\n\u003cp\u003ethanks again for looking at this \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; However, I run mailjdbc again the latest\u003cbr\\/\u003e\\n&gt; derby-4741-nio-container+log+waits+locks+throws, the test run into\u003cbr\\/\u003e\\n&gt; Error ERROR 40001: A lock could not be obtained due to a\u003cbr\\/\u003e\\n&gt; deadlock. derby.log is attached for reference. \u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I saw that such lock errors too after about 18 hours of so. I am\u003cbr\\/\u003e\\nnot yet sure they have anything to do with the patch changes, but I\u003cbr\\/\u003e\\ncan\'t rule it out. I don\'t know the test app well enough. If you have\u003cbr\\/\u003e\\nany insight here which would indicate that locks should not occur\u003cbr\\/\u003e\\nunder normal operation, what would that be?  We could try to run the\u003cbr\\/\u003e\\npatch without the changes I made to ActiveLock, ConcurrentLockSet and\u003cbr\\/\u003e\\nLockSet, and see if the changes there have something to do with any\u003cbr\\/\u003e\\nchange of behaviour..\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Do we need\u003cbr\\/\u003e\\n&gt; InterruptException on synchronized (slaveRecoveryMonitor) in\u003cbr\\/\u003e\\n&gt; LogToFile.recover(...)? \u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think I changed that part of the code. I see that an interrupt\u003cbr\\/\u003e\\nis just ignored there, so I think we can safely add a call to\u003cbr\\/\u003e\\n\\\"InterruptStatus.setInterrupted\\\" there as well, if that\'s what you\u003cbr\\/\u003e\\nmean. \u003c\\/p\u003e\\n\\n\u003cp\u003eGenerally I have just been concentrating on \\\"normal operation\\\" yet, so\u003cbr\\/\u003e\\nfar I haven\'t yet looked into things like replication, backup,\u003cbr\\/\u003e\\nexport\\/import, or even LOB\\/CLOB streams yet. I suspect there may be\u003cbr\\/\u003e\\nissues with interrupts happening during I\\/O in those areas as well.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Will change interrupt exception to statement\u003cbr\\/\u003e\\n&gt; level rather than session level require more code changes? Such as\u003cbr\\/\u003e\\n&gt; code in impl\\/store\\/raw\\/xact\\/* \u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t know that for sure, but I suspected it might, the cleanup on\u003cbr\\/\u003e\\nsession termination just seemed safer and in line with what we already did\u003cbr\\/\u003e\\nfor interrupt exceptions. More investigation needed.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I was just thinking statement level is more user friendly to\u003cbr\\/\u003e\\n&gt; application users.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I see that point. If we decide that\'s the way we would ultimately\u003cbr\\/\u003e\\nlike to go, I think I will still defer that to a next increment (maybe\u003cbr\\/\u003e\\na new JIRA issue?) of this work just to keep things simpler for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12921418_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921418_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Oct\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-15T16:00:10+0000\'\u003e15\\/Oct\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Lily, \\n\\n thanks again for looking at this   \\n\\n &gt; However, I run mailjdbc again the latest \\n&gt; derby-4741-nio-container+log+waits+locks+throws, the test run into \\n&gt; Error ERROR 40001: A lock could not be obtained due to a \\n&gt; deadlock. derby.log is attached for reference.  \\n\\n Yes, I saw that such lock errors too after about 18 hours of so. I am \\nnot yet sure they have anything to do with the patch changes, but I \\ncan\'t rule it out. I don\'t know the test app well enough. If you have \\nany insight here which would indicate that locks should not occur \\nunder normal operation, what would that be?  We could try to run the \\npatch without the changes I made to ActiveLock, ConcurrentLockSet and \\nLockSet, and see if the changes there have something to do with any \\nchange of behaviour.. \\n\\n &gt; Do we need \\n&gt; InterruptException on synchronized (slaveRecoveryMonitor) in \\n&gt; LogToFile.recover(...)?  \\n\\n I don\'t think I changed that part of the code. I see that an interrupt \\nis just ignored there, so I think we can safely add a call to \\n\\\"InterruptStatus.setInterrupted\\\" there as well, if that\'s what you \\nmean.  \\n\\n Generally I have just been concentrating on \\\"normal operation\\\" yet, so \\nfar I haven\'t yet looked into things like replication, backup, \\nexport\\/import, or even LOB\\/CLOB streams yet. I suspect there may be \\nissues with interrupts happening during I\\/O in those areas as well. \\n\\n &gt; Will change interrupt exception to statement \\n&gt; level rather than session level require more code changes? Such as \\n&gt; code in impl\\/store\\/raw\\/xact\\/*  \\n\\n I don\'t know that for sure, but I suspected it might, the cleanup on \\nsession termination just seemed safer and in line with what we already did \\nfor interrupt exceptions. More investigation needed. \\n\\n &gt; I was just thinking statement level is more user friendly to \\n&gt; application users. \\n\\n Yes, I see that point. If we decide that\'s the way we would ultimately \\nlike to go, I think I will still defer that to a next increment (maybe \\na new JIRA issue?) of this work just to keep things simpler for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12921420\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12921420&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12921420\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12921420_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921420_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Oct\\/10 16:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-15T16:06:40+0000\'\u003e15\\/Oct\\/10 16:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRunning a micro benchmark to test the effect for adding InterruptStatus.throwIf to the APIs\u003cbr\\/\u003e\\nwere a bit inconclusive. With the latest patch, using the attached MicroAPITest.java (ca 6-7 runs), I saw a ca 2.5 &amp; degradation of performance with just calls to ResultSet.next for a database that fits in memory.\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, just adding the InterruptStatus.throwIf calls to the API \u003cb\u003ewithout\u003c\\/b\u003e the rest of the patch seemed to have no significant effect, so perhaps there are other parts of the patch that had made the operation somewhat slower, I\'ll try to incrementally remove parts of the patch and see what I find.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12921420_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921420_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Oct\\/10 16:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-15T16:06:40+0000\'\u003e15\\/Oct\\/10 16:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Running a micro benchmark to test the effect for adding InterruptStatus.throwIf to the APIs \\nwere a bit inconclusive. With the latest patch, using the attached MicroAPITest.java (ca 6-7 runs), I saw a ca 2.5 &amp; degradation of performance with just calls to ResultSet.next for a database that fits in memory. \\n\\n However, just adding the InterruptStatus.throwIf calls to the API  without  the rest of the patch seemed to have no significant effect, so perhaps there are other parts of the patch that had made the operation somewhat slower, I\'ll try to incrementally remove parts of the patch and see what I find.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12921740\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12921740&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12921740\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12921740_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921740_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/10 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-16T19:23:46+0000\'\u003e16\\/Oct\\/10 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve also tried the micro benchmark, but got somewhat different results. In 20 runs with a clean trunk and 20 runs with the derby-4741-nio-container+log+waits+locks+throws.diff patch in random order, clean trunk was on average 8.5% faster than the patched version (3.64 s\\/query vs 3.95 s\\/query).\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran the experiment with insane jars on OpenSolaris 2010.05 snv_134b and Java 1.6.0_18, and I had upped derby.storage.pageCacheSize to 12500.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12921740_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921740_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/10 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-16T19:23:46+0000\'\u003e16\\/Oct\\/10 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve also tried the micro benchmark, but got somewhat different results. In 20 runs with a clean trunk and 20 runs with the derby-4741-nio-container+log+waits+locks+throws.diff patch in random order, clean trunk was on average 8.5% faster than the patched version (3.64 s\\/query vs 3.95 s\\/query). \\n\\n I ran the experiment with insane jars on OpenSolaris 2010.05 snv_134b and Java 1.6.0_18, and I had upped derby.storage.pageCacheSize to 12500.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12921764\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12921764&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12921764\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12921764_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921764_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/10 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-16T21:35:55+0000\'\u003e16\\/Oct\\/10 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the important finding. The result is hard on issues to keep Derby stand out from other Java database. I humbly believe Derby will keep on shining if performance can keep on improving. Do you have any suggestion in turn of fixing thread interrupts and keep performance no less than 3% slower than current clean trunk?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12921764_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921764_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Oct\\/10 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-16T21:35:55+0000\'\u003e16\\/Oct\\/10 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the important finding. The result is hard on issues to keep Derby stand out from other Java database. I humbly believe Derby will keep on shining if performance can keep on improving. Do you have any suggestion in turn of fixing thread interrupts and keep performance no less than 3% slower than current clean trunk?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12921987\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12921987&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12921987\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12921987_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921987_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Oct\\/10 07:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-18T07:11:28+0000\'\u003e18\\/Oct\\/10 07:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOops... Clean trunk wasn\'t 8.5% faster than the patched version. It was 7.8% faster. What I should have said, was that the patched version was 8.5% slower than clean trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran the micro benchmark through a profiler, but I didn\'t see anything there to explain a ~8% degradation. I did see more time spent in ThreadLocal.get() (no surprise there...), but only enough to explain one or two percent, roughly what Dag saw. I\'ll try to dig a little more.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12921987_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12921987_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Oct\\/10 07:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-18T07:11:28+0000\'\u003e18\\/Oct\\/10 07:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oops... Clean trunk wasn\'t 8.5% faster than the patched version. It was 7.8% faster. What I should have said, was that the patched version was 8.5% slower than clean trunk. \\n\\n I ran the micro benchmark through a profiler, but I didn\'t see anything there to explain a ~8% degradation. I did see more time spent in ThreadLocal.get() (no surprise there...), but only enough to explain one or two percent, roughly what Dag saw. I\'ll try to dig a little more.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12922096\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12922096&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12922096\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922096_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922096_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Oct\\/10 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-18T15:05:01+0000\'\u003e18\\/Oct\\/10 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 18\\/Oct\\/10 15:06\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for doing more measurements, Knut! It seems that even in the best case, the movePostion operation is negatively impacted with 1-2% due to the ThreadLocal access, which is not desirable.\u003c\\/p\u003e\\n\\n\u003cp\u003eKnut mentioned that ContextService is already based on a ThreadLocal. I checked around a bit and found that we might be able to get rid of the InterruptStatus thread local check in the API methods in this way:\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we were able to retrieve the lcc at the point where we detect the interrupts and save this fact in the lcc at that time, the cost of accessing a ThreadLocal variable would not be incurred unless AN INTERRUPT ACTUALLY HAPPENED.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the API methods, lcc is already available, and checking a boolean flag in the lcc instead of calling InterruptStatus#throwIf (which accesses a thread local) would be much cheaper.  I see we already sometimes do dig out the lcc in store level code, e.g. in store.access.DiskHashtable, in this way:\u003c\\/p\u003e\\n\\n\u003cp\u003e    LanguageConnectionContext lcc   = (LanguageConnectionContext)\u003cbr\\/\u003e\\n            ContextService.getContextOrNull(      \\/\\/ this call accesses a ThreadLocal\u003cbr\\/\u003e\\n                LanguageConnectionContext.CONTEXT_ID);\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll look into this approach a bit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922096_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922096_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Oct\\/10 15:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-18T15:05:01+0000\'\u003e18\\/Oct\\/10 15:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 18\\/Oct\\/10 15:06\\\"\u003eedited\u003c\\/span\u003e                   Thanks for doing more measurements, Knut! It seems that even in the best case, the movePostion operation is negatively impacted with 1-2% due to the ThreadLocal access, which is not desirable. \\n\\n Knut mentioned that ContextService is already based on a ThreadLocal. I checked around a bit and found that we might be able to get rid of the InterruptStatus thread local check in the API methods in this way: \\n\\n If we were able to retrieve the lcc at the point where we detect the interrupts and save this fact in the lcc at that time, the cost of accessing a ThreadLocal variable would not be incurred unless AN INTERRUPT ACTUALLY HAPPENED. \\n\\n In the API methods, lcc is already available, and checking a boolean flag in the lcc instead of calling InterruptStatus#throwIf (which accesses a thread local) would be much cheaper.  I see we already sometimes do dig out the lcc in store level code, e.g. in store.access.DiskHashtable, in this way: \\n\\n     LanguageConnectionContext lcc   = (LanguageConnectionContext) \\n            ContextService.getContextOrNull(      \\/\\/ this call accesses a ThreadLocal \\n                LanguageConnectionContext.CONTEXT_ID); \\n\\n I\'ll look into this approach a bit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12922362\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12922362&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12922362\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922362_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922362_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Oct\\/10 23:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-18T23:48:46+0000\'\u003e18\\/Oct\\/10 23:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe approach seems to work. This should take care of the performance worries for using InterruptStatus#throwIf in API methods.\u003c\\/p\u003e\\n\\n\u003cp\u003eSometimes there is no lcc, e.g when creating a new database; we could then fall back on the dedicated thread local variable, cf. during EmbedConnection constructor\'s call to createDatabase.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother note: undo is still vulnerable, e.g. an interrupt during rollback, usage of StorageRandomAccessFile in cf. Scan.java, cf.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------  BEGIN SHUTDOWN ERROR STACK -------------\u003c\\/p\u003e\\n\\n\u003cp\u003eERROR XSLA3: Log Corrupted, has invalid data in the log stream.\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:279)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.log.Scan.getNextRecord(Scan.java:216)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.log.FileLogger.undo(FileLogger.java:939)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.xact.Xact.abort(Xact.java:949)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.xact.XactContext.cleanupOnError(XactContext.java:119)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:333)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2277)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1325)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1683)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:305)\u003cbr\\/\u003e\\n\\tat InterruptTest$WorkerThread.run(InterruptTest.java:263)\u003cbr\\/\u003e\\nCaused by: java.io.InterruptedIOException\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.read(Native Method)\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.readInt(RandomAccessFile.java:721)\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.readLong(RandomAccessFile.java:758)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.log.Scan.getNextRecordBackward(Scan.java:394)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.log.Scan.getNextRecord(Scan.java:204)\u003c\\/p\u003e\\n\\n\u003cp\u003e(roll-back happens here due to the test trying to insert a duplicate after a commit has been interrupted)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922362_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922362_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Oct\\/10 23:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-18T23:48:46+0000\'\u003e18\\/Oct\\/10 23:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The approach seems to work. This should take care of the performance worries for using InterruptStatus#throwIf in API methods. \\n\\n Sometimes there is no lcc, e.g when creating a new database; we could then fall back on the dedicated thread local variable, cf. during EmbedConnection constructor\'s call to createDatabase. \\n\\n Another note: undo is still vulnerable, e.g. an interrupt during rollback, usage of StorageRandomAccessFile in cf. Scan.java, cf. \\n\\n ------------  BEGIN SHUTDOWN ERROR STACK ------------- \\n\\n ERROR XSLA3: Log Corrupted, has invalid data in the log stream. \\n\\tat org.apache.derby.iapi.error.StandardException.newException(StandardException.java:279) \\n\\tat org.apache.derby.impl.store.raw.log.Scan.getNextRecord(Scan.java:216) \\n\\tat org.apache.derby.impl.store.raw.log.FileLogger.undo(FileLogger.java:939) \\n\\tat org.apache.derby.impl.store.raw.xact.Xact.abort(Xact.java:949) \\n\\tat org.apache.derby.impl.store.raw.xact.XactContext.cleanupOnError(XactContext.java:119) \\n\\tat org.apache.derby.iapi.services.context.ContextManager.cleanupOnError(ContextManager.java:333) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.cleanupOnError(TransactionResourceImpl.java:419) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:337) \\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2277) \\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1325) \\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(EmbedPreparedStatement.java:1683) \\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeUpdate(EmbedPreparedStatement.java:305) \\n\\tat InterruptTest$WorkerThread.run(InterruptTest.java:263) \\nCaused by: java.io.InterruptedIOException \\n\\tat java.io.RandomAccessFile.read(Native Method) \\n\\tat java.io.RandomAccessFile.readInt(RandomAccessFile.java:721) \\n\\tat java.io.RandomAccessFile.readLong(RandomAccessFile.java:758) \\n\\tat org.apache.derby.impl.store.raw.log.Scan.getNextRecordBackward(Scan.java:394) \\n\\tat org.apache.derby.impl.store.raw.log.Scan.getNextRecord(Scan.java:204) \\n\\n (roll-back happens here due to the test trying to insert a duplicate after a commit has been interrupted)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12922370\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12922370&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12922370\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922370_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922370_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Oct\\/10 00:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-19T00:01:12+0000\'\u003e19\\/Oct\\/10 00:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnd we are vulnerable during (re)boot:\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.sql.SQLException: Failed to start database \'interrupttest\' with class loader sun.misc.Launcher$AppClassLoader@2bbd86, see the next exception for details.\u003cbr\\/\u003e\\n       :\u003cbr\\/\u003e\\nCaused by: java.sql.SQLException: Failed to start database \'interrupttest\' with class loader sun.misc.Launcher$AppClassLoader@2bbd86, see the next exception for details.\u003cbr\\/\u003e\\n       :\u003cbr\\/\u003e\\nCaused by: java.sql.SQLException: Java exception: \': java.io.InterruptedIOException\'.\u003cbr\\/\u003e\\n       :\u003cbr\\/\u003e\\nCaused by: java.io.InterruptedIOException\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.readBytes(Native Method)\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.read(RandomAccessFile.java:322)\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:381)\u003cbr\\/\u003e\\n\\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:361)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.log.LogToFile.readControlFile(LogToFile.java:2693)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.log.LogToFile.boot(LogToFile.java:3398)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:572)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.bootLogFactory(BaseDataFileFactory.java:1747)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.setRawStoreFactory(BaseDataFileFactory.java:1235)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:223)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:572)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:572)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:760)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:193)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1857)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1723)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1601)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:1020)\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:550)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2679)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922370_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922370_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Oct\\/10 00:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-19T00:01:12+0000\'\u003e19\\/Oct\\/10 00:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    And we are vulnerable during (re)boot: \\n\\n java.sql.SQLException: Failed to start database \'interrupttest\' with class loader sun.misc.Launcher$AppClassLoader@2bbd86, see the next exception for details. \\n       : \\nCaused by: java.sql.SQLException: Failed to start database \'interrupttest\' with class loader sun.misc.Launcher$AppClassLoader@2bbd86, see the next exception for details. \\n       : \\nCaused by: java.sql.SQLException: Java exception: \': java.io.InterruptedIOException\'. \\n       : \\nCaused by: java.io.InterruptedIOException \\n\\tat java.io.RandomAccessFile.readBytes(Native Method) \\n\\tat java.io.RandomAccessFile.read(RandomAccessFile.java:322) \\n\\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:381) \\n\\tat java.io.RandomAccessFile.readFully(RandomAccessFile.java:361) \\n\\tat org.apache.derby.impl.store.raw.log.LogToFile.readControlFile(LogToFile.java:2693) \\n\\tat org.apache.derby.impl.store.raw.log.LogToFile.boot(LogToFile.java:3398) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020) \\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:572) \\n\\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427) \\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.bootLogFactory(BaseDataFileFactory.java:1747) \\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.setRawStoreFactory(BaseDataFileFactory.java:1235) \\n\\tat org.apache.derby.impl.store.raw.RawStore.boot(RawStore.java:223) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020) \\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:572) \\n\\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427) \\n\\tat org.apache.derby.impl.store.access.RAMAccessManager.boot(RAMAccessManager.java:1019) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020) \\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startModule(BaseMonitor.java:572) \\n\\tat org.apache.derby.iapi.services.monitor.Monitor.bootServiceModule(Monitor.java:427) \\n\\tat org.apache.derby.impl.db.BasicDatabase.bootStore(BasicDatabase.java:760) \\n\\tat org.apache.derby.impl.db.BasicDatabase.boot(BasicDatabase.java:193) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.boot(BaseMonitor.java:2020) \\n\\tat org.apache.derby.impl.services.monitor.TopService.bootModule(TopService.java:333) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.bootService(BaseMonitor.java:1857) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startProviderService(BaseMonitor.java:1723) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.findProviderAndStartService(BaseMonitor.java:1601) \\n\\tat org.apache.derby.impl.services.monitor.BaseMonitor.startPersistentService(BaseMonitor.java:1020) \\n\\tat org.apache.derby.iapi.services.monitor.Monitor.startPersistentService(Monitor.java:550) \\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.bootDatabase(EmbedConnection.java:2679)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12922716\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12922716&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12922716\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922716_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922716_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Oct\\/10 21:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-19T21:03:55+0000\'\u003e19\\/Oct\\/10 21:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI feel pretty confident the main approach will improve things  by now, so I\'ll upload a final version of the experimental patch, and the start producing incremental patches for commit roughly in the following order:\u003c\\/p\u003e\\n\\n\u003cp\u003ea) hooks in the APIs to resurrect interrupt flags before we return to the user\'s app on the basis of info collected during operation, the new util class InterruptStatus, which is a collection of methods to save away and resurrect interrupt flags, and throw an interrupt SQLexception. I intend to \u003cb\u003enot\u003c\\/b\u003e throw any exception if the API method ran to completion, just resurrect the flag.\u003cbr\\/\u003e\\nb) the modified RAFContainer4 stuff for reading and writing db cache pages safely with NIO.\u003cbr\\/\u003e\\nc) the modified DirRandomAccessFile4 stuff + log retries for safe operation of log writing\u003cbr\\/\u003e\\nd) stop execution if intr seen within a batch, when checking query timeout, and when seeing intr while waiting for locks\u003cbr\\/\u003e\\ne) make undo safe\u003cbr\\/\u003e\\nf) time permitting, make boot and recovery interrupt safe.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlease let me know if there any objections or suggestions to this plan! Whether all this gets ready for 10.7 is a possible issue, but hopefully we should not behave worse the before at any step.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922716_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922716_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Oct\\/10 21:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-19T21:03:55+0000\'\u003e19\\/Oct\\/10 21:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I feel pretty confident the main approach will improve things  by now, so I\'ll upload a final version of the experimental patch, and the start producing incremental patches for commit roughly in the following order: \\n\\n a) hooks in the APIs to resurrect interrupt flags before we return to the user\'s app on the basis of info collected during operation, the new util class InterruptStatus, which is a collection of methods to save away and resurrect interrupt flags, and throw an interrupt SQLexception. I intend to  not  throw any exception if the API method ran to completion, just resurrect the flag. \\nb) the modified RAFContainer4 stuff for reading and writing db cache pages safely with NIO. \\nc) the modified DirRandomAccessFile4 stuff + log retries for safe operation of log writing \\nd) stop execution if intr seen within a batch, when checking query timeout, and when seeing intr while waiting for locks \\ne) make undo safe \\nf) time permitting, make boot and recovery interrupt safe. \\n\\n Please let me know if there any objections or suggestions to this plan! Whether all this gets ready for 10.7 is a possible issue, but hopefully we should not behave worse the before at any step. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12922766\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12922766&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12922766\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922766_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922766_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Oct\\/10 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-19T22:48:15+0000\'\u003e19\\/Oct\\/10 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA final version of the experimental patch, derby-4741-all+lenient+resurrect uploaded.\u003cbr\\/\u003e\\nMain changes:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003euse lcc to store interrupt status for a session thread. If not available fall back on a thread local.\u003c\\/li\u003e\\n\\t\u003cli\u003eresurrect the interrupt flag before returning to user app always, if we throw or not (see next item)\u003c\\/li\u003e\\n\\t\u003cli\u003edon\'t throw if an API operation ran to completion without trouble, even if we did see an interrupt flag\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe ad hoc InterruptTest and JUnit Derby151Test should run OK on both Solaris and Windows now.\u003cbr\\/\u003e\\nThe internal behavior is somewhat different since the JRE on Solaris throws InterrupedIOException in more cases, cf. \u003ca href=\\\"http:\\/\\/bugs.sun.com\\/bugdatabase\\/view_bug.do?bug_id=4385444\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/bugs.sun.com\\/bugdatabase\\/view_bug.do?bug_id=4385444\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12922766_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12922766_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Oct\\/10 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-19T22:48:15+0000\'\u003e19\\/Oct\\/10 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A final version of the experimental patch, derby-4741-all+lenient+resurrect uploaded. \\nMain changes: \\n \\n\\t use lcc to store interrupt status for a session thread. If not available fall back on a thread local. \\n\\t resurrect the interrupt flag before returning to user app always, if we throw or not (see next item) \\n\\t don\'t throw if an API operation ran to completion without trouble, even if we did see an interrupt flag \\n \\n\\n\\n The ad hoc InterruptTest and JUnit Derby151Test should run OK on both Solaris and Windows now. \\nThe internal behavior is somewhat different since the JRE on Solaris throws InterrupedIOException in more cases, cf.  http:\\/\\/bugs.sun.com\\/bugdatabase\\/view_bug.do?bug_id=4385444 . \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12923238\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12923238&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12923238\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12923238_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923238_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Oct\\/10 23:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-20T23:44:51+0000\'\u003e20\\/Oct\\/10 23:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 20\\/Oct\\/10 23:50\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNote to self: I have found a problem with the interrupt recovery of\u003cbr\\/\u003e\\nRAFContainer4. Its call to openContainer needs to be protected by the\u003cbr\\/\u003e\\nmonitor on FileContainer#allocCache, because opening a container\u003cbr\\/\u003e\\nevetually leads to a call on AllocationCache#reset. AllocCache javadoc\u003cbr\\/\u003e\\nstates that the the callers need to synchronize themselves since it is\u003cbr\\/\u003e\\nitself not MT safe. \u003c\\/p\u003e\\n\\n\u003cp\u003eThreads inside RAFContainer4#\u003c\\/p\u003e\\n{readPage, writePage}\\n\u003cp\u003e do not necessarily\u003cbr\\/\u003e\\nown this monitor when recovery is attempted.\u003c\\/p\u003e\\n\\n\u003cp\u003eI did once see a race condition due to this.  In the race condition, a\u003cbr\\/\u003e\\nthread was trying to write to a new page and got a array out of bounds\u003cbr\\/\u003e\\nexception inside AllocationCache.validate (numExtents was suddenly back to 0)\u003cbr\\/\u003e\\nbecause another thread was doing interrupt recovery by calling\u003cbr\\/\u003e\\nRAFContainer4#recoverContainerAfterInterrupt -&gt;\u003cbr\\/\u003e\\nopenContainer -&gt; ... -&gt; AllocationCache#reset (unprotected).\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;edit add&#93;\u003c\\/span\u003e:\u003cbr\\/\u003e\\nSimply enveloping recoverContainerAfterInterrupt\'s call to openContainer in synchronized(allocCache) won\'t work: can lead to deadlock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12923238_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923238_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Oct\\/10 23:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-20T23:44:51+0000\'\u003e20\\/Oct\\/10 23:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 20\\/Oct\\/10 23:50\\\"\u003eedited\u003c\\/span\u003e                   Note to self: I have found a problem with the interrupt recovery of \\nRAFContainer4. Its call to openContainer needs to be protected by the \\nmonitor on FileContainer#allocCache, because opening a container \\nevetually leads to a call on AllocationCache#reset. AllocCache javadoc \\nstates that the the callers need to synchronize themselves since it is \\nitself not MT safe.  \\n\\n Threads inside RAFContainer4# \\n{readPage, writePage}\\n  do not necessarily \\nown this monitor when recovery is attempted. \\n\\n I did once see a race condition due to this.  In the race condition, a \\nthread was trying to write to a new page and got a array out of bounds \\nexception inside AllocationCache.validate (numExtents was suddenly back to 0) \\nbecause another thread was doing interrupt recovery by calling \\nRAFContainer4#recoverContainerAfterInterrupt -&gt; \\nopenContainer -&gt; ... -&gt; AllocationCache#reset (unprotected). \\n\\n  &#91;edit add&#93; : \\nSimply enveloping recoverContainerAfterInterrupt\'s call to openContainer in synchronized(allocCache) won\'t work: can lead to deadlock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12923367\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12923367&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12923367\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12923367_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923367_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/10 08:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-21T08:44:21+0000\'\u003e21\\/Oct\\/10 08:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran MicroAPITest with derby-4741-all+lenient+resurrect.diff (20 runs with each configuration, insane jars, pageCacheSize=12500). Now I only see a 1% degradation with the patch (p-value=0.07, according to the student t calculator at \u003ca href=\\\"http:\\/\\/www.bio.miami.edu\\/rob\\/Students_t.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.bio.miami.edu\\/rob\\/Students_t.html\u003c\\/a\u003e), so that definitely looks like a good improvement from the previous patch. I also modified the test so that it reused existing test data instead of creating it on every run. Then I didn\'t see any degradation. In fact, the results with the patch were 0.5% better than trunk when I ran the test that way.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also saw something similar with the previous patch. I saw an 8% degradation with the unmodified test, but the degradation was only about 2% with the modified test. This is also consistent with the findings Dag posted in the comment dated 15\\/Oct\\/10 12:06 PM, where he saw that the full patch gave a 2.5% degradation, whereas if he only applied the parts of the patch that were actually exercised during the data collection phase of the test, he didn\'t see any degradation.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t know why the changes in the test setup code alters the result this way. The part of the test where we collect results should exercise the exact same code path with the two variants of the test. This reminds me of the effects we saw in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4233\\\" title=\\\"Lower tablescan performance right after database creation in 10.5\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4233\\\"\u003e\u003cdel\u003eDERBY-4233\u003c\\/del\u003e\u003c\\/a\u003e, which were attributed to JIT at that time. I think the theory at that time was something like this: The just-in-time compiler collects statistics before it compiles the code and uses the statistics to optimize the generated native code. The more time we spend in the test setup code, the more the statistics will be biased towards the setup code. For this test, that could mean that the JIT-compiled native code is optimized for the insert code path, whereas we\'re really only interested in the select code path in the test. Furthermore, since the patch changes code on the insert code path, the collected statistics and the chosen optimizations may change, and that may ultimately affect how the select code is optimized, even if the select code path barely has been touched by the patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12923367_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923367_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/10 08:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-21T08:44:21+0000\'\u003e21\\/Oct\\/10 08:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran MicroAPITest with derby-4741-all+lenient+resurrect.diff (20 runs with each configuration, insane jars, pageCacheSize=12500). Now I only see a 1% degradation with the patch (p-value=0.07, according to the student t calculator at  http:\\/\\/www.bio.miami.edu\\/rob\\/Students_t.html ), so that definitely looks like a good improvement from the previous patch. I also modified the test so that it reused existing test data instead of creating it on every run. Then I didn\'t see any degradation. In fact, the results with the patch were 0.5% better than trunk when I ran the test that way. \\n\\n I also saw something similar with the previous patch. I saw an 8% degradation with the unmodified test, but the degradation was only about 2% with the modified test. This is also consistent with the findings Dag posted in the comment dated 15\\/Oct\\/10 12:06 PM, where he saw that the full patch gave a 2.5% degradation, whereas if he only applied the parts of the patch that were actually exercised during the data collection phase of the test, he didn\'t see any degradation. \\n\\n I don\'t know why the changes in the test setup code alters the result this way. The part of the test where we collect results should exercise the exact same code path with the two variants of the test. This reminds me of the effects we saw in   DERBY-4233  , which were attributed to JIT at that time. I think the theory at that time was something like this: The just-in-time compiler collects statistics before it compiles the code and uses the statistics to optimize the generated native code. The more time we spend in the test setup code, the more the statistics will be biased towards the setup code. For this test, that could mean that the JIT-compiled native code is optimized for the insert code path, whereas we\'re really only interested in the select code path in the test. Furthermore, since the patch changes code on the insert code path, the collected statistics and the chosen optimizations may change, and that may ultimately affect how the select code is optimized, even if the select code path barely has been touched by the patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12923457\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12923457&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12923457\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12923457_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923457_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/10 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-21T14:31:37+0000\'\u003e21\\/Oct\\/10 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI can confirm Knut\'s number for MicroAPITest .java in turn of 1-3% degradation or some case better with the derby-4741-all+lenient+resurrect.diff patch. Thanks for all the great work, Dag. A lot of customers will benefit from this.  Wow!!!\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems like we will throw an error back to the caller indicate they are the one generating the interrupt and we will throw an error in the case of an interrupt during a lock wait with this new approach. Will you elaborate on that in turn of the new patch behavior please? I am still having trouble understand the data flow perspective and would like to see some write out in turn of what exact error I will see from Derby . \u003c\\/p\u003e\\n\\n\u003cp\u003eThis is one of the comments you wrote to me. Sorry for getting back to you promptly.\u003cbr\\/\u003e\\n&gt;&gt; Do we need  InterruptException on synchronized (slaveRecoveryMonitor) in \u003cbr\\/\u003e\\n&gt;&gt; LogToFile.recover(...)? \u003cbr\\/\u003e\\n&gt;I don\'t think I changed that part of the code. I see that an interrupt \u003cbr\\/\u003e\\n&gt;is just ignored there, so I think we can safely add a call to \u003cbr\\/\u003e\\n&gt;\\\"InterruptStatus.setInterrupted\\\" there as well, if that\'s what you \u003cbr\\/\u003e\\n&gt;mean.\u003cbr\\/\u003e\\nYes, this is what I mean. And, I add it to my client space and run some tests. It seems not harming anything. I know you are concentrating on \\\"normal operation\\\" and it is \u003cb\u003ereally\u003c\\/b\u003e a lot of work. Will we add a note somewhere about the code not cover for this interrupt handling? Such as: backup, \u003cbr\\/\u003e\\nexport\\/import, LOB\\/CLOB streams and replication for during I\\/O in those areas as well.\u003c\\/p\u003e\\n\\n\u003cp\u003eI run Suites.all on windows and it is looking better than ever!!!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12923457_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923457_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/10 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-21T14:31:37+0000\'\u003e21\\/Oct\\/10 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I can confirm Knut\'s number for MicroAPITest .java in turn of 1-3% degradation or some case better with the derby-4741-all+lenient+resurrect.diff patch. Thanks for all the great work, Dag. A lot of customers will benefit from this.  Wow!!! \\n\\n It seems like we will throw an error back to the caller indicate they are the one generating the interrupt and we will throw an error in the case of an interrupt during a lock wait with this new approach. Will you elaborate on that in turn of the new patch behavior please? I am still having trouble understand the data flow perspective and would like to see some write out in turn of what exact error I will see from Derby .  \\n\\n This is one of the comments you wrote to me. Sorry for getting back to you promptly. \\n&gt;&gt; Do we need  InterruptException on synchronized (slaveRecoveryMonitor) in  \\n&gt;&gt; LogToFile.recover(...)?  \\n&gt;I don\'t think I changed that part of the code. I see that an interrupt  \\n&gt;is just ignored there, so I think we can safely add a call to  \\n&gt;\\\"InterruptStatus.setInterrupted\\\" there as well, if that\'s what you  \\n&gt;mean. \\nYes, this is what I mean. And, I add it to my client space and run some tests. It seems not harming anything. I know you are concentrating on \\\"normal operation\\\" and it is  really  a lot of work. Will we add a note somewhere about the code not cover for this interrupt handling? Such as: backup,  \\nexport\\/import, LOB\\/CLOB streams and replication for during I\\/O in those areas as well. \\n\\n I run Suites.all on windows and it is looking better than ever!!!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12923678\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12923678&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12923678\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12923678_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923678_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/10 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-21T22:48:09+0000\'\u003e21\\/Oct\\/10 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHei Lily, thanks for your continued interest in this issue!\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Will you elaborate on that in turn of the new patch behavior please?\u003c\\/p\u003e\\n\\n\u003cp\u003eMy present thinking is that the goal should be:\u003cbr\\/\u003e\\n   a) the best user experience will be that for operations\u003cbr\\/\u003e\\n      (technically JDBC API calls), which detect an interrupt, but\u003cbr\\/\u003e\\n      manage to retry and continue the operation, and for which we do\u003cbr\\/\u003e\\n      not cut the operation short, because there is no natural\u003cbr\\/\u003e\\n      point at which to interrupt it, or we deem it to be so short in\u003cbr\\/\u003e\\n      duration that we might as well see it through, we:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003edo not throw an exception\u003c\\/li\u003e\\n\\t\u003cli\u003erestore the interruped status flag just prior to return from\u003cbr\\/\u003e\\n        the operation (JDBC API call)\u003cbr\\/\u003e\\n   b) for operations that we actually cut short due to the interrupt,\u003cbr\\/\u003e\\n      see current enumeration below, we\u003c\\/li\u003e\\n\\t\u003cli\u003ethrow SQLException 08000, session level (we might change this\u003cbr\\/\u003e\\n        severity later as discussed)\u003c\\/li\u003e\\n\\t\u003cli\u003ealso resurrect the interrupt status flag just prior to return\u003cbr\\/\u003e\\n        from the operation (JDBC API call)\u003cbr\\/\u003e\\n   c) for operations, which detect an interrupt, but\u003cbr\\/\u003e\\n      manage to retry and continue the operation, but eventually throw\u003cbr\\/\u003e\\n      an SQLException (not 08000, some other), we do as in a):\u003c\\/li\u003e\\n\\t\u003cli\u003erestore the interruped status flag just prior to return from\u003cbr\\/\u003e\\n        the operation (JDBC API call)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e   d) Operations that we  may currently cut short if we see an interrupt\u003cbr\\/\u003e\\n      early enough:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eexecuteBatch (we check between each statement)\u003c\\/li\u003e\\n\\t\u003cli\u003eexecuteQuery (we check in the present\u003cbr\\/\u003e\\n        BasicNoPutResultSetImpl#checkCancellationFlag in the same\u003cbr\\/\u003e\\n        location that we check for timeout currently)\u003c\\/li\u003e\\n\\t\u003cli\u003ewhile waiting for a lock, cf. LockSet.java,\u003cbr\\/\u003e\\n        ConcurrentLockSet.java\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eFurther suggestions for good places to check and throw are welcome \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; .. synchronized (slaveRecoveryMonitor): And, I add it to my client\u003cbr\\/\u003e\\n&gt; space and run some tests. It seems not harming anything.\u003c\\/p\u003e\\n\\n\u003cp\u003eGood, we\'ll add it then.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Will we add a note somewhere about the code not cover for this\u003cbr\\/\u003e\\n&gt; interrupt handling? \u003c\\/p\u003e\\n\\n\u003cp\u003eFor the time being, we can make notes in this JIRA issue, but\u003cbr\\/\u003e\\neventually I suspect we will want to make a release note to describe\u003cbr\\/\u003e\\nthe improvements, and what remains to be done. You are right that\u003cbr\\/\u003e\\nthere is a lot of work, it is also hard to test, unfortunately.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12923678_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923678_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Oct\\/10 22:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-21T22:48:09+0000\'\u003e21\\/Oct\\/10 22:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hei Lily, thanks for your continued interest in this issue! \\n\\n &gt; Will you elaborate on that in turn of the new patch behavior please? \\n\\n My present thinking is that the goal should be: \\n   a) the best user experience will be that for operations \\n      (technically JDBC API calls), which detect an interrupt, but \\n      manage to retry and continue the operation, and for which we do \\n      not cut the operation short, because there is no natural \\n      point at which to interrupt it, or we deem it to be so short in \\n      duration that we might as well see it through, we: \\n \\n\\t do not throw an exception \\n\\t restore the interruped status flag just prior to return from \\n        the operation (JDBC API call) \\n   b) for operations that we actually cut short due to the interrupt, \\n      see current enumeration below, we \\n\\t throw SQLException 08000, session level (we might change this \\n        severity later as discussed) \\n\\t also resurrect the interrupt status flag just prior to return \\n        from the operation (JDBC API call) \\n   c) for operations, which detect an interrupt, but \\n      manage to retry and continue the operation, but eventually throw \\n      an SQLException (not 08000, some other), we do as in a): \\n\\t restore the interruped status flag just prior to return from \\n        the operation (JDBC API call) \\n \\n\\n\\n    d) Operations that we  may currently cut short if we see an interrupt \\n      early enough: \\n \\n\\t executeBatch (we check between each statement) \\n\\t executeQuery (we check in the present \\n        BasicNoPutResultSetImpl#checkCancellationFlag in the same \\n        location that we check for timeout currently) \\n\\t while waiting for a lock, cf. LockSet.java, \\n        ConcurrentLockSet.java \\n \\n\\n\\n Further suggestions for good places to check and throw are welcome   \\n\\n &gt; .. synchronized (slaveRecoveryMonitor): And, I add it to my client \\n&gt; space and run some tests. It seems not harming anything. \\n\\n Good, we\'ll add it then. \\n\\n &gt; Will we add a note somewhere about the code not cover for this \\n&gt; interrupt handling?  \\n\\n For the time being, we can make notes in this JIRA issue, but \\neventually I suspect we will want to make a release note to describe \\nthe improvements, and what remains to be done. You are right that \\nthere is a lot of work, it is also hard to test, unfortunately.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12923955\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12923955&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12923955\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12923955_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923955_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Oct\\/10 18:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-22T18:25:59+0000\'\u003e22\\/Oct\\/10 18:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 22\\/Oct\\/10 18:28\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a first rev of a patch for part a): derby-4741-a-01-api-interruptstatus\u003cbr\\/\u003e\\nRegressions ran ok modulo a hang in BootLockTest.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch contains the new helper class InterruptStatus and inserts calls to\u003cbr\\/\u003e\\nrestoreIntrFlagIfSeen in before API methods\' return and in the exception handling (TransactionResourceImpl#handleException).\u003c\\/p\u003e\\n\\n\u003cp\u003eExecution of EmbedStatement#executeBatch check of interrupts and throws 08000 if seen between each statement in the batch.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote: Still, the machinery of InterruptStatus isn\'t used to save any interrupts, that follows in a later patch, so this patch doesn\'t change behavior. The focus here is on the correct placement of calls to\u003cbr\\/\u003e\\nrestoreIntrFlagIfSeen in the API.  Reviews appreciated!\u003c\\/p\u003e\\n\\n\u003cp\u003e------------------------ Patch details:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eiapi.util.InterruptStatus: new helper class for keeping track of detected and\u003cbr\\/\u003e\\n  postponed interrupts. See also its Javadoc.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eLanguageConnectionContext\u003cbr\\/\u003e\\n  GenericLanguageConnectionContext: \u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  Methods to set\\/reset threads interrupt status flag to allow us to clear the thread\'s actual flag temporarily, and to reset it when we return to the user application, possibly by throwing an interrupted SQLException (SQL state 08000) if we cut something short. It also contains methods to save and retrieve the stack frame at the point an interrupt was detected. This is used when we throw the interrupt exception. \u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eTransactionResourceImpl: resurrect the thread\'s interrupt status flag on SQL error (called from handleException). Use lcc if available, else thread local variable.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEmbedBlob, for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEmbedResultSet: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEmbedStatment: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  In executeBatch, use throwIf between each statement in the batch: if we saw an interrupt, stop execution of batch. Note that if we do throw, restoreIntrFlagIfSeen will be called in the finally block, but it is idempotent, so no harm is done. It is necessary in case we saw an interrupt in the last statement of the batch.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEmbedDatabaseMetaData: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEmbedPreparedStatement: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eEmbedConnection.java: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  For createDatabase, use InterruptStatus.restoreIntrFlagIfSeen() which inspects the thread local variable. This should catch I\\/O interrupts seen during the database creation phase.\u003c\\/p\u003e\\n\\n\u003cp\u003e  Special handling in #close to make sure we access lcc while it is still available.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12923955_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12923955_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Oct\\/10 18:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-22T18:25:59+0000\'\u003e22\\/Oct\\/10 18:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 22\\/Oct\\/10 18:28\\\"\u003eedited\u003c\\/span\u003e                   Uploading a first rev of a patch for part a): derby-4741-a-01-api-interruptstatus \\nRegressions ran ok modulo a hang in BootLockTest. \\n\\n This patch contains the new helper class InterruptStatus and inserts calls to \\nrestoreIntrFlagIfSeen in before API methods\' return and in the exception handling (TransactionResourceImpl#handleException). \\n\\n Execution of EmbedStatement#executeBatch check of interrupts and throws 08000 if seen between each statement in the batch. \\n\\n Note: Still, the machinery of InterruptStatus isn\'t used to save any interrupts, that follows in a later patch, so this patch doesn\'t change behavior. The focus here is on the correct placement of calls to \\nrestoreIntrFlagIfSeen in the API.  Reviews appreciated! \\n\\n ------------------------ Patch details: \\n\\n \\n\\t iapi.util.InterruptStatus: new helper class for keeping track of detected and \\n  postponed interrupts. See also its Javadoc. \\n \\n\\n\\n \\n\\t LanguageConnectionContext \\n  GenericLanguageConnectionContext:  \\n \\n\\n\\n   Methods to set\\/reset threads interrupt status flag to allow us to clear the thread\'s actual flag temporarily, and to reset it when we return to the user application, possibly by throwing an interrupted SQLException (SQL state 08000) if we cut something short. It also contains methods to save and retrieve the stack frame at the point an interrupt was detected. This is used when we throw the interrupt exception.  \\n\\n \\n\\t TransactionResourceImpl: resurrect the thread\'s interrupt status flag on SQL error (called from handleException). Use lcc if available, else thread local variable. \\n \\n\\n\\n \\n\\t EmbedBlob, for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return \\n \\n\\n\\n \\n\\t EmbedResultSet: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return \\n \\n\\n\\n \\n\\t EmbedStatment: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return \\n \\n\\n\\n   In executeBatch, use throwIf between each statement in the batch: if we saw an interrupt, stop execution of batch. Note that if we do throw, restoreIntrFlagIfSeen will be called in the finally block, but it is idempotent, so no harm is done. It is necessary in case we saw an interrupt in the last statement of the batch. \\n\\n \\n\\t EmbedDatabaseMetaData: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return \\n \\n\\n\\n \\n\\t EmbedPreparedStatement: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return \\n \\n\\n\\n \\n\\t EmbedConnection.java: for methods that call handleException inside synchronized on connection: use InterruptStatus.restoreIntrFlagIfSeen(lcc) before return \\n \\n\\n\\n   For createDatabase, use InterruptStatus.restoreIntrFlagIfSeen() which inspects the thread local variable. This should catch I\\/O interrupts seen during the database creation phase. \\n\\n   Special handling in #close to make sure we access lcc while it is still available.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12924451\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12924451&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12924451\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12924451_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12924451_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Oct\\/10 06:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-25T06:14:26+0000\'\u003e25\\/Oct\\/10 06:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag:\u003cbr\\/\u003e\\n     Thank you so much for the write out. All a, b, c, d points are very clear and straight forward. Personally, I like the fact we are checking interrupt at executeBatch, executeQuery, BasicNoPutResultSetImpl(same as timeout) and waiting for lock area. Thank you for add the synchronized (slaveRecoveryMonitor) and adding all the necessary release notes information.\u003c\\/p\u003e\\n\\n\u003cp\u003e     I apply the derby-4741-a-01-api-interruptstatus. All the suites.all passed and timing for MicroAPITest is close to clean trunk. It also passed Derby151Test with interrupt check.  Mailjdbc is still having deadlock issue. However, like you said, it might or might not cause by the new change. I notice some of the interrupt code is in slight different places in Embed*.java with local initial null value. And, some of interrupt handling code are not in this patch than the previous patch. I am assuming those code are handling machinery of InterruptStatus that save interrupts and it will come in later patch.\u003c\\/p\u003e\\n\\n\u003cp\u003e      I view this patch as it will benefit a lot of customers and love to help out if I can. Thank you so much for working so hard on this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12924451_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12924451_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Oct\\/10 06:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-25T06:14:26+0000\'\u003e25\\/Oct\\/10 06:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag: \\n     Thank you so much for the write out. All a, b, c, d points are very clear and straight forward. Personally, I like the fact we are checking interrupt at executeBatch, executeQuery, BasicNoPutResultSetImpl(same as timeout) and waiting for lock area. Thank you for add the synchronized (slaveRecoveryMonitor) and adding all the necessary release notes information. \\n\\n      I apply the derby-4741-a-01-api-interruptstatus. All the suites.all passed and timing for MicroAPITest is close to clean trunk. It also passed Derby151Test with interrupt check.  Mailjdbc is still having deadlock issue. However, like you said, it might or might not cause by the new change. I notice some of the interrupt code is in slight different places in Embed*.java with local initial null value. And, some of interrupt handling code are not in this patch than the previous patch. I am assuming those code are handling machinery of InterruptStatus that save interrupts and it will come in later patch. \\n\\n       I view this patch as it will benefit a lot of customers and love to help out if I can. Thank you so much for working so hard on this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12924571\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12924571&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12924571\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12924571_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12924571_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Oct\\/10 14:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-25T14:23:57+0000\'\u003e25\\/Oct\\/10 14:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 25\\/Oct\\/10 14:45\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Lily, thanks for test driving the patch \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I really appreciate your help looking at this work. Having another set of eyes on this is good, the change are a bit cross cutting and affect much existing code, so it\'s good to have someone double checking the changes. Two comments:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eif the mailjdbc test still deadlocks, I doubt it can be due to this patch, since it doesn\'t really change any behavior, it just installs the machinery for the behavior changes to come in later patches, as you presumed.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe difference is EmbedBlob with local initial null is just some cruft from an experiment I did with trying to place restoreIntrFlagIfSeen in a finally block. This didn\'t work out since, error handling may close the connection and with it the lcc, so the check would happen too late. (The current method is to check before return and in the error handling code itself). I\'ll revert that change, thanks for noticing.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eMy main concern with this patch currently is to verify that I have found all the ways control can return to the user app after Derby code has had control, and possibly set the interrupt status flag. A case in point is the Blob methods that don\'t require a connection, e.g. EmbedBlob#getBytes if the lob is materialized, we call control.read: if we see an interrupt inside the read, the flag would get stored in a thread local variable, since there is no lcc, so I\'ll I need to add a call to no-args version of restoreIntrFlagIfSeen() there. EmbedClob needs analysis, too.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12924571_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12924571_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Oct\\/10 14:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-25T14:23:57+0000\'\u003e25\\/Oct\\/10 14:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 25\\/Oct\\/10 14:45\\\"\u003eedited\u003c\\/span\u003e                   Hi Lily, thanks for test driving the patch   I really appreciate your help looking at this work. Having another set of eyes on this is good, the change are a bit cross cutting and affect much existing code, so it\'s good to have someone double checking the changes. Two comments: \\n\\n \\n\\t if the mailjdbc test still deadlocks, I doubt it can be due to this patch, since it doesn\'t really change any behavior, it just installs the machinery for the behavior changes to come in later patches, as you presumed. \\n \\n\\n\\n \\n\\t the difference is EmbedBlob with local initial null is just some cruft from an experiment I did with trying to place restoreIntrFlagIfSeen in a finally block. This didn\'t work out since, error handling may close the connection and with it the lcc, so the check would happen too late. (The current method is to check before return and in the error handling code itself). I\'ll revert that change, thanks for noticing. \\n \\n\\n\\n My main concern with this patch currently is to verify that I have found all the ways control can return to the user app after Derby code has had control, and possibly set the interrupt status flag. A case in point is the Blob methods that don\'t require a connection, e.g. EmbedBlob#getBytes if the lob is materialized, we call control.read: if we see an interrupt inside the read, the flag would get stored in a thread local variable, since there is no lcc, so I\'ll I need to add a call to no-args version of restoreIntrFlagIfSeen() there. EmbedClob needs analysis, too.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12925452\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12925452&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12925452\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12925452_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12925452_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Oct\\/10 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-27T17:00:09+0000\'\u003e27\\/Oct\\/10 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading derby-4741-a-02-api-interruptstatus, an improved version of\u003cbr\\/\u003e\\na-01.\u003c\\/p\u003e\\n\\n\u003cp\u003eI went over the usages of restoreIntrFlagIfSeen in the API and\u003cbr\\/\u003e\\nreevaluated where it is possible to supply the lcc and where it is not\u003cbr\\/\u003e\\nsafe: the intention is that if we stored the interrupt status flag in\u003cbr\\/\u003e\\na lcc we should be recover it from there before returning to the user\u003cbr\\/\u003e\\napp and, similarly, if we stored the interrupt status flag in a thread\u003cbr\\/\u003e\\nlocal variable because an lcc was not available, we should recover it\u003cbr\\/\u003e\\nfrom there. It turns out it is not always obvious to determine where to\u003cbr\\/\u003e\\nlook in the API methods.\u003c\\/p\u003e\\n\\n\u003cp\u003eAPI methods vary with repect to whether they:\u003c\\/p\u003e\\n\\n\u003cp\u003e    a) synchronize on the connection or not, cf. possible bugs\u003cbr\\/\u003e\\n       see \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4129\\\" title=\\\"jvm level Deadlock between 2 threads accessing the same connection\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4129\\\"\u003eDERBY-4129\u003c\\/a\u003e, even when accessing store.\u003c\\/p\u003e\\n\\n\u003cp\u003e    b) call setupContextStack or not (this is what lets us find the\u003cbr\\/\u003e\\n       lcc down in store using ContextService.getContextOrNull)\u003c\\/p\u003e\\n\\n\u003cp\u003e    c) clean up when errors occur by calling handleInterrupt(t), cf my\u003cbr\\/\u003e\\n       comment on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4129\\\" title=\\\"jvm level Deadlock between 2 threads accessing the same connection\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4129\\\"\u003eDERBY-4129\u003c\\/a\u003e, e.g. EmbedClob. The cleanup can lead to\u003cbr\\/\u003e\\n       a connection closing if severity is high, setting its lcc to\u003cbr\\/\u003e\\n       null.\u003c\\/p\u003e\\n\\n\u003cp\u003e    d) even if an API method doesn\'t call setupContextStack, it may be\u003cbr\\/\u003e\\n       called indirectly from a context that does set it up, cf.\u003cbr\\/\u003e\\n       part of a trigger on an insert.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen a connection (or database) is being closed down, we need to be\u003cbr\\/\u003e\\ncareful so that we catch the lcc while it is still available. When\u003cbr\\/\u003e\\ncleaning up errors in TransactionResourceImpl#handleException we do\u003cbr\\/\u003e\\nnot directly know if an lcc is available or not.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe upshot of all this is that unless we are sure we have a valid lcc\u003cbr\\/\u003e\\n(i.e. we see statically that setupContextStack has been called), we\u003cbr\\/\u003e\\ninstead call restoreIntrFlagIfSeen \u003cb\u003ewithout\u003c\\/b\u003e an lcc argument. The\u003cbr\\/\u003e\\nzero-arg variant calls getContextOrNull to see if a lcc is available\u003cbr\\/\u003e\\nfor the thread, falling back to the thread local if not. So, in\u003cbr\\/\u003e\\neffect, the lcc variant is an optimization, but it does cover the\u003cbr\\/\u003e\\nmethods for which performance could be an issue, I think.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new patch covers LOB ands CLOB as well, and is ready for review.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegressions ran ok.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12925452_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12925452_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Oct\\/10 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-27T17:00:09+0000\'\u003e27\\/Oct\\/10 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading derby-4741-a-02-api-interruptstatus, an improved version of \\na-01. \\n\\n I went over the usages of restoreIntrFlagIfSeen in the API and \\nreevaluated where it is possible to supply the lcc and where it is not \\nsafe: the intention is that if we stored the interrupt status flag in \\na lcc we should be recover it from there before returning to the user \\napp and, similarly, if we stored the interrupt status flag in a thread \\nlocal variable because an lcc was not available, we should recover it \\nfrom there. It turns out it is not always obvious to determine where to \\nlook in the API methods. \\n\\n API methods vary with repect to whether they: \\n\\n     a) synchronize on the connection or not, cf. possible bugs \\n       see  DERBY-4129 , even when accessing store. \\n\\n     b) call setupContextStack or not (this is what lets us find the \\n       lcc down in store using ContextService.getContextOrNull) \\n\\n     c) clean up when errors occur by calling handleInterrupt(t), cf my \\n       comment on  DERBY-4129 , e.g. EmbedClob. The cleanup can lead to \\n       a connection closing if severity is high, setting its lcc to \\n       null. \\n\\n     d) even if an API method doesn\'t call setupContextStack, it may be \\n       called indirectly from a context that does set it up, cf. \\n       part of a trigger on an insert. \\n\\n When a connection (or database) is being closed down, we need to be \\ncareful so that we catch the lcc while it is still available. When \\ncleaning up errors in TransactionResourceImpl#handleException we do \\nnot directly know if an lcc is available or not. \\n\\n The upshot of all this is that unless we are sure we have a valid lcc \\n(i.e. we see statically that setupContextStack has been called), we \\ninstead call restoreIntrFlagIfSeen  without  an lcc argument. The \\nzero-arg variant calls getContextOrNull to see if a lcc is available \\nfor the thread, falling back to the thread local if not. So, in \\neffect, the lcc variant is an optimization, but it does cover the \\nmethods for which performance could be an issue, I think. \\n\\n The new patch covers LOB ands CLOB as well, and is ready for review. \\n\\n Regressions ran ok.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12925674\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12925674&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12925674\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12925674_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12925674_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Oct\\/10 03:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-28T03:34:49+0000\'\u003e28\\/Oct\\/10 03:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading version a-03, minor and clerical changes only relative to a-02.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12925674_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12925674_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Oct\\/10 03:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-10-28T03:34:49+0000\'\u003e28\\/Oct\\/10 03:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading version a-03, minor and clerical changes only relative to a-02.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12926841\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12926841&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12926841\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12926841_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12926841_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Nov\\/10 05:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-01T05:40:38+0000\'\u003e01\\/Nov\\/10 05:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhen running MicroAPITest against a-03 patch, it is 45-48 seconds vs clean trunk 27-28 second. I noticed it is not using lcc but the earlier slower approach. Are you seeing the same slow windows performance again a-03 patch. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12926841_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12926841_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Nov\\/10 05:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-01T05:40:38+0000\'\u003e01\\/Nov\\/10 05:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    When running MicroAPITest against a-03 patch, it is 45-48 seconds vs clean trunk 27-28 second. I noticed it is not using lcc but the earlier slower approach. Are you seeing the same slow windows performance again a-03 patch.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12926998\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12926998&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12926998\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12926998_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12926998_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Nov\\/10 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-01T14:54:54+0000\'\u003e01\\/Nov\\/10 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for test driving it, Lily. The new patch does use the lcc if available, it just falls back on the TL approach if not, so the performance drop was unexpected to me. I\'ll have a look, thanks for noticing. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12926998_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12926998_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Nov\\/10 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-01T14:54:54+0000\'\u003e01\\/Nov\\/10 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for test driving it, Lily. The new patch does use the lcc if available, it just falls back on the TL approach if not, so the performance drop was unexpected to me. I\'ll have a look, thanks for noticing.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927266\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927266&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927266\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927266_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927266_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 03:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T03:02:53+0000\'\u003e02\\/Nov\\/10 03:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLily, did you with a sane or insane build? I see a large difference also (Solaris though) with sane (due to an expensive assert), but with insane is it very small (~&lt;1%).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927266_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927266_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 03:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T03:02:53+0000\'\u003e02\\/Nov\\/10 03:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lily, did you with a sane or insane build? I see a large difference also (Solaris though) with sane (due to an expensive assert), but with insane is it very small (~&lt;1%).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927284\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927284&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927284\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12927284_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927284_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 03:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T03:18:55+0000\'\u003e02\\/Nov\\/10 03:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag: That is interesting. I was using sane build. Shouldn\'t sane build have similar performance as insane or they are usually having difference?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12927284_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927284_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 03:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T03:18:55+0000\'\u003e02\\/Nov\\/10 03:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag: That is interesting. I was using sane build. Shouldn\'t sane build have similar performance as insane or they are usually having difference?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927345\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927345&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927345\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12927345_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927345_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 09:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T09:53:03+0000\'\u003e02\\/Nov\\/10 09:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe sane jars are not intended for production use, so I wouldn\'t worry too much about a performance loss that we only see with them. Unless it\'s getting so slow that it takes an unreasonably long time to run the regression tests with them, that is.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m guessing that the extra performance loss seen with sane jars is caused by the assert in InterruptStatus.restoreIntrFlagIfSeen(LanguageConnectionContext), which makes us look up the lcc in the context stack. Twice, actually. Perhaps it would help a little to store the result from getContextOrNull() in a local variable so that we get away with a single call. Or perhaps it\'s the unconditional string concatenation for the message text that\'s costly. In any case, that assert is the only place I can see that the patch would have a different performance impact on sane and insane.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12927345_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927345_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 09:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T09:53:03+0000\'\u003e02\\/Nov\\/10 09:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The sane jars are not intended for production use, so I wouldn\'t worry too much about a performance loss that we only see with them. Unless it\'s getting so slow that it takes an unreasonably long time to run the regression tests with them, that is. \\n\\n I\'m guessing that the extra performance loss seen with sane jars is caused by the assert in InterruptStatus.restoreIntrFlagIfSeen(LanguageConnectionContext), which makes us look up the lcc in the context stack. Twice, actually. Perhaps it would help a little to store the result from getContextOrNull() in a local variable so that we get away with a single call. Or perhaps it\'s the unconditional string concatenation for the message text that\'s costly. In any case, that assert is the only place I can see that the patch would have a different performance impact on sane and insane.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12927441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 14:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T14:45:23+0000\'\u003e02\\/Nov\\/10 14:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag,\u003c\\/p\u003e\\n\\n\u003cp\u003eI went through the a-03-api patch, and I couldn\'t spot anything that\u003cbr\\/\u003e\\nyou\'ve missed.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere were quite a number of places to check the interrupt\u003cbr\\/\u003e\\nstatus. More than what I had expected. But I cannot think of a better\u003cbr\\/\u003e\\nplace to short-circuit it, so... Except perhaps in EmbedConnection. It\u003cbr\\/\u003e\\nlooks to me like most of the calls to restoreIntrFlagIfSeen() happen\u003cbr\\/\u003e\\nwithin try blocks right after calls to setupContextStack(). Did you\u003cbr\\/\u003e\\nconsider it as an option to move the restoreIntrFlagIfSeen() calls\u003cbr\\/\u003e\\ninto restoreContextStack(), which is already called in the finally\u003cbr\\/\u003e\\nclauses at those places? That may make the code more contained, but\u003cbr\\/\u003e\\nperhaps the LCC isn\'t easily available there?\u003c\\/p\u003e\\n\\n\u003cp\u003eApart from that, I only have some minor comments to the code in the\u003cbr\\/\u003e\\nInterruptStatus class. Very minor, so feel free to ignore.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethrowIf: Unnecessary return statement.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003estackTrace: The initialValue() override does the same as the default\u003cbr\\/\u003e\\n  implementation. So by just using a vanilla ThreadLocal object, we\'d\u003cbr\\/\u003e\\n  get the exact same behaviour, and one less class in derby.jar +\u003cbr\\/\u003e\\n  permgen. (If the footprint issue is important, the same might be\u003cbr\\/\u003e\\n  said for receivedInterruptDuringIO if we change its usage from a\u003cbr\\/\u003e\\n  TRUE\\/FALSE check to a null\\/non-null check. Actually, the presence of\u003cbr\\/\u003e\\n  a stack trace is probably a good enough indicator in itself.)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eInstead of creating an exception, fetching its stack trace and\u003cbr\\/\u003e\\n  storing the trace, perhaps it would be easier just to store the\u003cbr\\/\u003e\\n  exception? Then throwIf() could throw the stored exception instead\u003cbr\\/\u003e\\n  of creating a new one and modifying its stack trace.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12927441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 14:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T14:45:23+0000\'\u003e02\\/Nov\\/10 14:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag, \\n\\n I went through the a-03-api patch, and I couldn\'t spot anything that \\nyou\'ve missed. \\n\\n There were quite a number of places to check the interrupt \\nstatus. More than what I had expected. But I cannot think of a better \\nplace to short-circuit it, so... Except perhaps in EmbedConnection. It \\nlooks to me like most of the calls to restoreIntrFlagIfSeen() happen \\nwithin try blocks right after calls to setupContextStack(). Did you \\nconsider it as an option to move the restoreIntrFlagIfSeen() calls \\ninto restoreContextStack(), which is already called in the finally \\nclauses at those places? That may make the code more contained, but \\nperhaps the LCC isn\'t easily available there? \\n\\n Apart from that, I only have some minor comments to the code in the \\nInterruptStatus class. Very minor, so feel free to ignore. \\n\\n \\n\\t throwIf: Unnecessary return statement. \\n \\n\\n\\n \\n\\t stackTrace: The initialValue() override does the same as the default \\n  implementation. So by just using a vanilla ThreadLocal object, we\'d \\n  get the exact same behaviour, and one less class in derby.jar + \\n  permgen. (If the footprint issue is important, the same might be \\n  said for receivedInterruptDuringIO if we change its usage from a \\n  TRUE\\/FALSE check to a null\\/non-null check. Actually, the presence of \\n  a stack trace is probably a good enough indicator in itself.) \\n \\n\\n\\n \\n\\t Instead of creating an exception, fetching its stack trace and \\n  storing the trace, perhaps it would be easier just to store the \\n  exception? Then throwIf() could throw the stored exception instead \\n  of creating a new one and modifying its stack trace. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927445\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927445&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927445\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927445_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927445_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 14:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T14:52:13+0000\'\u003e02\\/Nov\\/10 14:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKnut is right, that was the expensive assert I mentioned before (in sane builds). Since this is a micro benchmark that mainly measures the CPU neeeded to execute ResultSet.next when data is cached in memory, the effect of the assert shows up heavily. Running a profiling I saw the string concatenation there being dominant. No, I did not notice the regression test become slower, but if the turns out to be an issue, it is easy enough to comment out the asset. For now, I\'ll change the assert code to just call  getContextOrNull once.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927445_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927445_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 14:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T14:52:13+0000\'\u003e02\\/Nov\\/10 14:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Knut is right, that was the expensive assert I mentioned before (in sane builds). Since this is a micro benchmark that mainly measures the CPU neeeded to execute ResultSet.next when data is cached in memory, the effect of the assert shows up heavily. Running a profiling I saw the string concatenation there being dominant. No, I did not notice the regression test become slower, but if the turns out to be an issue, it is easy enough to comment out the asset. For now, I\'ll change the assert code to just call  getContextOrNull once.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927474\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927474&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927474\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927474_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927474_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T15:56:11+0000\'\u003e02\\/Nov\\/10 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for looking at the patch, Knut!\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Except perhaps in EmbedConnection. It looks to me like most of the calls to restoreIntrFlagIfSeen() happen within try blocks right after calls to setupContextStack(). Did you consider it as an option to move the restoreIntrFlagIfSeen() calls into restoreContextStack(), which is already called in the finally clauses at those places?\u003c\\/p\u003e\\n\\n\u003cp\u003eI did try to put the call into the finally,although not into restoreContextStack. I found that didn\'t always work, since during error handling \u003cb\u003ebefore\u003c\\/b\u003e we get to the finally block, calls to handleException(throwable) will depending on severity, potentially take down the connection (and database), causing us to lose the lcc.  Hence I had to move it back to just before normal return, and use the no-args variant of restoreIntrFlagIfSeen handling inside the error handling code (cf changes in TransactionResourceImpl#handleException).\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; - throwIf: Unnecessary return statement.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgreed, will fix that \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; - stackTrace: The initialValue() override does the same as the default implementation. So by just using a vanilla ThreadLocal object, we\'d get the exact same behaviour, and one less class in derby.jar + permgen.\u003c\\/p\u003e\\n\\n\u003cp\u003eAgreed.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;  (If the footprint issue is important, the same might be said for receivedInterruptDuringIO if we change its usage from a TRUE\\/FALSE check to a null\\/non-null check. Actually, the presence of a stack trace is probably a good enough indicator in itself.)\u003c\\/p\u003e\\n\\n\u003cp\u003eYes and yes. Originally I used the stacktrace just for debugging with sane, I think.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; - Instead of creating an exception, fetching its stack trace and storing the trace, perhaps it would be easier just to store the exception? Then throwIf() could throw the stored exception instead of creating a new one and modifying its stack trace.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s good simplication, yes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927474_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927474_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T15:56:11+0000\'\u003e02\\/Nov\\/10 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for looking at the patch, Knut! \\n\\n &gt; Except perhaps in EmbedConnection. It looks to me like most of the calls to restoreIntrFlagIfSeen() happen within try blocks right after calls to setupContextStack(). Did you consider it as an option to move the restoreIntrFlagIfSeen() calls into restoreContextStack(), which is already called in the finally clauses at those places? \\n\\n I did try to put the call into the finally,although not into restoreContextStack. I found that didn\'t always work, since during error handling  before  we get to the finally block, calls to handleException(throwable) will depending on severity, potentially take down the connection (and database), causing us to lose the lcc.  Hence I had to move it back to just before normal return, and use the no-args variant of restoreIntrFlagIfSeen handling inside the error handling code (cf changes in TransactionResourceImpl#handleException). \\n\\n &gt; - throwIf: Unnecessary return statement. \\n\\n Agreed, will fix that   \\n\\n &gt; - stackTrace: The initialValue() override does the same as the default implementation. So by just using a vanilla ThreadLocal object, we\'d get the exact same behaviour, and one less class in derby.jar + permgen. \\n\\n Agreed. \\n\\n &gt;  (If the footprint issue is important, the same might be said for receivedInterruptDuringIO if we change its usage from a TRUE\\/FALSE check to a null\\/non-null check. Actually, the presence of a stack trace is probably a good enough indicator in itself.) \\n\\n Yes and yes. Originally I used the stacktrace just for debugging with sane, I think. \\n\\n &gt; - Instead of creating an exception, fetching its stack trace and storing the trace, perhaps it would be easier just to store the exception? Then throwIf() could throw the stored exception instead of creating a new one and modifying its stack trace. \\n\\n That\'s good simplication, yes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927588\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927588&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927588\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927588_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927588_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T20:54:32+0000\'\u003e02\\/Nov\\/10 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a revised patch, derby-4741-a-04-api-interruptstatus, which takes care of the comments. hopefully. Rerunning regressions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927588_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927588_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T20:54:32+0000\'\u003e02\\/Nov\\/10 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a revised patch, derby-4741-a-04-api-interruptstatus, which takes care of the comments. hopefully. Rerunning regressions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927660\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927660&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927660\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927660_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927660_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 22:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T22:57:59+0000\'\u003e02\\/Nov\\/10 22:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRegressions ran ok. Will commit this version soon, if no misgivings emerge.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927660_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927660_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Nov\\/10 22:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-02T22:57:59+0000\'\u003e02\\/Nov\\/10 22:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Regressions ran ok. Will commit this version soon, if no misgivings emerge.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927797\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927797&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927797\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12927797_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927797_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/10 09:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-03T09:10:21+0000\'\u003e03\\/Nov\\/10 09:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the changes and the explanations, Dag. I have no further comments to the a-04-api patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne observation: After looking at the changes in EmbedBlob.getBytes(long,int) and EmbedBlob.position(), I understand why some people advocate that all methods should have a single exit point. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12927797_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927797_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/10 09:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-03T09:10:21+0000\'\u003e03\\/Nov\\/10 09:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the changes and the explanations, Dag. I have no further comments to the a-04-api patch. \\n\\n One observation: After looking at the changes in EmbedBlob.getBytes(long,int) and EmbedBlob.position(), I understand why some people advocate that all methods should have a single exit point.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927866\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927866&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927866\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12927866_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927866_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/10 14:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-03T14:41:23+0000\'\u003e03\\/Nov\\/10 14:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI test drive a-04-api patch as well. The sane MicroAPITest result is very good. I got result that is 5s - 7s. The insane result is similar to a-03-api which is around 45s--52s vs 27s-28s on clean trunk. However, like we discussed previous for MicroAPITest benchmark is only focus on CPU result and the slowdown is mostly on ASSERT. With so many things to take care of with 10.7 release. +1 to commit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12927866_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927866_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/10 14:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-03T14:41:23+0000\'\u003e03\\/Nov\\/10 14:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I test drive a-04-api patch as well. The sane MicroAPITest result is very good. I got result that is 5s - 7s. The insane result is similar to a-03-api which is around 45s--52s vs 27s-28s on clean trunk. However, like we discussed previous for MicroAPITest benchmark is only focus on CPU result and the slowdown is mostly on ASSERT. With so many things to take care of with 10.7 release. +1 to commit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12927970\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12927970&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12927970\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927970_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927970_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/10 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-03T19:42:21+0000\'\u003e03\\/Nov\\/10 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted derby-4741-a-04-api-interruptstatus as svn 1030630.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12927970_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12927970_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Nov\\/10 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-03T19:42:21+0000\'\u003e03\\/Nov\\/10 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed derby-4741-a-04-api-interruptstatus as svn 1030630.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12929885\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12929885&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12929885\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12929885_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12929885_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/10 01:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-09T01:56:13+0000\'\u003e09\\/Nov\\/10 01:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 11\\/Nov\\/10 15:42\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading patch derby-4741-b-01-nio. This patch contains changes to\u003cbr\\/\u003e\\nFileContainer\\/RAFContainer\\/RAFContainer4 to allow page IO to recover\u003cbr\\/\u003e\\nfrom interrupts seen in RAFContainer4 (the NIO\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e version\u003cbr\\/\u003e\\nspecialization of RAFContainer). Additionally, some waits are changed\u003cbr\\/\u003e\\nto retry after interrupts (yes, there are more of those in other\u003cbr\\/\u003e\\nclasses, that\'s for a later patch, but since I was in there anyway..)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe main thrust of the patch is in RAFContainer4. Upon seeing\u003cbr\\/\u003e\\nexceptions from IO (readPage\\/writePage), a thread will determine if it\u003cbr\\/\u003e\\nis\u003cbr\\/\u003e\\n        a) the thread that caused the channel to beclome closed, or\u003cbr\\/\u003e\\n        b) it suffered an exceptions because another thread caused the\u003cbr\\/\u003e\\n           channel to beclome closed.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf a), the thread will recover by reopening the container before\u003cbr\\/\u003e\\nreattempting IO, cf. the method recoverContainerAfterInterrupt. If b)\u003cbr\\/\u003e\\nthe thread will yield, wait and retry until the container has been\u003cbr\\/\u003e\\nrecovered, or a minute has passed. After a minute, we give up and\u003cbr\\/\u003e\\nthrow FILE_IO_INTERRUPTED. I chose a minute somewhat arbitrarily, it\u003cbr\\/\u003e\\nis hopefully sufficient \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/help_16.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe recovery thread and other waiting threads normally synchronize the\u003cbr\\/\u003e\\noperations via variables protected by the channelCleanupMonitor\u003cbr\\/\u003e\\nmonitor (but see use of volatile and associated comments).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe retry logic happens in one of three places, in increasing\u003cbr\\/\u003e\\ncloseness to RAFContainer4:\u003c\\/p\u003e\\n\\n\u003cp\u003e    a) if the thread owns the monitor on allocCache and it is not the\u003cbr\\/\u003e\\n       one that is doing recovery, it will back up to FileContainer\u003cbr\\/\u003e\\n       before retrying the IO, since it has to release the lock on\u003cbr\\/\u003e\\n       allocCache, because that monitor is needed by the thread doing\u003cbr\\/\u003e\\n       recovery. Cf. changes in FileContainer.  If the thread holds\u003cbr\\/\u003e\\n       allocCache, it goes into stealth mode in readPage\\/WritePage:\u003cbr\\/\u003e\\n       this means that the recovery thread doesn\'t see it. We can\'t\u003cbr\\/\u003e\\n       let a stealth mode thread grab channelCleanupMonitor, as this\u003cbr\\/\u003e\\n       could cause a dead-lock. In c) the recovery thread keeps track\u003cbr\\/\u003e\\n       of other threads, waking them up when recovery is done.\u003c\\/p\u003e\\n\\n\u003cp\u003e    b) if the thread owns the monitor on \\\"this\\\", again the thread goes\u003cbr\\/\u003e\\n       into stealth mode. If it is not the one to clean up, it will\u003cbr\\/\u003e\\n       back up to RAFContainer#clean\'s loop, since it has to release\u003cbr\\/\u003e\\n       the lock on \\\"this\\\", because that monitor is also needed by the\u003cbr\\/\u003e\\n       thread doing recovery. This only ever happens for readPage (not\u003cbr\\/\u003e\\n       writePage), cf. call to getEmbryonicPage in WriteRAFHeader\u003cbr\\/\u003e\\n       called from RAFContainer#clean.\u003c\\/p\u003e\\n\\n\u003cp\u003e    c) in other cases, the thread will call awaitRestoreChannel before\u003cbr\\/\u003e\\n       reattempting IO.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe logic of RAFContainer4#getEmbryonicPage has been folded into\u003cbr\\/\u003e\\nreadPage in order for it to be covered by the interrupt treatement.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe test Derby151Test has been removed, since it is no longer\u003cbr\\/\u003e\\nrelevant. A new test, InterruptResilienceTest, fails without the\u003cbr\\/\u003e\\npatch, but should work with the patch in place. It interrupts the\u003cbr\\/\u003e\\nsingle app thread before doing IO, which will trip NIO and cause\u003cbr\\/\u003e\\nrecovery. Even though we have only one app thread, the test still\u003cbr\\/\u003e\\nrevealed concurrency issues during the development of this patch,\u003cbr\\/\u003e\\nsince RawStoreThread will also do IO on the container.\u003c\\/p\u003e\\n\\n\u003cp\u003eA note on the implementation: Sun Java NIO code (including the\u003cbr\\/\u003e\\nlatest 1.6) has a bug which are worked around by the patch in two\u003cbr\\/\u003e\\nplaces, cf. code comments:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ereadFull\\/writeFull: if a thread has been interrupted,\u003cbr\\/\u003e\\n         occasionally it closes the channel but does not throw,\u003cbr\\/\u003e\\n         cf. \u003ca href=\\\"http:\\/\\/bugs.sun.com\\/view_bug.do?bug_id=6979009\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/bugs.sun.com\\/view_bug.do?bug_id=6979009\u003c\\/a\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003ereadPage\\/WritePage: sometimes the interrupted thread throws\u003cbr\\/\u003e\\n         the wrong exception: AsynchronousCloseException instead of\u003cbr\\/\u003e\\n         the more specialized ClosedByInterruptException.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e Note: DirRandomAccessFile4 also contain use of NIO, I\'ll address\u003cbr\\/\u003e\\nthat in a later patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI will also be adding more tests. A problem for making tests for\u003cbr\\/\u003e\\ninterrupts is to get coverage without making tests unstable, so I\'ll\u003cbr\\/\u003e\\nwait until I have more holes plugged.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegressions worked earlier tonight in a slightly different version, rerunning now.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12929885_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12929885_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/10 01:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-09T01:56:13+0000\'\u003e09\\/Nov\\/10 01:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 11\\/Nov\\/10 15:42\\\"\u003eedited\u003c\\/span\u003e                   Uploading patch derby-4741-b-01-nio. This patch contains changes to \\nFileContainer\\/RAFContainer\\/RAFContainer4 to allow page IO to recover \\nfrom interrupts seen in RAFContainer4 (the NIO &#91;1&#93;  version \\nspecialization of RAFContainer). Additionally, some waits are changed \\nto retry after interrupts (yes, there are more of those in other \\nclasses, that\'s for a later patch, but since I was in there anyway..) \\n\\n The main thrust of the patch is in RAFContainer4. Upon seeing \\nexceptions from IO (readPage\\/writePage), a thread will determine if it \\nis \\n        a) the thread that caused the channel to beclome closed, or \\n        b) it suffered an exceptions because another thread caused the \\n           channel to beclome closed. \\n\\n If a), the thread will recover by reopening the container before \\nreattempting IO, cf. the method recoverContainerAfterInterrupt. If b) \\nthe thread will yield, wait and retry until the container has been \\nrecovered, or a minute has passed. After a minute, we give up and \\nthrow FILE_IO_INTERRUPTED. I chose a minute somewhat arbitrarily, it \\nis hopefully sufficient  . \\n\\n The recovery thread and other waiting threads normally synchronize the \\noperations via variables protected by the channelCleanupMonitor \\nmonitor (but see use of volatile and associated comments). \\n\\n The retry logic happens in one of three places, in increasing \\ncloseness to RAFContainer4: \\n\\n     a) if the thread owns the monitor on allocCache and it is not the \\n       one that is doing recovery, it will back up to FileContainer \\n       before retrying the IO, since it has to release the lock on \\n       allocCache, because that monitor is needed by the thread doing \\n       recovery. Cf. changes in FileContainer.  If the thread holds \\n       allocCache, it goes into stealth mode in readPage\\/WritePage: \\n       this means that the recovery thread doesn\'t see it. We can\'t \\n       let a stealth mode thread grab channelCleanupMonitor, as this \\n       could cause a dead-lock. In c) the recovery thread keeps track \\n       of other threads, waking them up when recovery is done. \\n\\n     b) if the thread owns the monitor on \\\"this\\\", again the thread goes \\n       into stealth mode. If it is not the one to clean up, it will \\n       back up to RAFContainer#clean\'s loop, since it has to release \\n       the lock on \\\"this\\\", because that monitor is also needed by the \\n       thread doing recovery. This only ever happens for readPage (not \\n       writePage), cf. call to getEmbryonicPage in WriteRAFHeader \\n       called from RAFContainer#clean. \\n\\n     c) in other cases, the thread will call awaitRestoreChannel before \\n       reattempting IO. \\n\\n The logic of RAFContainer4#getEmbryonicPage has been folded into \\nreadPage in order for it to be covered by the interrupt treatement. \\n\\n The test Derby151Test has been removed, since it is no longer \\nrelevant. A new test, InterruptResilienceTest, fails without the \\npatch, but should work with the patch in place. It interrupts the \\nsingle app thread before doing IO, which will trip NIO and cause \\nrecovery. Even though we have only one app thread, the test still \\nrevealed concurrency issues during the development of this patch, \\nsince RawStoreThread will also do IO on the container. \\n\\n A note on the implementation: Sun Java NIO code (including the \\nlatest 1.6) has a bug which are worked around by the patch in two \\nplaces, cf. code comments: \\n\\n \\n\\t readFull\\/writeFull: if a thread has been interrupted, \\n         occasionally it closes the channel but does not throw, \\n         cf.  http:\\/\\/bugs.sun.com\\/view_bug.do?bug_id=6979009  \\n\\t readPage\\/WritePage: sometimes the interrupted thread throws \\n         the wrong exception: AsynchronousCloseException instead of \\n         the more specialized ClosedByInterruptException. \\n \\n\\n\\n  &#91;1&#93;  Note: DirRandomAccessFile4 also contain use of NIO, I\'ll address \\nthat in a later patch. \\n\\n I will also be adding more tests. A problem for making tests for \\ninterrupts is to get coverage without making tests unstable, so I\'ll \\nwait until I have more holes plugged. \\n\\n Regressions worked earlier tonight in a slightly different version, rerunning now. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12930687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12930687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12930687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12930687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12930687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/10 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-10T18:10:13+0000\'\u003e10\\/Nov\\/10 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag: Thank you so much for the continue effort to fix this issue. It will benefit a lot of customers and this is truly a hard bug\\/feature to fix. I am still trying to process the effect of FileContainer\\/RAFContainer\\/RAFContainer4. I don\'t quite understand it yet. The performance result for MicroAPITest is 5s-7s for insane build and 45s-47s for sane build. That\'s great. Regression can have failure on my windows environment: testPartialRowRTStats(Java exception: \'PermGen space: java.lang.OutOfMemoryError) or\u003cbr\\/\u003e\\n testReplicationt_Local_1_Indexing(java.sql.SQLException: DERBY SQL\u003cbr\\/\u003e\\n error: SQLCODE: -1, SQLSTATE: XJ041, SQLERRMC: Failed to create database \'c:\\\\de\u003cbr\\/\u003e\\nrby5\\\\trunk\\\\testall\\\\db_master\\\\wombat\', see the next exception for details.::SQLST\u003cbr\\/\u003e\\nATE: XBM0JDirectory c:\\\\derby5\\\\trunk\\\\testall\\\\db_master\\\\C:\\\\derby5\\\\trunk\\\\testall\\\\db\u003cbr\\/\u003e\\n_master\\\\wombat already exists. I run Suites.all three times, they all have similar failures. I can not reproduce if I run the test individually. Will this patch affect memory consumption? Will the timing change on cf cause java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ041, SQLERRMC? I am not 100% sure. Or, they were just existing issues. For more multi thread purpose, I add to InterrupResilienceTest suite. If it is in the right direction, I can keep explore to make more other positive interrupt cases. Thanks Krisitan for the AbstractMTThread class.  I am so happy to work on this. Yeah!!!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12930687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12930687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/10 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-10T18:10:13+0000\'\u003e10\\/Nov\\/10 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag: Thank you so much for the continue effort to fix this issue. It will benefit a lot of customers and this is truly a hard bug\\/feature to fix. I am still trying to process the effect of FileContainer\\/RAFContainer\\/RAFContainer4. I don\'t quite understand it yet. The performance result for MicroAPITest is 5s-7s for insane build and 45s-47s for sane build. That\'s great. Regression can have failure on my windows environment: testPartialRowRTStats(Java exception: \'PermGen space: java.lang.OutOfMemoryError) or \\n testReplicationt_Local_1_Indexing(java.sql.SQLException: DERBY SQL \\n error: SQLCODE: -1, SQLSTATE: XJ041, SQLERRMC: Failed to create database \'c:\\\\de \\nrby5\\\\trunk\\\\testall\\\\db_master\\\\wombat\', see the next exception for details.::SQLST \\nATE: XBM0JDirectory c:\\\\derby5\\\\trunk\\\\testall\\\\db_master\\\\C:\\\\derby5\\\\trunk\\\\testall\\\\db \\n_master\\\\wombat already exists. I run Suites.all three times, they all have similar failures. I can not reproduce if I run the test individually. Will this patch affect memory consumption? Will the timing change on cf cause java.sql.SQLException: DERBY SQL error: SQLCODE: -1, SQLSTATE: XJ041, SQLERRMC? I am not 100% sure. Or, they were just existing issues. For more multi thread purpose, I add to InterrupResilienceTest suite. If it is in the right direction, I can keep explore to make more other positive interrupt cases. Thanks Krisitan for the AbstractMTThread class.  I am so happy to work on this. Yeah!!!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12930704\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12930704&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12930704\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12930704_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12930704_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/10 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-10T18:44:46+0000\'\u003e10\\/Nov\\/10 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Lily, for looking at the latest patch. I agree the code is a bit tricky, so there could be bugs.  Feel free to ask detailed questions, I\'ll try to answer.\u003c\\/p\u003e\\n\\n\u003cp\u003e I did not see any issue with testPartialRowRTStats when I ran the regressions, nor would I expect this patch for increase perm gen space since it doesn\'t add new classes. But we have seen that perm gen space can be an issue when running regressions. I think I recently upped my pergen space setting for suitesAll to 192m. I have also seen failures in the replication tests, there are some instabilities left, but I don\'t think they are due to this patch. \u003c\\/p\u003e\\n\\n\u003cp\u003eYou are right that the current test, InterruptResilienceTest, is pretty thin right now, but it does exercise the RAF recovery machinery with two concurrent threads (user thread and the raw store daemon).  \u003c\\/p\u003e\\n\\n\u003cp\u003eI intend to make more tests; the trick is to make sure the tests actually exercise the code paths we want: just shooting interrupts at threads can land anywhere during execution, and Derby doesn\'t stand up to it in all places yet. I plan to use the SanityManager + a debug flag to simulate interrupt at selected places in the code. If  you have suggestions for good tests, please let\'s have them \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12930704_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12930704_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/10 18:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-10T18:44:46+0000\'\u003e10\\/Nov\\/10 18:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Lily, for looking at the latest patch. I agree the code is a bit tricky, so there could be bugs.  Feel free to ask detailed questions, I\'ll try to answer. \\n\\n  I did not see any issue with testPartialRowRTStats when I ran the regressions, nor would I expect this patch for increase perm gen space since it doesn\'t add new classes. But we have seen that perm gen space can be an issue when running regressions. I think I recently upped my pergen space setting for suitesAll to 192m. I have also seen failures in the replication tests, there are some instabilities left, but I don\'t think they are due to this patch.  \\n\\n You are right that the current test, InterruptResilienceTest, is pretty thin right now, but it does exercise the RAF recovery machinery with two concurrent threads (user thread and the raw store daemon).   \\n\\n I intend to make more tests; the trick is to make sure the tests actually exercise the code paths we want: just shooting interrupts at threads can land anywhere during execution, and Derby doesn\'t stand up to it in all places yet. I plan to use the SanityManager + a debug flag to simulate interrupt at selected places in the code. If  you have suggestions for good tests, please let\'s have them                 \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12930913\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12930913&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12930913\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12930913_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12930913_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 03:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T03:52:44+0000\'\u003e11\\/Nov\\/10 03:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Lily Wei - 11\\/Nov\\/10 03:56\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor testing idea, SanityManager + a debug flag sound good. I am trying to picture how it can cover all the code we try to hit. I am assuming we want to hit code like RAFContainer4.readpage. The simple insert case to Blob and Clob data type can be hitting it like the InterruptResilienceTest does. Will BlobSetMethodTest or LobStreamTest do the trick? A far stretch will be utilizing CorruptRandomAccessFile. I am thinking out loud here. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12930913_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12930913_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 03:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T03:52:44+0000\'\u003e11\\/Nov\\/10 03:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Lily Wei - 11\\/Nov\\/10 03:56\\\"\u003eedited\u003c\\/span\u003e                   For testing idea, SanityManager + a debug flag sound good. I am trying to picture how it can cover all the code we try to hit. I am assuming we want to hit code like RAFContainer4.readpage. The simple insert case to Blob and Clob data type can be hitting it like the InterruptResilienceTest does. Will BlobSetMethodTest or LobStreamTest do the trick? A far stretch will be utilizing CorruptRandomAccessFile. I am thinking out loud here.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931129\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12931129&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931129\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12931129_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931129_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 18:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T18:50:46+0000\'\u003e11\\/Nov\\/10 18:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI had a look at the b-01-nio patch, and it looked correct to me. The\u003cbr\\/\u003e\\nstealth mode part wasn\'t entirely obvious, but the comments were\u003cbr\\/\u003e\\nhelpful and the code appears to be doing the right thing.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs far as I can see, the code will behave the same way as before if no\u003cbr\\/\u003e\\ninterrupt is detected. So if there are problems with the code, they\u003cbr\\/\u003e\\nwill hopefully be limited to the case where the thread is\u003cbr\\/\u003e\\ninterrupted. There\'s an additional container-wide synchronization on\u003cbr\\/\u003e\\nevery page read\\/write, though, which may possibly have a negative\u003cbr\\/\u003e\\neffect on performance in multi-threaded environments. If that turns\u003cbr\\/\u003e\\nout to be an issue, would it be possible to change the code to only\u003cbr\\/\u003e\\ncheck restoreChannelInProgress after an exception has been thrown,\u003cbr\\/\u003e\\nsimilar to what we currently do in stealth mode?\u003c\\/p\u003e\\n\\n\u003cp\u003eSome minor issues found in the patch:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Thread.holdsLock() is a static method, but all calls to it are done\u003cbr\\/\u003e\\non Thread.currentThread().\u003c\\/p\u003e\\n\\n\u003cp\u003e2) I think the checks for SQLState.INTERRUPT_DETECTED should use\u003cbr\\/\u003e\\ngetMessageId() instead of getSQLState(), since the SQLState interface,\u003cbr\\/\u003e\\ndespite its name, contains message ids and not SQLStates (although the\u003cbr\\/\u003e\\nmessage id and the SQLState happen to be the same for this error).\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd since INTERRUPT_DETECTED is only intended to be used internally,\u003cbr\\/\u003e\\nwould it make sense, instead of giving INTERRUPT_DETECTED a proper\u003cbr\\/\u003e\\nSQLState and also an entry in messages.xml (which will be picked up\u003cbr\\/\u003e\\nand translated unnecessarily later), to create a subclass of\u003cbr\\/\u003e\\nStandardException for this error? Something like what\'s done with\u003cbr\\/\u003e\\nNoSpaceOnPage, I mean. That could also make the catch blocks used to\u003cbr\\/\u003e\\nhandle this condition a little bit tidier.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Javadoc for RAFContainer4.readPage() should explain how the offset\u003cbr\\/\u003e\\nparameter is supposed to be used (-1 for normal reads, actual offset\u003cbr\\/\u003e\\nfor embryonic pages)\u003c\\/p\u003e\\n\\n\u003cp\u003e4) The variable \\\"whence\\\" in awaitRestoreChannel() does not seem to be\u003cbr\\/\u003e\\nused. Nor is its \\\"pageNumber\\\" parameter, I think.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12931129_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931129_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 18:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T18:50:46+0000\'\u003e11\\/Nov\\/10 18:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I had a look at the b-01-nio patch, and it looked correct to me. The \\nstealth mode part wasn\'t entirely obvious, but the comments were \\nhelpful and the code appears to be doing the right thing. \\n\\n As far as I can see, the code will behave the same way as before if no \\ninterrupt is detected. So if there are problems with the code, they \\nwill hopefully be limited to the case where the thread is \\ninterrupted. There\'s an additional container-wide synchronization on \\nevery page read\\/write, though, which may possibly have a negative \\neffect on performance in multi-threaded environments. If that turns \\nout to be an issue, would it be possible to change the code to only \\ncheck restoreChannelInProgress after an exception has been thrown, \\nsimilar to what we currently do in stealth mode? \\n\\n Some minor issues found in the patch: \\n\\n 1) Thread.holdsLock() is a static method, but all calls to it are done \\non Thread.currentThread(). \\n\\n 2) I think the checks for SQLState.INTERRUPT_DETECTED should use \\ngetMessageId() instead of getSQLState(), since the SQLState interface, \\ndespite its name, contains message ids and not SQLStates (although the \\nmessage id and the SQLState happen to be the same for this error). \\n\\n And since INTERRUPT_DETECTED is only intended to be used internally, \\nwould it make sense, instead of giving INTERRUPT_DETECTED a proper \\nSQLState and also an entry in messages.xml (which will be picked up \\nand translated unnecessarily later), to create a subclass of \\nStandardException for this error? Something like what\'s done with \\nNoSpaceOnPage, I mean. That could also make the catch blocks used to \\nhandle this condition a little bit tidier. \\n\\n 3) Javadoc for RAFContainer4.readPage() should explain how the offset \\nparameter is supposed to be used (-1 for normal reads, actual offset \\nfor embryonic pages) \\n\\n 4) The variable \\\"whence\\\" in awaitRestoreChannel() does not seem to be \\nused. Nor is its \\\"pageNumber\\\" parameter, I think.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931137\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12931137&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931137\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12931137_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931137_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 19:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T19:02:17+0000\'\u003e11\\/Nov\\/10 19:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnd a note to others who consider reviewing the patch: I found that it was easier to see exactly what was being changed by running svn diff with the extra option \\\"--extensions=-bw\\\" to disregard whitespace changes in the parts of the code where an extra level of nesting was added.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12931137_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931137_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 19:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T19:02:17+0000\'\u003e11\\/Nov\\/10 19:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    And a note to others who consider reviewing the patch: I found that it was easier to see exactly what was being changed by running svn diff with the extra option \\\"--extensions=-bw\\\" to disregard whitespace changes in the parts of the code where an extra level of nesting was added.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931263\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12931263&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931263\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12931263_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931263_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 23:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T23:22:00+0000\'\u003e11\\/Nov\\/10 23:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the review, Knut. Uploading a new version of the patch,\u003cbr\\/\u003e\\nderby-4741-b-02-nio, details below, rerunning regressions.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eIn RAFContainer4, folded the cases for pageNumber == -1 (call from\u003cbr\\/\u003e\\n  getEmbryonicPage) with the case Thread.holdsLock(this). This allows\u003cbr\\/\u003e\\n  awaitRestoreChannel to throw the retry exception for all cases. I\u003cbr\\/\u003e\\n  did both static and dynamic analysis to establish invariant, and\u003cbr\\/\u003e\\n  added a sane check for it.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e&gt; As far as I can see, the code will behave the same way as before if no\u003cbr\\/\u003e\\n&gt; interrupt is detected. So if there are problems with the code, they\u003cbr\\/\u003e\\n&gt; will hopefully be limited to the case where the thread is\u003cbr\\/\u003e\\n&gt; interrupted. There\'s an additional container-wide synchronization on\u003cbr\\/\u003e\\n&gt; every page read\\/write, though, which may possibly have a negative\u003cbr\\/\u003e\\n&gt; effect on performance in multi-threaded environments. If that turns\u003cbr\\/\u003e\\n&gt; out to be an issue, would it be possible to change the code to only\u003cbr\\/\u003e\\n&gt; check restoreChannelInProgress after an exception has been thrown,\u003cbr\\/\u003e\\n&gt; similar to what we currently do in stealth mode?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I believe we could do that, since it should do no harm to attempt\u003cbr\\/\u003e\\nthe IO even when recovery is in progress, because all calls to\u003cbr\\/\u003e\\ngetChannel are synchronized on \\\"this\\\" already, so either the thread\u003cbr\\/\u003e\\nsees the old channel (closed), or the new reopened channel. I didn\'t\u003cbr\\/\u003e\\nmake this change yet, though, since the monitor hold should\u003cbr\\/\u003e\\nshort-lived (one boolean check and an integer increment) compared to\u003cbr\\/\u003e\\nthe IO.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThread.holdsLock(): done\u003c\\/li\u003e\\n\\t\u003cli\u003eCreated a new subclass of StandardException:\u003cbr\\/\u003e\\n  InterruptDetectedException, good suggestion, indeed cleaner!\u003c\\/li\u003e\\n\\t\u003cli\u003eJavadoc for RAFContainer4.readPage: done\u003c\\/li\u003e\\n\\t\u003cli\u003eThe variable \\\"whence\\\": removed\u003c\\/li\u003e\\n\\t\u003cli\u003eRemoved some commented out debugging cruft\u003c\\/li\u003e\\n\\t\u003cli\u003eTuned the number of iterations in InterruptDetectedException to make\u003cbr\\/\u003e\\n  sure we see a a concurrent thread (RawStoreDaemon) having to wait\u003cbr\\/\u003e\\n  for cleanup before proceeding, at least on my box. Cf. the debug\u003cbr\\/\u003e\\n  trace for derby.debug.true=RAF4Recovery, which I also added.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12931263_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931263_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Nov\\/10 23:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-11T23:22:00+0000\'\u003e11\\/Nov\\/10 23:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the review, Knut. Uploading a new version of the patch, \\nderby-4741-b-02-nio, details below, rerunning regressions. \\n\\n \\n\\t In RAFContainer4, folded the cases for pageNumber == -1 (call from \\n  getEmbryonicPage) with the case Thread.holdsLock(this). This allows \\n  awaitRestoreChannel to throw the retry exception for all cases. I \\n  did both static and dynamic analysis to establish invariant, and \\n  added a sane check for it. \\n \\n\\n\\n &gt; As far as I can see, the code will behave the same way as before if no \\n&gt; interrupt is detected. So if there are problems with the code, they \\n&gt; will hopefully be limited to the case where the thread is \\n&gt; interrupted. There\'s an additional container-wide synchronization on \\n&gt; every page read\\/write, though, which may possibly have a negative \\n&gt; effect on performance in multi-threaded environments. If that turns \\n&gt; out to be an issue, would it be possible to change the code to only \\n&gt; check restoreChannelInProgress after an exception has been thrown, \\n&gt; similar to what we currently do in stealth mode? \\n\\n Yes, I believe we could do that, since it should do no harm to attempt \\nthe IO even when recovery is in progress, because all calls to \\ngetChannel are synchronized on \\\"this\\\" already, so either the thread \\nsees the old channel (closed), or the new reopened channel. I didn\'t \\nmake this change yet, though, since the monitor hold should \\nshort-lived (one boolean check and an integer increment) compared to \\nthe IO. \\n\\n \\n\\t Thread.holdsLock(): done \\n\\t Created a new subclass of StandardException: \\n  InterruptDetectedException, good suggestion, indeed cleaner! \\n\\t Javadoc for RAFContainer4.readPage: done \\n\\t The variable \\\"whence\\\": removed \\n\\t Removed some commented out debugging cruft \\n\\t Tuned the number of iterations in InterruptDetectedException to make \\n  sure we see a a concurrent thread (RawStoreDaemon) having to wait \\n  for cleanup before proceeding, at least on my box. Cf. the debug \\n  trace for derby.debug.true=RAF4Recovery, which I also added. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931526\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12931526&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931526\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12931526_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931526_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/10 21:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-12T21:07:18+0000\'\u003e12\\/Nov\\/10 21:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 12\\/Nov\\/10 21:22\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFound that Derby uses interrupt to stop threads at shutdown\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e. The present logic in RAFContainer4 doesn\'t\u003cbr\\/\u003e\\ntake this into account, with the consequence that an application thread got stuck waiting for\u003cbr\\/\u003e\\na container recovery that never took place. We get an exception during execution of \u003cbr\\/\u003e\\n                       closeContainer();\u003cbr\\/\u003e\\n                        openContainer(currentIdentity);\u003cbr\\/\u003e\\nIf this exception is not due to an interrupt, we throw FILE_IO_INTERRUPTED. Unfortunately, in this case,\u003cbr\\/\u003e\\nthe present patch neglects to release any threads waiting for recovery to finish, so they are stuck waiting for \\\"restoreChannelInProgress\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eSaw this during suitesAll.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e BaseMonitor#shutdown \u003cdel\u003e&gt; notifyAllActiveThreads and in DatabaseContextImpl#cleanupOnError\u003c\\/del\u003e&gt;notifyAllActiveThreads\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12931526_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931526_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/10 21:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-12T21:07:18+0000\'\u003e12\\/Nov\\/10 21:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 12\\/Nov\\/10 21:22\\\"\u003eedited\u003c\\/span\u003e                   Found that Derby uses interrupt to stop threads at shutdown &#91;1&#93; . The present logic in RAFContainer4 doesn\'t \\ntake this into account, with the consequence that an application thread got stuck waiting for \\na container recovery that never took place. We get an exception during execution of  \\n                       closeContainer(); \\n                        openContainer(currentIdentity); \\nIf this exception is not due to an interrupt, we throw FILE_IO_INTERRUPTED. Unfortunately, in this case, \\nthe present patch neglects to release any threads waiting for recovery to finish, so they are stuck waiting for \\\"restoreChannelInProgress\\\". \\n\\n Saw this during suitesAll. \\n\\n  &#91;1&#93;  BaseMonitor#shutdown  &gt; notifyAllActiveThreads and in DatabaseContextImpl#cleanupOnError &gt;notifyAllActiveThreads              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931535\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12931535&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931535\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12931535_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931535_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/10 21:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-12T21:39:52+0000\'\u003e12\\/Nov\\/10 21:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis might sound wired. I am so happy you got this. I woke up to a hanging test for Suites.All and now I know why. Thank you so much for posting this and looking into this. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12931535_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931535_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/10 21:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-12T21:39:52+0000\'\u003e12\\/Nov\\/10 21:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This might sound wired. I am so happy you got this. I woke up to a hanging test for Suites.All and now I know why. Thank you so much for posting this and looking into this.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12931984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12931984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12931984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12931984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 05:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T05:21:19+0000\'\u003e15\\/Nov\\/10 05:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdd the following code in ClosedChannelException block in RAFContainer4.java-&gt;readPage and did not see any hang for Suites.All in Windows 7 enviornment:\u003cbr\\/\u003e\\n               if (pageNumber != -1L) \u003c\\/p\u003e\\n{\\n\\n                    \\/\\/ Recovery is in progress, wait for another interrupted thread\\n                    \\/\\/ to clean up.\\n                    awaitRestoreChannel(e, stealthMode);\\n                }\\n\u003cp\u003e else {\u003cbr\\/\u003e\\n                    \\/\\/ Called from this.getEmbryonicPage.\u003c\\/p\u003e\\n\\n\u003cp\u003e                    \\/\\/ Retry handled in RAFContainer#clean. This is\u003cbr\\/\u003e\\n                    \\/\\/ necessary since recovery needs the monitor on \\\"this\\\"\u003cbr\\/\u003e\\n                    \\/\\/ held by clean when it calls getEmbryonicPage via\u003cbr\\/\u003e\\n                    \\/\\/ writeRAFHeader, so never call awaitRestoreChannel\u003cbr\\/\u003e\\n                    \\/\\/ here, since then might be stuck on\u003cbr\\/\u003e\\n                    \\/\\/ channelCleanupMonitor held by another thread\u003cbr\\/\u003e\\n                    \\/\\/ cleaning up, while still hold onto \\\"this\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e                    if (stealthMode) \u003c\\/p\u003e\\n{\\n                        \\/\\/ don\'t touch threadsInPageIO\\n                    }\\n\u003cp\u003e else {\u003cbr\\/\u003e\\n                        synchronized (channelCleanupMonitor) \u003c\\/p\u003e\\n{\\n                            threadsInPageIO--;\\n                        }\\n\u003cp\u003e                    }\u003cbr\\/\u003e\\n                }\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12931984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12931984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 05:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T05:21:19+0000\'\u003e15\\/Nov\\/10 05:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Add the following code in ClosedChannelException block in RAFContainer4.java-&gt;readPage and did not see any hang for Suites.All in Windows 7 enviornment: \\n               if (pageNumber != -1L)  \\n{\\n\\n                    \\/\\/ Recovery is in progress, wait for another interrupted thread\\n                    \\/\\/ to clean up.\\n                    awaitRestoreChannel(e, stealthMode);\\n                }\\n  else { \\n                    \\/\\/ Called from this.getEmbryonicPage. \\n\\n                     \\/\\/ Retry handled in RAFContainer#clean. This is \\n                    \\/\\/ necessary since recovery needs the monitor on \\\"this\\\" \\n                    \\/\\/ held by clean when it calls getEmbryonicPage via \\n                    \\/\\/ writeRAFHeader, so never call awaitRestoreChannel \\n                    \\/\\/ here, since then might be stuck on \\n                    \\/\\/ channelCleanupMonitor held by another thread \\n                    \\/\\/ cleaning up, while still hold onto \\\"this\\\". \\n\\n                     if (stealthMode)  \\n{\\n                        \\/\\/ don\'t touch threadsInPageIO\\n                    }\\n  else { \\n                        synchronized (channelCleanupMonitor)  \\n{\\n                            threadsInPageIO--;\\n                        }\\n                     } \\n                }              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932148\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12932148&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932148\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12932148_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932148_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 19:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T19:01:14+0000\'\u003e15\\/Nov\\/10 19:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 15\\/Nov\\/10 19:08\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading patch b-03 which adds logic to RAFContainer4 to handle\u003cbr\\/\u003e\\nproperly the fact that a container can\'t be reopened:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/\\/ In case the recovering thread can\'t successfully recover the container,\u003cbr\\/\u003e\\n    \\/\\/ it will throw, so other waiting threads need to give up as well.  This\u003cbr\\/\u003e\\n    \\/\\/ can happen at shutdown time when interrupts are used to stop threads.\u003cbr\\/\u003e\\n    private boolean giveUpIO = false;\u003cbr\\/\u003e\\n    private final Object giveUpIOm = new Object(); \\/\\/ its monitor\u003c\\/p\u003e\\n\\n\u003cp\u003eWe make sure to notify any waiting threads when the recovering thread gives up and throws FILE_IO_INTERRUPTED. The waiting threads will next see giveUpIO == true, and give up as well.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis should make sure that threads not doing the recovery, will detect that recovery will not happen, and throw as well. SuitesAll finished successfully.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12932148_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932148_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 19:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T19:01:14+0000\'\u003e15\\/Nov\\/10 19:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 15\\/Nov\\/10 19:08\\\"\u003eedited\u003c\\/span\u003e                   Uploading patch b-03 which adds logic to RAFContainer4 to handle \\nproperly the fact that a container can\'t be reopened: \\n\\n     \\/\\/ In case the recovering thread can\'t successfully recover the container, \\n    \\/\\/ it will throw, so other waiting threads need to give up as well.  This \\n    \\/\\/ can happen at shutdown time when interrupts are used to stop threads. \\n    private boolean giveUpIO = false; \\n    private final Object giveUpIOm = new Object(); \\/\\/ its monitor \\n\\n We make sure to notify any waiting threads when the recovering thread gives up and throws FILE_IO_INTERRUPTED. The waiting threads will next see giveUpIO == true, and give up as well. \\n\\n This should make sure that threads not doing the recovery, will detect that recovery will not happen, and throw as well. SuitesAll finished successfully.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932150\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12932150&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932150\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12932150_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932150_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T19:06:59+0000\'\u003e15\\/Nov\\/10 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLily, it seems you reintroduced some of the logic I folded into awaitRestoreChannel, but without throwing to get retry for the case pageNumber == 1 (throw INTERRUPT_DETECTED).  I don\'t think this is correct, not sure why this made a difference. Can you try the latest patch on Windows 7? \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12932150_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932150_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T19:06:59+0000\'\u003e15\\/Nov\\/10 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lily, it seems you reintroduced some of the logic I folded into awaitRestoreChannel, but without throwing to get retry for the case pageNumber == 1 (throw INTERRUPT_DETECTED).  I don\'t think this is correct, not sure why this made a difference. Can you try the latest patch on Windows 7?                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933589\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12933589&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933589\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12933589_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933589_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 22:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T22:47:06+0000\'\u003e18\\/Nov\\/10 22:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have now run regressions with patch b-03 on Windows Vista SP2 without errors. Since the 10.7 branch has been cut, I intend to commit this patch soon, and move on the the next piece of the puzzle.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12933589_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933589_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 22:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T22:47:06+0000\'\u003e18\\/Nov\\/10 22:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have now run regressions with patch b-03 on Windows Vista SP2 without errors. Since the 10.7 branch has been cut, I intend to commit this patch soon, and move on the the next piece of the puzzle.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933598\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12933598&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933598\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12933598_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933598_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 22:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T22:58:44+0000\'\u003e18\\/Nov\\/10 22:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor reviewers of b-03, it may be interesting note that running InterruptResilienceTest with the flag -Dderby.debug.true=RAF4Recovery\u003cbr\\/\u003e\\nwill likely give one or more instances of this trace in derby.log:\u003c\\/p\u003e\\n\\n\u003cp\u003eDEBUG RAF4Recovery OUTPUT: derby.rawStoreDaemon thread needs to wait for container recovery: 0\u003c\\/p\u003e\\n\\n\u003cp\u003eshowing that this part of the multi threading synchronization is being exercised: The user that was interrupted is doing recovery on the channel so the\u003cbr\\/\u003e\\nthread printing this (i.e. RawStoreDaemon) has to wait for recovery to complete to be able to move on.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12933598_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933598_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 22:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T22:58:44+0000\'\u003e18\\/Nov\\/10 22:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For reviewers of b-03, it may be interesting note that running InterruptResilienceTest with the flag -Dderby.debug.true=RAF4Recovery \\nwill likely give one or more instances of this trace in derby.log: \\n\\n DEBUG RAF4Recovery OUTPUT: derby.rawStoreDaemon thread needs to wait for container recovery: 0 \\n\\n showing that this part of the multi threading synchronization is being exercised: The user that was interrupted is doing recovery on the channel so the \\nthread printing this (i.e. RawStoreDaemon) has to wait for recovery to complete to be able to move on.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933924\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12933924&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933924\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12933924_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933924_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/10 19:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-19T19:18:15+0000\'\u003e19\\/Nov\\/10 19:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag:\u003cbr\\/\u003e\\n     Thank you so much for all the detail message. The code looks good to me. I don\'t see potential issue. When I run insane build, I got 5.8 second for MicroAPITest and 51.x second for sane build vs 5.07s(insane) and 47.xs(sane) build on clean trunk. It could be just Windows platform issue.  \u003cbr\\/\u003e\\n      +1 to check in to trunk.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12933924_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933924_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/10 19:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-19T19:18:15+0000\'\u003e19\\/Nov\\/10 19:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag: \\n     Thank you so much for all the detail message. The code looks good to me. I don\'t see potential issue. When I run insane build, I got 5.8 second for MicroAPITest and 51.x second for sane build vs 5.07s(insane) and 47.xs(sane) build on clean trunk. It could be just Windows platform issue.   \\n      +1 to check in to trunk.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12934082\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12934082&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12934082\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12934082_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12934082_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/10 02:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-20T02:26:30+0000\'\u003e20\\/Nov\\/10 02:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 20\\/Nov\\/10 02:27\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHI Lily! Thanks! I\'ll commit it soon after I have verified a debug trace for observing the effects of the giveUpIO logic.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12934082_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12934082_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Nov\\/10 02:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-20T02:26:30+0000\'\u003e20\\/Nov\\/10 02:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 20\\/Nov\\/10 02:27\\\"\u003eedited\u003c\\/span\u003e                   HI Lily! Thanks! I\'ll commit it soon after I have verified a debug trace for observing the effects of the giveUpIO logic.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12935169\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12935169&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12935169\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12935169_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935169_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 01:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T01:56:34+0000\'\u003e24\\/Nov\\/10 01:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading b-04, which cleans up and adds some more debug tracing to RAFContainer4. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12935169_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935169_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 01:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T01:56:34+0000\'\u003e24\\/Nov\\/10 01:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading b-04, which cleans up and adds some more debug tracing to RAFContainer4.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12935172\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12935172&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12935172\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12935172_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935172_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 02:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T02:03:25+0000\'\u003e24\\/Nov\\/10 02:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted b-04 as svn 1038440. Note: I changed the debug trace flag to \\\"RAF4\\\" to accommodate an exisiting trace not related to recovery.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12935172_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12935172_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Nov\\/10 02:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-24T02:03:25+0000\'\u003e24\\/Nov\\/10 02:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed b-04 as svn 1038440. Note: I changed the debug trace flag to \\\"RAF4\\\" to accommodate an exisiting trace not related to recovery.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12964612\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12964612&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12964612\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12964612_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12964612_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/10 00:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-29T00:46:16+0000\'\u003e29\\/Nov\\/10 00:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 29\\/Nov\\/10 00:50\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch (derby-4741-c-01-nio) closes two corner cases I have\u003cbr\\/\u003e\\nobserved when stress testing the RAFContainer4 recovery mechanism. It\u003cbr\\/\u003e\\ndoes some other small cleanups. Regressions ran OK.\u003c\\/p\u003e\\n\\n\u003cp\u003eRAFContainer:\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we receive an interrupt when the container is first being opened\u003cbr\\/\u003e\\n(i.e. during RAFContainer.run (OPEN_CONTAINER_ACTION) -&gt;\u003cbr\\/\u003e\\ngetEmbryonicPage), recovery will fail because currentIdentity needed\u003cbr\\/\u003e\\nin RAFContainer4#recoverContainerAfterInterrupt hasn\'t yet been\u003cbr\\/\u003e\\nset. \u003c\\/p\u003e\\n\\n\u003cp\u003eRAFContainer4:\u003c\\/p\u003e\\n\\n\u003cp\u003eIf a stealthMode read is interrupted and is recovering the container,\u003cbr\\/\u003e\\nit erroneously increments threadsInPageIO just before exiting to retry\u003cbr\\/\u003e\\nIO. This leads to a break in the invariant that threadsInPageIO be 0\u003cbr\\/\u003e\\nwhen all threads are done, causing issue (hang) down the line.  \u003c\\/p\u003e\\n\\n\u003cp\u003eIf, when we are reopening the container, the read being done during\u003cbr\\/\u003e\\nthat operation (getEmbryonicPage), that stealth mode read will also\u003cbr\\/\u003e\\nlead to a (recursive) recovery. We have to catch this case by adding a\u003cbr\\/\u003e\\n\\\"catch (InterruptDetectedException e)\\\" just after the call to\u003cbr\\/\u003e\\nopenContainer, not by testing the interrupt flag as presently done,\u003cbr\\/\u003e\\nsince the recovery inside the recursive call to\u003cbr\\/\u003e\\ngetEmbryonicPage\\/readPage will already have cleared the flag and done\u003cbr\\/\u003e\\nrecovery.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen giving up reopening the container for some reason, we also forgot\u003cbr\\/\u003e\\nto decrement threadsInPageIO.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo guard against other hangs, I will make the while-true loops max out\u003cbr\\/\u003e\\nin all cases. But before I commit that change, it would be nice to see\u003cbr\\/\u003e\\nif this patch has any impact on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920\\\" title=\\\"suites.All stuck in RAFContainer4.awaitRestoreChannel()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4920\\\"\u003e\u003cdel\u003eDERBY-4920\u003c\\/del\u003e\u003c\\/a\u003e (I suspect not). The reason\u003cbr\\/\u003e\\nI\'d like to hold off with that is that since \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920\\\" title=\\\"suites.All stuck in RAFContainer4.awaitRestoreChannel()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4920\\\"\u003e\u003cdel\u003eDERBY-4920\u003c\\/del\u003e\u003c\\/a\u003e occurs during\u003cbr\\/\u003e\\nshutdown, that may mask the fact that recovery failed, cf. my comment\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920?focusedCommentId=12936016&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12936016\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920?focusedCommentId=12936016&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12936016\u003c\\/a\u003e\u003cbr\\/\u003e\\nSo, I\'d rather wait with that till I get \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920\\\" title=\\\"suites.All stuck in RAFContainer4.awaitRestoreChannel()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4920\\\"\u003e\u003cdel\u003eDERBY-4920\u003c\\/del\u003e\u003c\\/a\u003e  out of the way.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12964612_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12964612_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/10 00:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-29T00:46:16+0000\'\u003e29\\/Nov\\/10 00:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 29\\/Nov\\/10 00:50\\\"\u003eedited\u003c\\/span\u003e                   This patch (derby-4741-c-01-nio) closes two corner cases I have \\nobserved when stress testing the RAFContainer4 recovery mechanism. It \\ndoes some other small cleanups. Regressions ran OK. \\n\\n RAFContainer: \\n\\n If we receive an interrupt when the container is first being opened \\n(i.e. during RAFContainer.run (OPEN_CONTAINER_ACTION) -&gt; \\ngetEmbryonicPage), recovery will fail because currentIdentity needed \\nin RAFContainer4#recoverContainerAfterInterrupt hasn\'t yet been \\nset.  \\n\\n RAFContainer4: \\n\\n If a stealthMode read is interrupted and is recovering the container, \\nit erroneously increments threadsInPageIO just before exiting to retry \\nIO. This leads to a break in the invariant that threadsInPageIO be 0 \\nwhen all threads are done, causing issue (hang) down the line.   \\n\\n If, when we are reopening the container, the read being done during \\nthat operation (getEmbryonicPage), that stealth mode read will also \\nlead to a (recursive) recovery. We have to catch this case by adding a \\n\\\"catch (InterruptDetectedException e)\\\" just after the call to \\nopenContainer, not by testing the interrupt flag as presently done, \\nsince the recovery inside the recursive call to \\ngetEmbryonicPage\\/readPage will already have cleared the flag and done \\nrecovery. \\n\\n When giving up reopening the container for some reason, we also forgot \\nto decrement threadsInPageIO. \\n\\n To guard against other hangs, I will make the while-true loops max out \\nin all cases. But before I commit that change, it would be nice to see \\nif this patch has any impact on   DERBY-4920   (I suspect not). The reason \\nI\'d like to hold off with that is that since   DERBY-4920   occurs during \\nshutdown, that may mask the fact that recovery failed, cf. my comment \\n https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920?focusedCommentId=12936016&amp;page=com.atlassian.jira.plugin.system.issuetabpanels%3Acomment-tabpanel#action_12936016  \\nSo, I\'d rather wait with that till I get   DERBY-4920    out of the way.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12964723\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12964723&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12964723\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12964723_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12964723_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/10 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-29T12:32:23+0000\'\u003e29\\/Nov\\/10 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted derby-4741-c-01-nio as svn 1040086. Please let me know if you still see the hang of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920\\\" title=\\\"suites.All stuck in RAFContainer4.awaitRestoreChannel()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4920\\\"\u003e\u003cdel\u003eDERBY-4920\u003c\\/del\u003e\u003c\\/a\u003e and, if possible, during execution which test it happens.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12964723_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12964723_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Nov\\/10 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-29T12:32:23+0000\'\u003e29\\/Nov\\/10 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed derby-4741-c-01-nio as svn 1040086. Please let me know if you still see the hang of   DERBY-4920   and, if possible, during execution which test it happens.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12968724\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12968724&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12968724\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12968724_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12968724_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/10 13:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-07T13:31:25+0000\'\u003e07\\/Dec\\/10 13:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHappened to look at parts of the new code, and have a few questions\\/comments on code in RAF4Container:\u003cbr\\/\u003e\\n o in writeFull the variables beforeOpen and beforeInterrupt are unused. Can they be removed?\u003cbr\\/\u003e\\n o the same issue in readFull.\u003cbr\\/\u003e\\n o would it make sense to make the monitor object channelCleanupMonitor final?\u003cbr\\/\u003e\\n o redundant call to Thread.currentThread when invoking holdsLock.\u003cbr\\/\u003e\\n o missing JavaDoc for recoverContainerAfterInterrupt\u003c\\/p\u003e\\n\\n\u003cp\u003eA more theoretical question at the end.\u003cbr\\/\u003e\\nIs there a reason to explicitly define instance variables with the default value for the data type?\u003cbr\\/\u003e\\nI.e., int i = 0, boolean b = false.\u003cbr\\/\u003e\\nJust asking, as I find it annoying to step through these in the debugger \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12968724_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12968724_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/10 13:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-07T13:31:25+0000\'\u003e07\\/Dec\\/10 13:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Happened to look at parts of the new code, and have a few questions\\/comments on code in RAF4Container: \\n o in writeFull the variables beforeOpen and beforeInterrupt are unused. Can they be removed? \\n o the same issue in readFull. \\n o would it make sense to make the monitor object channelCleanupMonitor final? \\n o redundant call to Thread.currentThread when invoking holdsLock. \\n o missing JavaDoc for recoverContainerAfterInterrupt \\n\\n A more theoretical question at the end. \\nIs there a reason to explicitly define instance variables with the default value for the data type? \\nI.e., int i = 0, boolean b = false. \\nJust asking, as I find it annoying to step through these in the debugger                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969019\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12969019&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969019\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969019_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969019_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/10 21:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-07T21:40:14+0000\'\u003e07\\/Dec\\/10 21:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 07\\/Dec\\/10 21:41\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for looking at the new code, Kristian, I\'ll make a new patch to cater for your comments.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; o in writeFull the variables beforeOpen and beforeInterrupt are unused. Can they be removed?\u003cbr\\/\u003e\\n&gt;  o the same issue in readFull.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbsolutely, debugging cruft. Thanks for spotting those.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;  o would it make sense to make the monitor object channelCleanupMonitor final?\u003c\\/p\u003e\\n\\n\u003cp\u003eAbsolutely.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;  o redundant call to Thread.currentThread when invoking holdsLock.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks, thought I had cleaned out those, but there were two left!\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;  o missing JavaDoc for recoverContainerAfterInterrupt\u003c\\/p\u003e\\n\\n\u003cp\u003eAdded Javadoc for recoverContainerAfterInterrupt and awaitRestoreChannel.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; A more theoretical question at the end.  Is there a reason to\u003cbr\\/\u003e\\n&gt; explicitly define instance variables with the default value for the\u003cbr\\/\u003e\\n&gt; data type?  I.e., int i = 0, boolean b = false.\u003c\\/p\u003e\\n\\n\u003cp\u003eNo. I tend to often use explicit initialization due to my paranoid\u003cbr\\/\u003e\\nstreak I guess. I see the data flow analysis barks if you use a local\u003cbr\\/\u003e\\nvariable uninitialized, although not for a class member, not clear to\u003cbr\\/\u003e\\nme why Java differentiates here.\u003c\\/p\u003e\\n\\n\u003cp\u003epublic class Foo {\u003cbr\\/\u003e\\n    public boolean bb;\u003c\\/p\u003e\\n\\n\u003cp\u003e    public static void main(String[] args) {\u003cbr\\/\u003e\\n        boolean b;\u003c\\/p\u003e\\n\\n\u003cp\u003e        if (args.length &gt; 0 &amp;&amp; args\u003cspan class=\\\"error\\\"\u003e&#91;0&#93;\u003c\\/span\u003e.equals(\\\"foo\\\")) \u003c\\/p\u003e\\n{\\n            b = true;\\n        }\\n\\n\u003cp\u003e        if (b) \u003c\\/p\u003e\\n{ \\/\\/ compiler barks\\n            System.err.println(\\\"b is true\\\"); \\n        }\\n\\n\u003cp\u003e        Foo f = new Foo();\u003cbr\\/\u003e\\n        if (f.bb) \u003c\\/p\u003e\\n{ \\/\\/ OK\\n            System.err.println(\\\"bb is true\\\");\\n        }\\n\\n\u003cp\u003e    }\u003cbr\\/\u003e\\n}\u003c\\/p\u003e\\n\\n\u003cp\u003eI guess I have tended to treat them the same. I\'ll try to improve \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969019_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969019_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/10 21:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-07T21:40:14+0000\'\u003e07\\/Dec\\/10 21:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 07\\/Dec\\/10 21:41\\\"\u003eedited\u003c\\/span\u003e                   Thanks for looking at the new code, Kristian, I\'ll make a new patch to cater for your comments. \\n\\n &gt; o in writeFull the variables beforeOpen and beforeInterrupt are unused. Can they be removed? \\n&gt;  o the same issue in readFull. \\n\\n Absolutely, debugging cruft. Thanks for spotting those. \\n\\n &gt;  o would it make sense to make the monitor object channelCleanupMonitor final? \\n\\n Absolutely. \\n\\n &gt;  o redundant call to Thread.currentThread when invoking holdsLock. \\n\\n Thanks, thought I had cleaned out those, but there were two left! \\n\\n &gt;  o missing JavaDoc for recoverContainerAfterInterrupt \\n\\n Added Javadoc for recoverContainerAfterInterrupt and awaitRestoreChannel. \\n\\n &gt; A more theoretical question at the end.  Is there a reason to \\n&gt; explicitly define instance variables with the default value for the \\n&gt; data type?  I.e., int i = 0, boolean b = false. \\n\\n No. I tend to often use explicit initialization due to my paranoid \\nstreak I guess. I see the data flow analysis barks if you use a local \\nvariable uninitialized, although not for a class member, not clear to \\nme why Java differentiates here. \\n\\n public class Foo { \\n    public boolean bb; \\n\\n     public static void main(String[] args) { \\n        boolean b; \\n\\n         if (args.length &gt; 0 &amp;&amp; args &#91;0&#93; .equals(\\\"foo\\\"))  \\n{\\n            b = true;\\n        }\\n\\n         if (b)  \\n{ \\/\\/ compiler barks\\n            System.err.println(\\\"b is true\\\"); \\n        }\\n\\n         Foo f = new Foo(); \\n        if (f.bb)  \\n{ \\/\\/ OK\\n            System.err.println(\\\"bb is true\\\");\\n        }\\n\\n     } \\n} \\n\\n I guess I have tended to treat them the same. I\'ll try to improve   \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969041\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12969041&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969041\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969041_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969041_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/10 22:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-07T22:15:49+0000\'\u003e07\\/Dec\\/10 22:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading derby-4741-kristians-01, running regressions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969041_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969041_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Dec\\/10 22:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-07T22:15:49+0000\'\u003e07\\/Dec\\/10 22:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading derby-4741-kristians-01, running regressions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969252\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12969252&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969252\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12969252_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969252_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 09:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T09:16:52+0000\'\u003e08\\/Dec\\/10 09:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Dag.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I guess I have tended to treat them the same. I\'ll try to improve \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eNot sure there is something to improve here, I guess this is a question about personal preference.\u003cbr\\/\u003e\\nExplicit initialization of instance variables used to result in two assignments (first the default value for the type, and then the explicit value), which is kind of unnecessary if both assignments use the same value. I don\'t know if this is still the case.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd I have become quite accustomed to use the \\\"Step over\\\" or \\\"Run to cursor\\\" in the debugger \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nFinally, if the initial value isn\'t the default for the data type, then you have to assign the correct value anyway - either in the constructor or as an instance variable initializer (i.e. private int i = 3).\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eThanks for working on the interrupt issue! I think it is of great value for Derby to be able to handle interrupts better. This is especially important when\\/if other software products used together with Derby use Thread.interrupt() internally.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12969252_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969252_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 09:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T09:16:52+0000\'\u003e08\\/Dec\\/10 09:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Dag. \\n\\n &gt; I guess I have tended to treat them the same. I\'ll try to improve   \\n\\n Not sure there is something to improve here, I guess this is a question about personal preference. \\nExplicit initialization of instance variables used to result in two assignments (first the default value for the type, and then the explicit value), which is kind of unnecessary if both assignments use the same value. I don\'t know if this is still the case. \\n\\n And I have become quite accustomed to use the \\\"Step over\\\" or \\\"Run to cursor\\\" in the debugger   \\nFinally, if the initial value isn\'t the default for the data type, then you have to assign the correct value anyway - either in the constructor or as an instance variable initializer (i.e. private int i = 3). \\n\\n\\n Thanks for working on the interrupt issue! I think it is of great value for Derby to be able to handle interrupts better. This is especially important when\\/if other software products used together with Derby use Thread.interrupt() internally.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969530\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12969530&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969530\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969530_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969530_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 22:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T22:24:45+0000\'\u003e08\\/Dec\\/10 22:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 08\\/Dec\\/10 22:25\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhile I am looking for the Heisenbug in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4920\\\" title=\\\"suites.All stuck in RAFContainer4.awaitRestoreChannel()\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4920\\\"\u003e\u003cdel\u003eDERBY-4920\u003c\\/del\u003e\u003c\\/a\u003e, I am considering the next increment of this patch from the\u003cbr\\/\u003e\\nprototype patch regarding the issues seen when interrupt hits the logging machinery (mostly not NIO, except for the case of DirRandomAccessFile#sync).\u003cbr\\/\u003e\\nNow, it turns out that the vulnerability here only applies for Solaris. Other platforms\' \\\"non-NIO\\\" IO is not interruptible, so for those other platforms there is no need to do anything special. For Solaris, the behavior can be tweaked to be impervious to interrupts as well using the special switch: -XX:-UseVMInterruptibleIO on JVMs &gt;= 1.5.0_12. This behavior will be default in 1.7 also on Solaris\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e.\u003cbr\\/\u003e\\nSo the question becomes, would it be sufficient to advise users to run with this switch set, or should we make Derby tolerate\u003cbr\\/\u003e\\nthe interrupts on Solaris here also? \u003c\\/p\u003e\\n\\n\u003cp\u003eI do think we should be able to run correctly with the default settings on all relevant platforms, but I would appricate your opinions.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;1&#93;\u003c\\/span\u003e \u003ca href=\\\"http:\\/\\/bugs.sun.com\\/bugdatabase\\/view_bug.do?bug_id=4385444\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/bugs.sun.com\\/bugdatabase\\/view_bug.do?bug_id=4385444\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969530_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969530_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 22:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T22:24:45+0000\'\u003e08\\/Dec\\/10 22:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 08\\/Dec\\/10 22:25\\\"\u003eedited\u003c\\/span\u003e                   While I am looking for the Heisenbug in   DERBY-4920  , I am considering the next increment of this patch from the \\nprototype patch regarding the issues seen when interrupt hits the logging machinery (mostly not NIO, except for the case of DirRandomAccessFile#sync). \\nNow, it turns out that the vulnerability here only applies for Solaris. Other platforms\' \\\"non-NIO\\\" IO is not interruptible, so for those other platforms there is no need to do anything special. For Solaris, the behavior can be tweaked to be impervious to interrupts as well using the special switch: -XX:-UseVMInterruptibleIO on JVMs &gt;= 1.5.0_12. This behavior will be default in 1.7 also on Solaris &#91;1&#93; . \\nSo the question becomes, would it be sufficient to advise users to run with this switch set, or should we make Derby tolerate \\nthe interrupts on Solaris here also?  \\n\\n I do think we should be able to run correctly with the default settings on all relevant platforms, but I would appricate your opinions. \\n\\n  &#91;1&#93;   http:\\/\\/bugs.sun.com\\/bugdatabase\\/view_bug.do?bug_id=4385444               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969576\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12969576&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969576\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969576_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969576_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/10 00:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-09T00:36:22+0000\'\u003e09\\/Dec\\/10 00:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted derby-4741-kristians-01 as svn 1043802 (suitesAll ran ok).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12969576_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969576_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/10 00:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-09T00:36:22+0000\'\u003e09\\/Dec\\/10 00:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed derby-4741-kristians-01 as svn 1043802 (suitesAll ran ok).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969711\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12969711&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969711\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12969711_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969711_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/10 12:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-09T12:16:04+0000\'\u003e09\\/Dec\\/10 12:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; So the question becomes, would it be sufficient to advise users to run with this switch set, or should we make Derby tolerate\u003cbr\\/\u003e\\n&gt; the interrupts on Solaris here also?\u003c\\/p\u003e\\n\\n\u003cp\u003eHow much code do you think will be needed to handle that case? Handling interrupts sent to the engine is somewhat of an edge case in itself. Since this particular problem only affects one platform, and that platform will start behaving the same way as the other platforms in the not so distant future, it sounds acceptable to just advise those who come across the problem to set the flag. Of course it would be nice if Derby was well-behaved by default on all platforms, but given the easy workaround and the expectation that the problem will soon go away by itself, I\'d say that it\'s probably not worth putting a lot of work into and\\/or adding more complexity to already complex code.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12969711_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969711_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Dec\\/10 12:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-09T12:16:04+0000\'\u003e09\\/Dec\\/10 12:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; So the question becomes, would it be sufficient to advise users to run with this switch set, or should we make Derby tolerate \\n&gt; the interrupts on Solaris here also? \\n\\n How much code do you think will be needed to handle that case? Handling interrupts sent to the engine is somewhat of an edge case in itself. Since this particular problem only affects one platform, and that platform will start behaving the same way as the other platforms in the not so distant future, it sounds acceptable to just advise those who come across the problem to set the flag. Of course it would be nice if Derby was well-behaved by default on all platforms, but given the easy workaround and the expectation that the problem will soon go away by itself, I\'d say that it\'s probably not worth putting a lot of work into and\\/or adding more complexity to already complex code.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12977533\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12977533&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12977533\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12977533_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12977533_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/11 23:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-04T23:38:53+0000\'\u003e04\\/Jan\\/11 23:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your thoughts on this, Knut.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is another issue: The NIO Channel#force call is used to implement sync when we flush the Derby log, cf. this call: \u003c\\/p\u003e\\n\\n\u003cp\u003eLogToFile#flush -&gt; LogAccessFile#syncLogAccessFile -&gt; StorageRandomAccessFile#sync -&gt; getChannel().force(false)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe \\\"false\\\" here allows the skipping of flushing metadata, which makes this faster (at least on Solaris) than the non-NIO\u003cbr\\/\u003e\\nimplementation of StorageRandomAccessFile#sync, which uses getFD().sync().\u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately, an interrupt will make the getChannel().force call throw ClosedChannelException, and I can\'t see an easy way\u003cbr\\/\u003e\\nto recover from this, except assuming the log is corrupt and shutting down the database instance, so we can recover on reboot.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we switch back to using \\\"getFD().sync()\\\", we would lose the performance optimization, but be resilient to interrupts.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo, unless somebody can see a way to finesse this problem, should be offer a knob to allow a user to trade this performance optimization for interrupt resilience?\u003c\\/p\u003e\\n\\n\u003cp\u003eAside: we also use StorageRandomAccessFile#sync in many other places, but in those situations I find I am able to recover by closing the RAF, reopening and writing over again, since the data to be written is known, e.g. in LogToFile#initLogFile. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12977533_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12977533_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Jan\\/11 23:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-04T23:38:53+0000\'\u003e04\\/Jan\\/11 23:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your thoughts on this, Knut. \\n\\n Here is another issue: The NIO Channel#force call is used to implement sync when we flush the Derby log, cf. this call:  \\n\\n LogToFile#flush -&gt; LogAccessFile#syncLogAccessFile -&gt; StorageRandomAccessFile#sync -&gt; getChannel().force(false) \\n\\n The \\\"false\\\" here allows the skipping of flushing metadata, which makes this faster (at least on Solaris) than the non-NIO \\nimplementation of StorageRandomAccessFile#sync, which uses getFD().sync(). \\n\\n Unfortunately, an interrupt will make the getChannel().force call throw ClosedChannelException, and I can\'t see an easy way \\nto recover from this, except assuming the log is corrupt and shutting down the database instance, so we can recover on reboot. \\n\\n If we switch back to using \\\"getFD().sync()\\\", we would lose the performance optimization, but be resilient to interrupts. \\n\\n So, unless somebody can see a way to finesse this problem, should be offer a knob to allow a user to trade this performance optimization for interrupt resilience? \\n\\n Aside: we also use StorageRandomAccessFile#sync in many other places, but in those situations I find I am able to recover by closing the RAF, reopening and writing over again, since the data to be written is known, e.g. in LogToFile#initLogFile.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12977862\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12977862&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12977862\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12977862_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12977862_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jan\\/11 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-05T17:25:40+0000\'\u003e05\\/Jan\\/11 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 05\\/Jan\\/11 17:26\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI find that explicit file sync (i.e. not \\\"write sync\\\") is only used if:\u003c\\/p\u003e\\n\\n\u003cp\u003ea) NIO is not supported  (cf. WritableStorageFactory#supportsWriteSync), in which case we never use FileChannel#force\u003cbr\\/\u003e\\nb) derby.storage.fileSyncTransactionLog is set to true\u003cbr\\/\u003e\\nc) we are running on platforms\\/VMs that don\'t support opening a file with mask \\\"rws\\\" (write sync with metadata) and \\\"rwd\\\" (write sync without metadata), cf. check in LogToFile#openLogFileInWriteMode which calls checkJvmSyncError to determine this. The platforms mentioned are (e.g. early versions of 1.4.2 and 1.5 on Mac OS and FreeBSD).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf this holds, it seems to be we can just skip using the NIO version of RAF#sync for those platforms. Other platforms do not use the explicit file sync for the log, cf. the test in LogToFile#flush (snip):\u003c\\/p\u003e\\n\\n\u003cp\u003e    if (isWriteSynced)\u003c\\/p\u003e\\n    {\\n        \\/\\/LogAccessFile.flushDirtyBuffers() will allow only one write\\n        \\/\\/sync at a time, flush requests will get queued \\n        logOut.flushDirtyBuffers();\\n    }\\n\u003cp\u003e    else\u003c\\/p\u003e\\n    {\\n        if (!logNotSynced)\\n        logOut.syncLogAccessFile();\\n    }\\n\\n\u003cp\u003eOn most platforms, isWriteSynced is true (cf above), meaning syncLogAccessFile is not used, so reverting to a interrupt safe, less performant non-NIO sync in syncLogAccessFile seems acceptable to me. Opinions?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12977862_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12977862_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jan\\/11 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-05T17:25:40+0000\'\u003e05\\/Jan\\/11 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 05\\/Jan\\/11 17:26\\\"\u003eedited\u003c\\/span\u003e                   I find that explicit file sync (i.e. not \\\"write sync\\\") is only used if: \\n\\n a) NIO is not supported  (cf. WritableStorageFactory#supportsWriteSync), in which case we never use FileChannel#force \\nb) derby.storage.fileSyncTransactionLog is set to true \\nc) we are running on platforms\\/VMs that don\'t support opening a file with mask \\\"rws\\\" (write sync with metadata) and \\\"rwd\\\" (write sync without metadata), cf. check in LogToFile#openLogFileInWriteMode which calls checkJvmSyncError to determine this. The platforms mentioned are (e.g. early versions of 1.4.2 and 1.5 on Mac OS and FreeBSD). \\n\\n If this holds, it seems to be we can just skip using the NIO version of RAF#sync for those platforms. Other platforms do not use the explicit file sync for the log, cf. the test in LogToFile#flush (snip): \\n\\n     if (isWriteSynced) \\n    {\\n        \\/\\/LogAccessFile.flushDirtyBuffers() will allow only one write\\n        \\/\\/sync at a time, flush requests will get queued \\n        logOut.flushDirtyBuffers();\\n    }\\n     else \\n    {\\n        if (!logNotSynced)\\n        logOut.syncLogAccessFile();\\n    }\\n\\n On most platforms, isWriteSynced is true (cf above), meaning syncLogAccessFile is not used, so reverting to a interrupt safe, less performant non-NIO sync in syncLogAccessFile seems acceptable to me. Opinions?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12977944\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12977944&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12977944\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12977944_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12977944_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jan\\/11 20:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-05T20:03:07+0000\'\u003e05\\/Jan\\/11 20:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree with the tradeoff you suggest concerning syncing the log file.  It seems to make the code easier and will not really affect most users running on modern platforms while still allowing those few to still work correctly on back releases.  This especially seems to make sense as I don\'t see us backporting this change so should only affect 10.8.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12977944_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12977944_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jan\\/11 20:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-05T20:03:07+0000\'\u003e05\\/Jan\\/11 20:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree with the tradeoff you suggest concerning syncing the log file.  It seems to make the code easier and will not really affect most users running on modern platforms while still allowing those few to still work correctly on back releases.  This especially seems to make sense as I don\'t see us backporting this change so should only affect 10.8.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980163\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12980163&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980163\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980163_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980163_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T16:21:49+0000\'\u003e11\\/Jan\\/11 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Mike. Logged and fixed \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4963\\\" title=\\\"Revert to FileDescriptor#sync from FileChannel#force to improve interrupt resilience\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4963\\\"\u003e\u003cdel\u003eDERBY-4963\u003c\\/del\u003e\u003c\\/a\u003e to revert NIO version of RAF#sync.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980163_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980163_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T16:21:49+0000\'\u003e11\\/Jan\\/11 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Mike. Logged and fixed   DERBY-4963   to revert NIO version of RAF#sync.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980189\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12980189&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980189\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980189_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980189_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T17:15:08+0000\'\u003e11\\/Jan\\/11 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted a followup patch as svn 1057733. Quoting the commit entry:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Followup to patch derby-4741-b-04-nio committed as svn 1038440:\u003cbr\\/\u003e\\n&gt; changed the string internal exception string \\\"nospc.U\\\" to \\\"intrp.U\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980189_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980189_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 17:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T17:15:08+0000\'\u003e11\\/Jan\\/11 17:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed a followup patch as svn 1057733. Quoting the commit entry: \\n\\n &gt; Followup to patch derby-4741-b-04-nio committed as svn 1038440: \\n&gt; changed the string internal exception string \\\"nospc.U\\\" to \\\"intrp.U\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980831\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12980831&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980831\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980831_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980831_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T17:56:23+0000\'\u003e12\\/Jan\\/11 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 14\\/Jan\\/11 21:30\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a patch derby-4741-sleeps-waits-1 which adds handling of some cases of interrupted monitor wait calls and Thread.sleep calls which I found needed changes to make my preliminary tests work. Running regressions.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are remaining places (i.e. usages for wait &amp; sleep) in the code base which need to be inspected for modification.  I will be making one or more follow-up patches to handle those. With the current patch\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e this work is approaching a state where Derby embedded(**) is sufficiently robust against interrupts that I will move to buillding systematic as well as randomized tests, and plug remaining holes as we find them.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e After commits of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4967\\\" title=\\\"Handle interrupt received while waiting for database lock\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4967\\\"\u003e\u003cdel\u003eDERBY-4967\u003c\\/del\u003e\u003c\\/a\u003e and \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4968\\\" title=\\\"Let query stop execution if an interrupt is seen, at same time as we check the query timeout\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4968\\\"\u003e\u003cdel\u003eDERBY-4968\u003c\\/del\u003e\u003c\\/a\u003e\u003cbr\\/\u003e\\n(**) the server code needs consideration too, as well as the client code and replication.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980831_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980831_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T17:56:23+0000\'\u003e12\\/Jan\\/11 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 14\\/Jan\\/11 21:30\\\"\u003eedited\u003c\\/span\u003e                   Uploading a patch derby-4741-sleeps-waits-1 which adds handling of some cases of interrupted monitor wait calls and Thread.sleep calls which I found needed changes to make my preliminary tests work. Running regressions. \\n\\n There are remaining places (i.e. usages for wait &amp; sleep) in the code base which need to be inspected for modification.  I will be making one or more follow-up patches to handle those. With the current patch  this work is approaching a state where Derby embedded(**) is sufficiently robust against interrupts that I will move to buillding systematic as well as randomized tests, and plug remaining holes as we find them. \\n\\n   After commits of   DERBY-4967   and   DERBY-4968   \\n(**) the server code needs consideration too, as well as the client code and replication.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12980984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 22:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T22:50:08+0000\'\u003e12\\/Jan\\/11 22:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003esuites.All passed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12980984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 22:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T22:50:08+0000\'\u003e12\\/Jan\\/11 22:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    suites.All passed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12981932\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12981932&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12981932\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12981932_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12981932_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/11 21:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-14T21:29:14+0000\'\u003e14\\/Jan\\/11 21:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 14\\/Jan\\/11 21:38\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSome details on where patch derby-4741-sleeps-waits-1 changes things.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe following locations where we earlier threw 08000 (CONN_INTERRUPT),\u003cbr\\/\u003e\\nwe now just note that an interrupt occurred:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eGenericStatement#prepare:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for another thread to complete the compilation of\u003cbr\\/\u003e\\n    the statement\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eLogToFile\u003cbr\\/\u003e\\n  #checkpointWithTran:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for another thread to complete a checkpoint\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #switchLogFile: \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for a semaphore needed to make sure the log switch\u003cbr\\/\u003e\\n    can complete \\\"without having to give up the semaphore to a backup\u003cbr\\/\u003e\\n    or another flusher\\\".\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #flush:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for the database to stop being frozen\u003c\\/li\u003e\\n\\t\u003cli\u003ewhile waiting for another thread flushing\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #syncFile\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting a bit before retrying a failed sync call\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #startLogBackup\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for a thread doing checkpointing before we start\u003cbr\\/\u003e\\n    backup of log as part of online-backup\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe following locations previously silently swallowed the interrupt, we\u003cbr\\/\u003e\\nnow (also) note that an interrupt occurred:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eLogToFile\u003cbr\\/\u003e\\n  #recover:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ein slave replication mode, while waiting for fail-over. This code\u003cbr\\/\u003e\\n    swallowed the interrupt\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #getLogFileAtBeginning:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ein slave replication mode, while waiting for SlaveFactory to tell\u003cbr\\/\u003e\\n    the thread to do recovery. This code swallowed the interrupt\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eBasePage:\u003cbr\\/\u003e\\n  #setExclusive:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for an exclusive latch\u003c\\/li\u003e\\n\\t\u003cli\u003ewhile waiting for cleaner to finish\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #setExclusiveNoWait\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting for cleaner to finish\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12981932_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12981932_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/11 21:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-14T21:29:14+0000\'\u003e14\\/Jan\\/11 21:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 14\\/Jan\\/11 21:38\\\"\u003eedited\u003c\\/span\u003e                   Some details on where patch derby-4741-sleeps-waits-1 changes things. \\n\\n The following locations where we earlier threw 08000 (CONN_INTERRUPT), \\nwe now just note that an interrupt occurred: \\n\\n \\n\\t GenericStatement#prepare: \\n \\n \\n\\t while waiting for another thread to complete the compilation of \\n    the statement \\n \\n\\n\\n \\n\\t LogToFile \\n  #checkpointWithTran: \\n \\n \\n\\t while waiting for another thread to complete a checkpoint \\n \\n\\n\\n   #switchLogFile:  \\n \\n\\t while waiting for a semaphore needed to make sure the log switch \\n    can complete \\\"without having to give up the semaphore to a backup \\n    or another flusher\\\". \\n \\n\\n\\n   #flush: \\n \\n\\t while waiting for the database to stop being frozen \\n\\t while waiting for another thread flushing \\n \\n\\n\\n   #syncFile \\n \\n\\t while waiting a bit before retrying a failed sync call \\n \\n\\n\\n   #startLogBackup \\n \\n\\t while waiting for a thread doing checkpointing before we start \\n    backup of log as part of online-backup \\n \\n\\n\\n The following locations previously silently swallowed the interrupt, we \\nnow (also) note that an interrupt occurred: \\n\\n \\n\\t LogToFile \\n  #recover: \\n \\n \\n\\t in slave replication mode, while waiting for fail-over. This code \\n    swallowed the interrupt \\n \\n\\n\\n   #getLogFileAtBeginning: \\n \\n\\t in slave replication mode, while waiting for SlaveFactory to tell \\n    the thread to do recovery. This code swallowed the interrupt \\n \\n\\n\\n \\n\\t BasePage: \\n  #setExclusive: \\n \\n \\n\\t while waiting for an exclusive latch \\n\\t while waiting for cleaner to finish \\n \\n\\n\\n   #setExclusiveNoWait \\n \\n\\t while waiting for cleaner to finish \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12982135\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12982135&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12982135\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12982135_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982135_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jan\\/11 17:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-15T17:02:38+0000\'\u003e15\\/Jan\\/11 17:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e #syncFile \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ewhile waiting a bit before retrying a failed sync call\u003cbr\\/\u003e\\nShould the comment change a little in turn of the \\\"does not matter...\\\"?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI run suites.all against ibm 1.6 jvm along with the LockInterruptTest.java (derby-4967-locking-2.diff) change, test run clean. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12982135_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982135_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jan\\/11 17:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-15T17:02:38+0000\'\u003e15\\/Jan\\/11 17:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     #syncFile  \\n \\n\\t while waiting a bit before retrying a failed sync call \\nShould the comment change a little in turn of the \\\"does not matter...\\\"? \\n \\n\\n\\n I run suites.all against ibm 1.6 jvm along with the LockInterruptTest.java (derby-4967-locking-2.diff) change, test run clean.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12982189\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12982189&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12982189\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12982189_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982189_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/11 00:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-16T00:06:45+0000\'\u003e16\\/Jan\\/11 00:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for test running the two patches, Lily.  Good to know these run on the IBM VM as well!\u003cbr\\/\u003e\\nAs for the comment, agreed. I have removed it in my next version of this patch, because it long longer seems to carry important information: earlier practice was to always throw, so then the comment highlighted \\\"unusual\\\" treatment. Now we mostly do not throw, just make a note, so this is code is no longer unusual as I see it. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12982189_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12982189_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/11 00:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-16T00:06:45+0000\'\u003e16\\/Jan\\/11 00:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for test running the two patches, Lily.  Good to know these run on the IBM VM as well! \\nAs for the comment, agreed. I have removed it in my next version of this patch, because it long longer seems to carry important information: earlier practice was to always throw, so then the comment highlighted \\\"unusual\\\" treatment. Now we mostly do not throw, just make a note, so this is code is no longer unusual as I see it.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983463\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12983463&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983463\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12983463_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983463_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 00:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T00:50:48+0000\'\u003e19\\/Jan\\/11 00:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a second version of derby-4741-sleeps-waits, rerunning regressions.\u003c\\/p\u003e\\n\\n\u003cp\u003eDetails on where patch derby-4741-sleeps-waits-2 adds things relative to version 1:\u003c\\/p\u003e\\n\\n\u003cp\u003eThe following locations previously silently swallowed the interrupt, we now (also) note that an interrupt occurred:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eLogAccessFile:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #flushDirtyBuffers:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting for another thread flushing\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #syncLogAccessFile:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile sleeping a bit before retrying after a failed sync\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  With the above, all the waits and sleeps in the package\u003cbr\\/\u003e\\n  org.apache.derby.impl.store.raw.log have been made safe.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe following locations where we earlier threw 08000 (CONN_INTERRUPT), we now just note that an interrupt occurred:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eXactFactory:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #blockBackup:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile doing backup blocking operations, we wait for backup to\u003cbr\\/\u003e\\n    finish. \u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #blockBackupBlockingOperations:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting for all backup blocking operations to complete\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eBaseDataFileFactory:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #freezePersistentStore:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting for writes in progress to finishing before freezing.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #writeInProgress:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting for db thaw before we can start writing\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eCachedPage:\u003cbr\\/\u003e\\n  #clean:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWaiting for another thread cleaning it\u003c\\/li\u003e\\n\\t\u003cli\u003eWaiting for state to become unlatched attempting to clean it\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAsynchronousLogShipper:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #run:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eIf interrupted during the shipping interval wait, shipping sooner doesn\'t hurt\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #forceFlush:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting a bit after having flushed the master to ship log records to slave to free up buffer space\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eReplicationMessageReceive:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #isConnectedToMaster:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting for result from the ping thread (the \\\"pong\\\"). Since we may have been interrupted before the result is ready, we try again unless the connection is confirmed up.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  #SlavePingThread#run:  \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhile waiting for wakeup to do a ping.  I had to introduce an extra state variable here to decide whether after we receive an interrupt, a ping request has also been lodged.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12983463_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983463_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 00:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T00:50:48+0000\'\u003e19\\/Jan\\/11 00:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a second version of derby-4741-sleeps-waits, rerunning regressions. \\n\\n Details on where patch derby-4741-sleeps-waits-2 adds things relative to version 1: \\n\\n The following locations previously silently swallowed the interrupt, we now (also) note that an interrupt occurred: \\n\\n \\n\\t LogAccessFile: \\n \\n\\n\\n   #flushDirtyBuffers: \\n \\n\\t While waiting for another thread flushing \\n \\n\\n\\n   #syncLogAccessFile: \\n \\n\\t While sleeping a bit before retrying after a failed sync \\n \\n\\n\\n   With the above, all the waits and sleeps in the package \\n  org.apache.derby.impl.store.raw.log have been made safe. \\n\\n The following locations where we earlier threw 08000 (CONN_INTERRUPT), we now just note that an interrupt occurred: \\n\\n \\n\\t XactFactory: \\n \\n\\n\\n   #blockBackup: \\n \\n\\t While doing backup blocking operations, we wait for backup to \\n    finish.  \\n \\n\\n\\n   #blockBackupBlockingOperations: \\n \\n\\t While waiting for all backup blocking operations to complete \\n \\n\\n\\n \\n\\t BaseDataFileFactory: \\n \\n\\n\\n   #freezePersistentStore: \\n \\n\\t While waiting for writes in progress to finishing before freezing. \\n \\n\\n\\n   #writeInProgress: \\n \\n\\t While waiting for db thaw before we can start writing \\n \\n\\n\\n \\n\\t CachedPage: \\n  #clean: \\n \\n \\n\\t Waiting for another thread cleaning it \\n\\t Waiting for state to become unlatched attempting to clean it \\n \\n\\n\\n \\n\\t AsynchronousLogShipper: \\n \\n\\n\\n   #run: \\n \\n\\t If interrupted during the shipping interval wait, shipping sooner doesn\'t hurt \\n \\n\\n\\n   #forceFlush: \\n\\n \\n\\t While waiting a bit after having flushed the master to ship log records to slave to free up buffer space \\n \\n\\n\\n \\n\\t ReplicationMessageReceive: \\n \\n\\n\\n   #isConnectedToMaster: \\n \\n\\t While waiting for result from the ping thread (the \\\"pong\\\"). Since we may have been interrupted before the result is ready, we try again unless the connection is confirmed up. \\n \\n\\n\\n   #SlavePingThread#run:   \\n \\n\\t While waiting for wakeup to do a ping.  I had to introduce an extra state variable here to decide whether after we receive an interrupt, a ping request has also been lodged. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983697\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12983697&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983697\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12983697_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983697_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 13:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T13:11:02+0000\'\u003e19\\/Jan\\/11 13:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSecond revision of sleeps-waits looks good to me. A couple of questions:\u003c\\/p\u003e\\n\\n\u003cp\u003eXactFactory.blockBackupBlockingOperations(): Remove RuntimeException from throws clause? The explanation added to the javadoc is probably enough for documentation purposes.\u003c\\/p\u003e\\n\\n\u003cp\u003eRAFContainer4.java:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhy the change from noteAndClearInterrupt() to setInterrupted()?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWhitespace diff @@ -825,7 +819,7 @@ looks unintended\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eReplicationMessageReceive.java: The while loops are only retried if the wait() calls are interrupted, and not if the wait() calls experience spurious wakeups. Any reason for that? (Probably still an improvement compared to the original code, which didn\'t retry the wait call in any event.)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12983697_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983697_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 13:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T13:11:02+0000\'\u003e19\\/Jan\\/11 13:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Second revision of sleeps-waits looks good to me. A couple of questions: \\n\\n XactFactory.blockBackupBlockingOperations(): Remove RuntimeException from throws clause? The explanation added to the javadoc is probably enough for documentation purposes. \\n\\n RAFContainer4.java: \\n\\n \\n\\t Why the change from noteAndClearInterrupt() to setInterrupted()? \\n \\n\\n\\n \\n\\t Whitespace diff @@ -825,7 +819,7 @@ looks unintended \\n \\n\\n\\n ReplicationMessageReceive.java: The while loops are only retried if the wait() calls are interrupted, and not if the wait() calls experience spurious wakeups. Any reason for that? (Probably still an improvement compared to the original code, which didn\'t retry the wait call in any event.)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983935\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12983935&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983935\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12983935_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983935_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 23:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T23:38:52+0000\'\u003e19\\/Jan\\/11 23:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; XactFactory.blockBackupBlockingOperations(): Remove RuntimeException from throws clause? The explanation added to the javadoc is probably enough for documentation purposes.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m ok with that, I was torn on this.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; RAFContainer4.java: Why the change from noteAndClearInterrupt() to setInterrupted()?\u003c\\/p\u003e\\n\\n\u003cp\u003eJust simplification, since in these two locations we know that an interrupt actually did happen, there is no need to test for the flag as noteAndClearInterrupt does.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;     - Whitespace diff @@ -825,7 +819,7 @@ looks unintended\u003c\\/p\u003e\\n\\n\u003cp\u003eIndeed, thanks.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; \u003cbr\\/\u003e\\n&gt; ReplicationMessageReceive.java: The while loops are only retried if the wait() calls are interrupted, and not if the wait() calls experience spurious wakeups. Any reason for that? (Probably still an improvement compared to the original code, which didn\'t retry the wait call in any event.)\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I agree the original code is deficient in this repect, I have the code changed to handle this as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12983935_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983935_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 23:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T23:38:52+0000\'\u003e19\\/Jan\\/11 23:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; XactFactory.blockBackupBlockingOperations(): Remove RuntimeException from throws clause? The explanation added to the javadoc is probably enough for documentation purposes. \\n\\n I\'m ok with that, I was torn on this. \\n\\n &gt; RAFContainer4.java: Why the change from noteAndClearInterrupt() to setInterrupted()? \\n\\n Just simplification, since in these two locations we know that an interrupt actually did happen, there is no need to test for the flag as noteAndClearInterrupt does. \\n\\n &gt;     - Whitespace diff @@ -825,7 +819,7 @@ looks unintended \\n\\n Indeed, thanks. \\n\\n &gt;  \\n&gt; ReplicationMessageReceive.java: The while loops are only retried if the wait() calls are interrupted, and not if the wait() calls experience spurious wakeups. Any reason for that? (Probably still an improvement compared to the original code, which didn\'t retry the wait call in any event.) \\n\\n Yes, I agree the original code is deficient in this repect, I have the code changed to handle this as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12983937\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12983937&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12983937\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12983937_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983937_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 23:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T23:47:22+0000\'\u003e19\\/Jan\\/11 23:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading rev #3 of sleeps-waits, rerunning regressions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12983937_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12983937_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/11 23:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-19T23:47:22+0000\'\u003e19\\/Jan\\/11 23:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading rev #3 of sleeps-waits, rerunning regressions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12984405\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12984405&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12984405\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12984405_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12984405_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/11 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-20T21:13:03+0000\'\u003e20\\/Jan\\/11 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted rev #3 as svn 1061516. This completes the cleanup of interrupt handling in Object#wait and Thread.sleep inside store.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12984405_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12984405_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jan\\/11 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-20T21:13:03+0000\'\u003e20\\/Jan\\/11 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed rev #3 as svn 1061516. This completes the cleanup of interrupt handling in Object#wait and Thread.sleep inside store.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12984852\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12984852&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12984852\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"myrna\\\" id=\\\"commentauthor_12984852_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=myrna\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"myrna\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Myrna van Lunteren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12984852_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/11 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-21T18:37:49+0000\'\u003e21\\/Jan\\/11 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think the latest check-in has caused the following tinderbox failure:\u003c\\/p\u003e\\n\\n\u003cp\u003ederbyall\\/storeall\\/storeall.fail:unit\\/T_RawStoreFactory.unit\u003c\\/p\u003e\\n\\n\u003cp\u003esee: \u003ca href=\\\"http:\\/\\/dbtg.foundry.sun.com\\/derby\\/test\\/tinderbox_trunk16\\/jvm1.6\\/testing\\/testlog\\/SunOS-5.10_i86pc-i386\\/1061516-derbyall_diff.txt:\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/dbtg.foundry.sun.com\\/derby\\/test\\/tinderbox_trunk16\\/jvm1.6\\/testing\\/testlog\\/SunOS-5.10_i86pc-i386\\/1061516-derbyall_diff.txt:\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003e\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003e\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003e\\n\\t\\t\\t\u003cul\u003e\\n\\t\\t\\t\\t\u003cli\u003e\\n\\t\\t\\t\\t\u003cul\u003e\\n\\t\\t\\t\\t\\t\u003cli\u003e\\n\\t\\t\\t\\t\\t\u003cul\u003e\\n\\t\\t\\t\\t\\t\\t\u003cli\u003e\\n\\t\\t\\t\\t\\t\\t\u003cul\u003e\\n\\t\\t\\t\\t\\t\\t\\t\u003cli\u003e\\n\\t\\t\\t\\t\\t\\t\\t\u003cul\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\u003cli\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\u003cul\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\\t\u003cli\u003eDiff file derbyall\\/storeall\\/storeunit\\/T_RawStoreFactory.diff\u003c\\/li\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\u003c\\/ul\u003e\\n\\t\\t\\t\\t\\t\\t\\t\\t\u003c\\/li\u003e\\n\\t\\t\\t\\t\\t\\t\\t\u003c\\/ul\u003e\\n\\t\\t\\t\\t\\t\\t\\t\u003c\\/li\u003e\\n\\t\\t\\t\\t\\t\\t\u003c\\/ul\u003e\\n\\t\\t\\t\\t\\t\\t\u003c\\/li\u003e\\n\\t\\t\\t\\t\\t\u003c\\/ul\u003e\\n\\t\\t\\t\\t\\t\u003c\\/li\u003e\\n\\t\\t\\t\\t\u003c\\/ul\u003e\\n\\t\\t\\t\\t\u003c\\/li\u003e\\n\\t\\t\\t\u003c\\/ul\u003e\\n\\t\\t\\t\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eStart: T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-20 23:22:23 ***\u003cbr\\/\u003e\\n2 del\u003cbr\\/\u003e\\n&lt; &#8211; Unit Test T_RawStoreFactory finished\u003cbr\\/\u003e\\n2 add\u003cbr\\/\u003e\\n&gt; ran out of time\u003cbr\\/\u003e\\n&gt; Exit due to time bomb\u003cbr\\/\u003e\\nTest Failed.\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eEnd:   T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-21 00:22:54 ***\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt failed in the nightly runs with ibm 1.6 also (and 1.4.2 and 1.5).\u003cbr\\/\u003e\\nDo we need a separate jira?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"myrna\\\" id=\\\"commentauthor_12984852_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=myrna\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"myrna\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Myrna van Lunteren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12984852_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/11 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-21T18:37:49+0000\'\u003e21\\/Jan\\/11 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think the latest check-in has caused the following tinderbox failure: \\n\\n derbyall\\/storeall\\/storeall.fail:unit\\/T_RawStoreFactory.unit \\n\\n see:  http:\\/\\/dbtg.foundry.sun.com\\/derby\\/test\\/tinderbox_trunk16\\/jvm1.6\\/testing\\/testlog\\/SunOS-5.10_i86pc-i386\\/1061516-derbyall_diff.txt:  \\n\\n \\n\\t \\n\\t \\n\\t\\t \\n\\t\\t \\n\\t\\t\\t \\n\\t\\t\\t \\n\\t\\t\\t\\t \\n\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t\\t Diff file derbyall\\/storeall\\/storeunit\\/T_RawStoreFactory.diff \\n\\t\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t\\t \\n\\t\\t\\t\\t \\n\\t\\t\\t\\t \\n\\t\\t\\t \\n\\t\\t\\t \\n\\t\\t\\t Start: T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-20 23:22:23 *** \\n2 del \\n&lt; &#8211; Unit Test T_RawStoreFactory finished \\n2 add \\n&gt; ran out of time \\n&gt; Exit due to time bomb \\nTest Failed. \\n\\t\\t\\t End:   T_RawStoreFactory jdk1.6.0_18 storeall:storeunit 2011-01-21 00:22:54 *** \\n\\t\\t \\n\\t\\t \\n\\t \\n\\t \\n \\n\\n\\n It failed in the nightly runs with ibm 1.6 also (and 1.4.2 and 1.5). \\nDo we need a separate jira?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12985033\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12985033&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12985033\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12985033_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12985033_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jan\\/11 01:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-22T01:58:43+0000\'\u003e22\\/Jan\\/11 01:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading *-raf-stresstest-1, which adds a multi-threaded read\\/write test under an interrupt shower.\u003cbr\\/\u003e\\nThis exercises primarily the random access file recovery  (RAFContainer4#recoverContainerAfterInterrupt), but since the interrupt can arrive at any time during query execution, other parts of the code are also exposed. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe new test case is InterruptResilienceTest#testRAFReadWriteMultipleThreads.\u003c\\/p\u003e\\n\\n\u003cp\u003eRunning regressions.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch is not for commit yet, since I worry that the test takes too long to be included in the regression suite. During development I had to let it run this long to expose all the corner cases I have seen, but adding 250 seconds may be too much. I could comment out the client\\/server suite, since it doesn\'t add much value: the interrupt all happen on the server side. That  would cut the time down to ca half. Also, the test may not be entirely reliable yet, since there are remaining parts of the code yet to vetted wrt interrupt handling, but it runs reliably in my environment. I will at least run it on some more platforms before I suggest any commit.\u003c\\/p\u003e\\n\\n\u003cp\u003ePlease note that due to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4431\\\" title=\\\"implement INFORMATION_SCHEMA (ISO\\/IEC 9075-11)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4431\\\"\u003eDERBY-4431\u003c\\/a\u003e, the IBM VMs will not yet be covered by these additional tests.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12985033_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12985033_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jan\\/11 01:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-22T01:58:43+0000\'\u003e22\\/Jan\\/11 01:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading *-raf-stresstest-1, which adds a multi-threaded read\\/write test under an interrupt shower. \\nThis exercises primarily the random access file recovery  (RAFContainer4#recoverContainerAfterInterrupt), but since the interrupt can arrive at any time during query execution, other parts of the code are also exposed.  \\n\\n The new test case is InterruptResilienceTest#testRAFReadWriteMultipleThreads. \\n\\n Running regressions. \\n\\n The patch is not for commit yet, since I worry that the test takes too long to be included in the regression suite. During development I had to let it run this long to expose all the corner cases I have seen, but adding 250 seconds may be too much. I could comment out the client\\/server suite, since it doesn\'t add much value: the interrupt all happen on the server side. That  would cut the time down to ca half. Also, the test may not be entirely reliable yet, since there are remaining parts of the code yet to vetted wrt interrupt handling, but it runs reliably in my environment. I will at least run it on some more platforms before I suggest any commit. \\n\\n Please note that due to  DERBY-4431 , the IBM VMs will not yet be covered by these additional tests.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12985034\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12985034&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12985034\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12985034_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12985034_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jan\\/11 01:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-22T01:59:44+0000\'\u003e22\\/Jan\\/11 01:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 22\\/Jan\\/11 02:15\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMyrna, I will look into it. Filed \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4982\\\" title=\\\"Retrying after interrupts in store pops a bug in derbyall\\/storeall\\/storeunit\\/T_RawStoreFactory in some cases\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4982\\\"\u003e\u003cdel\u003eDERBY-4982\u003c\\/del\u003e\u003c\\/a\u003e for this.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12985034_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12985034_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jan\\/11 01:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-22T01:59:44+0000\'\u003e22\\/Jan\\/11 01:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 22\\/Jan\\/11 02:15\\\"\u003eedited\u003c\\/span\u003e                   Myrna, I will look into it. Filed   DERBY-4982   for this. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986212\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986212&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986212\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986212_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986212_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 04:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T04:30:36+0000\'\u003e25\\/Jan\\/11 04:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRegrressions for *-raf-stresstest-1, and I verified that the modified InterruptResilienceTest works on Windows as well. For some reason it executed much more quickly under Windows, ca 50s (the reported 250 above was on Solaris). I\'ll see I can figure out why.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986212_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986212_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 04:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T04:30:36+0000\'\u003e25\\/Jan\\/11 04:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Regrressions for *-raf-stresstest-1, and I verified that the modified InterruptResilienceTest works on Windows as well. For some reason it executed much more quickly under Windows, ca 50s (the reported 250 above was on Solaris). I\'ll see I can figure out why.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986347\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986347&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986347\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12986347_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986347_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 11:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T11:40:30+0000\'\u003e25\\/Jan\\/11 11:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePerhaps the difference is whether or not the OS will force changes to disk when doing synchronous writes?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12986347_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986347_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 11:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T11:40:30+0000\'\u003e25\\/Jan\\/11 11:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Perhaps the difference is whether or not the OS will force changes to disk when doing synchronous writes?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986365\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986365&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986365\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12986365_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986365_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 12:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T12:42:49+0000\'\u003e25\\/Jan\\/11 12:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe use of the static field thisTest may have some consequences that are not entirely obvious:\u003c\\/p\u003e\\n\\n\u003cp\u003eThe field is set when the test suite is created, so when the tests start running it will always point to the last test case that was created, not necessarily to the running test case. That is, it will always point to a client test case. Because of this, one may be led to believe that the test that calls thisTest.openDefaultConnection() always uses client connections. However, BaseJDBCTestCase.openDefaultConnection() calls TestConfiguration.getCurrent() to get the current test configuration, so the connection type should be chosen dynamically based on the active decorators. But this assumption is also not quite true. The decorators only affect the TestConfiguration for the main thread, so when running inside a stored procedure in a server thread, the decorators will have no effect, and an embedded connection will be opened even if the test case is actually running within a client\\/server decorator.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the intention is to always use embedded connections inside the stored procedure, and that\'s also what the code does (so, as mentioned in an earlier comment, there\'s probably not much point in running this test in client\\/server mode?). But it takes some effort to convince oneself that that\'s what it actually does. Do you think it\'s possible to make it more explicit that the worker threads always use embedded connections?\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd some little nits:\u003c\\/p\u003e\\n\\n\u003cp\u003e+            if (w.e != null) \u003c\\/p\u003e\\n{\\n+                fail(\\\"WorkerThread \\\" + i + \\\" saw exception \\\" + w.e);\\n+            }\\n\\n\u003cp\u003eUse the fail() method that takes an exception to preserve the stack trace?\u003c\\/p\u003e\\n\\n\u003cp\u003e+        ResultSet rs = s.executeQuery(\\\"select count\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e from mtTab\\\");\u003cbr\\/\u003e\\n+        rs.next();\u003cbr\\/\u003e\\n+        assertEquals(\\\"too few rows inserted\\\",\u003cbr\\/\u003e\\n+                     rs.getLong(1), NO_OF_THREADS * NO_OF_MT_OPS);\u003cbr\\/\u003e\\n+        rs.close();\u003c\\/p\u003e\\n\\n\u003cp\u003eHow do you know it must be too few and not too many? \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e JDBC.assertSingleValueResultSet() could simplify this code.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12986365_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986365_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 12:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T12:42:49+0000\'\u003e25\\/Jan\\/11 12:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The use of the static field thisTest may have some consequences that are not entirely obvious: \\n\\n The field is set when the test suite is created, so when the tests start running it will always point to the last test case that was created, not necessarily to the running test case. That is, it will always point to a client test case. Because of this, one may be led to believe that the test that calls thisTest.openDefaultConnection() always uses client connections. However, BaseJDBCTestCase.openDefaultConnection() calls TestConfiguration.getCurrent() to get the current test configuration, so the connection type should be chosen dynamically based on the active decorators. But this assumption is also not quite true. The decorators only affect the TestConfiguration for the main thread, so when running inside a stored procedure in a server thread, the decorators will have no effect, and an embedded connection will be opened even if the test case is actually running within a client\\/server decorator. \\n\\n I think the intention is to always use embedded connections inside the stored procedure, and that\'s also what the code does (so, as mentioned in an earlier comment, there\'s probably not much point in running this test in client\\/server mode?). But it takes some effort to convince oneself that that\'s what it actually does. Do you think it\'s possible to make it more explicit that the worker threads always use embedded connections? \\n\\n And some little nits: \\n\\n +            if (w.e != null)  \\n{\\n+                fail(\\\"WorkerThread \\\" + i + \\\" saw exception \\\" + w.e);\\n+            }\\n\\n Use the fail() method that takes an exception to preserve the stack trace? \\n\\n +        ResultSet rs = s.executeQuery(\\\"select count  from mtTab\\\"); \\n+        rs.next(); \\n+        assertEquals(\\\"too few rows inserted\\\", \\n+                     rs.getLong(1), NO_OF_THREADS * NO_OF_MT_OPS); \\n+        rs.close(); \\n\\n How do you know it must be too few and not too many?   JDBC.assertSingleValueResultSet() could simplify this code.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986601\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986601&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986601\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986601_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986601_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T18:53:42+0000\'\u003e25\\/Jan\\/11 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for looking at this, Knut!\u003cbr\\/\u003e\\nYou are right, it got a bit convoluted. The intention is, as you suggest, to always embedded connections inside the stored procedure.\u003cbr\\/\u003e\\nI\'ll see if I can simplify this a bit! I\u003c\\/p\u003e\\n\\n\u003cp\u003e always agonize about whether to include c\\/s tests or not when the changes are seemingly embedded\\/server-side only, maybe we should try to establish some criteria to help us decide when to, and when not to do that.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks also for spotting the nits, I converted this from a stand-alone test outside JUnit, so it can be further simplied as you suggest.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986601_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986601_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T18:53:42+0000\'\u003e25\\/Jan\\/11 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for looking at this, Knut! \\nYou are right, it got a bit convoluted. The intention is, as you suggest, to always embedded connections inside the stored procedure. \\nI\'ll see if I can simplify this a bit! I \\n\\n  always agonize about whether to include c\\/s tests or not when the changes are seemingly embedded\\/server-side only, maybe we should try to establish some criteria to help us decide when to, and when not to do that. \\n\\n Thanks also for spotting the nits, I converted this from a stand-alone test outside JUnit, so it can be further simplied as you suggest.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986676\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986676&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986676\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986676_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986676_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 20:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T20:35:51+0000\'\u003e25\\/Jan\\/11 20:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploaded *raf_stresstest-2 which supersedes #1. In addition to fixing Knut\'s nits,\u003cbr\\/\u003e\\nthe server side code now uses a thread\'s default test configuration directly, and I also added a comment explaining this. I think I will commit the patch with the long running time for now. I\'d rather flush out any bugs here sooner rather than later. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986676_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986676_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 20:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T20:35:51+0000\'\u003e25\\/Jan\\/11 20:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploaded *raf_stresstest-2 which supersedes #1. In addition to fixing Knut\'s nits, \\nthe server side code now uses a thread\'s default test configuration directly, and I also added a comment explaining this. I think I will commit the patch with the long running time for now. I\'d rather flush out any bugs here sooner rather than later.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986710\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986710&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986710\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12986710_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986710_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 21:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T21:58:20+0000\'\u003e25\\/Jan\\/11 21:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; I think I will commit the patch with the long running time for now. I\'d rather flush out any bugs here sooner rather than later.\u003c\\/p\u003e\\n\\n\u003cp\u003eSounds good. +1\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I always agonize about whether to include c\\/s tests or not when the changes are seemingly embedded\\/server-side only\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t have a general rule, but in this particular case it looks like we run the entire test inside a stored procedure in order to make sure that only embedded is tested. Sounds like a good indication that embedded only would suffice... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e We could probably simplify the test somewhat and remove the stored procedure indirection too if we made it embedded only.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12986710_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986710_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jan\\/11 21:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-25T21:58:20+0000\'\u003e25\\/Jan\\/11 21:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; I think I will commit the patch with the long running time for now. I\'d rather flush out any bugs here sooner rather than later. \\n\\n Sounds good. +1 \\n\\n &gt; I always agonize about whether to include c\\/s tests or not when the changes are seemingly embedded\\/server-side only \\n\\n I don\'t have a general rule, but in this particular case it looks like we run the entire test inside a stored procedure in order to make sure that only embedded is tested. Sounds like a good indication that embedded only would suffice...   We could probably simplify the test somewhat and remove the stored procedure indirection too if we made it embedded only.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12986809\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12986809&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12986809\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986809_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986809_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jan\\/11 01:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-26T01:47:48+0000\'\u003e26\\/Jan\\/11 01:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a revised version #3 which makes use of derby.system.durability=testing to cut down on the\u003cbr\\/\u003e\\nrunning time on Solaris, I found it will still get to the corner cases.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12986809_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12986809_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jan\\/11 01:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-26T01:47:48+0000\'\u003e26\\/Jan\\/11 01:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a revised version #3 which makes use of derby.system.durability=testing to cut down on the \\nrunning time on Solaris, I found it will still get to the corner cases.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12987348\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12987348&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12987348\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12987348_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12987348_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/11 01:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-27T01:55:53+0000\'\u003e27\\/Jan\\/11 01:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading version #4 (derby-4741-raf-stresstest-4). This lets the test run with its own database since we use durability=test: just to be on the safe side, so other tests don\'t get impacted by the fact that the database is thus marked, cf. message in derby.log:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"WARNING: The database is booted with derby.system.durability=test. In this mode, it is possible that database may not be able to recover, committed transactions may be lost, database may be in an inconsistent state. Please use this mode only when these consequences are acceptable\\\" (sic: no final period)\u003c\\/p\u003e\\n\\n\u003cp\u003eI has to add a class.forName to DriverManagerConnector#getConnectionByAttributes and a new public method BasicJDBCTestCase#openDefaultConnection(TestConfiguration). The latter makes it possible use the main thread\'s test configuration in the server threads, cf. \\\"thisConfig\\\" member in InterruptResilienceTest.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also added derby.infolog.append=true to SystemPropertyTestSetup, so the c\\/s run doesn\'t clobber the embedded run\'s derby.log.\u003c\\/p\u003e\\n\\n\u003cp\u003eRerunning regressions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12987348_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12987348_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/11 01:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-27T01:55:53+0000\'\u003e27\\/Jan\\/11 01:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading version #4 (derby-4741-raf-stresstest-4). This lets the test run with its own database since we use durability=test: just to be on the safe side, so other tests don\'t get impacted by the fact that the database is thus marked, cf. message in derby.log: \\n\\n \\\"WARNING: The database is booted with derby.system.durability=test. In this mode, it is possible that database may not be able to recover, committed transactions may be lost, database may be in an inconsistent state. Please use this mode only when these consequences are acceptable\\\" (sic: no final period) \\n\\n I has to add a class.forName to DriverManagerConnector#getConnectionByAttributes and a new public method BasicJDBCTestCase#openDefaultConnection(TestConfiguration). The latter makes it possible use the main thread\'s test configuration in the server threads, cf. \\\"thisConfig\\\" member in InterruptResilienceTest. \\n\\n I also added derby.infolog.append=true to SystemPropertyTestSetup, so the c\\/s run doesn\'t clobber the embedded run\'s derby.log. \\n\\n Rerunning regressions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12987620\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12987620&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12987620\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12987620_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12987620_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/11 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-27T16:11:36+0000\'\u003e27\\/Jan\\/11 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRegressions ran ok, committed derby-4741-raf-stresstest-4 as svn 1064174.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12987620_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12987620_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/11 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-27T16:11:36+0000\'\u003e27\\/Jan\\/11 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Regressions ran ok, committed derby-4741-raf-stresstest-4 as svn 1064174.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12987853\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12987853&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12987853\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12987853_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12987853_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jan\\/11 00:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-28T00:29:31+0000\'\u003e28\\/Jan\\/11 00:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a functional specification for this work to summarize what we have so far: \\\"interrupts-fs.html\\\"\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12987853_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12987853_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jan\\/11 00:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-28T00:29:31+0000\'\u003e28\\/Jan\\/11 00:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a functional specification for this work to summarize what we have so far: \\\"interrupts-fs.html\\\"              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12989336\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12989336&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12989336\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989336_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989336_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/11 19:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-01T19:07:28+0000\'\u003e01\\/Feb\\/11 19:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a patch, *-testQueryInterrupt, which:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eadds a new test case: InterruptResilienceTest#testLongQueryInterrupt\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ewhich tests that a query will check for the interrupt flag and throw 08000 (CONN_INTERRUPT) at the same time is checks for query time-out.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eadds a missing test in InterruptStatus#throwIf\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI also adjusted an existing test (for RAF recovery) to handle the case that we could see 08000 (CONN_INTERRUPT) when performing a query as part of that test, depending on when the interrupt happens.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegressions passed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989336_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989336_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/11 19:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-01T19:07:28+0000\'\u003e01\\/Feb\\/11 19:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a patch, *-testQueryInterrupt, which: \\n\\n \\n\\t adds a new test case: InterruptResilienceTest#testLongQueryInterrupt \\n \\n\\n\\n which tests that a query will check for the interrupt flag and throw 08000 (CONN_INTERRUPT) at the same time is checks for query time-out. \\n\\n \\n\\t adds a missing test in InterruptStatus#throwIf \\n \\n\\n\\n I also adjusted an existing test (for RAF recovery) to handle the case that we could see 08000 (CONN_INTERRUPT) when performing a query as part of that test, depending on when the interrupt happens. \\n\\n Regressions passed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12989385\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12989385&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12989385\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989385_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989385_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/11 21:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-01T21:18:31+0000\'\u003e01\\/Feb\\/11 21:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a new version of the draft functional specification, version 0.2. Please have a look!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989385_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989385_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/11 21:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-01T21:18:31+0000\'\u003e01\\/Feb\\/11 21:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a new version of the draft functional specification, version 0.2. Please have a look!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12989410\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12989410&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12989410\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989410_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989410_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/11 22:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-01T22:15:27+0000\'\u003e01\\/Feb\\/11 22:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading another patch *-testBatchInterrupt, which adds another fixture to InterruptResilienceTest: #testInterruptBatch, rerunning regressions.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt tests that an interrupt will stop a batch of statements by throwing just before we execute the next statement in the batch.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote that this patch includes all of *.testQueryInterrupt also for logistics reason (that patch is not yet committed), but I will post a slimmed down version of this as soon as that one is in.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989410_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989410_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Feb\\/11 22:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-01T22:15:27+0000\'\u003e01\\/Feb\\/11 22:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading another patch *-testBatchInterrupt, which adds another fixture to InterruptResilienceTest: #testInterruptBatch, rerunning regressions. \\n\\n It tests that an interrupt will stop a batch of statements by throwing just before we execute the next statement in the batch. \\n\\n Note that this patch includes all of *.testQueryInterrupt also for logistics reason (that patch is not yet committed), but I will post a slimmed down version of this as soon as that one is in.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12989913\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12989913&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12989913\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989913_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989913_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Feb\\/11 00:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-03T00:09:38+0000\'\u003e03\\/Feb\\/11 00:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted patch derby-4741-testQueryInterrupt as svn 1066701.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989913_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989913_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Feb\\/11 00:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-03T00:09:38+0000\'\u003e03\\/Feb\\/11 00:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed patch derby-4741-testQueryInterrupt as svn 1066701.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12989914\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12989914&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12989914\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989914_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989914_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Feb\\/11 00:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-03T00:17:55+0000\'\u003e03\\/Feb\\/11 00:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading version a slimmed-down version of *-testBatchInterrupt: derby-4741-testBatchInterrupt-b.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989914_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989914_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Feb\\/11 00:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-03T00:17:55+0000\'\u003e03\\/Feb\\/11 00:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading version a slimmed-down version of *-testBatchInterrupt: derby-4741-testBatchInterrupt-b.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12989916\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12989916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12989916\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989916_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989916_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Feb\\/11 00:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-03T00:21:03+0000\'\u003e03\\/Feb\\/11 00:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted derby-4741-testBatchInterrupt-b as svn 1066707.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12989916_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12989916_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Feb\\/11 00:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-03T00:21:03+0000\'\u003e03\\/Feb\\/11 00:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed derby-4741-testBatchInterrupt-b as svn 1066707.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12991441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12991441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12991441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12991441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12991441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/11 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-07T16:21:46+0000\'\u003e07\\/Feb\\/11 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for writing up the functional spec, Dag. I found that it clearly explained the behaviour, and as far as I could see it matched what was actually implemented. It doesn\'t mention anything about how to handle the Solaris interruptible I\\/O issue on JVMs later than 1.6 (in which case there won\'t be an issue, right?), but that\'s probably intentional since 1.7 is still only available as early access?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12991441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12991441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/11 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-07T16:21:46+0000\'\u003e07\\/Feb\\/11 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for writing up the functional spec, Dag. I found that it clearly explained the behaviour, and as far as I could see it matched what was actually implemented. It doesn\'t mention anything about how to handle the Solaris interruptible I\\/O issue on JVMs later than 1.6 (in which case there won\'t be an issue, right?), but that\'s probably intentional since 1.7 is still only available as early access?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12991678\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12991678&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12991678\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12991678_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12991678_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/11 22:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-07T22:51:26+0000\'\u003e07\\/Feb\\/11 22:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, you are right, Knut. I did omit reference to the 1.7 behavior on Solaris, but it might be good to include it in any case for completeness. After all Java 1.7 should be available before too long \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e Thanks for reviewing the specification.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12991678_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12991678_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/11 22:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-07T22:51:26+0000\'\u003e07\\/Feb\\/11 22:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yes, you are right, Knut. I did omit reference to the 1.7 behavior on Solaris, but it might be good to include it in any case for completeness. After all Java 1.7 should be available before too long   Thanks for reviewing the specification.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12992159\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12992159&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12992159\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12992159_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992159_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/11 20:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-08T20:29:34+0000\'\u003e08\\/Feb\\/11 20:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dag,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the functional spec. I am trying to wrap my mind around what application writers can expect. Is the following a fair summary?\u003c\\/p\u003e\\n\\n\u003cp\u003e1) If the Thread is interrupted while running outside Derby (that is, not inside a JDBC call), then Derby does not field the interrupt. The Connection remains alive and Thread.isInterrupted() will not be touched by Derby.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) On the other hand, if the Thread is interrupted while running inside a Derby JDBC call...\u003c\\/p\u003e\\n\\n\u003cp\u003ea) The Connection may be killed and have to be restarted. If the Connection is killed, then Thread.isInterrupted() will be true. \u003c\\/p\u003e\\n\\n\u003cp\u003eb) Alternatively, it is also possible that the interrupt will not kill the Connection. In this case, the state of Thread.isInterrupted() is unclear to me. I am having a hard time reconciling \\\"will be still be set...when exiting from the Derby API method\\\" with \\\"it is not deterministic whether the flag will remain set or be cleared on return\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12992159_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992159_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/11 20:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-08T20:29:34+0000\'\u003e08\\/Feb\\/11 20:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Dag, \\n\\n Thanks for the functional spec. I am trying to wrap my mind around what application writers can expect. Is the following a fair summary? \\n\\n 1) If the Thread is interrupted while running outside Derby (that is, not inside a JDBC call), then Derby does not field the interrupt. The Connection remains alive and Thread.isInterrupted() will not be touched by Derby. \\n\\n 2) On the other hand, if the Thread is interrupted while running inside a Derby JDBC call... \\n\\n a) The Connection may be killed and have to be restarted. If the Connection is killed, then Thread.isInterrupted() will be true.  \\n\\n b) Alternatively, it is also possible that the interrupt will not kill the Connection. In this case, the state of Thread.isInterrupted() is unclear to me. I am having a hard time reconciling \\\"will be still be set...when exiting from the Derby API method\\\" with \\\"it is not deterministic whether the flag will remain set or be cleared on return\\\". \\n\\n Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12992279\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12992279&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12992279\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12992279_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992279_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/11 01:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-09T01:32:40+0000\'\u003e09\\/Feb\\/11 01:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for reading the spec, Rick.\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Not true. If the flag is set at the time the Derby API call, Derby may throw. Derby can\'t know exactly when the thread was interrupted, it can only notice it by either a) seeing Java API methods return exceptions, or b) testing the flag explicitly. We do not test the flag on Derby API method entry. We heed (i.e. throw) interrupts in the specified situations enumerated in the spec.\u003c\\/p\u003e\\n\\n\u003cp\u003e2b) The flag will remain set when exitting from in all cases. The note about deterministic only applies if the flag \u003cb\u003eis attemped cleared\u003c\\/b\u003e by another thread while the Derby API call is still executing. If we ever saw an interrupt and had to clear it to make execution continue, e.g. for NIO, we set it again at Derby API method exit, whether we throw or not. This means that any attempt to clear it while Derby is executing could be lost, depending on exactly when the clearing attempt was made, hence \\\"non-deterministic\\\".\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12992279_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992279_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/11 01:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-09T01:32:40+0000\'\u003e09\\/Feb\\/11 01:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for reading the spec, Rick. \\n\\n 1) Not true. If the flag is set at the time the Derby API call, Derby may throw. Derby can\'t know exactly when the thread was interrupted, it can only notice it by either a) seeing Java API methods return exceptions, or b) testing the flag explicitly. We do not test the flag on Derby API method entry. We heed (i.e. throw) interrupts in the specified situations enumerated in the spec. \\n\\n 2b) The flag will remain set when exitting from in all cases. The note about deterministic only applies if the flag  is attemped cleared  by another thread while the Derby API call is still executing. If we ever saw an interrupt and had to clear it to make execution continue, e.g. for NIO, we set it again at Derby API method exit, whether we throw or not. This means that any attempt to clear it while Derby is executing could be lost, depending on exactly when the clearing attempt was made, hence \\\"non-deterministic\\\".              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12992498\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12992498&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12992498\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12992498_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992498_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/11 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-09T14:26:03+0000\'\u003e09\\/Feb\\/11 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Dag. Some follow-on questions:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Suppose my application has two threads T1 and T2, each with its own Connection. T1 is busy interacting with the user and is NOT stalled inside a JDBC call. T2 is running inside a JDBC call. Now T2 is interrupted. Can this kill T1\'s Connection?\u003c\\/p\u003e\\n\\n\u003cp\u003e2) Does this give rise to any advice for application writers?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks,\u003cbr\\/\u003e\\n-Rick\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12992498_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992498_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Feb\\/11 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-09T14:26:03+0000\'\u003e09\\/Feb\\/11 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Dag. Some follow-on questions: \\n\\n 1) Suppose my application has two threads T1 and T2, each with its own Connection. T1 is busy interacting with the user and is NOT stalled inside a JDBC call. T2 is running inside a JDBC call. Now T2 is interrupted. Can this kill T1\'s Connection? \\n\\n 2) Does this give rise to any advice for application writers? \\n\\n Thanks, \\n-Rick              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12992811\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12992811&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12992811\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12992811_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992811_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/11 00:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-10T00:36:21+0000\'\u003e10\\/Feb\\/11 00:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Rick, \u003cbr\\/\u003e\\n1) The answer is no. Only T2 risk seeing 08000. Nor would T1 risk it if it were inside a JDBC call, since this thread is not being interrupted.\u003cbr\\/\u003e\\n2) Applications that expect to interrupt threads while they are executing JDBC calls should be prepared to receive a session level error with SQLState 08000, and so would need to reconnect in order to get more work done.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12992811_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12992811_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/11 00:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-10T00:36:21+0000\'\u003e10\\/Feb\\/11 00:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Rick,  \\n1) The answer is no. Only T2 risk seeing 08000. Nor would T1 risk it if it were inside a JDBC call, since this thread is not being interrupted. \\n2) Applications that expect to interrupt threads while they are executing JDBC calls should be prepared to receive a session level error with SQLState 08000, and so would need to reconnect in order to get more work done.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12993182\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12993182&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12993182\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12993182_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993182_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/11 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-10T19:29:23+0000\'\u003e10\\/Feb\\/11 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Dag. Here is another attempt to summarize the user-visible behavior after these improvements.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf an application experiences Thread interrupts, its designer should plan for the following behavior:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) If a Thread is interrupted inside a Derby JDBC call, then the Connection experiencing the interrupt MAY be terminated. If the Connection is terminated, the application will experience the following consequences:\u003c\\/p\u003e\\n\\n\u003cp\u003ea) The JDBC call will raise a 08000 (CONN_INTERRUPT) exception.\u003c\\/p\u003e\\n\\n\u003cp\u003eb) Outstanding transactional work on that Connection will be rolled back and all of its locks will be released.\u003c\\/p\u003e\\n\\n\u003cp\u003ec) The Connection will not execute any further JDBC calls.\u003c\\/p\u003e\\n\\n\u003cp\u003ed) On return from the interrupted JDBC call, the Thread\'s isInterrupted() method will report \\\"true\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e2) All other Connections will remain active. This includes other Connections which the interrupted Thread may be using.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Application designers are advised to catch these 08000 exceptions, discard the dead Connection, and restart their transaction in a new Connection.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12993182_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993182_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Feb\\/11 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-10T19:29:23+0000\'\u003e10\\/Feb\\/11 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Dag. Here is another attempt to summarize the user-visible behavior after these improvements. \\n\\n If an application experiences Thread interrupts, its designer should plan for the following behavior: \\n\\n 1) If a Thread is interrupted inside a Derby JDBC call, then the Connection experiencing the interrupt MAY be terminated. If the Connection is terminated, the application will experience the following consequences: \\n\\n a) The JDBC call will raise a 08000 (CONN_INTERRUPT) exception. \\n\\n b) Outstanding transactional work on that Connection will be rolled back and all of its locks will be released. \\n\\n c) The Connection will not execute any further JDBC calls. \\n\\n d) On return from the interrupted JDBC call, the Thread\'s isInterrupted() method will report \\\"true\\\". \\n\\n 2) All other Connections will remain active. This includes other Connections which the interrupted Thread may be using. \\n\\n 3) Application designers are advised to catch these 08000 exceptions, discard the dead Connection, and restart their transaction in a new Connection.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12993282\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12993282&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12993282\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12993282_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993282_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/11 00:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-11T00:38:18+0000\'\u003e11\\/Feb\\/11 00:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; 1) If a Thread is interrupted inside a Derby JDBC call, then the Connection experiencing the interrupt MAY be terminated. If the Connection is terminated, the application will experience the following consequences:\u003c\\/p\u003e\\n\\n\u003cp\u003eTo be even more precise: \\\"If a Thread is interrupted and the flag is not cleared before entering a Derby JDBC call \u003cb\u003eor\u003c\\/b\u003e the thread is interrupted while inside a Derby JDBC call, then the Connection experiencing the interrupt MAY be terminated. If the Connection is terminated, the application will experience the following consequences:\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; a) The JDBC call will raise a 08000 (CONN_INTERRUPT) exception.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; \u003cbr\\/\u003e\\n&gt; b) Outstanding transactional work on that Connection will be rolled back and all of its locks will be released.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; c) The Connection will not execute any further JDBC calls.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; \u003cbr\\/\u003e\\n&gt; d) On return from the interrupted JDBC call, the Thread\'s isInterrupted() method will report \\\"true\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eYes. \u003c\\/p\u003e\\n\\n\u003cp\u003eIf Derby does not throw, the Thread\'s isInterrupted() method will also report \\\"true\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 2) All other Connections will remain active. This includes other Connections which the interrupted Thread may be using.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, at least until such time as the thread, still having its interrupted flag set, tries to use another connection, in which case, this connection is also subject to termination.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; \u003cbr\\/\u003e\\n&gt; 3) Application designers are advised to catch these 08000 exceptions, discard the dead Connection, and restart their transaction in a new Connection. \u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cb\u003eAnd\u003c\\/b\u003e clear the interrupted flag of the thread before proceeding with another Derby connection, preferably!\u003c\\/p\u003e\\n\\n\u003cp\u003eThe \\\"MAY\\\" presently means: \u003cbr\\/\u003e\\n    if a query fetches rows from a base table \u003cb\u003eafter\u003c\\/b\u003e the interrupt has occurred, or\u003cbr\\/\u003e\\n    a new element in a batched statement is attempted executed \u003cb\u003eafter\u003c\\/b\u003e the interrupt has occurred, or\u003cbr\\/\u003e\\n    an interrupt is received \u003cb\u003ewhile\u003c\\/b\u003e waiting for a lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn other cases, it is ignored.\u003cbr\\/\u003e\\n.\u003cbr\\/\u003e\\nNote the slight difference above, between \u003cb\u003eafter\u003c\\/b\u003e and \u003cb\u003ewhile\u003c\\/b\u003e. I have clarified this in a new revision.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12993282_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993282_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/11 00:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-11T00:38:18+0000\'\u003e11\\/Feb\\/11 00:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; 1) If a Thread is interrupted inside a Derby JDBC call, then the Connection experiencing the interrupt MAY be terminated. If the Connection is terminated, the application will experience the following consequences: \\n\\n To be even more precise: \\\"If a Thread is interrupted and the flag is not cleared before entering a Derby JDBC call  or  the thread is interrupted while inside a Derby JDBC call, then the Connection experiencing the interrupt MAY be terminated. If the Connection is terminated, the application will experience the following consequences:\\\" \\n\\n &gt; a) The JDBC call will raise a 08000 (CONN_INTERRUPT) exception. \\n\\n Yes \\n\\n &gt;  \\n&gt; b) Outstanding transactional work on that Connection will be rolled back and all of its locks will be released. \\n\\n Yes \\n\\n &gt; c) The Connection will not execute any further JDBC calls. \\n\\n Yes \\n\\n &gt;  \\n&gt; d) On return from the interrupted JDBC call, the Thread\'s isInterrupted() method will report \\\"true\\\". \\n\\n Yes.  \\n\\n If Derby does not throw, the Thread\'s isInterrupted() method will also report \\\"true\\\". \\n\\n &gt; 2) All other Connections will remain active. This includes other Connections which the interrupted Thread may be using. \\n\\n Yes, at least until such time as the thread, still having its interrupted flag set, tries to use another connection, in which case, this connection is also subject to termination. \\n\\n &gt;  \\n&gt; 3) Application designers are advised to catch these 08000 exceptions, discard the dead Connection, and restart their transaction in a new Connection.  \\n\\n  And  clear the interrupted flag of the thread before proceeding with another Derby connection, preferably! \\n\\n The \\\"MAY\\\" presently means:  \\n    if a query fetches rows from a base table  after  the interrupt has occurred, or \\n    a new element in a batched statement is attempted executed  after  the interrupt has occurred, or \\n    an interrupt is received  while  waiting for a lock. \\n\\n In other cases, it is ignored. \\n. \\nNote the slight difference above, between  after  and  while . I have clarified this in a new revision. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12993283\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12993283&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12993283\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12993283_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993283_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/11 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-11T00:44:13+0000\'\u003e11\\/Feb\\/11 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a new version of the func spec.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12993283_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993283_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/11 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-11T00:44:13+0000\'\u003e11\\/Feb\\/11 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading a new version of the func spec.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12993494\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12993494&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12993494\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12993494_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993494_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/11 14:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-11T14:01:56+0000\'\u003e11\\/Feb\\/11 14:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the extra clarification, Dag. That will be useful for programmers who want to understand the code. I think we have a clear enough picture of the user experience that we can document this feature now. Thanks. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rhillegas\\\" id=\\\"commentauthor_12993494_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rhillegas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rhillegas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rick Hillegas\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12993494_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Feb\\/11 14:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-11T14:01:56+0000\'\u003e11\\/Feb\\/11 14:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the extra clarification, Dag. That will be useful for programmers who want to understand the code. I think we have a clear enough picture of the user experience that we can document this feature now. Thanks.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12994415\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12994415&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12994415\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12994415_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12994415_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Feb\\/11 18:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-14T18:49:53+0000\'\u003e14\\/Feb\\/11 18:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003etriaged for 10.8.\u003c\\/p\u003e\\n\\n\u003cp\u003eA lot of progress has been made on this issue, and it looks ready for 10.8.  Work is being done incrementally, probably soon should close this one based on checked in work, and log a new one to track possible work post 10.8.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12994415_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12994415_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Feb\\/11 18:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-14T18:49:53+0000\'\u003e14\\/Feb\\/11 18:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    triaged for 10.8. \\n\\n A lot of progress has been made on this issue, and it looks ready for 10.8.  Work is being done incrementally, probably soon should close this one based on checked in work, and log a new one to track possible work post 10.8.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12994578\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12994578&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12994578\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12994578_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12994578_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/11 00:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-15T00:03:08+0000\'\u003e15\\/Feb\\/11 00:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading patch derby-4741-sleeps-waits-more. This patch contains the\u003cbr\\/\u003e\\nrest of the code locations containg calls to Object#wait and\u003cbr\\/\u003e\\nThread#sleep that I intend to make interrupt proof for this issue. It\u003cbr\\/\u003e\\nis not ready for commit, but please have a look. (I am still\u003cbr\\/\u003e\\nconsidering a few more, including occurences in BasicDaemon.java).\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso uploading the list of occurences I used as input:\u003cbr\\/\u003e\\nwait-0-usages.txt, wait-1-usages.txt, sleep-1-usages.txt, annotated as\u003cbr\\/\u003e\\nfollows: \\\"v\\\" fixed or not relevant (e.g. test code), \\\"-\\\" I will not\u003cbr\\/\u003e\\nchange (not embedded Derby, cf. functional specification) and \\\"?\\\"\u003cbr\\/\u003e\\nstill pondering what to do (BasicDaemon).\u003c\\/p\u003e\\n\\n\u003cp\u003eRegressions ran ok, although it doesn\'t say much, since most of the\u003cbr\\/\u003e\\nchanges only apply when interrupts happen.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12994578_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12994578_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/11 00:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-15T00:03:08+0000\'\u003e15\\/Feb\\/11 00:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading patch derby-4741-sleeps-waits-more. This patch contains the \\nrest of the code locations containg calls to Object#wait and \\nThread#sleep that I intend to make interrupt proof for this issue. It \\nis not ready for commit, but please have a look. (I am still \\nconsidering a few more, including occurences in BasicDaemon.java). \\n\\n Also uploading the list of occurences I used as input: \\nwait-0-usages.txt, wait-1-usages.txt, sleep-1-usages.txt, annotated as \\nfollows: \\\"v\\\" fixed or not relevant (e.g. test code), \\\"-\\\" I will not \\nchange (not embedded Derby, cf. functional specification) and \\\"?\\\" \\nstill pondering what to do (BasicDaemon). \\n\\n Regressions ran ok, although it doesn\'t say much, since most of the \\nchanges only apply when interrupts happen.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12996077\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12996077&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12996077\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12996077_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12996077_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/11 21:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-17T21:07:24+0000\'\u003e17\\/Feb\\/11 21:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading version 0.4 of the functional specification. Adds items to the list of unmodified behavior.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12996077_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12996077_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/11 21:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-17T21:07:24+0000\'\u003e17\\/Feb\\/11 21:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uploading version 0.4 of the functional specification. Adds items to the list of unmodified behavior.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12996083\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12996083&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12996083\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12996083_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12996083_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/11 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-17T21:13:04+0000\'\u003e17\\/Feb\\/11 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDev guide:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Do not use interrupt calls to notify threads that are accessing a\u003cbr\\/\u003e\\n&gt; database, because Derby will catch the interrupt call and close the\u003cbr\\/\u003e\\n&gt; connection to the database. Use wait and notify calls instead.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis advice stands still, I think. The modal verb \\\"will\\\" is slightly\u003cbr\\/\u003e\\ninaccurate here, it would be more correct to use \\\"could\\\" or\u003cbr\\/\u003e\\n\\\"might\\\". The functional specification spells this out in detail when\u003cbr\\/\u003e\\nthis can happen. \u003c\\/p\u003e\\n\\n\u003cp\u003eInterrupts can now be used to stop long-running queries, batches and\u003cbr\\/\u003e\\nstatements that wait for database locks. In all cases, the connection\u003cbr\\/\u003e\\nwill be closed along with the exception seen (state 08000), cf the specification.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12996083_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12996083_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/11 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-17T21:13:04+0000\'\u003e17\\/Feb\\/11 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Dev guide: \\n\\n &gt; Do not use interrupt calls to notify threads that are accessing a \\n&gt; database, because Derby will catch the interrupt call and close the \\n&gt; connection to the database. Use wait and notify calls instead. \\n\\n This advice stands still, I think. The modal verb \\\"will\\\" is slightly \\ninaccurate here, it would be more correct to use \\\"could\\\" or \\n\\\"might\\\". The functional specification spells this out in detail when \\nthis can happen.  \\n\\n Interrupts can now be used to stop long-running queries, batches and \\nstatements that wait for database locks. In all cases, the connection \\nwill be closed along with the exception seen (state 08000), cf the specification.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12996091\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12996091&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12996091\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"chaase3\\\" id=\\\"commentauthor_12996091_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=chaase3\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"chaase3\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kim Haase\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12996091_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/11 21:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-17T21:28:20+0000\'\u003e17\\/Feb\\/11 21:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks! Does \\\"long-running\\\" apply to all three nouns (\\\"queries, batches and statements that...\\\") or just the first?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"chaase3\\\" id=\\\"commentauthor_12996091_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=chaase3\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"chaase3\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kim Haase\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12996091_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Feb\\/11 21:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-17T21:28:20+0000\'\u003e17\\/Feb\\/11 21:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks! Does \\\"long-running\\\" apply to all three nouns (\\\"queries, batches and statements that...\\\") or just the first?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12998161\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12998161&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12998161\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998161_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998161_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T05:08:20+0000\'\u003e23\\/Feb\\/11 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted derby-4741-sleeps-waits-more as svn 1073595:\u003c\\/p\u003e\\n\\n\u003cp\u003eCommit message:\u003cbr\\/\u003e\\nPatch derby-4741-sleeps-waits-more, which \\\"regularizes\\\" a few more\u003cbr\\/\u003e\\ninstances of interrrupt handling to follow the idiom established in\u003cbr\\/\u003e\\nthis issue\'s patches. \u003c\\/p\u003e\\n\\n\u003cp\u003eThis leaves a few instances in BasicDaemon.java (as far as embedded\u003cbr\\/\u003e\\ncode is concerned), which will need more consideration. In any case,\u003cbr\\/\u003e\\ninterrupting the demon threads is less of a valid use case I believe,\u003cbr\\/\u003e\\ni.e. Derby\'s ability to tolerate that is less crucial that tolerating\u003cbr\\/\u003e\\ninterrupts to the user\'s connection threads.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998161_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998161_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T05:08:20+0000\'\u003e23\\/Feb\\/11 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed derby-4741-sleeps-waits-more as svn 1073595: \\n\\n Commit message: \\nPatch derby-4741-sleeps-waits-more, which \\\"regularizes\\\" a few more \\ninstances of interrrupt handling to follow the idiom established in \\nthis issue\'s patches.  \\n\\n This leaves a few instances in BasicDaemon.java (as far as embedded \\ncode is concerned), which will need more consideration. In any case, \\ninterrupting the demon threads is less of a valid use case I believe, \\ni.e. Derby\'s ability to tolerate that is less crucial that tolerating \\ninterrupts to the user\'s connection threads.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12998165\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12998165&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12998165\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998165_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998165_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 05:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T05:11:49+0000\'\u003e23\\/Feb\\/11 05:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e(reposting my answer from email here, since it didnt seem to make it to the JIRA issue)\u003c\\/p\u003e\\n\\n\u003cp\u003eKim&gt; Does \\\"long-running\\\" apply to all three nouns (\\\"queries, batches and statements that...\\\") or just the first?\u003c\\/p\u003e\\n\\n\u003cp\u003eGood question. All: I guess the definition of \\\"long\\\" here is relative to\u003cbr\\/\u003e\\nthe applications expectations. The third one (locks) is limited upward\u003cbr\\/\u003e\\nto the lock timeout for a single lock grab, but that may not be the\u003cbr\\/\u003e\\nwhole story since the statement may need further locks to complete. So\u003cbr\\/\u003e\\n\\\"longer than expected\\\" is perhaps more to the point..\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998165_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998165_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 05:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T05:11:49+0000\'\u003e23\\/Feb\\/11 05:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    (reposting my answer from email here, since it didnt seem to make it to the JIRA issue) \\n\\n Kim&gt; Does \\\"long-running\\\" apply to all three nouns (\\\"queries, batches and statements that...\\\") or just the first? \\n\\n Good question. All: I guess the definition of \\\"long\\\" here is relative to \\nthe applications expectations. The third one (locks) is limited upward \\nto the lock timeout for a single lock grab, but that may not be the \\nwhole story since the statement may need further locks to complete. So \\n\\\"longer than expected\\\" is perhaps more to the point..              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12998246\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12998246&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12998246\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12998246_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998246_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 08:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T08:47:18+0000\'\u003e23\\/Feb\\/11 08:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe last commit (#1073595) seems to have introduced some dependency that breaks the build in the Tinderbox: \u003ca href=\\\"http:\\/\\/dbtg.foundry.sun.com\\/derby\\/test\\/tinderbox_trunk16\\/UpdateInfo\\/1073598-buildDetails.txt\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/dbtg.foundry.sun.com\\/derby\\/test\\/tinderbox_trunk16\\/UpdateInfo\\/1073598-buildDetails.txt\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI am able to reproduce it if I explicitly point the jsr169compile.classpath property to Foundation + JSR-169 jars. I\'m not sure exactly what\'s causing it, but it looks like the iapi.types package now is compiled via the compile_mbeans target. That target uses compile.classpath, which is set to jsr169compile.classpath in build.xml, whereas the target that normally compiles SqlXmlUtil requires some extra XML libraries on the compile classpath.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12998246_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998246_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 08:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T08:47:18+0000\'\u003e23\\/Feb\\/11 08:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The last commit (#1073595) seems to have introduced some dependency that breaks the build in the Tinderbox:  http:\\/\\/dbtg.foundry.sun.com\\/derby\\/test\\/tinderbox_trunk16\\/UpdateInfo\\/1073598-buildDetails.txt  \\n\\n I am able to reproduce it if I explicitly point the jsr169compile.classpath property to Foundation + JSR-169 jars. I\'m not sure exactly what\'s causing it, but it looks like the iapi.types package now is compiled via the compile_mbeans target. That target uses compile.classpath, which is set to jsr169compile.classpath in build.xml, whereas the target that normally compiles SqlXmlUtil requires some extra XML libraries on the compile classpath.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12998471\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12998471&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12998471\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998471_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998471_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T17:52:49+0000\'\u003e23\\/Feb\\/11 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI backed out a change to TopService.java until we understand how to make it build correctly in those circumstances.\u003cbr\\/\u003e\\nsvn 1073846. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998471_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998471_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T17:52:49+0000\'\u003e23\\/Feb\\/11 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I backed out a change to TopService.java until we understand how to make it build correctly in those circumstances. \\nsvn 1073846.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12998620\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12998620&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12998620\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998620_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998620_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 23:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T23:56:37+0000\'\u003e23\\/Feb\\/11 23:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 24\\/Feb\\/11 00:05\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUploading a patch which reintroduces the fix that was backed out with changes to the build. Essentially it moves the compilation of MBeans out till after the iapis have been built. Thanks to Knut for pinpointing the feact that compilation of MBeans depends on Monitor, but is in fact compiled before the iapi currently. Setting the sourcepath for javac to \\\"\\\" for mbeans-compile highlighted the issue, cf this comment: \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4845?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;focusedCommentId=12998479#comment-12998479\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4845?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;focusedCommentId=12998479#comment-12998479\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eStill,exactly why this makes it compile with explicit setting of jsr169compile.classpath now, whereas it did not before, is still a bit unclear to me. It seems to work now, though. Running regressions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12998620_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998620_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Feb\\/11 23:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-23T23:56:37+0000\'\u003e23\\/Feb\\/11 23:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Dag H. Wanvik - 24\\/Feb\\/11 00:05\\\"\u003eedited\u003c\\/span\u003e                   Uploading a patch which reintroduces the fix that was backed out with changes to the build. Essentially it moves the compilation of MBeans out till after the iapis have been built. Thanks to Knut for pinpointing the feact that compilation of MBeans depends on Monitor, but is in fact compiled before the iapi currently. Setting the sourcepath for javac to \\\"\\\" for mbeans-compile highlighted the issue, cf this comment:  https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4845?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel&amp;focusedCommentId=12998479#comment-12998479  \\n\\n Still,exactly why this makes it compile with explicit setting of jsr169compile.classpath now, whereas it did not before, is still a bit unclear to me. It seems to work now, though. Running regressions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12998923\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12998923&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12998923\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12998923_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998923_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/11 16:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-24T16:31:19+0000\'\u003e24\\/Feb\\/11 16:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt is not totally clear to me why setting for the sourcepath and jsr169compile.classpath make the build work on all the platforms. More explanation will help people like me. :-\u003cbr\\/\u003e\\nSuites.all and derbyall run clean with derby-4741-fix-compilation.diff patch on my Windows 7. +1 for me to commit. Cheers and Thanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_12998923_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12998923_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/11 16:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-24T16:31:19+0000\'\u003e24\\/Feb\\/11 16:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It is not totally clear to me why setting for the sourcepath and jsr169compile.classpath make the build work on all the platforms. More explanation will help people like me. :- \\nSuites.all and derbyall run clean with derby-4741-fix-compilation.diff patch on my Windows 7. +1 for me to commit. Cheers and Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12999701\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12999701&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12999701\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12999701_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12999701_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/11 03:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-26T03:08:40+0000\'\u003e26\\/Feb\\/11 03:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Lily, it is not clear to me either \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e The dependencies in our\u003cbr\\/\u003e\\npresent compile is partly hard coded in the build.xml files, but that\u003cbr\\/\u003e\\nis not the whole story. It seems that if the compiler notices it lacks\u003cbr\\/\u003e\\na class, it can check for it in the source path and compile it outside\u003cbr\\/\u003e\\nthe normal order to fulfill the dependency. Setting the classpath to\u003cbr\\/\u003e\\n\\\"\\\" denies the compiler task this ability, forcing the hard coded\u003cbr\\/\u003e\\ndependencies to be the unique determinants of compilation order. Knut\u003cbr\\/\u003e\\ndid an experiment to do that for most compiles, but it quickly turned\u003cbr\\/\u003e\\nmessy as far as I understood.\u003c\\/p\u003e\\n\\n\u003cp\u003eCf this quote from the javac task doc (\u003ca href=\\\"http:\\/\\/www.jajakarta.org\\/ant\\/ant-1.6.1\\/docs\\/en\\/manual\\/CoreTasks\\/javac.html):\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.jajakarta.org\\/ant\\/ant-1.6.1\\/docs\\/en\\/manual\\/CoreTasks\\/javac.html):\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"If you wish to compile only files explicitly specified and disable\u003cbr\\/\u003e\\njavac\'s default searching mechanism then you can unset the sourcepath\u003cbr\\/\u003e\\nattribute:\u003c\\/p\u003e\\n\\n\u003cp\u003e  &lt;javac sourcepath=\\\"\\\" srcdir=\\\"${src}\\\"\u003cbr\\/\u003e\\n         destdir=\\\"${build}\\\" &gt;\u003cbr\\/\u003e\\n    &lt;include name=\\\"*\u003cb\u003e\\/\u003c\\/b\u003e.java\\\" \\/&gt;\u003cbr\\/\u003e\\n    &lt;exclude name=\\\"**\\/Example.java\\\" \\/&gt;\u003cbr\\/\u003e\\n  &lt;\\/javac&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003eThat way the javac will compile all java source files under \\\"${src}\\\"\u003cbr\\/\u003e\\ndirectory but skip the examples. The compiler will even produce errors\u003cbr\\/\u003e\\nif some of the non-example files refers to them. \\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eSo far so good. I can\'t explain why setting jsr169compile.classpath\u003cbr\\/\u003e\\nexplicitly made things break though. I just fiddled with the placement\u003cbr\\/\u003e\\nof the compilation of mbeans till it worked... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e But in general, it\u003cbr\\/\u003e\\nmatters under which javac tash a class is compiled in Derby, since we\u003cbr\\/\u003e\\nuse so many tweaks for classpath handling to enable seperate Java\u003cbr\\/\u003e\\nversions, jsr169, JDBC3, 4... I think it woul dbe good if we could\u003cbr\\/\u003e\\nmove to having the dependencies better understood and encoded in the\u003cbr\\/\u003e\\nbuild files, cf. Knut\'s experiment, so we can untangle all these\u003cbr\\/\u003e\\nintricate dependencies, and suffer less every time anything changes..\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12999701_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12999701_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/11 03:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-26T03:08:40+0000\'\u003e26\\/Feb\\/11 03:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Lily, it is not clear to me either   The dependencies in our \\npresent compile is partly hard coded in the build.xml files, but that \\nis not the whole story. It seems that if the compiler notices it lacks \\na class, it can check for it in the source path and compile it outside \\nthe normal order to fulfill the dependency. Setting the classpath to \\n\\\"\\\" denies the compiler task this ability, forcing the hard coded \\ndependencies to be the unique determinants of compilation order. Knut \\ndid an experiment to do that for most compiles, but it quickly turned \\nmessy as far as I understood. \\n\\n Cf this quote from the javac task doc ( http:\\/\\/www.jajakarta.org\\/ant\\/ant-1.6.1\\/docs\\/en\\/manual\\/CoreTasks\\/javac.html):  \\n\\n \\\"If you wish to compile only files explicitly specified and disable \\njavac\'s default searching mechanism then you can unset the sourcepath \\nattribute: \\n\\n   &lt;javac sourcepath=\\\"\\\" srcdir=\\\"${src}\\\" \\n         destdir=\\\"${build}\\\" &gt; \\n    &lt;include name=\\\"* \\/ .java\\\" \\/&gt; \\n    &lt;exclude name=\\\"**\\/Example.java\\\" \\/&gt; \\n  &lt;\\/javac&gt; \\n\\n That way the javac will compile all java source files under \\\"${src}\\\" \\ndirectory but skip the examples. The compiler will even produce errors \\nif some of the non-example files refers to them. \\\" \\n\\n So far so good. I can\'t explain why setting jsr169compile.classpath \\nexplicitly made things break though. I just fiddled with the placement \\nof the compilation of mbeans till it worked...   But in general, it \\nmatters under which javac tash a class is compiled in Derby, since we \\nuse so many tweaks for classpath handling to enable seperate Java \\nversions, jsr169, JDBC3, 4... I think it woul dbe good if we could \\nmove to having the dependencies better understood and encoded in the \\nbuild files, cf. Knut\'s experiment, so we can untangle all these \\nintricate dependencies, and suffer less every time anything changes..              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12999710\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=12999710&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12999710\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12999710_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12999710_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/11 03:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-26T03:43:53+0000\'\u003e26\\/Feb\\/11 03:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted 1074789 (derby-4741-fix-compilation). I don\'t plan more work on this feature now, resolving.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12999710_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12999710_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/11 03:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-26T03:43:53+0000\'\u003e26\\/Feb\\/11 03:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed 1074789 (derby-4741-fix-compilation). I don\'t plan more work on this feature now, resolving.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13000021\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=13000021&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13000021\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_13000021_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13000021_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/11 18:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-27T18:24:28+0000\'\u003e27\\/Feb\\/11 18:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThank you so much, Dag. I couldn\\u2019t agree more. We should define the dependencies better and move toward to more fine rule in the build files and have easier life every time we need to change thing to make Derby better. A lot of things appear to be easy but take a lot of time to do once you get all the details. :-  The devil is always in the detail. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lilywei\\\" id=\\\"commentauthor_13000021_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lilywei\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lilywei\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Lily Wei\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13000021_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/11 18:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-02-27T18:24:28+0000\'\u003e27\\/Feb\\/11 18:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thank you so much, Dag. I couldn\\u2019t agree more. We should define the dependencies better and move toward to more fine rule in the build files and have easier life every time we need to change thing to make Derby better. A lot of things appear to be easy but take a lot of time to do once you get all the details. :-  The devil is always in the detail.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13685379\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4741?focusedCommentId=13685379&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13685379\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13685379_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13685379_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jun\\/13 09:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-06-17T09:19:51+0000\'\u003e17\\/Jun\\/13 09:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;bulk update&#93;\u003c\\/span\u003e Close all resolved issues that haven\'t been updated for more than one year.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_13685379_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13685379_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jun\\/13 09:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-06-17T09:19:51+0000\'\u003e17\\/Jun\\/13 09:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;bulk update&#93;  Close all resolved issues that haven\'t been updated for more than one year.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520239990373"> 
    <input type="hidden" title="jira.request.server.time" value="570"> 
    <input type="hidden" title="jira.request.id" value="533x94409931x2"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="2"> 
    <input type="hidden" title="db.reads.time.in.ms" value="76"> 
    <input type="hidden" title="db.conns.time.in.ms" value="85"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 533x94409931x2
	          REQUEST TIMESTAMP : [05/Mar/2018:08:53:10 +0000]
	               REQUEST TIME : 0.5700
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 2

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=60, elapsedTotal=76105240, elapsedMin=216607, elapsedMax=28454514, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=64, elapsedTotal=85282343, elapsedMin=238157, elapsedMax=28806877, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>