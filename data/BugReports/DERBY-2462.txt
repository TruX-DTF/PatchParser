<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|939d23d9f48c624d09a0f65a694f8e950b509c13|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"d3a617b48d4872\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-2462"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-2462] org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-2462] org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-2462">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-2462" href="/jira/browse/DERBY-2462" id="key-val" rel="12365142">DERBY-2462</a></li>
                </ol>
                <h1 id="summary-val">org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-2462"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-2462/DERBY-2462.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-2462/DERBY-2462.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-2462/DERBY-2462.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-2462/DERBY-2462.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.1.1.0 ">10.1.1.0</span>, <span title="10.1.2.1 ">10.1.2.1</span>, <span title="10.1.3.1 ">10.1.3.1</span>, <span title="10.2.1.6 ">10.2.1.6</span>, <span title="10.2.2.0 ">10.2.2.0</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.3.1.4" title="10.3.1.4 ">10.3.1.4</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+Store" title="Store ">Store</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12365142-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Test under Windows Vista, Java 1.4.2_13 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>After an unrelated statement on the same connection commits, and after some number of successful calls to ResultSet.next(), a subsequent call to ResultSet.next() throws an SQLException with a message like: The heap container with container id Container(-1, 1173965368428) is closed. This seems to be related to the hard-coded passing of false to the super in the constructor of org.apache.derby.impl.store.access.BackingStoreHashTableFromScan.</p> 
                  <p>Steps to reproduce:</p> 
                  <p>1. Execute a statement on a connection that returns a result set.</p> 
                  <p>2. Execute a second statement on the same connection that modifies the database and commits.</p> 
                  <p>3. Call next() on the first result set until the exception is thrown.</p> 
                  <p>Note that the number of rows that can be successfully retrieved from the result set seems to be related to the amount of data per row. Increasing the number of columns in the result set or the length of the columns causes the exception to be taken sooner.</p> 
                  <p>The attached test program demonstrates the issue.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-2462?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-2462?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-2462?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-2462?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12353551" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12353551/DERBY-2462-1.diff" draggable="true" data-downloadurl="text/x-patch:DERBY-2462-1.diff:https://issues.apache.org/jira/secure/attachment/12353551/DERBY-2462-1.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12353551/DERBY-2462-1.diff" title="Latest  16/Mar/07 23:15 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:DERBY-2462-1.diff:https://issues.apache.org/jira/secure/attachment/12353551/DERBY-2462-1.diff">DERBY-2462-1.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-16T23:15:29.929Z">16/Mar/07 23:15</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12353552" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12353552/DERBY-2462-1.stat" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-1.stat:https://issues.apache.org/jira/secure/attachment/12353552/DERBY-2462-1.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12353552/DERBY-2462-1.stat" title="Latest  16/Mar/07 23:15 - Dag H. Wanvik" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-1.stat:https://issues.apache.org/jira/secure/attachment/12353552/DERBY-2462-1.stat">DERBY-2462-1.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-16T23:15:29.994Z">16/Mar/07 23:15</time>
                   </dd>
                   <dd class="attachment-size">
                    0.5 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12353919" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12353919/DERBY-2462-2.diff" draggable="true" data-downloadurl="text/x-patch:DERBY-2462-2.diff:https://issues.apache.org/jira/secure/attachment/12353919/DERBY-2462-2.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12353919/DERBY-2462-2.diff" title="Latest  22/Mar/07 02:21 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:DERBY-2462-2.diff:https://issues.apache.org/jira/secure/attachment/12353919/DERBY-2462-2.diff">DERBY-2462-2.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-22T02:21:56.280Z">22/Mar/07 02:21</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12353920" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12353920/DERBY-2462-2.stat" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-2.stat:https://issues.apache.org/jira/secure/attachment/12353920/DERBY-2462-2.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12353920/DERBY-2462-2.stat" title="Latest  22/Mar/07 02:21 - Dag H. Wanvik" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-2.stat:https://issues.apache.org/jira/secure/attachment/12353920/DERBY-2462-2.stat">DERBY-2462-2.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-22T02:21:56.300Z">22/Mar/07 02:21</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12356091" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12356091/DERBY-2462-3.diff" draggable="true" data-downloadurl="text/x-patch:DERBY-2462-3.diff:https://issues.apache.org/jira/secure/attachment/12356091/DERBY-2462-3.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12356091/DERBY-2462-3.diff" title="Latest  23/Apr/07 21:30 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-patch:DERBY-2462-3.diff:https://issues.apache.org/jira/secure/attachment/12356091/DERBY-2462-3.diff">DERBY-2462-3.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-04-23T21:30:36.490Z">23/Apr/07 21:30</time>
                   </dd>
                   <dd class="attachment-size">
                    21 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12356092" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12356092/DERBY-2462-3.stat" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-3.stat:https://issues.apache.org/jira/secure/attachment/12356092/DERBY-2462-3.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12356092/DERBY-2462-3.stat" title="Latest  23/Apr/07 21:30 - Dag H. Wanvik" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-3.stat:https://issues.apache.org/jira/secure/attachment/12356092/DERBY-2462-3.stat">DERBY-2462-3.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-04-23T21:30:36.614Z">23/Apr/07 21:30</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12356358" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12356358/DERBY-2462-4.diff" draggable="true" data-downloadurl="text/x-diff:DERBY-2462-4.diff:https://issues.apache.org/jira/secure/attachment/12356358/DERBY-2462-4.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12356358/DERBY-2462-4.diff" title="Latest  26/Apr/07 18:05 - Dag H. Wanvik" draggable="true" data-downloadurl="text/x-diff:DERBY-2462-4.diff:https://issues.apache.org/jira/secure/attachment/12356358/DERBY-2462-4.diff">DERBY-2462-4.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-04-26T18:05:47.200Z">26/Apr/07 18:05</time>
                   </dd>
                   <dd class="attachment-size">
                    26 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12356359" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12356359/DERBY-2462-4.stat" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-4.stat:https://issues.apache.org/jira/secure/attachment/12356359/DERBY-2462-4.stat"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12356359/DERBY-2462-4.stat" title="Latest  26/Apr/07 18:05 - Dag H. Wanvik" draggable="true" data-downloadurl="application/x-subversion-stat:DERBY-2462-4.stat:https://issues.apache.org/jira/secure/attachment/12356359/DERBY-2462-4.stat">DERBY-2462-4.stat</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-04-26T18:05:47.363Z">26/Apr/07 18:05</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Dag H. Wanvik
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12353534" data-issue-id="12365142" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12353534/DerbyHoldabilityTest.java" draggable="true" data-downloadurl="text/plain:DerbyHoldabilityTest.java:https://issues.apache.org/jira/secure/attachment/12353534/DerbyHoldabilityTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12353534/DerbyHoldabilityTest.java" title="Latest  16/Mar/07 19:23 - Jeff Clary" draggable="true" data-downloadurl="text/plain:DerbyHoldabilityTest.java:https://issues.apache.org/jira/secure/attachment/12353534/DerbyHoldabilityTest.java">DerbyHoldabilityTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-03-16T19:23:08.292Z">16/Mar/07 19:23</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Jeff Clary
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_dagw" rel="dagw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Dag H. Wanvik&quot;,&quot;emailAddress&quot;:&quot;dag.wanvik@oracle.com&quot;,&quot;username&quot;:&quot;dagw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="dagw"></span></span> Dag H. Wanvik </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_clary2137" rel="clary2137" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Jeff Clary&quot;,&quot;emailAddress&quot;:&quot;jclary@actuate.com&quot;,&quot;username&quot;:&quot;clary2137&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="clary2137"></span></span> Jeff Clary </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">1</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="16/Mar/07 19:22"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-03-16T19:22:24+0000">16/Mar/07 19:22</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="16/Nov/07 15:17"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-11-16T15:17:09+0000">16/Nov/07 15:17</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="16/May/07 13:11"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-05-16T13:11:29+0000">16/May/07 13:11</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-2462?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-2462?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12481780\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12481780&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12481780\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12481780_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12481780_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/07 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-16T22:53:42+0000\'\u003e16\\/Mar\\/07 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe spilling of the hash table to disk was added in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-106\\\" title=\\\"HashJoinStrategy leads to java.lang.OutOfMemoryError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-106\\\"\u003e\u003cdel\u003eDERBY-106\u003c\\/del\u003e\u003c\\/a\u003e in svn\u003cbr\\/\u003e\\n157861. I checked the issue comments, the code changes and the tests,\u003cbr\\/\u003e\\nbut I did not find a clue to why false is passed (for keepAfterCommit) to super from\u003cbr\\/\u003e\\nBackingStoreHashTableFromScan.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI see the test for insensitive result sets (which also relies on\u003cbr\\/\u003e\\nspilling the hash table to disk) uses holdability=true, but the test\u003cbr\\/\u003e\\nfor join and distinct only tests the non-holdable case.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo it would seem holdability is not meant to work (or was postponed?)\u003cbr\\/\u003e\\nfor the join and distinct cases. Does anyone know the status of this? (The\u003cbr\\/\u003e\\ncontributor is not active in the community any longer).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12481780_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12481780_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/07 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-16T22:53:42+0000\'\u003e16\\/Mar\\/07 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The spilling of the hash table to disk was added in   DERBY-106   in svn \\n157861. I checked the issue comments, the code changes and the tests, \\nbut I did not find a clue to why false is passed (for keepAfterCommit) to super from \\nBackingStoreHashTableFromScan.   \\n\\n I see the test for insensitive result sets (which also relies on \\nspilling the hash table to disk) uses holdability=true, but the test \\nfor join and distinct only tests the non-holdable case. \\n\\n So it would seem holdability is not meant to work (or was postponed?) \\nfor the join and distinct cases. Does anyone know the status of this? (The \\ncontributor is not active in the community any longer).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12481785\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12481785&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12481785\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12481785_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12481785_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/07 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-16T23:15:30+0000\'\u003e16\\/Mar\\/07 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for making the JIRA issue, Jeff!\u003cbr\\/\u003e\\nI upload a preliminary patch (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e-1.*) which works for your repro\u003cbr\\/\u003e\\nprogram and which passes the regression tests (derbyall and suites.All)\u003cbr\\/\u003e\\non Solaris 10\\/x86, SUN JDK1.6.\u003cbr\\/\u003e\\nIt apparently fixes the hashed join case of spilling with holdability true; \u003cbr\\/\u003e\\nbut I have not  added extra tests yet. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch should probably not be committed until someone more familiar with\u003cbr\\/\u003e\\nthis part of the code has looked at this.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12481785_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12481785_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Mar\\/07 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-16T23:15:30+0000\'\u003e16\\/Mar\\/07 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for making the JIRA issue, Jeff! \\nI upload a preliminary patch (  DERBY-2462  -1.*) which works for your repro \\nprogram and which passes the regression tests (derbyall and suites.All) \\non Solaris 10\\/x86, SUN JDK1.6. \\nIt apparently fixes the hashed join case of spilling with holdability true;  \\nbut I have not  added extra tests yet.  \\n\\n The patch should probably not be committed until someone more familiar with \\nthis part of the code has looked at this.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12481794\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12481794&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12481794\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12481794_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12481794_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/07 00:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-17T00:22:54+0000\'\u003e17\\/Mar\\/07 00:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSee also discussion in thread in derby-dev:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.nabble.com\\/Possible-problem-in-org.apache.derby.impl.store.access.BackingStoreHashTableFromScan-tf3414777.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.nabble.com\\/Possible-problem-in-org.apache.derby.impl.store.access.BackingStoreHashTableFromScan-tf3414777.html\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12481794_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12481794_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Mar\\/07 00:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-17T00:22:54+0000\'\u003e17\\/Mar\\/07 00:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    See also discussion in thread in derby-dev: \\n http:\\/\\/www.nabble.com\\/Possible-problem-in-org.apache.derby.impl.store.access.BackingStoreHashTableFromScan-tf3414777.html               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12482304\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12482304&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12482304\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12482304_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12482304_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/07 03:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-20T03:51:45+0000\'\u003e20\\/Mar\\/07 03:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDag said:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I see the test for insensitive result sets (which also relies on\u003cbr\\/\u003e\\n&gt; spilling the hash table to disk) uses holdability=true, but the test\u003cbr\\/\u003e\\n&gt; for join and DISTINCT only tests the non-holdable case. \u003c\\/p\u003e\\n\\n\u003cp\u003eChecking the test SpillHash.java (from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-106\\\" title=\\\"HashJoinStrategy leads to java.lang.OutOfMemoryError\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-106\\\"\u003e\u003cdel\u003eDERBY-106\u003c\\/del\u003e\u003c\\/a\u003e) further, I see that\u003cbr\\/\u003e\\nnone of the cases actually do run with holdability: Apparently the\u003cbr\\/\u003e\\ncase for insensitive result sets does, but I got misled by the fact\u003cbr\\/\u003e\\nthat the test relies on the metadata method\u003cbr\\/\u003e\\nsupportsOpenCursorsAcrossCommit() which always returns false for\u003cbr\\/\u003e\\nDerby, as it turns out, since we do not support holdability for XA. So\u003cbr\\/\u003e\\nthe test chooses to run without holdability.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen enabling holdability in the test cases in SpillHash.java, I see\u003cbr\\/\u003e\\nthe following:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ehash join fails with the same error as reported in this issue,\u003c\\/li\u003e\\n\\t\u003cli\u003escroll insensitive result sets work (to be expected, has other\u003cbr\\/\u003e\\n   tests).\u003c\\/li\u003e\\n\\t\u003cli\u003eDISTINCT fails with an exception NoSuchElementException in\u003cbr\\/\u003e\\n   DiskHashTable#nextElement.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eMy first patch fixes the hash join case, but not the DISTINCT case,\u003cbr\\/\u003e\\nbecause this accesses the spilled rows in the hash tabledifferently;\u003cbr\\/\u003e\\nit uses a heap scan which fails (the hash join case accesses the\u003cbr\\/\u003e\\nspiiled rows via a btree lookup of the hash key) since the scan is\u003cbr\\/\u003e\\nclosed due to the commit, and not reopened. I am working on a patch\u003cbr\\/\u003e\\nwhich fixes this as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12482304_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12482304_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/07 03:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-20T03:51:45+0000\'\u003e20\\/Mar\\/07 03:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Dag said: \\n\\n &gt; I see the test for insensitive result sets (which also relies on \\n&gt; spilling the hash table to disk) uses holdability=true, but the test \\n&gt; for join and DISTINCT only tests the non-holdable case.  \\n\\n Checking the test SpillHash.java (from   DERBY-106  ) further, I see that \\nnone of the cases actually do run with holdability: Apparently the \\ncase for insensitive result sets does, but I got misled by the fact \\nthat the test relies on the metadata method \\nsupportsOpenCursorsAcrossCommit() which always returns false for \\nDerby, as it turns out, since we do not support holdability for XA. So \\nthe test chooses to run without holdability. \\n\\n When enabling holdability in the test cases in SpillHash.java, I see \\nthe following: \\n\\n \\n\\t hash join fails with the same error as reported in this issue, \\n\\t scroll insensitive result sets work (to be expected, has other \\n   tests). \\n\\t DISTINCT fails with an exception NoSuchElementException in \\n   DiskHashTable#nextElement. \\n \\n\\n\\n My first patch fixes the hash join case, but not the DISTINCT case, \\nbecause this accesses the spilled rows in the hash tabledifferently; \\nit uses a heap scan which fails (the hash join case accesses the \\nspiiled rows via a btree lookup of the hash key) since the scan is \\nclosed due to the commit, and not reopened. I am working on a patch \\nwhich fixes this as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12482990\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12482990&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12482990\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12482990_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12482990_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/07 02:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-22T02:21:56+0000\'\u003e22\\/Mar\\/07 02:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e-2.\u003c\\/p\u003e\\n{stat,diff}\\n\u003cp\u003e supercedes \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e-1.  It does\u003cbr\\/\u003e\\nthe following:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003emodifies the test lang\\/SpillHash.java to run the test cases both\u003cbr\\/\u003e\\n     with and without holdability set for the three tests of the disk\u003cbr\\/\u003e\\n     spill of the backing store hash table:\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ehash join result set\u003c\\/li\u003e\\n\\t\u003cli\u003edistinct result set\u003c\\/li\u003e\\n\\t\u003cli\u003escollable insensitive result set\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e     The changed test will reveal the same problem as the repro\u003cbr\\/\u003e\\n     provided for this issue (if applied before the rest of this\u003cbr\\/\u003e\\n     patch), as well as a failure of the distinct result set test case. \u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003emodifies BackingStoreHashTableFromScan to use the holdable\u003cbr\\/\u003e\\n     mode of the disk hash table if applicable to the query.\u003cbr\\/\u003e\\n     This change was encessary to make the hash join test case\u003cbr\\/\u003e\\n     of SpillHash.java work with holdability.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003emodifies DiskHashtable.java to enable its enumerator class\u003cbr\\/\u003e\\n     ElementEnum to survives a commit. It uses a scan of the row\u003cbr\\/\u003e\\n     conglomerate (heap). Under holdability, the scan gets closed at\u003cbr\\/\u003e\\n     commit time, and ElementEnum#nextElement would fail. The patch\u003cbr\\/\u003e\\n     reopens the scan if appropriate (under holdability).  In addition\u003cbr\\/\u003e\\n     to the change in BackingStoreHashTableFromScan, this change was\u003cbr\\/\u003e\\n     necessary to make the distinct test case of SpillHash.java work\u003cbr\\/\u003e\\n     with holdability.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e     I would especially appreciate if someone familiar with this area\u003cbr\\/\u003e\\n     of the code could take a look at this part of the patch; the\u003cbr\\/\u003e\\n     method I use for salvaging the scan is to save the row location\u003cbr\\/\u003e\\n     after each nextElement, and use that to reopen the scan at the\u003cbr\\/\u003e\\n     right position after a commit. I did not find a way to check\u003cbr\\/\u003e\\n     if the scan was closed before attempting a fetch; I just catch\u003cbr\\/\u003e\\n     the exception and check for SQLState.AM_SCAN_NOT_POSITIONED, in\u003cbr\\/\u003e\\n     which I reopen the scan (only under holdability). I seems a bit of a\u003cbr\\/\u003e\\n     hack; there may be a better way.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch fixes the repro, I ran derbyall and suites.All with no\u003cbr\\/\u003e\\nerrors on JDK1.6 under Solaris 10\\/x86. It is ready for review.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12482990_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12482990_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Mar\\/07 02:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-03-22T02:21:56+0000\'\u003e22\\/Mar\\/07 02:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch,   DERBY-2462  -2. \\n{stat,diff}\\n  supercedes   DERBY-2462  -1.  It does \\nthe following: \\n\\n \\n\\t modifies the test lang\\/SpillHash.java to run the test cases both \\n     with and without holdability set for the three tests of the disk \\n     spill of the backing store hash table: \\n \\n\\n\\n \\n\\t hash join result set \\n\\t distinct result set \\n\\t scollable insensitive result set \\n \\n\\n\\n      The changed test will reveal the same problem as the repro \\n     provided for this issue (if applied before the rest of this \\n     patch), as well as a failure of the distinct result set test case.  \\n\\n \\n\\t modifies BackingStoreHashTableFromScan to use the holdable \\n     mode of the disk hash table if applicable to the query. \\n     This change was encessary to make the hash join test case \\n     of SpillHash.java work with holdability. \\n \\n\\n\\n \\n\\t modifies DiskHashtable.java to enable its enumerator class \\n     ElementEnum to survives a commit. It uses a scan of the row \\n     conglomerate (heap). Under holdability, the scan gets closed at \\n     commit time, and ElementEnum#nextElement would fail. The patch \\n     reopens the scan if appropriate (under holdability).  In addition \\n     to the change in BackingStoreHashTableFromScan, this change was \\n     necessary to make the distinct test case of SpillHash.java work \\n     with holdability. \\n \\n\\n\\n      I would especially appreciate if someone familiar with this area \\n     of the code could take a look at this part of the patch; the \\n     method I use for salvaging the scan is to save the row location \\n     after each nextElement, and use that to reopen the scan at the \\n     right position after a commit. I did not find a way to check \\n     if the scan was closed before attempting a fetch; I just catch \\n     the exception and check for SQLState.AM_SCAN_NOT_POSITIONED, in \\n     which I reopen the scan (only under holdability). I seems a bit of a \\n     hack; there may be a better way. \\n\\n The patch fixes the repro, I ran derbyall and suites.All with no \\nerrors on JDK1.6 under Solaris 10\\/x86. It is ready for review.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12490462\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12490462&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12490462\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12490462_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12490462_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/07 22:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-20T22:05:05+0000\'\u003e20\\/Apr\\/07 22:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am not familiar with this area of code so I cannot make any definitive comments on whether or not the changes are correct nor on if there may be a better way.  I did look at the patch, though, and had the following two questions.  These are both minor and somewhat theoretical, so I don\'t think either should block commit of the patch.  Just my proverbial two cents...\u003c\\/p\u003e\\n\\n\u003cp\u003e1) The interaction of the various ScanController interfaces and implementations has me completely confused (which has nothing to do with your changes) but I did notice one interface called ScanManager, which extends ScanController, that defines a \\\"closeForEndTransaction(boolean)\\\" method:\u003c\\/p\u003e\\n\\n\u003cp\u003e  \u003ca href=\\\"http:\\/\\/db.apache.org\\/derby\\/javadoc\\/engine\\/org\\/apache\\/derby\\/iapi\\/store\\/access\\/conglomerate\\/ScanManager.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/db.apache.org\\/derby\\/javadoc\\/engine\\/org\\/apache\\/derby\\/iapi\\/store\\/access\\/conglomerate\\/ScanManager.html\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI also noticed that most of the Scan implementations apparently implement the ScanManager class.  At least, that\'s what I gather from the above javadoc page; I tried to verify that by looking at the actual code but got lost in no time.  In any event, I was wondering if that method could somehow be used to indicate that a ScanController has been closed as the result of a commit.  Then instead of catching an exception in DiskHashtable, you could try something like:\u003c\\/p\u003e\\n\\n\u003cp\u003e     try\u003cbr\\/\u003e\\n     {\u003cbr\\/\u003e\\n        \\/\\/ \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e: if holdable and scan got closed due\u003cbr\\/\u003e\\n        \\/\\/ to commit, we need to reopen where we left off\u003cbr\\/\u003e\\n        if (scan.closedByCommit() &amp;&amp; keepAfterCommit)\u003c\\/p\u003e\\n        {\\n            scan = openRowConglomerate(tc, rowConglomerateId);\\n            scan.positionAtRowLocation(rowloc);\\n        }\\n\u003cp\u003e        scan.fetch(row);\u003c\\/p\u003e\\n\\n\u003cp\u003ewhere \\\"scan.closedByCommit()\\\" would return true if the scan was closed by a ScanManager.closeForEndTransaction() call.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs I said, that\'s just a theoretical.  I don\'t know if it\'s actually possible to get something like that working, but since I noticed the method I thought I\'d ask.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf that type of check is not possible then it seems like we should at least be able to add an \\\"isClosed()\\\" or \\\"isPositioned()\\\" method to the ScanController that could be used instead of catching the exception.  Is there something in particular that would make such an aproach infeasible?\u003c\\/p\u003e\\n\\n\u003cp\u003e2) The patch includes the following diff in DiskHashtable:\u003c\\/p\u003e\\n\\n\u003cp\u003e +    \\/\\/ \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e: if holdable and scan got closed due\u003cbr\\/\u003e\\n +    \\/\\/ to commit, we need to reopen where we left off\u003cbr\\/\u003e\\n +    if (keepAfterCommit &amp;&amp; (SQLState.AM_SCAN_NOT_POSITIONED.\u003cbr\\/\u003e\\n +            substring(0,5).\u003cbr\\/\u003e\\n +            equals(e.getSQLState()))) {\u003cbr\\/\u003e\\n +        scan = openRowConglomerate(tc, rowConglomerateId);\u003cbr\\/\u003e\\n +        scan.positionAtRowLocation(rowloc);\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like we first make a call to reopen the scan, then we call \\\"positionAtRowLocation()\\\".  But the javadoc for the latter method (see ScanController.java) seems to indicate that the reopen happens automatically:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/**\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ePositions the scan at row location and locks the row.\u003c\\/li\u003e\\n\\t\u003cli\u003eIf the scan is not opened, it will be reopened if this is a holdable\u003c\\/li\u003e\\n\\t\u003cli\u003escan and there has not been any operations which causes RowLocations\u003c\\/li\u003e\\n\\t\u003cli\u003eto be invalidated.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIs this javadoc correct?  If so, then is it necessary to explicitly call \\\"openRowConglomerate()\\\" in the above diff, or could we get by without it?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, the javadoc mentions that \\\"positionAtRowLocation()\\\" locks the row.  The javadoc for ScanController.fetch() doesn\'t mention anything about locking the row, but I\'m assuming it happens anyway...is that correct? (excuse my ignorance here). Can you confirm that row locking occurs as expected with these changes?  I have no reason to believe otherwise, just thought I\'d ask.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s worth repeating here that I am not familiar with this area of code and thus this feedback could be of little-to-no-value, so please keep that in mind.  If any committer out there (including you) wishes to commit these changes as they are, I would not complain.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn a more concrete level, I verified that the new lang\\/SpillHash.java test runs cleanly with your changes and fails with error XSCH6 without them, as expected.  So thanks for fixing that test up.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12490462_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12490462_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Apr\\/07 22:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-20T22:05:05+0000\'\u003e20\\/Apr\\/07 22:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am not familiar with this area of code so I cannot make any definitive comments on whether or not the changes are correct nor on if there may be a better way.  I did look at the patch, though, and had the following two questions.  These are both minor and somewhat theoretical, so I don\'t think either should block commit of the patch.  Just my proverbial two cents... \\n\\n 1) The interaction of the various ScanController interfaces and implementations has me completely confused (which has nothing to do with your changes) but I did notice one interface called ScanManager, which extends ScanController, that defines a \\\"closeForEndTransaction(boolean)\\\" method: \\n\\n    http:\\/\\/db.apache.org\\/derby\\/javadoc\\/engine\\/org\\/apache\\/derby\\/iapi\\/store\\/access\\/conglomerate\\/ScanManager.html  \\n\\n I also noticed that most of the Scan implementations apparently implement the ScanManager class.  At least, that\'s what I gather from the above javadoc page; I tried to verify that by looking at the actual code but got lost in no time.  In any event, I was wondering if that method could somehow be used to indicate that a ScanController has been closed as the result of a commit.  Then instead of catching an exception in DiskHashtable, you could try something like: \\n\\n      try \\n     { \\n        \\/\\/   DERBY-2462  : if holdable and scan got closed due \\n        \\/\\/ to commit, we need to reopen where we left off \\n        if (scan.closedByCommit() &amp;&amp; keepAfterCommit) \\n        {\\n            scan = openRowConglomerate(tc, rowConglomerateId);\\n            scan.positionAtRowLocation(rowloc);\\n        }\\n         scan.fetch(row); \\n\\n where \\\"scan.closedByCommit()\\\" would return true if the scan was closed by a ScanManager.closeForEndTransaction() call. \\n\\n As I said, that\'s just a theoretical.  I don\'t know if it\'s actually possible to get something like that working, but since I noticed the method I thought I\'d ask. \\n\\n If that type of check is not possible then it seems like we should at least be able to add an \\\"isClosed()\\\" or \\\"isPositioned()\\\" method to the ScanController that could be used instead of catching the exception.  Is there something in particular that would make such an aproach infeasible? \\n\\n 2) The patch includes the following diff in DiskHashtable: \\n\\n  +    \\/\\/   DERBY-2462  : if holdable and scan got closed due \\n +    \\/\\/ to commit, we need to reopen where we left off \\n +    if (keepAfterCommit &amp;&amp; (SQLState.AM_SCAN_NOT_POSITIONED. \\n +            substring(0,5). \\n +            equals(e.getSQLState()))) { \\n +        scan = openRowConglomerate(tc, rowConglomerateId); \\n +        scan.positionAtRowLocation(rowloc); \\n\\n It looks like we first make a call to reopen the scan, then we call \\\"positionAtRowLocation()\\\".  But the javadoc for the latter method (see ScanController.java) seems to indicate that the reopen happens automatically: \\n\\n     \\/** \\n \\n\\t Positions the scan at row location and locks the row. \\n\\t If the scan is not opened, it will be reopened if this is a holdable \\n\\t scan and there has not been any operations which causes RowLocations \\n\\t to be invalidated. \\n \\n\\n\\n Is this javadoc correct?  If so, then is it necessary to explicitly call \\\"openRowConglomerate()\\\" in the above diff, or could we get by without it? \\n\\n Also, the javadoc mentions that \\\"positionAtRowLocation()\\\" locks the row.  The javadoc for ScanController.fetch() doesn\'t mention anything about locking the row, but I\'m assuming it happens anyway...is that correct? (excuse my ignorance here). Can you confirm that row locking occurs as expected with these changes?  I have no reason to believe otherwise, just thought I\'d ask. \\n\\n It\'s worth repeating here that I am not familiar with this area of code and thus this feedback could be of little-to-no-value, so please keep that in mind.  If any committer out there (including you) wishes to commit these changes as they are, I would not complain. \\n\\n On a more concrete level, I verified that the new lang\\/SpillHash.java test runs cleanly with your changes and fails with error XSCH6 without them, as expected.  So thanks for fixing that test up.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12491073\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12491073&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12491073\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12491073_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491073_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/07 21:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-23T21:30:36+0000\'\u003e23\\/Apr\\/07 21:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the review, Army! \u003c\\/p\u003e\\n\\n\u003cp\u003eI attach a new version of the patch, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e-3.* which supercedes\u003cbr\\/\u003e\\nearlier versions. I address your comments explicitly below. Relative\u003cbr\\/\u003e\\nto the previous version (*-2.diff), this patch:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) opens the heap scan in DiskHashtable#ElementEnum\'s constructor with\u003cbr\\/\u003e\\n   hold=true if we have holdability. Required for item 3) below to\u003cbr\\/\u003e\\n   work.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) avoids having to catch the not positioned exception in\u003cbr\\/\u003e\\n   DiskHashtable#nextElement, when the scan has been closed, by using\u003cbr\\/\u003e\\n   the new method ScanController#isPositioned.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) removes the call to openRowConglomerate, now relying on\u003cbr\\/\u003e\\n   positionAtRowLocation to do the reopening when required under\u003cbr\\/\u003e\\n   holdability. \u003c\\/p\u003e\\n\\n\u003cp\u003e4) checks the result of positionAtRowLocation to verify that it\u003cbr\\/\u003e\\n   worked, else throw an exception \\\"24000\\\" NO_CURRENT_ROW. It can fail\u003cbr\\/\u003e\\n   if the row location has been invalidated by compress. Pretty\u003cbr\\/\u003e\\n   unlikely, but one never knows..\u003c\\/p\u003e\\n\\n\u003cp\u003e5) removes the exit() calls from the SpillHash.java test to make it\u003cbr\\/\u003e\\n   runnable with -Duseprocess=false\u003c\\/p\u003e\\n\\n\u003cp\u003e6) some small cleanup in DiskHashtable.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegression tests ran cleanly on Sun 1.4 Solaris 10\\/x86.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eAnswers to Army\'s review comments:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 1) The interaction of the various ScanController interfaces and\u003cbr\\/\u003e\\n&gt; implementations has me completely confused (which has nothing to do\u003c\\/p\u003e\\n\\n\u003cp\u003eyou are not alone... \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; If that type of check is not possible then it seems like we should\u003cbr\\/\u003e\\n&gt; at least be able to add an \\\"isClosed()\\\" or \\\"isPositioned()\\\" method\u003cbr\\/\u003e\\n&gt; to the ScanController that could be used instead of catching the\u003cbr\\/\u003e\\n&gt; exception. Is there something in particular that would make such an\u003cbr\\/\u003e\\n&gt; aproach infeasible?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, I thought of something like this too. I finally added a method\u003cbr\\/\u003e\\nScanController#isPositioned, and implemented it for heap and btree\u003cbr\\/\u003e\\nscans (only used by the former, though).\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; It looks like we first make a call to reopen the scan, then we call\u003cbr\\/\u003e\\n&gt; \\\"positionAtRowLocation()\\\". But the javadoc for the latter method\u003cbr\\/\u003e\\n&gt; (see ScanController.java) seems to indicate that the reopen happens\u003cbr\\/\u003e\\n&gt; automatically:\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt;     \\/**\u003cbr\\/\u003e\\n&gt;      * Positions the scan at row location and locks the row.\u003cbr\\/\u003e\\n&gt;      * If the scan is not opened, it will be reopened if this is a holdable\u003cbr\\/\u003e\\n&gt;      * scan and there has not been any operations which causes RowLocations\u003cbr\\/\u003e\\n&gt;      * to be invalidated.\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; Is this javadoc correct? If so, then is it necessary to explicitly\u003cbr\\/\u003e\\n&gt; call \\\"openRowConglomerate()\\\" in the above diff, or could we get by\u003cbr\\/\u003e\\n&gt; without it?\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, no and yes. Much cleaner, thanks. See item 1) and 3) above.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Also, the javadoc mentions that \\\"positionAtRowLocation()\\\" locks the\u003cbr\\/\u003e\\n&gt; row. The javadoc for ScanController.fetch() doesn\'t mention anything\u003cbr\\/\u003e\\n&gt; about locking the row, but I\'m assuming it happens anyway...is that\u003cbr\\/\u003e\\n&gt; correct? (excuse my ignorance here). Can you confirm that row\u003cbr\\/\u003e\\n&gt; locking occurs as expected with these changes? I have no reason to\u003cbr\\/\u003e\\n&gt; believe otherwise, just thought I\'d ask.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, locking is performed as a consequence of calling\u003cbr\\/\u003e\\npositionAtRowLocation, see HeapScan#positionAtRowLocation which calls\u003cbr\\/\u003e\\nreopenScanByRecordHandleAndSetLocks. \u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; It\'s worth repeating here that I am not familiar with this area of\u003cbr\\/\u003e\\n&gt; code and thus this feedback could be of little-to-no-value, so\u003cbr\\/\u003e\\n&gt; please keep that in mind. \u003c\\/p\u003e\\n\\n\u003cp\u003eI very much appreciate your feedback; I am also unfamiliar with this\u003cbr\\/\u003e\\narea of the code, and an extra set of eyes is always useful! The patch\u003cbr\\/\u003e\\nis cleaner now, I think. Thanks again! \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12491073_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491073_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/07 21:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-23T21:30:36+0000\'\u003e23\\/Apr\\/07 21:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the review, Army!  \\n\\n I attach a new version of the patch,   DERBY-2462  -3.* which supercedes \\nearlier versions. I address your comments explicitly below. Relative \\nto the previous version (*-2.diff), this patch: \\n\\n 1) opens the heap scan in DiskHashtable#ElementEnum\'s constructor with \\n   hold=true if we have holdability. Required for item 3) below to \\n   work. \\n\\n 2) avoids having to catch the not positioned exception in \\n   DiskHashtable#nextElement, when the scan has been closed, by using \\n   the new method ScanController#isPositioned. \\n\\n 3) removes the call to openRowConglomerate, now relying on \\n   positionAtRowLocation to do the reopening when required under \\n   holdability.  \\n\\n 4) checks the result of positionAtRowLocation to verify that it \\n   worked, else throw an exception \\\"24000\\\" NO_CURRENT_ROW. It can fail \\n   if the row location has been invalidated by compress. Pretty \\n   unlikely, but one never knows.. \\n\\n 5) removes the exit() calls from the SpillHash.java test to make it \\n   runnable with -Duseprocess=false \\n\\n 6) some small cleanup in DiskHashtable. \\n\\n Regression tests ran cleanly on Sun 1.4 Solaris 10\\/x86. \\n\\n\\n Answers to Army\'s review comments: \\n\\n &gt; 1) The interaction of the various ScanController interfaces and \\n&gt; implementations has me completely confused (which has nothing to do \\n\\n you are not alone...   \\n\\n &gt; If that type of check is not possible then it seems like we should \\n&gt; at least be able to add an \\\"isClosed()\\\" or \\\"isPositioned()\\\" method \\n&gt; to the ScanController that could be used instead of catching the \\n&gt; exception. Is there something in particular that would make such an \\n&gt; aproach infeasible? \\n\\n Yes, I thought of something like this too. I finally added a method \\nScanController#isPositioned, and implemented it for heap and btree \\nscans (only used by the former, though). \\n\\n &gt; It looks like we first make a call to reopen the scan, then we call \\n&gt; \\\"positionAtRowLocation()\\\". But the javadoc for the latter method \\n&gt; (see ScanController.java) seems to indicate that the reopen happens \\n&gt; automatically: \\n&gt;  \\n&gt;     \\/** \\n&gt;      * Positions the scan at row location and locks the row. \\n&gt;      * If the scan is not opened, it will be reopened if this is a holdable \\n&gt;      * scan and there has not been any operations which causes RowLocations \\n&gt;      * to be invalidated. \\n&gt;  \\n&gt; Is this javadoc correct? If so, then is it necessary to explicitly \\n&gt; call \\\"openRowConglomerate()\\\" in the above diff, or could we get by \\n&gt; without it? \\n\\n Yes, no and yes. Much cleaner, thanks. See item 1) and 3) above. \\n\\n &gt; Also, the javadoc mentions that \\\"positionAtRowLocation()\\\" locks the \\n&gt; row. The javadoc for ScanController.fetch() doesn\'t mention anything \\n&gt; about locking the row, but I\'m assuming it happens anyway...is that \\n&gt; correct? (excuse my ignorance here). Can you confirm that row \\n&gt; locking occurs as expected with these changes? I have no reason to \\n&gt; believe otherwise, just thought I\'d ask. \\n\\n Yes, locking is performed as a consequence of calling \\npositionAtRowLocation, see HeapScan#positionAtRowLocation which calls \\nreopenScanByRecordHandleAndSetLocks.  \\n\\n &gt; It\'s worth repeating here that I am not familiar with this area of \\n&gt; code and thus this feedback could be of little-to-no-value, so \\n&gt; please keep that in mind.  \\n\\n I very much appreciate your feedback; I am also unfamiliar with this \\narea of the code, and an extra set of eyes is always useful! The patch \\nis cleaner now, I think. Thanks again!                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12491102\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12491102&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12491102\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12491102_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491102_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/07 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-23T23:54:18+0000\'\u003e23\\/Apr\\/07 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThank you for considering my feedback, Dag.  The v3 patch is indeed cleaner now.\u003c\\/p\u003e\\n\\n\u003cp\u003eTwo follow-up questions that occur to me:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) The new \\\"isPositioned()\\\" method checks to see if the current scan_state is \\\"SCAN_INPROGRESS\\\".  This works well enough for the case we\'re trying to address--i.e. the scan was closed due to a commit and is therefore no longer \\\"in progress\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e  My question is: are there any scenarios in which we could get to the new code when the scan was closed for some reason \u003cb\u003eother\u003c\\/b\u003e than a commit?  If this is possible, will attempting to re-open the scan in such a scenario cause problems?\u003c\\/p\u003e\\n\\n\u003cp\u003e  I don\'t know enough about the lifetime of a scan to give any examples of when or if this could happen, but given the generality of the isPositioned() method I thought I\'d bring it up.\u003c\\/p\u003e\\n\\n\u003cp\u003e  I did notice that one of the possible scan states is (pulled from BTreeScan):\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eSCAN_HOLD_INPROGRESS -\u003c\\/li\u003e\\n\\t\u003cli\u003eThe scan has been opened and held open across a commit,\u003c\\/li\u003e\\n\\t\u003cli\u003eat the last commit the state was in SCAN_INPROGRESS.\u003c\\/li\u003e\\n\\t\u003cli\u003eThe transaction which opened the scan has committed,\u003c\\/li\u003e\\n\\t\u003cli\u003ebut the scan was opened with the \\\"hold\\\" option true.\u003c\\/li\u003e\\n\\t\u003cli\u003eAt commit the locks were released and the \\\"current\\\"\u003c\\/li\u003e\\n\\t\u003cli\u003eposition is remembered.  In this state only two calls\u003c\\/li\u003e\\n\\t\u003cli\u003eare valid, either next() or close().  When next() is\u003c\\/li\u003e\\n\\t\u003cli\u003ecalled the scan is reopened, the underlying container\u003c\\/li\u003e\\n\\t\u003cli\u003eis opened thus associating all new locks with the current\u003c\\/li\u003e\\n\\t\u003cli\u003etransaction, and the scan continues at the \\\"next\\\" row.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  To see what would happen I changed \\\"isPositioned()\\\" method to:\u003c\\/p\u003e\\n\\n\u003cp\u003e     public boolean isPositioned() throws StandardException\u003c\\/p\u003e\\n     {\\n         return scan_state == SCAN_HOLD_INPROGRESS;\\n     }\\n\\n\u003cp\u003e  and then dropped the negation from the check in DiskHashtable:\u003c\\/p\u003e\\n\\n\u003cp\u003e     if (keepAfterCommit &amp;&amp; scan.isPositioned()) {\u003cbr\\/\u003e\\n         \\/\\/ automatically reopens scan:\u003cbr\\/\u003e\\n         if (!scan.positionAtRowLocation(rowloc)) \u003c\\/p\u003e\\n{\\n             \\/\\/ Will not happen unless compress of this table\\n             \\/\\/ has invalidated the row location. Possible?\\n             throw StandardException.\\n                 newException(SQLState.NO_CURRENT_ROW);\\n         }\\n\u003cp\u003e     }\u003c\\/p\u003e\\n\\n\u003cp\u003e  I then ran lang\\/SpillHash.java and the test still passed. The good thing about this approach is that we will only execute the \\\"reopen\\\" logic if we know for a fact that the \\\"scan has been opened and held open across a commit\\\"--which is exactly what we want.  Also, if we rename \\\"isPositioned()\\\" to something more appropriate, the \\\"if\\\" statement in DiskHashtable becomes more intuitive:\u003c\\/p\u003e\\n\\n\u003cp\u003e     if (scan.heldAcrossCommit()) {\u003cbr\\/\u003e\\n         \\/\\/ automatically reopens scan:\u003cbr\\/\u003e\\n         if (!scan.positionAtRowLocation(rowloc)) {\u003c\\/p\u003e\\n\\n\u003cp\u003e  Note that you wouldn\'t need to include \\\"keepAfterCommit\\\" anymore because the scan state can only be \\\"HOLD_INPROGRESS\\\" if the scan was opened with \\\"hold\\\" set to true, which (I think?) can only happen if \\\"keepAfterCommit\\\" is true.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) I noticed that the lang\\/SpillHash.java test checks to make sure that the scan is still available after a commit if holdOverCommit is true.  This is good because that\'s the whole point of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e.  I was wondering, though,  if it would be worth it to check that the correct \u003cb\u003eerror\u003c\\/b\u003e is thrown if a call to \\\"next()\\\" is made after a commit when holdOverCommit is \u003cb\u003efalse\u003c\\/b\u003e.  Or is that already tested somewhere else?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for your patience with my ramblings...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12491102_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491102_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/07 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-23T23:54:18+0000\'\u003e23\\/Apr\\/07 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thank you for considering my feedback, Dag.  The v3 patch is indeed cleaner now. \\n\\n Two follow-up questions that occur to me: \\n\\n 1) The new \\\"isPositioned()\\\" method checks to see if the current scan_state is \\\"SCAN_INPROGRESS\\\".  This works well enough for the case we\'re trying to address--i.e. the scan was closed due to a commit and is therefore no longer \\\"in progress\\\". \\n\\n   My question is: are there any scenarios in which we could get to the new code when the scan was closed for some reason  other  than a commit?  If this is possible, will attempting to re-open the scan in such a scenario cause problems? \\n\\n   I don\'t know enough about the lifetime of a scan to give any examples of when or if this could happen, but given the generality of the isPositioned() method I thought I\'d bring it up. \\n\\n   I did notice that one of the possible scan states is (pulled from BTreeScan): \\n\\n \\n\\t SCAN_HOLD_INPROGRESS - \\n\\t The scan has been opened and held open across a commit, \\n\\t at the last commit the state was in SCAN_INPROGRESS. \\n\\t The transaction which opened the scan has committed, \\n\\t but the scan was opened with the \\\"hold\\\" option true. \\n\\t At commit the locks were released and the \\\"current\\\" \\n\\t position is remembered.  In this state only two calls \\n\\t are valid, either next() or close().  When next() is \\n\\t called the scan is reopened, the underlying container \\n\\t is opened thus associating all new locks with the current \\n\\t transaction, and the scan continues at the \\\"next\\\" row. \\n \\n\\n\\n   To see what would happen I changed \\\"isPositioned()\\\" method to: \\n\\n      public boolean isPositioned() throws StandardException \\n     {\\n         return scan_state == SCAN_HOLD_INPROGRESS;\\n     }\\n\\n   and then dropped the negation from the check in DiskHashtable: \\n\\n      if (keepAfterCommit &amp;&amp; scan.isPositioned()) { \\n         \\/\\/ automatically reopens scan: \\n         if (!scan.positionAtRowLocation(rowloc))  \\n{\\n             \\/\\/ Will not happen unless compress of this table\\n             \\/\\/ has invalidated the row location. Possible?\\n             throw StandardException.\\n                 newException(SQLState.NO_CURRENT_ROW);\\n         }\\n      } \\n\\n   I then ran lang\\/SpillHash.java and the test still passed. The good thing about this approach is that we will only execute the \\\"reopen\\\" logic if we know for a fact that the \\\"scan has been opened and held open across a commit\\\"--which is exactly what we want.  Also, if we rename \\\"isPositioned()\\\" to something more appropriate, the \\\"if\\\" statement in DiskHashtable becomes more intuitive: \\n\\n      if (scan.heldAcrossCommit()) { \\n         \\/\\/ automatically reopens scan: \\n         if (!scan.positionAtRowLocation(rowloc)) { \\n\\n   Note that you wouldn\'t need to include \\\"keepAfterCommit\\\" anymore because the scan state can only be \\\"HOLD_INPROGRESS\\\" if the scan was opened with \\\"hold\\\" set to true, which (I think?) can only happen if \\\"keepAfterCommit\\\" is true. \\n\\n 2) I noticed that the lang\\/SpillHash.java test checks to make sure that the scan is still available after a commit if holdOverCommit is true.  This is good because that\'s the whole point of   DERBY-2462  .  I was wondering, though,  if it would be worth it to check that the correct  error  is thrown if a call to \\\"next()\\\" is made after a commit when holdOverCommit is  false .  Or is that already tested somewhere else? \\n\\n Thanks for your patience with my ramblings...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12491481\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12491481&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12491481\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12491481_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491481_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/07 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-24T23:14:54+0000\'\u003e24\\/Apr\\/07 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your continued help with this one, Army!\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; 1) ...\u003cbr\\/\u003e\\n&gt;   My question is: are there any scenarios in which we could get to\u003cbr\\/\u003e\\n&gt; the new code when the scan was closed for some reason \u003cb\u003eother\u003c\\/b\u003e than a\u003cbr\\/\u003e\\n&gt; commit? If this is possible, will attempting to re-open the scan in\u003cbr\\/\u003e\\n&gt; such a scenario cause problems?\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t believe so, but let me try an analysis:\u003c\\/p\u003e\\n\\n\u003cp\u003eThe states of the scan (heap, I omit btree here for simplicity\u003cbr\\/\u003e\\nalthough i believe it is similar) is one of\u003c\\/p\u003e\\n\\n    {SCAN_INIT,\\n     SCAN_INPROGRESS,\\n     SCAN_DONE,\\n     SCAN_HOLD_INIT,\\n     SCAN_HOLD_INPROGRESS}\\n\\n\u003cp\u003e Btw, the comment at the top of GenericScanController (used for heap\u003cbr\\/\u003e\\n scan along with subclass HeapScan) omits the \u003cb\u003e\u003cem\u003eHOLD\u003c\\/em\u003e\u003c\\/b\u003e states, so it\u003cbr\\/\u003e\\n is out of date..\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThe constructor of DiskHashTable#ElementEnum opens the scan.  This\u003cbr\\/\u003e\\n  moves the scan state to SCAN_INIT if successful. If not, it is\u003cbr\\/\u003e\\n  silently swallowed (not good!), and the enumeration will have zero\u003cbr\\/\u003e\\n  elements (hasMore==false).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eNext, the constructor performs a scan.next() which sets the boolean\u003cbr\\/\u003e\\n  state variable \\\"hasMore\\\". When this is true, the scan state will be\u003cbr\\/\u003e\\n  SCAN_INPROGRESS, when its is false, there are no more data and the\u003cbr\\/\u003e\\n  scan state will be SCAN_DONE. So when the constructor of ElementEnum\u003cbr\\/\u003e\\n  returns, the scan state (if no error occurred) will be one of\u003cbr\\/\u003e\\n  \\n{SCAN_INPROGRESS, SCAN_DONE}.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n  If we have holdability: The state SCAN_HOLD_INIT can only happen if\u003cbr\\/\u003e\\n  a commit happens \u003cb\u003ebefore\u003c\\/b\u003e an initial next() is performed, so that\u003cbr\\/\u003e\\n  state can not happen for this scan. Also, I believe there are no\u003cbr\\/\u003e\\n  state transitions possible back to SCAN_INIT or SCAN_HOLD_INIT once\u003cbr\\/\u003e\\n  a next() is performed and {SCAN_INPROGRESS, SCAN_DONE}\\n\u003cp\u003e is reached (I\u003cbr\\/\u003e\\n  did some inspection).\u003c\\/p\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eNow, when ElementEnum#nextElement() is attempted, there are four cases\u003cbr\\/\u003e\\n  cases: \u003cbr\\/\u003e\\n     n1) holdability and no commit has happened \u003cbr\\/\u003e\\n     n2) holdability and a commit happened\u003cbr\\/\u003e\\n     n3) no holdability and  no commit has happened \u003cbr\\/\u003e\\n     n4) no holdability and a commit happened\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  n1) Scan state should be either \u003cbr\\/\u003e\\n      SCAN_INPROGRESS (and hasMore == true) or \u003cbr\\/\u003e\\n      SCAN_DONE (and hasMore == false).\u003c\\/p\u003e\\n\\n\u003cp\u003e      If hasMore == false, NoSuchElementException is thrown.  \u003cbr\\/\u003e\\n      If hasMore == true, state should be SCAN_INPROGRESS,\u003cbr\\/\u003e\\n      isPositioned() returns true and the fetch will succeed. Also a\u003cbr\\/\u003e\\n      new next() is performed which moves the state to one of\u003cbr\\/\u003e\\n      \u003c\\/p\u003e\\n{SCAN_INPROGRESS, SCAN_DONE}.\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n  n2) Scan state should be either \u003cbr\\/\u003e\\n      SCAN_HOLD_INPROGRESS\\u00B9 (and hasMore == true) or \u003cbr\\/\u003e\\n      SCAN_DONE (and hasMore == false).\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n      If hasMore == false, NoSuchElementException is thrown. This\u003cbr\\/\u003e\\n      would not normally happen, since nextElement would not be\u003cbr\\/\u003e\\n      called, cf, hasMoreElements().\u003cbr\\/\u003e\\n\u003cbr\\/\u003e\\n      If hasMore == true, state should be SCAN_HOLD_INPROGRESS: Our\u003cbr\\/\u003e\\n      predicate \\\"(keepAfterCommit &amp;&amp; !scan.isPositioned()\\\" == true and\u003cbr\\/\u003e\\n      we reopen scan before doing the fetch, which should succeed.  A\u003cbr\\/\u003e\\n      new next() is performed which moves the state to one of\u003cbr\\/\u003e\\n      {SCAN_INPROGRESS, SCAN_DONE}\\n\u003cp\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003e      \\u00B9see GenericScanController#closeForEndTransaction().\u003c\\/p\u003e\\n\\n\u003cp\u003e  n3) Similar to n1, except isPositioned() is not called.\u003c\\/p\u003e\\n\\n\u003cp\u003e  n4) Scan state should be SCAN_DONE,\u003cbr\\/\u003e\\n      cf. GenericScanController#closeForEndTransaction.\u003c\\/p\u003e\\n\\n\u003cp\u003e      In this case, nextElement is never called; the fact that the\u003cbr\\/\u003e\\n      result set is closed is caught at a higher level, e.g. in\u003cbr\\/\u003e\\n      BasicNoPutResultSetImpl#getNextRow() for the DISTINCT case\u003cbr\\/\u003e\\n      (SQLState.LANG_RESULT_SET_NOT_OPEN, ca line 463).\u003c\\/p\u003e\\n\\n\u003cp\u003e      Even if it were reached, no attempt to reopen it would be\u003cbr\\/\u003e\\n      performed (not held), and scan.fetch would throw\u003cbr\\/\u003e\\n      SQLState.AM_SCAN_NOT_POSITIONED, which is OK.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThere is a public method setScanState(state) in\u003cbr\\/\u003e\\n  GenericScanController which could conceivably be used to effect\u003cbr\\/\u003e\\n  other state transitions, but I checked, and it is only used by\u003cbr\\/\u003e\\n  HeapScan#positionAtRowLocation to transition from\u003cbr\\/\u003e\\n  SCAN_HOLD_INPROGRESS back to SCAN_INPROGRESS (and for a similar\u003cbr\\/\u003e\\n  purpose by HeapCompressScan).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eNow, for your question, would it better (safer) to explicitly test\u003cbr\\/\u003e\\n  for SCAN_HOLD_INPROGRESS with a method called, say,\u003cbr\\/\u003e\\n  heldAcrossCommit? I believe my analysis above shows that when the\u003cbr\\/\u003e\\n  call to isPositioned is performed, there are only two possible\u003cbr\\/\u003e\\n  states the scan can be in: SCAN_HOLD_INPROGRESS or SCAN_INPROGRESS,\u003cbr\\/\u003e\\n  so they are equally safe (as the code stands right now, anyway).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e  Now, whether there is, or were to be, some \u003cb\u003eother\u003c\\/b\u003e way of closing\u003cbr\\/\u003e\\n  the scan (moving it to SCAN_DONE without also closing the result\u003cbr\\/\u003e\\n  set), I don\'t know, but if it were, positionAtRowLocation will\u003cbr\\/\u003e\\n  actually try to reopen the scan (not sure if this is good or not \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e,\u003cbr\\/\u003e\\n  however scan.fetch() would fail with\u003cbr\\/\u003e\\n  SQLState.AM_SCAN_NOT_POSITIONED. If we use your approach, we would\u003cbr\\/\u003e\\n  not attempt to reopen in such a case, which may be safer.\u003c\\/p\u003e\\n\\n\u003cp\u003e  I agree heldAcrossCommit has the benefit of avoiding the test for\u003cbr\\/\u003e\\n  holdability as you indicate, which does make for easier reading of\u003cbr\\/\u003e\\n  the logic. I think I went for is isPositioned from a vague feeling\u003cbr\\/\u003e\\n  this was potentially more generally useful..\u003c\\/p\u003e\\n\\n\u003cp\u003e  Maybe a (even more) generally useful method could be:\u003c\\/p\u003e\\n\\n\u003cp\u003e    public boolean isHeldAfterCommit() throws StandardException\u003c\\/p\u003e\\n    {\\n        return (scan_state == SCAN_HOLD_INIT ||\\n                scan_state == SCAN_HOLD_INPROGRESS);\\n    }\\n\\n\u003cp\u003e  that is, if this returns true, the scan can always be reopened\u003cbr\\/\u003e\\n  (although in the case at hand, only the second state tested for may\u003cbr\\/\u003e\\n  occur as shown above).\u003c\\/p\u003e\\n\\n\u003cp\u003e  What do you think?\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e&gt; 2) .... I was wondering, though, if it would be worth it to check\u003cbr\\/\u003e\\n&gt; that the correct \u003cb\u003eerror\u003c\\/b\u003e is thrown if a call to \\\"next()\\\" is made\u003cbr\\/\u003e\\n&gt; after a commit when holdOverCommit is \u003cb\u003efalse\u003c\\/b\u003e. Or is that already\u003cbr\\/\u003e\\n&gt; tested somewhere else?\u003c\\/p\u003e\\n\\n\u003cp\u003eAs I mentioned above, the error is caught higher up in language layer\u003cbr\\/\u003e\\n(open result set or not), so I belive this is (or should be \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e tested\u003cbr\\/\u003e\\nfor elsewhere. I manually modified the test to verify that for all\u003cbr\\/\u003e\\nthree variants (join, distinct and cursor), this happened. If you this\u003cbr\\/\u003e\\nit is still advisable, I can add those tests cases to SpillHash.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you agree, I will make a version of the patch with the new\u003cbr\\/\u003e\\nisHeldAfterCommit outlined above.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12491481_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491481_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/07 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-24T23:14:54+0000\'\u003e24\\/Apr\\/07 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your continued help with this one, Army! \\n\\n &gt; 1) ... \\n&gt;   My question is: are there any scenarios in which we could get to \\n&gt; the new code when the scan was closed for some reason  other  than a \\n&gt; commit? If this is possible, will attempting to re-open the scan in \\n&gt; such a scenario cause problems? \\n\\n I don\'t believe so, but let me try an analysis: \\n\\n The states of the scan (heap, I omit btree here for simplicity \\nalthough i believe it is similar) is one of \\n\\n    {SCAN_INIT,\\n     SCAN_INPROGRESS,\\n     SCAN_DONE,\\n     SCAN_HOLD_INIT,\\n     SCAN_HOLD_INPROGRESS}\\n\\n  Btw, the comment at the top of GenericScanController (used for heap \\n scan along with subclass HeapScan) omits the   HOLD   states, so it \\n is out of date.. \\n\\n \\n\\t The constructor of DiskHashTable#ElementEnum opens the scan.  This \\n  moves the scan state to SCAN_INIT if successful. If not, it is \\n  silently swallowed (not good!), and the enumeration will have zero \\n  elements (hasMore==false). \\n \\n\\n\\n \\n\\t Next, the constructor performs a scan.next() which sets the boolean \\n  state variable \\\"hasMore\\\". When this is true, the scan state will be \\n  SCAN_INPROGRESS, when its is false, there are no more data and the \\n  scan state will be SCAN_DONE. So when the constructor of ElementEnum \\n  returns, the scan state (if no error occurred) will be one of \\n  \\n{SCAN_INPROGRESS, SCAN_DONE}. \\n \\n  If we have holdability: The state SCAN_HOLD_INIT can only happen if \\n  a commit happens  before  an initial next() is performed, so that \\n  state can not happen for this scan. Also, I believe there are no \\n  state transitions possible back to SCAN_INIT or SCAN_HOLD_INIT once \\n  a next() is performed and {SCAN_INPROGRESS, SCAN_DONE}\\n  is reached (I \\n  did some inspection).  \\n \\n\\n\\n \\n\\t Now, when ElementEnum#nextElement() is attempted, there are four cases \\n  cases:  \\n     n1) holdability and no commit has happened  \\n     n2) holdability and a commit happened \\n     n3) no holdability and  no commit has happened  \\n     n4) no holdability and a commit happened \\n \\n\\n\\n   n1) Scan state should be either  \\n      SCAN_INPROGRESS (and hasMore == true) or  \\n      SCAN_DONE (and hasMore == false). \\n\\n       If hasMore == false, NoSuchElementException is thrown.   \\n      If hasMore == true, state should be SCAN_INPROGRESS, \\n      isPositioned() returns true and the fetch will succeed. Also a \\n      new next() is performed which moves the state to one of \\n       \\n{SCAN_INPROGRESS, SCAN_DONE}. \\n \\n  n2) Scan state should be either  \\n      SCAN_HOLD_INPROGRESS\\u00B9 (and hasMore == true) or  \\n      SCAN_DONE (and hasMore == false). \\n \\n      If hasMore == false, NoSuchElementException is thrown. This \\n      would not normally happen, since nextElement would not be \\n      called, cf, hasMoreElements(). \\n \\n      If hasMore == true, state should be SCAN_HOLD_INPROGRESS: Our \\n      predicate \\\"(keepAfterCommit &amp;&amp; !scan.isPositioned()\\\" == true and \\n      we reopen scan before doing the fetch, which should succeed.  A \\n      new next() is performed which moves the state to one of \\n      {SCAN_INPROGRESS, SCAN_DONE}\\n . \\n\\n       \\u00B9see GenericScanController#closeForEndTransaction(). \\n\\n   n3) Similar to n1, except isPositioned() is not called. \\n\\n   n4) Scan state should be SCAN_DONE, \\n      cf. GenericScanController#closeForEndTransaction. \\n\\n       In this case, nextElement is never called; the fact that the \\n      result set is closed is caught at a higher level, e.g. in \\n      BasicNoPutResultSetImpl#getNextRow() for the DISTINCT case \\n      (SQLState.LANG_RESULT_SET_NOT_OPEN, ca line 463). \\n\\n       Even if it were reached, no attempt to reopen it would be \\n      performed (not held), and scan.fetch would throw \\n      SQLState.AM_SCAN_NOT_POSITIONED, which is OK. \\n\\n \\n\\t There is a public method setScanState(state) in \\n  GenericScanController which could conceivably be used to effect \\n  other state transitions, but I checked, and it is only used by \\n  HeapScan#positionAtRowLocation to transition from \\n  SCAN_HOLD_INPROGRESS back to SCAN_INPROGRESS (and for a similar \\n  purpose by HeapCompressScan). \\n \\n\\n\\n \\n\\t Now, for your question, would it better (safer) to explicitly test \\n  for SCAN_HOLD_INPROGRESS with a method called, say, \\n  heldAcrossCommit? I believe my analysis above shows that when the \\n  call to isPositioned is performed, there are only two possible \\n  states the scan can be in: SCAN_HOLD_INPROGRESS or SCAN_INPROGRESS, \\n  so they are equally safe (as the code stands right now, anyway). \\n \\n\\n\\n   Now, whether there is, or were to be, some  other  way of closing \\n  the scan (moving it to SCAN_DONE without also closing the result \\n  set), I don\'t know, but if it were, positionAtRowLocation will \\n  actually try to reopen the scan (not sure if this is good or not  , \\n  however scan.fetch() would fail with \\n  SQLState.AM_SCAN_NOT_POSITIONED. If we use your approach, we would \\n  not attempt to reopen in such a case, which may be safer. \\n\\n   I agree heldAcrossCommit has the benefit of avoiding the test for \\n  holdability as you indicate, which does make for easier reading of \\n  the logic. I think I went for is isPositioned from a vague feeling \\n  this was potentially more generally useful.. \\n\\n   Maybe a (even more) generally useful method could be: \\n\\n     public boolean isHeldAfterCommit() throws StandardException \\n    {\\n        return (scan_state == SCAN_HOLD_INIT ||\\n                scan_state == SCAN_HOLD_INPROGRESS);\\n    }\\n\\n   that is, if this returns true, the scan can always be reopened \\n  (although in the case at hand, only the second state tested for may \\n  occur as shown above). \\n\\n   What do you think? \\n\\n\\n &gt; 2) .... I was wondering, though, if it would be worth it to check \\n&gt; that the correct  error  is thrown if a call to \\\"next()\\\" is made \\n&gt; after a commit when holdOverCommit is  false . Or is that already \\n&gt; tested somewhere else? \\n\\n As I mentioned above, the error is caught higher up in language layer \\n(open result set or not), so I belive this is (or should be   tested \\nfor elsewhere. I manually modified the test to verify that for all \\nthree variants (join, distinct and cursor), this happened. If you this \\nit is still advisable, I can add those tests cases to SpillHash. \\n\\n If you agree, I will make a version of the patch with the new \\nisHeldAfterCommit outlined above.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12491683\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12491683&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12491683\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12491683_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491683_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/07 16:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-25T16:12:45+0000\'\u003e25\\/Apr\\/07 16:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThank you \u003cem\u003every\u003c\\/em\u003e much for the detailed analysis, Dag.   I feel better about the \\\"safety\\\" of your v3 changes after reading your previous comment.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;  Maybe a (even more) generally useful method could be:\u003cbr\\/\u003e\\n&gt;  \u003cbr\\/\u003e\\n&gt;    public boolean isHeldAfterCommit() throws StandardException\u003cbr\\/\u003e\\n&gt;    \u003c\\/p\u003e\\n{\\n&gt;        return (scan_state == SCAN_HOLD_INIT ||\\n&gt;                scan_state == SCAN_HOLD_INPROGRESS);\\n&gt;    }\\n\u003cp\u003e \u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt;  that is, if this returns true, the scan can always be reopened\u003cbr\\/\u003e\\n&gt;  (although in the case at hand, only the second state tested for may\u003cbr\\/\u003e\\n&gt;  occur as shown above).\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt;  What do you think?\u003c\\/p\u003e\\n\\n\u003cp\u003e+1, I like this idea even better.  Thank you for the suggestion and for your willingness to implement it.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I manually modified the test to verify that for all three variants (join, distinct and cursor),\u003cbr\\/\u003e\\n&gt; this happened. If you this it is still advisable, I can add those tests cases to SpillHash.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf it\'s not too much work I think this would be good.  I\'m sure there are tests elsewhere to check the general concept of cursor holdability across commits, but it might be nice to have a test case for the specific scenario of a spilled DiskHashtable.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; If you agree, I will make a version of the patch with the new isHeldAfterCommit outlined above.\u003c\\/p\u003e\\n\\n\u003cp\u003eSounds great.  Thanks again for your continued work with this, and for your prompt consideration of my feedback.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12491683_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12491683_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/07 16:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-25T16:12:45+0000\'\u003e25\\/Apr\\/07 16:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thank you  very  much for the detailed analysis, Dag.   I feel better about the \\\"safety\\\" of your v3 changes after reading your previous comment. \\n\\n &gt;  Maybe a (even more) generally useful method could be: \\n&gt;   \\n&gt;    public boolean isHeldAfterCommit() throws StandardException \\n&gt;     \\n{\\n&gt;        return (scan_state == SCAN_HOLD_INIT ||\\n&gt;                scan_state == SCAN_HOLD_INPROGRESS);\\n&gt;    }\\n   \\n&gt; \\n&gt;  that is, if this returns true, the scan can always be reopened \\n&gt;  (although in the case at hand, only the second state tested for may \\n&gt;  occur as shown above). \\n&gt; \\n&gt;  What do you think? \\n\\n +1, I like this idea even better.  Thank you for the suggestion and for your willingness to implement it. \\n\\n &gt; I manually modified the test to verify that for all three variants (join, distinct and cursor), \\n&gt; this happened. If you this it is still advisable, I can add those tests cases to SpillHash. \\n\\n If it\'s not too much work I think this would be good.  I\'m sure there are tests elsewhere to check the general concept of cursor holdability across commits, but it might be nice to have a test case for the specific scenario of a spilled DiskHashtable. \\n\\n &gt; If you agree, I will make a version of the patch with the new isHeldAfterCommit outlined above. \\n\\n Sounds great.  Thanks again for your continued work with this, and for your prompt consideration of my feedback.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12492080\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12492080&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12492080\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12492080_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12492080_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/07 18:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-26T18:05:47+0000\'\u003e26\\/Apr\\/07 18:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-2462\\\" title=\\\"org.apache.derby.impl.store.access.BackingStoreHashTableFromScan does not honor ResultSet holdability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-2462\\\"\u003e\u003cdel\u003eDERBY-2462\u003c\\/del\u003e\u003c\\/a\u003e-4.*) supercedes earlier versions.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs agreed,\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eit replaces ScanController#isPositioned with with isHeldAfterCommit\u003cbr\\/\u003e\\n  and uses that in DiskHashTable#ElementNum#NextElement.\u003c\\/li\u003e\\n\\t\u003cli\u003eit adds negative tests to SpillHash.java for the non-holdable cases\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eRan regression tests successfully again (Sun JDK 1.4 and 1.6), Solaris\u003cbr\\/\u003e\\n10\\/x86 modulo upgrade tests which failed as mentioned on derby-dev\u003cbr\\/\u003e\\n(unrelated I believe).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12492080_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12492080_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/07 18:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-26T18:05:47+0000\'\u003e26\\/Apr\\/07 18:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch (  DERBY-2462  -4.*) supercedes earlier versions. \\n\\n As agreed, \\n\\n \\n\\t it replaces ScanController#isPositioned with with isHeldAfterCommit \\n  and uses that in DiskHashTable#ElementNum#NextElement. \\n\\t it adds negative tests to SpillHash.java for the non-holdable cases \\n \\n\\n\\n Ran regression tests successfully again (Sun JDK 1.4 and 1.6), Solaris \\n10\\/x86 modulo upgrade tests which failed as mentioned on derby-dev \\n(unrelated I believe).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12492093\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12492093&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12492093\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12492093_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12492093_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/07 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-26T18:53:08+0000\'\u003e26\\/Apr\\/07 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLatest patch (version 4) incorporates all previous feedback and I have no other comments to make.  I applied the patch and ran lang\\/SpillHash.java with no problems.  I also ran the repro attached to this issue after applying the patch, and it ran cleanly.\u003c\\/p\u003e\\n\\n\u003cp\u003e+1 to commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you for your persistence with this issue, Dag.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"army\\\" id=\\\"commentauthor_12492093_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=army\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"army\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e A B\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12492093_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/07 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-04-26T18:53:08+0000\'\u003e26\\/Apr\\/07 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Latest patch (version 4) incorporates all previous feedback and I have no other comments to make.  I applied the patch and ran lang\\/SpillHash.java with no problems.  I also ran the repro attached to this issue after applying the patch, and it ran cleanly. \\n\\n +1 to commit. \\n\\n Thank you for your persistence with this issue, Dag.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12496286\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-2462?focusedCommentId=12496286&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12496286\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12496286_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12496286_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/07 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-05-16T13:09:26+0000\'\u003e16\\/May\\/07 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRefreshed the patch and ran derbyall and suites.All ok again, modulo\u003cbr\\/\u003e\\none seemingly intermittent error in ReleaseCompileLocksTest. I don\'t\u003cbr\\/\u003e\\nthis is related to this patch.  Committed as svn 538572.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12496286_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12496286_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/07 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-05-16T13:09:26+0000\'\u003e16\\/May\\/07 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Refreshed the patch and ran derbyall and suites.All ok again, modulo \\none seemingly intermittent error in ReleaseCompileLocksTest. I don\'t \\nthis is related to this patch.  Committed as svn 538572.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520238849966"> 
    <input type="hidden" title="jira.request.server.time" value="193"> 
    <input type="hidden" title="jira.request.id" value="514x94370293x5"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="6"> 
    <input type="hidden" title="db.reads.time.in.ms" value="20"> 
    <input type="hidden" title="db.conns.time.in.ms" value="25"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 514x94370293x5
	          REQUEST TIMESTAMP : [05/Mar/2018:08:34:09 +0000]
	               REQUEST TIME : 0.1930
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 6

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=19, elapsedTotal=20354518, elapsedMin=408399, elapsedMax=9994401, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=23, elapsedTotal=25149162, elapsedMin=440940, elapsedMax=10033901, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>