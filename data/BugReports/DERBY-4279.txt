<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|c71cac93a7a8c6f8a0730ec4ea5bb761d194cfbd|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"7e566ac7778961\"";
WRM._unparsedData["project-id"]="10594";
WRM._unparsedData["project-key"]="\"DERBY\"";
WRM._unparsedData["project-name"]="\"Derby\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="10594";
WRM._unparsedData["projectKey"]="\"DERBY\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="DERBY-4279"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[DERBY-4279] Statement cache deadlock - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[DERBY-4279] Statement cache deadlock - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/DERBY" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-4279">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="10594" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Derby'" src="https://issues.apache.org/jira/secure/projectavatar?pid=10594&amp;avatarId=10122"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/DERBY">Derby</a></li>
                 <li><a class="issue-link" data-issue-key="DERBY-4279" href="/jira/browse/DERBY-4279" id="key-val" rel="12428429">DERBY-4279</a></li>
                </ol>
                <h1 id="summary-val">Statement cache deadlock</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FDERBY-4279"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/DERBY-4279/DERBY-4279.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/DERBY-4279/DERBY-4279.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/DERBY-4279/DERBY-4279.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/DERBY-4279/DERBY-4279.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="10.0.2.1 snapshot">10.0.2.1</span>, <span title="10.1.3.1 ">10.1.3.1</span>, <span title="10.2.2.0 ">10.2.2.0</span>, <span title="10.3.3.0 ">10.3.3.0</span>, <span title="10.4.2.0 ">10.4.2.0</span>, <span title="10.5.1.1 build: 764942, 14/Apr/09. Voted release: 28/Apr/09. Announced: 1/May/09">10.5.1.1</span>, <span title="10.8.1.2 First release on the 10.8 branch">10.8.1.2</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.8.3.0" title="10.8.3.0 Third release on the 10.8 branch">10.8.3.0</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.9.2.2" title="10.9.2.2 Head of 10.9 branch after releasing 10.9.1.0">10.9.2.2</a>, <a href="/jira/issues/?jql=project+%3D+DERBY+AND+fixVersion+%3D+10.10.1.1" title="10.10.1.1 First release on the 10.10 branch">10.10.1.1</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+DERBY+AND+component+%3D+SQL" title="SQL ">SQL</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <ul class="labels" id="labels-12428429-value"> 
                     <li><a class="lozenge" href="/jira/issues/?jql=labels+%3D+derby_triage10_5_2" title="derby_triage10_5_2"><span>derby_triage10_5_2</span></a></li> 
                    </ul> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value">
                     Windows Vista, OS X 10.5+ 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310050" class="item"> 
                     <div class="wrap"> 
                      <strong title="Urgency" class="name">Urgency:</strong> 
                      <div id="customfield_12310050-val" class="value type-select" data-fieldtype="select" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:select">
                        Normal 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310090" class="item"> 
                     <div class="wrap"> 
                      <strong title="Issue &amp; fix info" class="name">Issue &amp; fix info:</strong> 
                      <div id="customfield_12310090-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310090-field"> 
                        <span>Repro attached</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                    <li id="rowForcustomfield_12310200" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bug behavior facts" class="name">Bug behavior facts:</strong> 
                      <div id="customfield_12310200-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310200-field"> 
                        <span>Seen in production</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Due to a design flaw in the statement cache, a deadlock can occur if a prepared statement becomes out-of-date.</p> 
                  <p>I will illustrate this with the following example:</p> 
                  <p>The application is using the embedded Derby driver. The application has two threads, and each thread uses its own connection.</p> 
                  <p>There is a table named MYTABLE with column MYCOLUMN.</p> 
                  <p>1. A thread prepares and executes the query SELECT MYCOLUMN FROM MYTABLE. The prepared statement is stored in the statement cache (see org.apache.derby.impl.sql.GenericStatement for this logic)<br> 2. After some time, the prepared statement becomes invalid or out-of-date for some reason (see org.apache.derby.impl.sql.GenericPreparedStatement)<br> 3. Thread 1 begins a transaction and executes LOCK TABLE MYTABLE IN EXCLUSIVE MODE<br> 4. Thread 2 begins a transaction and executes SELECT MYCOLUMN FROM MYTABLE. The statement is in the statement cache but it is out-of-date. The thread begins to recompile the statement. To compile the statement, the thread needs a shared lock on MYTABLE. Thread 1 already has an exclusive lock on MYTABLE. Thread 2 waits.<br> 5. Thread 1 executes SELECT MYCOLUMN FROM MYTABLE. The statement is in the statement cache but it is being compiled. Thread 1 waits on the statement's monitor.<br> 6. We have a deadlock. Derby eventually detects a lock timeout, but the error message is not descriptive. The stacks at the time of the deadlock are:</p> 
                  <p>This deadlock is unique because it can still occur in a properly designed database. You are only safe if all of your transactions are very simple and cannot be interleaved in a sequence that causes the deadlock, or if your particular statements do not require a table lock to compile. (For the sake of simplicity, I used LOCK TABLE in my example, but any UPDATE statement would fit.)</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/DERBY-4279?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/DERBY-4279?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/DERBY-4279?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/DERBY-4279?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12448187" data-issue-id="12428429" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12448187/client_stacktrace_activation_closed.txt" draggable="true" data-downloadurl="text/plain:client_stacktrace_activation_closed.txt:https://issues.apache.org/jira/secure/attachment/12448187/client_stacktrace_activation_closed.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12448187/client_stacktrace_activation_closed.txt" title="Latest  28/Jun/10 08:20 - Kristian Waagan" draggable="true" data-downloadurl="text/plain:client_stacktrace_activation_closed.txt:https://issues.apache.org/jira/secure/attachment/12448187/client_stacktrace_activation_closed.txt">client_stacktrace_activation_closed.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-06-28T08:20:11.901Z">28/Jun/10 08:20</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12411287" data-issue-id="12428429" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12411287/Derby4279.java" draggable="true" data-downloadurl="text/plain:Derby4279.java:https://issues.apache.org/jira/secure/attachment/12411287/Derby4279.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12411287/Derby4279.java" title="Latest  19/Jun/09 23:35 - Jeff Stuckman" draggable="true" data-downloadurl="text/plain:Derby4279.java:https://issues.apache.org/jira/secure/attachment/12411287/Derby4279.java">Derby4279.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2009-06-19T23:35:28.187Z">19/Jun/09 23:35</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Jeff Stuckman
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12533789" data-issue-id="12428429" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12533789/no-lock-experiment.diff" draggable="true" data-downloadurl="text/x-patch:no-lock-experiment.diff:https://issues.apache.org/jira/secure/attachment/12533789/no-lock-experiment.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12533789/no-lock-experiment.diff" title="Latest  28/Jun/12 08:10 - Kristian Waagan" draggable="true" data-downloadurl="text/x-patch:no-lock-experiment.diff:https://issues.apache.org/jira/secure/attachment/12533789/no-lock-experiment.diff">no-lock-experiment.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-28T08:10:42.811Z">28/Jun/12 08:10</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Kristian Waagan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12533615" data-issue-id="12428429" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12533615/patch4279_2.txt" draggable="true" data-downloadurl="text/plain:patch4279_2.txt:https://issues.apache.org/jira/secure/attachment/12533615/patch4279_2.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12533615/patch4279_2.txt" title="Latest  27/Jun/12 07:33 - Brett Wooldridge" draggable="true" data-downloadurl="text/plain:patch4279_2.txt:https://issues.apache.org/jira/secure/attachment/12533615/patch4279_2.txt">patch4279_2.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-27T07:33:58.786Z">27/Jun/12 07:33</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Wooldridge
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12447427" data-issue-id="12428429" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12447427/patch4279.txt" draggable="true" data-downloadurl="text/plain:patch4279.txt:https://issues.apache.org/jira/secure/attachment/12447427/patch4279.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12447427/patch4279.txt" title="Latest  18/Jun/10 03:24 - Brett Wooldridge" draggable="true" data-downloadurl="text/plain:patch4279.txt:https://issues.apache.org/jira/secure/attachment/12447427/patch4279.txt">patch4279.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-06-18T03:24:59.609Z">18/Jun/10 03:24</time>
                   </dd>
                   <dd class="attachment-size">
                    8 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Wooldridge
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12447063" data-issue-id="12428429" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12447063/stacktrace.txt" draggable="true" data-downloadurl="text/plain:stacktrace.txt:https://issues.apache.org/jira/secure/attachment/12447063/stacktrace.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12447063/stacktrace.txt" title="Latest  14/Jun/10 20:22 - Mamta A. Satoor" draggable="true" data-downloadurl="text/plain:stacktrace.txt:https://issues.apache.org/jira/secure/attachment/12447063/stacktrace.txt">stacktrace.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-06-14T20:22:31.278Z">14/Jun/10 20:22</time>
                   </dd>
                   <dd class="attachment-size">
                    36 kB
                   </dd>
                   <dd class="attachment-author">
                    Mamta A. Satoor
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="incorporates">
                   incorporates
                  </dt> 
                  <dd id="internal-12468091_12310010"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-4721: NullPointerException on StressMultiTest in language layer"> <a href="/jira/browse/DERBY-4721" data-issue-key="DERBY-4721" class="issue-link link-title resolution">DERBY-4721</a> <span class="link-summary">NullPointerException on StressMultiTest in language layer</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is duplicated by">
                   is duplicated by
                  </dt> 
                  <dd id="internal-12552109_12310000"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="DERBY-5703: Threads are stuck in ActiveLock.waitForGrant"> <a href="/jira/browse/DERBY-5703" data-issue-key="DERBY-5703" class="issue-link link-title resolution">DERBY-5703</a> <span class="link-summary">Threads are stuck in ActiveLock.waitForGrant</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_brettw" rel="brettw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Brett Wooldridge&quot;,&quot;emailAddress&quot;:&quot;brett.wooldridge@gmail.com&quot;,&quot;username&quot;:&quot;brettw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="brettw"></span></span> Brett Wooldridge </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_stuckman" rel="stuckman" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Jeff Stuckman&quot;,&quot;emailAddress&quot;:&quot;stuckman@umd.edu&quot;,&quot;username&quot;:&quot;stuckman&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="stuckman"></span></span> Jeff Stuckman </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">7</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">7</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="19/Jun/09 23:29"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2009-06-19T23:29:37+0000">19/Jun/09 23:29</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="03/Sep/14 08:31"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2014-09-03T08:31:36+0000">03/Sep/14 08:31</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="12/Sep/12 17:09"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-09-12T17:09:39+0000">12/Sep/12 17:09</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/DERBY-4279?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/DERBY-4279?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12722088\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12722088&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12722088\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stuckman\\\" id=\\\"commentauthor_12722088_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stuckman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stuckman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeff Stuckman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12722088_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/09 23:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-19T23:32:48+0000\'\u003e19\\/Jun\\/09 23:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOutput from test case:\u003c\\/p\u003e\\n\\n\u003cp\u003eInvalidating the prepared statements...\u003cbr\\/\u003e\\nTable locked.\u003cbr\\/\u003e\\nExecuting query 1. Query should block because other thread has lock.\u003cbr\\/\u003e\\nExecuting query 2. Query should not block because this thread already has the necessary locks.\u003cbr\\/\u003e\\njava.sql.SQLTransactionRollbackException: A lock could not be obtained within the time requested\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(Unknown Source)\u003cbr\\/\u003e\\n\\tat Derby4279$Thread2.run(Derby4279.java:81)\u003cbr\\/\u003e\\n\\tat java.lang.Thread.run(Thread.java:619)\u003cbr\\/\u003e\\nCaused by: java.sql.SQLException: A lock could not be obtained within the time requested\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source)\u003cbr\\/\u003e\\n\\t... 11 more\u003cbr\\/\u003e\\nCaused by: ERROR 40XL1: A lock could not be obtained within the time requested\u003cbr\\/\u003e\\n\\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.locks.AbstractPool.lockObject(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.xact.RowLocking2.lockContainer(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.data.BaseContainerHandle.useContainer(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.raw.xact.Xact.openContainer(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.heap.Heap.open(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.ResultColumnList.generateHolderMethod(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.FromBaseTable.getScanArguments(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.FromBaseTable.generateResultSet(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.FromBaseTable.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.IndexToBaseRowNode.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.CursorNode.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.compile.StatementNode.generate(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.rePrepare(Unknown Source)\u003cbr\\/\u003e\\n\\t... 5 more\u003cbr\\/\u003e\\nQuery 2 finished.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stuckman\\\" id=\\\"commentauthor_12722088_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stuckman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stuckman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeff Stuckman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12722088_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/09 23:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-19T23:32:48+0000\'\u003e19\\/Jun\\/09 23:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Output from test case: \\n\\n Invalidating the prepared statements... \\nTable locked. \\nExecuting query 1. Query should block because other thread has lock. \\nExecuting query 2. Query should not block because this thread already has the necessary locks. \\njava.sql.SQLTransactionRollbackException: A lock could not be obtained within the time requested \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.Util.generateCsSQLException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeStatement(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.EmbedPreparedStatement.executeQuery(Unknown Source) \\n\\tat Derby4279$Thread2.run(Derby4279.java:81) \\n\\tat java.lang.Thread.run(Thread.java:619) \\nCaused by: java.sql.SQLException: A lock could not be obtained within the time requested \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(Unknown Source) \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(Unknown Source) \\n\\t... 11 more \\nCaused by: ERROR 40XL1: A lock could not be obtained within the time requested \\n\\tat org.apache.derby.iapi.error.StandardException.newException(Unknown Source) \\n\\tat org.apache.derby.impl.services.locks.ConcurrentLockSet.lockObject(Unknown Source) \\n\\tat org.apache.derby.impl.services.locks.AbstractPool.lockObject(Unknown Source) \\n\\tat org.apache.derby.impl.services.locks.ConcurrentPool.lockObject(Unknown Source) \\n\\tat org.apache.derby.impl.store.raw.xact.RowLocking2.lockContainer(Unknown Source) \\n\\tat org.apache.derby.impl.store.raw.data.BaseContainerHandle.useContainer(Unknown Source) \\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source) \\n\\tat org.apache.derby.impl.store.raw.data.BaseDataFileFactory.openContainer(Unknown Source) \\n\\tat org.apache.derby.impl.store.raw.xact.Xact.openContainer(Unknown Source) \\n\\tat org.apache.derby.impl.store.access.conglomerate.OpenConglomerate.init(Unknown Source) \\n\\tat org.apache.derby.impl.store.access.heap.Heap.open(Unknown Source) \\n\\tat org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source) \\n\\tat org.apache.derby.impl.store.access.RAMTransaction.openConglomerate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.ResultColumnList.generateHolderMethod(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.FromBaseTable.getScanArguments(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.FromBaseTable.generateResultSet(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.FromBaseTable.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.IndexToBaseRowNode.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generateMinion(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.ProjectRestrictNode.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.ScrollInsensitiveResultSetNode.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.CursorNode.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.compile.StatementNode.generate(Unknown Source) \\n\\tat org.apache.derby.impl.sql.GenericStatement.prepMinion(Unknown Source) \\n\\tat org.apache.derby.impl.sql.GenericStatement.prepare(Unknown Source) \\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.rePrepare(Unknown Source) \\n\\t... 5 more \\nQuery 2 finished.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12722089\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12722089&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12722089\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stuckman\\\" id=\\\"commentauthor_12722089_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stuckman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stuckman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeff Stuckman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12722089_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/09 23:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-19T23:35:28+0000\'\u003e19\\/Jun\\/09 23:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTest case\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stuckman\\\" id=\\\"commentauthor_12722089_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stuckman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stuckman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeff Stuckman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12722089_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/09 23:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-19T23:35:28+0000\'\u003e19\\/Jun\\/09 23:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Test case              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12722093\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12722093&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12722093\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stuckman\\\" id=\\\"commentauthor_12722093_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stuckman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stuckman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeff Stuckman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12722093_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/09 23:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-19T23:43:06+0000\'\u003e19\\/Jun\\/09 23:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne workaround is to set derby.language.statementCacheSize=0. However, the impact of setting this property may be unclear to users because it is not documented. (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4280\\\" title=\\\"Property not documented - derby.language.statementCacheSize\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4280\\\"\u003e\u003cdel\u003eDERBY-4280\u003c\\/del\u003e\u003c\\/a\u003e)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"stuckman\\\" id=\\\"commentauthor_12722093_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=stuckman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"stuckman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jeff Stuckman\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12722093_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/09 23:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-06-19T23:43:06+0000\'\u003e19\\/Jun\\/09 23:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One workaround is to set derby.language.statementCacheSize=0. However, the impact of setting this property may be unclear to users because it is not documented. (  DERBY-4280  )              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12727011\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12727011&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12727011\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12727011_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12727011_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 15:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T15:42:25+0000\'\u003e03\\/Jul\\/09 15:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTriaged for 10.5.2, checking \\\"repro attached\\\", setting \\\"normal\\\" urgency.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12727011_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12727011_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 15:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T15:42:25+0000\'\u003e03\\/Jul\\/09 15:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Triaged for 10.5.2, checking \\\"repro attached\\\", setting \\\"normal\\\" urgency.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12727015\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12727015&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12727015\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12727015_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12727015_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 15:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T15:54:19+0000\'\u003e03\\/Jul\\/09 15:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSeen back to 10.0.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dagw\\\" id=\\\"commentauthor_12727015_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dagw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dagw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dag H. Wanvik\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12727015_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jul\\/09 15:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2009-07-03T15:54:19+0000\'\u003e03\\/Jul\\/09 15:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Seen back to 10.0.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877328\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877328&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877328\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877328_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877328_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 05:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T05:43:42+0000\'\u003e10\\/Jun\\/10 05:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis defect is a major issue for my company and product.  I am submitting a patch to address this defect.  The attached patch is against the 10.6 branch, but I would expect it to equally apply to the trunk.  The description in the initial report by Jeff Stuckman is accurate, please read it before studying the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eLet me explain the patch, and the rationale behind it.  Some familiarity with the code in question is assumed.  Four files where touched:\u003c\\/p\u003e\\n\\n\u003cp\u003eorg.apache.derby.iapi.sql.PreparedStatement\u003cbr\\/\u003e\\norg.apache.derby.impl.sql.GenericStatement\u003cbr\\/\u003e\\norg.apache.derby.impl.sql.GenericActivationHolder\u003cbr\\/\u003e\\norg.apache.derby.impl.sql.GenericPreparedStatement\u003c\\/p\u003e\\n\\n\u003cp\u003eBasically the previous code did this:\u003c\\/p\u003e\\n\\n\u003cp\u003e   Block Thread B if it tries to recompile a statement that is being recompiled by Thread A\u003c\\/p\u003e\\n\\n\u003cp\u003eThis would result in deadlock if Thread A needs the exclusive (DB) lock held by thread B.\u003c\\/p\u003e\\n\\n\u003cp\u003eBasically the new code does this:\u003c\\/p\u003e\\n\\n\u003cp\u003e   When Thread B tries to recompile a statement AND that statement is currently being recompiled (by another thread), don\'t block, simply create a new GenericPreparedStatement and compile that instead.  In essence, this is treated like a \\\"cache miss\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eAt the GenericStatement level, there is no way to know what Storage level locks are being held.  Therefore, blocking Thread B (via a Java lock) while awaiting notification by a thread (Thread A) that might itself be waiting on a Storage level lock held by Thread B is bound to lead to deadlocks in this, and possibly other, scenarios.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch foregoes some \u003cspan class=\\\"error\\\"\u003e&#91;extremely&#93;\u003c\\/span\u003e minor cache efficiencies by treating concurrent recompilation of a statement as a cache miss.  Recompilation by a single thread is not treated as a cache miss, and the code flow is unchanged in that case.  Unless a statement undergoes constant concurrent recompilation (defeating the statement cache anyway), I would expect this change to have an almost immeasurable performance impact on applications.  Certainly compared to the workaround of disabling the statement cache, well, there is no comparison.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen studying this patch, I recommend reading in this order for clarity:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. PreparedStatement\u003cbr\\/\u003e\\n2. GenericPreparedStatement\u003cbr\\/\u003e\\n3. GenericActivationHolder\u003cbr\\/\u003e\\n4. GenericStatement\u003c\\/p\u003e\\n\\n\u003cp\u003ePreparedStatement:\u003cbr\\/\u003e\\n   The interface was changed so that rePrepare() might return a new statement.\u003c\\/p\u003e\\n\\n\u003cp\u003eGenericPreparedStatement:\u003cbr\\/\u003e\\n   In the \\\"rePrepare()\\\" implementation, account for the fact that a new statement may be returned.\u003c\\/p\u003e\\n\\n\u003cp\u003eGenericActivationHolder:\u003cbr\\/\u003e\\n   In execute(), when a PreparedStatement is recognized as invalid and therefore rePrepare()\'d, accept the re-prepared statement and use it.  99% of the time, the returned statement will be the same statement as the original.  But in the case of a concurrent re-preparation, a new statement will be returned.\u003c\\/p\u003e\\n\\n\u003cp\u003eGenericStatement:\u003cbr\\/\u003e\\n   in prepMinion(), when we realize were in a \\\"concurrent re-compile\\\" situation, rather than block waiting for the \\\"other thread\\\" to complete recompiling the cached statement, simply create a new GenericPreparedStatement() and compile it instead.  This is where the rubber meets the road, and the deadlock is avoided.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran the \'derbyall\' test suite, and while I did receive two failures, they seem unrelated to this fix and have more to do with my environment.  I would appreciate someone reviewing the patch, applying it to their system (with a known passing test suite), and running it through a regression test pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877328_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877328_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 05:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T05:43:42+0000\'\u003e10\\/Jun\\/10 05:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This defect is a major issue for my company and product.  I am submitting a patch to address this defect.  The attached patch is against the 10.6 branch, but I would expect it to equally apply to the trunk.  The description in the initial report by Jeff Stuckman is accurate, please read it before studying the patch. \\n\\n Let me explain the patch, and the rationale behind it.  Some familiarity with the code in question is assumed.  Four files where touched: \\n\\n org.apache.derby.iapi.sql.PreparedStatement \\norg.apache.derby.impl.sql.GenericStatement \\norg.apache.derby.impl.sql.GenericActivationHolder \\norg.apache.derby.impl.sql.GenericPreparedStatement \\n\\n Basically the previous code did this: \\n\\n    Block Thread B if it tries to recompile a statement that is being recompiled by Thread A \\n\\n This would result in deadlock if Thread A needs the exclusive (DB) lock held by thread B. \\n\\n Basically the new code does this: \\n\\n    When Thread B tries to recompile a statement AND that statement is currently being recompiled (by another thread), don\'t block, simply create a new GenericPreparedStatement and compile that instead.  In essence, this is treated like a \\\"cache miss\\\". \\n\\n At the GenericStatement level, there is no way to know what Storage level locks are being held.  Therefore, blocking Thread B (via a Java lock) while awaiting notification by a thread (Thread A) that might itself be waiting on a Storage level lock held by Thread B is bound to lead to deadlocks in this, and possibly other, scenarios. \\n\\n This patch foregoes some  &#91;extremely&#93;  minor cache efficiencies by treating concurrent recompilation of a statement as a cache miss.  Recompilation by a single thread is not treated as a cache miss, and the code flow is unchanged in that case.  Unless a statement undergoes constant concurrent recompilation (defeating the statement cache anyway), I would expect this change to have an almost immeasurable performance impact on applications.  Certainly compared to the workaround of disabling the statement cache, well, there is no comparison. \\n\\n When studying this patch, I recommend reading in this order for clarity: \\n\\n 1. PreparedStatement \\n2. GenericPreparedStatement \\n3. GenericActivationHolder \\n4. GenericStatement \\n\\n PreparedStatement: \\n   The interface was changed so that rePrepare() might return a new statement. \\n\\n GenericPreparedStatement: \\n   In the \\\"rePrepare()\\\" implementation, account for the fact that a new statement may be returned. \\n\\n GenericActivationHolder: \\n   In execute(), when a PreparedStatement is recognized as invalid and therefore rePrepare()\'d, accept the re-prepared statement and use it.  99% of the time, the returned statement will be the same statement as the original.  But in the case of a concurrent re-preparation, a new statement will be returned. \\n\\n GenericStatement: \\n   in prepMinion(), when we realize were in a \\\"concurrent re-compile\\\" situation, rather than block waiting for the \\\"other thread\\\" to complete recompiling the cached statement, simply create a new GenericPreparedStatement() and compile it instead.  This is where the rubber meets the road, and the deadlock is avoided. \\n\\n I ran the \'derbyall\' test suite, and while I did receive two failures, they seem unrelated to this fix and have more to do with my environment.  I would appreciate someone reviewing the patch, applying it to their system (with a known passing test suite), and running it through a regression test pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877329\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877329&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877329\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877329_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877329_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 05:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T05:45:21+0000\'\u003e10\\/Jun\\/10 05:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eProposed patch for 4279.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877329_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877329_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 05:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T05:45:21+0000\'\u003e10\\/Jun\\/10 05:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Proposed patch for 4279.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877365\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877365&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877365\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877365_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877365_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 08:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T08:06:12+0000\'\u003e10\\/Jun\\/10 08:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust a further comment.  We see this in a client\\/server setup.  The original bug mentions the Embedded driver, but because this code in common between the network server and the embedded driver, the issue is the same.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877365_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877365_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 08:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T08:06:12+0000\'\u003e10\\/Jun\\/10 08:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just a further comment.  We see this in a client\\/server setup.  The original bug mentions the Embedded driver, but because this code in common between the network server and the embedded driver, the issue is the same.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877407\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877407&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877407\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12877407_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877407_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 12:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T12:43:09+0000\'\u003e10\\/Jun\\/10 12:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett,\u003c\\/p\u003e\\n\\n\u003cp\u003eI had a quick look at your patch, applied it and ran it through suites.All. I see the following error(s):\u003c\\/p\u003e\\n\\n\u003cp\u003etestStressMulti(org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest) FAILURE:\u003cbr\\/\u003e\\njunit.framework.AssertionFailedError: Caused by: \u003cbr\\/\u003e\\njava.sql.SQLException: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1321)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:152)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.select(StressMultiTest.java:555)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:429)\u003cbr\\/\u003e\\n\\tat java.lang.Thread.run(Thread.java:619)\u003cbr\\/\u003e\\nCaused by: java.sql.SQLException: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\u003cbr\\/\u003e\\n\\t... 12 more\u003cbr\\/\u003e\\nCaused by: java.lang.NullPointerException\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:298)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:437)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:320)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1232)\u003cbr\\/\u003e\\n\\t... 5 more\u003c\\/p\u003e\\n\\n\u003cp\u003e\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.handleException(StressMultiTest.java:351)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.access$200(StressMultiTest.java:70)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:445)\u003cbr\\/\u003e\\n\\tat java.lang.Thread.run(Thread.java:619)\u003c\\/p\u003e\\n\\n\u003cp\u003etestStressMulti(org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest) FAILURE:\u003cbr\\/\u003e\\njunit.framework.AssertionFailedError: Caused by: \u003cbr\\/\u003e\\njava.sql.SQLException: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1321)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:152)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.select(StressMultiTest.java:555)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:429)\u003cbr\\/\u003e\\n\\tat java.lang.Thread.run(Thread.java:619)\u003cbr\\/\u003e\\nCaused by: java.sql.SQLException: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\u003cbr\\/\u003e\\n\\t... 12 more\u003cbr\\/\u003e\\nCaused by: java.lang.NullPointerException\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:298)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:437)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:320)\u003cbr\\/\u003e\\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1232)\u003cbr\\/\u003e\\n\\t... 5 more\u003c\\/p\u003e\\n\\n\u003cp\u003e\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.handleException(StressMultiTest.java:351)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.access$200(StressMultiTest.java:70)\u003cbr\\/\u003e\\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:445)\u003cbr\\/\u003e\\n\\tat java.lang.Thread.run(Thread.java:619)\u003c\\/p\u003e\\n\\n\u003cp\u003eI haven\'t had the time to investigate this further, others should definitely do so if they think they can contribute \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nA first step would be to verify this error (running the multi.StressMultiTest).\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12877407_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877407_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/10 12:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-10T12:43:09+0000\'\u003e10\\/Jun\\/10 12:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, \\n\\n I had a quick look at your patch, applied it and ran it through suites.All. I see the following error(s): \\n\\n testStressMulti(org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest) FAILURE: \\njunit.framework.AssertionFailedError: Caused by:  \\njava.sql.SQLException: Java exception: \': java.lang.NullPointerException\'. \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) \\n\\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) \\n\\tat org.apache.derby.impl.jdbc.Util.javaException(Util.java:299) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) \\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269) \\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1321) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:152) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.select(StressMultiTest.java:555) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:429) \\n\\tat java.lang.Thread.run(Thread.java:619) \\nCaused by: java.sql.SQLException: Java exception: \': java.lang.NullPointerException\'. \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) \\n\\t... 12 more \\nCaused by: java.lang.NullPointerException \\n\\tat org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:298) \\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:437) \\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:320) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1232) \\n\\t... 5 more \\n\\n \\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.handleException(StressMultiTest.java:351) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.access$200(StressMultiTest.java:70) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:445) \\n\\tat java.lang.Thread.run(Thread.java:619) \\n\\n testStressMulti(org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest) FAILURE: \\njunit.framework.AssertionFailedError: Caused by:  \\njava.sql.SQLException: Java exception: \': java.lang.NullPointerException\'. \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) \\n\\tat org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) \\n\\tat org.apache.derby.impl.jdbc.Util.javaException(Util.java:299) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) \\n\\tat org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) \\n\\tat org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269) \\n\\tat org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1321) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:625) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:152) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.select(StressMultiTest.java:555) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:429) \\n\\tat java.lang.Thread.run(Thread.java:619) \\nCaused by: java.sql.SQLException: Java exception: \': java.lang.NullPointerException\'. \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) \\n\\tat org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) \\n\\t... 12 more \\nCaused by: java.lang.NullPointerException \\n\\tat org.apache.derby.impl.sql.GenericActivationHolder.execute(GenericActivationHolder.java:298) \\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.executeStmt(GenericPreparedStatement.java:437) \\n\\tat org.apache.derby.impl.sql.GenericPreparedStatement.execute(GenericPreparedStatement.java:320) \\n\\tat org.apache.derby.impl.jdbc.EmbedStatement.executeStatement(EmbedStatement.java:1232) \\n\\t... 5 more \\n\\n \\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.handleException(StressMultiTest.java:351) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.access$200(StressMultiTest.java:70) \\n\\tat org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:445) \\n\\tat java.lang.Thread.run(Thread.java:619) \\n\\n I haven\'t had the time to investigate this further, others should definitely do so if they think they can contribute   \\nA first step would be to verify this error (running the multi.StressMultiTest). \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877682\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877682&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877682\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877682_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877682_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 01:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T01:28:02+0000\'\u003e11\\/Jun\\/10 01:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the feedback.  Typo in my patch.  In GenericActivationHolder.java I had:\u003c\\/p\u003e\\n\\n\u003cp\u003enewPS = (ExecPreparedStatement) ps.rePrepare...\u003cbr\\/\u003e\\nnewGC = ps.getActivationClass();\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I meant:\u003c\\/p\u003e\\n\\n\u003cp\u003enewPS = (ExecPreparedStatement) ps.rePrepare...\u003cbr\\/\u003e\\nnewGC = newPS.getActivationClass();\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve run the multi stress suite, and it now passes without error.  I have updated the patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877682_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877682_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 01:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T01:28:02+0000\'\u003e11\\/Jun\\/10 01:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the feedback.  Typo in my patch.  In GenericActivationHolder.java I had: \\n\\n newPS = (ExecPreparedStatement) ps.rePrepare... \\nnewGC = ps.getActivationClass(); \\n\\n When I meant: \\n\\n newPS = (ExecPreparedStatement) ps.rePrepare... \\nnewGC = newPS.getActivationClass(); \\n\\n I\'ve run the multi stress suite, and it now passes without error.  I have updated the patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877683\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877683&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877683\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877683_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877683_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 01:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T01:29:33+0000\'\u003e11\\/Jun\\/10 01:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch file (10.6 base)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877683_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877683_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 01:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T01:29:33+0000\'\u003e11\\/Jun\\/10 01:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch file (10.6 base)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877761\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877761&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877761\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12877761_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877761_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 09:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T09:51:25+0000\'\u003e11\\/Jun\\/10 09:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for contributing the patch. I think creating a new statement instead of waiting sounds like a reasonable approach to solve this bug.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have a couple of questions about the patch:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) The synchronized block in GenericActivationHolder.execute() is expanded. What\'s the reasoning behind this change?\u003c\\/p\u003e\\n\\n\u003cp\u003e2) In GenericStatement, I noticed that the old code that generates a new statement if the session schema is references, sets foundInCache to false to prevent the call to removeStatement() in catch blocks further down. Should we do the same in the new code that checks the value of compilingStatement? I\'m not sure if calling removeStatement() on a statement that\'s not in the cache does any harm, but I thought I\'d mention it in any case.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) Since the patch removes the call to wait() on the prepared statement (the only call to wait() as far as I can tell), do you think it would be safe to also remove the calls to notifyAll() in GenericStatement and GenericPreparedStatement?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12877761_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877761_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 09:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T09:51:25+0000\'\u003e11\\/Jun\\/10 09:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, \\n\\n Thanks for contributing the patch. I think creating a new statement instead of waiting sounds like a reasonable approach to solve this bug. \\n\\n I have a couple of questions about the patch: \\n\\n 1) The synchronized block in GenericActivationHolder.execute() is expanded. What\'s the reasoning behind this change? \\n\\n 2) In GenericStatement, I noticed that the old code that generates a new statement if the session schema is references, sets foundInCache to false to prevent the call to removeStatement() in catch blocks further down. Should we do the same in the new code that checks the value of compilingStatement? I\'m not sure if calling removeStatement() on a statement that\'s not in the cache does any harm, but I thought I\'d mention it in any case. \\n\\n 3) Since the patch removes the call to wait() on the prepared statement (the only call to wait() as far as I can tell), do you think it would be safe to also remove the calls to notifyAll() in GenericStatement and GenericPreparedStatement?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877821\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877821&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877821\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877821_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877821_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T14:35:23+0000\'\u003e11\\/Jun\\/10 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Knut, thanks for taking a look.\u003c\\/p\u003e\\n\\n\u003cp\u003e1) The synchronized block in GenericActivationHolder.execute() was actually completely commented out in the original &#8211; but the comment regarding the synchronized block remained.  I\'m actually unsure if there is indeed multi-threaded access to GenericActivationHolder &#8211; but I believe there can be.  Because that method replaces several member variables, it seems unsafe to do so outside of the context of a synchronized block.  So, basically I just restored the synchronized block.  If it can be shown that there is no multi-threaded access &#8211; for example because of a lock higher up the call chain, we can certainly remove it.  But being unfamiliar with the Derby codebase in general, I decided to err on the side of caution.\u003c\\/p\u003e\\n\\n\u003cp\u003e2) My thinking on removing the statement from the cache was that the new statement is an equal candidate to be cached, and because it was just recompiled the one that does exist in the cache is stale in a sense.\u003c\\/p\u003e\\n\\n\u003cp\u003e3) I thought that too.  I think it would indeed be safe to remove to calls to notifyAll(), at least in the case of GenericStatement.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12877821_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877821_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T14:35:23+0000\'\u003e11\\/Jun\\/10 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Knut, thanks for taking a look. \\n\\n 1) The synchronized block in GenericActivationHolder.execute() was actually completely commented out in the original &#8211; but the comment regarding the synchronized block remained.  I\'m actually unsure if there is indeed multi-threaded access to GenericActivationHolder &#8211; but I believe there can be.  Because that method replaces several member variables, it seems unsafe to do so outside of the context of a synchronized block.  So, basically I just restored the synchronized block.  If it can be shown that there is no multi-threaded access &#8211; for example because of a lock higher up the call chain, we can certainly remove it.  But being unfamiliar with the Derby codebase in general, I decided to err on the side of caution. \\n\\n 2) My thinking on removing the statement from the cache was that the new statement is an equal candidate to be cached, and because it was just recompiled the one that does exist in the cache is stale in a sense. \\n\\n 3) I thought that too.  I think it would indeed be safe to remove to calls to notifyAll(), at least in the case of GenericStatement.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12877841\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12877841&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12877841\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12877841_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877841_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 15:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T15:59:17+0000\'\u003e11\\/Jun\\/10 15:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e+1 to the strategy of the patch. I think the approach of allowing each caller to prepare\u003cbr\\/\u003e\\nthe statement independently is valid and useful. In this age of multi-core computing,\u003cbr\\/\u003e\\nI think doing possibly extra work like this in search of higher concurrency (and fewer\u003cbr\\/\u003e\\ndeadlocks) is a good technique.\u003c\\/p\u003e\\n\\n\u003cp\u003eI, too, was worried about the patch\'s modifications to the synchronized() blocks, so\u003cbr\\/\u003e\\nI\'d like to see that discussion resolved prior to commit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12877841_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12877841_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/10 15:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-11T15:59:17+0000\'\u003e11\\/Jun\\/10 15:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    +1 to the strategy of the patch. I think the approach of allowing each caller to prepare \\nthe statement independently is valid and useful. In this age of multi-core computing, \\nI think doing possibly extra work like this in search of higher concurrency (and fewer \\ndeadlocks) is a good technique. \\n\\n I, too, was worried about the patch\'s modifications to the synchronized() blocks, so \\nI\'d like to see that discussion resolved prior to commit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12878516\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12878516&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12878516\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12878516_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878516_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/10 09:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-14T09:41:21+0000\'\u003e14\\/Jun\\/10 09:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThere\'s a smaller synchronized block within the block where the synchronization is commented out (both synchronized on ps). The inner synchronization was added to address \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3260\\\" title=\\\"NullPointerException caused by race condition in GenericActivationHolder\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3260\\\"\u003e\u003cdel\u003eDERBY-3260\u003c\\/del\u003e\u003c\\/a\u003e. The question was raised at that time too, why the synchronization had been commented out in the first place. Since we didn\'t know why, we went for the minimum needed to fix that bug. Unless there\'s some change in the patch that makes it necessary to synchronize on the entire block, I\'d be more comfortable with leaving the synchronization as it is for now. It\'s not that I\'m 100% convinced the current approach is correct, but if we find problems there, we could address them in a separate issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs to multi-threaded access to GenericActivationHolders, I don\'t think that will happen. I believe GenericActivationHolder instances are private to a transaction, and concurrent access will be prevented by synchronization at a higher level. The instance stored in the ps field can however be shared by multiple GenericActivationHolders, and the synchronization is there to give a consistent view of that object\'s state.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother thing that makes me think we should be careful with adding synchronization here, is that it adds to the problem reported in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3024\\\" title=\\\"Validation of shared plans hurts scalability\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3024\\\"\u003e\u003cdel\u003eDERBY-3024\u003c\\/del\u003e\u003c\\/a\u003e. I did a few runs on a 32-core machine with the test client attached there, and saw a 10-30% performance degradation for various multi-threaded configurations when the patch was applied.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12878516_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878516_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/10 09:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-14T09:41:21+0000\'\u003e14\\/Jun\\/10 09:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    There\'s a smaller synchronized block within the block where the synchronization is commented out (both synchronized on ps). The inner synchronization was added to address   DERBY-3260  . The question was raised at that time too, why the synchronization had been commented out in the first place. Since we didn\'t know why, we went for the minimum needed to fix that bug. Unless there\'s some change in the patch that makes it necessary to synchronize on the entire block, I\'d be more comfortable with leaving the synchronization as it is for now. It\'s not that I\'m 100% convinced the current approach is correct, but if we find problems there, we could address them in a separate issue. \\n\\n As to multi-threaded access to GenericActivationHolders, I don\'t think that will happen. I believe GenericActivationHolder instances are private to a transaction, and concurrent access will be prevented by synchronization at a higher level. The instance stored in the ps field can however be shared by multiple GenericActivationHolders, and the synchronization is there to give a consistent view of that object\'s state. \\n\\n Another thing that makes me think we should be careful with adding synchronization here, is that it adds to the problem reported in   DERBY-3024  . I did a few runs on a 32-core machine with the test client attached there, and saw a 10-30% performance degradation for various multi-threaded configurations when the patch was applied.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12878726\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12878726&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12878726\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12878726_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878726_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/10 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-14T20:14:24+0000\'\u003e14\\/Jun\\/10 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe synchronization was commented out before the code was open sourced.  The change was part of a fix for a java monitor deadlock while running a stress test.  Unfortunately the stress test is no longer available and will not run against the derby codeline.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI will attach the original stack trace, but the code has changed quite a bit so the routine names, locations, will have changed.  About the only thing relevant will be the monitor deadlock info.\u003c\\/p\u003e\\n\\n\u003cp\u003eBased on this, I do not think we should just go ahead and put the synchronization back into GenericActivationHolder.execute(). \u003c\\/p\u003e\\n\\n\u003cp\u003eDoes the new fix add any additional need for synchonization?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12878726_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878726_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/10 20:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-14T20:14:24+0000\'\u003e14\\/Jun\\/10 20:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The synchronization was commented out before the code was open sourced.  The change was part of a fix for a java monitor deadlock while running a stress test.  Unfortunately the stress test is no longer available and will not run against the derby codeline.   \\n\\n I will attach the original stack trace, but the code has changed quite a bit so the routine names, locations, will have changed.  About the only thing relevant will be the monitor deadlock info. \\n\\n Based on this, I do not think we should just go ahead and put the synchronization back into GenericActivationHolder.execute().  \\n\\n Does the new fix add any additional need for synchonization?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12878730\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12878730&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12878730\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12878730_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878730_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/10 20:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-14T20:22:31+0000\'\u003e14\\/Jun\\/10 20:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching the stack trace for the monitor deadlock from a stress test which was seen with Cloudscape release and as a result, the synchornization code was commented.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_12878730_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878730_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/10 20:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-14T20:22:31+0000\'\u003e14\\/Jun\\/10 20:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching the stack trace for the monitor deadlock from a stress test which was seen with Cloudscape release and as a result, the synchornization code was commented.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12878829\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12878829&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12878829\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12878829_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878829_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/10 02:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-15T02:22:24+0000\'\u003e15\\/Jun\\/10 02:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached is a new patch with narrowed synchronization in GenericActivationHolder.  Still, the synchronization is not the same as previously because I think that synchronization was wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe previous code had this logic OUTSIDE of synchronized blocks:\u003c\\/p\u003e\\n\\n\u003cp\u003e284     newGC = gc;\u003cbr\\/\u003e\\n296     BaseActivation newAC = (BaseActivation) newGC.newInstance(lcc);\u003cbr\\/\u003e\\n298     DataTypeDescriptor[]  newParamTypes = ps.getParameterTypes();\u003c\\/p\u003e\\n\\n\u003cp\u003ethen later:\u003cbr\\/\u003e\\n333     ac = newAC;\u003cbr\\/\u003e\\n334     gc = newGC;\u003cbr\\/\u003e\\n335     paramTypes = newParamTypes;\u003cbr\\/\u003e\\n...\u003cbr\\/\u003e\\n352     return ac.execute();  &lt;-- Particularly dangerous\u003c\\/p\u003e\\n\\n\u003cp\u003eThese unprotected accesses (both read and write) to member variables shared by multiple threads is inherently dangerous.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe new patch for GenericActivationHolder takes the approach of copying the member variables into local variables within a synchronized block, and then using those locals throughout.  At the end of the code path where a statement is re-prepared (and a new generated class, activation class, and parameter types created), the member variables are then updated within a synchronized block.\u003c\\/p\u003e\\n\\n\u003cp\u003eI believe this approach should eliminate all synchronization issues within the execute() method while minimizing the synchronization windows.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12878829_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878829_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/10 02:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-15T02:22:24+0000\'\u003e15\\/Jun\\/10 02:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached is a new patch with narrowed synchronization in GenericActivationHolder.  Still, the synchronization is not the same as previously because I think that synchronization was wrong. \\n\\n The previous code had this logic OUTSIDE of synchronized blocks: \\n\\n 284     newGC = gc; \\n296     BaseActivation newAC = (BaseActivation) newGC.newInstance(lcc); \\n298     DataTypeDescriptor[]  newParamTypes = ps.getParameterTypes(); \\n\\n then later: \\n333     ac = newAC; \\n334     gc = newGC; \\n335     paramTypes = newParamTypes; \\n... \\n352     return ac.execute();  &lt;-- Particularly dangerous \\n\\n These unprotected accesses (both read and write) to member variables shared by multiple threads is inherently dangerous. \\n\\n The new patch for GenericActivationHolder takes the approach of copying the member variables into local variables within a synchronized block, and then using those locals throughout.  At the end of the code path where a statement is re-prepared (and a new generated class, activation class, and parameter types created), the member variables are then updated within a synchronized block. \\n\\n I believe this approach should eliminate all synchronization issues within the execute() method while minimizing the synchronization windows. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12878831\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12878831&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12878831\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12878831_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878831_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/10 02:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-15T02:39:36+0000\'\u003e15\\/Jun\\/10 02:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch with synchronization changes in GenericActivationHolder.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12878831_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878831_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/10 02:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-15T02:39:36+0000\'\u003e15\\/Jun\\/10 02:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch with synchronization changes in GenericActivationHolder.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12878886\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12878886&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12878886\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12878886_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878886_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/10 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-15T08:31:45+0000\'\u003e15\\/Jun\\/10 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for digging up this information, Mamta.\u003c\\/p\u003e\\n\\n\u003cp\u003eBrett: The way I understand this code, GenericActivationHolder instances are private to a transaction, and therefore only accessed by a single thread (enforced by synchronization in EmbedStatement.execute()). So I think the synchronization on \\\"this\\\" added in the latest patch won\'t have any effect.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12878886_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12878886_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/10 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-15T08:31:45+0000\'\u003e15\\/Jun\\/10 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for digging up this information, Mamta. \\n\\n Brett: The way I understand this code, GenericActivationHolder instances are private to a transaction, and therefore only accessed by a single thread (enforced by synchronization in EmbedStatement.execute()). So I think the synchronization on \\\"this\\\" added in the latest patch won\'t have any effect.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12879202\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12879202&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12879202\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12879202_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879202_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 00:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T00:24:47+0000\'\u003e16\\/Jun\\/10 00:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKnut, thanks for the code review.  I have updated the synchronization to synchronize on the ExecPreparedStatement (ps) object thoughout the execute()  method.  If you have time, please review the new uploaded patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12879202_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879202_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 00:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T00:24:47+0000\'\u003e16\\/Jun\\/10 00:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Knut, thanks for the code review.  I have updated the synchronization to synchronize on the ExecPreparedStatement (ps) object thoughout the execute()  method.  If you have time, please review the new uploaded patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12879203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12879203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12879203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12879203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 00:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T00:25:33+0000\'\u003e16\\/Jun\\/10 00:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch with updated synchronization.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12879203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 00:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T00:25:33+0000\'\u003e16\\/Jun\\/10 00:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch with updated synchronization.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12879293\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12879293&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12879293\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12879293_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879293_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 09:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T09:48:26+0000\'\u003e16\\/Jun\\/10 09:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe new synchronized blocks in execute() still only access fields local to GenericActivationHolder, so I\'m not sure I understand the need to synchronize on the prepared statement there. I think it would be fine to use the second revision of the patch (the one that fixed the NPE) and change it so that it didn\'t uncomment the outer synchronization block.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12879293_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879293_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 09:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T09:48:26+0000\'\u003e16\\/Jun\\/10 09:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The new synchronized blocks in execute() still only access fields local to GenericActivationHolder, so I\'m not sure I understand the need to synchronize on the prepared statement there. I think it would be fine to use the second revision of the patch (the one that fixed the NPE) and change it so that it didn\'t uncomment the outer synchronization block.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12879337\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12879337&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12879337\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12879337_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879337_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 13:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T13:38:51+0000\'\u003e16\\/Jun\\/10 13:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe original still had a synchronized block that synchronized on the prepared statement.  Was it unnecessary?  I\'m not so sure...\u003c\\/p\u003e\\n\\n\u003cp\u003eOne concern is the statement above \\\"GenericActivationHolder instances are private to a transaction\\\".  Private to a transaction, and private to a thread are two different things.  We run in an XA environment, and theoretically (as far as I understand XA), a transaction can span both connections and threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother issue, is that, when running with the above patch I am seeing intermittent failures in our server application.  There are multiple threads doing \\\"DELETE FROM\\\" and \\\"INSERT INTO\\\" the same table, and I am seeing an occasional insert failure stating that the insert would cause a primary key violation.\u003c\\/p\u003e\\n\\n\u003cp\u003eAt this point, I am not sure it is related to the patch or not because our server code has been shifting about as well.  However, a short run using 10.6.1.0 without the patch did not see this particular error.  Because the issue is intermittent, and I unsure whether the cause is the patch or application level code.  Further testing tomorrow should clarify.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote that running the derby test suite did not result in any errors.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12879337_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879337_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 13:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T13:38:51+0000\'\u003e16\\/Jun\\/10 13:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The original still had a synchronized block that synchronized on the prepared statement.  Was it unnecessary?  I\'m not so sure... \\n\\n One concern is the statement above \\\"GenericActivationHolder instances are private to a transaction\\\".  Private to a transaction, and private to a thread are two different things.  We run in an XA environment, and theoretically (as far as I understand XA), a transaction can span both connections and threads. \\n\\n Another issue, is that, when running with the above patch I am seeing intermittent failures in our server application.  There are multiple threads doing \\\"DELETE FROM\\\" and \\\"INSERT INTO\\\" the same table, and I am seeing an occasional insert failure stating that the insert would cause a primary key violation. \\n\\n At this point, I am not sure it is related to the patch or not because our server code has been shifting about as well.  However, a short run using 10.6.1.0 without the patch did not see this particular error.  Because the issue is intermittent, and I unsure whether the cause is the patch or application level code.  Further testing tomorrow should clarify. \\n\\n Note that running the derby test suite did not result in any errors.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12879388\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12879388&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12879388\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12879388_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879388_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T17:11:51+0000\'\u003e16\\/Jun\\/10 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; The original still had a synchronized block that synchronized on the\u003cbr\\/\u003e\\n&gt; prepared statement. Was it unnecessary? I\'m not so sure...\u003c\\/p\u003e\\n\\n\u003cp\u003eThe original synchronization block enclosed code that accessed the\u003cbr\\/\u003e\\nprepared statement, which may be shared between threads. So that\u003cbr\\/\u003e\\nsynchronization should not be removed, I was only talking about the\u003cbr\\/\u003e\\nsynchronization blocks that were added by the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; One concern is the statement above \\\"GenericActivationHolder instances\u003cbr\\/\u003e\\n&gt; are private to a transaction\\\". Private to a transaction, and private\u003cbr\\/\u003e\\n&gt; to a thread are two different things. We run in an XA environment, and\u003cbr\\/\u003e\\n&gt; theoretically (as far as I understand XA), a transaction can span both\u003cbr\\/\u003e\\n&gt; connections and threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this case, \\\"private to a transaction\\\" meant \\\"private to a local\u003cbr\\/\u003e\\nDerby transaction\\\", so XA won\'t come into the picture. Still, it\'s\u003cbr\\/\u003e\\ntrue that a single transaction can run in multiple threads. For\u003cbr\\/\u003e\\nexample, I can prepare a statement in one thread, execute the\u003cbr\\/\u003e\\nstatement in another thread, and commit the transaction in a third\u003cbr\\/\u003e\\nthread. However, there\'s synchronization at a higher level that\u003cbr\\/\u003e\\nprevents multiple threads from running in the same transaction\u003cbr\\/\u003e\\nconcurrently. This is ensured at the entry points in EmbedConnection,\u003cbr\\/\u003e\\nEmbedStatement and EmbedResultSet. The engine code therefore safely\u003cbr\\/\u003e\\nassumes that \\\"private to a transaction\\\" implies \\\"not accessed by\u003cbr\\/\u003e\\nmultiple threads concurrently\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Another issue, is that, when running with the above patch I am seeing\u003cbr\\/\u003e\\n&gt; intermittent failures in our server application. There are multiple\u003cbr\\/\u003e\\n&gt; threads doing \\\"DELETE FROM\\\" and \\\"INSERT INTO\\\" the same table, and I am\u003cbr\\/\u003e\\n&gt; seeing an occasional insert failure stating that the insert would\u003cbr\\/\u003e\\n&gt; cause a primary key violation.\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; At this point, I am not sure it is related to the patch or not because\u003cbr\\/\u003e\\n&gt; our server code has been shifting about as well. However, a short run\u003cbr\\/\u003e\\n&gt; using 10.6.1.0 without the patch did not see this particular\u003cbr\\/\u003e\\n&gt; error. Because the issue is intermittent, and I unsure whether the\u003cbr\\/\u003e\\n&gt; cause is the patch or application level code. Further testing tomorrow\u003cbr\\/\u003e\\n&gt; should clarify.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for investigating this further. It would be good to understand\u003cbr\\/\u003e\\nwhy you see this error before we proceed with getting the patch into\u003cbr\\/\u003e\\nthe code tree.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Note that running the derby test suite did not result in any errors.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, the regression test suite doesn\'t have many multi-threaded tests\u003cbr\\/\u003e\\nand isn\'t good at catching such errors, unfortunately...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12879388_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12879388_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jun\\/10 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-16T17:11:51+0000\'\u003e16\\/Jun\\/10 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; The original still had a synchronized block that synchronized on the \\n&gt; prepared statement. Was it unnecessary? I\'m not so sure... \\n\\n The original synchronization block enclosed code that accessed the \\nprepared statement, which may be shared between threads. So that \\nsynchronization should not be removed, I was only talking about the \\nsynchronization blocks that were added by the patch. \\n\\n &gt; One concern is the statement above \\\"GenericActivationHolder instances \\n&gt; are private to a transaction\\\". Private to a transaction, and private \\n&gt; to a thread are two different things. We run in an XA environment, and \\n&gt; theoretically (as far as I understand XA), a transaction can span both \\n&gt; connections and threads. \\n\\n In this case, \\\"private to a transaction\\\" meant \\\"private to a local \\nDerby transaction\\\", so XA won\'t come into the picture. Still, it\'s \\ntrue that a single transaction can run in multiple threads. For \\nexample, I can prepare a statement in one thread, execute the \\nstatement in another thread, and commit the transaction in a third \\nthread. However, there\'s synchronization at a higher level that \\nprevents multiple threads from running in the same transaction \\nconcurrently. This is ensured at the entry points in EmbedConnection, \\nEmbedStatement and EmbedResultSet. The engine code therefore safely \\nassumes that \\\"private to a transaction\\\" implies \\\"not accessed by \\nmultiple threads concurrently\\\". \\n\\n &gt; Another issue, is that, when running with the above patch I am seeing \\n&gt; intermittent failures in our server application. There are multiple \\n&gt; threads doing \\\"DELETE FROM\\\" and \\\"INSERT INTO\\\" the same table, and I am \\n&gt; seeing an occasional insert failure stating that the insert would \\n&gt; cause a primary key violation. \\n&gt; \\n&gt; At this point, I am not sure it is related to the patch or not because \\n&gt; our server code has been shifting about as well. However, a short run \\n&gt; using 10.6.1.0 without the patch did not see this particular \\n&gt; error. Because the issue is intermittent, and I unsure whether the \\n&gt; cause is the patch or application level code. Further testing tomorrow \\n&gt; should clarify. \\n\\n Thanks for investigating this further. It would be good to understand \\nwhy you see this error before we proceed with getting the patch into \\nthe code tree. \\n\\n &gt; Note that running the derby test suite did not result in any errors. \\n\\n Yes, the regression test suite doesn\'t have many multi-threaded tests \\nand isn\'t good at catching such errors, unfortunately...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880062\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12880062&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880062\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12880062_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880062_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/10 03:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-18T03:24:59+0000\'\u003e18\\/Jun\\/10 03:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the overview, it was helpful.  I have reverted the synchronization to it\'s former state.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe issue I was seeing with duplicate primary keys turned out to be a Hibernate bug, not related to this patch.  So, I am comfortable going forward with this patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks all for the review.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12880062_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880062_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/10 03:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-18T03:24:59+0000\'\u003e18\\/Jun\\/10 03:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the overview, it was helpful.  I have reverted the synchronization to it\'s former state. \\n\\n The issue I was seeing with duplicate primary keys turned out to be a Hibernate bug, not related to this patch.  So, I am comfortable going forward with this patch. \\n\\n Thanks all for the review.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880147\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12880147&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880147\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12880147_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880147_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/10 09:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-18T09:57:16+0000\'\u003e18\\/Jun\\/10 09:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Brett! The patch looks good to me. I\'ll run the regression tests and intend to commit it if they pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12880147_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880147_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/10 09:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-18T09:57:16+0000\'\u003e18\\/Jun\\/10 09:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Brett! The patch looks good to me. I\'ll run the regression tests and intend to commit it if they pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12880398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12880398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 01:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T01:22:35+0000\'\u003e19\\/Jun\\/10 01:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e+1. The latest version of the patch looks good to me. Thanks Brett for working on this problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"bryanpendleton\\\" id=\\\"commentauthor_12880398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=bryanpendleton\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"bryanpendleton\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Bryan Pendleton\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/10 01:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-19T01:22:35+0000\'\u003e19\\/Jun\\/10 01:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    +1. The latest version of the patch looks good to me. Thanks Brett for working on this problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880755\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12880755&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880755\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12880755_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880755_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jun\\/10 09:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-21T09:10:50+0000\'\u003e21\\/Jun\\/10 09:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAll the regression tests ran cleanly in my environment. Committed revision 956504.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12880755_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880755_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jun\\/10 09:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-21T09:10:50+0000\'\u003e21\\/Jun\\/10 09:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    All the regression tests ran cleanly in my environment. Committed revision 956504.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12880770\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12880770&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12880770\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12880770_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880770_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jun\\/10 09:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-21T09:50:10+0000\'\u003e21\\/Jun\\/10 09:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePerhaps we should try to convert the test case Jeff provided to JUnit and add it to the regression test suite before we close the issue?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12880770_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12880770_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jun\\/10 09:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-21T09:50:10+0000\'\u003e21\\/Jun\\/10 09:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Perhaps we should try to convert the test case Jeff provided to JUnit and add it to the regression test suite before we close the issue?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881103\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12881103&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881103\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12881103_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881103_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 06:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T06:59:04+0000\'\u003e22\\/Jun\\/10 06:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe tinderbox test failed again with the following error in StressTestMulti:\u003cbr\\/\u003e\\n2010-06-21 16:02:44.542 GMT Thread\u003cspan class=\\\"error\\\"\u003e&#91;DRDAConnThread_1289,5,derby.daemons&#93;\u003c\\/span\u003e (XID = 1929067), (SESSIONID = 61), (DATABASE = wombat), (DRDAID = NF000001.P530-869193450946392963\u003c\\/p\u003e\\n{30}\\n\u003cp\u003e), Failed Statement is: null\u003cbr\\/\u003e\\njava.lang.NullPointerException\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.getMetaData(Unknown Source)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.drda.DRDAConnThread.writeSQLDARD(Unknown Source)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source)\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks suspicious that after the change from returning void to returning a PreparedStatement, the return value is ignored in EmbedPreparedStatement.getMetaData. Is this correct?\u003c\\/p\u003e\\n\\n\u003cp\u003eAs for the error itself, it has already been reported (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3823\\\" title=\\\"NullPointerException in stress.multi test\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3823\\\"\u003e\u003cdel\u003eDERBY-3823\u003c\\/del\u003e\u003c\\/a\u003e).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12881103_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881103_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 06:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T06:59:04+0000\'\u003e22\\/Jun\\/10 06:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The tinderbox test failed again with the following error in StressTestMulti: \\n2010-06-21 16:02:44.542 GMT Thread &#91;DRDAConnThread_1289,5,derby.daemons&#93;  (XID = 1929067), (SESSIONID = 61), (DATABASE = wombat), (DRDAID = NF000001.P530-869193450946392963 \\n{30}\\n ), Failed Statement is: null \\njava.lang.NullPointerException \\n        at org.apache.derby.impl.jdbc.EmbedPreparedStatement.getMetaData(Unknown Source) \\n        at org.apache.derby.impl.drda.DRDAConnThread.writeSQLDARD(Unknown Source) \\n        at org.apache.derby.impl.drda.DRDAConnThread.processCommands(Unknown Source) \\n        at org.apache.derby.impl.drda.DRDAConnThread.run(Unknown Source) \\n\\n It looks suspicious that after the change from returning void to returning a PreparedStatement, the return value is ignored in EmbedPreparedStatement.getMetaData. Is this correct? \\n\\n As for the error itself, it has already been reported (  DERBY-3823  ).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881209\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12881209&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881209\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12881209_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881209_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T14:24:05+0000\'\u003e22\\/Jun\\/10 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI need some input here, because I\'m wading into unknown waters...\u003c\\/p\u003e\\n\\n\u003cp\u003eCertainly, the return value from rePrepare() can be assigned back to preparedStatement on line 1080 ... along the lines of:\u003c\\/p\u003e\\n\\n\u003cp\u003epreparedStatement = preparedStatement.rePrepare(lcc);\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I am concerned about synchronization issues.  While the getMetaData() method itself obtains a lock via:\u003c\\/p\u003e\\n\\n\u003cp\u003esynchronized (getConnectionSynchronization())\u003cbr\\/\u003e\\n{\u003cbr\\/\u003e\\n   ...\u003cbr\\/\u003e\\n}\u003c\\/p\u003e\\n\\n\u003cp\u003eMany other places in EmbedPreparedStatement access the preparedStatement member variable without such synchronization.  It is safe to assume these other accesses are synchronized by some higher-level lock?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12881209_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881209_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T14:24:05+0000\'\u003e22\\/Jun\\/10 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I need some input here, because I\'m wading into unknown waters... \\n\\n Certainly, the return value from rePrepare() can be assigned back to preparedStatement on line 1080 ... along the lines of: \\n\\n preparedStatement = preparedStatement.rePrepare(lcc); \\n\\n But I am concerned about synchronization issues.  While the getMetaData() method itself obtains a lock via: \\n\\n synchronized (getConnectionSynchronization()) \\n{ \\n   ... \\n} \\n\\n Many other places in EmbedPreparedStatement access the preparedStatement member variable without such synchronization.  It is safe to assume these other accesses are synchronized by some higher-level lock?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12881214\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12881214&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12881214\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12881214_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881214_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T14:31:14+0000\'\u003e22\\/Jun\\/10 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlong the same lines, GenericPreparedStatement line 250 (in getActivation()) receives the value of rePrepare() into a local PreparedStatement (post-patch), but only for the purpose of asserting that it didn\'t change.  This is also possibly incorrect ... but I\'m not sure I grok all of the interactions between GenericPreparedStatement, GeneratedClass, GenericActivationHolder, LanguageConnectionContext, and EmbedPreparedStatement.\u003c\\/p\u003e\\n\\n\u003cp\u003eI didn\'t encounter any errors in the stressmulti test, and I\'m running on an 8-core box, so I am not sure how easily I can validate the robustness of this change.  I may require some assistance, and certainly knowledgable input is welcome.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12881214_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12881214_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/10 14:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-22T14:31:14+0000\'\u003e22\\/Jun\\/10 14:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Along the same lines, GenericPreparedStatement line 250 (in getActivation()) receives the value of rePrepare() into a local PreparedStatement (post-patch), but only for the purpose of asserting that it didn\'t change.  This is also possibly incorrect ... but I\'m not sure I grok all of the interactions between GenericPreparedStatement, GeneratedClass, GenericActivationHolder, LanguageConnectionContext, and EmbedPreparedStatement. \\n\\n I didn\'t encounter any errors in the stressmulti test, and I\'m running on an 8-core box, so I am not sure how easily I can validate the robustness of this change.  I may require some assistance, and certainly knowledgable input is welcome.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12882166\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12882166&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12882166\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12882166_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882166_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jun\\/10 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-24T14:34:06+0000\'\u003e24\\/Jun\\/10 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI haven\'t studied the details of this code yet, but the synchronization on getConnectionSynchronization() is probably not enough to ensure safe access to the GenericPreparedStatement. getConnectionSynchronization() is used to ensure that a single connection cannot be executing in two threads at the same time, but one GenericPreparedStatement can be shared between multiple connections.\u003c\\/p\u003e\\n\\n\u003cp\u003eAssuming this is the same issue as \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-3823\\\" title=\\\"NullPointerException in stress.multi test\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-3823\\\"\u003e\u003cdel\u003eDERBY-3823\u003c\\/del\u003e\u003c\\/a\u003e\\/\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-1635\\\" title=\\\"stress.multi fails on 10.1\\/ibm131\\/jcc2.4\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-1635\\\"\u003e\u003cdel\u003eDERBY-1635\u003c\\/del\u003e\u003c\\/a\u003e and it is getActivationClass() that returns null, it looks like getMetaData() must have been called when the statement was being recompiled by another thread, and that thread had already called preparedStatement.setActivationClass(null) in GenericPreparedStatement.prepMinion(). I\'m not sure if more synchronization is what\'s needed to fix this bug, or if the code just needs to handle null returned from getActivationClass(), or perhaps both.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12882166_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882166_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jun\\/10 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-24T14:34:06+0000\'\u003e24\\/Jun\\/10 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I haven\'t studied the details of this code yet, but the synchronization on getConnectionSynchronization() is probably not enough to ensure safe access to the GenericPreparedStatement. getConnectionSynchronization() is used to ensure that a single connection cannot be executing in two threads at the same time, but one GenericPreparedStatement can be shared between multiple connections. \\n\\n Assuming this is the same issue as   DERBY-3823  \\/  DERBY-1635   and it is getActivationClass() that returns null, it looks like getMetaData() must have been called when the statement was being recompiled by another thread, and that thread had already called preparedStatement.setActivationClass(null) in GenericPreparedStatement.prepMinion(). I\'m not sure if more synchronization is what\'s needed to fix this bug, or if the code just needs to handle null returned from getActivationClass(), or perhaps both.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12882853\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12882853&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12882853\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12882853_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882853_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/10 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-26T16:51:53+0000\'\u003e26\\/Jun\\/10 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA couple more suspected fallouts of this fix:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eMamta added a comment to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4167\\\" title=\\\"NullPointerException in StressMultiTest (testStressMulti) with ibm 1.5 on iseries\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4167\\\"\u003e\u003cdel\u003eDERBY-4167\u003c\\/del\u003e\u003c\\/a\u003e about another NPE in StressMultiTest right after the fix was checked in.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eOlav\'s nightly performance regression tests (\u003ca href=\\\"http:\\/\\/home.online.no\\/~olmsan\\/derby\\/perf\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/home.online.no\\/~olmsan\\/derby\\/perf\\/\u003c\\/a\u003e) have not been able to complete after the check-in. It gets stuck in the multi-threaded delete tests. I\'ll investigate and try to isolate the problem.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12882853_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882853_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/10 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-26T16:51:53+0000\'\u003e26\\/Jun\\/10 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A couple more suspected fallouts of this fix: \\n\\n \\n\\t Mamta added a comment to   DERBY-4167   about another NPE in StressMultiTest right after the fix was checked in. \\n \\n\\n\\n \\n\\t Olav\'s nightly performance regression tests ( http:\\/\\/home.online.no\\/~olmsan\\/derby\\/perf\\/ ) have not been able to complete after the check-in. It gets stuck in the multi-threaded delete tests. I\'ll investigate and try to isolate the problem. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12882926\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12882926&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12882926\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12882926_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882926_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/10 08:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-27T08:00:52+0000\'\u003e27\\/Jun\\/10 08:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI recommend backing out this fix until synchronization\\/threading issues have been resolved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_12882926_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882926_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/10 08:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-27T08:00:52+0000\'\u003e27\\/Jun\\/10 08:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I recommend backing out this fix until synchronization\\/threading issues have been resolved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12882984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12882984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12882984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12882984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/10 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-27T19:42:37+0000\'\u003e27\\/Jun\\/10 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI remember when a lot of the original Statement Cache work was being done the original multi stress test was particularly good at showing up issues.  There is a version that I don\'t think gets \u003cbr\\/\u003e\\nrun nightly that is even more of a load - StressMulti50x59.java, it runs 50 users for 59 minutes.\u003cbr\\/\u003e\\nEven then just passing this test once did not really prove anything as the issues often are very\u003cbr\\/\u003e\\nsubtle and timing dependent.  Often we would run this test over and over again as machine resources were available.  This week I will see if we can find a machine to do this but I don\'t think\u003cbr\\/\u003e\\nwe have anything more than a couple of processors.\u003c\\/p\u003e\\n\\n\u003cp\u003eRunning this test on a machine with the most possible processors would be good to verify this\u003cbr\\/\u003e\\nfix.  \u003c\\/p\u003e\\n\\n\u003cp\u003eDoes this fix mean that we never wait for an existing query plan?   Does anyone understand what this means about performance for queries that take extremely long to compile.  Unfortunately I have seen plans take many minutes to compile depending on how complex, and some customers often \\\"pre-load\\\" the plans at application startup, set the cache size such that the plan is expected to be in cache.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_12882984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12882984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/10 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-27T19:42:37+0000\'\u003e27\\/Jun\\/10 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I remember when a lot of the original Statement Cache work was being done the original multi stress test was particularly good at showing up issues.  There is a version that I don\'t think gets  \\nrun nightly that is even more of a load - StressMulti50x59.java, it runs 50 users for 59 minutes. \\nEven then just passing this test once did not really prove anything as the issues often are very \\nsubtle and timing dependent.  Often we would run this test over and over again as machine resources were available.  This week I will see if we can find a machine to do this but I don\'t think \\nwe have anything more than a couple of processors. \\n\\n Running this test on a machine with the most possible processors would be good to verify this \\nfix.   \\n\\n Does this fix mean that we never wait for an existing query plan?   Does anyone understand what this means about performance for queries that take extremely long to compile.  Unfortunately I have seen plans take many minutes to compile depending on how complex, and some customers often \\\"pre-load\\\" the plans at application startup, set the cache size such that the plan is expected to be in cache.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12883064\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12883064&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12883064\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12883064_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12883064_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/10 08:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-28T08:20:11+0000\'\u003e28\\/Jun\\/10 08:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached \'client_stacktrace_activation_closed.txt\', an error that happened a few times when running the test in a loop (\\\"Activation closed, operation execute not permitted\\\").\u003cbr\\/\u003e\\nAttaching it for reference, I\'m not 100% sure it is valid since the test created a derby.log file of 108GB. This caused my disk to fill up and it was deleted when the process died.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12883064_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12883064_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/10 08:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-28T08:20:11+0000\'\u003e28\\/Jun\\/10 08:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached \'client_stacktrace_activation_closed.txt\', an error that happened a few times when running the test in a loop (\\\"Activation closed, operation execute not permitted\\\"). \\nAttaching it for reference, I\'m not 100% sure it is valid since the test created a derby.log file of 108GB. This caused my disk to fill up and it was deleted when the process died.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12883081\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12883081&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12883081\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12883081_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12883081_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/10 09:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-28T09:24:01+0000\'\u003e28\\/Jun\\/10 09:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother error. I was trying to get a stack trace with line numbers for the getMetaData error, but this popped up instead.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;Error\\/failure logged at Sat Jun 26 06:04:57 CEST 2010&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\njunit.framework.AssertionFailedError: Caused by: \u003cbr\\/\u003e\\njava.sql.SQLException: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:614)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:152)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.select(StressMultiTest.java:555)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:429)\u003cbr\\/\u003e\\n        at java.lang.Thread.run(Thread.java:619)\u003cbr\\/\u003e\\nCaused by: java.sql.SQLException: Java exception: \': java.lang.NullPointerException\'.\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70)\u003cbr\\/\u003e\\n        ... 11 more\u003cbr\\/\u003e\\nCaused by: java.lang.NullPointerException\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.GenericActivationHolder.&lt;init&gt;(GenericActivationHolder.java:129)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.sql.GenericPreparedStatement.getActivation(GenericPreparedStatement.java:257)\u003cbr\\/\u003e\\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:609)\u003cbr\\/\u003e\\n        ... 4 more\u003c\\/p\u003e\\n\\n\u003cp\u003e        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.handleException(StressMultiTest.java:351)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.access$200(StressMultiTest.java:70)\u003cbr\\/\u003e\\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:445)\u003cbr\\/\u003e\\n        at java.lang.Thread.run(Thread.java:619)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_12883081_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12883081_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/10 09:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-28T09:24:01+0000\'\u003e28\\/Jun\\/10 09:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another error. I was trying to get a stack trace with line numbers for the getMetaData error, but this popped up instead. \\n\\n  &#91;Error\\/failure logged at Sat Jun 26 06:04:57 CEST 2010&#93;  \\njunit.framework.AssertionFailedError: Caused by:  \\njava.sql.SQLException: Java exception: \': java.lang.NullPointerException\'. \\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:95) \\n        at org.apache.derby.impl.jdbc.Util.newEmbedSQLException(Util.java:142) \\n        at org.apache.derby.impl.jdbc.Util.javaException(Util.java:299) \\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.wrapInSQLException(TransactionResourceImpl.java:403) \\n        at org.apache.derby.impl.jdbc.TransactionResourceImpl.handleException(TransactionResourceImpl.java:346) \\n        at org.apache.derby.impl.jdbc.EmbedConnection.handleException(EmbedConnection.java:2269) \\n        at org.apache.derby.impl.jdbc.ConnectionChild.handleException(ConnectionChild.java:81) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:614) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.executeQuery(EmbedStatement.java:152) \\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.select(StressMultiTest.java:555) \\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:429) \\n        at java.lang.Thread.run(Thread.java:619) \\nCaused by: java.sql.SQLException: Java exception: \': java.lang.NullPointerException\'. \\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory.getSQLException(SQLExceptionFactory.java:45) \\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.wrapArgsForTransportAcrossDRDA(SQLExceptionFactory40.java:119) \\n        at org.apache.derby.impl.jdbc.SQLExceptionFactory40.getSQLException(SQLExceptionFactory40.java:70) \\n        ... 11 more \\nCaused by: java.lang.NullPointerException \\n        at org.apache.derby.impl.sql.GenericActivationHolder.&lt;init&gt;(GenericActivationHolder.java:129) \\n        at org.apache.derby.impl.sql.GenericPreparedStatement.getActivation(GenericPreparedStatement.java:257) \\n        at org.apache.derby.impl.jdbc.EmbedStatement.execute(EmbedStatement.java:609) \\n        ... 4 more \\n\\n         at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.handleException(StressMultiTest.java:351) \\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest.access$200(StressMultiTest.java:70) \\n        at org.apache.derbyTesting.functionTests.tests.multi.StressMultiTest$StressMultiRunnable.run(StressMultiTest.java:445) \\n        at java.lang.Thread.run(Thread.java:619)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12883093\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12883093&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12883093\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12883093_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12883093_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/10 10:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-28T10:06:49+0000\'\u003e28\\/Jun\\/10 10:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve backed out the fix from trunk. Committed revision 958529.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_12883093_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12883093_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/10 10:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-06-28T10:06:49+0000\'\u003e28\\/Jun\\/10 10:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve backed out the fix from trunk. Committed revision 958529.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12896623\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=12896623&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12896623\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"myrna\\\" id=\\\"commentauthor_12896623_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=myrna\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"myrna\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Myrna van Lunteren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12896623_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/10 17:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-08-09T17:08:36+0000\'\u003e09\\/Aug\\/10 17:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003elinking, because when further work is done on this, re-occurrence of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4721\\\" title=\\\"NullPointerException on StressMultiTest in language layer\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4721\\\"\u003e\u003cdel\u003eDERBY-4721\u003c\\/del\u003e\u003c\\/a\u003e needs to be prevented.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"myrna\\\" id=\\\"commentauthor_12896623_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=myrna\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"myrna\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Myrna van Lunteren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12896623_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/10 17:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-08-09T17:08:36+0000\'\u003e09\\/Aug\\/10 17:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    linking, because when further work is done on this, re-occurrence of   DERBY-4721   needs to be prevented.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13095694\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13095694&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13095694\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13095694_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13095694_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Sep\\/11 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-02T00:44:03+0000\'\u003e02\\/Sep\\/11 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am changing this bug back to unassigned.  I have been unable to work on this issue, and leaving it as assigned to me potentially prevents another developer from picking it up.  This is still a major bug, and we still see it in our production server sporadically.\u003c\\/p\u003e\\n\\n\u003cp\u003eI hope someone else can pick it up and run with it.  I could suggest looking at the patch here only to gain some understand of the pieces involved &#8211; I think the general approach of the patch may be inherently incorrect.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13095694_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13095694_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Sep\\/11 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-02T00:44:03+0000\'\u003e02\\/Sep\\/11 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am changing this bug back to unassigned.  I have been unable to work on this issue, and leaving it as assigned to me potentially prevents another developer from picking it up.  This is still a major bug, and we still see it in our production server sporadically. \\n\\n I hope someone else can pick it up and run with it.  I could suggest looking at the patch here only to gain some understand of the pieces involved &#8211; I think the general approach of the patch may be inherently incorrect.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13108421\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13108421&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13108421\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13108421_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13108421_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/11 07:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-20T07:49:28+0000\'\u003e20\\/Sep\\/11 07:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTicked \\\"Seen in production\\\". See \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-5367\\\" title=\\\"Stale data retrieved when using new collation=TERRITORY_BASED:PRIMARY feature\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-5367\\\"\u003e\u003cdel\u003eDERBY-5367\u003c\\/del\u003e\u003c\\/a\u003e (comment of 20\\/Sep\\/11 01:22) for an example of a workaround to avoid this bug. To me, that workaround seems like a significant burden for people implementing applications on top of Derby.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13108421_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13108421_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Sep\\/11 07:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-09-20T07:49:28+0000\'\u003e20\\/Sep\\/11 07:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ticked \\\"Seen in production\\\". See   DERBY-5367   (comment of 20\\/Sep\\/11 01:22) for an example of a workaround to avoid this bug. To me, that workaround seems like a significant burden for people implementing applications on top of Derby.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13146734\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13146734&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13146734\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13146734_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13146734_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/11 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-11-09T02:28:40+0000\'\u003e09\\/Nov\\/11 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFunny you mention 5367 and the workaround there.  It was me who opened 5367, and mentioned my workaround.  I guess I should amend my comment there, because just today I discovered that my \\\"workaround\\\" does not in fact work.  It appeared to work, and seems somewhat less likely to trigger this deadlock, but ultimately under load it still encounters this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13146734_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13146734_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/11 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-11-09T02:28:40+0000\'\u003e09\\/Nov\\/11 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Funny you mention 5367 and the workaround there.  It was me who opened 5367, and mentioned my workaround.  I guess I should amend my comment there, because just today I discovered that my \\\"workaround\\\" does not in fact work.  It appeared to work, and seems somewhat less likely to trigger this deadlock, but ultimately under load it still encounters this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13146735\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13146735&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13146735\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13146735_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13146735_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/11 02:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-11-09T02:32:43+0000\'\u003e09\\/Nov\\/11 02:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt is inappropriate to offer a \\\"bounty\\\" for this bug?  I\'m willing to pay to have this fixed.  The amount of time I\'ve spent trying to workaround this issue is ridiculous, and ultimately all such attempts have ended up distorting the readability of the code.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am actually stunned that more people are not encountering this bug.  Basically if two (or more) threads are SELECTing and UPDATEing the same table, they WILL hit this issue under load.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13146735_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13146735_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Nov\\/11 02:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-11-09T02:32:43+0000\'\u003e09\\/Nov\\/11 02:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It is inappropriate to offer a \\\"bounty\\\" for this bug?  I\'m willing to pay to have this fixed.  The amount of time I\'ve spent trying to workaround this issue is ridiculous, and ultimately all such attempts have ended up distorting the readability of the code. \\n\\n I am actually stunned that more people are not encountering this bug.  Basically if two (or more) threads are SELECTing and UPDATEing the same table, they WILL hit this issue under load.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13262826\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13262826&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13262826\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"chaase3\\\" id=\\\"commentauthor_13262826_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=chaase3\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"chaase3\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kim Haase\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13262826_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/12 18:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-26T18:26:52+0000\'\u003e26\\/Apr\\/12 18:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf\\/when this issue is fixed, a documentation JIRA should be filed: the statements made for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/DERBY-4280\\\" title=\\\"Property not documented - derby.language.statementCacheSize\\\" class=\\\"issue-link\\\" data-issue-key=\\\"DERBY-4280\\\"\u003e\u003cdel\u003eDERBY-4280\u003c\\/del\u003e\u003c\\/a\u003e about setting the statementCacheSize property to 0 should be removed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"chaase3\\\" id=\\\"commentauthor_13262826_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=chaase3\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"chaase3\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kim Haase\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13262826_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Apr\\/12 18:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-26T18:26:52+0000\'\u003e26\\/Apr\\/12 18:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If\\/when this issue is fixed, a documentation JIRA should be filed: the statements made for   DERBY-4280   about setting the statementCacheSize property to 0 should be removed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13400091\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13400091&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400091\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13400091_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13400091_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jun\\/12 03:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-24T03:51:59+0000\'\u003e24\\/Jun\\/12 03:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been looking at 4279 again today...\u003c\\/p\u003e\\n\\n\u003cp\u003e..and thinking of possible solutions, when a question arose.  First and foremost, the deadlock is caused by the fact that preparing a statement requires a table lock (shared) in Derby.  Why is this, technically?  If the requirement that a table lock is needed to prepare a statement can be removed, this deadlock can be\u003cbr\\/\u003e\\nfixed.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlternatively, if the requirement that a table lock is needed cannot be removed, a possible resolution for 4279 is to remove the concept that prepared statements are shared across connections and instead make the statement cache per-connection.  While this increases the memory overhead slightly &#8211; I have to believe that the artifacts of a prepared statement are in fact extremely small &#8211; it removes a lot of shared-cache synchronization code and probably increases concurrency in general.  If you\'ve been in that code, the synchronization is pretty hairy (as you can see from the comments in 4279 as well) and there are synchronization blocks in there but commented out for reasons no existing developers can explain.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact, now that I think of it, it would be great if the requirement for a table lock could be removed when preparing a statement AND the cache made per-connection (to simplify the code to a point that humans can understand).\u003c\\/p\u003e\\n\\n\u003cp\u003eI understand there is probably an edge case whereby performance would be degraded compared to existing code &#8211; that being a scenario in which connections are created and discarded frequently.  But that is a scenario easily solved by connection re-use, either explicit or by use of a connection pool.\u003c\\/p\u003e\\n\\n\u003cp\u003eThoughts?  I\'m willing to put in some work if either of these approaches is acceptable.  I already put in considerable time on 4279 over a year ago, but eventually abandoned it (as you can see in the comments) due to synchronization issues in the shared cache.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13400091_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13400091_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jun\\/12 03:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-24T03:51:59+0000\'\u003e24\\/Jun\\/12 03:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been looking at 4279 again today... \\n\\n ..and thinking of possible solutions, when a question arose.  First and foremost, the deadlock is caused by the fact that preparing a statement requires a table lock (shared) in Derby.  Why is this, technically?  If the requirement that a table lock is needed to prepare a statement can be removed, this deadlock can be \\nfixed. \\n\\n Alternatively, if the requirement that a table lock is needed cannot be removed, a possible resolution for 4279 is to remove the concept that prepared statements are shared across connections and instead make the statement cache per-connection.  While this increases the memory overhead slightly &#8211; I have to believe that the artifacts of a prepared statement are in fact extremely small &#8211; it removes a lot of shared-cache synchronization code and probably increases concurrency in general.  If you\'ve been in that code, the synchronization is pretty hairy (as you can see from the comments in 4279 as well) and there are synchronization blocks in there but commented out for reasons no existing developers can explain. \\n\\n In fact, now that I think of it, it would be great if the requirement for a table lock could be removed when preparing a statement AND the cache made per-connection (to simplify the code to a point that humans can understand). \\n\\n I understand there is probably an edge case whereby performance would be degraded compared to existing code &#8211; that being a scenario in which connections are created and discarded frequently.  But that is a scenario easily solved by connection re-use, either explicit or by use of a connection pool. \\n\\n Thoughts?  I\'m willing to put in some work if either of these approaches is acceptable.  I already put in considerable time on 4279 over a year ago, but eventually abandoned it (as you can see in the comments) due to synchronization issues in the shared cache.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13400683\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13400683&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400683\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13400683_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13400683_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jun\\/12 17:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-25T17:17:45+0000\'\u003e25\\/Jun\\/12 17:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have not been following this issue, so not sure of the details and am not an expert in this area of the code but here is what I think.  I assume that Derby is getting a table level \\\"INTENT\\\" shared lock vs a table level \\\"SHARED\\\" lock.  This\u003cbr\\/\u003e\\nis a very different thing, but for your purposes is causing the same issue.  Intent locks conflict with other table level SHARED AND EXCLUSIVE locks but not with other\u003cbr\\/\u003e\\nintent locks.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think prepare gets these intent locks on the table to insure it gets a consistent view of all the ddl associated with the table that it is compiling.  The main goal is to block other ddl\u003cbr\\/\u003e\\nfrom happening during the prepare, the assumption is that ddl and table level share and exclusive locking is rare (obviously this assumption is not working in the case of your\u003cbr\\/\u003e\\napplication.)  I assume more people are not seeing this because most applications do not require table level shared and exclusive access.  Someone with more expertise\u003cbr\\/\u003e\\nis this area of the code should comment, but I wonder if we could either eliminate this lock or make it much shorter term if we guaranteed to check if ddl had happened\u003cbr\\/\u003e\\nduring the prepare at the very end - a lot of this information is cached so I wonder if the locks are actually doing the work I describe above or if you just need the locks\u003cbr\\/\u003e\\nshort term to consistently populate the caches.  \u003c\\/p\u003e\\n\\n\u003cp\u003e Because all the information for a single table is spread across multiple catalogs one may need to do multiple probes to get all the information for a single prepare.\u003cbr\\/\u003e\\nAn example of the kind of bug that has happened in the past is that a prepare produces a plan that is not aware of a new index just added, and a subsequent insert using that\u003cbr\\/\u003e\\nplan does not update the index and thus results in a corrupt database.\u003c\\/p\u003e\\n\\n\u003cp\u003eSharing plans across connections was a big performance improvement added to derby based on many customer applications and benchmarks.  Derby compile tiime is often very\u003cbr\\/\u003e\\nslow so anything that can be done to reduce\\/eliminate that compile time is important. There are a lot of applications out there that are getting performance boosts from the\u003cbr\\/\u003e\\nshared query cache without even knowing it, and yes they may be able to get similar results with application changes but instead now are gettting it automatically.  So I would\u003cbr\\/\u003e\\nnot support eliminating altogether, but Derby is built on modular concept.  If you wanted to add a change that allowed derby to boot in a mode that did not have a shared\u003cbr\\/\u003e\\ncache (while still supporting default of a shared cache), that might be a reasonable approach.  Similar to we default to derby working disk based, but allow it to booted with\u003cbr\\/\u003e\\na different module that allows it to be memory based.  I know at least the disk page cache is implemented in a module that was designed to be easily replaced, not sure about \u003cbr\\/\u003e\\ncurrent state of query cache.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13400683_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13400683_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jun\\/12 17:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-25T17:17:45+0000\'\u003e25\\/Jun\\/12 17:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have not been following this issue, so not sure of the details and am not an expert in this area of the code but here is what I think.  I assume that Derby is getting a table level \\\"INTENT\\\" shared lock vs a table level \\\"SHARED\\\" lock.  This \\nis a very different thing, but for your purposes is causing the same issue.  Intent locks conflict with other table level SHARED AND EXCLUSIVE locks but not with other \\nintent locks. \\n\\n I think prepare gets these intent locks on the table to insure it gets a consistent view of all the ddl associated with the table that it is compiling.  The main goal is to block other ddl \\nfrom happening during the prepare, the assumption is that ddl and table level share and exclusive locking is rare (obviously this assumption is not working in the case of your \\napplication.)  I assume more people are not seeing this because most applications do not require table level shared and exclusive access.  Someone with more expertise \\nis this area of the code should comment, but I wonder if we could either eliminate this lock or make it much shorter term if we guaranteed to check if ddl had happened \\nduring the prepare at the very end - a lot of this information is cached so I wonder if the locks are actually doing the work I describe above or if you just need the locks \\nshort term to consistently populate the caches.   \\n\\n  Because all the information for a single table is spread across multiple catalogs one may need to do multiple probes to get all the information for a single prepare. \\nAn example of the kind of bug that has happened in the past is that a prepare produces a plan that is not aware of a new index just added, and a subsequent insert using that \\nplan does not update the index and thus results in a corrupt database. \\n\\n Sharing plans across connections was a big performance improvement added to derby based on many customer applications and benchmarks.  Derby compile tiime is often very \\nslow so anything that can be done to reduce\\/eliminate that compile time is important. There are a lot of applications out there that are getting performance boosts from the \\nshared query cache without even knowing it, and yes they may be able to get similar results with application changes but instead now are gettting it automatically.  So I would \\nnot support eliminating altogether, but Derby is built on modular concept.  If you wanted to add a change that allowed derby to boot in a mode that did not have a shared \\ncache (while still supporting default of a shared cache), that might be a reasonable approach.  Similar to we default to derby working disk based, but allow it to booted with \\na different module that allows it to be memory based.  I know at least the disk page cache is implemented in a module that was designed to be easily replaced, not sure about  \\ncurrent state of query cache.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13402024\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13402024&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13402024\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13402024_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402024_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/12 07:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-27T07:33:58+0000\'\u003e27\\/Jun\\/12 07:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOkay, here is my second cut a fix...\u003c\\/p\u003e\\n\\n\u003cp\u003eFirst of all, the original report surmised that any DML, not just SELECT, could cause this deadlock.  I myself thought this as well, but it turns out not to be the case.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are two places in the statement compilation code where openConglomerate() is called.   All compiled statement nodes ultimately inherit from StatementNode.  In StatementNode.lockTableForCompilation() you will find this logic:\u003c\\/p\u003e\\n\\n\u003cp\u003eif (dataDictionary.getCacheMode() == DataDictionary.DDL_MODE)   &lt;=== Important\u003cbr\\/\u003e\\n{\u003cbr\\/\u003e\\n    ...\u003cbr\\/\u003e\\n    heapCC = tc.openConglomerate(td.getHeapConglomerateId(),\u003cbr\\/\u003e\\n        false,\u003cbr\\/\u003e\\n        TransactionController.OPENMODE_FORUPDATE |\u003cbr\\/\u003e\\n        TransactionController.OPENMODE_FOR_LOCK_ONLY,\u003cbr\\/\u003e\\n        TransactionController.MODE_RECORD,\u003cbr\\/\u003e\\n        TransactionController.ISOLATION_SERIALIZABLE);   &lt;=== Important\u003cbr\\/\u003e\\n    ...\u003cbr\\/\u003e\\n}\u003c\\/p\u003e\\n\\n\u003cp\u003eThe method is preceded with this comment:\u003c\\/p\u003e\\n\\n\u003cp\u003e\\t\\/* We need to get some kind of table lock (IX here) at the beginning of\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ecompilation of DMLModStatementNode and DDLStatementNode, to prevent the\u003c\\/li\u003e\\n\\t\u003cli\u003einterference of insert\\/update\\/delete\\/DDL compilation and DDL execution,\u003c\\/li\u003e\\n\\t\u003cli\u003esee beetle 3976, 4343, and $WS\\/language\\/SolutionsToConcurrencyIssues.txt\u003cbr\\/\u003e\\n\\t *\\/\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eHowever, ultimately, according to the logic the lock is only obtained if the DataDictionary is in DDL_MODE.  This is all fine.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow to the heart of the issue.  The second place where openConglomerate() is called is in ResultColumnList.generateHolderMethod().  This is used for SELECT statements for columns that will ultimately appear in the ResultSet (or sub-SELECTs in nested queries).  In ResultColumnList.generateHolderMethod() you will find this logic:\u003c\\/p\u003e\\n\\n\u003cp\u003ecc = getLanguageConnectionContext().getTransactionCompile().openConglomerate(\u003cbr\\/\u003e\\n        conglomerateId,\u003cbr\\/\u003e\\n        false,\u003cbr\\/\u003e\\n        0,\u003cbr\\/\u003e\\n        TransactionController.MODE_RECORD,\u003cbr\\/\u003e\\n        TransactionController.ISOLATION_READ_COMMITTED);   &lt;=== Important\u003c\\/p\u003e\\n\\n\u003cp\u003eNotice no conditional logic.  In other words, a lock on the conglomerate is unconditionally obtained.  It is this lock that contends with a table lock that may have been obtained elsewhere (possibly DDL, possibly an explicit lock).  The attached patch changes this code to the following:\u003c\\/p\u003e\\n\\n\u003cp\u003eLanguageConnectionContext lcc = getLanguageConnectionContext();\u003cbr\\/\u003e\\nDataDictionary dd = lcc.getDataDictionary();\u003cbr\\/\u003e\\nint isolationLevel = (dd.getCacheMode() == DataDictionary.DDL_MODE) ?\u003cbr\\/\u003e\\n        TransactionController.ISOLATION_READ_COMMITTED : TransactionController.ISOLATION_NOLOCK;\u003cbr\\/\u003e\\ncc = lcc.getTransactionCompile().openConglomerate(\u003cbr\\/\u003e\\n        conglomerateId,\u003cbr\\/\u003e\\n        false,\u003cbr\\/\u003e\\n        0,\u003cbr\\/\u003e\\n        TransactionController.MODE_RECORD,\u003cbr\\/\u003e\\n        isolationLevel);\u003c\\/p\u003e\\n\\n\u003cp\u003eBasically, it too checks the DataDictionary to see if it is in DDL_MODE.  If it is, it maintains the same locking level as the existing code.  However, if the DataDictionary is not being modified the code will not obtain a lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is the impact?  The original code has the effect of blocking DDL from execution by locking the table(s) during this compile phase.  And in turn, if DDL has locked the table(s), the compilation will be blocked.  The first I take to be an unintended side-effect (as you\'ll see).\u003c\\/p\u003e\\n\\n\u003cp\u003eLet\'s take the second case first.  If DDL has occurred (and locked tables), the DataDictionary will be in DDL_MODE, and the new code behaves the same as the old code; the conglomerate is opened with READ_COMMITTED isolation and the compilation will be blocked just as before.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow the first case.  If compilation of a statement (that involves ResultColumnList) has started and no DDL is in-progress at that instant, no locks are obtained (because the cache mode is not DDL_MODE).  This is the same as other statement types \u003cspan class=\\\"error\\\"\u003e&#91;that extend from StatementNode&#93;\u003c\\/span\u003e.  If DDL occurs after compilation has started, it will not be blocked (but it was never blocked in all other cases).  Because it was never blocked in other cases (due to the conditional logic), I take this to be a side-effect.  However...\u003c\\/p\u003e\\n\\n\u003cp\u003eIf DDL does happen to alter the table(s) involved there is already code to handle it.  All roads to ResultColumnList.generateHolderMethod() lead back to GenericStatement.prepare().  GenericStatement.prepare() has this logic fragment:\u003c\\/p\u003e\\n\\n\u003cp\u003etry {\u003cbr\\/\u003e\\n    return prepMinion(lcc, true, (Object[]) null, (SchemaDescriptor) null, forMetaData);\u003cbr\\/\u003e\\n} catch (StandardException se) {\u003cbr\\/\u003e\\n    \\/\\/ There is a chance that we didn\'t see the invalidation\u003cbr\\/\u003e\\n    \\/\\/ request from a DDL operation in another thread because\u003cbr\\/\u003e\\n    \\/\\/ the statement wasn\'t registered as a dependent until\u003cbr\\/\u003e\\n    \\/\\/ after the invalidation had been completed. Assume that\'s\u003cbr\\/\u003e\\n    \\/\\/ what has happened if we see a conglomerate does not exist\u003cbr\\/\u003e\\n    \\/\\/ error, and force a retry even if the statement hasn\'t been\u003cbr\\/\u003e\\n    \\/\\/ invalidated.\u003cbr\\/\u003e\\n    if (SQLState.STORE_CONGLOMERATE_DOES_NOT_EXIST.equals(se.getMessageId())) \u003c\\/p\u003e\\n{\\n        ... recompile ...\\n    }\\n\u003cp\u003e}\u003c\\/p\u003e\\n\\n\u003cp\u003eSo, even though the compile of a SELECT will no longer block DDL from occurring (remember UPDATE, DELETE, and all other DML never blocked it anyway) there is code in-place to handle the possibility that openConglomerate() in StatementNode or ResultColumnList might fail.  In that case, the compile is given one more shot before failing (recompile = true).\u003c\\/p\u003e\\n\\n\u003cp\u003eIt is debatable now that the logic in ResultColumnList is the same as StatementNode, whether the isolation in ResultColumnList should also be ISOLATION_SERIALIZABLE like StatementNode given that it is now also conditional based on DataDictionary.getCacheMode() == DDL_MODE.  However, my approach was to be least impacting in terms of deviation from current known working code.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn a final note, this patch obviously fixed the test case attached to this issue, however past attempts to fix this bug did the same but ultimately failed in some of the long running stress tests.  It would be helpful if this patch could be applied and let run through the usual full barrage of tests.  That said, the previous patch attempted to fix the issue at the statement cache level with all of it\'s hairy synchronization.  This patch is considerably simpler both conceptually and implementation-wise.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13402024_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402024_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/12 07:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-27T07:33:58+0000\'\u003e27\\/Jun\\/12 07:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Okay, here is my second cut a fix... \\n\\n First of all, the original report surmised that any DML, not just SELECT, could cause this deadlock.  I myself thought this as well, but it turns out not to be the case. \\n\\n There are two places in the statement compilation code where openConglomerate() is called.   All compiled statement nodes ultimately inherit from StatementNode.  In StatementNode.lockTableForCompilation() you will find this logic: \\n\\n if (dataDictionary.getCacheMode() == DataDictionary.DDL_MODE)   &lt;=== Important \\n{ \\n    ... \\n    heapCC = tc.openConglomerate(td.getHeapConglomerateId(), \\n        false, \\n        TransactionController.OPENMODE_FORUPDATE | \\n        TransactionController.OPENMODE_FOR_LOCK_ONLY, \\n        TransactionController.MODE_RECORD, \\n        TransactionController.ISOLATION_SERIALIZABLE);   &lt;=== Important \\n    ... \\n} \\n\\n The method is preceded with this comment: \\n\\n \\t\\/* We need to get some kind of table lock (IX here) at the beginning of \\n \\n\\t compilation of DMLModStatementNode and DDLStatementNode, to prevent the \\n\\t interference of insert\\/update\\/delete\\/DDL compilation and DDL execution, \\n\\t see beetle 3976, 4343, and $WS\\/language\\/SolutionsToConcurrencyIssues.txt \\n\\t *\\/ \\n \\n\\n\\n However, ultimately, according to the logic the lock is only obtained if the DataDictionary is in DDL_MODE.  This is all fine. \\n\\n Now to the heart of the issue.  The second place where openConglomerate() is called is in ResultColumnList.generateHolderMethod().  This is used for SELECT statements for columns that will ultimately appear in the ResultSet (or sub-SELECTs in nested queries).  In ResultColumnList.generateHolderMethod() you will find this logic: \\n\\n cc = getLanguageConnectionContext().getTransactionCompile().openConglomerate( \\n        conglomerateId, \\n        false, \\n        0, \\n        TransactionController.MODE_RECORD, \\n        TransactionController.ISOLATION_READ_COMMITTED);   &lt;=== Important \\n\\n Notice no conditional logic.  In other words, a lock on the conglomerate is unconditionally obtained.  It is this lock that contends with a table lock that may have been obtained elsewhere (possibly DDL, possibly an explicit lock).  The attached patch changes this code to the following: \\n\\n LanguageConnectionContext lcc = getLanguageConnectionContext(); \\nDataDictionary dd = lcc.getDataDictionary(); \\nint isolationLevel = (dd.getCacheMode() == DataDictionary.DDL_MODE) ? \\n        TransactionController.ISOLATION_READ_COMMITTED : TransactionController.ISOLATION_NOLOCK; \\ncc = lcc.getTransactionCompile().openConglomerate( \\n        conglomerateId, \\n        false, \\n        0, \\n        TransactionController.MODE_RECORD, \\n        isolationLevel); \\n\\n Basically, it too checks the DataDictionary to see if it is in DDL_MODE.  If it is, it maintains the same locking level as the existing code.  However, if the DataDictionary is not being modified the code will not obtain a lock. \\n\\n What is the impact?  The original code has the effect of blocking DDL from execution by locking the table(s) during this compile phase.  And in turn, if DDL has locked the table(s), the compilation will be blocked.  The first I take to be an unintended side-effect (as you\'ll see). \\n\\n Let\'s take the second case first.  If DDL has occurred (and locked tables), the DataDictionary will be in DDL_MODE, and the new code behaves the same as the old code; the conglomerate is opened with READ_COMMITTED isolation and the compilation will be blocked just as before. \\n\\n Now the first case.  If compilation of a statement (that involves ResultColumnList) has started and no DDL is in-progress at that instant, no locks are obtained (because the cache mode is not DDL_MODE).  This is the same as other statement types  &#91;that extend from StatementNode&#93; .  If DDL occurs after compilation has started, it will not be blocked (but it was never blocked in all other cases).  Because it was never blocked in other cases (due to the conditional logic), I take this to be a side-effect.  However... \\n\\n If DDL does happen to alter the table(s) involved there is already code to handle it.  All roads to ResultColumnList.generateHolderMethod() lead back to GenericStatement.prepare().  GenericStatement.prepare() has this logic fragment: \\n\\n try { \\n    return prepMinion(lcc, true, (Object[]) null, (SchemaDescriptor) null, forMetaData); \\n} catch (StandardException se) { \\n    \\/\\/ There is a chance that we didn\'t see the invalidation \\n    \\/\\/ request from a DDL operation in another thread because \\n    \\/\\/ the statement wasn\'t registered as a dependent until \\n    \\/\\/ after the invalidation had been completed. Assume that\'s \\n    \\/\\/ what has happened if we see a conglomerate does not exist \\n    \\/\\/ error, and force a retry even if the statement hasn\'t been \\n    \\/\\/ invalidated. \\n    if (SQLState.STORE_CONGLOMERATE_DOES_NOT_EXIST.equals(se.getMessageId()))  \\n{\\n        ... recompile ...\\n    }\\n } \\n\\n So, even though the compile of a SELECT will no longer block DDL from occurring (remember UPDATE, DELETE, and all other DML never blocked it anyway) there is code in-place to handle the possibility that openConglomerate() in StatementNode or ResultColumnList might fail.  In that case, the compile is given one more shot before failing (recompile = true). \\n\\n It is debatable now that the logic in ResultColumnList is the same as StatementNode, whether the isolation in ResultColumnList should also be ISOLATION_SERIALIZABLE like StatementNode given that it is now also conditional based on DataDictionary.getCacheMode() == DDL_MODE.  However, my approach was to be least impacting in terms of deviation from current known working code. \\n\\n On a final note, this patch obviously fixed the test case attached to this issue, however past attempts to fix this bug did the same but ultimately failed in some of the long running stress tests.  It would be helpful if this patch could be applied and let run through the usual full barrage of tests.  That said, the previous patch attempted to fix the issue at the statement cache level with all of it\'s hairy synchronization.  This patch is considerably simpler both conceptually and implementation-wise.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13402147\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13402147&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13402147\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13402147_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402147_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/12 11:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-27T11:32:11+0000\'\u003e27\\/Jun\\/12 11:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for your continued effort on this problem, Brett.\u003c\\/p\u003e\\n\\n\u003cp\u003eWithout having reviewed the approach used in the patch thoroughly, I can say that suites.All and derbyall passed with the patch applied in my environment.\u003c\\/p\u003e\\n\\n\u003cp\u003eBW&gt; So, even though the compile of a SELECT will no longer block DDL from occurring \u003cspan class=\\\"error\\\"\u003e&#91;...&#93;\u003c\\/span\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not convinced this is true. There\'s another mechanism in place in the data dictionary (DD) to stop that from happening. For a DDL operation to be allowed, there can\'t be any ongoing compilations. Note that the opposite isn\'t the case; compilations can occur even though a DDL is in progress. In the latter case the system catalogs are queried directly instead of going through the\\/a cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eNow, this mechanism relies on several state objects and is a bit complicated so I\'m not 100% sure I\'m correct. The methods startReading\\/doneReading and startWriting\\/transactionFinished in DataDictionaryImpl are good starting points to investigate this further. Note the use of the lock and the relevant counters.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13402147_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402147_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/12 11:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-27T11:32:11+0000\'\u003e27\\/Jun\\/12 11:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for your continued effort on this problem, Brett. \\n\\n Without having reviewed the approach used in the patch thoroughly, I can say that suites.All and derbyall passed with the patch applied in my environment. \\n\\n BW&gt; So, even though the compile of a SELECT will no longer block DDL from occurring  &#91;...&#93;  \\n\\n I\'m not convinced this is true. There\'s another mechanism in place in the data dictionary (DD) to stop that from happening. For a DDL operation to be allowed, there can\'t be any ongoing compilations. Note that the opposite isn\'t the case; compilations can occur even though a DDL is in progress. In the latter case the system catalogs are queried directly instead of going through the\\/a cache. \\n\\n Now, this mechanism relies on several state objects and is a bit complicated so I\'m not 100% sure I\'m correct. The methods startReading\\/doneReading and startWriting\\/transactionFinished in DataDictionaryImpl are good starting points to investigate this further. Note the use of the lock and the relevant counters.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13402191\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13402191&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13402191\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13402191_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402191_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/12 12:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-27T12:43:38+0000\'\u003e27\\/Jun\\/12 12:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKristian,\u003c\\/p\u003e\\n\\n\u003cp\u003eYou might be right, I could be mistaken about a SELECT not blocking DDL.  Be that as it may, this defect here is only tangential to DDL, and as the testcase shows, the deadlock occurs without any DDL per se.  Just simple table-locking.  As to whether this change could adversely affect DDL that is run concurrently with queries &#8211; such as it used to block it but now doesn\'t, I am not sure.  I don\'t have a test that runs DDL concurrently with queries, do you know if any of the standard tests or stress tests do that?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13402191_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402191_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/12 12:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-27T12:43:38+0000\'\u003e27\\/Jun\\/12 12:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Kristian, \\n\\n You might be right, I could be mistaken about a SELECT not blocking DDL.  Be that as it may, this defect here is only tangential to DDL, and as the testcase shows, the deadlock occurs without any DDL per se.  Just simple table-locking.  As to whether this change could adversely affect DDL that is run concurrently with queries &#8211; such as it used to block it but now doesn\'t, I am not sure.  I don\'t have a test that runs DDL concurrently with queries, do you know if any of the standard tests or stress tests do that?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13402899\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13402899&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13402899\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13402899_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402899_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 07:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T07:19:04+0000\'\u003e28\\/Jun\\/12 07:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrett,\u003c\\/p\u003e\\n\\n\u003cp\u003eI think store.AutomaticIndexStatisticsMultiTest may test this scenario.\u003cbr\\/\u003e\\nMy point was not to claim that there is something wrong with the patch, but rather to point out that I believe there is another mechanism in place that will block DDL if a compilation is taking place. Your patch doesn\'t change anything wrt that mechanism.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eNow, looking at that second call to openConglomerate it seems to me it\'s being done only to obtain a row location template. Only heaps can create row location objects. A heap row location template is nothing but a Java object wrapping a few primitive values that haven\'t been set. I don\'t immediately see why the conglomerate\\/heap even has to be open to obtain such an object, but maybe the restriction was put in place for a good reason (anyone?).\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m optimistic that the approach in the patch is sound. The question is if obtaining the lock can cause problems in DDL mode, and if we can skip taking it in that mode too. However, I haven\'t dug deep enough to understand the locking code. Can anyone with more experience in that area see if not taking the lock in RCL.generateHolderMethod has consequences the code isn\'t prepared to handle?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13402899_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402899_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 07:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T07:19:04+0000\'\u003e28\\/Jun\\/12 07:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Brett, \\n\\n I think store.AutomaticIndexStatisticsMultiTest may test this scenario. \\nMy point was not to claim that there is something wrong with the patch, but rather to point out that I believe there is another mechanism in place that will block DDL if a compilation is taking place. Your patch doesn\'t change anything wrt that mechanism. \\n\\n\\n Now, looking at that second call to openConglomerate it seems to me it\'s being done only to obtain a row location template. Only heaps can create row location objects. A heap row location template is nothing but a Java object wrapping a few primitive values that haven\'t been set. I don\'t immediately see why the conglomerate\\/heap even has to be open to obtain such an object, but maybe the restriction was put in place for a good reason (anyone?). \\n\\n I\'m optimistic that the approach in the patch is sound. The question is if obtaining the lock can cause problems in DDL mode, and if we can skip taking it in that mode too. However, I haven\'t dug deep enough to understand the locking code. Can anyone with more experience in that area see if not taking the lock in RCL.generateHolderMethod has consequences the code isn\'t prepared to handle?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13402921\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13402921&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13402921\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13402921_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402921_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 08:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T08:10:42+0000\'\u003e28\\/Jun\\/12 08:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAs an experiment I ran the JUnit regression tests with the patch \'no-lock-experiment.diff\'. It just hardcodes the use of a HeapRowLocation instead of opening the conglomerate and getting a lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe tests completed without any errors.\u003cbr\\/\u003e\\nThe problem is I don\'t really know if all aspects of the change has been tested, and since most of the tests are single-threaded having these tests pass doesn\'t really give me that much confidence about the change.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13402921_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13402921_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 08:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T08:10:42+0000\'\u003e28\\/Jun\\/12 08:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    As an experiment I ran the JUnit regression tests with the patch \'no-lock-experiment.diff\'. It just hardcodes the use of a HeapRowLocation instead of opening the conglomerate and getting a lock. \\n\\n The tests completed without any errors. \\nThe problem is I don\'t really know if all aspects of the change has been tested, and since most of the tests are single-threaded having these tests pass doesn\'t really give me that much confidence about the change.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13403101\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13403101&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13403101\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13403101_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403101_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 13:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T13:51:30+0000\'\u003e28\\/Jun\\/12 13:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKristian,\u003c\\/p\u003e\\n\\n\u003cp\u003eNone of this is documented obviously, but here is my best guess why that code is the way that it is.  Trying to open the conglomerate acts as a check that the schema has not been modified by another thread\\/transaction.  There may be other locks in place, as you mentioned, that attempt to prevent DDL run running but my guess is there are still \'seams\' where it can happen.  Hence the opening of the conglomerate, and note also (especially) the comments in the try...catch in GenericStatement.prepare() where the StandardException is caught and explicitly checked for an error.  The comment is:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/\\/ There is a chance that we didn\'t see the invalidation \u003cbr\\/\u003e\\n    \\/\\/ request from a DDL operation in another thread because \u003cbr\\/\u003e\\n    \\/\\/ the statement wasn\'t registered as a dependent until \u003cbr\\/\u003e\\n    \\/\\/ after the invalidation had been completed.  Assume that\'s \u003cbr\\/\u003e\\n    \\/\\/ what has happened if we see a conglomerate does not exist \u003cbr\\/\u003e\\n    \\/\\/ error...\u003c\\/p\u003e\\n\\n\u003cp\u003eWhich implies to me that DDL might not always be blocked, and code was put in place to handle that case.  Since DDL is rare in a running system, catching an exception might therefore be much cheaper than some kind of read\\/write lock to try to prevent it.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe other possibility is that DDL and DML are completely protected\\/synchronized now (compared to when that code was written), and some of that code is simply unnecessary.  I\'m not in a position to make that judgement.  Hence my attempt to retain as much as of the original behavior, be it inefficient or not, to minimize side-effects.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would be perfectly happy with the patch as submitted along with additional comments in the code basically asking \'Is the still necessary?\' with a reference to this bug.  Maybe at some point in the future someone digging through the code will unravel the logic completely and determine that \'yes, it is necessary\' or \'no, it is not\'.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13403101_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403101_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 13:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T13:51:30+0000\'\u003e28\\/Jun\\/12 13:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Kristian, \\n\\n None of this is documented obviously, but here is my best guess why that code is the way that it is.  Trying to open the conglomerate acts as a check that the schema has not been modified by another thread\\/transaction.  There may be other locks in place, as you mentioned, that attempt to prevent DDL run running but my guess is there are still \'seams\' where it can happen.  Hence the opening of the conglomerate, and note also (especially) the comments in the try...catch in GenericStatement.prepare() where the StandardException is caught and explicitly checked for an error.  The comment is: \\n\\n     \\/\\/ There is a chance that we didn\'t see the invalidation  \\n    \\/\\/ request from a DDL operation in another thread because  \\n    \\/\\/ the statement wasn\'t registered as a dependent until  \\n    \\/\\/ after the invalidation had been completed.  Assume that\'s  \\n    \\/\\/ what has happened if we see a conglomerate does not exist  \\n    \\/\\/ error... \\n\\n Which implies to me that DDL might not always be blocked, and code was put in place to handle that case.  Since DDL is rare in a running system, catching an exception might therefore be much cheaper than some kind of read\\/write lock to try to prevent it. \\n\\n The other possibility is that DDL and DML are completely protected\\/synchronized now (compared to when that code was written), and some of that code is simply unnecessary.  I\'m not in a position to make that judgement.  Hence my attempt to retain as much as of the original behavior, be it inefficient or not, to minimize side-effects. \\n\\n I would be perfectly happy with the patch as submitted along with additional comments in the code basically asking \'Is the still necessary?\' with a reference to this bug.  Maybe at some point in the future someone digging through the code will unravel the logic completely and determine that \'yes, it is necessary\' or \'no, it is not\'.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13403353\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13403353&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13403353\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13403353_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403353_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 18:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T18:46:29+0000\'\u003e28\\/Jun\\/12 18:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ecommenting on RowLocation.  The system is designed such that one could implement multiple types of conglomerates.  Currently there are only 2 types, btree and heap - but a lot of structure to allow for more.  So in keeping with this callers know they need a RowLocation but it is up to each implementation to provide the \\\"hidden\\\" actual implementation, in this case the HeapRowLocation.  Getting\u003cbr\\/\u003e\\nthis row location from an open conglomerate seemed a natural place as almost all work with a conglomerate already has an open conglomerate of some sort. \u003c\\/p\u003e\\n\\n\u003cp\u003eIf it helps to not have to open a conglomerate to get this RowLocation then it would be best to just add a new interface.  I think code could be written to just return the right kind of RowLocation based\u003cbr\\/\u003e\\non the conglomerate id.  At least with the current conglomerate inplementations there is nothing ddl related that would change the RowLocation object returned.  There might be future implementations\u003cbr\\/\u003e\\nthat might require a lock, but I would just add comments about the current problems with getting locks in this operation and the JIRA issue and let future implementers think about that.  \u003c\\/p\u003e\\n\\n\u003cp\u003eNew interface would look something like:  TransactionController.newRowLocationTemplate(conglomerateId)\u003c\\/p\u003e\\n\\n\u003cp\u003eIf it looks like this is needed let me know, I would be happy to submit a patch with this new interface - if the testing shows this to be helpful.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikem\\\" id=\\\"commentauthor_13403353_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikem\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikem\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mike Matrigali\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403353_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 18:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T18:46:29+0000\'\u003e28\\/Jun\\/12 18:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    commenting on RowLocation.  The system is designed such that one could implement multiple types of conglomerates.  Currently there are only 2 types, btree and heap - but a lot of structure to allow for more.  So in keeping with this callers know they need a RowLocation but it is up to each implementation to provide the \\\"hidden\\\" actual implementation, in this case the HeapRowLocation.  Getting \\nthis row location from an open conglomerate seemed a natural place as almost all work with a conglomerate already has an open conglomerate of some sort.  \\n\\n If it helps to not have to open a conglomerate to get this RowLocation then it would be best to just add a new interface.  I think code could be written to just return the right kind of RowLocation based \\non the conglomerate id.  At least with the current conglomerate inplementations there is nothing ddl related that would change the RowLocation object returned.  There might be future implementations \\nthat might require a lock, but I would just add comments about the current problems with getting locks in this operation and the JIRA issue and let future implementers think about that.   \\n\\n New interface would look something like:  TransactionController.newRowLocationTemplate(conglomerateId) \\n\\n If it looks like this is needed let me know, I would be happy to submit a patch with this new interface - if the testing shows this to be helpful.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13403846\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13403846&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13403846\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13403846_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403846_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/12 11:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-29T11:45:03+0000\'\u003e29\\/Jun\\/12 11:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for sharing your knowledge on this, Mike.\u003cbr\\/\u003e\\nThe way I see it, the demand for a new interface is not strong enough based on this particular case only. It would be if it turns out using the existing interface is too costly performance-wise, but we don\'t have any data\\/indications on that.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor now I\'d be content with using Brett\'s patch with ISOLATION_NOLOCK (assuming it does what it implies). It would be good to determine if we can use ISOLATION_NOLOCK in this particular case also when the dictionary is in DDL-mode (see comment below on the DD mode), but that can be done as a separate step.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne more comment on the DD modes.\u003cbr\\/\u003e\\nIf the DD is in compile only mode and a compilation is in progress, then no DDL will take place.\u003cbr\\/\u003e\\nIf the DD is in DDL mode and a compilation starts, then the compilation may be performed concurrently with DDL.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13403846_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403846_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/12 11:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-29T11:45:03+0000\'\u003e29\\/Jun\\/12 11:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for sharing your knowledge on this, Mike. \\nThe way I see it, the demand for a new interface is not strong enough based on this particular case only. It would be if it turns out using the existing interface is too costly performance-wise, but we don\'t have any data\\/indications on that. \\n\\n For now I\'d be content with using Brett\'s patch with ISOLATION_NOLOCK (assuming it does what it implies). It would be good to determine if we can use ISOLATION_NOLOCK in this particular case also when the dictionary is in DDL-mode (see comment below on the DD mode), but that can be done as a separate step. \\n\\n One more comment on the DD modes. \\nIf the DD is in compile only mode and a compilation is in progress, then no DDL will take place. \\nIf the DD is in DDL mode and a compilation starts, then the compilation may be performed concurrently with DDL.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13403869\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13403869&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13403869\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13403869_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403869_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/12 12:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-29T12:31:35+0000\'\u003e29\\/Jun\\/12 12:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKristian and Mike,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for both of your inputs on this issue.  It\'s been nagging me for 2 years now, I\'ll be glad to see it buried.  Let me know if there is anything else I can do.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13403869_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403869_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/12 12:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-29T12:31:35+0000\'\u003e29\\/Jun\\/12 12:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Kristian and Mike, \\n\\n Thanks for both of your inputs on this issue.  It\'s been nagging me for 2 years now, I\'ll be glad to see it buried.  Let me know if there is anything else I can do.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13404148\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13404148&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13404148\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_13404148_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13404148_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/12 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-29T19:41:41+0000\'\u003e29\\/Jun\\/12 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am not familiar with the synchronization code during stale prepared statement re-compile. But I was looking at the first patch submitted by Brett and suggestion by Knut about statements using session schema and how they do not get saved in the statement cache. \u003c\\/p\u003e\\n\\n\u003cp\u003eI worked on statements involving session schema many years back and recall implementing logic which will prevent such statements from going into statement cache. \u003c\\/p\u003e\\n\\n\u003cp\u003eWill a similar logic for this jira help with all the synchronization issues we are dealing with? ie, if a thread finds that the prepared statement is already in cache but it is being compiled by another thread, then go ahead and create a new GenericPreparedStatement and compile that instead(same as if the statement never existed in the cahce), BUT do not save this new statement in the statement cache(just like a statement referencing session schema). So, this newly compiled statement will not be available to any other thread. But that should be fine because original preapred statement in the cache is already getting compiled and hence it will be available to other threads in future. Like Brett mentioned, \\\"Unless a statement undergoes constant concurrent recompilation (defeating the statement cache anyway)\\\", throwing away a compiled statement after use by a thread if that thread finds previously compiled statement in invalid state and getting compiled by another thread should not be a big overhead.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am not sure if creating a GenericPreparedStatement for use by just one thread will solve the synchronization problem in this jira but I wanted to put it out anyways in case if this approach helps.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mamtas\\\" id=\\\"commentauthor_13404148_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mamtas\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mamtas\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mamta A. Satoor\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13404148_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jun\\/12 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-29T19:41:41+0000\'\u003e29\\/Jun\\/12 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am not familiar with the synchronization code during stale prepared statement re-compile. But I was looking at the first patch submitted by Brett and suggestion by Knut about statements using session schema and how they do not get saved in the statement cache.  \\n\\n I worked on statements involving session schema many years back and recall implementing logic which will prevent such statements from going into statement cache.  \\n\\n Will a similar logic for this jira help with all the synchronization issues we are dealing with? ie, if a thread finds that the prepared statement is already in cache but it is being compiled by another thread, then go ahead and create a new GenericPreparedStatement and compile that instead(same as if the statement never existed in the cahce), BUT do not save this new statement in the statement cache(just like a statement referencing session schema). So, this newly compiled statement will not be available to any other thread. But that should be fine because original preapred statement in the cache is already getting compiled and hence it will be available to other threads in future. Like Brett mentioned, \\\"Unless a statement undergoes constant concurrent recompilation (defeating the statement cache anyway)\\\", throwing away a compiled statement after use by a thread if that thread finds previously compiled statement in invalid state and getting compiled by another thread should not be a big overhead. \\n\\n I am not sure if creating a GenericPreparedStatement for use by just one thread will solve the synchronization problem in this jira but I wanted to put it out anyways in case if this approach helps.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13404390\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13404390&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13404390\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13404390_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13404390_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jun\\/12 04:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-30T04:52:04+0000\'\u003e30\\/Jun\\/12 04:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMamta,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for your feedback.  From an efficiency point of view, I think your suggestion (and my initial attempt at a bug fix) is a good approach in general.  As Bryan Pendleton commented earlier,\u003c\\/p\u003e\\n\\n\u003cp\u003e\\\"I think the approach of allowing each caller to prepare the statement independently is valid and useful. In this age of multi-core computing, I think doing possibly extra work like this in search of higher concurrency (and fewer deadlocks) is a good technique.\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eI would however like to do that work under another bug (enhancement), as I think the most recent patch to fix this bug is both sufficient and correct to address this bug per se.  When this change has been accepted, I\'ll open another bug under which to do work on concurrency.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13404390_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13404390_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jun\\/12 04:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-30T04:52:04+0000\'\u003e30\\/Jun\\/12 04:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mamta, \\n\\n Thanks for your feedback.  From an efficiency point of view, I think your suggestion (and my initial attempt at a bug fix) is a good approach in general.  As Bryan Pendleton commented earlier, \\n\\n \\\"I think the approach of allowing each caller to prepare the statement independently is valid and useful. In this age of multi-core computing, I think doing possibly extra work like this in search of higher concurrency (and fewer deadlocks) is a good technique.\\\" \\n\\n I would however like to do that work under another bug (enhancement), as I think the most recent patch to fix this bug is both sufficient and correct to address this bug per se.  When this change has been accepted, I\'ll open another bug under which to do work on concurrency.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13411448\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13411448&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13411448\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13411448_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13411448_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 12:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T12:56:09+0000\'\u003e11\\/Jul\\/12 12:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan somebody with checkin privileges commit this patch?  It is complete as far as I am concerned.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brettw\\\" id=\\\"commentauthor_13411448_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brettw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brettw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Wooldridge\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13411448_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 12:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T12:56:09+0000\'\u003e11\\/Jul\\/12 12:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can somebody with checkin privileges commit this patch?  It is complete as far as I am concerned.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13419085\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13419085&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13419085\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13419085_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13419085_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jul\\/12 12:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-20T12:30:35+0000\'\u003e20\\/Jul\\/12 12:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e I\'ve just returned from vacation, and I\'ll to do that over the week end. I want to check a few last things before committing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13419085_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13419085_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jul\\/12 12:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-20T12:30:35+0000\'\u003e20\\/Jul\\/12 12:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'ve just returned from vacation, and I\'ll to do that over the week end. I want to check a few last things before committing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13422261\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13422261&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13422261\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13422261_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13422261_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/12 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-25T13:39:41+0000\'\u003e25\\/Jul\\/12 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFrom what I can see, the lock, which is a \\\"container intention read lock\\\" (CIS), is released as soon as the controller is closed. I observed this by tracing the locks (derby.debug.true=LockTrace + a custom message to the log to navigate in derby.log). This is a very short time-span, and it happens independently of the isolation level of the transaction (separate sub-transaction for compilation?). Once my test-run has completed I will commit the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we observe the deadlock also when the mode is DDL_MODE I don\'t see why we can\'t use NO_LOCK in all cases, since the code appears to be prepared to handle that the conglomerate is dropped under its feet. However, it seems safer to me to keep the change minimal for the time being.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13422261_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13422261_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/12 13:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-25T13:39:41+0000\'\u003e25\\/Jul\\/12 13:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    From what I can see, the lock, which is a \\\"container intention read lock\\\" (CIS), is released as soon as the controller is closed. I observed this by tracing the locks (derby.debug.true=LockTrace + a custom message to the log to navigate in derby.log). This is a very short time-span, and it happens independently of the isolation level of the transaction (separate sub-transaction for compilation?). Once my test-run has completed I will commit the patch. \\n\\n If we observe the deadlock also when the mode is DDL_MODE I don\'t see why we can\'t use NO_LOCK in all cases, since the code appears to be prepared to handle that the conglomerate is dropped under its feet. However, it seems safer to me to keep the change minimal for the time being.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13422393\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13422393&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13422393\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13422393_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13422393_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/12 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-25T16:39:40+0000\'\u003e25\\/Jul\\/12 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted patch \'derby4279_2.txt\' to trunk with revision 1365661.\u003cbr\\/\u003e\\nI plan to backport this patch in a while.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13422393_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13422393_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/12 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-25T16:39:40+0000\'\u003e25\\/Jul\\/12 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed patch \'derby4279_2.txt\' to trunk with revision 1365661. \\nI plan to backport this patch in a while.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13422398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13422398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13422398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13422398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13422398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/12 16:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-25T16:42:02+0000\'\u003e25\\/Jul\\/12 16:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThink I just found another keyboard shortcut or something... Reassigning back to Brett.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13422398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13422398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/12 16:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-25T16:42:02+0000\'\u003e25\\/Jul\\/12 16:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Think I just found another keyboard shortcut or something... Reassigning back to Brett.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13435837\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13435837&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13435837\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13435837_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13435837_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/12 08:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-16T08:26:19+0000\'\u003e16\\/Aug\\/12 08:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBackported the fix to 10.9 with revision 1373749.\u003cbr\\/\u003e\\nThe fix is pretty isolated, it may be possible to port it further back if anyone sees the need for that.\u003c\\/p\u003e\\n\\n\u003cp\u003eIssue ready for verification\\/closing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13435837_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13435837_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/12 08:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-16T08:26:19+0000\'\u003e16\\/Aug\\/12 08:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Backported the fix to 10.9 with revision 1373749. \\nThe fix is pretty isolated, it may be possible to port it further back if anyone sees the need for that. \\n\\n Issue ready for verification\\/closing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13449992\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13449992&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13449992\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"forcers\\\" id=\\\"commentauthor_13449992_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=forcers\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"forcers\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Force Rs\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13449992_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/12 19:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-06T19:54:56+0000\'\u003e06\\/Sep\\/12 19:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t think this fix is in 10.9.1.0.  If not, any idea when 10.9.1.1 will be released? \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"forcers\\\" id=\\\"commentauthor_13449992_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=forcers\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"forcers\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Force Rs\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13449992_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/12 19:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-06T19:54:56+0000\'\u003e06\\/Sep\\/12 19:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t think this fix is in 10.9.1.0.  If not, any idea when 10.9.1.1 will be released?               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13453872\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13453872&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13453872\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13453872_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13453872_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/12 09:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-12T09:56:52+0000\'\u003e12\\/Sep\\/12 09:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eReopening for back-port to the 10.8 branch (with 10.8.3 as a potential release vehicle).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13453872_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13453872_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/12 09:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-12T09:56:52+0000\'\u003e12\\/Sep\\/12 09:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Reopening for back-port to the 10.8 branch (with 10.8.3 as a potential release vehicle).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13454131\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=13454131&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13454131\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13454131_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13454131_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/12 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-12T17:09:39+0000\'\u003e12\\/Sep\\/12 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBack-ported fix to 10.8 with revision 1384037. I don\'t plan to go further back.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegarding a 10.9 maintenance release, I haven\'t seen anyone come forward to be release manager so I guess there are no plans right now.\u003cbr\\/\u003e\\nIt appears a 10.8 maintenance release is being planned, although no information has been added to the wiki yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"kristwaa\\\" id=\\\"commentauthor_13454131_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=kristwaa\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"kristwaa\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Kristian Waagan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13454131_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Sep\\/12 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-12T17:09:39+0000\'\u003e12\\/Sep\\/12 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Back-ported fix to 10.8 with revision 1384037. I don\'t plan to go further back. \\n\\n Regarding a 10.9 maintenance release, I haven\'t seen anyone come forward to be release manager so I guess there are no plans right now. \\nIt appears a 10.8 maintenance release is being planned, although no information has been added to the wiki yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14119605\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/DERBY-4279?focusedCommentId=14119605&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14119605\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_14119605_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14119605_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/14 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-09-03T08:31:36+0000\'\u003e03\\/Sep\\/14 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;bulk update&#93;\u003c\\/span\u003e Close all resolved issues that haven\'t been updated for more than one year.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"knutanders\\\" id=\\\"commentauthor_14119605_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=knutanders\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"knutanders\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Knut Anders Hatlen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14119605_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/14 08:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-09-03T08:31:36+0000\'\u003e03\\/Sep\\/14 08:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     &#91;bulk update&#93;  Close all resolved issues that haven\'t been updated for more than one year.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="10594";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=10594&amp;avatarId=10122\\\" alt=\\\"Derby\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/DERBY\\/summary\\\" title=\\\"Derby\\\"\u003eDerby\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/DERBY?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520239758994"> 
    <input type="hidden" title="jira.request.server.time" value="291"> 
    <input type="hidden" title="jira.request.id" value="529x94403120x3"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="2"> 
    <input type="hidden" title="db.reads.time.in.ms" value="59"> 
    <input type="hidden" title="db.conns.time.in.ms" value="80"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 529x94403120x3
	          REQUEST TIMESTAMP : [05/Mar/2018:08:49:18 +0000]
	               REQUEST TIME : 0.2910
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 2

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=36, elapsedTotal=59062074, elapsedMin=357332, elapsedMax=19742261, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=41, elapsedTotal=80264596, elapsedMin=388728, elapsedMax=19846738, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>