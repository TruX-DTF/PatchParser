<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|9254de1563e7843e288847ecb73c8a561c3e6dfe|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"b0e115d5534a4f\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-436"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-436] [PATCH] TermInfosReader, SegmentTermEnum Out Of Memory Exception - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-436] [PATCH] TermInfosReader, SegmentTermEnum Out Of Memory Exception - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-436">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-436" href="/jira/browse/LUCENE-436" id="key-val" rel="12317174">LUCENE-436</a></li>
                </ol>
                <h1 id="summary-val">[PATCH] TermInfosReader, SegmentTermEnum Out Of Memory Exception</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-436"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-436/LUCENE-436.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-436/LUCENE-436.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-436/LUCENE-436.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-436/LUCENE-436.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="1.4 ">1.4</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12317174-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value"> 
                    <p>Solaris JVM 1.4.1<br> Linux JVM 1.4.2/1.5.0<br> Windows not tested</p> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>We've been experiencing terrible memory problems on our production search server, running lucene (1.4.3).</p> 
                  <p>Our live app regularly opens new indexes and, in doing so, releases old IndexReaders for garbage collection.</p> 
                  <p>But...there appears to be a memory leak in org.apache.lucene.index.TermInfosReader.java.<br> Under certain conditions (possibly related to JVM version, although I've personally observed it under both linux JVM 1.4.2_06, and 1.5.0_03, and SUNOS JVM 1.4.1) the ThreadLocal member variable, "enumerators" doesn't get garbage-collected when the TermInfosReader object is gc-ed.</p> 
                  <p>Looking at the code in TermInfosReader.java, there's no reason why it <em>shouldn't</em> be gc-ed, so I can only presume (and I've seen this suggested elsewhere) that there could be a bug in the garbage collector of some JVMs.</p> 
                  <p>I've seen this problem briefly discussed; in particular at the following URL:<br> <a href="http://java2.5341.com/msg/85821.html" class="external-link" rel="nofollow">http://java2.5341.com/msg/85821.html</a><br> The patch that Doug recommended, which is included in lucene-1.4.3 doesn't work in our particular circumstances. Doug's patch only clears the ThreadLocal variable for the thread running the finalizer (my knowledge of java breaks down here - I'm not sure which thread actually runs the finalizer). In our situation, the TermInfosReader is (potentially) used by more than one thread, meaning that Doug's patch <em>doesn't</em> allow the affected JVMs to correctly collect garbage.</p> 
                  <p>So...I've devised a simple patch which, from my observations on linux JVMs 1.4.2_06, and 1.5.0_03, fixes this problem.</p> 
                  <p>Kieran<br> PS Thanks to daniel naber for pointing me to jira/lucene</p> 
                  <p>@@ -19,6 +19,7 @@<br> import java.io.IOException;</p> 
                  <p> import org.apache.lucene.store.Directory;<br> +import java.util.Hashtable;</p> 
                  <p> /** This stores a monotonically increasing set of &lt;Term, TermInfo&gt; pairs in a</p> 
                  <ul> 
                   <li>Directory. Pairs are accessed either by Term or by ordinal position the<br> @@ -29,7 +30,7 @@<br> private String segment;<br> private FieldInfos fieldInfos;</li> 
                  </ul> 
                  <ul class="alternate" type="square"> 
                   <li>private ThreadLocal enumerators = new ThreadLocal();<br> + private final Hashtable enumeratorsByThread = new Hashtable();<br> private SegmentTermEnum origEnum;<br> private long size;</li> 
                  </ul> 
                  <p>@@ -60,10 +61,10 @@<br> }</p> 
                  <p> private SegmentTermEnum getEnum() {</p> 
                  <ul class="alternate" type="square"> 
                   <li>SegmentTermEnum termEnum = (SegmentTermEnum)enumerators.get();<br> + SegmentTermEnum termEnum = (SegmentTermEnum)enumeratorsByThread.get(Thread.currentThread());<br> if (termEnum == null) { termEnum = terms(); - enumerators.set(termEnum); + enumeratorsByThread.put(Thread.currentThread(), termEnum); } <p> return termEnum;<br> }<br> @@ -195,5 +196,15 @@<br> public SegmentTermEnum terms(Term term) throws IOException </p> { get(term); return (SegmentTermEnum)getEnum().clone(); + } <p>+<br> + /* some jvms might have trouble gc-ing enumeratorsByThread */<br> + protected void finalize() throws Throwable </p> 
                    <div class="error">
                     <span class="error">Unknown macro: {+ try { + // make sure gc can clear up. + enumeratorsByThread.clear(); + } finally { + super.finalize(); + } }</span> 
                    </div> <p> }</p></li> 
                  </ul> 
                  <p>TermInfosReader.java, full source:<br> ======================================<br> package org.apache.lucene.index;</p> 
                  <p>/**</p> 
                  <ul> 
                   <li>Copyright 2004 The Apache Software Foundation<br> *</li> 
                   <li>Licensed under the Apache License, Version 2.0 (the "License");</li> 
                   <li>you may not use this file except in compliance with the License.</li> 
                   <li>You may obtain a copy of the License at<br> *</li> 
                   <li><a href="http://www.apache.org/licenses/LICENSE-2.0" class="external-link" rel="nofollow">http://www.apache.org/licenses/LICENSE-2.0</a><br> *</li> 
                   <li>Unless required by applicable law or agreed to in writing, software</li> 
                   <li>distributed under the License is distributed on an "AS IS" BASIS,</li> 
                   <li>WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</li> 
                   <li>See the License for the specific language governing permissions and</li> 
                   <li>limitations under the License.<br> */</li> 
                  </ul> 
                  <p>import java.io.IOException;</p> 
                  <p>import org.apache.lucene.store.Directory;<br> import java.util.Hashtable;</p> 
                  <p>/** This stores a monotonically increasing set of &lt;Term, TermInfo&gt; pairs in a</p> 
                  <ul> 
                   <li>Directory. Pairs are accessed either by Term or by ordinal position the</li> 
                   <li>set. */</li> 
                  </ul> 
                  <p>final class TermInfosReader {<br> private Directory directory;<br> private String segment;<br> private FieldInfos fieldInfos;</p> 
                  <p> private final Hashtable enumeratorsByThread = new Hashtable();<br> private SegmentTermEnum origEnum;<br> private long size;</p> 
                  <p> TermInfosReader(Directory dir, String seg, FieldInfos fis)<br> throws IOException </p> { directory = dir; segment = seg; fieldInfos = fis; origEnum = new SegmentTermEnum(directory.openFile(segment + ".tis"), fieldInfos, false); size = origEnum.size; readIndex(); } 
                  <p> public int getSkipInterval() </p> { return origEnum.skipInterval; } 
                  <p> final void close() throws IOException </p> { if (origEnum != null) origEnum.close(); } 
                  <p> /** Returns the number of term/value pairs in the set. */<br> final long size() </p> { return size; } 
                  <p> private SegmentTermEnum getEnum() {<br> SegmentTermEnum termEnum = (SegmentTermEnum)enumeratorsByThread.get(Thread.currentThread());<br> if (termEnum == null) </p> { termEnum = terms(); enumeratorsByThread.put(Thread.currentThread(), termEnum); } 
                  <p> return termEnum;<br> }</p> 
                  <p> Term[] indexTerms = null;<br> TermInfo[] indexInfos;<br> long[] indexPointers;</p> 
                  <p> private final void readIndex() throws IOException {<br> SegmentTermEnum indexEnum =<br> new SegmentTermEnum(directory.openFile(segment + ".tii"),<br> fieldInfos, true);<br> try {<br> int indexSize = (int)indexEnum.size;</p> 
                  <p> indexTerms = new Term<span class="error">[indexSize]</span>;<br> indexInfos = new TermInfo<span class="error">[indexSize]</span>;<br> indexPointers = new long<span class="error">[indexSize]</span>;</p> 
                  <p> for (int i = 0; indexEnum.next(); i++) </p> { indexTerms[i] = indexEnum.term(); indexInfos[i] = indexEnum.termInfo(); indexPointers[i] = indexEnum.indexPointer; } 
                  <p> } finally </p> { indexEnum.close(); } 
                  <p> }</p> 
                  <p> /** Returns the offset of the greatest index entry which is less than or equal to term.*/<br> private final int getIndexOffset(Term term) throws IOException {<br> int lo = 0; // binary search indexTerms[]<br> int hi = indexTerms.length - 1;</p> 
                  <p> while (hi &gt;= lo) </p> { int mid = (lo + hi) &gt;&gt; 1; int delta = term.compareTo(indexTerms[mid]); if (delta &lt; 0) hi = mid - 1; else if (delta &gt; 0) lo = mid + 1; else return mid; } 
                  <p> return hi;<br> }</p> 
                  <p> private final void seekEnum(int indexOffset) throws IOException </p> { getEnum().seek(indexPointers[indexOffset], (indexOffset * getEnum().indexInterval) - 1, indexTerms[indexOffset], indexInfos[indexOffset]); } 
                  <p> /** Returns the TermInfo for a Term in the set, or null. */<br> TermInfo get(Term term) throws IOException {<br> if (size == 0) return null;</p> 
                  <p> // optimize sequential access: first try scanning cached enum w/o seeking<br> SegmentTermEnum enumerator = getEnum();<br> if (enumerator.term() != null // term is at or past current<br> &amp;&amp; ((enumerator.prev != null &amp;&amp; term.compareTo(enumerator.prev) &gt; 0)</p> 
                  <div class="table-wrap"> 
                   <table class="confluenceTable">
                    <tbody> 
                     <tr> 
                      <th class="confluenceTh"> term.compareTo(enumerator.term()) &gt;= 0)) { int enumOffset = (int)(enumerator.position/enumerator.indexInterval)+1; if (indexTerms.length == enumOffset // but before end of block || term.compareTo(indexTerms[enumOffset]) &lt; 0) return scanEnum(term); // no need to seek }</th> 
                     </tr> 
                    </tbody>
                   </table> 
                  </div> 
                  <p> // random-access: must seek<br> seekEnum(getIndexOffset(term));<br> return scanEnum(term);<br> }</p> 
                  <p> /** Scans within block for matching term. */<br> private final TermInfo scanEnum(Term term) throws IOException {<br> SegmentTermEnum enumerator = getEnum();<br> while (term.compareTo(enumerator.term()) &gt; 0 &amp;&amp; enumerator.next()) {}<br> if (enumerator.term() != null &amp;&amp; term.compareTo(enumerator.term()) == 0)<br> return enumerator.termInfo();<br> else<br> return null;<br> }</p> 
                  <p> /** Returns the nth term in the set. */<br> final Term get(int position) throws IOException </p> { if (size == 0) return null; SegmentTermEnum enumerator = getEnum(); if (enumerator != null &amp;&amp; enumerator.term() != null &amp;&amp; position &gt;= enumerator.position &amp;&amp; position &lt; (enumerator.position + enumerator.indexInterval)) return scanEnum(position); // can avoid seek seekEnum(position / enumerator.indexInterval); // must seek return scanEnum(position); } 
                  <p> private final Term scanEnum(int position) throws IOException </p> { SegmentTermEnum enumerator = getEnum(); while(enumerator.position &lt; position) if (!enumerator.next()) return null; return enumerator.term(); } 
                  <p> /** Returns the position of a Term in the set or -1. */<br> final long getPosition(Term term) throws IOException {<br> if (size == 0) return -1;</p> 
                  <p> int indexOffset = getIndexOffset(term);<br> seekEnum(indexOffset);</p> 
                  <p> SegmentTermEnum enumerator = getEnum();<br> while(term.compareTo(enumerator.term()) &gt; 0 &amp;&amp; enumerator.next()) {}</p> 
                  <p> if (term.compareTo(enumerator.term()) == 0)<br> return enumerator.position;<br> else<br> return -1;<br> }</p> 
                  <p> /** Returns an enumeration of all the Terms and TermInfos in the set. */<br> public SegmentTermEnum terms() </p> { return (SegmentTermEnum)origEnum.clone(); } 
                  <p> /** Returns an enumeration of terms starting at or after the named term. */<br> public SegmentTermEnum terms(Term term) throws IOException </p> { get(term); return (SegmentTermEnum)getEnum().clone(); } 
                  <p> /* some jvms might have trouble gc-ing enumeratorsByThread */ <br> protected void finalize() throws Throwable {<br> try </p> { // make sure gc can clear up. enumeratorsByThread.clear(); } 
                  <p> finally </p> { super.finalize(); } 
                  <p> }<br> }</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-436?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-436?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-436?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-436?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326231" data-issue-id="12317174" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326231/FixedThreadLocal.java" draggable="true" data-downloadurl="text/x-java:FixedThreadLocal.java:https://issues.apache.org/jira/secure/attachment/12326231/FixedThreadLocal.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326231/FixedThreadLocal.java" title="Latest  04/May/06 10:27 - robert engels" draggable="true" data-downloadurl="text/x-java:FixedThreadLocal.java:https://issues.apache.org/jira/secure/attachment/12326231/FixedThreadLocal.java">FixedThreadLocal.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-04T10:27:21.000Z">04/May/06 10:27</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    robert engels
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326590" data-issue-id="12317174" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326590/lucene-1.9.1.patch" draggable="true" data-downloadurl="text/x-patch:lucene-1.9.1.patch:https://issues.apache.org/jira/secure/attachment/12326590/lucene-1.9.1.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326590/lucene-1.9.1.patch" title="Latest  12/May/06 05:08 - Fernando Padilla" draggable="true" data-downloadurl="text/x-patch:lucene-1.9.1.patch:https://issues.apache.org/jira/secure/attachment/12326590/lucene-1.9.1.patch">lucene-1.9.1.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-12T05:08:13.000Z">12/May/06 05:08</time>
                   </dd>
                   <dd class="attachment-size">
                    58 kB
                   </dd>
                   <dd class="attachment-author">
                    Fernando Padilla
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12347533" data-issue-id="12317174" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12347533/LUCENE-436.patch" draggable="true" data-downloadurl="text/plain:LUCENE-436.patch:https://issues.apache.org/jira/secure/attachment/12347533/LUCENE-436.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12347533/LUCENE-436.patch" title="Latest  20/Dec/06 03:43 - Otis Gospodnetic" draggable="true" data-downloadurl="text/plain:LUCENE-436.patch:https://issues.apache.org/jira/secure/attachment/12347533/LUCENE-436.patch">LUCENE-436.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-12-20T03:43:41.000Z">20/Dec/06 03:43</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Otis Gospodnetic
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326145" data-issue-id="12317174" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326145/Lucene-436-TestCase.tar.gz" draggable="true" data-downloadurl="application/x-gzip:Lucene-436-TestCase.tar.gz:https://issues.apache.org/jira/secure/attachment/12326145/Lucene-436-TestCase.tar.gz"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326145/Lucene-436-TestCase.tar.gz" title="Latest  02/May/06 18:58 - kieran" draggable="true" data-downloadurl="application/x-gzip:Lucene-436-TestCase.tar.gz:https://issues.apache.org/jira/secure/attachment/12326145/Lucene-436-TestCase.tar.gz">Lucene-436-TestCase.tar.gz</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-02T18:58:02.000Z">02/May/06 18:58</time>
                   </dd>
                   <dd class="attachment-size">
                    575 kB
                   </dd>
                   <dd class="attachment-author">
                    kieran
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326257" data-issue-id="12317174" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326257/TermInfosReader.java" draggable="true" data-downloadurl="text/x-java:TermInfosReader.java:https://issues.apache.org/jira/secure/attachment/12326257/TermInfosReader.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326257/TermInfosReader.java" title="Latest  05/May/06 00:57 - robert engels" draggable="true" data-downloadurl="text/x-java:TermInfosReader.java:https://issues.apache.org/jira/secure/attachment/12326257/TermInfosReader.java">TermInfosReader.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-05T00:57:03.000Z">05/May/06 00:57</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    robert engels
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12326232" data-issue-id="12317174" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12326232/ThreadLocalTest.java" draggable="true" data-downloadurl="text/x-java:ThreadLocalTest.java:https://issues.apache.org/jira/secure/attachment/12326232/ThreadLocalTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12326232/ThreadLocalTest.java" title="Latest  04/May/06 10:53 - robert engels" draggable="true" data-downloadurl="text/x-java:ThreadLocalTest.java:https://issues.apache.org/jira/secure/attachment/12326232/ThreadLocalTest.java">ThreadLocalTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-05-04T10:53:23.000Z">04/May/06 10:53</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    robert engels
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_otis" rel="otis" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Otis Gospodnetic&quot;,&quot;emailAddress&quot;:&quot;otis@apache.org&quot;,&quot;username&quot;:&quot;otis&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="otis"></span></span> Otis Gospodnetic </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_ktopping" rel="ktopping" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;kieran&quot;,&quot;emailAddress&quot;:&quot;kieran@kitsite.com&quot;,&quot;username&quot;:&quot;ktopping&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="ktopping"></span></span> kieran </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">4</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">6</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="22/Sep/05 00:40"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2005-09-22T00:40:29+0000">22/Sep/05 00:40</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="20/Dec/06 20:28"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2006-12-20T20:28:16+0000">20/Dec/06 20:28</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="20/Dec/06 20:28"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2006-12-20T20:28:16+0000">20/Dec/06 20:28</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-436?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-436?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12362382\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12362382&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12362382\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fmar\\\" id=\\\"commentauthor_12362382_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fmar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fmar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Martins\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362382_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/06 07:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-11T07:28:38+0000\'\u003e11\\/Jan\\/06 07:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m also having memory leaking when doing simple Searches using lucene CVS checkout from 2006-01-10\u003cbr\\/\u003e\\nI\'m using jrockit-jdk1.5.0_03.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve tried with this patch, and my simple search test STOPPED leaking.\u003cbr\\/\u003e\\nMaybe it does depend on the JVM version.\u003cbr\\/\u003e\\nI\'ll try on our application this patch to see if it stops leaking.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fmar\\\" id=\\\"commentauthor_12362382_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fmar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fmar\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Martins\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362382_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/06 07:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-11T07:28:38+0000\'\u003e11\\/Jan\\/06 07:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m also having memory leaking when doing simple Searches using lucene CVS checkout from 2006-01-10 \\nI\'m using jrockit-jdk1.5.0_03. \\n\\n I\'ve tried with this patch, and my simple search test STOPPED leaking. \\nMaybe it does depend on the JVM version. \\nI\'ll try on our application this patch to see if it stops leaking. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377238\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377238&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377238\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377238_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377238_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/May\\/06 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-01T23:15:34+0000\'\u003e01\\/May\\/06 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will be trying this patch on Lucene 1.9.1 to see if it fixes my production memory leak with Tomcat 5.5.15 \\/ Redhat \\/ Java 1.5.0_06.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377238_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377238_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/May\\/06 23:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-01T23:15:34+0000\'\u003e01\\/May\\/06 23:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will be trying this patch on Lucene 1.9.1 to see if it fixes my production memory leak with Tomcat 5.5.15 \\/ Redhat \\/ Java 1.5.0_06.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/May\\/06 23:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-01T23:37:29+0000\'\u003e01\\/May\\/06 23:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe bug is invalid, as was pointed out on the lucene-dev list.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen the thread dies, all thread locals will be cleaned-up.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf the thread does not die, the thread-locals are still cleaned-up PERIODICALLY. And the value is always cleaned up - since it is held in a WeakReference, the only things that \\\"hangs around\\\" is the key - which consumes VERYL LITTLE memory.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe submitter should be able to provide a testcase that demonstrate the ThreadLocal bug. The one provided with bug 529 is invalid (as was pointed out on the dev email thread).\u003c\\/p\u003e\\n\\n\u003cp\u003eIMHO, there is NO BUG HERE. The users are ding something else that is causing a OOM.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis bug should be closed as invalid.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/May\\/06 23:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-01T23:37:29+0000\'\u003e01\\/May\\/06 23:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The bug is invalid, as was pointed out on the lucene-dev list. \\n\\n When the thread dies, all thread locals will be cleaned-up. \\n\\n If the thread does not die, the thread-locals are still cleaned-up PERIODICALLY. And the value is always cleaned up - since it is held in a WeakReference, the only things that \\\"hangs around\\\" is the key - which consumes VERYL LITTLE memory. \\n\\n The submitter should be able to provide a testcase that demonstrate the ThreadLocal bug. The one provided with bug 529 is invalid (as was pointed out on the dev email thread). \\n\\n IMHO, there is NO BUG HERE. The users are ding something else that is causing a OOM. \\n\\n This bug should be closed as invalid.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377243\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377243&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377243\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377243_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377243_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/May\\/06 23:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-01T23:39:35+0000\'\u003e01\\/May\\/06 23:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe finalize() method should be removed from the Segment\\/Term readers.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn most cases this will actually make things worse, as the objects will need to stay around until the finalizer thread can run.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377243_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377243_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/May\\/06 23:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-01T23:39:35+0000\'\u003e01\\/May\\/06 23:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The finalize() method should be removed from the Segment\\/Term readers. \\n\\n In most cases this will actually make things worse, as the objects will need to stay around until the finalizer thread can run.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377385\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377385&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377385\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ktopping\\\" id=\\\"commentauthor_12377385_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ktopping\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ktopping\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e kieran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377385_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/May\\/06 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-02T18:55:53+0000\'\u003e02\\/May\\/06 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have created a test that exhibits the above-discussed problem.\u003cbr\\/\u003e\\nPlease note, I don\'t think it should necessarily be called a \\\"Lucene\\\" bug, as the lucene source is written in a way that \\/should\\/ work. It\'s more likely to be a JVM bug, I think.\u003cbr\\/\u003e\\nPlease note, I have seen this bug in SUN Hotspot JVM 1.4.2 on Linux. I will shortly be trying some other JVMs and platforms, but - for the time being - this test should only be run against such an environment.\u003cbr\\/\u003e\\nWhile developing this test, it also became apparent that the bug only exhibits itself when using a RAMDirectory as the source for an IndexSearcher.\u003cbr\\/\u003e\\nI will shortly attach the test to this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ktopping\\\" id=\\\"commentauthor_12377385_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ktopping\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ktopping\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e kieran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377385_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/May\\/06 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-02T18:55:53+0000\'\u003e02\\/May\\/06 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have created a test that exhibits the above-discussed problem. \\nPlease note, I don\'t think it should necessarily be called a \\\"Lucene\\\" bug, as the lucene source is written in a way that \\/should\\/ work. It\'s more likely to be a JVM bug, I think. \\nPlease note, I have seen this bug in SUN Hotspot JVM 1.4.2 on Linux. I will shortly be trying some other JVMs and platforms, but - for the time being - this test should only be run against such an environment. \\nWhile developing this test, it also became apparent that the bug only exhibits itself when using a RAMDirectory as the source for an IndexSearcher. \\nI will shortly attach the test to this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377386\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377386&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377386\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ktopping\\\" id=\\\"commentauthor_12377386_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ktopping\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ktopping\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e kieran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377386_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/May\\/06 18:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-02T18:58:02+0000\'\u003e02\\/May\\/06 18:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003etest case for recreating this issue on (at least) sun jvm hotspot 1.4.2 on linux\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ktopping\\\" id=\\\"commentauthor_12377386_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ktopping\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ktopping\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e kieran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377386_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/May\\/06 18:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-02T18:58:02+0000\'\u003e02\\/May\\/06 18:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    test case for recreating this issue on (at least) sun jvm hotspot 1.4.2 on linux              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377604\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377604&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377604\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377604_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377604_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T01:24:17+0000\'\u003e04\\/May\\/06 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree with robert engels about the finalize method being taken out of the class.  In fact, the finalize method is run by the finalizer thread, and by setting the value to null in that thread, it effectively creates one more entry in the Thread threadLocals map.  This can only hurt the class and performance.  I\'m still investigating to why the memory leak occurs though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377604_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377604_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T01:24:17+0000\'\u003e04\\/May\\/06 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree with robert engels about the finalize method being taken out of the class.  In fact, the finalize method is run by the finalizer thread, and by setting the value to null in that thread, it effectively creates one more entry in the Thread threadLocals map.  This can only hurt the class and performance.  I\'m still investigating to why the memory leak occurs though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377607\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377607&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377607\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377607_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377607_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 01:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T01:34:03+0000\'\u003e04\\/May\\/06 01:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003efwiw, we have done EXTENSIVE memory profiling of the low-level Lucene (and JVM) routines.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt is my opinion that there are no memory leaks in either.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn every case that we \\\"found\\\" a memory leak, it always ended up tied back to something we were doing wrong on our client code.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377607_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377607_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 01:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T01:34:03+0000\'\u003e04\\/May\\/06 01:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    fwiw, we have done EXTENSIVE memory profiling of the low-level Lucene (and JVM) routines. \\n\\n It is my opinion that there are no memory leaks in either. \\n\\n In every case that we \\\"found\\\" a memory leak, it always ended up tied back to something we were doing wrong on our client code.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377623\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377623&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377623\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377623_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377623_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 03:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T03:32:38+0000\'\u003e04\\/May\\/06 03:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003erobert engels is \u003cb\u003eincorrect\u003c\\/b\u003e in that there isn\'t a memory leak with Lucene.  The test case made by kieran demonstrates the memory leak quite well on my machine for the following setup:\u003c\\/p\u003e\\n\\n\u003cp\u003eLucene 1.9.1\u003cbr\\/\u003e\\nSun JDK 1.5.0_06\u003cbr\\/\u003e\\nJVM Args: -Xmx4M (low memory to get the unit test to fail faster)\u003cbr\\/\u003e\\nWindows XP Pro\u003c\\/p\u003e\\n\\n\u003cp\u003eThe test case will fail on my machine with i = 2006 and useRamDirectory set to true (as indicated by kieran, this point is important).\u003c\\/p\u003e\\n\\n\u003cp\u003eFurthermore, by changing the enumerators declaration to:\u003c\\/p\u003e\\n\\n\u003cp\u003e  private Map enumerators = Collections.synchronizedMap(new WeakHashMap());\u003c\\/p\u003e\\n\\n\u003cp\u003eand the getEnum method to:\u003c\\/p\u003e\\n\\n\u003cp\u003e  private SegmentTermEnum getEnum() {\u003cbr\\/\u003e\\n    Thread currentThread = Thread.currentThread();\u003cbr\\/\u003e\\n    SegmentTermEnum termEnum = (SegmentTermEnum)enumerators.get(currentThread);\u003cbr\\/\u003e\\n    if (termEnum == null) \u003c\\/p\u003e\\n{\\n      termEnum = terms();\\n      enumerators.put(currentThread, termEnum);\\n    }\\n\u003cp\u003e    return termEnum;\u003cbr\\/\u003e\\n  }\u003c\\/p\u003e\\n\\n\u003cp\u003e(note that I\'m not suggesting that my changes be used for the official patch)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem dissapears, and the unit test completes.  I vote that this bug be bumped to critical in priority and a fix be included for the Lucene 1.9.2 release and perhaps a patch be made for the 1.4.3 release for those who need it.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor further reading on the perils of ThreadLocal I suggest the following reading:\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/www.me.umn.edu\\/~shivane\\/blogs\\/cafefeed\\/2004\\/06\\/of-non-static-threadlocals-and-memory.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.me.umn.edu\\/~shivane\\/blogs\\/cafefeed\\/2004\\/06\\/of-non-static-threadlocals-and-memory.html\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.szegedi.org\\/articles\\/memleak.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.szegedi.org\\/articles\\/memleak.html\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/crazybob.org\\/2006\\/02\\/threadlocal-memory-leak.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/crazybob.org\\/2006\\/02\\/threadlocal-memory-leak.html\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/opensource.atlassian.com\\/confluence\\/spring\\/pages\\/viewpage.action?pageId=2669\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/opensource.atlassian.com\\/confluence\\/spring\\/pages\\/viewpage.action?pageId=2669\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377623_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377623_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 03:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T03:32:38+0000\'\u003e04\\/May\\/06 03:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    robert engels is  incorrect  in that there isn\'t a memory leak with Lucene.  The test case made by kieran demonstrates the memory leak quite well on my machine for the following setup: \\n\\n Lucene 1.9.1 \\nSun JDK 1.5.0_06 \\nJVM Args: -Xmx4M (low memory to get the unit test to fail faster) \\nWindows XP Pro \\n\\n The test case will fail on my machine with i = 2006 and useRamDirectory set to true (as indicated by kieran, this point is important). \\n\\n Furthermore, by changing the enumerators declaration to: \\n\\n   private Map enumerators = Collections.synchronizedMap(new WeakHashMap()); \\n\\n and the getEnum method to: \\n\\n   private SegmentTermEnum getEnum() { \\n    Thread currentThread = Thread.currentThread(); \\n    SegmentTermEnum termEnum = (SegmentTermEnum)enumerators.get(currentThread); \\n    if (termEnum == null)  \\n{\\n      termEnum = terms();\\n      enumerators.put(currentThread, termEnum);\\n    }\\n     return termEnum; \\n  } \\n\\n (note that I\'m not suggesting that my changes be used for the official patch) \\n\\n The problem dissapears, and the unit test completes.  I vote that this bug be bumped to critical in priority and a fix be included for the Lucene 1.9.2 release and perhaps a patch be made for the 1.4.3 release for those who need it. \\n\\n For further reading on the perils of ThreadLocal I suggest the following reading: \\n\\n  http:\\/\\/www.me.umn.edu\\/~shivane\\/blogs\\/cafefeed\\/2004\\/06\\/of-non-static-threadlocals-and-memory.html  \\n http:\\/\\/www.szegedi.org\\/articles\\/memleak.html  \\n http:\\/\\/crazybob.org\\/2006\\/02\\/threadlocal-memory-leak.html  \\n http:\\/\\/opensource.atlassian.com\\/confluence\\/spring\\/pages\\/viewpage.action?pageId=2669               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377628\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377628&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377628\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377628_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377628_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 03:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T03:51:48+0000\'\u003e04\\/May\\/06 03:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree that the test case does fail, so I was wrong. There is \\\"something\\\" broken in Lucene or the JDK.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is the JDK bug that was fixed that allows it to work under 1.5? The proposed patch is nearly exactly the implementation of ThreadLocal, so I am not sure how it would fix the problem?\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I ran it under the profiler, it seems to work correctly. I still it may have something to do with finalizers preventing GC when it needs it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377628_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377628_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 03:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T03:51:48+0000\'\u003e04\\/May\\/06 03:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree that the test case does fail, so I was wrong. There is \\\"something\\\" broken in Lucene or the JDK. \\n\\n What is the JDK bug that was fixed that allows it to work under 1.5? The proposed patch is nearly exactly the implementation of ThreadLocal, so I am not sure how it would fix the problem? \\n\\n When I ran it under the profiler, it seems to work correctly. I still it may have something to do with finalizers preventing GC when it needs it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377631\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377631&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377631\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377631_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377631_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 03:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T03:59:50+0000\'\u003e04\\/May\\/06 03:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe problem is apparent on my machine with JDK 1.5, so basically this bug shows up, regardless of JDK version.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve looked at the source for ThreadLocal, and there\'s a custom implementation of a map being used which is a bit scarry.  However, you\'d figure they tested the hell out of it, including instance count verification with the garbage collector.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we assume the code for ThreadLocal is correct, then the only idea I have is that the value, a SegmentTermEnum has a reference chain back to the ThreadLocal in someway, which would prevent the ThreadLocal key in the inner map from being collected.  However, I can\'t seem to show that being true.  I\'ve even tried not using the .clone method thinking there might be something fishy with that, but nothing came out of that.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377631_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377631_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 03:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T03:59:50+0000\'\u003e04\\/May\\/06 03:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The problem is apparent on my machine with JDK 1.5, so basically this bug shows up, regardless of JDK version. \\n\\n I\'ve looked at the source for ThreadLocal, and there\'s a custom implementation of a map being used which is a bit scarry.  However, you\'d figure they tested the hell out of it, including instance count verification with the garbage collector. \\n\\n If we assume the code for ThreadLocal is correct, then the only idea I have is that the value, a SegmentTermEnum has a reference chain back to the ThreadLocal in someway, which would prevent the ThreadLocal key in the inner map from being collected.  However, I can\'t seem to show that being true.  I\'ve even tried not using the .clone method thinking there might be something fishy with that, but nothing came out of that.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377636\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377636&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377636\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377636_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377636_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 04:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T04:13:53+0000\'\u003e04\\/May\\/06 04:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis type of ThreadLocal (anti?)pattern also seems to be present in SegmentReader.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377636_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377636_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 04:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T04:13:53+0000\'\u003e04\\/May\\/06 04:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This type of ThreadLocal (anti?)pattern also seems to be present in SegmentReader.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377642\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377642&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377642\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377642_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377642_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 04:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T04:45:56+0000\'\u003e04\\/May\\/06 04:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt works fine for me under 1.5.0_06.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have determined the problem with the ThreadLocal code in 1.4.2. The entries in the ThreadLocalMap extend WeakReference (holding a weak ref to the key which is the ThreadLocal), but also contain a HARD reference to the value (the thread local value - which in this case can be quite large).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn JDK 1.4.2, the entries are only cleaned-up if a hit occurs and the ThreadLocalMap determines that the entry is stale (the key has been reclaimed), and at this point the entry is reused for the new ThreadLocal. If no hits ever occur (or it keeps hiiting the same entry), the number of entries in the table will become unbounded.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn JDK 1.5, the ThreadLocal code periodically clean-ups SOME stale ThreadLocals during each invocation - using cleanSomeSlots().\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is why using the proposed patch works - it uses a standard WeakHashMap which expunges ALL stale entries on nearly every operation.\u003c\\/p\u003e\\n\\n\u003cp\u003eI will look into creating a derived ThreadLocal that works properly. Or we can just package the proposed patch into a FixedThreadLocal. I don\'t know what the Lucene dev policies are on \\\"fixing\\\" JDK problems. Seems to me a FixedThreadLocal is the best solution.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377642_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377642_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 04:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T04:45:56+0000\'\u003e04\\/May\\/06 04:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It works fine for me under 1.5.0_06. \\n\\n I have determined the problem with the ThreadLocal code in 1.4.2. The entries in the ThreadLocalMap extend WeakReference (holding a weak ref to the key which is the ThreadLocal), but also contain a HARD reference to the value (the thread local value - which in this case can be quite large). \\n\\n In JDK 1.4.2, the entries are only cleaned-up if a hit occurs and the ThreadLocalMap determines that the entry is stale (the key has been reclaimed), and at this point the entry is reused for the new ThreadLocal. If no hits ever occur (or it keeps hiiting the same entry), the number of entries in the table will become unbounded. \\n\\n In JDK 1.5, the ThreadLocal code periodically clean-ups SOME stale ThreadLocals during each invocation - using cleanSomeSlots(). \\n\\n This is why using the proposed patch works - it uses a standard WeakHashMap which expunges ALL stale entries on nearly every operation. \\n\\n I will look into creating a derived ThreadLocal that works properly. Or we can just package the proposed patch into a FixedThreadLocal. I don\'t know what the Lucene dev policies are on \\\"fixing\\\" JDK problems. Seems to me a FixedThreadLocal is the best solution.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 10:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T10:27:21+0000\'\u003e04\\/May\\/06 10:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThreadLocal replacement that avoids memory leak\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 10:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T10:27:21+0000\'\u003e04\\/May\\/06 10:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    ThreadLocal replacement that avoids memory leak              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377688\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377688&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377688\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377688_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377688_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 10:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T10:40:21+0000\'\u003e04\\/May\\/06 10:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI posted FixedThreadLocal.java. Changed Lucene to use this class instead of ThreadLocal. Test case runs fine under 1.4.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe performance difference appears almost non existent. I think this is because in typical Lucene usage the number of invocations is quite small.\u003c\\/p\u003e\\n\\n\u003cp\u003eA better multi-threaded version is also possible, using a WeakHashMap for each thread, containing the FixedThreadLocals for that thread. This would minimize the length of the synchronization required.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn either case, the finalize methods should be removed. This contributes greatly to the problems with the current code. In fact, it does nothing, since if the object was finalizable, then its reference would have already been reclaimed from the ThreadLocalMap, so having the finalize method actually slows this process. (I removed the finalized methods from Lucene - test case runs fine).\u003c\\/p\u003e\\n\\n\u003cp\u003eBUT, this problem is not as severe as it appears.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe main reason that this becomes an issue with JDK 1.4 and the testcase, is that the size of the objects being put into the ThreadLocal, since the RAMDirectory has a complete copy of the index. In most uses this will not be the case, and the objects will be reclaimed eventually, as the ThreadLocalMap size stabalizes. The bug in ThreadLocal allows a certain number of stale entries, once the index size gets to 300k, a max of 30 entries can be stale without running out of memory.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377688_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377688_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 10:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T10:40:21+0000\'\u003e04\\/May\\/06 10:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I posted FixedThreadLocal.java. Changed Lucene to use this class instead of ThreadLocal. Test case runs fine under 1.4. \\n\\n The performance difference appears almost non existent. I think this is because in typical Lucene usage the number of invocations is quite small. \\n\\n A better multi-threaded version is also possible, using a WeakHashMap for each thread, containing the FixedThreadLocals for that thread. This would minimize the length of the synchronization required. \\n\\n In either case, the finalize methods should be removed. This contributes greatly to the problems with the current code. In fact, it does nothing, since if the object was finalizable, then its reference would have already been reclaimed from the ThreadLocalMap, so having the finalize method actually slows this process. (I removed the finalized methods from Lucene - test case runs fine). \\n\\n BUT, this problem is not as severe as it appears. \\n\\n The main reason that this becomes an issue with JDK 1.4 and the testcase, is that the size of the objects being put into the ThreadLocal, since the RAMDirectory has a complete copy of the index. In most uses this will not be the case, and the objects will be reclaimed eventually, as the ThreadLocalMap size stabalizes. The bug in ThreadLocal allows a certain number of stale entries, once the index size gets to 300k, a max of 30 entries can be stale without running out of memory.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377694\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377694&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377694\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377694_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377694_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 10:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T10:53:23+0000\'\u003e04\\/May\\/06 10:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003edemonstrate thread local memory leak\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377694_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377694_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 10:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T10:53:23+0000\'\u003e04\\/May\\/06 10:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    demonstrate thread local memory leak              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377697\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377697&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377697\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377697_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377697_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 11:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T11:00:23+0000\'\u003e04\\/May\\/06 11:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI posted ThreadLocalTest.java that clearly demonstrates the \\\"problem\\\" with JDK 1.4.\u003c\\/p\u003e\\n\\n\u003cp\u003eBUT, it also demonstrates the problem with the test case.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you run the test with -Xmx4m it will fail quickly under JDK 1.4.2.\u003cbr\\/\u003e\\nIf you run the test as is under JDK 1.5 with the same memory constraints it will run forever.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the same memory constraints, if you change the test to use FixedThreadLocal it will run forever.\u003c\\/p\u003e\\n\\n\u003cp\u003eBUT, if you run the test with -Xmx64m under JDK 1.4.2 it will run forever! This is because the ThreadLocalMap size stablizes.\u003c\\/p\u003e\\n\\n\u003cp\u003eThus, unless you are creating and accessing large RAMDirectories you will never experience the problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this bug should be closed as invalid. BUT, the finalizer() methods should be removed from the Lucene code since it does no good, and actually slows the system by delaying the GC.\u003c\\/p\u003e\\n\\n\u003cp\u003eHopefully this ends the issue, and we can move on to other things.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377697_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377697_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 11:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T11:00:23+0000\'\u003e04\\/May\\/06 11:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I posted ThreadLocalTest.java that clearly demonstrates the \\\"problem\\\" with JDK 1.4. \\n\\n BUT, it also demonstrates the problem with the test case. \\n\\n If you run the test with -Xmx4m it will fail quickly under JDK 1.4.2. \\nIf you run the test as is under JDK 1.5 with the same memory constraints it will run forever. \\n\\n With the same memory constraints, if you change the test to use FixedThreadLocal it will run forever. \\n\\n BUT, if you run the test with -Xmx64m under JDK 1.4.2 it will run forever! This is because the ThreadLocalMap size stablizes. \\n\\n Thus, unless you are creating and accessing large RAMDirectories you will never experience the problem. \\n\\n I think this bug should be closed as invalid. BUT, the finalizer() methods should be removed from the Lucene code since it does no good, and actually slows the system by delaying the GC. \\n\\n Hopefully this ends the issue, and we can move on to other things.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377701\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377701&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377701\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377701_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377701_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 11:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T11:06:01+0000\'\u003e04\\/May\\/06 11:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust for my own \\\"pat on the back\\\", it goes back to what I said in the earliest comment.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere is NOT a memory leak in Lucene or JDK 1.4.2 or Lucene.\u003c\\/p\u003e\\n\\n\u003cp\u003eJDK 1.4.2 made a performance vs. memory size decision that works in most cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the submitters case their deisgn decision does not work so well (combination of size of ThreadLocal values and maximum heap size).\u003c\\/p\u003e\\n\\n\u003cp\u003eWith JDK 1.5, they chose an alternative implementation that is SLOWER, but the memory requirements in the general case are smaller, and deterministic.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere will ALWAYS be design decisions like this in ALL software development.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377701_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377701_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 11:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T11:06:01+0000\'\u003e04\\/May\\/06 11:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just for my own \\\"pat on the back\\\", it goes back to what I said in the earliest comment. \\n\\n There is NOT a memory leak in Lucene or JDK 1.4.2 or Lucene. \\n\\n JDK 1.4.2 made a performance vs. memory size decision that works in most cases. \\n\\n In the submitters case their deisgn decision does not work so well (combination of size of ThreadLocal values and maximum heap size). \\n\\n With JDK 1.5, they chose an alternative implementation that is SLOWER, but the memory requirements in the general case are smaller, and deterministic. \\n\\n There will ALWAYS be design decisions like this in ALL software development.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377764\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377764&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377764\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andyhind\\\" id=\\\"commentauthor_12377764_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andyhind\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andyhind\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andy Hind\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377764_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 17:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T17:40:28+0000\'\u003e04\\/May\\/06 17:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI agree this is not strictly an issue with lucene....but .....\u003c\\/p\u003e\\n\\n\u003cp\u003eLucene has an unusual use pattern for thread locals (instance vs static member variables).\u003cbr\\/\u003e\\nThere are issues with ThreadLocal, discussed here and elsewhere, including potential instability.\u003cbr\\/\u003e\\nYou should expect others to use thread locals - maybe in the same way.\u003c\\/p\u003e\\n\\n\u003cp\u003eI fixed the issue reported in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-529\\\" title=\\\"TermInfosReader and other + instance ThreadLocal =&gt; transient\\/odd memory leaks =&gt;  OutOfMemoryException\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-529\\\"\u003e\u003cdel\u003eLUCENE-529\u003c\\/del\u003e\u003c\\/a\u003e with memory sensitive caching using SoftReferences to the values held as ThreadLocals.\u003cbr\\/\u003e\\nBefore an out of memory error, the values are cleared and hard refs to the soft reference wrapper class remain.\u003cbr\\/\u003e\\nThis pattern is used by some classes in the JVM.\u003cbr\\/\u003e\\nThis limits the memory overhead with thread local use. \u003cbr\\/\u003e\\nThere will always be some overhead.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am happy with the alternative fix using WeakHashMap\u003cbr\\/\u003e\\nNote: stale entries are always scanned and removed (each call to put, get, size) in contrast to thread locals. \u003cbr\\/\u003e\\nThis is what I want - it must be stable!\u003c\\/p\u003e\\n\\n\u003cp\u003eI spent as much time as I could trying to come up with a clear, simple test case that applied regardless of memory constraints.\u003cbr\\/\u003e\\nA clear failure case must be possible, but I did not have time to investigate the criteria for ThreadLocal instability.\u003cbr\\/\u003e\\nIn any case, I would send this to Sun.\u003c\\/p\u003e\\n\\n\u003cp\u003eA test case is one thing, knowning, understanding and fixing\\/working around an issue is another.\u003cbr\\/\u003e\\nIn all the simple cases I tried I got stability but with higher memory use and gc activity than with the \\\"fixed\\\" version.\u003cbr\\/\u003e\\nHowever, I did also remove the pointless finalize() method, which could very well explain the growth of the thread local table.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe have had problems with 1.5.0_06. The issue is caused by the pattern of thread local use and garbage collection producing instability in the size of the thread local table. Your single test case does not imply that the issue does not exist for other JVMs and use cases.  I have had the issue without using RAMDirectory - it seems it is just more likely with it.\u003c\\/p\u003e\\n\\n\u003cp\u003eBy the way, cause and effect is sufficient for me. I have a problem with using the 1.4.3 code, this change fixes it.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegards\u003c\\/p\u003e\\n\\n\u003cp\u003eAndy\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andyhind\\\" id=\\\"commentauthor_12377764_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andyhind\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andyhind\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andy Hind\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377764_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 17:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T17:40:28+0000\'\u003e04\\/May\\/06 17:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I agree this is not strictly an issue with lucene....but ..... \\n\\n Lucene has an unusual use pattern for thread locals (instance vs static member variables). \\nThere are issues with ThreadLocal, discussed here and elsewhere, including potential instability. \\nYou should expect others to use thread locals - maybe in the same way. \\n\\n I fixed the issue reported in   LUCENE-529   with memory sensitive caching using SoftReferences to the values held as ThreadLocals. \\nBefore an out of memory error, the values are cleared and hard refs to the soft reference wrapper class remain. \\nThis pattern is used by some classes in the JVM. \\nThis limits the memory overhead with thread local use.  \\nThere will always be some overhead. \\n\\n I am happy with the alternative fix using WeakHashMap \\nNote: stale entries are always scanned and removed (each call to put, get, size) in contrast to thread locals.  \\nThis is what I want - it must be stable! \\n\\n I spent as much time as I could trying to come up with a clear, simple test case that applied regardless of memory constraints. \\nA clear failure case must be possible, but I did not have time to investigate the criteria for ThreadLocal instability. \\nIn any case, I would send this to Sun. \\n\\n A test case is one thing, knowning, understanding and fixing\\/working around an issue is another. \\nIn all the simple cases I tried I got stability but with higher memory use and gc activity than with the \\\"fixed\\\" version. \\nHowever, I did also remove the pointless finalize() method, which could very well explain the growth of the thread local table. \\n\\n We have had problems with 1.5.0_06. The issue is caused by the pattern of thread local use and garbage collection producing instability in the size of the thread local table. Your single test case does not imply that the issue does not exist for other JVMs and use cases.  I have had the issue without using RAMDirectory - it seems it is just more likely with it. \\n\\n By the way, cause and effect is sufficient for me. I have a problem with using the 1.4.3 code, this change fixes it. \\n\\n Regards \\n\\n Andy              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377815\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377815&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377815\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377815_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377815_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 22:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T22:00:59+0000\'\u003e04\\/May\\/06 22:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTo restate:\u003c\\/p\u003e\\n\\n\u003cp\u003eIt is NOT a bug. It is a design decision in the JDK between performance and memory use. This decisions changed a bit in 1.5. 1.5 still does not clear the entire ThreadLocal table - it uses hueristics to clear MOST of the entries - a balance between memory and speed. The WeakHashMap clears ALL entries on every invocation. It is slower than a ThreadLocal, BUT, it\'s memory use is more deterministic.\u003c\\/p\u003e\\n\\n\u003cp\u003eLucene will work FINE in all cases except when loading large directories into a RAMDirectory, and closing and reopening said directories multiple times.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince this may be a common use case for Lucene, I suggest using the FixedThreadLocal class - trading performance for deterministic memory use.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn all cases, the current finalize() methods that \\\"clear the ThreadLocal value\\\" should be removed. It is incorrect, and causes performance problems. Since the finalize() is for the ThreadLocal value, it will never be finalized until the ThreadLocal has already cleared the entry - which is based on the key (the ThreadLocal), since the ThreadLocal entry maintains a hard ref to the value.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377815_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377815_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 22:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T22:00:59+0000\'\u003e04\\/May\\/06 22:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    To restate: \\n\\n It is NOT a bug. It is a design decision in the JDK between performance and memory use. This decisions changed a bit in 1.5. 1.5 still does not clear the entire ThreadLocal table - it uses hueristics to clear MOST of the entries - a balance between memory and speed. The WeakHashMap clears ALL entries on every invocation. It is slower than a ThreadLocal, BUT, it\'s memory use is more deterministic. \\n\\n Lucene will work FINE in all cases except when loading large directories into a RAMDirectory, and closing and reopening said directories multiple times. \\n\\n Since this may be a common use case for Lucene, I suggest using the FixedThreadLocal class - trading performance for deterministic memory use. \\n\\n In all cases, the current finalize() methods that \\\"clear the ThreadLocal value\\\" should be removed. It is incorrect, and causes performance problems. Since the finalize() is for the ThreadLocal value, it will never be finalized until the ThreadLocal has already cleared the entry - which is based on the key (the ThreadLocal), since the ThreadLocal entry maintains a hard ref to the value.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377826\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377826&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377826\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377826_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377826_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T22:31:36+0000\'\u003e04\\/May\\/06 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOops. Last comment was not quite correct.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason the finalize() methods are worthless for clearing the ThreadLocal entries, is that they are clearing the ThreadLocal entry for the \\\"finalize\\\" thread !\u003c\\/p\u003e\\n\\n\u003cp\u003eSo they do nothing but slow down finalization\\/GC.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377826_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377826_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 22:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T22:31:36+0000\'\u003e04\\/May\\/06 22:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oops. Last comment was not quite correct. \\n\\n The reason the finalize() methods are worthless for clearing the ThreadLocal entries, is that they are clearing the ThreadLocal entry for the \\\"finalize\\\" thread ! \\n\\n So they do nothing but slow down finalization\\/GC.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377829\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377829&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377829\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377829_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377829_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 22:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T22:40:38+0000\'\u003e04\\/May\\/06 22:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe best solution is this,\u003c\\/p\u003e\\n\\n\u003cp\u003emove the \u003c\\/p\u003e\\n\\n\u003cp\u003e    enumerators.set(null);\u003c\\/p\u003e\\n\\n\u003cp\u003eto the TermInfosReader close(), and remove the finalize().\u003c\\/p\u003e\\n\\n\u003cp\u003eEverything will work fine.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377829_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377829_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 22:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T22:40:38+0000\'\u003e04\\/May\\/06 22:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The best solution is this, \\n\\n move the  \\n\\n     enumerators.set(null); \\n\\n to the TermInfosReader close(), and remove the finalize(). \\n\\n Everything will work fine.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377842\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377842&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377842\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377842_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377842_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 23:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T23:56:52+0000\'\u003e04\\/May\\/06 23:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eActually, the last simple \\\"fix\\\" only works well for single threaded applications, so it is not much of a \\\"fix\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eUse FixedthreadLocal - works best.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377842_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377842_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/May\\/06 23:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-04T23:56:52+0000\'\u003e04\\/May\\/06 23:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Actually, the last simple \\\"fix\\\" only works well for single threaded applications, so it is not much of a \\\"fix\\\". \\n\\n Use FixedthreadLocal - works best.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377850\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377850&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377850\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377850_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377850_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 00:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T00:40:23+0000\'\u003e05\\/May\\/06 00:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHowever, this problem is classified is eventually irrelevant to me.  Bug in the JDK, bug in Lucene, not a bug, it\'s all the same.  What is relevant is that I have a production app using Lucene 1.9.1 that will produce an OutOfMemoryError within 2 weeks of use with a huge 128MB of heap.  The configuration is Sun\'s JDK 1.5.0_06 on Linux \\/ Tomcat 5.5.15.  With a patch, I am NOT getting the memory link, and my customers are NOT being denied service because of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-436\\\" title=\\\"[PATCH] TermInfosReader, SegmentTermEnum Out Of Memory Exception\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-436\\\"\u003e\u003cdel\u003eLUCENE-436\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor what it\'s worth, the use case for my app is opening up one IndexReader and one IndexSearcher, and using the IndexSearcher in an multi-threaded environment.  If this isn\'t a primary use case for Lucene, it should be.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377850_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377850_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 00:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T00:40:23+0000\'\u003e05\\/May\\/06 00:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    However, this problem is classified is eventually irrelevant to me.  Bug in the JDK, bug in Lucene, not a bug, it\'s all the same.  What is relevant is that I have a production app using Lucene 1.9.1 that will produce an OutOfMemoryError within 2 weeks of use with a huge 128MB of heap.  The configuration is Sun\'s JDK 1.5.0_06 on Linux \\/ Tomcat 5.5.15.  With a patch, I am NOT getting the memory link, and my customers are NOT being denied service because of   LUCENE-436  . \\n\\n For what it\'s worth, the use case for my app is opening up one IndexReader and one IndexSearcher, and using the IndexSearcher in an multi-threaded environment.  If this isn\'t a primary use case for Lucene, it should be.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377855\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377855&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377855\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377855_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377855_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 00:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T00:55:46+0000\'\u003e05\\/May\\/06 00:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAre you always loading your indexes using RAMDirectories?\u003c\\/p\u003e\\n\\n\u003cp\u003eI use multi-hundred megabytes indexes, with 196 max heap, and it runs for months.\u003c\\/p\u003e\\n\\n\u003cp\u003eI can guarentee that if your index grows to 100+ megabytes you will get an OOM no matter what you do (loading into a RAMDirectory with a 128 max heap), SO, THE ISSUE IS COMPLETELY DEPENDENT on YOUR configuration.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou may find that using a 256 max heap allows your index to run forever with NO code CHANGES.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am not saying this issue should not be addressed, but it is not  BUG. It is a performance vs. memory consumption design tradeoff. If you knew anything about software, you would understand this.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt may be the common case that Lucene should favor lower memory consumption vs. performance, but it is not a ABSOLUTE.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are conceivably many users of Lucene where the change does not make sense, the performance degradation is not worth it (because they have plenty of memory available based on index size, and\\/or do not load the indexes into memory).\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377855_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377855_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 00:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T00:55:46+0000\'\u003e05\\/May\\/06 00:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Are you always loading your indexes using RAMDirectories? \\n\\n I use multi-hundred megabytes indexes, with 196 max heap, and it runs for months. \\n\\n I can guarentee that if your index grows to 100+ megabytes you will get an OOM no matter what you do (loading into a RAMDirectory with a 128 max heap), SO, THE ISSUE IS COMPLETELY DEPENDENT on YOUR configuration. \\n\\n You may find that using a 256 max heap allows your index to run forever with NO code CHANGES. \\n\\n I am not saying this issue should not be addressed, but it is not  BUG. It is a performance vs. memory consumption design tradeoff. If you knew anything about software, you would understand this. \\n\\n It may be the common case that Lucene should favor lower memory consumption vs. performance, but it is not a ABSOLUTE. \\n\\n There are conceivably many users of Lucene where the change does not make sense, the performance degradation is not worth it (because they have plenty of memory available based on index size, and\\/or do not load the indexes into memory). \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377856\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377856&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377856\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377856_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377856_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 00:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T00:57:03+0000\'\u003e05\\/May\\/06 00:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebetter version of TermInfos reader that avoid multiple ThreadLocal.get() calls\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377856_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377856_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 00:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T00:57:03+0000\'\u003e05\\/May\\/06 00:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    better version of TermInfos reader that avoid multiple ThreadLocal.get() calls              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377858\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377858&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377858\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377858_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377858_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 01:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T01:01:02+0000\'\u003e05\\/May\\/06 01:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI attached a better version of TermInfosReader that avoids multiple ThreadLocal.get() during get(Term r) which can be expensive.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is especially important if ThreadLocal is changed to FixedThreadLocal due to the lower performance of get().\u003c\\/p\u003e\\n\\n\u003cp\u003eI also removed some unused package level methods.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377858_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377858_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 01:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T01:01:02+0000\'\u003e05\\/May\\/06 01:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I attached a better version of TermInfosReader that avoids multiple ThreadLocal.get() during get(Term r) which can be expensive. \\n\\n This is especially important if ThreadLocal is changed to FixedThreadLocal due to the lower performance of get(). \\n\\n I also removed some unused package level methods.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377863\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377863&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377863\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377863_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377863_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 01:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T01:20:29+0000\'\u003e05\\/May\\/06 01:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am not using a RAMDirectory.  I never indicated as such.  Here\'s the the way I load my index:\u003c\\/p\u003e\\n\\n\u003cp\u003ereader = IndexReader.open(dictionaryIndexDirectory);\u003c\\/p\u003e\\n\\n\u003cp\u003edictionaryIndexDirectory is a java.io.File.\u003c\\/p\u003e\\n\\n\u003cp\u003eMy index is 30 megabytes.  This configuration should be perfectly fine in 128 MB of heap, even 64 sounds reasonable.  I can\'t simply add a 128 MB heap to my configuration without additional cost.  I can\'t just throw hardware at the problem.  Also, any performance arguments are irrelevant unless proven with real numbers.  If you knew anything about software, you would understand this as well.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"nshupe\\\" id=\\\"commentauthor_12377863_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=nshupe\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"nshupe\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Nicholaus Shupe\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377863_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 01:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T01:20:29+0000\'\u003e05\\/May\\/06 01:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am not using a RAMDirectory.  I never indicated as such.  Here\'s the the way I load my index: \\n\\n reader = IndexReader.open(dictionaryIndexDirectory); \\n\\n dictionaryIndexDirectory is a java.io.File. \\n\\n My index is 30 megabytes.  This configuration should be perfectly fine in 128 MB of heap, even 64 sounds reasonable.  I can\'t simply add a 128 MB heap to my configuration without additional cost.  I can\'t just throw hardware at the problem.  Also, any performance arguments are irrelevant unless proven with real numbers.  If you knew anything about software, you would understand this as well.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377865\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377865&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377865\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377865_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377865_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 01:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T01:33:04+0000\'\u003e05\\/May\\/06 01:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThen you have some other problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe ONLY way the ThreadLocal issue is an ISSUE is if VERY LARGE objects are referenced by the ThreadLocal. Since your indexes are not being held in ram, there is some other problem. You even provided that test case that DEMONSTRATES the \\\"memory leak\\\" issue is not a problem unless a RAMDirectory is used.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs for what is a valid heap size - this depends completely on the other code loaded into the JVM, and what memory it uses.\u003c\\/p\u003e\\n\\n\u003cp\u003eI use a max heap of 196 with 400mb index and it works fine.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12377865_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377865_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 01:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T01:33:04+0000\'\u003e05\\/May\\/06 01:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Then you have some other problem. \\n\\n The ONLY way the ThreadLocal issue is an ISSUE is if VERY LARGE objects are referenced by the ThreadLocal. Since your indexes are not being held in ram, there is some other problem. You even provided that test case that DEMONSTRATES the \\\"memory leak\\\" issue is not a problem unless a RAMDirectory is used. \\n\\n As for what is a valid heap size - this depends completely on the other code loaded into the JVM, and what memory it uses. \\n\\n I use a max heap of 196 with 400mb index and it works fine. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377905\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377905&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377905\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ktopping\\\" id=\\\"commentauthor_12377905_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ktopping\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ktopping\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e kieran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377905_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 05:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T05:29:39+0000\'\u003e05\\/May\\/06 05:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRobert Engels description of the ThreadLocal issue in JDK 1.4.2 provides a very plausible explanation for why this is not a bug, either in Lucene, or in the JDK.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s not a memory \\\"leak\\\", in the traditional sense (i.e. an unbounded increase in heap memory usage); however, it can - in certain circumstances - lead to a lot more memory being assigned than is necessary, which (and this is pivotal) isn\'t necessarily considered for GC-ing once it\'s no longer (hard-)referenced.\u003c\\/p\u003e\\n\\n\u003cp\u003ePersonally, now this behaviour of ThreadLocal has been pointed out, I find it very difficult to envisage circumstances in which I\'ll even consider using it - until it is altered. (I won\'t say never, because, as Robert points out, there IS a performance gain to this behaviour).\u003c\\/p\u003e\\n\\n\u003cp\u003eMy personal experience is that this \\\"memory leak\\\" \\/ \\\"larger than necessary memory footprint\\\" can cause extreme problems in production apps. We\'ve been running out of memory even with 700MB assigned to each JRE. My patch has resolved the issue, and so we will apply it to each future release of Lucene, before we use it. Maybe ours is an unusual setup: we periodically close our IndexSearcher, reload an index from the filesystem into a RAMDirectory, and create a new IndexSearcher from it. These indexes are only a few MB in size.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason I posted this patch and test case was to help developers who might be in a similar situation to me, and save them from the having to perform the days of investigation that I did - not because I wanted to force an unwanted change into the Lucene source code. It would be very useful to me if a variant of this patch WAS incorporated into Lucene but I recognize that other users may well have different priorities vis-a-vis performance vs memory ueage.\u003c\\/p\u003e\\n\\n\u003cp\u003e(btw, Robert, I think you might have mistakenly ascribed the test case to Nicholaus! It was me who suggested that it was dependent on using RAMDirectories.)\u003c\\/p\u003e\\n\\n\u003cp\u003eKind regards.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ktopping\\\" id=\\\"commentauthor_12377905_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ktopping\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ktopping\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e kieran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377905_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 05:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T05:29:39+0000\'\u003e05\\/May\\/06 05:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Robert Engels description of the ThreadLocal issue in JDK 1.4.2 provides a very plausible explanation for why this is not a bug, either in Lucene, or in the JDK. \\n\\n It\'s not a memory \\\"leak\\\", in the traditional sense (i.e. an unbounded increase in heap memory usage); however, it can - in certain circumstances - lead to a lot more memory being assigned than is necessary, which (and this is pivotal) isn\'t necessarily considered for GC-ing once it\'s no longer (hard-)referenced. \\n\\n Personally, now this behaviour of ThreadLocal has been pointed out, I find it very difficult to envisage circumstances in which I\'ll even consider using it - until it is altered. (I won\'t say never, because, as Robert points out, there IS a performance gain to this behaviour). \\n\\n My personal experience is that this \\\"memory leak\\\" \\/ \\\"larger than necessary memory footprint\\\" can cause extreme problems in production apps. We\'ve been running out of memory even with 700MB assigned to each JRE. My patch has resolved the issue, and so we will apply it to each future release of Lucene, before we use it. Maybe ours is an unusual setup: we periodically close our IndexSearcher, reload an index from the filesystem into a RAMDirectory, and create a new IndexSearcher from it. These indexes are only a few MB in size. \\n\\n The reason I posted this patch and test case was to help developers who might be in a similar situation to me, and save them from the having to perform the days of investigation that I did - not because I wanted to force an unwanted change into the Lucene source code. It would be very useful to me if a variant of this patch WAS incorporated into Lucene but I recognize that other users may well have different priorities vis-a-vis performance vs memory ueage. \\n\\n (btw, Robert, I think you might have mistakenly ascribed the test case to Nicholaus! It was me who suggested that it was dependent on using RAMDirectories.) \\n\\n Kind regards.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12377933\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12377933&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12377933\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_12377933_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377933_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 08:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T08:46:59+0000\'\u003e05\\/May\\/06 08:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePlease, everyone, let\'s keep this discussion technical and factual and avoid making degrading statements to one another.  It doesn\'t help the situation to have such negative tones being used. The discussion aspect of this should be moved to java-dev anyway, and leave JIRA comments for details on patches attached and other technical details related directly towards resolving this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_12377933_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12377933_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/May\\/06 08:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-05T08:46:59+0000\'\u003e05\\/May\\/06 08:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Please, everyone, let\'s keep this discussion technical and factual and avoid making degrading statements to one another.  It doesn\'t help the situation to have such negative tones being used. The discussion aspect of this should be moved to java-dev anyway, and leave JIRA comments for details on patches attached and other technical details related directly towards resolving this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12378997\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12378997&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12378997\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fern\\\" id=\\\"commentauthor_12378997_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fern\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fern\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Padilla\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378997_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/06 07:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-11T07:07:10+0000\'\u003e11\\/May\\/06 07:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere are our facts.  It looks like this bug is also affecting us!!\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eWe are also running into memory issues on our production servers and running out of memory.\u003c\\/p\u003e\\n\\n\u003cp\u003eTomcat 5, Lucene1.9.1, JDK 1.5, RHEL, RAMDirectory\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are constantly updating the index ( 2400 documents smoothly reindexed every 30 hour ).\u003c\\/p\u003e\\n\\n\u003cp\u003eIndex size of about 5M.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are doing ordered searches against the index.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are constantly creating new IndexReader\\/Writer\\/Searcher and closing as needed.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn QA we have Xmx500M, in production we have Xmx1500M.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fern\\\" id=\\\"commentauthor_12378997_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fern\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fern\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Padilla\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12378997_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/May\\/06 07:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-11T07:07:10+0000\'\u003e11\\/May\\/06 07:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here are our facts.  It looks like this bug is also affecting us!! \\n\\n\\n We are also running into memory issues on our production servers and running out of memory. \\n\\n Tomcat 5, Lucene1.9.1, JDK 1.5, RHEL, RAMDirectory \\n\\n We are constantly updating the index ( 2400 documents smoothly reindexed every 30 hour ). \\n\\n Index size of about 5M. \\n\\n We are doing ordered searches against the index. \\n\\n We are constantly creating new IndexReader\\/Writer\\/Searcher and closing as needed. \\n\\n In QA we have Xmx500M, in production we have Xmx1500M.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12379151\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12379151&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12379151\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fern\\\" id=\\\"commentauthor_12379151_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fern\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fern\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Padilla\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12379151_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/06 05:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-12T05:07:26+0000\'\u003e12\\/May\\/06 05:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSo I went ahead and made our own version of lucene-1.9.1 from the sources along with the proposed patch.  And yes it does help our memory leak.  If you refer to the previous comment, you can see what our environment looks like.  I will go ahead and attach our version of the patch now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fern\\\" id=\\\"commentauthor_12379151_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fern\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fern\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Padilla\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12379151_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/06 05:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-12T05:07:26+0000\'\u003e12\\/May\\/06 05:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    So I went ahead and made our own version of lucene-1.9.1 from the sources along with the proposed patch.  And yes it does help our memory leak.  If you refer to the previous comment, you can see what our environment looks like.  I will go ahead and attach our version of the patch now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12379152\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12379152&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12379152\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fern\\\" id=\\\"commentauthor_12379152_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fern\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fern\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Padilla\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12379152_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/06 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-12T05:08:13+0000\'\u003e12\\/May\\/06 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ealright then.  Attached is the patch that I just created.  I couldn\'t resist modifying the FixedThreadLocal to suit my tastes. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eand it goes against the \\\"1.9.1\\\" src that I downloaded off of their website. (though it was marked as version \\\"1.9.2-dev\\\", which then I re-christened \\\"1.9.2-protrade\\\" ).\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd yes it seems to have helped with the memory leak.\u003c\\/p\u003e\\n\\n\u003cp\u003ethank you all.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"fern\\\" id=\\\"commentauthor_12379152_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=fern\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"fern\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Fernando Padilla\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12379152_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/06 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-05-12T05:08:13+0000\'\u003e12\\/May\\/06 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    alright then.  Attached is the patch that I just created.  I couldn\'t resist modifying the FixedThreadLocal to suit my tastes.   \\n\\n and it goes against the \\\"1.9.1\\\" src that I downloaded off of their website. (though it was marked as version \\\"1.9.2-dev\\\", which then I re-christened \\\"1.9.2-protrade\\\" ). \\n\\n And yes it seems to have helped with the memory leak. \\n\\n thank you all.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429418\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12429418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429418\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"antonyscerri\\\" id=\\\"commentauthor_12429418_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=antonyscerri\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"antonyscerri\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Antony Scerri\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429418_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T13:45:19+0000\'\u003e21\\/Aug\\/06 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWould it not be easier to simply make the objects stored in the ThreadLocal a WeakReference. So in the case of TermInfosReader store the SegmentTermEnum within the WeakReference, and then place that into the enumerators varaible. This will maintain the cloned term enumerator object for the lifetime of the thread using it, but also allow the objects to be cleaned up by the GC when the index owning the TermInfosReader is no longer referenced (at which point no thread should be using the index). \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"antonyscerri\\\" id=\\\"commentauthor_12429418_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=antonyscerri\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"antonyscerri\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Antony Scerri\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429418_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 13:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T13:45:19+0000\'\u003e21\\/Aug\\/06 13:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Would it not be easier to simply make the objects stored in the ThreadLocal a WeakReference. So in the case of TermInfosReader store the SegmentTermEnum within the WeakReference, and then place that into the enumerators varaible. This will maintain the cloned term enumerator object for the lifetime of the thread using it, but also allow the objects to be cleaned up by the GC when the index owning the TermInfosReader is no longer referenced (at which point no thread should be using the index).               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429451\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12429451&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429451\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"antonyscerri\\\" id=\\\"commentauthor_12429451_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=antonyscerri\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"antonyscerri\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Antony Scerri\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429451_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 16:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T16:46:16+0000\'\u003e21\\/Aug\\/06 16:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLets forget that last comment I made, I was testing out a simple setup and forgot there wasn\'t going to be a hard reference to the cloned term enum object anywhere, so the weak reference would get cleared away immediately upon GC. A SoftReference could be used instead, but would be subject to GC if free memory was low, which under heavy load could mean it would again get cleared away by GC before the thread had finished.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"antonyscerri\\\" id=\\\"commentauthor_12429451_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=antonyscerri\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"antonyscerri\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Antony Scerri\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429451_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 16:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T16:46:16+0000\'\u003e21\\/Aug\\/06 16:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Lets forget that last comment I made, I was testing out a simple setup and forgot there wasn\'t going to be a hard reference to the cloned term enum object anywhere, so the weak reference would get cleared away immediately upon GC. A SoftReference could be used instead, but would be subject to GC if free memory was low, which under heavy load could mean it would again get cleared away by GC before the thread had finished.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458264\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12458264&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458264\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12458264_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458264_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T21:17:08+0000\'\u003e13\\/Dec\\/06 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e4 months later, I think I see the same problem here.\u003cbr\\/\u003e\\nI\'m using JDK 1.6 (I saw the same problem under 1.5.0_0(8,9,10)) and Lucene from HEAD (2.1-dev).\u003cbr\\/\u003e\\nI\'m running out of 2GB heap in under 1 day on a production system that searches tens of thousands of indexes, where a few hundred of them have IndexSearchers open to them at any one time, with unused IndexSearchers getting closed after some period of inactivity.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m periodically dumping the heap with jconsole and noticing the continuously increasing number of:\u003c\\/p\u003e\\n\\n\u003cp\u003e org.apache.lucene.index.TermInfo\u003cbr\\/\u003e\\n org.apache.lucene.index.CompoundFileReader$CSIndexInput\u003cbr\\/\u003e\\n org.apache.lucene.index.Term\u003cbr\\/\u003e\\n org.apache.lucene.index.SegmentTermEnum\u003cbr\\/\u003e\\n...\u003c\\/p\u003e\\n\\n\u003cp\u003eThere was a LOT of back and forth here.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is the final solution?  I see a complete new copy of TermInfosReader, but there are a lot of formatting changes in there, it\'s hard to tell what was actually changed, even with diff -bB --expand-tabs.\u003c\\/p\u003e\\n\\n\u003cp\u003eI also see FixedThreadLocal, but I see no references to it from TermInfosReader...?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12458264_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458264_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T21:17:08+0000\'\u003e13\\/Dec\\/06 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    4 months later, I think I see the same problem here. \\nI\'m using JDK 1.6 (I saw the same problem under 1.5.0_0(8,9,10)) and Lucene from HEAD (2.1-dev). \\nI\'m running out of 2GB heap in under 1 day on a production system that searches tens of thousands of indexes, where a few hundred of them have IndexSearchers open to them at any one time, with unused IndexSearchers getting closed after some period of inactivity. \\n\\n I\'m periodically dumping the heap with jconsole and noticing the continuously increasing number of: \\n\\n  org.apache.lucene.index.TermInfo \\n org.apache.lucene.index.CompoundFileReader$CSIndexInput \\n org.apache.lucene.index.Term \\n org.apache.lucene.index.SegmentTermEnum \\n... \\n\\n There was a LOT of back and forth here. \\n\\n What is the final solution?  I see a complete new copy of TermInfosReader, but there are a lot of formatting changes in there, it\'s hard to tell what was actually changed, even with diff -bB --expand-tabs. \\n\\n I also see FixedThreadLocal, but I see no references to it from TermInfosReader...?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458292\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12458292&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458292\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12458292_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458292_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 22:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T22:32:08+0000\'\u003e13\\/Dec\\/06 22:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would doubt the ThreadLocal \\\"issue\\\" that was in 1.4, changed in 1.5, would be reintroduced in 1.6.\u003c\\/p\u003e\\n\\n\u003cp\u003eI do not use Lucene 2.1 so I can\'t say for certain that a new memory bug hasn\'t been introduced.\u003c\\/p\u003e\\n\\n\u003cp\u003eI suggest attaching a good profiler (like JProfiler) and figure our the cause of the memory leak (the root references).\u003c\\/p\u003e\\n\\n\u003cp\u003eI use 1.9 based Lucene and can say unequivocally there are no inherent memory issues (especially when running under 1.5+).\u003c\\/p\u003e\\n\\n\u003cp\u003eThere may also be new issues introduced in JDK 6 - we have not tested with it, only 1.4 and 1.5.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rengels@tylertechinc.com\\\" id=\\\"commentauthor_12458292_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rengels%40tylertechinc.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rengels@tylertechinc.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e robert engels\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458292_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Dec\\/06 22:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-13T22:32:08+0000\'\u003e13\\/Dec\\/06 22:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would doubt the ThreadLocal \\\"issue\\\" that was in 1.4, changed in 1.5, would be reintroduced in 1.6. \\n\\n I do not use Lucene 2.1 so I can\'t say for certain that a new memory bug hasn\'t been introduced. \\n\\n I suggest attaching a good profiler (like JProfiler) and figure our the cause of the memory leak (the root references). \\n\\n I use 1.9 based Lucene and can say unequivocally there are no inherent memory issues (especially when running under 1.5+). \\n\\n There may also be new issues introduced in JDK 6 - we have not tested with it, only 1.4 and 1.5.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459779\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12459779&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459779\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12459779_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459779_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/06 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-19T22:33:49+0000\'\u003e19\\/Dec\\/06 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy leak ended up being caused by the patch in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-651\\\" title=\\\"Poor performance race condition in FieldCacheImpl\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-651\\\"\u003e\u003cdel\u003eLUCENE-651\u003c\\/del\u003e\u003c\\/a\u003e and is fixed by \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-754\\\" title=\\\"FieldCache keeps hard references to readers, doesn&#39;t prevent multiple threads from creating same instance\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-754\\\"\u003e\u003cdel\u003eLUCENE-754\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe only thing left to do in this case is:\u003cbr\\/\u003e\\n1) remove finalize() calls in SegmentReader and TermInfosReader\u003cbr\\/\u003e\\n2) call enumerators.remove() in TermInfosReader\'s close()\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll do that in the next few days.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12459779_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459779_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/06 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-19T22:33:49+0000\'\u003e19\\/Dec\\/06 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My leak ended up being caused by the patch in   LUCENE-651   and is fixed by   LUCENE-754  . \\n\\n The only thing left to do in this case is: \\n1) remove finalize() calls in SegmentReader and TermInfosReader \\n2) call enumerators.remove() in TermInfosReader\'s close() \\n\\n I\'ll do that in the next few days.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459813\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12459813&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459813\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12459813_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459813_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/06 03:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-20T03:27:09+0000\'\u003e20\\/Dec\\/06 03:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe more finalizers we can get rid of, the better.  They are too hard to use correctly and cause performance problems.\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/devresource.hp.com\\/drc\\/resources\\/jmemmodel\\/index.jsp\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/devresource.hp.com\\/drc\\/resources\\/jmemmodel\\/index.jsp\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12459813_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459813_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/06 03:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-20T03:27:09+0000\'\u003e20\\/Dec\\/06 03:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The more finalizers we can get rid of, the better.  They are too hard to use correctly and cause performance problems. \\n http:\\/\\/devresource.hp.com\\/drc\\/resources\\/jmemmodel\\/index.jsp               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459814\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12459814&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459814\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12459814_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459814_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/06 03:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-20T03:43:41+0000\'\u003e20\\/Dec\\/06 03:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch removes finalize() in TermInfosReader and SegmentReader, and it adds the enumerators.remove() call in TermInfosReader close() method.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12459814_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459814_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/06 03:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-20T03:43:41+0000\'\u003e20\\/Dec\\/06 03:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch removes finalize() in TermInfosReader and SegmentReader, and it adds the enumerators.remove() call in TermInfosReader close() method.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12460040\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-436?focusedCommentId=12460040&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12460040\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12460040_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12460040_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/06 20:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-20T20:28:16+0000\'\u003e20\\/Dec\\/06 20:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eApplied and committed the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-436\\\" title=\\\"[PATCH] TermInfosReader, SegmentTermEnum Out Of Memory Exception\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-436\\\"\u003e\u003cdel\u003eLUCENE-436\u003c\\/del\u003e\u003c\\/a\u003e.patch (is JIRA smart enough not to hyperlink this?) - all unit tests still pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12460040_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12460040_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/06 20:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-20T20:28:16+0000\'\u003e20\\/Dec\\/06 20:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Applied and committed the   LUCENE-436  .patch (is JIRA smart enough not to hyperlink this?) - all unit tests still pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516201742308"> 
    <input type="hidden" title="jira.request.server.time" value="627"> 
    <input type="hidden" title="jira.request.id" value="909x7644015x5"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="46"> 
    <input type="hidden" title="db.conns.time.in.ms" value="55"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 909x7644015x5
	          REQUEST TIMESTAMP : [17/Jan/2018:15:09:02 +0000]
	               REQUEST TIME : 0.6270
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=22, elapsedTotal=46046408, elapsedMin=738138, elapsedMax=14325345, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=26, elapsedTotal=55720507, elapsedMin=794245, elapsedMax=14404494, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>