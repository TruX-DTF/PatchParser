<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|abf0430440afc0206e6e40ba52e2b964e1231d32|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"4e9e359d6f219a\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-2649"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-2649] FieldCache should include a BitSet for matching docs - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-2649] FieldCache should include a BitSet for matching docs - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2649">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-2649" href="/jira/browse/LUCENE-2649" id="key-val" rel="12474349">LUCENE-2649</a></li>
                </ol>
                <h1 id="summary-val">FieldCache should include a BitSet for matching docs</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2649"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-2649/LUCENE-2649.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-2649/LUCENE-2649.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-2649/LUCENE-2649.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-2649/LUCENE-2649.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fsearch%22" title="core/search issues with search code">core/search</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12474349-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>The FieldCache returns an array representing the values for each doc. However there is no way to know if the doc actually has a value.</p> 
                  <p>This should be changed to return an object representing the values <b>and</b> a BitSet for all valid docs.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-2649?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-2649?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-2649?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-2649?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12455573" data-issue-id="12474349" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12455573/LUCENE-2649-FieldCacheWithBitSet.patch" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12455573/LUCENE-2649-FieldCacheWithBitSet.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12455573/LUCENE-2649-FieldCacheWithBitSet.patch" title="Latest  25/Sep/10 19:10 - Ryan McKinley" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12455573/LUCENE-2649-FieldCacheWithBitSet.patch">LUCENE-2649-FieldCacheWithBitSet.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-25T19:10:11.250Z">25/Sep/10 19:10</time>
                   </dd>
                   <dd class="attachment-size">
                    116 kB
                   </dd>
                   <dd class="attachment-author">
                    Ryan McKinley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12455275" data-issue-id="12474349" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12455275/LUCENE-2649-FieldCacheWithBitSet.patch" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12455275/LUCENE-2649-FieldCacheWithBitSet.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12455275/LUCENE-2649-FieldCacheWithBitSet.patch" title=" 22/Sep/10 15:36 - Ryan McKinley" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12455275/LUCENE-2649-FieldCacheWithBitSet.patch">LUCENE-2649-FieldCacheWithBitSet.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-22T15:36:35.329Z">22/Sep/10 15:36</time>
                   </dd>
                   <dd class="attachment-size">
                    42 kB
                   </dd>
                   <dd class="attachment-author">
                    Ryan McKinley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12455239" data-issue-id="12474349" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12455239/LUCENE-2649-FieldCacheWithBitSet.patch" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12455239/LUCENE-2649-FieldCacheWithBitSet.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12455239/LUCENE-2649-FieldCacheWithBitSet.patch" title=" 22/Sep/10 06:36 - Ryan McKinley" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12455239/LUCENE-2649-FieldCacheWithBitSet.patch">LUCENE-2649-FieldCacheWithBitSet.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-22T06:36:01.083Z">22/Sep/10 06:36</time>
                   </dd>
                   <dd class="attachment-size">
                    38 kB
                   </dd>
                   <dd class="attachment-author">
                    Ryan McKinley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12454867" data-issue-id="12474349" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454867/LUCENE-2649-FieldCacheWithBitSet.patch" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12454867/LUCENE-2649-FieldCacheWithBitSet.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454867/LUCENE-2649-FieldCacheWithBitSet.patch" title=" 17/Sep/10 16:31 - Ryan McKinley" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12454867/LUCENE-2649-FieldCacheWithBitSet.patch">LUCENE-2649-FieldCacheWithBitSet.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-17T16:31:54.598Z">17/Sep/10 16:31</time>
                   </dd>
                   <dd class="attachment-size">
                    25 kB
                   </dd>
                   <dd class="attachment-author">
                    Ryan McKinley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12454827" data-issue-id="12474349" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454827/LUCENE-2649-FieldCacheWithBitSet.patch" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12454827/LUCENE-2649-FieldCacheWithBitSet.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454827/LUCENE-2649-FieldCacheWithBitSet.patch" title=" 17/Sep/10 05:20 - Ryan McKinley" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12454827/LUCENE-2649-FieldCacheWithBitSet.patch">LUCENE-2649-FieldCacheWithBitSet.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-17T05:20:55.863Z">17/Sep/10 05:20</time>
                   </dd>
                   <dd class="attachment-size">
                    24 kB
                   </dd>
                   <dd class="attachment-author">
                    Ryan McKinley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12454825" data-issue-id="12474349" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454825/LUCENE-2649-FieldCacheWithBitSet.patch" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12454825/LUCENE-2649-FieldCacheWithBitSet.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454825/LUCENE-2649-FieldCacheWithBitSet.patch" title=" 17/Sep/10 04:56 - Ryan McKinley" draggable="true" data-downloadurl="text/x-diff:LUCENE-2649-FieldCacheWithBitSet.patch:https://issues.apache.org/jira/secure/attachment/12454825/LUCENE-2649-FieldCacheWithBitSet.patch">LUCENE-2649-FieldCacheWithBitSet.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-17T04:56:10.145Z">17/Sep/10 04:56</time>
                   </dd>
                   <dd class="attachment-size">
                    28 kB
                   </dd>
                   <dd class="attachment-author">
                    Ryan McKinley
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12519669_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="LUCENE-3390: Incorrect sort by Numeric values for documents missing the sorting field"> <a href="/jira/browse/LUCENE-3390" data-issue-key="LUCENE-3390" class="issue-link link-title resolution">LUCENE-3390</a> <span class="link-summary">Incorrect sort by Numeric values for documents missing the sorting field</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12444498_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype" width="16" height="16" title="New Feature - A new feature of the product, which has yet to be developed." alt="New Feature - A new feature of the product, which has yet to be developed."> <span title="LUCENE-2186: First cut at column-stride fields (index values storage)"> <a href="/jira/browse/LUCENE-2186" data-issue-key="LUCENE-2186" class="issue-link link-title resolution">LUCENE-2186</a> <span class="link-summary">First cut at column-stride fields (index values storage)</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12474983_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-2665: Rework FieldCache to be more flexible/general"> <a href="/jira/browse/LUCENE-2665" data-issue-key="LUCENE-2665" class="issue-link link-title resolution">LUCENE-2665</a> <span class="link-summary">Rework FieldCache to be more flexible/general</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12523855_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-3443: Port 3.x FieldCache.getDocsWithField() to trunk"> <a href="/jira/browse/LUCENE-3443" data-issue-key="LUCENE-3443" class="issue-link link-title resolution">LUCENE-3443</a> <span class="link-summary">Port 3.x FieldCache.getDocsWithField() to trunk</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_ryantxu" rel="ryantxu" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Ryan McKinley&quot;,&quot;emailAddress&quot;:&quot;ryantxu@gmail.com&quot;,&quot;username&quot;:&quot;ryantxu&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="ryantxu"></span></span> Ryan McKinley </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_ryantxu" rel="ryantxu" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Ryan McKinley&quot;,&quot;emailAddress&quot;:&quot;ryantxu@gmail.com&quot;,&quot;username&quot;:&quot;ryantxu&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="ryantxu"></span></span> Ryan McKinley </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="17/Sep/10 03:23"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2010-09-17T03:23:40+0000">17/Sep/10 03:23</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:44"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:44:40+0000">10/May/13 10:44</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="25/Mar/11 19:48"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-03-25T19:48:13+0000">25/Mar/11 19:48</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2649?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2649?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12910446\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910446&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910446\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910446_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910446_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 04:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T04:49:31+0000\'\u003e17\\/Sep\\/10 04:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSee some discussion here:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/search.lucidimagination.com\\/search\\/document\\/b6a531f7b73621f1\\/trie_fields_and_sortmissinglast\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/search.lucidimagination.com\\/search\\/document\\/b6a531f7b73621f1\\/trie_fields_and_sortmissinglast\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910446_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910446_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 04:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T04:49:31+0000\'\u003e17\\/Sep\\/10 04:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    See some discussion here: \\n http:\\/\\/search.lucidimagination.com\\/search\\/document\\/b6a531f7b73621f1\\/trie_fields_and_sortmissinglast               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910447\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910447&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910447\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910447_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910447_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 04:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T04:56:10+0000\'\u003e17\\/Sep\\/10 04:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch replaces the cached primitive[] with a CachedObject.  The object heiarch looks like this:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eCachedObject { \\n    \\n  }\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eCachedArray \u003cspan class=\\\"code-keyword\\\"\u003eextends\u003c\\/span\u003e CachedObject {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Bits valid;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e CachedArray( Bits valid ) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.valid = valid;\\n    }\\n  };\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eByteValues \u003cspan class=\\\"code-keyword\\\"\u003eextends\u003c\\/span\u003e CachedArray {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[] values;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ByteValues( \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[] values, Bits valid ) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e( valid );\\n      \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.values = values;\\n    }\\n  };\\n  ...\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThen this @deprecates the getBytes() classes and replaces them with getByteValues()\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ByteValues getByteValues(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field)\\n  \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ByteValues getByteValues(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, ByteParser parser)\\n  \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n  \\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ethen repeat for all the other types!\u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests pass with this patch, but i have not added any tests for the BitSet (yet)\u003c\\/p\u003e\\n\\n\u003cp\u003eIf people like the general look of this approach, I will clean it up and add some tests, javadoc cleanup etc\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910447_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910447_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 04:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T04:56:10+0000\'\u003e17\\/Sep\\/10 04:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch replaces the cached primitive[] with a CachedObject.  The object heiarch looks like this: \\n\\n  \\n \\n     public   abstract   static   class  CachedObject { \\n    \\n  }\\n\\n   public   abstract   static   class  CachedArray  extends  CachedObject {\\n     public   final  Bits valid;\\n     public  CachedArray( Bits valid ) {\\n       this .valid = valid;\\n    }\\n  };\\n\\n   public   static   final   class  ByteValues  extends  CachedArray {\\n     public   final   byte [] values;\\n     public  ByteValues(  byte [] values, Bits valid ) {\\n       super ( valid );\\n       this .values = values;\\n    }\\n  };\\n  ...\\n \\n  \\n\\n Then this @deprecates the getBytes() classes and replaces them with getByteValues() \\n\\n  \\n \\n   public  ByteValues getByteValues(IndexReader reader,  String  field)\\n   throws  IOException;\\n\\n   public  ByteValues getByteValues(IndexReader reader,  String  field, ByteParser parser)\\n   throws  IOException;\\n  \\n \\n  \\n\\n then repeat for all the other types! \\n\\n All tests pass with this patch, but i have not added any tests for the BitSet (yet) \\n\\n If people like the general look of this approach, I will clean it up and add some tests, javadoc cleanup etc              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910460\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910460&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910460\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910460_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910460_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 05:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T05:20:55+0000\'\u003e17\\/Sep\\/10 05:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA slightly simplified version\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910460_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910460_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 05:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T05:20:55+0000\'\u003e17\\/Sep\\/10 05:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A slightly simplified version              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910461\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910461&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910461\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910461_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910461_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 05:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T05:25:10+0000\'\u003e17\\/Sep\\/10 05:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat looks exactly like I proposed it!\u003c\\/p\u003e\\n\\n\u003cp\u003eThe only thing: For DocTerms the approach is not needed? You can check for null, so the Bits interface is not needed. As the OpenBitSets are created with the exact size and don\'t need to grow, you can use fastSet to speed up creation by doing no bounds checks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910461_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910461_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 05:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T05:25:10+0000\'\u003e17\\/Sep\\/10 05:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That looks exactly like I proposed it! \\n\\n The only thing: For DocTerms the approach is not needed? You can check for null, so the Bits interface is not needed. As the OpenBitSets are created with the exact size and don\'t need to grow, you can use fastSet to speed up creation by doing no bounds checks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910464\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910464&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910464\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910464_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910464_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 05:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T05:30:13+0000\'\u003e17\\/Sep\\/10 05:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhen this is committed, we can improve also some Lucene parts: FieldCacheRangeFilter does not need to do extra deletion checks and instead use the Bits interface to find missing\\/non-valued documents. Lucene\'s sorting Collectors can be improved to have a consistent behaviour for missing values (like Solr\'s sortMissingFirst\\/Last).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910464_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910464_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 05:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T05:30:13+0000\'\u003e17\\/Sep\\/10 05:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    When this is committed, we can improve also some Lucene parts: FieldCacheRangeFilter does not need to do extra deletion checks and instead use the Bits interface to find missing\\/non-valued documents. Lucene\'s sorting Collectors can be improved to have a consistent behaviour for missing values (like Solr\'s sortMissingFirst\\/Last).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910513\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910513&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910513\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12910513_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910513_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 09:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T09:20:37+0000\'\u003e17\\/Sep\\/10 09:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooks great!\u003c\\/p\u003e\\n\\n\u003cp\u003eShould we make it optional, whether the valid bitset should be computed?  Many apps wouldn\'t need it, so it just ties up (admittedly smallish amounts of) RAM unnecessarily?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eLucene\'s sorting Collectors can be improved to have a consistent behaviour for missing values (like Solr\'s sortMissingFirst\\/Last).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cp\u003eShouldn\'t we pull Solr\'s sortMissingFirst\\/Last down into Lucene?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12910513_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910513_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 09:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T09:20:37+0000\'\u003e17\\/Sep\\/10 09:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looks great! \\n\\n Should we make it optional, whether the valid bitset should be computed?  Many apps wouldn\'t need it, so it just ties up (admittedly smallish amounts of) RAM unnecessarily? \\n\\n  Lucene\'s sorting Collectors can be improved to have a consistent behaviour for missing values (like Solr\'s sortMissingFirst\\/Last).  \\n\\n +1 \\n\\n Shouldn\'t we pull Solr\'s sortMissingFirst\\/Last down into Lucene?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910539\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910539&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910539\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12910539_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910539_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 11:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T11:09:02+0000\'\u003e17\\/Sep\\/10 11:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eShould we make it optional, whether the valid bitset should be computed? Many apps wouldn\'t need it, so it just ties up (admittedly smallish amounts of) RAM unnecessarily?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003e+1 we can save that overhead and high level apps can enable it by default if needed.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12910539_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910539_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 11:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T11:09:02+0000\'\u003e17\\/Sep\\/10 11:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Should we make it optional, whether the valid bitset should be computed? Many apps wouldn\'t need it, so it just ties up (admittedly smallish amounts of) RAM unnecessarily?  \\n +1 we can save that overhead and high level apps can enable it by default if needed. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910554\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910554&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910554\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910554_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910554_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 12:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T12:47:07+0000\'\u003e17\\/Sep\\/10 12:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eShould we make it optional, whether the valid bitset should be computed?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe trick is how to implement that (unless you mean just set it to true\\/false for all fields at once).  Putting a flag on the FieldCache.getXXX methods is insufficient.\u003cbr\\/\u003e\\nOnly the application knows if some of it\'s future uses of that field will require the bitset for matching docs, but it\'s Lucene that\'s often making the calls to the field cache.\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps FieldCache.Parser was originally just too narrow in scope - it should have been a factory method for handling all decisions about creating and populating a field cache entry?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910554_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910554_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 12:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T12:47:07+0000\'\u003e17\\/Sep\\/10 12:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Should we make it optional, whether the valid bitset should be computed?  \\n\\n The trick is how to implement that (unless you mean just set it to true\\/false for all fields at once).  Putting a flag on the FieldCache.getXXX methods is insufficient. \\nOnly the application knows if some of it\'s future uses of that field will require the bitset for matching docs, but it\'s Lucene that\'s often making the calls to the field cache. \\n\\n Perhaps FieldCache.Parser was originally just too narrow in scope - it should have been a factory method for handling all decisions about creating and populating a field cache entry?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910568\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910568&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910568\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12910568_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910568_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 13:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T13:24:43+0000\'\u003e17\\/Sep\\/10 13:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Simon Willnauer - 17\\/Sep\\/10 13:59\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ePerhaps FieldCache.Parser was originally just too narrow in scope - it should have been a factory method for handling all decisions about creating and populating a field cache entry?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI guess we need to be able to manually configure FieldCache with some kind of FieldType. There have been several issues mentioning this and it keeps coming up again and again. I think it is just time to rethink Fieldable \\/ Field and move towards some kind of flexible type definition for Fields in Lucene. A FieldType could then have a FieldCache Attribute which contains all necessary info including the parser and flags like the one we are talking about. Yet, before I get too excieted about FieldType, yeah something with a wider scope than FieldCache.Parser would work in this case. I don\'t know how far the FieldType is away but it can eventually replace whatever is going to be implemented here in regards to that flag. \u003c\\/p\u003e\\n\\n\u003cp\u003eI think by default we should not enable the Bits feature but it must be explicitly set via whatever mechanism we gonna use.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12910568_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910568_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 13:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T13:24:43+0000\'\u003e17\\/Sep\\/10 13:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Simon Willnauer - 17\\/Sep\\/10 13:59\\\"\u003eedited\u003c\\/span\u003e                    Perhaps FieldCache.Parser was originally just too narrow in scope - it should have been a factory method for handling all decisions about creating and populating a field cache entry?  \\n I guess we need to be able to manually configure FieldCache with some kind of FieldType. There have been several issues mentioning this and it keeps coming up again and again. I think it is just time to rethink Fieldable \\/ Field and move towards some kind of flexible type definition for Fields in Lucene. A FieldType could then have a FieldCache Attribute which contains all necessary info including the parser and flags like the one we are talking about. Yet, before I get too excieted about FieldType, yeah something with a wider scope than FieldCache.Parser would work in this case. I don\'t know how far the FieldType is away but it can eventually replace whatever is going to be implemented here in regards to that flag.  \\n\\n I think by default we should not enable the Bits feature but it must be explicitly set via whatever mechanism we gonna use. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910576\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910576&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910576\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910576_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910576_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T13:40:03+0000\'\u003e17\\/Sep\\/10 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI guess we need to be able to manually configure FieldCache with some kind of FieldType.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t know how well that would work.  For one, there\'s only one FieldCache, so configuring it with anything seems problematic.\u003cbr\\/\u003e\\nAlso, if I have to list out all the fields I\'m going to use, that\'s another big step backwards.\u003c\\/p\u003e\\n\\n\u003cp\u003eA factory would be a pretty straightforward way to increase the power, by allowing users to populate the entry through any mechanism, and optionally do extra calculations when the entry is populated (think statistics, sum-of-squares, etc).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910576_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910576_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T13:40:03+0000\'\u003e17\\/Sep\\/10 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I guess we need to be able to manually configure FieldCache with some kind of FieldType.  \\n\\n I don\'t know how well that would work.  For one, there\'s only one FieldCache, so configuring it with anything seems problematic. \\nAlso, if I have to list out all the fields I\'m going to use, that\'s another big step backwards. \\n\\n A factory would be a pretty straightforward way to increase the power, by allowing users to populate the entry through any mechanism, and optionally do extra calculations when the entry is populated (think statistics, sum-of-squares, etc).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910589\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910589&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910589\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12910589_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910589_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 13:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T13:59:13+0000\'\u003e17\\/Sep\\/10 13:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAlso, if I have to list out all the fields I\'m going to use, that\'s another big step backwards.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI don\'t think that this is needed at all neither would it be a step backwards - not even near to that. But since we aren\'t on an issue about FieldType lets just drop it...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eA factory would be a pretty straightforward way to increase the power, by allowing users to populate the entry through any mechanism, and optionally do extra calculations when the entry is populated (think statistics, sum-of-squares, etc).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWhatever you call it (using Factory is fine) but isn\'t that what you mentioned to be insufficient? I mean this is something you would pass to a FieldCache.getXXX, right? \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12910589_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910589_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 13:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T13:59:13+0000\'\u003e17\\/Sep\\/10 13:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Also, if I have to list out all the fields I\'m going to use, that\'s another big step backwards.  \\n I don\'t think that this is needed at all neither would it be a step backwards - not even near to that. But since we aren\'t on an issue about FieldType lets just drop it... \\n\\n  A factory would be a pretty straightforward way to increase the power, by allowing users to populate the entry through any mechanism, and optionally do extra calculations when the entry is populated (think statistics, sum-of-squares, etc).  \\n Whatever you call it (using Factory is fine) but isn\'t that what you mentioned to be insufficient? I mean this is something you would pass to a FieldCache.getXXX, right?               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910591\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910591&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910591\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12910591_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910591_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 14:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T14:01:30+0000\'\u003e17\\/Sep\\/10 14:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne thing I\'ve wanted to do for a long time, but didn\'t get to doing it, is open up FieldCache to allow the application to populate the entries from other sources - specifically pyloads. I wrote a sorting solution which relies solely on payloads, and wanted to contribute it to Lucene, but due to lack\'s of FieldCache hook points, I didn\'t find the time to do the necessary refactoring.\u003c\\/p\u003e\\n\\n\u003cp\u003eSorting based on payloads-data has several advantages:\u003c\\/p\u003e\\n\u003col\u003e\\n\\t\u003cli\u003eIt\'s much faster to read than iterating on the lexicon and parsing the term values into sortable values.\u003c\\/li\u003e\\n\\t\u003cli\u003eIf your application needs to cater sort over 10s of millions of documents, or if it needs to keep its RAM usage low, you can do the sort while reading the payload data as the search happens. It\'s faster than if it was in RAM, but the current FieldCache does not allow you to sort w\\/o RAM consumption.\u003c\\/li\u003e\\n\\t\u003cli\u003eYou don\'t inflate your lexicon w\\/ sort values, affecting other searches. In some situations, you can add a unique term per document for the sort values (such as when sorting by date and require up to a millisecond precision).\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cp\u003eI\'m bringing it up so that if you consider any refactoring to FieldCache, I\'d appreciate if you can keep that in mind. If the right hooks will open up, I\'ll make time to contribute my sort-by-payload package. If you don\'t, then it\'ll need to wait until I can find the time to do the refactoring.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12910591_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910591_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 14:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T14:01:30+0000\'\u003e17\\/Sep\\/10 14:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One thing I\'ve wanted to do for a long time, but didn\'t get to doing it, is open up FieldCache to allow the application to populate the entries from other sources - specifically pyloads. I wrote a sorting solution which relies solely on payloads, and wanted to contribute it to Lucene, but due to lack\'s of FieldCache hook points, I didn\'t find the time to do the necessary refactoring. \\n\\n Sorting based on payloads-data has several advantages: \\n \\n\\t It\'s much faster to read than iterating on the lexicon and parsing the term values into sortable values. \\n\\t If your application needs to cater sort over 10s of millions of documents, or if it needs to keep its RAM usage low, you can do the sort while reading the payload data as the search happens. It\'s faster than if it was in RAM, but the current FieldCache does not allow you to sort w\\/o RAM consumption. \\n\\t You don\'t inflate your lexicon w\\/ sort values, affecting other searches. In some situations, you can add a unique term per document for the sort values (such as when sorting by date and require up to a millisecond precision). \\n \\n\\n\\n I\'m bringing it up so that if you consider any refactoring to FieldCache, I\'d appreciate if you can keep that in mind. If the right hooks will open up, I\'ll make time to contribute my sort-by-payload package. If you don\'t, then it\'ll need to wait until I can find the time to do the refactoring. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910598\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910598&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910598\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910598_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910598_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T14:09:48+0000\'\u003e17\\/Sep\\/10 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhatever you call it (using Factory is fine) but isn\'t that what you mentioned to be insufficient? I mean this is something you would pass to a FieldCache.getXXX, right? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI was suggesting handling it the same way as FieldCache.Parser - it\'s set on the SortField.  But instead of just being able to control parsing of a term (which is too limited), it needs to be able to control everything. (This would solve Shai\'s needs too)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910598_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910598_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 14:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T14:09:48+0000\'\u003e17\\/Sep\\/10 14:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Whatever you call it (using Factory is fine) but isn\'t that what you mentioned to be insufficient? I mean this is something you would pass to a FieldCache.getXXX, right?   \\n\\n I was suggesting handling it the same way as FieldCache.Parser - it\'s set on the SortField.  But instead of just being able to control parsing of a term (which is too limited), it needs to be able to control everything. (This would solve Shai\'s needs too)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910599\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910599&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910599\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910599_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910599_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 14:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T14:14:19+0000\'\u003e17\\/Sep\\/10 14:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eopen up FieldCache to allow the application to populate the entries from other sources\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003especifically payloads\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf CSF did not exist, I\'d be totally on board with this...  but it looks to be right around the corner now.  Are there any advantages to using payloads over CSF for fieldcache population?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910599_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910599_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 14:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T14:14:19+0000\'\u003e17\\/Sep\\/10 14:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     open up FieldCache to allow the application to populate the entries from other sources  \\n\\n +1 \\n\\n  specifically payloads  \\n\\n If CSF did not exist, I\'d be totally on board with this...  but it looks to be right around the corner now.  Are there any advantages to using payloads over CSF for fieldcache population?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910618\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910618&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910618\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910618_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910618_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:12:52+0000\'\u003e17\\/Sep\\/10 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is a band-aid, but we could consider adding something like:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void setCacheValidBitsForFields( Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt; names );\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eon FieldCache, then checking if the field is in that set before making the BitSet\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen solr reads the schema, it could look for any fields have sortMissingLast and then call:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  FieldCache.DEFAULT.setCacheValidBitsForFields()\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe factory idea also sounds good, but i don\'t see how would work without big big changes\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910618_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910618_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:12:52+0000\'\u003e17\\/Sep\\/10 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is a band-aid, but we could consider adding something like: \\n  \\n    public  void setCacheValidBitsForFields( Set&lt; String &gt; names );\\n \\n  \\n on FieldCache, then checking if the field is in that set before making the BitSet \\n\\n When solr reads the schema, it could look for any fields have sortMissingLast and then call: \\n  \\n   FieldCache.DEFAULT.setCacheValidBitsForFields()\\n \\n  \\n\\n The factory idea also sounds good, but i don\'t see how would work without big big changes              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910625\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910625&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910625\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12910625_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910625_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:20:01+0000\'\u003e17\\/Sep\\/10 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAre there any advantages to using payloads over CSF for fieldcache population?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWell .. payloads already exist (in my code \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e), while CSF is \\\"just around the corner\\\" for a long time. While the two ultimately achieve the same goal, CSF is more generic than just payloads, and if we\'d want to take advantage of it w\\/ FieldCache, I assume we\'ll need to make more changes to FieldCache, because w\\/ CSF, people can store arbitrary byte[] and request to cache them. So sorting data is a subset of CSF indeed, but I think the road to CSF + CSF-FieldCache integration is long. But perhaps I\'m not up-to-date and there is progress \\/ someone actually working on CSF?\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, opening up FC to read from payloads seems to me a much easier solution, because besides reading the stuff from the payload, the rest of the classes continue to work the same (TopFieldCollector, Comparators etc.).\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe a slight change to SortField will be required as well though, not sure yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shaie\\\" id=\\\"commentauthor_12910625_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shaie\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shaie\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shai Erera\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910625_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:20:01+0000\'\u003e17\\/Sep\\/10 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Are there any advantages to using payloads over CSF for fieldcache population?  \\n\\n Well .. payloads already exist (in my code  ), while CSF is \\\"just around the corner\\\" for a long time. While the two ultimately achieve the same goal, CSF is more generic than just payloads, and if we\'d want to take advantage of it w\\/ FieldCache, I assume we\'ll need to make more changes to FieldCache, because w\\/ CSF, people can store arbitrary byte[] and request to cache them. So sorting data is a subset of CSF indeed, but I think the road to CSF + CSF-FieldCache integration is long. But perhaps I\'m not up-to-date and there is progress \\/ someone actually working on CSF? \\n\\n Anyway, opening up FC to read from payloads seems to me a much easier solution, because besides reading the stuff from the payload, the rest of the classes continue to work the same (TopFieldCollector, Comparators etc.). \\n\\n Maybe a slight change to SortField will be required as well though, not sure yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910628\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910628&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910628\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910628_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910628_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:23:12+0000\'\u003e17\\/Sep\\/10 15:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUwe: \\\"For DocTerms the approach is not needed...\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eYa I realized this after looking at the patch I first submitted.  In the first patch, the cache holds a CachedObject rather then just an Object.  In the second, I changed back to just an Object so it does not need to wrap the DocTerms or DocTermsIndex\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the RangeFilter, with optional Bits calculation, that could would look somethign like:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n        LongValues cached = FieldCache.DEFAULT.getLongValues(reader, field, (FieldCache.LongParser) parser);\\n        \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003elong\u003c\\/span\u003e[] values = cached.values;\\n        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( cached.valid == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n          \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ ignore deleted docs \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e range doesn\'t contain 0\\n\u003c\\/span\u003e          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e FieldCacheDocIdSet(reader, !(inclusiveLowerPoint &lt;= 0L &amp;&amp; inclusiveUpperPoint &gt;= 0L)) {\\n            @Override\\n            \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e matchDoc(\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e doc) {\\n              \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e values[doc] &gt;= inclusiveLowerPoint &amp;&amp; values[doc] &lt;= inclusiveUpperPoint;\\n            }\\n          };\\n        }\\n        \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n          \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Bits valid = cached.valid;\\n          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e FieldCacheDocIdSet(reader, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e) {\\n            @Override\\n            \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e matchDoc(\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e doc) {\\n              \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e valid.get(doc) &amp;&amp; values[doc] &gt;= inclusiveLowerPoint &amp;&amp; values[doc] &lt;= inclusiveUpperPoint;\\n            }\\n          };\\n        }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910628_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910628_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:23:12+0000\'\u003e17\\/Sep\\/10 15:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uwe: \\\"For DocTerms the approach is not needed...\\\" \\n\\n Ya I realized this after looking at the patch I first submitted.  In the first patch, the cache holds a CachedObject rather then just an Object.  In the second, I changed back to just an Object so it does not need to wrap the DocTerms or DocTermsIndex \\n\\n For the RangeFilter, with optional Bits calculation, that could would look somethign like: \\n  \\n \\n        LongValues cached = FieldCache.DEFAULT.getLongValues(reader, field, (FieldCache.LongParser) parser);\\n         final   long [] values = cached.values;\\n         if ( cached.valid ==  null  ) {\\n           \\/\\/ ignore deleted docs  if  range doesn\'t contain 0\\n            return   new  FieldCacheDocIdSet(reader, !(inclusiveLowerPoint &lt;= 0L &amp;&amp; inclusiveUpperPoint &gt;= 0L)) {\\n            @Override\\n             boolean  matchDoc( int  doc) {\\n               return  values[doc] &gt;= inclusiveLowerPoint &amp;&amp; values[doc] &lt;= inclusiveUpperPoint;\\n            }\\n          };\\n        }\\n         else  {\\n           final  Bits valid = cached.valid;\\n           return   new  FieldCacheDocIdSet(reader,  true ) {\\n            @Override\\n             boolean  matchDoc( int  doc) {\\n               return  valid.get(doc) &amp;&amp; values[doc] &gt;= inclusiveLowerPoint &amp;&amp; values[doc] &lt;= inclusiveUpperPoint;\\n            }\\n          };\\n        }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910635\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910635&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910635\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910635_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910635_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:41:21+0000\'\u003e17\\/Sep\\/10 15:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003epublic void setCacheValidBitsForFields( Set&lt;String&gt; names );\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSolr doesn\'t even know all of the fields at the time it reads it\'s schema.  And even if it did... this would seem to break multi-core or anything trying to have more than one index where the fields are different.  Seems like this needs to be passed down via SortField, just like FieldCache.Parser.  A factory makes this a more generic method than adding additional params to SortField every time we think of something like this... then we can add stuff like getFieldCacheParser() and other stuff to the factory.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910635_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910635_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:41:21+0000\'\u003e17\\/Sep\\/10 15:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     public void setCacheValidBitsForFields( Set&lt;String&gt; names );  \\n\\n Solr doesn\'t even know all of the fields at the time it reads it\'s schema.  And even if it did... this would seem to break multi-core or anything trying to have more than one index where the fields are different.  Seems like this needs to be passed down via SortField, just like FieldCache.Parser.  A factory makes this a more generic method than adding additional params to SortField every time we think of something like this... then we can add stuff like getFieldCacheParser() and other stuff to the factory.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910640\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910640&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910640\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910640_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910640_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:52:38+0000\'\u003e17\\/Sep\\/10 15:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eoh right &#8211; thats true.  Is a global flag sufficient?  \u003c\\/p\u003e\\n\\n\u003cp\u003eIn lucene it could default to false and in solr default to true.\u003c\\/p\u003e\\n\\n\u003cp\u003eI know we don\'t want to just keep adding more things to memory, but I\'m not sure there is a huge win by selectively enabling and disabling some fields.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910640_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910640_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 15:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T15:52:38+0000\'\u003e17\\/Sep\\/10 15:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    oh right &#8211; thats true.  Is a global flag sufficient?   \\n\\n In lucene it could default to false and in solr default to true. \\n\\n I know we don\'t want to just keep adding more things to memory, but I\'m not sure there is a huge win by selectively enabling and disabling some fields.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910645\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910645&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910645\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910645_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910645_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:00:49+0000\'\u003e17\\/Sep\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eoh right - thats true. Is a global flag sufficient? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah, solr could just always default it to on.  We don\'t know what kind of ad-hoc queries people will throw at solr and the 3% size increase (general case 1\\/32) seems completely worth it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910645_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910645_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:00:49+0000\'\u003e17\\/Sep\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     oh right - thats true. Is a global flag sufficient?   \\n\\n Yeah, solr could just always default it to on.  We don\'t know what kind of ad-hoc queries people will throw at solr and the 3% size increase (general case 1\\/32) seems completely worth it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910652\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910652&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910652\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910652_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910652_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:31:54+0000\'\u003e17\\/Sep\\/10 16:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI added a static flag to CachedArray:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eCachedArray {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e CACHE_VALID_ARRAY_BITS = \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n    \\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Bits valid;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e CachedArray( Bits valid ) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.valid = valid;\\n    }\\n  };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eand then set it to true in the SolrCore static initalizer.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf folks are ok with this approach, I\'ll clean up the javadocs etc\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910652_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910652_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:31:54+0000\'\u003e17\\/Sep\\/10 16:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I added a static flag to CachedArray: \\n  \\n    public   abstract   static   class  CachedArray {\\n     public   static   boolean  CACHE_VALID_ARRAY_BITS =  false ;\\n    \\n     public   final  Bits valid;\\n     public  CachedArray( Bits valid ) {\\n       this .valid = valid;\\n    }\\n  };\\n \\n  \\n and then set it to true in the SolrCore static initalizer. \\n\\n If folks are ok with this approach, I\'ll clean up the javadocs etc              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910653\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910653&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910653\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910653_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910653_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:33:19+0000\'\u003e17\\/Sep\\/10 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFYI, I like the idea of revisiting the FieldCache, but i don\'t see a straightforward path.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910653_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910653_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:33:19+0000\'\u003e17\\/Sep\\/10 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FYI, I like the idea of revisiting the FieldCache, but i don\'t see a straightforward path.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910654\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910654&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910654\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910654_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910654_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:43:55+0000\'\u003e17\\/Sep\\/10 16:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am against the configuration option to enable the additional BitSet. The problem is that you cannot control it for each usage for the FieldCache, as it is a static flag. We agreed in the past that we will remove all static defaults from Lucene (e.g. BQ.maxClauseCount) together with sytem properties. This flag can cause strange problems with 3rd party code (like when you lower the BQ maxClauseCount and suddenly your queries fail).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe overhead by the OpenBitSet is very marginal (for integers only 1\\/32, as Yonik said). If you have memory problems with the FieldCache, these 1\\/32 would not hurt you, as you should think about your whole configuration then (liek moving from ints to shorts or something like that).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo: Please don\'t add any static defaults or sysprops! Please, please, please!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910654_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910654_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:43:55+0000\'\u003e17\\/Sep\\/10 16:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am against the configuration option to enable the additional BitSet. The problem is that you cannot control it for each usage for the FieldCache, as it is a static flag. We agreed in the past that we will remove all static defaults from Lucene (e.g. BQ.maxClauseCount) together with sytem properties. This flag can cause strange problems with 3rd party code (like when you lower the BQ maxClauseCount and suddenly your queries fail). \\n\\n The overhead by the OpenBitSet is very marginal (for integers only 1\\/32, as Yonik said). If you have memory problems with the FieldCache, these 1\\/32 would not hurt you, as you should think about your whole configuration then (liek moving from ints to shorts or something like that). \\n\\n So: Please don\'t add any static defaults or sysprops! Please, please, please!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910660\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910660&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910660\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12910660_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910660_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:56:44+0000\'\u003e17\\/Sep\\/10 16:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI was suggesting handling it the same way as FieldCache.Parser - it\'s set on the SortField. But instead of just being able to control parsing of a term (which is too limited), it needs to be able to control everything. (This would solve Shai\'s needs too)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe started down this path with \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-831\\\" title=\\\"Complete overhaul of FieldCache API\\/Implementation\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-831\\\"\u003eLUCENE-831\u003c\\/a\u003e - you could pass some *UnInverter on the sort field if i remember right, so that pretty much everything could be overridden. It has come up a lot - we really need this level of customizability eventually.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_12910660_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910660_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 16:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T16:56:44+0000\'\u003e17\\/Sep\\/10 16:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I was suggesting handling it the same way as FieldCache.Parser - it\'s set on the SortField. But instead of just being able to control parsing of a term (which is too limited), it needs to be able to control everything. (This would solve Shai\'s needs too)  \\n\\n We started down this path with  LUCENE-831  - you could pass some *UnInverter on the sort field if i remember right, so that pretty much everything could be overridden. It has come up a lot - we really need this level of customizability eventually.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910663\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910663&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910663\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910663_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910663_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T17:00:46+0000\'\u003e17\\/Sep\\/10 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m all for dropping the static flag and always calculating the valid bits &#8211; it makes things accurate with minimal cost.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI am sympathetic to folks who don\'t want this, and I\'m not sure the cleanest way to support both options, or even if it is actually worthwhile.\u003c\\/p\u003e\\n\\n\u003cp\u003eDo people see this \'option\' as a showstopper?  If so, is there an easy way to configure?  without statics, the flag would need to be fetched from each parser, and the parser does not know what FieldCache it is used from (using FieldCache.DEFAULT is just as bad as the static flag IIUC)\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910663_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910663_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T17:00:46+0000\'\u003e17\\/Sep\\/10 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m all for dropping the static flag and always calculating the valid bits &#8211; it makes things accurate with minimal cost.   \\n\\n I am sympathetic to folks who don\'t want this, and I\'m not sure the cleanest way to support both options, or even if it is actually worthwhile. \\n\\n Do people see this \'option\' as a showstopper?  If so, is there an easy way to configure?  without statics, the flag would need to be fetched from each parser, and the parser does not know what FieldCache it is used from (using FieldCache.DEFAULT is just as bad as the static flag IIUC) \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910668\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910668&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910668\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"creamyg\\\" id=\\\"commentauthor_12910668_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=creamyg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"creamyg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Marvin Humphrey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910668_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T17:11:47+0000\'\u003e17\\/Sep\\/10 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; So: Please don\'t add any static defaults or sysprops! Please, please, please!\u003c\\/p\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cp\u003eNo global variables which control behavior, please.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"creamyg\\\" id=\\\"commentauthor_12910668_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=creamyg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"creamyg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Marvin Humphrey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910668_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 17:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T17:11:47+0000\'\u003e17\\/Sep\\/10 17:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; So: Please don\'t add any static defaults or sysprops! Please, please, please! \\n\\n +1 \\n\\n No global variables which control behavior, please.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910677\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910677&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910677\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12910677_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910677_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T17:28:26+0000\'\u003e17\\/Sep\\/10 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI know it\'s only 3% (for ints... 12.5% for bytes), but, 3% here, 3% there and suddenly we\'re talking real money.\u003c\\/p\u003e\\n\\n\u003cp\u003eLucene can only stay lean and mean if we don\'t allow these little 3% losses here and there!!\u003c\\/p\u003e\\n\\n\u003cp\u003eLet\'s try to find some baby-step (even if not clean &#8211; we know FieldCache, somehow, needs to be fixed more generally) for today?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12910677_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910677_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T17:28:26+0000\'\u003e17\\/Sep\\/10 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I know it\'s only 3% (for ints... 12.5% for bytes), but, 3% here, 3% there and suddenly we\'re talking real money. \\n\\n Lucene can only stay lean and mean if we don\'t allow these little 3% losses here and there!! \\n\\n Let\'s try to find some baby-step (even if not clean &#8211; we know FieldCache, somehow, needs to be fixed more generally) for today?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910699\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910699&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910699\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910699_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910699_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:01:14+0000\'\u003e17\\/Sep\\/10 18:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 17\\/Sep\\/10 18:01\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eLet\'s try to find some baby-step (even if not clean - we know FieldCache, somehow, needs to be fixed more generally) for today?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe cheapest option might be:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003einterface\u003c\\/span\u003e Parser \u003cspan class=\\\"code-keyword\\\"\u003eextends\u003c\\/span\u003e Serializable {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e recordMissing();\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eA better option is to replace FieldCache.Parser in SortField to be FieldCache.EntryCreator.\u003c\\/p\u003e\\n\\n\u003cp\u003eOh, and if we\'re recording all the set bits, it would be really nice to record both\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe number of values set\u003c\\/li\u003e\\n\\t\u003cli\u003ethe number of unique values encountered\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eBoth should be zero or non-measurable cost (a counter++ that does not produce a data dependency can be executed in parallel on a free int execution unit)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910699_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910699_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:01:14+0000\'\u003e17\\/Sep\\/10 18:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 17\\/Sep\\/10 18:01\\\"\u003eedited\u003c\\/span\u003e                    Let\'s try to find some baby-step (even if not clean - we know FieldCache, somehow, needs to be fixed more generally) for today?  \\n\\n The cheapest option might be: \\n\\n  \\n    public   interface  Parser  extends  Serializable {\\n     public   boolean  recordMissing();\\n  }\\n \\n  \\n\\n A better option is to replace FieldCache.Parser in SortField to be FieldCache.EntryCreator. \\n\\n Oh, and if we\'re recording all the set bits, it would be really nice to record both \\n \\n\\t the number of values set \\n\\t the number of unique values encountered \\n \\n\\n\\n Both should be zero or non-measurable cost (a counter++ that does not produce a data dependency can be executed in parallel on a free int execution unit)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910700\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910700&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910700\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910700_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910700_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:02:10+0000\'\u003e17\\/Sep\\/10 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAre people generally ok with the idea of global on\\/off?  I think that is a reasonable approach... I agree that we should avoid static fields to control behavior.  But do we avoid it at the cost of not allowing the option, or waiting till we rework FieldCache?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf the consensus is that FieldCache needs to be reworked \u003cb\u003ebefore\u003c\\/b\u003e somethign like this could be added, that\'s fine... i\'ll move on to other things.  Any relatively easy suggestions for how to enable the option without a global static?  (Note that FieldCache is already a global static &#8211; at leaset FieldCache.DEFAULT is referenced a lot)\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps this could\\/should live in \\/trunk until a cleaner solution is viable?\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910700_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910700_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:02:10+0000\'\u003e17\\/Sep\\/10 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Are people generally ok with the idea of global on\\/off?  I think that is a reasonable approach... I agree that we should avoid static fields to control behavior.  But do we avoid it at the cost of not allowing the option, or waiting till we rework FieldCache? \\n\\n If the consensus is that FieldCache needs to be reworked  before  somethign like this could be added, that\'s fine... i\'ll move on to other things.  Any relatively easy suggestions for how to enable the option without a global static?  (Note that FieldCache is already a global static &#8211; at leaset FieldCache.DEFAULT is referenced a lot) \\n\\n Perhaps this could\\/should live in \\/trunk until a cleaner solution is viable? \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910707\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910707&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910707\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910707_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910707_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:11:14+0000\'\u003e17\\/Sep\\/10 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 17\\/Sep\\/10 18:11\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am against that option! No static defaults! (and if it \u003cb\u003emust\u003c\\/b\u003e be there - default it to true on Lucene, too).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ethe number of values set \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is OpenBitSet.cardinality() ? I dont think we should add this extra cost during creation, as it can be retrieved quite easy if really needed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910707_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910707_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:11:14+0000\'\u003e17\\/Sep\\/10 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 17\\/Sep\\/10 18:11\\\"\u003eedited\u003c\\/span\u003e                   I am against that option! No static defaults! (and if it  must  be there - default it to true on Lucene, too). \\n\\n  the number of values set   \\n\\n This is OpenBitSet.cardinality() ? I dont think we should add this extra cost during creation, as it can be retrieved quite easy if really needed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910711\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910711&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910711\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910711_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910711_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:15:49+0000\'\u003e17\\/Sep\\/10 18:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI like the idea of optionally caching the numdocs and unique values &#8211; that would make sorting by this field faster &#8211; the ArrayValues class could be easily augmented with this.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe problem with augmenting the Parser class as you suggest is that we would have to rejiggy everything that touches parser.  We would need different default classes for things that want or don\'t want the missing records.  How do we handle this big:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (parser == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e wrapper.getIntValues(reader, field, DEFAULT_INT_PARSER);\\n        } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (NumberFormatException ne) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e wrapper.getIntValues(reader, field, NUMERIC_UTILS_INT_PARSER);      \\n        }\\n      }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eyuck\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910711_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910711_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:15:49+0000\'\u003e17\\/Sep\\/10 18:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I like the idea of optionally caching the numdocs and unique values &#8211; that would make sorting by this field faster &#8211; the ArrayValues class could be easily augmented with this. \\n\\n The problem with augmenting the Parser class as you suggest is that we would have to rejiggy everything that touches parser.  We would need different default classes for things that want or don\'t want the missing records.  How do we handle this big: \\n  \\n  if  (parser ==  null ) {\\n         try  {\\n           return  wrapper.getIntValues(reader, field, DEFAULT_INT_PARSER);\\n        }  catch  (NumberFormatException ne) {\\n           return  wrapper.getIntValues(reader, field, NUMERIC_UTILS_INT_PARSER);      \\n        }\\n      }\\n \\n  \\n yuck              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910717\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910717&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910717\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910717_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910717_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:26:58+0000\'\u003e17\\/Sep\\/10 18:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf ya care - don\'t pass a null parser!  Otherwise you get the default.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThis is OpenBitSet.cardinality()\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhich isn\'t free... and calculating it over and over again is silly if you care about those numbers.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI dont think we should add this extra cost during creation,\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t think it will add extra cost.  I could be wrong, but I don\'t think it will be measurable.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910717_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910717_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:26:58+0000\'\u003e17\\/Sep\\/10 18:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If ya care - don\'t pass a null parser!  Otherwise you get the default. \\n\\n  This is OpenBitSet.cardinality()  \\n\\n Which isn\'t free... and calculating it over and over again is silly if you care about those numbers. \\n\\n  I dont think we should add this extra cost during creation,  \\n\\n I don\'t think it will add extra cost.  I could be wrong, but I don\'t think it will be measurable.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910728\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910728&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910728\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910728_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910728_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:49:44+0000\'\u003e17\\/Sep\\/10 18:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf ya care - don\'t pass a null parser! Otherwise you get the default. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhat if I care, but somethign else (that does not care) asks for the value first?  Seems odd to have so much depend on \u003cb\u003ewho\u003c\\/b\u003e asks for the value first\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eA better option is to replace FieldCache.Parser in SortField to be FieldCache.EntryCreator.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHow would that work?  What if a filter creates the cache before the SortField?  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910728_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910728_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 18:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T18:49:44+0000\'\u003e17\\/Sep\\/10 18:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If ya care - don\'t pass a null parser! Otherwise you get the default.   \\n\\n What if I care, but somethign else (that does not care) asks for the value first?  Seems odd to have so much depend on  who  asks for the value first \\n\\n  A better option is to replace FieldCache.Parser in SortField to be FieldCache.EntryCreator.  \\n\\n How would that work?  What if a filter creates the cache before the SortField?                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910736\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910736&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910736\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910736_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910736_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 19:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T19:04:18+0000\'\u003e17\\/Sep\\/10 19:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat if I care, but somethign else (that does not care) asks for the value first? Seems odd to have so much depend on who asks for the value first\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAs long as it \u003cb\u003ecan\u003c\\/b\u003e be passed everywhere that matters, then it\'s up to the application - which knows if it ever needs the missing values or not for that field.  For solr, we could make it configurable per-field... but I\'d prob default it to ON to avoid unpredictable weirdness.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhat if a filter creates the cache before the SortField?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf we have a filter that uses the field cache, then it should also be able to specify the same stuff that SortField can.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910736_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910736_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 19:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T19:04:18+0000\'\u003e17\\/Sep\\/10 19:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What if I care, but somethign else (that does not care) asks for the value first? Seems odd to have so much depend on who asks for the value first  \\n\\n As long as it  can  be passed everywhere that matters, then it\'s up to the application - which knows if it ever needs the missing values or not for that field.  For solr, we could make it configurable per-field... but I\'d prob default it to ON to avoid unpredictable weirdness. \\n\\n  What if a filter creates the cache before the SortField?  \\n\\n If we have a filter that uses the field cache, then it should also be able to specify the same stuff that SortField can.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910740\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910740&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910740\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910740_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910740_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T19:17:06+0000\'\u003e17\\/Sep\\/10 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI agree that we should avoid static fields to control behavior. But do we avoid it at the cost of not allowing the option, or waiting till we rework FieldCache?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree with this sentiment - progress, not perfection.  Being able to turn it on or off for everything in the process is better than nothing at all.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910740_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910740_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T19:17:06+0000\'\u003e17\\/Sep\\/10 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I agree that we should avoid static fields to control behavior. But do we avoid it at the cost of not allowing the option, or waiting till we rework FieldCache?  \\n\\n I agree with this sentiment - progress, not perfection.  Being able to turn it on or off for everything in the process is better than nothing at all.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910746\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910746&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910746\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910746_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910746_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 19:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T19:34:39+0000\'\u003e17\\/Sep\\/10 19:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHow would that work?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe could start off simple - add only recordMissing functionallity and punt on the rest, while still leaving a place to add it.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eFieldCache {\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eEntryCreator {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e recordMissing() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n    }\\n    \\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e Parser getParser();\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eNot even sure if a whole hierarchy is needed at this point... in the future, we\'d prob want\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e EntryCreatorInt \u003cspan class=\\\"code-keyword\\\"\u003eextends\u003c\\/span\u003e EntryCreator {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e IntValues getIntValues(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {... code currently in FieldCacheImpl that fills the fieldCahe...}\\n    ...\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12910746_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910746_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 19:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T19:34:39+0000\'\u003e17\\/Sep\\/10 19:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     How would that work?  \\n\\n We could start off simple - add only recordMissing functionallity and punt on the rest, while still leaving a place to add it. \\n\\n  \\n  class  FieldCache {\\n\\n   public   static   class  EntryCreator {\\n     public   boolean  recordMissing() {\\n       return   false ;\\n    }\\n    \\n     public   abstract  Parser getParser();\\n  }\\n \\n  \\n\\n Not even sure if a whole hierarchy is needed at this point... in the future, we\'d prob want \\n\\n  \\n    public   static  EntryCreatorInt  extends  EntryCreator {\\n     public  IntValues getIntValues(IndexReader reader,  String  field) {... code currently in FieldCacheImpl that fills the fieldCahe...}\\n    ...\\n  }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910803\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910803&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910803\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910803_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910803_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 21:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T21:45:15+0000\'\u003e17\\/Sep\\/10 21:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMaybe, but I\'m still not sure this cleans things up enough to be worth the trouble &#8211; ideally the API should be easy to have consistent results.  I don\'t like that it would be too easy to mess things up if you the application does not use the same parser from various components (that may be in different libraries etc).  Conceptually it makes sense to have settings about what is or is not cached attached to the FieldCache itself, not to the things that ask the FieldCache for its values &#8211; and letting whoever asks first set the behavior for the next guy who asks (regardless of what they ask for!).  \u003c\\/p\u003e\\n\\n\u003cp\u003eIf we are going to make it essentially required to always pass in the right Parser\\/EntryCreator, we should at least remove all the ways of not passing one in &#8211; since that call is saying \\\"use what ever is there, and the next guy who asks should be ok with it too\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes something like the EntryCreator idea fix &#8211; or at least begin to fix &#8211; the other FieldCache issues?  If not, is it really worth introducing just to avoid a static variable?\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the best near term option is live with the static initializer, and fix it when the we rework the FieldCache to fix a host of other issues.  For solr the default will be set to always calculate, for lucene... we will let Mike and Uwe duke it out \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12910803_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910803_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 21:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T21:45:15+0000\'\u003e17\\/Sep\\/10 21:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Maybe, but I\'m still not sure this cleans things up enough to be worth the trouble &#8211; ideally the API should be easy to have consistent results.  I don\'t like that it would be too easy to mess things up if you the application does not use the same parser from various components (that may be in different libraries etc).  Conceptually it makes sense to have settings about what is or is not cached attached to the FieldCache itself, not to the things that ask the FieldCache for its values &#8211; and letting whoever asks first set the behavior for the next guy who asks (regardless of what they ask for!).   \\n\\n If we are going to make it essentially required to always pass in the right Parser\\/EntryCreator, we should at least remove all the ways of not passing one in &#8211; since that call is saying \\\"use what ever is there, and the next guy who asks should be ok with it too\\\" \\n\\n Does something like the EntryCreator idea fix &#8211; or at least begin to fix &#8211; the other FieldCache issues?  If not, is it really worth introducing just to avoid a static variable? \\n\\n I think the best near term option is live with the static initializer, and fix it when the we rework the FieldCache to fix a host of other issues.  For solr the default will be set to always calculate, for lucene... we will let Mike and Uwe duke it out   \\n\\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12910805\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12910805&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12910805\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910805_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910805_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 21:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T21:51:07+0000\'\u003e17\\/Sep\\/10 21:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSupporting different parsers is not an issue at all. You can call getBytes() with different parsers, you simply create two entries in the cache, as each parser produces a different cache instance. And getBytes() without parser is also fine, as then you get the default parser from the cache (which would not create a third instance!). - \u003cspan class=\\\"error\\\"\u003e&#91;Parser is part of the cache key&#93;\u003c\\/span\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12910805_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12910805_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Sep\\/10 21:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-17T21:51:07+0000\'\u003e17\\/Sep\\/10 21:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Supporting different parsers is not an issue at all. You can call getBytes() with different parsers, you simply create two entries in the cache, as each parser produces a different cache instance. And getBytes() without parser is also fine, as then you get the default parser from the cache (which would not create a third instance!). -  &#91;Parser is part of the cache key&#93;               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12911128\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12911128&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12911128\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12911128_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12911128_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/10 00:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-19T00:21:34+0000\'\u003e19\\/Sep\\/10 00:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI thought of  an optimization that could reduce memory usage...  \u003c\\/p\u003e\\n\\n\u003cp\u003eIf all non-deleted documents have a value, we don\'t need a real BitSet &#8211; just a Bits implementation that always returns true.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat should save 3% (or 12.5%) here and there.\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003e- - - - -\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eOn other thing to consider... do we want to remove the getXXXX functions that do not pass in a Parser?  passing in null, is equivalent?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12911128_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12911128_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/10 00:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-19T00:21:34+0000\'\u003e19\\/Sep\\/10 00:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I thought of  an optimization that could reduce memory usage...   \\n\\n If all non-deleted documents have a value, we don\'t need a real BitSet &#8211; just a Bits implementation that always returns true. \\n\\n That should save 3% (or 12.5%) here and there. \\n\\n \\n\\t - - - - - \\n \\n\\n\\n On other thing to consider... do we want to remove the getXXXX functions that do not pass in a Parser?  passing in null, is equivalent?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12911157\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12911157&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12911157\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12911157_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12911157_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/10 03:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-19T03:44:12+0000\'\u003e19\\/Sep\\/10 03:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is the code for ByteValues that:\u003c\\/p\u003e\\n\u003col\u003e\\n\\t\u003cli\u003eoptionally stores the BitSet via static config\u003c\\/li\u003e\\n\\t\u003cli\u003edoes not cache a real BitSet unless only some docs match\u003c\\/li\u003e\\n\\t\u003cli\u003ecalculates numDocs\\/numTerms\u003c\\/li\u003e\\n\u003c\\/ol\u003e\\n\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n    @Override\\n    \u003cspan class=\\\"code-keyword\\\"\u003eprotected\u003c\\/span\u003e ByteValues createValue(IndexReader reader, Entry entryKey) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n      Entry entry = entryKey;\\n      \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field = entry.field;\\n      ByteParser parser = (ByteParser) entry.custom;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (parser == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e wrapper.getByteValues(reader, field, FieldCache.DEFAULT_BYTE_PARSER);\\n      }\\n      \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e numDocs = 0;\\n      \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e numTerms = 0;\\n      \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e maxDoc = reader.maxDoc();\\n      \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[] retArray = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[maxDoc];\\n      Bits valid = \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n      Terms terms = MultiFields.getTerms(reader, field);\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (terms != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e TermsEnum termsEnum = terms.iterator();\\n        \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Bits delDocs = MultiFields.getDeletedDocs(reader);\\n        \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e OpenBitSet validBits = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e OpenBitSet( maxDoc );\\n        DocsEnum docs = \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n        \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n          \u003cspan class=\\\"code-keyword\\\"\u003ewhile\u003c\\/span\u003e(\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e BytesRef term = termsEnum.next();\\n            \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (term == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n              \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n            }\\n            \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e termval = parser.parseByte(term);\\n            docs = termsEnum.docs(delDocs, docs);\\n            \u003cspan class=\\\"code-keyword\\\"\u003ewhile\u003c\\/span\u003e (\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e) {\\n              \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e docID = docs.nextDoc();\\n              \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (docID == DocsEnum.NO_MORE_DOCS) {\\n                \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n              }\\n              retArray[docID] = termval;\\n              validBits.set( docID );\\n              numDocs++;\\n            }\\n            numTerms++;\\n          }\\n        } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (StopFillCacheException stop) {}\\n        \\n        \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ If all non-deleted docs are valid we don\'t need the bitset in memory\\n\u003c\\/span\u003e        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( numDocs &gt; 0 &amp;&amp; CachedArray.CACHE_VALID_ARRAY_BITS ) {\\n          \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e matchesAllDocs = \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e;\\n          \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e( \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e i=0; i&lt;maxDoc; i++ ) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( !delDocs.get(i) &amp;&amp; !validBits.get(i) ) {\\n              matchesAllDocs = \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n              \u003cspan class=\\\"code-keyword\\\"\u003ebreak\u003c\\/span\u003e;\\n            }\\n          }\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( matchesAllDocs ) {\\n            valid = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Bits.MatchAllBits( maxDoc );\\n          }\\n          \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n            valid = validBits;\\n          }\\n        }\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( numDocs &lt; 1 ) {\\n        valid = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Bits.MatchNoBits( maxDoc );\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ByteValues( retArray, valid, numDocs, numTerms );\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12911157_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12911157_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Sep\\/10 03:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-19T03:44:12+0000\'\u003e19\\/Sep\\/10 03:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is the code for ByteValues that: \\n \\n\\t optionally stores the BitSet via static config \\n\\t does not cache a real BitSet unless only some docs match \\n\\t calculates numDocs\\/numTerms \\n \\n\\n\\n  \\n \\n    @Override\\n     protected  ByteValues createValue(IndexReader reader, Entry entryKey)  throws  IOException {\\n      Entry entry = entryKey;\\n       String  field = entry.field;\\n      ByteParser parser = (ByteParser) entry.custom;\\n       if  (parser ==  null ) {\\n         return  wrapper.getByteValues(reader, field, FieldCache.DEFAULT_BYTE_PARSER);\\n      }\\n       int  numDocs = 0;\\n       int  numTerms = 0;\\n       int  maxDoc = reader.maxDoc();\\n       final   byte [] retArray =  new   byte [maxDoc];\\n      Bits valid =  null ;\\n      Terms terms = MultiFields.getTerms(reader, field);\\n       if  (terms !=  null ) {\\n         final  TermsEnum termsEnum = terms.iterator();\\n         final  Bits delDocs = MultiFields.getDeletedDocs(reader);\\n         final  OpenBitSet validBits =  new  OpenBitSet( maxDoc );\\n        DocsEnum docs =  null ;\\n         try  {\\n           while ( true ) {\\n             final  BytesRef term = termsEnum.next();\\n             if  (term ==  null ) {\\n               break ;\\n            }\\n             final   byte  termval = parser.parseByte(term);\\n            docs = termsEnum.docs(delDocs, docs);\\n             while  ( true ) {\\n               final   int  docID = docs.nextDoc();\\n               if  (docID == DocsEnum.NO_MORE_DOCS) {\\n                 break ;\\n              }\\n              retArray[docID] = termval;\\n              validBits.set( docID );\\n              numDocs++;\\n            }\\n            numTerms++;\\n          }\\n        }  catch  (StopFillCacheException stop) {}\\n        \\n         \\/\\/ If all non-deleted docs are valid we don\'t need the bitset in memory\\n          if ( numDocs &gt; 0 &amp;&amp; CachedArray.CACHE_VALID_ARRAY_BITS ) {\\n           boolean  matchesAllDocs =  true ;\\n           for (  int  i=0; i&lt;maxDoc; i++ ) {\\n             if ( !delDocs.get(i) &amp;&amp; !validBits.get(i) ) {\\n              matchesAllDocs =  false ;\\n               break ;\\n            }\\n          }\\n           if ( matchesAllDocs ) {\\n            valid =  new  Bits.MatchAllBits( maxDoc );\\n          }\\n           else  {\\n            valid = validBits;\\n          }\\n        }\\n      }\\n       if ( numDocs &lt; 1 ) {\\n        valid =  new  Bits.MatchNoBits( maxDoc );\\n      }\\n       return   new  ByteValues( retArray, valid, numDocs, numTerms );\\n    }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913347\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913347&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913347\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913347_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913347_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 02:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T02:02:08+0000\'\u003e22\\/Sep\\/10 02:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAny thoughts on this?\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the best move forward is to:\u003cbr\\/\u003e\\na. optimize as much as possible\u003cbr\\/\u003e\\nb. drop the no-parser function option\u003cbr\\/\u003e\\nc. optionally store the bitset via static config (ugly, but lesser of many ugly options)\u003cbr\\/\u003e\\nd. set lucene default=false (actually I don\'t care)\u003cbr\\/\u003e\\ne. set solr default=true\u003c\\/p\u003e\\n\\n\u003cp\u003eUnless there are objections, I will clean up the patch, fix javadoc, tests, etc\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913347_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913347_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 02:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T02:02:08+0000\'\u003e22\\/Sep\\/10 02:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Any thoughts on this? \\n\\n I think the best move forward is to: \\na. optimize as much as possible \\nb. drop the no-parser function option \\nc. optionally store the bitset via static config (ugly, but lesser of many ugly options) \\nd. set lucene default=false (actually I don\'t care) \\ne. set solr default=true \\n\\n Unless there are objections, I will clean up the patch, fix javadoc, tests, etc              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913353\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913353&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913353\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913353_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913353_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 02:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T02:15:17+0000\'\u003e22\\/Sep\\/10 02:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlso set the Lucene default to true, as I want to improve sorting and FCRF.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913353_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913353_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 02:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T02:15:17+0000\'\u003e22\\/Sep\\/10 02:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Also set the Lucene default to true, as I want to improve sorting and FCRF.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913418\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913418&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913418\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913418_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913418_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 06:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T06:36:01+0000\'\u003e22\\/Sep\\/10 06:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is a (hopefully) final patch that adds a bunch of tests to exercise the the \'valid\' bits (and check that MatchAll is used when appropriate)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913418_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913418_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 06:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T06:36:01+0000\'\u003e22\\/Sep\\/10 06:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is a (hopefully) final patch that adds a bunch of tests to exercise the the \'valid\' bits (and check that MatchAll is used when appropriate)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913428\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913428&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913428\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913428_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913428_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 06:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T06:59:47+0000\'\u003e22\\/Sep\\/10 06:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Ryan,\u003c\\/p\u003e\\n\\n\u003cp\u003efew comments:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe tests if all\\/no bits are set and so the special Bits implementations are returned are fine, but the special case for all bits are valid may be a little bit ineffective and seldom\u003c\\/li\u003e\\n\\t\u003cli\u003eplease use the correct Java code style (\\\"{\\\" should be at the end of previous line and not in separate line for method declarations), the Eclipse code style is available in Wiki\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913428_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913428_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 06:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T06:59:47+0000\'\u003e22\\/Sep\\/10 06:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Ryan, \\n\\n few comments: \\n \\n\\t the tests if all\\/no bits are set and so the special Bits implementations are returned are fine, but the special case for all bits are valid may be a little bit ineffective and seldom \\n\\t please use the correct Java code style (\\\"{\\\" should be at the end of previous line and not in separate line for method declarations), the Eclipse code style is available in Wiki \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913485\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913485&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913485\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913485_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913485_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 10:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T10:18:03+0000\'\u003e22\\/Sep\\/10 10:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAlso set the Lucene default to true\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ePlease don\'t!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eas I want to improve sorting and FCRF.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut: sorting, FCRF must continue to work if the app chooses not to\u003cbr\\/\u003e\\nload valid bits, right?\u003c\\/p\u003e\\n\\n\u003cp\u003eOther feedback on current patch:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWe don\'t have to @Deprecate for 4.0 &#8211; just remove it, and note\u003cbr\\/\u003e\\n    this in MIGRATE.txt.  (Though for 3.x we need the deprecation, so\u003cbr\\/\u003e\\n    maybe do 3.x patch first, then remove deprecations for 4.0?).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFieldCache.EntryCreator looks orphan\'d?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt looks like the valid bits will not reflect deletions (by design),\u003cbr\\/\u003e\\nright?  Ie caller cannot rely on valid always incorporating deleted\u003cbr\\/\u003e\\ndocs.  (Eg the MatchAll opto disregards deletions, and, a reopened\u003cbr\\/\u003e\\nsegment can have new deletions yet shares the FC entry).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe static config still also bothers me... and, going that route means\u003cbr\\/\u003e\\nwe must agree on a default (which is looking hard!).\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat if we:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAllow specifying \\\"loadValidBits\\\" on each load (eg via Parser or\u003cbr\\/\u003e\\n    separate arg to FC.getXXValues), but,\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWe separately cache the valid bits (we\'d still have the XXXValues\u003cbr\\/\u003e\\n    returned, to include the valid bits &amp; values).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThis way if an app \\\"messes up\\\", they do not end up double-storing the\u003cbr\\/\u003e\\nactual values, ie the worst that happens is they have to re-invert\u003cbr\\/\u003e\\njust to generate the valid bits.  Even that should be fairly rare, ie,\u003cbr\\/\u003e\\nif they use MissingStringLastComparator it\'ll init both values &amp; valid\u003cbr\\/\u003e\\nbits entries in the cache on the first go.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913485_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913485_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 10:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T10:18:03+0000\'\u003e22\\/Sep\\/10 10:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Also set the Lucene default to true  \\n\\n Please don\'t! \\n\\n  as I want to improve sorting and FCRF.  \\n\\n But: sorting, FCRF must continue to work if the app chooses not to \\nload valid bits, right? \\n\\n Other feedback on current patch: \\n\\n \\n\\t We don\'t have to @Deprecate for 4.0 &#8211; just remove it, and note \\n    this in MIGRATE.txt.  (Though for 3.x we need the deprecation, so \\n    maybe do 3.x patch first, then remove deprecations for 4.0?). \\n \\n\\n\\n \\n\\t FieldCache.EntryCreator looks orphan\'d? \\n \\n\\n\\n It looks like the valid bits will not reflect deletions (by design), \\nright?  Ie caller cannot rely on valid always incorporating deleted \\ndocs.  (Eg the MatchAll opto disregards deletions, and, a reopened \\nsegment can have new deletions yet shares the FC entry). \\n\\n The static config still also bothers me... and, going that route means \\nwe must agree on a default (which is looking hard!). \\n\\n What if we: \\n\\n \\n\\t Allow specifying \\\"loadValidBits\\\" on each load (eg via Parser or \\n    separate arg to FC.getXXValues), but, \\n \\n\\n\\n \\n\\t We separately cache the valid bits (we\'d still have the XXXValues \\n    returned, to include the valid bits &amp; values). \\n \\n\\n\\n This way if an app \\\"messes up\\\", they do not end up double-storing the \\nactual values, ie the worst that happens is they have to re-invert \\njust to generate the valid bits.  Even that should be fairly rare, ie, \\nif they use MissingStringLastComparator it\'ll init both values &amp; valid \\nbits entries in the cache on the first go.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913503\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913503&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913503\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12913503_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913503_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 11:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T11:29:21+0000\'\u003e22\\/Sep\\/10 11:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAlso set the Lucene default to true, as I want to improve sorting and FCRF.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI know it\'s only 3% (for ints... 12.5% for bytes), but, 3% here, 3% there and suddenly we\'re talking real money.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m having trouble understanding the use case for this bitset.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe jira issue says to add a bitset, but doesnt explain why.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe linked thread talks about this being useful for sorting missing values last, but I don\'t think this justifies\u003cbr\\/\u003e\\nincreasing the size of fieldcache by default.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12913503_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913503_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 11:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T11:29:21+0000\'\u003e22\\/Sep\\/10 11:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Also set the Lucene default to true, as I want to improve sorting and FCRF.  \\n\\n  I know it\'s only 3% (for ints... 12.5% for bytes), but, 3% here, 3% there and suddenly we\'re talking real money.  \\n\\n I\'m having trouble understanding the use case for this bitset. \\n\\n The jira issue says to add a bitset, but doesnt explain why. \\n\\n The linked thread talks about this being useful for sorting missing values last, but I don\'t think this justifies \\nincreasing the size of fieldcache by default.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913623\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913623&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913623\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913623_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913623_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 15:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T15:36:35+0000\'\u003e22\\/Sep\\/10 15:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is a new patch that removes the static config.  Rather then put a property on Parser class, I added a class:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eCacheConfig {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e cacheValidBits();\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eand this gets passed to the getXXXValues function:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eByteValues getByteValues(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, ByteParser parser, CacheConfig config)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI think this is a better option then adding a parameter to Parser since we can have an easy upgrade path.  Parser is an interface, so we can not just add to it without breaking compatibility.  To change things in 4.x, 3.x should have an upgrade path.\u003c\\/p\u003e\\n\\n\u003cp\u003eI took Mike\'s suggestion and include the CacheConfig hashcode in the Cache key &#8211; however, I don\'t cache the Bits separately since this is an edge case that \u003cb\u003eshould\u003c\\/b\u003e be avoided, but at least does not fail if you are not consistent.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis does cache a MatchAllBits even when \'cacheValidBits\' is false, since that is small (a small class with one int)\u003c\\/p\u003e\\n\\n\u003cp\u003e-----------\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e*  We don\'t have to @Deprecate for 4.0 - just remove it, and note this in MIGRATE.txt. (Though for 3.x we need the deprecation, so maybe do 3.x patch first, then remove deprecations for 4.0?).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMy plan was to apply with deprecations to 4.x, then merge with 3.x.  Then replace the calls in 4.x, then remove the old functions.  Does this sound reasonable?\u003c\\/p\u003e\\n\\n\u003cp\u003eI would like this to get in 3.x since we could then remove many solr types in 4.x and have a 3.x migration path.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e* FieldCache.EntryCreator looks orphan\'d?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003edooh, thanks\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eIt looks like the valid bits will not reflect deletions (by design), right? Ie caller cannot rely on valid always incorporating deleted docs. (Eg the MatchAll opto disregards deletions, and, a reopened segment can have new deletions yet shares the FC entry).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight, the ValidBits are only checked for docs that exists (and the FC values are only set for docs that exists &#8211; this has not changed), and may contain false positives for deleted docs.  I think this is OK since most use cases (i can think of) deal with deletions anyway.   Any ideas how\\/if we should change this?  (I did not realize that the FC is reused after deletions &#8211; so clever)\u003c\\/p\u003e\\n\\n\u003cp\u003e----------------\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m having trouble understanding the use case for this bitset.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMy motivation is for supporting the supportMissingLast feature in solr sorting (that could now be pushed to lucene).  For example if I have a bunch of documents and only some have the field \\\"bytes\\\" &#8211; sorting \'bytes desc\' works great, but sorting \'bytes asc\' puts all the documents that do not have the field \'bytes\' first since the FieldCache thinks they are all zero.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we get this working in solr, we can deprecate and delete all the \\\"sortable\\\" number fields and have that same functionality on Trie* fields.\u003c\\/p\u003e\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913623_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913623_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 15:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T15:36:35+0000\'\u003e22\\/Sep\\/10 15:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is a new patch that removes the static config.  Rather then put a property on Parser class, I added a class: \\n  \\n    public   abstract   static   class  CacheConfig {\\n     public   abstract   boolean  cacheValidBits();\\n  }\\n \\n  \\n and this gets passed to the getXXXValues function: \\n  \\n ByteValues getByteValues(IndexReader reader,  String  field, ByteParser parser, CacheConfig config)\\n \\n  \\n\\n I think this is a better option then adding a parameter to Parser since we can have an easy upgrade path.  Parser is an interface, so we can not just add to it without breaking compatibility.  To change things in 4.x, 3.x should have an upgrade path. \\n\\n I took Mike\'s suggestion and include the CacheConfig hashcode in the Cache key &#8211; however, I don\'t cache the Bits separately since this is an edge case that  should  be avoided, but at least does not fail if you are not consistent. \\n\\n This does cache a MatchAllBits even when \'cacheValidBits\' is false, since that is small (a small class with one int) \\n\\n ----------- \\n\\n  *  We don\'t have to @Deprecate for 4.0 - just remove it, and note this in MIGRATE.txt. (Though for 3.x we need the deprecation, so maybe do 3.x patch first, then remove deprecations for 4.0?).  \\n\\n My plan was to apply with deprecations to 4.x, then merge with 3.x.  Then replace the calls in 4.x, then remove the old functions.  Does this sound reasonable? \\n\\n I would like this to get in 3.x since we could then remove many solr types in 4.x and have a 3.x migration path. \\n\\n  * FieldCache.EntryCreator looks orphan\'d?  \\n\\n dooh, thanks \\n\\n\\n  It looks like the valid bits will not reflect deletions (by design), right? Ie caller cannot rely on valid always incorporating deleted docs. (Eg the MatchAll opto disregards deletions, and, a reopened segment can have new deletions yet shares the FC entry).  \\n\\n Right, the ValidBits are only checked for docs that exists (and the FC values are only set for docs that exists &#8211; this has not changed), and may contain false positives for deleted docs.  I think this is OK since most use cases (i can think of) deal with deletions anyway.   Any ideas how\\/if we should change this?  (I did not realize that the FC is reused after deletions &#8211; so clever) \\n\\n ---------------- \\n\\n  I\'m having trouble understanding the use case for this bitset.  \\n\\n My motivation is for supporting the supportMissingLast feature in solr sorting (that could now be pushed to lucene).  For example if I have a bunch of documents and only some have the field \\\"bytes\\\" &#8211; sorting \'bytes desc\' works great, but sorting \'bytes asc\' puts all the documents that do not have the field \'bytes\' first since the FieldCache thinks they are all zero. \\n\\n If we get this working in solr, we can deprecate and delete all the \\\"sortable\\\" number fields and have that same functionality on Trie* fields. \\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913633\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913633&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913633\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913633_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913633_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:00:44+0000\'\u003e22\\/Sep\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf folks think that being able to tell a real \\\"0\\\" from a missing value is not useful for Lucene, we\u003cbr\\/\u003e\\ncould extend Ryan\'s CacheConfig to include a factory method that creates \\/ populates ByteValues, IntValues, etc.\u003cbr\\/\u003e\\nThen all the bitset stuff could be kept in Solr only.  I\'m sensitive about pushing stuff into Lucene that is \u003cb\u003eonly\u003c\\/b\u003e useful for Solr.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913633_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913633_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:00:44+0000\'\u003e22\\/Sep\\/10 16:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If folks think that being able to tell a real \\\"0\\\" from a missing value is not useful for Lucene, we \\ncould extend Ryan\'s CacheConfig to include a factory method that creates \\/ populates ByteValues, IntValues, etc. \\nThen all the bitset stuff could be kept in Solr only.  I\'m sensitive about pushing stuff into Lucene that is  only  useful for Solr. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913646\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913646&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913646\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913646_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913646_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:23:22+0000\'\u003e22\\/Sep\\/10 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cblockquote\u003e\u003cp\u003eI think this is a better option then adding a parameter to Parser since we can have an easy upgrade path. Parser is an interface, so we can not just add to it without breaking compatibility. To change things in 4.x, 3.x should have an upgrade path.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm... I\'d rather make an exception to 3.x, ie, allow the addition of\u003cbr\\/\u003e\\nthis method to the interface, than confuse the 4.x API, going forward,\u003cbr\\/\u003e\\nwith 2 classes?\u003c\\/p\u003e\\n\\n\u003cp\u003eCreating a custom FieldCache parser is an extremely advanced use\u003cbr\\/\u003e\\ncase... very few users do this, and those that do will grok this\u003cbr\\/\u003e\\nmethod?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eHowever, I don\'t cache the Bits separately since this is an edge case that should be avoided, but at least does not fail if you are not consistent.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis makes me nervous since it can now lead to further cases of field\u003cbr\\/\u003e\\ncache insanity, ie, you loaded it once w\\/o the valid bits, and again\u003cbr\\/\u003e\\nw\\/ the valid bits, and now your values array is taking up 2X the RAM.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s already bad enough that FC allows one kind of insanity \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThis does cache a MatchAllBits even when \'cacheValidBits\' is false, since that is small (a small class with one int)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm... but if I pass false here, it shouldn\'t spend any time\u003cbr\\/\u003e\\nallocating the bit set, building it, checking the bit set for \\\"all\u003cbr\\/\u003e\\nbits set\\\", etc.?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003e*  We don\'t have to @Deprecate for 4.0 - just remove it, and note this in MIGRATE.txt. (Though for 3.x we need the deprecation, so maybe do 3.x patch first, then remove deprecations for 4.0?).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMy plan was to apply with deprecations to 4.x, then merge with 3.x.  Then replace the calls in 4.x, then remove the old functions.  Does this sound reasonable?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK that sounds like a good plan!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eRight, the ValidBits are only checked for docs that exists (and the FC values are only set for docs that exists &#8211; this has not changed), and may contain false positives for deleted docs.  I think this is OK since most use cases (i can think of) deal with deletions anyway.   Any ideas how\\/if we should change this?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think this is the right approach &#8211; expecting FC\'s valid bits to\u003cbr\\/\u003e\\ntake deletions into account is too much.  We have IR.getDeletedDocs\u003cbr\\/\u003e\\nfor this.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, eg this means classes like FCRF will still have to consult\u003cbr\\/\u003e\\ndeleted docs.\u003c\\/p\u003e\\n\\n\u003cp\u003eReally, \\\"in general\\\" we need a better way for the query execution path\u003cbr\\/\u003e\\nto enforce deleted docs.  Eg if the FCRF will be AND\'d w\\/ a query\u003cbr\\/\u003e\\nthat\'s already excluding del docs then it need not be careful about\u003cbr\\/\u003e\\ndeletions...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e(I did not realize that the FC is reused after deletions &#8211; so clever)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHa!  There was a time when it didn\'t \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913646_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913646_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:23:22+0000\'\u003e22\\/Sep\\/10 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n  I think this is a better option then adding a parameter to Parser since we can have an easy upgrade path. Parser is an interface, so we can not just add to it without breaking compatibility. To change things in 4.x, 3.x should have an upgrade path.  \\n\\n Hmm... I\'d rather make an exception to 3.x, ie, allow the addition of \\nthis method to the interface, than confuse the 4.x API, going forward, \\nwith 2 classes? \\n\\n Creating a custom FieldCache parser is an extremely advanced use \\ncase... very few users do this, and those that do will grok this \\nmethod? \\n\\n  However, I don\'t cache the Bits separately since this is an edge case that should be avoided, but at least does not fail if you are not consistent.  \\n\\n This makes me nervous since it can now lead to further cases of field \\ncache insanity, ie, you loaded it once w\\/o the valid bits, and again \\nw\\/ the valid bits, and now your values array is taking up 2X the RAM. \\n\\n It\'s already bad enough that FC allows one kind of insanity   \\n\\n  This does cache a MatchAllBits even when \'cacheValidBits\' is false, since that is small (a small class with one int)  \\n\\n Hmm... but if I pass false here, it shouldn\'t spend any time \\nallocating the bit set, building it, checking the bit set for \\\"all \\nbits set\\\", etc.? \\n\\n \\n  *  We don\'t have to @Deprecate for 4.0 - just remove it, and note this in MIGRATE.txt. (Though for 3.x we need the deprecation, so maybe do 3.x patch first, then remove deprecations for 4.0?).  \\n\\n My plan was to apply with deprecations to 4.x, then merge with 3.x.  Then replace the calls in 4.x, then remove the old functions.  Does this sound reasonable?  \\n\\n OK that sounds like a good plan! \\n\\n  Right, the ValidBits are only checked for docs that exists (and the FC values are only set for docs that exists &#8211; this has not changed), and may contain false positives for deleted docs.  I think this is OK since most use cases (i can think of) deal with deletions anyway.   Any ideas how\\/if we should change this?  \\n\\n I think this is the right approach &#8211; expecting FC\'s valid bits to \\ntake deletions into account is too much.  We have IR.getDeletedDocs \\nfor this. \\n\\n But, eg this means classes like FCRF will still have to consult \\ndeleted docs. \\n\\n Really, \\\"in general\\\" we need a better way for the query execution path \\nto enforce deleted docs.  Eg if the FCRF will be AND\'d w\\/ a query \\nthat\'s already excluding del docs then it need not be careful about \\ndeletions... \\n\\n  (I did not realize that the FC is reused after deletions &#8211; so clever)  \\n\\n Ha!  There was a time when it didn\'t                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913647\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913647&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913647\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913647_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913647_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:24:51+0000\'\u003e22\\/Sep\\/10 16:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMy motivation is for supporting the supportMissingLast feature in solr sorting (that could now be pushed to lucene).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIf folks think that being able to tell a real \\\"0\\\" from a missing value is not useful for Lucene, we\u003cbr\\/\u003e\\ncould extend Ryan\'s CacheConfig to include a factory method that creates \\/ populates ByteValues, IntValues, etc.\u003cbr\\/\u003e\\nThen all the bitset stuff could be kept in Solr only.  I\'m sensitive about pushing stuff into Lucene that is \u003cb\u003eonly\u003c\\/b\u003e useful for Solr.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m very much +1 for making this (exposing thea valid bitset) possible\u003cbr\\/\u003e\\nin Lucene.\u003c\\/p\u003e\\n\\n\u003cp\u003eUsers have asked over time how they can tell if a given doc has a field value.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd being able to distinguish missing values, eg to sort them last, or\u003cbr\\/\u003e\\nto do something else, is useful.  Once we do this we should also\u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;eventually&#93;\u003c\\/span\u003e move \\\"sort missing last\\\" capability into Lucene\'s\u003cbr\\/\u003e\\ncomparators.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913647_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913647_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:24:51+0000\'\u003e22\\/Sep\\/10 16:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     My motivation is for supporting the supportMissingLast feature in solr sorting (that could now be pushed to lucene).  \\n\\n \\n If folks think that being able to tell a real \\\"0\\\" from a missing value is not useful for Lucene, we \\ncould extend Ryan\'s CacheConfig to include a factory method that creates \\/ populates ByteValues, IntValues, etc. \\nThen all the bitset stuff could be kept in Solr only.  I\'m sensitive about pushing stuff into Lucene that is  only  useful for Solr.  \\n\\n I\'m very much +1 for making this (exposing thea valid bitset) possible \\nin Lucene. \\n\\n Users have asked over time how they can tell if a given doc has a field value. \\n\\n And being able to distinguish missing values, eg to sort them last, or \\nto do something else, is useful.  Once we do this we should also \\n &#91;eventually&#93;  move \\\"sort missing last\\\" capability into Lucene\'s \\ncomparators.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913659\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913659&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913659\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913659_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913659_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:47:55+0000\'\u003e22\\/Sep\\/10 16:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am also strongly +1 for the additional Bits interface (as Ryan did, it does not always need to be a real OpenBitSet, so when no deletions and all things set, we can use a dummy one).\u003cbr\\/\u003e\\nI had often use cases where i needed the information, if this document really has a value set or not, and i don\'t use Solr so much.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eAnd being able to distinguish missing values, eg to sort them last, or\u003cbr\\/\u003e\\nto do something else, is useful. Once we do this we should also\u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;eventually&#93;\u003c\\/span\u003e move \\\"sort missing last\\\" capability into Lucene\'s\u003cbr\\/\u003e\\ncomparators.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI think this is the right approach - expecting FC\'s valid bits to\u003cbr\\/\u003e\\ntake deletions into account is too much. We have IR.getDeletedDocs\u003cbr\\/\u003e\\nfor this.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe don\'t need to AND them together, maybe simply wrap the OpenBitset by a custom Bits impl, that ands in the getter? But as deletions are separated in IndexReader and the cache can reuse the cache even when new deletions are added, i think keeping it separate is fine.\u003c\\/p\u003e\\n\\n\u003cp\u003eAbout the whole bit set: Do we really need to couple the Bits interface to the type? Because if you exchange the parser\\/native type (e.g. parse ints as byte), the valid docs are still the same, only the native type representation is different. So how about we add a getBits(field) method to FieldCache that returns the valid docs. If field was not yet retrieved as a native type it could throw IllegalStateEx, else it would return the Bits interface (globally, but per field, but not per parser\\/datatype) created during the last FC polulation run? We have then also the possibility to disable the default generation of Bits and do it lazily (which should run faster, as it does not need to parse the values, only enumerate terms and termdocs).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eReally, \\\"in general\\\" we need a better way for the query execution path\u003cbr\\/\u003e\\nto enforce deleted docs. Eg if the FCRF will be AND\'d w\\/ a query\u003cbr\\/\u003e\\nthat\'s already excluding del docs then it need not be careful about\u003cbr\\/\u003e\\ndeletions...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats another thing, but maybe we remove deleted docs completely from query processing and simply apply it like a filter before the collector. Not sure about the implications and performance.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913659_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913659_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 16:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T16:47:55+0000\'\u003e22\\/Sep\\/10 16:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am also strongly +1 for the additional Bits interface (as Ryan did, it does not always need to be a real OpenBitSet, so when no deletions and all things set, we can use a dummy one). \\nI had often use cases where i needed the information, if this document really has a value set or not, and i don\'t use Solr so much. \\n\\n \\n And being able to distinguish missing values, eg to sort them last, or \\nto do something else, is useful. Once we do this we should also \\n &#91;eventually&#93;  move \\\"sort missing last\\\" capability into Lucene\'s \\ncomparators.  \\n\\n +1 \\n\\n \\n I think this is the right approach - expecting FC\'s valid bits to \\ntake deletions into account is too much. We have IR.getDeletedDocs \\nfor this.  \\n\\n We don\'t need to AND them together, maybe simply wrap the OpenBitset by a custom Bits impl, that ands in the getter? But as deletions are separated in IndexReader and the cache can reuse the cache even when new deletions are added, i think keeping it separate is fine. \\n\\n About the whole bit set: Do we really need to couple the Bits interface to the type? Because if you exchange the parser\\/native type (e.g. parse ints as byte), the valid docs are still the same, only the native type representation is different. So how about we add a getBits(field) method to FieldCache that returns the valid docs. If field was not yet retrieved as a native type it could throw IllegalStateEx, else it would return the Bits interface (globally, but per field, but not per parser\\/datatype) created during the last FC polulation run? We have then also the possibility to disable the default generation of Bits and do it lazily (which should run faster, as it does not need to parse the values, only enumerate terms and termdocs). \\n\\n \\n Really, \\\"in general\\\" we need a better way for the query execution path \\nto enforce deleted docs. Eg if the FCRF will be AND\'d w\\/ a query \\nthat\'s already excluding del docs then it need not be careful about \\ndeletions...  \\n\\n Thats another thing, but maybe we remove deleted docs completely from query processing and simply apply it like a filter before the collector. Not sure about the implications and performance.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913672\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913672&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913672\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913672_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913672_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:29:07+0000\'\u003e22\\/Sep\\/10 17:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHmm... I\'d rather make an exception to 3.x, ie, allow the addition of this method to the interface, than confuse the 4.x API, going forward, with 2 classes?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat is OK with me.  Would be cleaner and simpler.  (though semantically it does not make sense to me &#8211; why ask the parser what to cache?)\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003e&gt;&gt;    This does cache a MatchAllBits even when \'cacheValidBits\' is false, since that is small (a small class with one int)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eHmm... but if I pass false here, it shouldn\'t spend any time allocating the bit set, building it, checking the bit set for \\\"all bits set\\\", etc.?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWell it does not try \u003cb\u003ehard\u003c\\/b\u003e, only if numDocs==maxDocs, it does not look at anything.  If the cost of caching new MatchAllBits( maxDocs ) isn\'t worth occasional win by knowing all the values are valid, then I will remove it.\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eSo how about we add a getBits(field)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eInteresting... i\'ll mess for a bit and let you know what I think \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003erather then throwing an exception, that might be a flag, since I could imagin many thigns would use the Bits if they exist and do something else if they dont\u003c\\/p\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913672_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913672_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:29:07+0000\'\u003e22\\/Sep\\/10 17:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Hmm... I\'d rather make an exception to 3.x, ie, allow the addition of this method to the interface, than confuse the 4.x API, going forward, with 2 classes?  \\n\\n That is OK with me.  Would be cleaner and simpler.  (though semantically it does not make sense to me &#8211; why ask the parser what to cache?) \\n\\n\\n  &gt;&gt;    This does cache a MatchAllBits even when \'cacheValidBits\' is false, since that is small (a small class with one int)  \\n  Hmm... but if I pass false here, it shouldn\'t spend any time allocating the bit set, building it, checking the bit set for \\\"all bits set\\\", etc.?  \\n\\n Well it does not try  hard , only if numDocs==maxDocs, it does not look at anything.  If the cost of caching new MatchAllBits( maxDocs ) isn\'t worth occasional win by knowing all the values are valid, then I will remove it. \\n\\n\\n  So how about we add a getBits(field)  \\n\\n Interesting... i\'ll mess for a bit and let you know what I think   \\n\\n rather then throwing an exception, that might be a flag, since I could imagin many thigns would use the Bits if they exist and do something else if they dont \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913675\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913675&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913675\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913675_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913675_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:34:37+0000\'\u003e22\\/Sep\\/10 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHmm... I\'d rather make an exception to 3.x, ie, allow the addition of this method to the interface, than confuse the 4.x API, going forward, with 2 classes?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSame here, we already defined the FieldCache \\\"interface\\\" as subject to change. Mabye we should simply remove it in trunk and only have a class? This interface was never of any use, because you were not able to supply any other field cache implementation (the DEFAULT field is \u003cb\u003efinal\u003c\\/b\u003e because all fields in interfaces are defined as \u003cb\u003efinal\u003c\\/b\u003e by the Java Language Spec.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913675_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913675_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:34:37+0000\'\u003e22\\/Sep\\/10 17:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Hmm... I\'d rather make an exception to 3.x, ie, allow the addition of this method to the interface, than confuse the 4.x API, going forward, with 2 classes?  \\n\\n Same here, we already defined the FieldCache \\\"interface\\\" as subject to change. Mabye we should simply remove it in trunk and only have a class? This interface was never of any use, because you were not able to supply any other field cache implementation (the DEFAULT field is  final  because all fields in interfaces are defined as  final  by the Java Language Spec.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913677\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913677&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913677\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913677_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913677_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:35:27+0000\'\u003e22\\/Sep\\/10 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRegardless of if there is a separate getBits(field), I think we should add\\/use ByteValues, IntValues, etc.  It\'s just so much more extensible going forward.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913677_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913677_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:35:27+0000\'\u003e22\\/Sep\\/10 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Regardless of if there is a separate getBits(field), I think we should add\\/use ByteValues, IntValues, etc.  It\'s just so much more extensible going forward.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913679\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913679&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913679\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913679_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913679_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:39:35+0000\'\u003e22\\/Sep\\/10 17:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eRegardless of if there is a separate getBits(field), I think we should add\\/use ByteValues, IntValues, etc. It\'s just so much more extensible going forward.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913679_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913679_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:39:35+0000\'\u003e22\\/Sep\\/10 17:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Regardless of if there is a separate getBits(field), I think we should add\\/use ByteValues, IntValues, etc. It\'s just so much more extensible going forward.  \\n\\n +1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913680\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913680&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913680\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913680_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913680_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:41:30+0000\'\u003e22\\/Sep\\/10 17:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eSo how about we add a getBits(field) method to FieldCache that returns the valid docs. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis would be great!\u003c\\/p\u003e\\n\\n\u003cp\u003eAssuming we separately cache the valid docs, we could then allow caching \u003cb\u003eonly\u003c\\/b\u003e valid docs, for apps that want to know if a doc has a value but do not need the full array of values RAM resident.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913680_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913680_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:41:30+0000\'\u003e22\\/Sep\\/10 17:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     So how about we add a getBits(field) method to FieldCache that returns the valid docs.   \\n\\n This would be great! \\n\\n Assuming we separately cache the valid docs, we could then allow caching  only  valid docs, for apps that want to know if a doc has a value but do not need the full array of values RAM resident.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913685\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913685&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913685\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913685_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913685_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:49:20+0000\'\u003e22\\/Sep\\/10 17:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThat is OK with me. Would be cleaner and simpler. (though semantically it does not make sense to me - why ask the parser what to cache?)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah that is weird.  Maybe we rename Parser -&gt; EntryCreator?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913685_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913685_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:49:20+0000\'\u003e22\\/Sep\\/10 17:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     That is OK with me. Would be cleaner and simpler. (though semantically it does not make sense to me - why ask the parser what to cache?)  \\n\\n Yeah that is weird.  Maybe we rename Parser -&gt; EntryCreator?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913688\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913688&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913688\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913688_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913688_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:52:18+0000\'\u003e22\\/Sep\\/10 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe should also allow the parser to stop iterating term without the strange StopFillCacheException (needed for Numeric fields).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913688_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913688_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T17:52:18+0000\'\u003e22\\/Sep\\/10 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We should also allow the parser to stop iterating term without the strange StopFillCacheException (needed for Numeric fields).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913695\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913695&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913695\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913695_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913695_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:11:58+0000\'\u003e22\\/Sep\\/10 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eRegardless of if there is a separate getBits(field), I think we should add\\/use ByteValues, IntValues, etc. It\'s just so much more extensible going forward.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf we have a separate getBits( field ) call, should the Bits be added to the XxxValues class?  I suspect not.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913695_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913695_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:11:58+0000\'\u003e22\\/Sep\\/10 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Regardless of if there is a separate getBits(field), I think we should add\\/use ByteValues, IntValues, etc. It\'s just so much more extensible going forward.  \\n\\n If we have a separate getBits( field ) call, should the Bits be added to the XxxValues class?  I suspect not. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913698\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913698&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913698\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913698_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913698_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:19:09+0000\'\u003e22\\/Sep\\/10 18:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf we have a separate getBits( field ) call, should the Bits be added to the XxxValues class? I suspect not.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah I think it need not be.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut, EntryCreator still should be able to state that it\'d like the bits computed &amp; cached as a side effect?  And, if the bits wasn\'t already computed, then they\'d be computed on-demand?  (This enables caching only valid bits and not the values array).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we do this then we can leave cutover to XXXValues (still a good idea) as a separate issue?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913698_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913698_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:19:09+0000\'\u003e22\\/Sep\\/10 18:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If we have a separate getBits( field ) call, should the Bits be added to the XxxValues class? I suspect not.  \\n\\n Yeah I think it need not be. \\n\\n But, EntryCreator still should be able to state that it\'d like the bits computed &amp; cached as a side effect?  And, if the bits wasn\'t already computed, then they\'d be computed on-demand?  (This enables caching only valid bits and not the values array). \\n\\n If we do this then we can leave cutover to XXXValues (still a good idea) as a separate issue?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913699\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913699&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913699\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913699_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913699_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:22:20+0000\'\u003e22\\/Sep\\/10 18:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 22\\/Sep\\/10 18:25\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think it should be a separate entry in the cache. Only that its only regenerated, if it does not already exist for the field\\/IR combination. So there are these combinations:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ecache is purged (inititially)\u003c\\/li\u003e\\n\\t\u003cli\u003euser calls getBytes(field) -&gt; bytes[] is filled, also the Bits\u003c\\/li\u003e\\n\\t\u003cli\u003euser calls additionally getInts(field) for some reason -&gt; int[] is filled, but as Bits already exit they dont need to be filled\u003c\\/li\u003e\\n\\t\u003cli\u003euser calls getBits(field) -&gt; returns the pre-filled bits from one of the previous calls\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAlternatively:\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eCache is purged (initially)\u003c\\/li\u003e\\n\\t\u003cli\u003eUser calls getBits(field), there are no bits available until now, bits are populated from TermEnum\\/TermDocs, but no byte[] or int[], as not requested\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eWith a config option, one could switch automatic polulation of Bits off, so in the first combination, only the last call to getBits() would populate bit set.\u003c\\/p\u003e\\n\\n\u003cp\u003eI all cases this is easily possible by having a separate cache with separate population method for the bits. If some method like getBytes() also populates the Bits, it should simply add the created Bits manually to the cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead of a global config option, we could simply add a Boolean to the getXxx methods, to tell the cache if it should also populate Bits (if not already done?). The default would maybe false for Lucene, but solr would always pass true.\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes this sound like a plan?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913699_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913699_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:22:20+0000\'\u003e22\\/Sep\\/10 18:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 22\\/Sep\\/10 18:25\\\"\u003eedited\u003c\\/span\u003e                   I think it should be a separate entry in the cache. Only that its only regenerated, if it does not already exist for the field\\/IR combination. So there are these combinations: \\n\\n \\n\\t cache is purged (inititially) \\n\\t user calls getBytes(field) -&gt; bytes[] is filled, also the Bits \\n\\t user calls additionally getInts(field) for some reason -&gt; int[] is filled, but as Bits already exit they dont need to be filled \\n\\t user calls getBits(field) -&gt; returns the pre-filled bits from one of the previous calls \\n \\n\\n\\n Alternatively: \\n\\n \\n\\t Cache is purged (initially) \\n\\t User calls getBits(field), there are no bits available until now, bits are populated from TermEnum\\/TermDocs, but no byte[] or int[], as not requested \\n \\n\\n\\n With a config option, one could switch automatic polulation of Bits off, so in the first combination, only the last call to getBits() would populate bit set. \\n\\n I all cases this is easily possible by having a separate cache with separate population method for the bits. If some method like getBytes() also populates the Bits, it should simply add the created Bits manually to the cache. \\n\\n Instead of a global config option, we could simply add a Boolean to the getXxx methods, to tell the cache if it should also populate Bits (if not already done?). The default would maybe false for Lucene, but solr would always pass true. \\n\\n Does this sound like a plan?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913700\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913700&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913700\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913700_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913700_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:23:32+0000\'\u003e22\\/Sep\\/10 18:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf we do this then we can leave cutover to XXXValues (still a good idea) as a separate issue?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m already in deep... I\'d like to keep the XxxValues in this patch, and use a different one to bring everything up-to-date with the new API in 3.x\\/4.x\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913700_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913700_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:23:32+0000\'\u003e22\\/Sep\\/10 18:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If we do this then we can leave cutover to XXXValues (still a good idea) as a separate issue?  \\n\\n I\'m already in deep... I\'d like to keep the XxxValues in this patch, and use a different one to bring everything up-to-date with the new API in 3.x\\/4.x \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913701\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913701&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913701\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913701_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913701_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:24:47+0000\'\u003e22\\/Sep\\/10 18:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf we have a separate getBits( field ) call, should the Bits be added to the XxxValues class? I suspect not.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSeems a lot easier just to put all the optional stuff on the *Values class - more performant too (and avoid more synchronizing lookups)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913701_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913701_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:24:47+0000\'\u003e22\\/Sep\\/10 18:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If we have a separate getBits( field ) call, should the Bits be added to the XxxValues class? I suspect not.  \\n\\n Seems a lot easier just to put all the optional stuff on the *Values class - more performant too (and avoid more synchronizing lookups)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913703\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913703&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913703\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913703_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913703_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:27:19+0000\'\u003e22\\/Sep\\/10 18:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI all cases this is easily possible by having a separate cache with separate population method for the bits.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis seems more complex, and less extensible.  What\'s the issue with just putting the bits reference down on CachedArray?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913703_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913703_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:27:19+0000\'\u003e22\\/Sep\\/10 18:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I all cases this is easily possible by having a separate cache with separate population method for the bits.  \\n\\n This seems more complex, and less extensible.  What\'s the issue with just putting the bits reference down on CachedArray?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913709\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913709&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913709\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913709_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913709_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:34:38+0000\'\u003e22\\/Sep\\/10 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt\'s not more complicated its easier. The Bits are a real separate thing, its just a cache of the information, if values are assigned or not. It does not depend on the data type like byte, int,... Its just separate. And as said before, if somebody requests the same field in different types, it would only have one bits. Also one could request the Bits alone, or could first request a field without bits (using a boolean) and later again with bits, in which case those are lazily loaded\u003c\\/p\u003e\\n\\n\u003cp\u003eTh implementation would be simple, similar to the way, how the caches are filled for NumericFields (it adds the values two times to the cache, with the null parser and the real used parser). I this case youl would simply request the bits cache on e.g. the int[] creation, if not availabe, also build the bits in parallel and add to bits cache.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12913709_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913709_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:34:38+0000\'\u003e22\\/Sep\\/10 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It\'s not more complicated its easier. The Bits are a real separate thing, its just a cache of the information, if values are assigned or not. It does not depend on the data type like byte, int,... Its just separate. And as said before, if somebody requests the same field in different types, it would only have one bits. Also one could request the Bits alone, or could first request a field without bits (using a boolean) and later again with bits, in which case those are lazily loaded \\n\\n Th implementation would be simple, similar to the way, how the caches are filled for NumericFields (it adds the values two times to the cache, with the null parser and the real used parser). I this case youl would simply request the bits cache on e.g. the int[] creation, if not availabe, also build the bits in parallel and add to bits cache.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913710\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913710&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913710\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913710_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913710_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:37:46+0000\'\u003e22\\/Sep\\/10 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat\'s the issue with just putting the bits reference down on CachedArray?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOne risk was added insanity cases, ie you looked up once w\\/ the bits and later w\\/o and it double-stores the values array.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother gain of separating the bits retrieval is it becomes possible to get only the valid bits (ie, w\\/o a value array), for apps that just want to know if a given doc had a field.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut we could probably still achieve these two benefits while using a single class for looking up everything \\\"cached\\\" about a field?  Ie, the CachedArray could return non-null bits but null values?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12913710_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913710_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:37:46+0000\'\u003e22\\/Sep\\/10 18:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What\'s the issue with just putting the bits reference down on CachedArray?  \\n\\n One risk was added insanity cases, ie you looked up once w\\/ the bits and later w\\/o and it double-stores the values array. \\n\\n Another gain of separating the bits retrieval is it becomes possible to get only the valid bits (ie, w\\/o a value array), for apps that just want to know if a given doc had a field. \\n\\n But we could probably still achieve these two benefits while using a single class for looking up everything \\\"cached\\\" about a field?  Ie, the CachedArray could return non-null bits but null values?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913712\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913712&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913712\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913712_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913712_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:41:02+0000\'\u003e22\\/Sep\\/10 18:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 22\\/Sep\\/10 18:46\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eBut we could probably still achieve these two benefits while using a single class for looking up everything \\\"cached\\\" about a field? Ie, the CachedArray could return non-null bits but null values?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eExactly.\u003cbr\\/\u003e\\nAnd with NRT and increasing number of segments, the number of synchronized lookups per segment could really start to matter.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913712_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913712_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 18:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T18:41:02+0000\'\u003e22\\/Sep\\/10 18:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 22\\/Sep\\/10 18:46\\\"\u003eedited\u003c\\/span\u003e                    But we could probably still achieve these two benefits while using a single class for looking up everything \\\"cached\\\" about a field? Ie, the CachedArray could return non-null bits but null values?  \\n\\n Exactly. \\nAnd with NRT and increasing number of segments, the number of synchronized lookups per segment could really start to matter.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913734\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913734&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913734\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913734_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913734_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 19:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T19:33:10+0000\'\u003e22\\/Sep\\/10 19:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003emore performant too (and avoid more synchronizing lookups)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis was my motivation for putting it all together and using the options as part of the key.  But yes, inconsistent usage will eat up RAM.  That is better then my original fear that inconsistent usage would give you unpredictable results!\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, with the current Cache implementaion, we would need to somehow be able to add two cache entries from within Cache.createEntry() &#8211; either rewrite all that or hack in some way to pass the FieldCache to the createEntry method.\u003c\\/p\u003e\\n\\n\u003cp\u003eKeeping the values and bits in different cache entries is pretty ugly (especially for the normal case where we want them both all the time)\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ByteValues() {\\n      (\u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[])caches.get(\u003cspan class=\\\"code-object\\\"\u003eByte\u003c\\/span\u003e.TYPE).get(reader, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Entry(field, parser??)),\\n      (Bits)caches.get(\u003cspan class=\\\"code-object\\\"\u003eByte\u003c\\/span\u003e.TYPE).get(reader, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Entry(field, parser??)),\\n    };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eBut we could probably still achieve these two benefits while using a single class for looking up everything \\\"cached\\\" about a field? Ie, the CachedArray could return non-null bits but null values?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBrainstorming here...  if Parser -&gt; EnteryCreator and the \'EntryCreator.hashCode()\' is used as the map key (as it is now)\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eEntryCreator \u003cspan class=\\\"code-keyword\\\"\u003eimplements\u003c\\/span\u003e Serializable {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e cacheValidBits() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e cacheValues() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e;\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe trick would be to use the same \u003cb\u003ekey\u003c\\/b\u003e regardless of what we ask for (values but no bits - bits but no values - bits and values, etc) and then fill up whatever is missing if it is not in the existing cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat might suggest that the \'class\' could be the key, but setting the cacheValidBits\\/values would need to get implemented by inheratance, so that is out.\u003c\\/p\u003e\\n\\n\u003cp\u003eother ideas?  directions I am not thinking about?\u003c\\/p\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913734_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913734_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 19:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T19:33:10+0000\'\u003e22\\/Sep\\/10 19:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     more performant too (and avoid more synchronizing lookups)  \\n\\n This was my motivation for putting it all together and using the options as part of the key.  But yes, inconsistent usage will eat up RAM.  That is better then my original fear that inconsistent usage would give you unpredictable results! \\n\\n Also, with the current Cache implementaion, we would need to somehow be able to add two cache entries from within Cache.createEntry() &#8211; either rewrite all that or hack in some way to pass the FieldCache to the createEntry method. \\n\\n Keeping the values and bits in different cache entries is pretty ugly (especially for the normal case where we want them both all the time) \\n  \\n      return   new  ByteValues() {\\n      ( byte [])caches.get( Byte .TYPE).get(reader,  new  Entry(field, parser??)),\\n      (Bits)caches.get( Byte .TYPE).get(reader,  new  Entry(field, parser??)),\\n    };\\n \\n  \\n\\n\\n  But we could probably still achieve these two benefits while using a single class for looking up everything \\\"cached\\\" about a field? Ie, the CachedArray could return non-null bits but null values?  \\n\\n Brainstorming here...  if Parser -&gt; EnteryCreator and the \'EntryCreator.hashCode()\' is used as the map key (as it is now) \\n\\n  \\n    public   abstract   class  EntryCreator  implements  Serializable {\\n     public   boolean  cacheValidBits() {\\n       return   false ;\\n    }\\n     public   boolean  cacheValues() {\\n       return   true ;\\n    }\\n  }\\n \\n  \\n\\n The trick would be to use the same  key  regardless of what we ask for (values but no bits - bits but no values - bits and values, etc) and then fill up whatever is missing if it is not in the existing cache. \\n\\n That might suggest that the \'class\' could be the key, but setting the cacheValidBits\\/values would need to get implemented by inheratance, so that is out. \\n\\n other ideas?  directions I am not thinking about? \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913740\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913740&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913740\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"skeptikos\\\" id=\\\"commentauthor_12913740_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=skeptikos\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"skeptikos\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J.J. Larrea\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913740_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T19:41:27+0000\'\u003e22\\/Sep\\/10 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI only just waded through this thread, so apologies in advance if this is redundant or off-topic...\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems to me that there could and should be a standalone enhancement to FieldCache\\/FCImpl to support Boolean-valued fields. \u003c\\/p\u003e\\n\\n\u003cp\u003eSince there is no native array-of-bits in Java, it could have the signature:\u003c\\/p\u003e\\n\\n\u003cp\u003e    BitSet getBits(IndexReader reader, String field, BooleanParser parser)  \u003cspan class=\\\"error\\\"\u003e&#91;implementation returning an OpenBitSet for efficiency&#93;\u003c\\/span\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eA pre-supplied BooleanParser implementation StringMatchBooleanParser could map any of one of a set of uncased strings to true, and a default subclass eg. DefaultStringMatchBooleanParser could supply \u003c\\/p\u003e\\n{ \\\"T\\\", \\\"TRUE\\\", \\\"1\\\", \\\"Y\\\", \\\"YES\\\" }\\n\u003cp\u003e for the set of strings.  So the defaulted and typical case getBits( ir, \\\"field\\\" ) would do what one typically expects of boolean-valued fields.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith that in place, then couldn\'t one simply define a parser that indicates value present for a docID regardless of what the term value is:\u003c\\/p\u003e\\n\\n\u003cp\u003e    public static BooleanParser AlwaysReturnTrueBooleanParser = new BooleanParser() { public boolean parseByte(BytesRef term) \u003c\\/p\u003e\\n{ return true; }\\n\u003cp\u003e }\u003c\\/p\u003e\\n\\n\u003cp\u003e    BitSet getValueExists(IndexReader reader, String field) \u003c\\/p\u003e\\n{\\n       return  getBits( ir, field, AlwaysReturnTrueBooleanParser );\\n    }\\n\\n\u003cp\u003eThen a client (e.g. FieldComparator implementation) interested in ValueExists values could ask for them, and they would be independently cached from whatever other field type cache(s) were requested on that field by the same or different clients.  The only cost would be iterating the Term\\/docID iterators a second time (as for additional cache variants on the same field) - minor.\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes this make sense?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"skeptikos\\\" id=\\\"commentauthor_12913740_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=skeptikos\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"skeptikos\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J.J. Larrea\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913740_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 19:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T19:41:27+0000\'\u003e22\\/Sep\\/10 19:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I only just waded through this thread, so apologies in advance if this is redundant or off-topic... \\n\\n It seems to me that there could and should be a standalone enhancement to FieldCache\\/FCImpl to support Boolean-valued fields.  \\n\\n Since there is no native array-of-bits in Java, it could have the signature: \\n\\n     BitSet getBits(IndexReader reader, String field, BooleanParser parser)   &#91;implementation returning an OpenBitSet for efficiency&#93;  \\n\\n A pre-supplied BooleanParser implementation StringMatchBooleanParser could map any of one of a set of uncased strings to true, and a default subclass eg. DefaultStringMatchBooleanParser could supply  \\n{ \\\"T\\\", \\\"TRUE\\\", \\\"1\\\", \\\"Y\\\", \\\"YES\\\" }\\n  for the set of strings.  So the defaulted and typical case getBits( ir, \\\"field\\\" ) would do what one typically expects of boolean-valued fields. \\n\\n With that in place, then couldn\'t one simply define a parser that indicates value present for a docID regardless of what the term value is: \\n\\n     public static BooleanParser AlwaysReturnTrueBooleanParser = new BooleanParser() { public boolean parseByte(BytesRef term)  \\n{ return true; }\\n  } \\n\\n     BitSet getValueExists(IndexReader reader, String field)  \\n{\\n       return  getBits( ir, field, AlwaysReturnTrueBooleanParser );\\n    }\\n\\n Then a client (e.g. FieldComparator implementation) interested in ValueExists values could ask for them, and they would be independently cached from whatever other field type cache(s) were requested on that field by the same or different clients.  The only cost would be iterating the Term\\/docID iterators a second time (as for additional cache variants on the same field) - minor. \\n\\n Does this make sense?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913742\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913742&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913742\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913742_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913742_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T19:49:59+0000\'\u003e22\\/Sep\\/10 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe only cost would be iterating the Term\\/docID iterators a second time\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eActually, that\'s major - otherwise I would have already just done that and stored it in a separate cache for Solr\'s needs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12913742_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913742_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 19:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T19:49:59+0000\'\u003e22\\/Sep\\/10 19:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The only cost would be iterating the Term\\/docID iterators a second time  \\n\\n Actually, that\'s major - otherwise I would have already just done that and stored it in a separate cache for Solr\'s needs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913795\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913795&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913795\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"skeptikos\\\" id=\\\"commentauthor_12913795_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=skeptikos\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"skeptikos\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J.J. Larrea\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913795_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T21:13:37+0000\'\u003e22\\/Sep\\/10 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eActually, that\'s major - otherwise I would have already just done that and stored it in a separate cache for Solr\'s needs.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIs the one-time-per-IndexReader-lifecycle cost of multiplying the cache load time by some factor &lt; 2.0 (since the term values don\'t need to be decoded), really so terrible that one has to contemplate global state variables, or a constant increase in cache memory, or significant API changes, or the potential for double-allocation (with then an additional 1x cache load time), or increased code complexity, ...?  Even with all the lovely Solr support for parallel pre-warming?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"skeptikos\\\" id=\\\"commentauthor_12913795_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=skeptikos\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"skeptikos\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e J.J. Larrea\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913795_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Sep\\/10 21:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-22T21:13:37+0000\'\u003e22\\/Sep\\/10 21:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Actually, that\'s major - otherwise I would have already just done that and stored it in a separate cache for Solr\'s needs.  \\n\\n Is the one-time-per-IndexReader-lifecycle cost of multiplying the cache load time by some factor &lt; 2.0 (since the term values don\'t need to be decoded), really so terrible that one has to contemplate global state variables, or a constant increase in cache memory, or significant API changes, or the potential for double-allocation (with then an additional 1x cache load time), or increased code complexity, ...?  Even with all the lovely Solr support for parallel pre-warming?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12913857\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12913857&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12913857\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913857_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913857_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 00:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T00:02:20+0000\'\u003e23\\/Sep\\/10 00:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq Is the one-time-per-IndexReader-lifecycle cost of multiplying the cache load time by some factor &lt; 2.0 ... really so terrible \u003c\\/p\u003e\\n\\n\u003cp\u003eit can be... on a big index just iterating all the terms\\/docs take a long time.  Try the LukeRequestHandler on an index with a million+ docs!\u003c\\/p\u003e\\n\\n\u003cp\u003e-------------\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is different variation, it changes \u003cb\u003elots\u003c\\/b\u003e but if we are talking about changing Parser from interface to class, then I guess the cat can be out of the bag.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat about something like: \u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eFieldCache.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  ...\\n\\n  \\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eEntryConfig \u003cspan class=\\\"code-keyword\\\"\u003eimplements\u003c\\/span\u003e Serializable \\n  {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e Parser getParser() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e cacheValidBits() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e cacheValues() {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e;\\n    }\\n    \\n    \\/**\\n     * The HashCode is used as part of the Cache Key (along with the field name).  \\n     * To allow multiple calls with different parameters, make sure the hashCode \\n     * does not include the specific instance and parameters.\\n     *\\/\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e hashCode()\\n    {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e EntryConfig.\u003cspan class=\\\"code-keyword\\\"\u003eclass.\u003c\\/span\u003ehashCode();\\n    }\\n  }\\n  \\n  \\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eCachePopulator \\n  {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillValidBits(  CachedArray vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig creator ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillByteValues( CachedArray vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig creator ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    ...\\n  }\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e CachePopulator getCachePopulator();\\n\\n...\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ByteValues getByteValues(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig creator )\\n\\n...\\n\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eThe field cache implementation would make sure what you asked for is filled up before passing it back (though i think this has some concurrency issue)\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ByteValues getByteValues(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException\\n  {\\n    ByteValues vals = (ByteValues) caches.get(\u003cspan class=\\\"code-object\\\"\u003eByte\u003c\\/span\u003e.TYPE).get(reader, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Entry(field, config));\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( vals.values == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; config.cacheValues() ) {\\n      populator.fillByteValues(vals, reader, field, config);\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( vals.valid == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; config.cacheValidBits() ) {\\n      populator.fillValidBits(vals, reader, field, config);\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e vals;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe Cache would then delegate the creation to the populator:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n    @Override\\n    \u003cspan class=\\\"code-keyword\\\"\u003eprotected\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e ByteValues createValue(IndexReader reader, Entry entry, CachePopulator populator) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n      \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field = entry.field;\\n      EntryConfig config = (EntryConfig)entry.custom;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (config == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e wrapper.getByteValues(reader, field, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e EntryConfig() );\\n      }\\n      ByteValues vals = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ByteValues();\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( config.cacheValues() ) {\\n        populator.fillByteValues(vals, reader, field, config);\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( config.cacheValidBits() ) {\\n        populator.fillValidBits(vals, reader, field, config);\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ethrow\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RuntimeException( \u003cspan class=\\\"code-quote\\\"\u003e\\\"the config must cache values and\\/or bits\\\"\u003c\\/span\u003e );\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e vals;\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe fillByteValues would be the same code as always, but I think the CachedArray should make sure the same parser is used everytime\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n    @Override\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void fillByteValues( CachedArray vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException\\n    {\\n      ByteParser parser = (ByteParser) config.getParser();\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( parser == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n        parser = FieldCache.DEFAULT_BYTE_PARSER;\\n      }\\n      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ Make sure it is the same parser\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e parserHashCode = parser.hashCode();\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( vals.parserHashCode != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; vals.parserHashCode != parserHashCode ) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ethrow\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RuntimeException( \u003cspan class=\\\"code-quote\\\"\u003e\\\"Subsequent calls with different parser!\\\"\u003c\\/span\u003e );\\n      }\\n      vals.parserHashCode = parserHashCode;\\n     ...\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThis is different then the current code where asking for the cached values with two different parsers (that return different hashcodes) will make two entries in the cache.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis approach would let us:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ecache values and bits independently or together\u003c\\/li\u003e\\n\\t\u003cli\u003esubsequent calls with different parameters should behave reasonably\u003c\\/li\u003e\\n\\t\u003cli\u003eIf CachePopulator is pluggable\\/extendable that may make some other issues easier\u003c\\/li\u003e\\n\\t\u003cli\u003elets us use CachePopulator outside of the cache context (perhaps useful)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12913857_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12913857_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 00:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T00:02:20+0000\'\u003e23\\/Sep\\/10 00:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bq Is the one-time-per-IndexReader-lifecycle cost of multiplying the cache load time by some factor &lt; 2.0 ... really so terrible  \\n\\n it can be... on a big index just iterating all the terms\\/docs take a long time.  Try the LukeRequestHandler on an index with a million+ docs! \\n\\n ------------- \\n\\n Here is different variation, it changes  lots  but if we are talking about changing Parser from interface to class, then I guess the cat can be out of the bag. \\n\\n What about something like:  \\n   FieldCache.java   \\n   ...\\n\\n  \\n   public   class  EntryConfig  implements  Serializable \\n  {\\n     public  Parser getParser() {\\n       return   null ;\\n    }\\n     public   boolean  cacheValidBits() {\\n       return   false ;\\n    }\\n     public   boolean  cacheValues() {\\n       return   true ;\\n    }\\n    \\n    \\/**\\n     * The HashCode is used as part of the Cache Key (along with the field name).  \\n     * To allow multiple calls with different parameters, make sure the hashCode \\n     * does not include the specific instance and parameters.\\n     *\\/\\n     public   int  hashCode()\\n    {\\n       return  EntryConfig. class. hashCode();\\n    }\\n  }\\n  \\n  \\n   public   abstract   class  CachePopulator \\n  {\\n     public   abstract  void fillValidBits(  CachedArray vals, IndexReader reader,  String  field, EntryConfig creator )  throws  IOException;\\n     public   abstract  void fillByteValues( CachedArray vals, IndexReader reader,  String  field, EntryConfig creator )  throws  IOException;\\n    ...\\n  }\\n\\n   public   abstract  CachePopulator getCachePopulator();\\n\\n...\\n\\n   public  ByteValues getByteValues(IndexReader reader,  String  field, EntryConfig creator )\\n\\n...\\n\\n \\n  \\n\\n\\n The field cache implementation would make sure what you asked for is filled up before passing it back (though i think this has some concurrency issue) \\n  \\n \\n   public  ByteValues getByteValues(IndexReader reader,  String  field, EntryConfig config)  throws  IOException\\n  {\\n    ByteValues vals = (ByteValues) caches.get( Byte .TYPE).get(reader,  new  Entry(field, config));\\n     if ( vals.values ==  null  &amp;&amp; config.cacheValues() ) {\\n      populator.fillByteValues(vals, reader, field, config);\\n    }\\n     if ( vals.valid ==  null  &amp;&amp; config.cacheValidBits() ) {\\n      populator.fillValidBits(vals, reader, field, config);\\n    }\\n     return  vals;\\n  }\\n \\n  \\n\\n The Cache would then delegate the creation to the populator: \\n  \\n \\n    @Override\\n     protected   final  ByteValues createValue(IndexReader reader, Entry entry, CachePopulator populator)  throws  IOException {\\n       String  field = entry.field;\\n      EntryConfig config = (EntryConfig)entry.custom;\\n       if  (config ==  null ) {\\n         return  wrapper.getByteValues(reader, field,  new  EntryConfig() );\\n      }\\n      ByteValues vals =  new  ByteValues();\\n       if ( config.cacheValues() ) {\\n        populator.fillByteValues(vals, reader, field, config);\\n      }\\n       else   if ( config.cacheValidBits() ) {\\n        populator.fillValidBits(vals, reader, field, config);\\n      }\\n       else  {\\n         throw   new  RuntimeException(  \\\"the config must cache values and\\/or bits\\\"  );\\n      }\\n       return  vals;\\n    }\\n \\n  \\n\\n The fillByteValues would be the same code as always, but I think the CachedArray should make sure the same parser is used everytime \\n  \\n \\n    @Override\\n     public  void fillByteValues( CachedArray vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException\\n    {\\n      ByteParser parser = (ByteParser) config.getParser();\\n       if ( parser ==  null  ) {\\n        parser = FieldCache.DEFAULT_BYTE_PARSER;\\n      }\\n       \\/\\/ Make sure it is the same parser\\n        int  parserHashCode = parser.hashCode();\\n       if ( vals.parserHashCode !=  null  &amp;&amp; vals.parserHashCode != parserHashCode ) {\\n         throw   new  RuntimeException(  \\\"Subsequent calls with different parser!\\\"  );\\n      }\\n      vals.parserHashCode = parserHashCode;\\n     ...\\n \\n  \\n\\n This is different then the current code where asking for the cached values with two different parsers (that return different hashcodes) will make two entries in the cache. \\n\\n This approach would let us: \\n \\n\\t cache values and bits independently or together \\n\\t subsequent calls with different parameters should behave reasonably \\n\\t If CachePopulator is pluggable\\/extendable that may make some other issues easier \\n\\t lets us use CachePopulator outside of the cache context (perhaps useful) \\n \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914044\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914044&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914044\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914044_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914044_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T14:28:59+0000\'\u003e23\\/Sep\\/10 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNow we\'re talking!\u003c\\/p\u003e\\n\\n\u003cp\u003eQ: why aren\'t the CachePopulator methods just directly on EntryConfig - was it easier to share implementations that way or something?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eIt doesn\'t seem like we need two methods fillValidBits , fillByteValues - shouldn\'t it just be one method that looks at the config and fills in the appropriate entries based on cacheValidBits() and cacheValues()?\u003c\\/li\u003e\\n\\t\u003cli\u003eWe should allow an implementation to create subclasses of ByteValues, etc...  what about this method:\u003cbr\\/\u003e\\n   public abstract CachedArray  fillEntry( CachedArray vals, IndexReader reader, String field, EntryConfig creator )\u003cbr\\/\u003e\\nThat way, an existing entry can be filled in (i.e. vals != null) or a new entry can be created.\u003cbr\\/\u003e\\nOh, wait, I see further down a \\\"ByteValues createValue()\\\" - if that\'s meant to be a method on CachePopulator, I guess it\'s all good - my main concern was being able to create subclasses of ByteValues and frields.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAnyway, all that\'s off the top of my head - I\'m sure you\'ve thought about it more at this point.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914044_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914044_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T14:28:59+0000\'\u003e23\\/Sep\\/10 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Now we\'re talking! \\n\\n Q: why aren\'t the CachePopulator methods just directly on EntryConfig - was it easier to share implementations that way or something? \\n\\n Also: \\n \\n\\t It doesn\'t seem like we need two methods fillValidBits , fillByteValues - shouldn\'t it just be one method that looks at the config and fills in the appropriate entries based on cacheValidBits() and cacheValues()? \\n\\t We should allow an implementation to create subclasses of ByteValues, etc...  what about this method: \\n   public abstract CachedArray  fillEntry( CachedArray vals, IndexReader reader, String field, EntryConfig creator ) \\nThat way, an existing entry can be filled in (i.e. vals != null) or a new entry can be created. \\nOh, wait, I see further down a \\\"ByteValues createValue()\\\" - if that\'s meant to be a method on CachePopulator, I guess it\'s all good - my main concern was being able to create subclasses of ByteValues and frields. \\n \\n\\n\\n Anyway, all that\'s off the top of my head - I\'m sure you\'ve thought about it more at this point.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914082\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914082&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914082\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914082_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914082_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T16:19:53+0000\'\u003e23\\/Sep\\/10 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eQ: why aren\'t the CachePopulator methods just directly on EntryConfig - was it easier to share implementations that way or something?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eTwo reasons (but I can be talked out of it)\u003cbr\\/\u003e\\n1. this approach separates what you are asking for (bits\\/values\\/etc) from how they are actually generated (the \\\"populator\\\").  Something makes me uncomfortable about the caller asking for Values needing to also know how they are generated.  Seems easy to mess up.  With this approach the \'populator\' is attached to the field cache, and defines how stuff is read, vs the \'EntryConfig\' that defines what the user is asking for (particulary since they may change what they are asking for in subsequent calls)\u003c\\/p\u003e\\n\\n\u003cp\u003e2. The \'populator\' is attached to the FieldCache so it has consistent behavior across subsequet calls to getXxxxValues().  Note that with this approach, if you ask the field cache for just the \'values\' then later want the \'bits\' it uses the same populator and adds the results to the existing CachedArray value.\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eIt doesn\'t seem like we need two methods fillValidBits , fillByteValues\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe \'fillValidBits\' just fills up the valid bits w\\/o actually parsing (or caching) the values.  This is useful when:\u003cbr\\/\u003e\\n1. you only want the ValidBits, but not the values (Mike seems to want this)\u003cbr\\/\u003e\\n2. you first ask for just values, then later want the bits.  \u003c\\/p\u003e\\n\\n\u003cp\u003eThinking some more, I think the populator should look like this:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eCachePopulator \\n  {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e ByteValues   createByteValues(   IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e ShortValues  createShortValues(  IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e IntValues    createIntValues(    IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e FloatValues  createFloatValues(  IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e DoubleValues createDoubleValues( IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillByteValues(   ByteValues   vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillShortValues(  ShortValues  vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillIntValues(    IntValues    vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillFloatValues(  FloatValues  vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillDoubleValues( DoubleValues vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ This will only fill in the ValidBits w\\/o parsing any actual values\\n\u003c\\/span\u003e    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void fillValidBits( CachedArray  vals, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe default \'create\' implementation could look something like this:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n    @Override\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ShortValues createShortValues( IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryConfig config ) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException \\n    {\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( config == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n        config = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleEntryConfig();\\n      }\\n      ShortValues vals = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e ShortValues();\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( config.cacheValues() ) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.fillShortValues(vals, reader, field, config);\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( config.cacheValidBits() ) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.fillValidBits(vals, reader, field, config);\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ethrow\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RuntimeException( \u003cspan class=\\\"code-quote\\\"\u003e\\\"the config must cache values and\\/or bits\\\"\u003c\\/span\u003e );\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e vals;\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAnd the Cache \'createValue\' would looks somethign like this:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n  \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eByteCache \u003cspan class=\\\"code-keyword\\\"\u003eextends\u003c\\/span\u003e Cache {\\n    ByteCache(FieldCache wrapper) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e(wrapper);\\n    }\\n    \\n    @Override\\n    \u003cspan class=\\\"code-keyword\\\"\u003eprotected\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e ByteValues createValue(IndexReader reader, Entry entry, CachePopulator populator) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n      \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field = entry.field;\\n      EntryConfig config = (EntryConfig)entry.custom;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (config == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e wrapper.getByteValues(reader, field, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleEntryConfig() );\\n      }\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e populator.createByteValues(reader, field, config);\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ethoughts?  This would open up lots more of the field cache... so if we go this route, lets make sure it addresses the other issues people have with FieldCache.  IIUC, the other big request is to load the values from an external source &#8211; that should be possible with this approach.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914082_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914082_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T16:19:53+0000\'\u003e23\\/Sep\\/10 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Q: why aren\'t the CachePopulator methods just directly on EntryConfig - was it easier to share implementations that way or something?  \\n\\n Two reasons (but I can be talked out of it) \\n1. this approach separates what you are asking for (bits\\/values\\/etc) from how they are actually generated (the \\\"populator\\\").  Something makes me uncomfortable about the caller asking for Values needing to also know how they are generated.  Seems easy to mess up.  With this approach the \'populator\' is attached to the field cache, and defines how stuff is read, vs the \'EntryConfig\' that defines what the user is asking for (particulary since they may change what they are asking for in subsequent calls) \\n\\n 2. The \'populator\' is attached to the FieldCache so it has consistent behavior across subsequet calls to getXxxxValues().  Note that with this approach, if you ask the field cache for just the \'values\' then later want the \'bits\' it uses the same populator and adds the results to the existing CachedArray value. \\n\\n\\n  It doesn\'t seem like we need two methods fillValidBits , fillByteValues  \\n\\n The \'fillValidBits\' just fills up the valid bits w\\/o actually parsing (or caching) the values.  This is useful when: \\n1. you only want the ValidBits, but not the values (Mike seems to want this) \\n2. you first ask for just values, then later want the bits.   \\n\\n Thinking some more, I think the populator should look like this: \\n  \\n  public   abstract   class  CachePopulator \\n  {\\n     public   abstract  ByteValues   createByteValues(   IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  ShortValues  createShortValues(  IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  IntValues    createIntValues(    IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  FloatValues  createFloatValues(  IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  DoubleValues createDoubleValues( IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n    \\n     public   abstract  void fillByteValues(   ByteValues   vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  void fillShortValues(  ShortValues  vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  void fillIntValues(    IntValues    vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  void fillFloatValues(  FloatValues  vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n     public   abstract  void fillDoubleValues( DoubleValues vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n\\n     \\/\\/ This will only fill in the ValidBits w\\/o parsing any actual values\\n      public   abstract  void fillValidBits( CachedArray  vals, IndexReader reader,  String  field, EntryConfig config )  throws  IOException;\\n  }\\n \\n  \\n\\n The default \'create\' implementation could look something like this: \\n\\n  \\n \\n    @Override\\n     public  ShortValues createShortValues( IndexReader reader,  String  field, EntryConfig config )  throws  IOException \\n    {\\n       if ( config ==  null  ) {\\n        config =  new  SimpleEntryConfig();\\n      }\\n      ShortValues vals =  new  ShortValues();\\n       if ( config.cacheValues() ) {\\n         this .fillShortValues(vals, reader, field, config);\\n      }\\n       else   if ( config.cacheValidBits() ) {\\n         this .fillValidBits(vals, reader, field, config);\\n      }\\n       else  {\\n         throw   new  RuntimeException(  \\\"the config must cache values and\\/or bits\\\"  );\\n      }\\n       return  vals;\\n    }\\n \\n  \\n\\n And the Cache \'createValue\' would looks somethign like this: \\n  \\n \\n   static   final   class  ByteCache  extends  Cache {\\n    ByteCache(FieldCache wrapper) {\\n       super (wrapper);\\n    }\\n    \\n    @Override\\n     protected   final  ByteValues createValue(IndexReader reader, Entry entry, CachePopulator populator)  throws  IOException {\\n       String  field = entry.field;\\n      EntryConfig config = (EntryConfig)entry.custom;\\n       if  (config ==  null ) {\\n         return  wrapper.getByteValues(reader, field,  new  SimpleEntryConfig() );\\n      }\\n       return  populator.createByteValues(reader, field, config);\\n    }\\n  }\\n \\n  \\n\\n thoughts?  This would open up lots more of the field cache... so if we go this route, lets make sure it addresses the other issues people have with FieldCache.  IIUC, the other big request is to load the values from an external source &#8211; that should be possible with this approach.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914089\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914089&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914089\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914089_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914089_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T16:29:19+0000\'\u003e23\\/Sep\\/10 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh... I mis-matched the parens when I was looking at your proposal (hence the confusion).\u003c\\/p\u003e\\n\\n\u003cp\u003eI think getCachePopulator() should be under EntryConfig - that way people can provide their own (and extend ByteValues to include more info)\u003cbr\\/\u003e\\nOtherwise, we\'ll forever be locked into a lowest common denominator of only adding info that everyone can agree on.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914089_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914089_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T16:29:19+0000\'\u003e23\\/Sep\\/10 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh... I mis-matched the parens when I was looking at your proposal (hence the confusion). \\n\\n I think getCachePopulator() should be under EntryConfig - that way people can provide their own (and extend ByteValues to include more info) \\nOtherwise, we\'ll forever be locked into a lowest common denominator of only adding info that everyone can agree on.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914095\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914095&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914095\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914095_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914095_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 16:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T16:43:13+0000\'\u003e23\\/Sep\\/10 16:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think getCachePopulator() should be under EntryConfig - that way people can provide their own (and extend ByteValues to include more info)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSo you think it is better for \u003cb\u003eeach\u003c\\/b\u003e call to define how the cache works rather then having that as an attribute of the FieldCache (that could be extended).  The on thing that concerns me is that that forces all users of the FieldCache to be in sync.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this proposal, you could set the CachePopulator on the FieldCache. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eOtherwise, we\'ll forever be locked into a lowest common denominator of only adding info that everyone can agree on.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is why I just added the \'createXxxxValues\' functions on CachePopulator &#8211; a subclass could add other values.\u003c\\/p\u003e\\n\\n\u003cp\u003e------------\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like the basic difference between what we are thinking is that the Populator is attached to the FieldCache rather then each call to the FieldCache.  From my point of view, this would make it easier for system with a schema (like solr) have consistent results across all calls, rather then making each request to the FieldCache need to know about the schema -&gt; parsers -&gt; populator\u003c\\/p\u003e\\n\\n\u003cp\u003ebut I can always be convinced \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914095_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914095_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 16:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T16:43:13+0000\'\u003e23\\/Sep\\/10 16:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think getCachePopulator() should be under EntryConfig - that way people can provide their own (and extend ByteValues to include more info)  \\n\\n So you think it is better for  each  call to define how the cache works rather then having that as an attribute of the FieldCache (that could be extended).  The on thing that concerns me is that that forces all users of the FieldCache to be in sync. \\n\\n In this proposal, you could set the CachePopulator on the FieldCache.  \\n\\n \\n Otherwise, we\'ll forever be locked into a lowest common denominator of only adding info that everyone can agree on.  \\n\\n This is why I just added the \'createXxxxValues\' functions on CachePopulator &#8211; a subclass could add other values. \\n\\n ------------ \\n\\n It looks like the basic difference between what we are thinking is that the Populator is attached to the FieldCache rather then each call to the FieldCache.  From my point of view, this would make it easier for system with a schema (like solr) have consistent results across all calls, rather then making each request to the FieldCache need to know about the schema -&gt; parsers -&gt; populator \\n\\n but I can always be convinced                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914100\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914100&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914100\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914100_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914100_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:07:23+0000\'\u003e23\\/Sep\\/10 17:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIn this proposal, you could set the CachePopulator on the FieldCache. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmmm, OK, as long as it\'s possible.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eFrom my point of view, this would make it easier for system with a schema (like solr) have consistent results across all calls, rather then making each request to the FieldCache need to know about the schema -&gt; parsers -&gt; populator\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think this may make it a lot harder from Solr\'s point of view.\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eit\'s essentially a static... so it had better not ever be configurable from the schema or solrconfig, or it will break multi-core.\u003c\\/li\u003e\\n\\t\u003cli\u003eif we ever \u003cb\u003edid\u003c\\/b\u003e want to treat fields differently (load some values from a DB, etc), we\'d want to look that up in the schema - but we don\'t have a reference to the scema in the populator, and we wouldn\'t want to store one there (again, we have multiple schemas).  So... we could essentially create custom EntryConfig object and then our custom CachePopulator could delegate to the entry config  (and we\'ve essentially re-invented a way to be able to specify the populator on a per-field basis).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAre EntryConfig objects stored as keys anywhere?   We need to be very careful about memory leaks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914100_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914100_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:07:23+0000\'\u003e23\\/Sep\\/10 17:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     In this proposal, you could set the CachePopulator on the FieldCache.   \\n\\n Hmmm, OK, as long as it\'s possible. \\n\\n  From my point of view, this would make it easier for system with a schema (like solr) have consistent results across all calls, rather then making each request to the FieldCache need to know about the schema -&gt; parsers -&gt; populator  \\n\\n I think this may make it a lot harder from Solr\'s point of view. \\n \\n\\t it\'s essentially a static... so it had better not ever be configurable from the schema or solrconfig, or it will break multi-core. \\n\\t if we ever  did  want to treat fields differently (load some values from a DB, etc), we\'d want to look that up in the schema - but we don\'t have a reference to the scema in the populator, and we wouldn\'t want to store one there (again, we have multiple schemas).  So... we could essentially create custom EntryConfig object and then our custom CachePopulator could delegate to the entry config  (and we\'ve essentially re-invented a way to be able to specify the populator on a per-field basis). \\n \\n\\n\\n Are EntryConfig objects stored as keys anywhere?   We need to be very careful about memory leaks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914109\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914109&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914109\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914109_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914109_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:19:34+0000\'\u003e23\\/Sep\\/10 17:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt\'s all doable though I guess - even if EntryConfig objects are used as cache keys, we could store a weak reference to the solr core.\u003cbr\\/\u003e\\nSo I say, proceed with what you think will make it easy for Lucene users - and don\'t focus on what will be easy for Solr.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914109_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914109_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:19:34+0000\'\u003e23\\/Sep\\/10 17:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It\'s all doable though I guess - even if EntryConfig objects are used as cache keys, we could store a weak reference to the solr core. \\nSo I say, proceed with what you think will make it easy for Lucene users - and don\'t focus on what will be easy for Solr.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914115\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914115&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914115\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914115_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914115_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:37:49+0000\'\u003e23\\/Sep\\/10 17:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003epreface, I don\'t really know how FieldCache is used, so my assumptions could be way off...\u003c\\/p\u003e\\n\\n\u003cp\u003eIn solr, is there one FieldCache for all all cores, or does each core get its own FieldCache?  \u003c\\/p\u003e\\n\\n\u003cp\u003eI figured each core would create a single CachePopulator (with a reference to the schema) and attach it to the FieldCache.  If that is not possible, then ya, it will be better to put that in the request.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAre EntryConfig objects stored as keys anywhere? We need to be very careful about memory leaks.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, the EntryConfig is part of the \'Entry\' and gets stored as a key.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914115_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914115_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:37:49+0000\'\u003e23\\/Sep\\/10 17:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    preface, I don\'t really know how FieldCache is used, so my assumptions could be way off... \\n\\n In solr, is there one FieldCache for all all cores, or does each core get its own FieldCache?   \\n\\n I figured each core would create a single CachePopulator (with a reference to the schema) and attach it to the FieldCache.  If that is not possible, then ya, it will be better to put that in the request. \\n\\n  Are EntryConfig objects stored as keys anywhere? We need to be very careful about memory leaks.  \\n\\n Yes, the EntryConfig is part of the \'Entry\' and gets stored as a key.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914123\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914123&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914123\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914123_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914123_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:52:32+0000\'\u003e23\\/Sep\\/10 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIn solr, is there one FieldCache for all all cores, or does each core get its own FieldCache? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere is a single FieldCache for all cores (same as in Lucene).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914123_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914123_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 17:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T17:52:32+0000\'\u003e23\\/Sep\\/10 17:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     In solr, is there one FieldCache for all all cores, or does each core get its own FieldCache?   \\n\\n There is a single FieldCache for all cores (same as in Lucene).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914136\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914136&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914136\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914136_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914136_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T18:10:23+0000\'\u003e23\\/Sep\\/10 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePassing it in would also allow a way to get rid of the StopFillCacheException hack for NumericField in the future.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914136_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914136_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T18:10:23+0000\'\u003e23\\/Sep\\/10 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Passing it in would also allow a way to get rid of the StopFillCacheException hack for NumericField in the future.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914163\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914163&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914163\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914163_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914163_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T18:55:19+0000\'\u003e23\\/Sep\\/10 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, as I look more, I think it may be worth some even bigger changes!  \u003c\\/p\u003e\\n\\n\u003cp\u003eIs there any advantage to having a different map for each Type?  The double (and triple) cache can get a bit crazy and lead to so much duplication\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat about moving to a FieldCache that is centered around the very basic API:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e &lt;T&gt; T get(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field, EntryCreator&lt;T&gt; creator)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eEntry creator would be something like\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003estatic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eEntryCreator&lt;T&gt; \u003cspan class=\\\"code-keyword\\\"\u003eimplements\u003c\\/span\u003e Serializable \\n  {\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e T create( IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field );\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eabstract\u003c\\/span\u003e void validate( T entry, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field );\\n    \\n    \\/**\\n     * NOTE: the hashCode is used as part of the cache Key, so make sure it \\n     * only changes \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e you want different entries \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e the same field\\n     *\\/\\n    @Override\\n    \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e hashCode()\\n    {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e EntryCreator.\u003cspan class=\\\"code-keyword\\\"\u003eclass.\u003c\\/span\u003ehashCode();\\n    }\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWe could add all the utility functions that cast stuff to ByteValues etc.  We would also make sure that the Map does not use the EntryCreator as a key, but uses it to generate a key.\u003c\\/p\u003e\\n\\n\u003cp\u003eA sample EntryCreator would look like this:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n\u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eBytesEntryCreator \u003cspan class=\\\"code-keyword\\\"\u003eextends\u003c\\/span\u003e FieldCache.EntryCreator&lt;ByteValues&gt; {\\n\\n  @Override\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e ByteValues create(IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) \\n  {\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ all the normal walking stuff using whatever parameters we have specified\\n\u003c\\/span\u003e  }\\n\\n  @Override\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e void validate(ByteValues entry, IndexReader reader, \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) \\n  {\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ all the normal walking stuff using whatever parameters we have specified\\n\u003c\\/span\u003e  }  \\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThoughts on this approach?  \u003c\\/p\u003e\\n\\n\\n\u003cp\u003eCrazy how a seemingly simple issue just explodes \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914163_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914163_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 18:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T18:55:19+0000\'\u003e23\\/Sep\\/10 18:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, as I look more, I think it may be worth some even bigger changes!   \\n\\n Is there any advantage to having a different map for each Type?  The double (and triple) cache can get a bit crazy and lead to so much duplication \\n\\n What about moving to a FieldCache that is centered around the very basic API: \\n\\n  \\n  public  &lt;T&gt; T get(IndexReader reader,  String  field, EntryCreator&lt;T&gt; creator)\\n \\n  \\n\\n Entry creator would be something like \\n  \\n  public   abstract   static   class  EntryCreator&lt;T&gt;  implements  Serializable \\n  {\\n     public   abstract  T create( IndexReader reader,  String  field );\\n     public   abstract  void validate( T entry, IndexReader reader,  String  field );\\n    \\n    \\/**\\n     * NOTE: the hashCode is used as part of the cache Key, so make sure it \\n     * only changes  if  you want different entries  for  the same field\\n     *\\/\\n    @Override\\n     public   int  hashCode()\\n    {\\n       return  EntryCreator. class. hashCode();\\n    }\\n  }\\n \\n  \\n\\n We could add all the utility functions that cast stuff to ByteValues etc.  We would also make sure that the Map does not use the EntryCreator as a key, but uses it to generate a key. \\n\\n A sample EntryCreator would look like this: \\n  \\n \\n class  BytesEntryCreator  extends  FieldCache.EntryCreator&lt;ByteValues&gt; {\\n\\n  @Override\\n   public  ByteValues create(IndexReader reader,  String  field) \\n  {\\n     \\/\\/ all the normal walking stuff using whatever parameters we have specified\\n   }\\n\\n  @Override\\n   public  void validate(ByteValues entry, IndexReader reader,  String  field) \\n  {\\n     \\/\\/ all the normal walking stuff using whatever parameters we have specified\\n   }  \\n}\\n \\n  \\n\\n Thoughts on this approach?   \\n\\n\\n Crazy how a seemingly simple issue just explodes                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914169\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914169&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914169\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914169_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914169_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:05:29+0000\'\u003e23\\/Sep\\/10 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmmm, that would also seem to transform the FieldCache into a more generic index reader cache - not a bad idea!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914169_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914169_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:05:29+0000\'\u003e23\\/Sep\\/10 19:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmmm, that would also seem to transform the FieldCache into a more generic index reader cache - not a bad idea!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914175\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914175&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914175\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914175_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914175_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:16:13+0000\'\u003e23\\/Sep\\/10 19:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe we should also look at CSF again and what Simon did (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2186\\\" title=\\\"First cut at column-stride fields (index values storage)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2186\\\"\u003e\u003cdel\u003eLUCENE-2186\u003c\\/del\u003e\u003c\\/a\u003e). In my opinion, the field cache\'s public API should not look different from CSF, so one can simply also sort against a CSF.\u003c\\/p\u003e\\n\\n\u003cp\u003eI know, some people here will hurt me if I suggest to remove tha native arrays and instead provide getter methods like in the ValueSource approach. The native arrays are unflexible and Java 6 will hopefully optimize away the additional method call (at least I have seen no speed penalty when trying with CSF\'s getter API). Cool things could be done like materializing the FieldCache to disk using mmap by e.g. FileChannel.map(...).order(ByteOrder.BIG_ENDIAN).asFloatBuffer() which is then accessible using get(docId). I tested this and works very fine for sorting in Lucene! Java uses internally source code specialization to return different classes depending on native byte order that access the underlying ByteBuffer directly (not manually combining 4 bytes into a float). So the get(docId) call is only bounds checks and \u003cb\u003eone\u003c\\/b\u003e mmaped memory access.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914175_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914175_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:16:13+0000\'\u003e23\\/Sep\\/10 19:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    +1 \\n\\n Maybe we should also look at CSF again and what Simon did (  LUCENE-2186  ). In my opinion, the field cache\'s public API should not look different from CSF, so one can simply also sort against a CSF. \\n\\n I know, some people here will hurt me if I suggest to remove tha native arrays and instead provide getter methods like in the ValueSource approach. The native arrays are unflexible and Java 6 will hopefully optimize away the additional method call (at least I have seen no speed penalty when trying with CSF\'s getter API). Cool things could be done like materializing the FieldCache to disk using mmap by e.g. FileChannel.map(...).order(ByteOrder.BIG_ENDIAN).asFloatBuffer() which is then accessible using get(docId). I tested this and works very fine for sorting in Lucene! Java uses internally source code specialization to return different classes depending on native byte order that access the underlying ByteBuffer directly (not manually combining 4 bytes into a float). So the get(docId) call is only bounds checks and  one  mmaped memory access.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914177\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914177&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914177\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914177_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914177_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:17:53+0000\'\u003e23\\/Sep\\/10 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHmmm, that would also seem to transform the FieldCache into a more generic index reader cache - not a bad idea! \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut is it a good one?!  This would let the FieldCache just focus on the synchronized cache mechenism, and the each EntryCreator would need to do its own Parsing etc\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eAnyone know what the deal is with IndexReader:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-comment\\\"\u003e\\/** Expert *\\/\u003c\\/span\u003e\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e getCoreCacheKey() {\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914177_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914177_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:17:53+0000\'\u003e23\\/Sep\\/10 19:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Hmmm, that would also seem to transform the FieldCache into a more generic index reader cache - not a bad idea!   \\n\\n But is it a good one?!  This would let the FieldCache just focus on the synchronized cache mechenism, and the each EntryCreator would need to do its own Parsing etc \\n\\n\\n Anyone know what the deal is with IndexReader: \\n  \\n    \\/** Expert *\\/ \\n   public   Object  getCoreCacheKey() {\\n     return   this ;\\n  }\\n \\n  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914178\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914178&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914178\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914178_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914178_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:22:13+0000\'\u003e23\\/Sep\\/10 19:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAnyone know what the deal is with IndexReader:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt is to share the cache for clones of IndexReaders or when SegmentReaders are reopended with different deleted docs. In this case the underlying Reader is the same, so it should use its cache (e.g. when deleted docs are added, you dont need to invalidate the cache).\u003c\\/p\u003e\\n\\n\u003cp\u003eFor more info, ask Mike McCandless!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914178_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914178_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:22:13+0000\'\u003e23\\/Sep\\/10 19:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Anyone know what the deal is with IndexReader:  \\n\\n It is to share the cache for clones of IndexReaders or when SegmentReaders are reopended with different deleted docs. In this case the underlying Reader is the same, so it should use its cache (e.g. when deleted docs are added, you dont need to invalidate the cache). \\n\\n For more info, ask Mike McCandless!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914179\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914179&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914179\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914179_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914179_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:23:02+0000\'\u003e23\\/Sep\\/10 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUwe, I think we need to keep the native arrays.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eJava 6 will hopefully optimize away the additional method call\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt only does if you have \u003cb\u003eone\u003c\\/b\u003e implementation at the point where it is used.  We just got done specializing the ord sorting code with native arrays because of this - the speed hit was really non-trivial, and it happened with the latest versions of all of the JVMs I tested (oracle 1.6, oracle 1.7, ibm 1.6).  I see no relief for this issue on the horizon.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914179_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914179_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:23:02+0000\'\u003e23\\/Sep\\/10 19:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uwe, I think we need to keep the native arrays. \\n\\n  Java 6 will hopefully optimize away the additional method call  \\n\\n It only does if you have  one  implementation at the point where it is used.  We just got done specializing the ord sorting code with native arrays because of this - the speed hit was really non-trivial, and it happened with the latest versions of all of the JVMs I tested (oracle 1.6, oracle 1.7, ibm 1.6).  I see no relief for this issue on the horizon.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914184\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914184&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914184\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914184_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914184_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:34:54+0000\'\u003e23\\/Sep\\/10 19:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eremove tha native arrays and instead provide getter methods like in the ValueSource approach\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhat would this look like?  Are you suggesting rather then having:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eByteValues {\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e[] values;\\n};\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ewe have:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eByteValues {\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003ebyte\u003c\\/span\u003e getValue( \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e doc )\\n};\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eor are you suggesting like DocValues that has, intVal, longVal, floatVal, even though only one \u003cb\u003ereally\u003c\\/b\u003e makes sense?\u003c\\/p\u003e\\n\\n\u003cp\u003eIs this something that wold need the proposed FieldCache API to change?  or could it be implemented via EntryCreator?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf we like the more general cache, that probably needs its own issue (wow scope creep!)\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914184_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914184_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:34:54+0000\'\u003e23\\/Sep\\/10 19:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     remove tha native arrays and instead provide getter methods like in the ValueSource approach  \\n\\n What would this look like?  Are you suggesting rather then having: \\n  \\n  class  ByteValues {\\n   public   byte [] values;\\n};\\n \\n  \\n\\n we have: \\n  \\n  class  ByteValues {\\n   public   byte  getValue(  int  doc )\\n};\\n \\n  \\n\\n or are you suggesting like DocValues that has, intVal, longVal, floatVal, even though only one  really  makes sense? \\n\\n Is this something that wold need the proposed FieldCache API to change?  or could it be implemented via EntryCreator? \\n\\n If we like the more general cache, that probably needs its own issue (wow scope creep!) \\n\\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914185\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914185&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914185\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914185_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914185_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:35:29+0000\'\u003e23\\/Sep\\/10 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYonik: I was expecting this answer...\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reason is that my current contact (it\'s also your\'s) has exactly that problem also with norms (but also FC), that they want to lazily load values for sorting\\/norms (see the very old issue \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-505\\\" title=\\\"MultiReader.norm() takes up too much memory: norms byte[] should be made into an Object\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-505\\\"\u003e\u003cdel\u003eLUCENE-505\u003c\\/del\u003e\u003c\\/a\u003e). At least we should have a TopFieldDocCollector that can alternatively to native arrays also use a ValueSource-like aproach with getter methods - so you could sort against a CSF. Even if it is 20% slower, in some cases thats the only way to get a suitable search experience. Not always speed is the most important thing, sometimes also space requirements or warmup times. I would have no problem with providing both and chosing the implementation that is most speed-effective. So if no native arrays are provided by the FieldCache use getter methods.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914185_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914185_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:35:29+0000\'\u003e23\\/Sep\\/10 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yonik: I was expecting this answer... \\n\\n The reason is that my current contact (it\'s also your\'s) has exactly that problem also with norms (but also FC), that they want to lazily load values for sorting\\/norms (see the very old issue   LUCENE-505  ). At least we should have a TopFieldDocCollector that can alternatively to native arrays also use a ValueSource-like aproach with getter methods - so you could sort against a CSF. Even if it is 20% slower, in some cases thats the only way to get a suitable search experience. Not always speed is the most important thing, sometimes also space requirements or warmup times. I would have no problem with providing both and chosing the implementation that is most speed-effective. So if no native arrays are provided by the FieldCache use getter methods.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914188\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914188&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914188\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914188_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914188_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:40:58+0000\'\u003e23\\/Sep\\/10 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI see no relief for this issue on the horizon.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe need to specialize the code... either manually or automatically...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914188_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914188_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:40:58+0000\'\u003e23\\/Sep\\/10 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I see no relief for this issue on the horizon.  \\n\\n We need to specialize the code... either manually or automatically...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914191\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914191&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914191\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914191_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914191_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:43:41+0000\'\u003e23\\/Sep\\/10 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf we like the more general cache, that probably needs its own issue\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCorrect - with a more general fieldCache, one could implement alternatives that MMAP files, etc.  But those alternative implementations certainly should not be included in this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914191_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914191_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:43:41+0000\'\u003e23\\/Sep\\/10 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If we like the more general cache, that probably needs its own issue  \\n\\n Correct - with a more general fieldCache, one could implement alternatives that MMAP files, etc.  But those alternative implementations certainly should not be included in this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914194\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914194&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914194\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914194_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914194_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:48:43+0000\'\u003e23\\/Sep\\/10 19:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 23\\/Sep\\/10 19:49\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just wanted to mention that, so the design of the new FC is more flexible in that case. I am just pissed of because of these arrays and no flexibility \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThe FC impl should be in line with the CSF aproach from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2186\\\" title=\\\"First cut at column-stride fields (index values storage)\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2186\\\"\u003e\u003cdel\u003eLUCENE-2186\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914194_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914194_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Sep\\/10 19:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-23T19:48:43+0000\'\u003e23\\/Sep\\/10 19:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 23\\/Sep\\/10 19:49\\\"\u003eedited\u003c\\/span\u003e                   I just wanted to mention that, so the design of the new FC is more flexible in that case. I am just pissed of because of these arrays and no flexibility   \\n\\n The FC impl should be in line with the CSF aproach from   LUCENE-2186  .              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 10:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T10:10:34+0000\'\u003e24\\/Sep\\/10 10:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI like where this all is going!!  We can finally fix FC!!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIn my opinion, the field cache\'s public API should not look different from CSF, so one can simply also sort against a CSF.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom the consumption standpoint, they (FC and CSF) really ought to be\u003cbr\\/\u003e\\none and the same.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat\'s \\\"unique\\\" about FieldCache is that it derives its values via\u003cbr\\/\u003e\\nuninversion... this is nice because there\'s no index change, but it\'s\u003cbr\\/\u003e\\nslow at reader open time.  It\'s also error-proned (you may hit\u003cbr\\/\u003e\\nmultiple values per doc, these values may have gone through analysis,\u003cbr\\/\u003e\\netc.)\u003c\\/p\u003e\\n\\n\u003cp\u003eCSF, instead, actually computes the values during indexing and stores\u003cbr\\/\u003e\\nthe raw, pre-computed array, in the index.\u003c\\/p\u003e\\n\\n\u003cp\u003eThey are both just different sources for the same thing.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, an app should be free to plugin its own external source, and it\u003cbr\\/\u003e\\nshould present this same \\\"values source\\\" API.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eUwe, I think we need to keep the native arrays.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think the API should allow for optional retrieval of the backing\u003cbr\\/\u003e\\narray (and we should \u003cspan class=\\\"error\\\"\u003e&#91;manually, for today&#93;\u003c\\/span\u003e specialize the sort\u003cbr\\/\u003e\\ncomparators), but primary access should be a method call eg\u003cbr\\/\u003e\\nByteValues.getValue(int docID).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 10:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T10:10:34+0000\'\u003e24\\/Sep\\/10 10:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I like where this all is going!!  We can finally fix FC!! \\n\\n  In my opinion, the field cache\'s public API should not look different from CSF, so one can simply also sort against a CSF.  \\n\\n +1 \\n\\n From the consumption standpoint, they (FC and CSF) really ought to be \\none and the same. \\n\\n What\'s \\\"unique\\\" about FieldCache is that it derives its values via \\nuninversion... this is nice because there\'s no index change, but it\'s \\nslow at reader open time.  It\'s also error-proned (you may hit \\nmultiple values per doc, these values may have gone through analysis, \\netc.) \\n\\n CSF, instead, actually computes the values during indexing and stores \\nthe raw, pre-computed array, in the index. \\n\\n They are both just different sources for the same thing. \\n\\n Also, an app should be free to plugin its own external source, and it \\nshould present this same \\\"values source\\\" API. \\n\\n  Uwe, I think we need to keep the native arrays.  \\n\\n I think the API should allow for optional retrieval of the backing \\narray (and we should  &#91;manually, for today&#93;  specialize the sort \\ncomparators), but primary access should be a method call eg \\nByteValues.getValue(int docID).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914508\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914508&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914508\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914508_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914508_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T15:56:54+0000\'\u003e24\\/Sep\\/10 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eUwe, I think we need to keep the native arrays.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think the API should allow for optional retrieval of the backing\u003cbr\\/\u003e\\narray (and we should \u003cspan class=\\\"error\\\"\u003e&#91;manually, for today&#93;\u003c\\/span\u003e specialize the sort\u003cbr\\/\u003e\\ncomparators), but primary access should be a method call eg\u003cbr\\/\u003e\\nByteValues.getValue(int docID).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eExactly. Maybe do it like with NIO buffers: they have methods hasArray(), array() and arrayOffset(), the two last ones throw UnsupportedOp, if first is false. We already have quite a lot TopFieldDocCollectors impls as inner classes, a few more choosen by hasArray()... haha \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12914508_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914508_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 15:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T15:56:54+0000\'\u003e24\\/Sep\\/10 15:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  Uwe, I think we need to keep the native arrays.  \\n\\n I think the API should allow for optional retrieval of the backing \\narray (and we should  &#91;manually, for today&#93;  specialize the sort \\ncomparators), but primary access should be a method call eg \\nByteValues.getValue(int docID).  \\n\\n Exactly. Maybe do it like with NIO buffers: they have methods hasArray(), array() and arrayOffset(), the two last ones throw UnsupportedOp, if first is false. We already have quite a lot TopFieldDocCollectors impls as inner classes, a few more choosen by hasArray()... haha                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914515\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914515&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914515\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914515_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914515_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T16:21:29+0000\'\u003e24\\/Sep\\/10 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt feels like incremental improvement keeps being held hostage...\u003cbr\\/\u003e\\nCan\'t we first just allow the retrieval of ByteValues, etc, that also have Bits on it?\u003cbr\\/\u003e\\nChanging everything to go through getValue() should be a separate issue (and CSF isn\'t even finalized\\/committed yet).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914515_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914515_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T16:21:29+0000\'\u003e24\\/Sep\\/10 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It feels like incremental improvement keeps being held hostage... \\nCan\'t we first just allow the retrieval of ByteValues, etc, that also have Bits on it? \\nChanging everything to go through getValue() should be a separate issue (and CSF isn\'t even finalized\\/committed yet).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914551\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914551&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914551\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914551_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914551_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T17:28:48+0000\'\u003e24\\/Sep\\/10 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eCan\'t we first just allow the retrieval of ByteValues, etc, that also have Bits on it?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI sure \u003cb\u003ehope\u003c\\/b\u003e so... otherwise, I doubt anything will move forward.  \u003c\\/p\u003e\\n\\n\u003cp\u003eMy hope with \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e, is to fix the basic problem &#8211; in a way that does not close the door to the improvements we want to make in the future.  I think\\/hope we are close.  \u003c\\/p\u003e\\n\\n\u003cp\u003eIf I\'m missing something let me know, so I can stop wasting my time.\u003c\\/p\u003e\\n\\n\u003cp\u003e(I don\'t even know what CSF is, and do not want to learn right now)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914551_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914551_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 17:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T17:28:48+0000\'\u003e24\\/Sep\\/10 17:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Can\'t we first just allow the retrieval of ByteValues, etc, that also have Bits on it?  \\n\\n I sure  hope  so... otherwise, I doubt anything will move forward.   \\n\\n My hope with   LUCENE-2665  , is to fix the basic problem &#8211; in a way that does not close the door to the improvements we want to make in the future.  I think\\/hope we are close.   \\n\\n If I\'m missing something let me know, so I can stop wasting my time. \\n\\n (I don\'t even know what CSF is, and do not want to learn right now)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914861\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914861&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914861\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914861_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914861_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Sep\\/10 19:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-25T19:10:11+0000\'\u003e25\\/Sep\\/10 19:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is a new patch that incorporates most of the ideas we have discussed.  I tried addressing the larger issue of the FieldCache mess in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e, but that is too big to tackle in one go.  After getting something to \u003cb\u003ealmost\u003c\\/b\u003e work for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e, I then just took the EntryCreator stuff and am adding that to \'\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2649\\\" title=\\\"FieldCache should include a BitSet for matching docs\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2649\\\"\u003e\u003cdel\u003eLUCENE-2649\u003c\\/del\u003e\u003c\\/a\u003e\'\u003c\\/p\u003e\\n\\n\u003cp\u003eAs such, some of the choices about how EntryCreator works are based on future plans, and my feel akward today.  Speciffically:\u003c\\/p\u003e\\n\\n\u003cp\u003e1. In the future, a Cache on the IndexReader should not necessarily be tied to a field name.  To do this, the field name parameter should be part of the EntryCreator.  In this first pass, we will need to pass the field name twice:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eIntValues  vals = cache.getInts(reader, \u003cspan class=\\\"code-quote\\\"\u003e\\\"fieldName\\\"\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e IntValuesCreator( \u003cspan class=\\\"code-quote\\\"\u003e\\\"fieldName\\\"\u003c\\/span\u003e, parser, flags ) )\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eI think the tradeoff is OK, and makes fewer changes in the future.\u003c\\/p\u003e\\n\\n\u003cp\u003e2. In the future, the EntryCreator.getCacheKey() should be the only key stored.  To fall within the existing structure, the entire EntryCreator is stored on the \'custom\' field on the internal cache, but the equals and hashCode values are bubbled up.  This makes more sense for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e.  For now we need to be careful that the EntryCreator classes are reasonable things to store as Keys (it includes the Parser, etc)\u003c\\/p\u003e\\n\\n\u003cp\u003e-----------------------------\u003c\\/p\u003e\\n\\n\u003cp\u003eI added a bunch of tests to exercise how sequential calls with different options behave.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this patch is ready to commit to \\/trunk &#8211; when it is in, I\'ll make a patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince \\/trunk is now a bit more experimental, and I feel pretty good about the feedback this has had I will probably jump the gun and commit soon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12914861_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914861_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Sep\\/10 19:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-25T19:10:11+0000\'\u003e25\\/Sep\\/10 19:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is a new patch that incorporates most of the ideas we have discussed.  I tried addressing the larger issue of the FieldCache mess in   LUCENE-2665  , but that is too big to tackle in one go.  After getting something to  almost  work for   LUCENE-2665  , I then just took the EntryCreator stuff and am adding that to \'  LUCENE-2649  \' \\n\\n As such, some of the choices about how EntryCreator works are based on future plans, and my feel akward today.  Speciffically: \\n\\n 1. In the future, a Cache on the IndexReader should not necessarily be tied to a field name.  To do this, the field name parameter should be part of the EntryCreator.  In this first pass, we will need to pass the field name twice: \\n  \\n IntValues  vals = cache.getInts(reader,  \\\"fieldName\\\" ,  new  IntValuesCreator(  \\\"fieldName\\\" , parser, flags ) )\\n \\n  \\n I think the tradeoff is OK, and makes fewer changes in the future. \\n\\n 2. In the future, the EntryCreator.getCacheKey() should be the only key stored.  To fall within the existing structure, the entire EntryCreator is stored on the \'custom\' field on the internal cache, but the equals and hashCode values are bubbled up.  This makes more sense for   LUCENE-2665  .  For now we need to be careful that the EntryCreator classes are reasonable things to store as Keys (it includes the Parser, etc) \\n\\n ----------------------------- \\n\\n I added a bunch of tests to exercise how sequential calls with different options behave. \\n\\n I think this patch is ready to commit to \\/trunk &#8211; when it is in, I\'ll make a patch for   LUCENE-2665  . \\n\\n Since \\/trunk is now a bit more experimental, and I feel pretty good about the feedback this has had I will probably jump the gun and commit soon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914959\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914959&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914959\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914959_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914959_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 10:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T10:49:00+0000\'\u003e26\\/Sep\\/10 10:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eApologies for \'CTR\' rather then \'RTC\' &#8211; we can always revert if I jumped the gun!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBetter to ask forgiveness than permission \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact I\'m +1 on switching Lucene\'s trunk to CTR model instead, now\u003cbr\\/\u003e\\nthat we have 3.x as the stable branch.  We have enough \\\"policemen\\\"\u003cbr\\/\u003e\\naround here that I think this\'d work well.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe changes look great Ryan &#8211; nice work!\u003c\\/p\u003e\\n\\n\u003cp\u003eSome smallish feedback:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI see some windows eol\'s snuck in... can you change the\u003cbr\\/\u003e\\n    svn:eol-style of all the new sources to \\\"native\\\"?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eSome classes are missing copyright header (at least EntryKey,\u003cbr\\/\u003e\\n    SimpleEntryKey)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eShouldn\'t we only incr .numDocs if the bit wasn\'t already set?\u003cbr\\/\u003e\\n    (To be robust if docs have more than one value).  Ie we can use\u003cbr\\/\u003e\\n    OpenBits.getAndSet.  Maybe then add and assert that numDoc &lt;=\u003cbr\\/\u003e\\n    maxDoc in the end...\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThen, we can pass null for the delDocs to the enums, and then we\u003cbr\\/\u003e\\n    don\'t need a 2nd pass to detect matchAllDocs (just test if\u003cbr\\/\u003e\\n    .numDocs == maxDoc())?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI think we should hold off on backport to 3.x until we stabilize\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like you\'ve also fixed \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2527\\\" title=\\\"FieldCache.getTermsIndex should cache fasterButMoreRAM=true|false to the same cache key\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2527\\\"\u003eLUCENE-2527\u003c\\/a\u003e with this?  Ie the\u003cbr\\/\u003e\\nfasterButMoreRAM=true|false now cache to the same key?  It\'s just that\u003cbr\\/\u003e\\nperhaps we should \\\"upgrade\\\" the entry, if it was first created w\\/\u003cbr\\/\u003e\\nfalse and then the current call passes true?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914959_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914959_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 10:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T10:49:00+0000\'\u003e26\\/Sep\\/10 10:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Apologies for \'CTR\' rather then \'RTC\' &#8211; we can always revert if I jumped the gun!  \\n\\n Better to ask forgiveness than permission   \\n\\n In fact I\'m +1 on switching Lucene\'s trunk to CTR model instead, now \\nthat we have 3.x as the stable branch.  We have enough \\\"policemen\\\" \\naround here that I think this\'d work well. \\n\\n The changes look great Ryan &#8211; nice work! \\n\\n Some smallish feedback: \\n\\n \\n\\t I see some windows eol\'s snuck in... can you change the \\n    svn:eol-style of all the new sources to \\\"native\\\"? \\n \\n\\n\\n \\n\\t Some classes are missing copyright header (at least EntryKey, \\n    SimpleEntryKey) \\n \\n\\n\\n \\n\\t Shouldn\'t we only incr .numDocs if the bit wasn\'t already set? \\n    (To be robust if docs have more than one value).  Ie we can use \\n    OpenBits.getAndSet.  Maybe then add and assert that numDoc &lt;= \\n    maxDoc in the end... \\n \\n\\n\\n \\n\\t Then, we can pass null for the delDocs to the enums, and then we \\n    don\'t need a 2nd pass to detect matchAllDocs (just test if \\n    .numDocs == maxDoc())? \\n \\n\\n\\n I think we should hold off on backport to 3.x until we stabilize \\n  LUCENE-2665  ? \\n\\n It looks like you\'ve also fixed  LUCENE-2527  with this?  Ie the \\nfasterButMoreRAM=true|false now cache to the same key?  It\'s just that \\nperhaps we should \\\"upgrade\\\" the entry, if it was first created w\\/ \\nfalse and then the current call passes true?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914960\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914960&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914960\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914960_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914960_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 11:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T11:01:52+0000\'\u003e26\\/Sep\\/10 11:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we have a synchronization issue on the call to validate?  Ie, more than 1 thread can enter validate, and eg compute the valid bits (if they weren\'t computed on the first create())?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914960_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914960_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 11:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T11:01:52+0000\'\u003e26\\/Sep\\/10 11:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we have a synchronization issue on the call to validate?  Ie, more than 1 thread can enter validate, and eg compute the valid bits (if they weren\'t computed on the first create())?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914973\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914973&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914973\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914973_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914973_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 13:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T13:30:09+0000\'\u003e26\\/Sep\\/10 13:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIt\'s just that perhaps we should \\\"upgrade\\\" the entry, if it was first created w\\/false and then the current call passes true?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe just need to watch the thread safety of stuff like this.\u003cbr\\/\u003e\\nFor Bits, it should be trivial... if you didn\'t ask for bits, you shouldn\'t be looking at it.\u003cbr\\/\u003e\\nfasterButMoreRAM is different... upgrading an existing entry could be tricky.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12914973_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914973_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 13:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T13:30:09+0000\'\u003e26\\/Sep\\/10 13:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     It\'s just that perhaps we should \\\"upgrade\\\" the entry, if it was first created w\\/false and then the current call passes true?  \\n\\n We just need to watch the thread safety of stuff like this. \\nFor Bits, it should be trivial... if you didn\'t ask for bits, you shouldn\'t be looking at it. \\nfasterButMoreRAM is different... upgrading an existing entry could be tricky.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914989\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12914989&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914989\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914989_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914989_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 16:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T16:08:12+0000\'\u003e26\\/Sep\\/10 16:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eWe just need to watch the thread safety of stuff like this.\u003cbr\\/\u003e\\nFor Bits, it should be trivial... if you didn\'t ask for bits, you shouldn\'t be looking at it.\u003cbr\\/\u003e\\nfasterButMoreRAM is different... upgrading an existing entry could be tricky.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAnd, also, we need to decide the policy.  Ie I think it\'s best if whoever gets there first, wins, for this case.  Ie we should not in fact upgrade to fasterButMoreRAM if the existing entry isn\'t...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12914989_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914989_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 16:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T16:08:12+0000\'\u003e26\\/Sep\\/10 16:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n We just need to watch the thread safety of stuff like this. \\nFor Bits, it should be trivial... if you didn\'t ask for bits, you shouldn\'t be looking at it. \\nfasterButMoreRAM is different... upgrading an existing entry could be tricky.  \\n\\n And, also, we need to decide the policy.  Ie I think it\'s best if whoever gets there first, wins, for this case.  Ie we should not in fact upgrade to fasterButMoreRAM if the existing entry isn\'t...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915039\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915039&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915039\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12915039_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915039_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T21:17:05+0000\'\u003e26\\/Sep\\/10 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mike, I\'ll take a look and fix the small issues later tonight.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think we should hold off on backport to 3.x until we stabilize \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2665\\\" title=\\\"Rework FieldCache to be more flexible\\/general\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2665\\\"\u003e\u003cdel\u003eLUCENE-2665\u003c\\/del\u003e\u003c\\/a\u003e?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1, I think it makes sense to backport to 3.x when there is a clear upgrade path.  \u003c\\/p\u003e\\n\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eI think we have a synchronization issue on the call to validate?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eLooks like it.  There are two approaches we could take.  \u003c\\/p\u003e\\n\\n\u003cp\u003e1. synchronize from the cache:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( key.creator.shouldValidate() ) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e( key ) {\\n          key.creator.validate( (T)value, reader);\\n        }\\n      }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e2. make each creator responcible for validation.  For example, the DoubleValuesEntryCreator would look like:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n  @Override\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e DoubleValues validate(DoubleValues entry, IndexReader reader) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e ok = \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( hasOption(OPTION_CACHE_VALUES) ) {\\n      ok = \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( entry.values == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e( \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e ) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( entry.values == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n            fillDoubleValues(entry, reader, field);\\n          }\\n        }\\n      }\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( hasOption(OPTION_CACHE_BITS) ) {\\n      ok = \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e;\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( entry.valid == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e( \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e ) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( entry.valid == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e ) {\\n            fillValidBits(entry, reader, field);\\n          }\\n        }\\n      }\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e( !ok ) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003ethrow\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e RuntimeException( \u003cspan class=\\\"code-quote\\\"\u003e\\\"the config must cache values and\\/or bits\\\"\u003c\\/span\u003e );\\n    }\\n    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e entry;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eThat is a bit more complicated, but avoids synchonization when things are valid.  Thoughts?\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eI think it\'s best if whoever gets there first, wins, for this case\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, this is the current behavior &#8211; the validate method does not do anything:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e T validate(T entry, IndexReader reader) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ TODO? nothing? perhaps subsequent call with FASTER_BUT_MORE_RAM?\\n\u003c\\/span\u003e    \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e entry;\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003e- - - - - - -\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe other key behavior that we should note is that with CachedArrayEntryCreators, if you pass a different parser for the same field, it will give you an error.  Previously this created two cache entries (and then added something to the insanity log).  If someone wants to do that, they could override the XxxEntryCreator.getCacheKey() to return key that includes the Parser.  By default this seems like an error to me.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12915039_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915039_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T21:17:05+0000\'\u003e26\\/Sep\\/10 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Mike, I\'ll take a look and fix the small issues later tonight. \\n\\n  I think we should hold off on backport to 3.x until we stabilize   LUCENE-2665  ?  \\n\\n +1, I think it makes sense to backport to 3.x when there is a clear upgrade path.   \\n\\n\\n\\n  I think we have a synchronization issue on the call to validate?  \\n\\n Looks like it.  There are two approaches we could take.   \\n\\n 1. synchronize from the cache: \\n  \\n        if ( key.creator.shouldValidate() ) {\\n         synchronized ( key ) {\\n          key.creator.validate( (T)value, reader);\\n        }\\n      }\\n \\n  \\n\\n 2. make each creator responcible for validation.  For example, the DoubleValuesEntryCreator would look like: \\n  \\n \\n  @Override\\n   public  DoubleValues validate(DoubleValues entry, IndexReader reader)  throws  IOException {\\n     boolean  ok =  false ;\\n     if ( hasOption(OPTION_CACHE_VALUES) ) {\\n      ok =  true ;\\n       if ( entry.values ==  null  ) {\\n         synchronized (  this  ) {\\n           if ( entry.values ==  null  ) {\\n            fillDoubleValues(entry, reader, field);\\n          }\\n        }\\n      }\\n    }\\n     if ( hasOption(OPTION_CACHE_BITS) ) {\\n      ok =  true ;\\n       if ( entry.valid ==  null  ) {\\n         synchronized (  this  ) {\\n           if ( entry.valid ==  null  ) {\\n            fillValidBits(entry, reader, field);\\n          }\\n        }\\n      }\\n    }\\n     if ( !ok ) {\\n       throw   new  RuntimeException(  \\\"the config must cache values and\\/or bits\\\"  );\\n    }\\n     return  entry;\\n  }\\n \\n  \\n That is a bit more complicated, but avoids synchonization when things are valid.  Thoughts? \\n\\n\\n  I think it\'s best if whoever gets there first, wins, for this case  \\n\\n Yes, this is the current behavior &#8211; the validate method does not do anything: \\n  \\n    public  T validate(T entry, IndexReader reader)  throws  IOException {\\n     \\/\\/ TODO? nothing? perhaps subsequent call with FASTER_BUT_MORE_RAM?\\n      return  entry;\\n  }\\n \\n  \\n\\n\\n \\n\\t - - - - - - - \\n \\n\\n\\n The other key behavior that we should note is that with CachedArrayEntryCreators, if you pass a different parser for the same field, it will give you an error.  Previously this created two cache entries (and then added something to the insanity log).  If someone wants to do that, they could override the XxxEntryCreator.getCacheKey() to return key that includes the Parser.  By default this seems like an error to me. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915072\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915072&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915072\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12915072_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915072_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:21:25+0000\'\u003e26\\/Sep\\/10 23:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eif you pass a different parser for the same field, it will give you an error.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf that were true, it would have broken solr in multiple places.  It may not be ideal - but it\'s not an error.\u003cbr\\/\u003e\\nSo I\'m a little confused - why does solr still work fine?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12915072_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915072_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:21:25+0000\'\u003e26\\/Sep\\/10 23:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     if you pass a different parser for the same field, it will give you an error.  \\n\\n If that were true, it would have broken solr in multiple places.  It may not be ideal - but it\'s not an error. \\nSo I\'m a little confused - why does solr still work fine?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915074\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915074&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915074\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12915074_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915074_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:33:45+0000\'\u003e26\\/Sep\\/10 23:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf that were true, it would have broken solr in multiple places\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhat is an example?  The only thing I have seen is stuff that tries one parser and if it throws an exception, tries another (that is supported)\u003c\\/p\u003e\\n\\n\u003cp\u003eAs is, the cached value keeps the hash code for the parser created the values.  If we validate (true by default) then it checks that the passed in hash code matches the one that is stored.  Perhaps different Parsers are returning the same hashCode?    \u003c\\/p\u003e\\n\\n\u003cp\u003eDoes it make sense to create a different key depending on what Parser we use?  Is it normal to interpret the same field multiple different ways?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12915074_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915074_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:33:45+0000\'\u003e26\\/Sep\\/10 23:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If that were true, it would have broken solr in multiple places  \\n\\n What is an example?  The only thing I have seen is stuff that tries one parser and if it throws an exception, tries another (that is supported) \\n\\n As is, the cached value keeps the hash code for the parser created the values.  If we validate (true by default) then it checks that the passed in hash code matches the one that is stored.  Perhaps different Parsers are returning the same hashCode?     \\n\\n Does it make sense to create a different key depending on what Parser we use?  Is it normal to interpret the same field multiple different ways?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915077\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915077&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915077\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12915077_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915077_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:47:14+0000\'\u003e26\\/Sep\\/10 23:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat is an example?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eFacet component, query elevation component, stats component, and sorting.\u003cbr\\/\u003e\\nFor example, if you facet on the popularity field, it will currently use strings - but if you sort on the popularity field, it will ask the FieldCache for ints.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut all of these instances in Solr involve treating the same field as both a string and as a number - perhaps you actually need to ask for numbers, but with different parsers, to trigger the exception?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12915077_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915077_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:47:14+0000\'\u003e26\\/Sep\\/10 23:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What is an example?  \\n\\n Facet component, query elevation component, stats component, and sorting. \\nFor example, if you facet on the popularity field, it will currently use strings - but if you sort on the popularity field, it will ask the FieldCache for ints. \\n\\n But all of these instances in Solr involve treating the same field as both a string and as a number - perhaps you actually need to ask for numbers, but with different parsers, to trigger the exception? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915080\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915080&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915080\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12915080_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915080_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:59:25+0000\'\u003e26\\/Sep\\/10 23:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOk, that makes sense &#8211; what I mean is that you can not ask for the same \u003cb\u003etype\u003c\\/b\u003e with different parsers.  Bytes, vs Strings, vs Ints all have different keys and within the FieldCache, they are even stored in different Maps\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat you can not do is as for a IntValues using: FieldCache.DEFAULT_INT_PARSER, then switch to FieldCache.NUMERIC_UTILS_INT_PARSER for the same field.\u003c\\/p\u003e\\n\\n\u003cp\u003emake sense?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12915080_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915080_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Sep\\/10 23:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-26T23:59:25+0000\'\u003e26\\/Sep\\/10 23:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ok, that makes sense &#8211; what I mean is that you can not ask for the same  type  with different parsers.  Bytes, vs Strings, vs Ints all have different keys and within the FieldCache, they are even stored in different Maps \\n\\n What you can not do is as for a IntValues using: FieldCache.DEFAULT_INT_PARSER, then switch to FieldCache.NUMERIC_UTILS_INT_PARSER for the same field. \\n\\n make sense?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915084\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915084&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915084\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12915084_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915084_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Sep\\/10 00:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-27T00:32:48+0000\'\u003e27\\/Sep\\/10 00:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eOk, that makes sense - what I mean is that you can not ask for the same type with different parsers.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYep, seems fine since people can work around it if they need to.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12915084_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915084_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Sep\\/10 00:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-27T00:32:48+0000\'\u003e27\\/Sep\\/10 00:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Ok, that makes sense - what I mean is that you can not ask for the same type with different parsers.  \\n\\n Yep, seems fine since people can work around it if they need to.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12915106\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12915106&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12915106\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12915106_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915106_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Sep\\/10 03:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-27T03:46:37+0000\'\u003e27\\/Sep\\/10 03:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhat you can not do is as for a IntValues using: FieldCache.DEFAULT_INT_PARSER, then switch to FieldCache.NUMERIC_UTILS_INT_PARSER for the same field.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eJust to note, my previous FieldCache impl did this correctly. When you requested a FieldCache without parser it created the parser=null entry and additionally the real used parser as two separate entries. When you later use directly (instead of automatics) passing in the trie parser, it returns the additionally created entry in the cache. If you request using another parser, it creates a new entry. So i was (theoretically) possible to parse the same field as int or long and additionally as trie or plain number (but the latter throwed of couse some NFE), so not really useful.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12915106_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12915106_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Sep\\/10 03:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-27T03:46:37+0000\'\u003e27\\/Sep\\/10 03:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     What you can not do is as for a IntValues using: FieldCache.DEFAULT_INT_PARSER, then switch to FieldCache.NUMERIC_UTILS_INT_PARSER for the same field.  \\n\\n Just to note, my previous FieldCache impl did this correctly. When you requested a FieldCache without parser it created the parser=null entry and additionally the real used parser as two separate entries. When you later use directly (instead of automatics) passing in the trie parser, it returns the additionally created entry in the cache. If you request using another parser, it creates a new entry. So i was (theoretically) possible to parse the same field as int or long and additionally as trie or plain number (but the latter throwed of couse some NFE), so not really useful.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12932242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12932242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12932242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12932242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 22:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T22:42:41+0000\'\u003e15\\/Nov\\/10 22:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePrompted by Robert\'s pointer to non-thread-safety of parser changing in numeric classes, I did a quick review of IntValuesCreator.  It isn\'t thread safe if you don\'t specify a parser yourself and let it auto-detect, but I\'ll leave that part for another time.\u003c\\/p\u003e\\n\\n\u003cp\u003eI was going to point out that using deletedDocs when enumerating docs is probably a waste, since all readers that only differ by deletedDocs (generated by reopen, etc) will share the same cache entry.  But then I realized that this is perhaps a bug - not just in this issue, but in all FieldCache implementations since we went away from using \\\"reader\\\" as the key?\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eOther stuff we can do:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003euse fastSet (as uwe said)\u003c\\/li\u003e\\n\\t\u003cli\u003euse bulk API\u003c\\/li\u003e\\n\\t\u003cli\u003ewe instantiate vals.values lazily for some reason... and then at the end, if it still hasn\'t been instantiated, we do it anyway?\u003c\\/li\u003e\\n\\t\u003cli\u003eI\'m still trying to grok the logic of calling checkMatchAllBits only if vals.valid == null... seems like it will always return null in that case?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12932242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12932242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Nov\\/10 22:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-15T22:42:41+0000\'\u003e15\\/Nov\\/10 22:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Prompted by Robert\'s pointer to non-thread-safety of parser changing in numeric classes, I did a quick review of IntValuesCreator.  It isn\'t thread safe if you don\'t specify a parser yourself and let it auto-detect, but I\'ll leave that part for another time. \\n\\n I was going to point out that using deletedDocs when enumerating docs is probably a waste, since all readers that only differ by deletedDocs (generated by reopen, etc) will share the same cache entry.  But then I realized that this is perhaps a bug - not just in this issue, but in all FieldCache implementations since we went away from using \\\"reader\\\" as the key? \\n\\n\\n Other stuff we can do: \\n \\n\\t use fastSet (as uwe said) \\n\\t use bulk API \\n\\t we instantiate vals.values lazily for some reason... and then at the end, if it still hasn\'t been instantiated, we do it anyway? \\n\\t I\'m still trying to grok the logic of calling checkMatchAllBits only if vals.valid == null... seems like it will always return null in that case? \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12968451\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12968451&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12968451\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12968451_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12968451_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/10 22:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-06T22:20:55+0000\'\u003e06\\/Dec\\/10 22:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor the sort-missing-last type of functionality, the current comparator code looks like this (see IntComparator for more context):\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e v2 = (checkMissing &amp;&amp; !cached.valid.get(doc)) \\n   ? missingValue : cached.values[doc];\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eAnd I was thinking of changing it to this:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e v2 = cached.values[doc];\\n\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (valid != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e &amp;&amp; v2==0 &amp;&amp; !valid.get(doc))\\n  v2 = missingValue;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThis should make the common case faster by both eliminating an unneeded variable (checkMissing)\u003cbr\\/\u003e\\nand checking that the value is the Java default value before checking the bitset.\u003c\\/p\u003e\\n\\n\u003cp\u003eThoughts?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12968451_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12968451_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/10 22:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-06T22:20:55+0000\'\u003e06\\/Dec\\/10 22:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For the sort-missing-last type of functionality, the current comparator code looks like this (see IntComparator for more context): \\n  \\n  final   int  v2 = (checkMissing &amp;&amp; !cached.valid.get(doc)) \\n   ? missingValue : cached.values[doc];\\n \\n  \\n And I was thinking of changing it to this: \\n  \\n  int  v2 = cached.values[doc];\\n if  (valid !=  null  &amp;&amp; v2==0 &amp;&amp; !valid.get(doc))\\n  v2 = missingValue;\\n \\n  \\n\\n This should make the common case faster by both eliminating an unneeded variable (checkMissing) \\nand checking that the value is the Java default value before checking the bitset. \\n\\n Thoughts?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12968458\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12968458&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12968458\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12968458_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12968458_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/10 22:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-06T22:36:10+0000\'\u003e06\\/Dec\\/10 22:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003elooks good to me\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ewe instantiate vals.values lazily for some reason... and then at the end, if it still hasn\'t been instantiated, we do it anyway?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t know about this, I just copied from the existing code...  \u003c\\/p\u003e\\n\\n\u003cp\u003eWe could make the case where Bits.MatchNoBits( maxDoc ), have a null array.  This would make your proposed change invalid though since it checks the array first.\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m still trying to grok the logic of calling checkMatchAllBits only if vals.valid == null... seems like it will always return null in that case?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe assumption is that once vals.valid is set, it should not be recalculated.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe reasons for the if vals.valie == null in the validate function are:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethe vals.valid Bits may have been set in fillXXValues\u003c\\/li\u003e\\n\\t\u003cli\u003ethe first call may have excluded checkMatchAllBits, and  a subsequet call has it set\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAre you asking about in the validate function?  If so, fillXXXValues can set the vals.valid, so it does not do it again.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_12968458_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12968458_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Dec\\/10 22:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-06T22:36:10+0000\'\u003e06\\/Dec\\/10 22:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    looks good to me \\n\\n  we instantiate vals.values lazily for some reason... and then at the end, if it still hasn\'t been instantiated, we do it anyway?  \\n\\n I don\'t know about this, I just copied from the existing code...   \\n\\n We could make the case where Bits.MatchNoBits( maxDoc ), have a null array.  This would make your proposed change invalid though since it checks the array first. \\n\\n\\n  I\'m still trying to grok the logic of calling checkMatchAllBits only if vals.valid == null... seems like it will always return null in that case?  \\n\\n The assumption is that once vals.valid is set, it should not be recalculated. \\n\\n The reasons for the if vals.valie == null in the validate function are: \\n \\n\\t the vals.valid Bits may have been set in fillXXValues \\n\\t the first call may have excluded checkMatchAllBits, and  a subsequet call has it set \\n \\n\\n\\n Are you asking about in the validate function?  If so, fillXXXValues can set the vals.valid, so it does not do it again.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969364\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12969364&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969364\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12969364_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969364_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T16:29:33+0000\'\u003e08\\/Dec\\/10 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003elooks good to me \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCool - I\'ll work up a patch.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThe assumption is that once vals.valid is set, it should not be recalculated.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOh, tricky.  We should comment that.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd we can then also change this:\u003cbr\\/\u003e\\n     OpenBitSet validBits = (hasOption(OPTION_CACHE_BITS)) ? new OpenBitSet( maxDoc ) : null;\u003cbr\\/\u003e\\nTo this: \u003cbr\\/\u003e\\n    OpenBitSet validBits = (hasOption(OPTION_CACHE_BITS) &amp;&amp; valid.vals==null) ? new OpenBitSet( maxDoc ) : null;\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12969364_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969364_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 16:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T16:29:33+0000\'\u003e08\\/Dec\\/10 16:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     looks good to me   \\n\\n Cool - I\'ll work up a patch. \\n\\n  The assumption is that once vals.valid is set, it should not be recalculated.  \\n\\n Oh, tricky.  We should comment that. \\n\\n And we can then also change this: \\n     OpenBitSet validBits = (hasOption(OPTION_CACHE_BITS)) ? new OpenBitSet( maxDoc ) : null; \\nTo this:  \\n    OpenBitSet validBits = (hasOption(OPTION_CACHE_BITS) &amp;&amp; valid.vals==null) ? new OpenBitSet( maxDoc ) : null;              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12969382\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=12969382&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12969382\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12969382_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969382_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 17:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T17:16:44+0000\'\u003e08\\/Dec\\/10 17:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 08\\/Dec\\/10 19:02\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a draft patch.\u003cbr\\/\u003e\\nedit: move to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2671\\\" title=\\\"Add sort missing first\\/last ability to SortField and ValueComparator\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2671\\\"\u003e\u003cdel\u003eLUCENE-2671\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12969382_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12969382_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Dec\\/10 17:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-08T17:16:44+0000\'\u003e08\\/Dec\\/10 17:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 08\\/Dec\\/10 19:02\\\"\u003eedited\u003c\\/span\u003e                   Here\'s a draft patch. \\nedit: move to   LUCENE-2671                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13011393\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2649?focusedCommentId=13011393&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13011393\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_13011393_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13011393_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Mar\\/11 19:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-25T19:48:13+0000\'\u003e25\\/Mar\\/11 19:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis has been done for a while... any problems should now get their own issue\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ryantxu\\\" id=\\\"commentauthor_13011393_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ryantxu\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ryantxu\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ryan McKinley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13011393_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Mar\\/11 19:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-25T19:48:13+0000\'\u003e25\\/Mar\\/11 19:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This has been done for a while... any problems should now get their own issue              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516203167305"> 
    <input type="hidden" title="jira.request.server.time" value="451"> 
    <input type="hidden" title="jira.request.id" value="932x7706119x16"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="50"> 
    <input type="hidden" title="db.conns.time.in.ms" value="57"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 932x7706119x16
	          REQUEST TIMESTAMP : [17/Jan/2018:15:32:47 +0000]
	               REQUEST TIME : 0.4510
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=32, elapsedTotal=50972852, elapsedMin=482543, elapsedMax=14960186, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=36, elapsedTotal=57090106, elapsedMin=510284, elapsedMax=15034288, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>