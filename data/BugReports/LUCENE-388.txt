<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|672c237dc5064b2a97efc653dc1378d22961c410|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"dab45c007d5c3d\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-388"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-388] [PATCH] IndexWriter.maybeMergeSegments() takes lots of CPU resources - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-388] [PATCH] IndexWriter.maybeMergeSegments() takes lots of CPU resources - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-388">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-388" href="/jira/browse/LUCENE-388" id="key-val" rel="12314538">LUCENE-388</a></li>
                </ol>
                <h1 id="summary-val">[PATCH] IndexWriter.maybeMergeSegments() takes lots of CPU resources</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-388"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-388/LUCENE-388.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-388/LUCENE-388.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-388/LUCENE-388.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-388/LUCENE-388.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+2.1" title="2.1 ">2.1</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12314538-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value"> 
                    <p>Operating System: Mac OS X 10.3<br> Platform: Macintosh</p> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_10010" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bugzilla Id" class="name">Bugzilla Id:</strong> 
                      <div id="customfield_10010-val" class="value type-importid" data-fieldtype="importid" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        34930 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Note: I believe this to be the same situation with 1.4.3 as with SVN HEAD.</p> 
                  <p>Analysis using hprof utility shows that during index creation with many<br> documents highlights that the CPU spends a large portion of it's time in<br> IndexWriter.maybeMergeSegments(), which seems to be a 'waste' compared with<br> other valuable CPU intensive operations such as tokenization etc.</p> 
                  <p>Using the following test snippet to retrieve some rows from the db and create an<br> index:</p> 
                  <p> Analyzer a = new StandardAnalyzer();<br> writer = new IndexWriter(indexDir, a, true);<br> writer.setMergeFactor(1000);<br> writer.setMaxBufferedDocs(10000);<br> writer.setUseCompoundFile(false);<br> connection = DriverManager.getConnection(<br> "jdbc:inetdae7:tower.aconex.com?database=&lt;somedb&gt;", "secret",<br> "squirrel");<br> String sql = "select userid, userfirstname, userlastname, email from userx";<br> LOG.info("sql=" + sql);<br> Statement statement = connection.createStatement();<br> statement.setFetchSize(5000);<br> LOG.info("Executing sql");<br> ResultSet rs = statement.executeQuery(sql);<br> LOG.info("ResultSet retrieved");<br> int row = 0;</p> 
                  <p> LOG.info("Indexing users");<br> long begin = System.currentTimeMillis();<br> while (rs.next()) {<br> int userid = rs.getInt(1);<br> String firstname = rs.getString(2);<br> String lastname = rs.getString(3);<br> String email = rs.getString(4);<br> String fullName = firstname + " " + lastname;<br> Document doc = new Document();<br> doc.add(Field.Keyword("userid", userid+""));<br> doc.add(Field.Keyword("firstname", firstname.toLowerCase()));<br> doc.add(Field.Keyword("lastname", lastname.toLowerCase()));<br> doc.add(Field.Text("name", fullName.toLowerCase()));<br> doc.add(Field.Keyword("email", email.toLowerCase()));<br> writer.addDocument(doc);<br> row++;<br> if((row % 100)==0)</p> { LOG.info(row + " indexed"); } 
                  <p> }<br> double end = System.currentTimeMillis();<br> double diff = (end-begin)/1000;<br> double rate = row/diff;<br> LOG.info("rate:" +rate);</p> 
                  <p>On my 1.5GHz PowerBook with 1.5Gb RAM and a 5400 RPM drive, my CPU is maxed out,<br> and I end up getting a rate of indexing between 490-515 documents/second run<br> over 10 times in succession. </p> 
                  <p>By applying a simple patch to IndexWriter (see attached shortly), which defers<br> the calling of maybeMergeSegments() so that it is only called every 2000<br> times(an arbitrary figure), I appear to get a new rate of between 945-970<br> documents/second. Using Luke to look inside each index created between these 2<br> there does not appear to be any difference. Same number of Documents, same<br> number of Terms.</p> 
                  <p>I'm not suggesting one should apply this patch, I'm just highlighting the<br> difference in performance that this sort of change gives you. </p> 
                  <p>We are about to use Lucene to index 4 million construction document records, and<br> so speeding up the indexing process is in our best interest! <img class="emoticon" src="/jira/images/icons/emoticons/smile.png" height="16" width="16" align="absmiddle" alt="" border="0"> If one<br> considers the amount of CPU time spent in maybeMergeSegments over the initial<br> index creation of 4 million documents, I think one could see how it would be<br> ideal to try to speed this area up (at least move the bottleneck to IO). </p> 
                  <p>I woul appreciate anyone taking a moment to comment on this.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-388?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-388?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-388?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-388?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312619" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312619/ASF.LICENSE.NOT.GRANTED--IndexWriter.patch" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12312619/ASF.LICENSE.NOT.GRANTED--IndexWriter.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312619/ASF.LICENSE.NOT.GRANTED--IndexWriter.patch" title="Latest  16/May/05 16:20 - Paul Smith" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12312619/ASF.LICENSE.NOT.GRANTED--IndexWriter.patch">ASF.LICENSE.NOT.GRANTED--IndexWriter.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-05-16T16:20:26.000Z">16/May/05 16:20</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Paul Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312623" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312623/ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt:https://issues.apache.org/jira/secure/attachment/12312623/ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312623/ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt" title="Latest  24/May/05 16:07 - Paul Smith" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt:https://issues.apache.org/jira/secure/attachment/12312623/ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt">ASF.LICENSE.NOT.GRANTED--log.optimized.deep.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-05-24T16:07:09.000Z">24/May/05 16:07</time>
                   </dd>
                   <dd class="attachment-size">
                    454 kB
                   </dd>
                   <dd class="attachment-author">
                    Paul Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312622" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312622/ASF.LICENSE.NOT.GRANTED--log.optimized.txt" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--log.optimized.txt:https://issues.apache.org/jira/secure/attachment/12312622/ASF.LICENSE.NOT.GRANTED--log.optimized.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312622/ASF.LICENSE.NOT.GRANTED--log.optimized.txt" title="Latest  24/May/05 14:43 - Paul Smith" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--log.optimized.txt:https://issues.apache.org/jira/secure/attachment/12312622/ASF.LICENSE.NOT.GRANTED--log.optimized.txt">ASF.LICENSE.NOT.GRANTED--log.optimized.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-05-24T14:43:05.000Z">24/May/05 14:43</time>
                   </dd>
                   <dd class="attachment-size">
                    183 kB
                   </dd>
                   <dd class="attachment-author">
                    Paul Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312618" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312618/ASF.LICENSE.NOT.GRANTED--log-compound.txt" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--log-compound.txt:https://issues.apache.org/jira/secure/attachment/12312618/ASF.LICENSE.NOT.GRANTED--log-compound.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312618/ASF.LICENSE.NOT.GRANTED--log-compound.txt" title="Latest  16/May/05 16:19 - Paul Smith" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--log-compound.txt:https://issues.apache.org/jira/secure/attachment/12312618/ASF.LICENSE.NOT.GRANTED--log-compound.txt">ASF.LICENSE.NOT.GRANTED--log-compound.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-05-16T16:19:32.000Z">16/May/05 16:19</time>
                   </dd>
                   <dd class="attachment-size">
                    136 kB
                   </dd>
                   <dd class="attachment-author">
                    Paul Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312621" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312621/ASF.LICENSE.NOT.GRANTED--lucene.34930.patch" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--lucene.34930.patch:https://issues.apache.org/jira/secure/attachment/12312621/ASF.LICENSE.NOT.GRANTED--lucene.34930.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312621/ASF.LICENSE.NOT.GRANTED--lucene.34930.patch" title="Latest  24/May/05 12:59 - Paul Smith" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--lucene.34930.patch:https://issues.apache.org/jira/secure/attachment/12312621/ASF.LICENSE.NOT.GRANTED--lucene.34930.patch">ASF.LICENSE.NOT.GRANTED--lucene.34930.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-05-24T12:59:58.000Z">24/May/05 12:59</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Paul Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312620" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312620/ASF.LICENSE.NOT.GRANTED--Lucene%20Performance%20Test%20-%20with%20%26%20without%20hack.xls" draggable="true" data-downloadurl="application/ms-excel:ASF.LICENSE.NOT.GRANTED--Lucene Performance Test - with &amp; without hack.xls:https://issues.apache.org/jira/secure/attachment/12312620/ASF.LICENSE.NOT.GRANTED--Lucene%20Performance%20Test%20-%20with%20%26%20without%20hack.xls"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312620/ASF.LICENSE.NOT.GRANTED--Lucene%20Performance%20Test%20-%20with%20%26%20without%20hack.xls" title="Latest  17/May/05 11:21 - Paul Smith" draggable="true" data-downloadurl="application/ms-excel:ASF.LICENSE.NOT.GRANTED--Lucene Performance Test - with &amp; without hack.xls:https://issues.apache.org/jira/secure/attachment/12312620/ASF.LICENSE.NOT.GRANTED--Lucene%20Performance%20Test%20-%20with%20%26%20without%20hack.xls">ASF.LICENSE.NOT.GRANTED--Lucene Performance Test - with &amp; without hack.xls</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-05-17T11:21:30.000Z">17/May/05 11:21</time>
                   </dd>
                   <dd class="attachment-size">
                    36 kB
                   </dd>
                   <dd class="attachment-author">
                    Paul Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12339078" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12339078/doron_2_IndexWriter.patch" draggable="true" data-downloadurl="text/plain:doron_2_IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12339078/doron_2_IndexWriter.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12339078/doron_2_IndexWriter.patch" title="Latest  18/Aug/06 10:03 - Doron Cohen" draggable="true" data-downloadurl="text/plain:doron_2_IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12339078/doron_2_IndexWriter.patch">doron_2_IndexWriter.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-18T10:03:14.000Z">18/Aug/06 10:03</time>
                   </dd>
                   <dd class="attachment-size">
                    1.0 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12339116" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12339116/doron_2b_IndexWriter.patch" draggable="true" data-downloadurl="text/plain:doron_2b_IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12339116/doron_2b_IndexWriter.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12339116/doron_2b_IndexWriter.patch" title="Latest  18/Aug/06 17:42 - Doron Cohen" draggable="true" data-downloadurl="text/plain:doron_2b_IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12339116/doron_2b_IndexWriter.patch">doron_2b_IndexWriter.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-18T17:42:18.000Z">18/Aug/06 17:42</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12338992" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12338992/doron_IndexWriter.patch" draggable="true" data-downloadurl="text/plain:doron_IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12338992/doron_IndexWriter.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12338992/doron_IndexWriter.patch" title="Latest  16/Aug/06 22:07 - Doron Cohen" draggable="true" data-downloadurl="text/plain:doron_IndexWriter.patch:https://issues.apache.org/jira/secure/attachment/12338992/doron_IndexWriter.patch">doron_IndexWriter.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-16T22:07:04.000Z">16/Aug/06 22:07</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Doron Cohen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12338857" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12338857/yonik_indexwriter.diff" draggable="true" data-downloadurl="application/octet-stream:yonik_indexwriter.diff:https://issues.apache.org/jira/secure/attachment/12338857/yonik_indexwriter.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12338857/yonik_indexwriter.diff" title="Latest  15/Aug/06 05:11 - Yonik Seeley" draggable="true" data-downloadurl="application/octet-stream:yonik_indexwriter.diff:https://issues.apache.org/jira/secure/attachment/12338857/yonik_indexwriter.diff">yonik_indexwriter.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-15T05:11:24.000Z">15/Aug/06 05:11</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12338820" data-issue-id="12314538" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12338820/yonik_indexwriter.diff" draggable="true" data-downloadurl="application/octet-stream:yonik_indexwriter.diff:https://issues.apache.org/jira/secure/attachment/12338820/yonik_indexwriter.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12338820/yonik_indexwriter.diff" title=" 14/Aug/06 16:28 - Yonik Seeley" draggable="true" data-downloadurl="application/octet-stream:yonik_indexwriter.diff:https://issues.apache.org/jira/secure/attachment/12338820/yonik_indexwriter.diff">yonik_indexwriter.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-08-14T16:28:45.000Z">14/Aug/06 16:28</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_yseeley@gmail.com" rel="yseeley@gmail.com" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Yonik Seeley&quot;,&quot;emailAddress&quot;:&quot;yseeley@gmail.com&quot;,&quot;username&quot;:&quot;yseeley@gmail.com&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="yseeley@gmail.com"></span></span> Yonik Seeley </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_psmith@apache.org" rel="psmith@apache.org" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Paul Smith&quot;,&quot;emailAddress&quot;:&quot;tallpsmith@gmail.com&quot;,&quot;username&quot;:&quot;psmith@apache.org&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="psmith@apache.org"></span></span> Paul Smith </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">2</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">3</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="16/May/05 16:18"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2005-05-16T16:18:21+0000">16/May/05 16:18</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:44"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:44:20+0000">10/May/13 10:44</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="17/Aug/06 02:54"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2006-08-17T02:54:42+0000">17/Aug/06 02:54</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-388?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-388?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12322373\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322373&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322373\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322373_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322373_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/05 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-16T16:19:32+0000\'\u003e16\\/May\\/05 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15042)\u003cbr\\/\u003e\\nHPROF log of test run pre-patch\u003c\\/p\u003e\\n\\n\u003cp\u003eAdded HPROF log showing high CPU usage inside IndexWriter.maybeMergeSegments()\u003cbr\\/\u003e\\nmethod\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322373_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322373_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/05 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-16T16:19:32+0000\'\u003e16\\/May\\/05 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15042) \\nHPROF log of test run pre-patch \\n\\n Added HPROF log showing high CPU usage inside IndexWriter.maybeMergeSegments() \\nmethod              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322374\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322374&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322374\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322374_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322374_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/05 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-16T16:20:26+0000\'\u003e16\\/May\\/05 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15043)\u003cbr\\/\u003e\\nDemonstration Patch to defer the call to IndexWriter.maybeMergeSegments() for\u003cbr\\/\u003e\\nevery 2000 times.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322374_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322374_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/05 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-16T16:20:26+0000\'\u003e16\\/May\\/05 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15043) \\nDemonstration Patch to defer the call to IndexWriter.maybeMergeSegments() for \\nevery 2000 times.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322375\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322375&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322375\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"daniel.naber@t-online.de\\\" id=\\\"commentauthor_12322375_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=daniel.naber%40t-online.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"daniel.naber@t-online.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322375_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/05 19:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-16T19:22:41+0000\'\u003e16\\/May\\/05 19:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIsn\'t the effect the same as setting mergeFactor to 2000, i.e. indexing gets  \u003cbr\\/\u003e\\nfaster but more RAM is needed?  \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"daniel.naber@t-online.de\\\" id=\\\"commentauthor_12322375_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=daniel.naber%40t-online.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"daniel.naber@t-online.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322375_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/05 19:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-16T19:22:41+0000\'\u003e16\\/May\\/05 19:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Isn\'t the effect the same as setting mergeFactor to 2000, i.e. indexing gets   \\nfaster but more RAM is needed?   \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322376\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322376&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322376\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12322376_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322376_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 01:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T01:11:27+0000\'\u003e17\\/May\\/05 01:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e(In reply to comment #3)\u003cbr\\/\u003e\\n&gt; Isn\'t the effect the same as setting mergeFactor to 2000, i.e. indexing gets  \u003cbr\\/\u003e\\n&gt; faster but more RAM is needed?  \u003c\\/p\u003e\\n\\n\u003cp\u003eOn every add, it looks like the entire segment list is walked looking to see of\u003cbr\\/\u003e\\nenough docs (minMergeDocs) can be collected together to do a merge.  With a\u003cbr\\/\u003e\\nlarge minMergeDocs, this can get expensive.  Perhaps a count should be kept of\u003cbr\\/\u003e\\nthe number of docs in memory, and when it exceeds minMergeDocs, then call the\u003cbr\\/\u003e\\nmerge logic.\u003c\\/p\u003e\\n\\n\u003cp\u003eOf course keeping track of the count would require modifications to many\u003cbr\\/\u003e\\nIndexWriter methods. It looks like the performance gains may well be worth it\u003cbr\\/\u003e\\nthough.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, I don\'t think a mergefactor of 1000 is typical (way too many\u003cbr\\/\u003e\\nfiledescriptors in use, and a big hit to searchers).  A high minMergeDocs (now\u003cbr\\/\u003e\\nmaxBufferedDocs) \u003cb\u003eis\u003c\\/b\u003e typical and useful though.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12322376_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322376_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 01:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T01:11:27+0000\'\u003e17\\/May\\/05 01:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    (In reply to comment #3) \\n&gt; Isn\'t the effect the same as setting mergeFactor to 2000, i.e. indexing gets   \\n&gt; faster but more RAM is needed?   \\n\\n On every add, it looks like the entire segment list is walked looking to see of \\nenough docs (minMergeDocs) can be collected together to do a merge.  With a \\nlarge minMergeDocs, this can get expensive.  Perhaps a count should be kept of \\nthe number of docs in memory, and when it exceeds minMergeDocs, then call the \\nmerge logic. \\n\\n Of course keeping track of the count would require modifications to many \\nIndexWriter methods. It looks like the performance gains may well be worth it \\nthough. \\n\\n BTW, I don\'t think a mergefactor of 1000 is typical (way too many \\nfiledescriptors in use, and a big hit to searchers).  A high minMergeDocs (now \\nmaxBufferedDocs)  is  typical and useful though. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322377\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322377&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322377\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003cspan class=\\\"user-hover user-avatar\\\" rel=\\\"cutting@apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10453\\\" alt=\\\"cutting@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e cutting@apache.org\u003c\\/span\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322377_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 02:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T02:17:00+0000\'\u003e17\\/May\\/05 02:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYour benchmark might run faster if you set maxBufferedDocs smaller.  Also, it\u003cbr\\/\u003e\\ndoesn\'t look like you\'re including the cost of closing the IndexWriter in your\u003cbr\\/\u003e\\nbenchmark statistics.  You should, as, with such a large buffer, you\'ve delayed\u003cbr\\/\u003e\\nmuch of the work to that point.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe bottleneck you\'re hitting is that maybeMergeDocs sums the size of the\u003cbr\\/\u003e\\nbuffered indexes each time to decide whether to merge.  When you have thousands\u003cbr\\/\u003e\\nbuffered, this dominates.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo optimize this case (small docs, large maxBufferedDocs) we could keep count of\u003cbr\\/\u003e\\nthe number of documents buffered by adding a bufferedDocCount field. \u003cbr\\/\u003e\\naddDocument could increment this, mergeSegments could decrement it, and\u003cbr\\/\u003e\\nmaybeMergeSegments could check it with something like:\u003c\\/p\u003e\\n\\n\u003cp\u003eif (targetMergeDocs == minMergeDocs)  {\u003cbr\\/\u003e\\n  mergeDocs = bufferedDocCount;\u003cbr\\/\u003e\\n} else {\u003cbr\\/\u003e\\n  while (--minSegment &gt;= 0) \u003c\\/p\u003e\\n{\\n  ...\\n  }\\n\u003cp\u003e}\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes that make sense?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003cspan class=\\\"user-hover user-avatar\\\" rel=\\\"cutting@apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10453\\\" alt=\\\"cutting@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e cutting@apache.org\u003c\\/span\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322377_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 02:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T02:17:00+0000\'\u003e17\\/May\\/05 02:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Your benchmark might run faster if you set maxBufferedDocs smaller.  Also, it \\ndoesn\'t look like you\'re including the cost of closing the IndexWriter in your \\nbenchmark statistics.  You should, as, with such a large buffer, you\'ve delayed \\nmuch of the work to that point. \\n\\n The bottleneck you\'re hitting is that maybeMergeDocs sums the size of the \\nbuffered indexes each time to decide whether to merge.  When you have thousands \\nbuffered, this dominates. \\n\\n To optimize this case (small docs, large maxBufferedDocs) we could keep count of \\nthe number of documents buffered by adding a bufferedDocCount field.  \\naddDocument could increment this, mergeSegments could decrement it, and \\nmaybeMergeSegments could check it with something like: \\n\\n if (targetMergeDocs == minMergeDocs)  { \\n  mergeDocs = bufferedDocCount; \\n} else { \\n  while (--minSegment &gt;= 0)  \\n{\\n  ...\\n  }\\n } \\n\\n Does that make sense?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322378\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322378&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322378\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322378_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322378_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 07:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T07:53:10+0000\'\u003e17\\/May\\/05 07:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt;&gt; Your benchmark might run faster if you set maxBufferedDocs smaller.  Also, it\u003cbr\\/\u003e\\n&gt;&gt; doesn\'t look like you\'re including the cost of closing the IndexWriter in your\u003cbr\\/\u003e\\n&gt;&gt; benchmark statistics.  You should, as, with such a large buffer, you\'ve delayed\u003cbr\\/\u003e\\n&gt;&gt; much of the work to that point.\u003cbr\\/\u003e\\n&gt;&gt; \u003c\\/p\u003e\\n\\n\u003cp\u003eYes, by not factoring in the optmize()\\/close() call into the rate calculation,\u003cbr\\/\u003e\\nthere is still \'work to be done\' at the end, but that would only be the tail end\u003cbr\\/\u003e\\nof the remaining docs stored in memory, right?  When indexing millions of\u003cbr\\/\u003e\\nrecords, this is probably not going to be a large percentage of the overall\u003cbr\\/\u003e\\ntime, as it would only, at most, the last maxBufferedDocs to be tidied up.  Or\u003cbr\\/\u003e\\nhave I confused myself?  I\'m still quite new to Lucene and it\'s inner workings.  \u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; The bottleneck you\'re hitting is that maybeMergeDocs sums the size of the\u003cbr\\/\u003e\\n&gt;&gt; buffered indexes each time to decide whether to merge.  When you have thousands\u003cbr\\/\u003e\\n&gt;&gt; buffered, this dominates.\u003c\\/p\u003e\\n\\n\u003cp\u003eYes, when maxBufferedDocs is relatively high (which is useful, I thought, if you\u003cbr\\/\u003e\\nhave the memory to throw at the application and one is trying to stay off IO as\u003cbr\\/\u003e\\nmuch as possible, that\'s what I\'ve understood anyway) the loop ends up something\u003cbr\\/\u003e\\nlike this, where N is maxBufferedDocs\u003c\\/p\u003e\\n\\n\u003cp\u003en + (n-1)+(n-2) + ....(n-n)\u003c\\/p\u003e\\n\\n\u003cp\u003e(I\'m no math wiz, sorry)\u003cbr\\/\u003e\\nYou can notice this when indexing and outputing logging information, you see the\u003cbr\\/\u003e\\n\'rate\' slow down slightly as the number of docs is added to the in memory\u003cbr\\/\u003e\\nbuffer, then once the automatic merge is performed, the rate speeds up, then\u003cbr\\/\u003e\\nprogressively slows down again.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; \u003cbr\\/\u003e\\n&gt;&gt; To optimize this case (small docs, large maxBufferedDocs) we could keep count of\u003cbr\\/\u003e\\n&gt;&gt; the number of documents buffered by adding a bufferedDocCount field. \u003cbr\\/\u003e\\n&gt;&gt; addDocument could increment this, mergeSegments could decrement it, and\u003cbr\\/\u003e\\n&gt;&gt; maybeMergeSegments could check it with something like:\u003cbr\\/\u003e\\n&gt;&gt; \u003cbr\\/\u003e\\n&gt;&gt; if (targetMergeDocs == minMergeDocs)  \u003c\\/p\u003e\\n{\\n&gt;&gt;   mergeDocs = bufferedDocCount;\\n&gt;&gt; }\\n\u003cp\u003e else {\u003cbr\\/\u003e\\n&gt;&gt;   while (--minSegment &gt;= 0) \u003c\\/p\u003e\\n{\\n&gt;&gt;   ...\\n&gt;&gt;   }\\n\u003cp\u003e&gt;&gt; }\u003cbr\\/\u003e\\n&gt;&gt; \u003cbr\\/\u003e\\n&gt;&gt; Does that make sense?\u003c\\/p\u003e\\n\\n\u003cp\u003eErr, to be honest I\'m not quite sure what you mean by \\\"small docs\\\" in the above\u003cbr\\/\u003e\\nfirst statement.  I\'m also a little confused on the:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt; if (targetMergeDocs == minMergeDocs)  {\u003c\\/p\u003e\\n\\n\u003cp\u003eand how it relates to the bufferedDocCount you mention.  \u003c\\/p\u003e\\n\\n\u003cp\u003eIn my hack\\/patch I\'m effectively keeping track of the number of documents added\u003cbr\\/\u003e\\nas you suggest, so I believe we\'re pretty close to the same thing, but I blame\u003cbr\\/\u003e\\nonly having one coffee on trying to understand it.  \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  I think I like where you\u003cbr\\/\u003e\\ngoing though, it smells right.\u003c\\/p\u003e\\n\\n\u003cp\u003eSomething I thought about last night is that the current code works fine for all\u003cbr\\/\u003e\\ncases, however the \'clean index being rebuilt\' seems to get the raw end of the\u003cbr\\/\u003e\\nstick.  When an index is being incrementally or batch updated, IndexWriter\u003cbr\\/\u003e\\nprobably does need to scan the Segments to see if they need merging to obey the\u003cbr\\/\u003e\\nconfiguration settings.  However a fresh index is a special case, and seems like\u003cbr\\/\u003e\\nit could be optimized (this may be what you meant by \'small docs\' ?).  \u003c\\/p\u003e\\n\\n\u003cp\u003eIn really large scale indexes\\/indices\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/help_16.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e the number of documents being\u003cbr\\/\u003e\\nincrementally\\/batch updated is going to be totally minor compared to the cost of\u003cbr\\/\u003e\\nbuilding the full index for the first time.  For a true High Availability\u003cbr\\/\u003e\\nsolution, one will always need to factor in the cost to rebuild the index from\u003cbr\\/\u003e\\nscratch should it come to that.  Making the initial index as fast as possible\u003cbr\\/\u003e\\ngives much smaller down time.  \u003c\\/p\u003e\\n\\n\u003cp\u003eFor crawling applications that use Lucene, this optimization will probably not\u003cbr\\/\u003e\\neven get noticed, because of the latency in retrieving the source material to\u003cbr\\/\u003e\\nmake up the document.  Only when the source material can be accessed fast will\u003cbr\\/\u003e\\nthis optimization be important.\u003c\\/p\u003e\\n\\n\u003cp\u003eRemoving this CPU bottleneck has even more benefits when you consider those\u003cbr\\/\u003e\\nsolutions using Lucene to parallel index documents.  This optimization means\u003cbr\\/\u003e\\nthat you get a multiplication of benefit the more CPU\'s being utilized,\u003cbr\\/\u003e\\nparticularly if the architecture is a producer\\/consumer operation with a Buffer\u003cbr\\/\u003e\\nin between. (obviously IO starts to get in the way more).  With an optimization\u003cbr\\/\u003e\\nthe CPU can be better utilized performing tokenization etc.\u003c\\/p\u003e\\n\\n\u003cp\u003echeers,\u003c\\/p\u003e\\n\\n\u003cp\u003ePaul\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322378_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322378_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 07:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T07:53:10+0000\'\u003e17\\/May\\/05 07:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;&gt; Your benchmark might run faster if you set maxBufferedDocs smaller.  Also, it \\n&gt;&gt; doesn\'t look like you\'re including the cost of closing the IndexWriter in your \\n&gt;&gt; benchmark statistics.  You should, as, with such a large buffer, you\'ve delayed \\n&gt;&gt; much of the work to that point. \\n&gt;&gt;  \\n\\n Yes, by not factoring in the optmize()\\/close() call into the rate calculation, \\nthere is still \'work to be done\' at the end, but that would only be the tail end \\nof the remaining docs stored in memory, right?  When indexing millions of \\nrecords, this is probably not going to be a large percentage of the overall \\ntime, as it would only, at most, the last maxBufferedDocs to be tidied up.  Or \\nhave I confused myself?  I\'m still quite new to Lucene and it\'s inner workings.   \\n\\n &gt;&gt; The bottleneck you\'re hitting is that maybeMergeDocs sums the size of the \\n&gt;&gt; buffered indexes each time to decide whether to merge.  When you have thousands \\n&gt;&gt; buffered, this dominates. \\n\\n Yes, when maxBufferedDocs is relatively high (which is useful, I thought, if you \\nhave the memory to throw at the application and one is trying to stay off IO as \\nmuch as possible, that\'s what I\'ve understood anyway) the loop ends up something \\nlike this, where N is maxBufferedDocs \\n\\n n + (n-1)+(n-2) + ....(n-n) \\n\\n (I\'m no math wiz, sorry) \\nYou can notice this when indexing and outputing logging information, you see the \\n\'rate\' slow down slightly as the number of docs is added to the in memory \\nbuffer, then once the automatic merge is performed, the rate speeds up, then \\nprogressively slows down again. \\n\\n &gt;&gt;  \\n&gt;&gt; To optimize this case (small docs, large maxBufferedDocs) we could keep count of \\n&gt;&gt; the number of documents buffered by adding a bufferedDocCount field.  \\n&gt;&gt; addDocument could increment this, mergeSegments could decrement it, and \\n&gt;&gt; maybeMergeSegments could check it with something like: \\n&gt;&gt;  \\n&gt;&gt; if (targetMergeDocs == minMergeDocs)   \\n{\\n&gt;&gt;   mergeDocs = bufferedDocCount;\\n&gt;&gt; }\\n  else { \\n&gt;&gt;   while (--minSegment &gt;= 0)  \\n{\\n&gt;&gt;   ...\\n&gt;&gt;   }\\n &gt;&gt; } \\n&gt;&gt;  \\n&gt;&gt; Does that make sense? \\n\\n Err, to be honest I\'m not quite sure what you mean by \\\"small docs\\\" in the above \\nfirst statement.  I\'m also a little confused on the: \\n\\n &gt;&gt; if (targetMergeDocs == minMergeDocs)  { \\n\\n and how it relates to the bufferedDocCount you mention.   \\n\\n In my hack\\/patch I\'m effectively keeping track of the number of documents added \\nas you suggest, so I believe we\'re pretty close to the same thing, but I blame \\nonly having one coffee on trying to understand it.     I think I like where you \\ngoing though, it smells right. \\n\\n Something I thought about last night is that the current code works fine for all \\ncases, however the \'clean index being rebuilt\' seems to get the raw end of the \\nstick.  When an index is being incrementally or batch updated, IndexWriter \\nprobably does need to scan the Segments to see if they need merging to obey the \\nconfiguration settings.  However a fresh index is a special case, and seems like \\nit could be optimized (this may be what you meant by \'small docs\' ?).   \\n\\n In really large scale indexes\\/indices  the number of documents being \\nincrementally\\/batch updated is going to be totally minor compared to the cost of \\nbuilding the full index for the first time.  For a true High Availability \\nsolution, one will always need to factor in the cost to rebuild the index from \\nscratch should it come to that.  Making the initial index as fast as possible \\ngives much smaller down time.   \\n\\n For crawling applications that use Lucene, this optimization will probably not \\neven get noticed, because of the latency in retrieving the source material to \\nmake up the document.  Only when the source material can be accessed fast will \\nthis optimization be important. \\n\\n Removing this CPU bottleneck has even more benefits when you consider those \\nsolutions using Lucene to parallel index documents.  This optimization means \\nthat you get a multiplication of benefit the more CPU\'s being utilized, \\nparticularly if the architecture is a producer\\/consumer operation with a Buffer \\nin between. (obviously IO starts to get in the way more).  With an optimization \\nthe CPU can be better utilized performing tokenization etc. \\n\\n cheers, \\n\\n Paul              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322379\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322379&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322379\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322379_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322379_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 11:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T11:19:56+0000\'\u003e17\\/May\\/05 11:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDoug, after more testing, you are correct that tweaking the maxBuffered from\u003cbr\\/\u003e\\n10,000 to 5000 gives slightly better performance.\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever I believe this is because with maxBufferedDocs==5000, this loop counter\u003cbr\\/\u003e\\nis reset more frequently, and so suffers less of the CPU drain.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI ran more tests using the hacked version using both 5000 and 10000, and the\u003cbr\\/\u003e\\nhacked version still runs better.  I\'ll attach an Excel sheet with the results,\u003cbr\\/\u003e\\nbut I only had time to run it over 5 samples each run, which is not exactly\u003cbr\\/\u003e\\nstatistically significant, but hopefully still correct.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs you can see, deferring this loop enables larger maxBuffered to gain ahead of\u003cbr\\/\u003e\\nsmaller maxBufferedDocs.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs always with these tests there are transient factors that affect things\u003cbr\\/\u003e\\n(getting DB results for one thing).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322379_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322379_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 11:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T11:19:56+0000\'\u003e17\\/May\\/05 11:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Doug, after more testing, you are correct that tweaking the maxBuffered from \\n10,000 to 5000 gives slightly better performance. \\n\\n However I believe this is because with maxBufferedDocs==5000, this loop counter \\nis reset more frequently, and so suffers less of the CPU drain.   \\n\\n I ran more tests using the hacked version using both 5000 and 10000, and the \\nhacked version still runs better.  I\'ll attach an Excel sheet with the results, \\nbut I only had time to run it over 5 samples each run, which is not exactly \\nstatistically significant, but hopefully still correct. \\n\\n As you can see, deferring this loop enables larger maxBuffered to gain ahead of \\nsmaller maxBufferedDocs. \\n\\n As always with these tests there are transient factors that affect things \\n(getting DB results for one thing).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322380\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322380&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322380\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322380_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322380_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 11:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T11:21:30+0000\'\u003e17\\/May\\/05 11:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15053)\u003cbr\\/\u003e\\nExcel file containg results over small samples between Hacked and Non-hacked\u003cbr\\/\u003e\\ncode using different maxBufferedDocs settings\u003c\\/p\u003e\\n\\n\u003cp\u003eAttached Excel file with some results\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322380_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322380_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/May\\/05 11:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-17T11:21:30+0000\'\u003e17\\/May\\/05 11:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15053) \\nExcel file containg results over small samples between Hacked and Non-hacked \\ncode using different maxBufferedDocs settings \\n\\n Attached Excel file with some results              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322381\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322381&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322381\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322381_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322381_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T12:59:58+0000\'\u003e24\\/May\\/05 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15137)\u003cbr\\/\u003e\\nPatch that hopefully is what Doug means\u003c\\/p\u003e\\n\\n\u003cp\u003eDoug,\u003c\\/p\u003e\\n\\n\u003cp\u003eI could not resolve in my mind exactly what you meant in your example code\u003cbr\\/\u003e\\nsnippet, but here\'s a patch that I believe accomplishes the same thing.  It\'s\u003cbr\\/\u003e\\nmerely a renaming of the variable, and using the \'mergeSegement decrements\'\u003cbr\\/\u003e\\nconcept that you mention which I think is a good idea.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch still doesn\'t speed up the actual detecting of what segments on the\u003cbr\\/\u003e\\nstack to merge when it does go into that loop.\\tI need to re-baseline the\u003cbr\\/\u003e\\nperformance measurements with this patch to see where the CPU is now spending\u003cbr\\/\u003e\\nmost of it\'s time, as it it may now be somewhere else entirely.\u003c\\/p\u003e\\n\\n\u003cp\u003eNOTE: all current unit tests still pass with this patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322381_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322381_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 12:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T12:59:58+0000\'\u003e24\\/May\\/05 12:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15137) \\nPatch that hopefully is what Doug means \\n\\n Doug, \\n\\n I could not resolve in my mind exactly what you meant in your example code \\nsnippet, but here\'s a patch that I believe accomplishes the same thing.  It\'s \\nmerely a renaming of the variable, and using the \'mergeSegement decrements\' \\nconcept that you mention which I think is a good idea. \\n\\n This patch still doesn\'t speed up the actual detecting of what segments on the \\nstack to merge when it does go into that loop.\\tI need to re-baseline the \\nperformance measurements with this patch to see where the CPU is now spending \\nmost of it\'s time, as it it may now be somewhere else entirely. \\n\\n NOTE: all current unit tests still pass with this patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322382\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322382&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322382\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322382_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322382_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 14:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T14:43:05+0000\'\u003e24\\/May\\/05 14:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15139)\u003cbr\\/\u003e\\nHPROF output of the same test with the patch applied\u003c\\/p\u003e\\n\\n\u003cp\u003eThis HPROF shows the CPU savings of the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn summary, the original was this:\u003c\\/p\u003e\\n\\n\u003cp\u003e   1 24.14% 24.14%     859 300342\u003cbr\\/\u003e\\norg.apache.lucene.index.IndexWriter.maybeMergeSegments\u003cbr\\/\u003e\\n   2  4.83% 28.97%     172 300306 java.lang.Throwable.fillInStackTrace\u003cbr\\/\u003e\\n   3  4.07% 33.04%     145 300336 org.apache.lucene.index.SegmentInfos.info\u003cbr\\/\u003e\\n   4  2.50% 35.54%\\t89 300505\u003cbr\\/\u003e\\norg.apache.lucene.store.RAMInputStream.readInternal\u003cbr\\/\u003e\\n   5  2.33% 37.88%\\t83 300299 java.util.Vector.addElement\u003cbr\\/\u003e\\n   6  2.16% 40.04%\\t77 300334 org.apache.lucene.document.Field.readerValue\u003cbr\\/\u003e\\n   7  2.14% 42.17%\\t76 300272 java.net.SocketInputStream.socketRead0\u003cbr\\/\u003e\\n   8  1.40% 43.58%\\t50 300598 org.apache.lucene.util.PriorityQueue.downHeap\u003c\\/p\u003e\\n\\n\u003cp\u003e   9  1.15% 44.73%\\t41 300617 org.apache.lucene.util.PriorityQueue.downHeap\u003c\\/p\u003e\\n\\n\u003cp\u003e  10  1.01% 45.74%\\t36 300581 java.io.RandomAccessFile.writeBytes\u003cbr\\/\u003e\\n.....\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd after the patch is applied it becomes:\u003c\\/p\u003e\\n\\n\u003cp\u003e   1  5.45%  5.45%     130 300287 java.lang.Throwable.fillInStackTrace\u003cbr\\/\u003e\\n   2  5.20% 10.65%     124 300277 java.net.SocketInputStream.socketRead0\u003cbr\\/\u003e\\n   3  3.86% 14.51%\\t92 300515\u003cbr\\/\u003e\\norg.apache.lucene.store.RAMInputStream.readInternal\u003cbr\\/\u003e\\n   4  3.27% 17.79%\\t78 300332 java.util.Vector.addElement\u003cbr\\/\u003e\\n   5  2.35% 20.13%\\t56 300548 java.io.RandomAccessFile.writeBytes\u003cbr\\/\u003e\\n   6  2.22% 22.36%\\t53 300305 org.apache.lucene.document.Field.readerValue\u003cbr\\/\u003e\\n   7  1.85% 24.20%\\t44 300595 org.apache.lucene.util.PriorityQueue.downHeap\u003c\\/p\u003e\\n\\n\u003cp\u003e   8  1.72% 25.92%\\t41 300580 org.apache.lucene.util.PriorityQueue.downHeap\u003c\\/p\u003e\\n\\n\u003cp\u003e   9  1.51% 27.43%\\t36 300645 java.net.SocketInputStream.socketRead0\u003cbr\\/\u003e\\n  10  1.43% 28.86%\\t34 300284\u003cbr\\/\u003e\\norg.apache.lucene.store.BufferedIndexOutput.&lt;init&gt;\u003cbr\\/\u003e\\n  11  1.43% 30.29%\\t34 300562 java.lang.Object.clone\u003cbr\\/\u003e\\n  12  1.17% 31.46%\\t28 300346 java.io.StringReader.read\u003cbr\\/\u003e\\n  13  1.01% 32.47%\\t24 300363\u003cbr\\/\u003e\\norg.apache.lucene.index.DocumentWriter.writeNorms\u003c\\/p\u003e\\n\\n\u003cp\u003e(Note: The Socket reading element is the JDBC driver retrieving the results).\u003c\\/p\u003e\\n\\n\u003cp\u003echeers,\u003c\\/p\u003e\\n\\n\u003cp\u003ePaul\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322382_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322382_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 14:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T14:43:05+0000\'\u003e24\\/May\\/05 14:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15139) \\nHPROF output of the same test with the patch applied \\n\\n This HPROF shows the CPU savings of the patch. \\n\\n In summary, the original was this: \\n\\n    1 24.14% 24.14%     859 300342 \\norg.apache.lucene.index.IndexWriter.maybeMergeSegments \\n   2  4.83% 28.97%     172 300306 java.lang.Throwable.fillInStackTrace \\n   3  4.07% 33.04%     145 300336 org.apache.lucene.index.SegmentInfos.info \\n   4  2.50% 35.54%\\t89 300505 \\norg.apache.lucene.store.RAMInputStream.readInternal \\n   5  2.33% 37.88%\\t83 300299 java.util.Vector.addElement \\n   6  2.16% 40.04%\\t77 300334 org.apache.lucene.document.Field.readerValue \\n   7  2.14% 42.17%\\t76 300272 java.net.SocketInputStream.socketRead0 \\n   8  1.40% 43.58%\\t50 300598 org.apache.lucene.util.PriorityQueue.downHeap \\n\\n    9  1.15% 44.73%\\t41 300617 org.apache.lucene.util.PriorityQueue.downHeap \\n\\n   10  1.01% 45.74%\\t36 300581 java.io.RandomAccessFile.writeBytes \\n..... \\n\\n And after the patch is applied it becomes: \\n\\n    1  5.45%  5.45%     130 300287 java.lang.Throwable.fillInStackTrace \\n   2  5.20% 10.65%     124 300277 java.net.SocketInputStream.socketRead0 \\n   3  3.86% 14.51%\\t92 300515 \\norg.apache.lucene.store.RAMInputStream.readInternal \\n   4  3.27% 17.79%\\t78 300332 java.util.Vector.addElement \\n   5  2.35% 20.13%\\t56 300548 java.io.RandomAccessFile.writeBytes \\n   6  2.22% 22.36%\\t53 300305 org.apache.lucene.document.Field.readerValue \\n   7  1.85% 24.20%\\t44 300595 org.apache.lucene.util.PriorityQueue.downHeap \\n\\n    8  1.72% 25.92%\\t41 300580 org.apache.lucene.util.PriorityQueue.downHeap \\n\\n    9  1.51% 27.43%\\t36 300645 java.net.SocketInputStream.socketRead0 \\n  10  1.43% 28.86%\\t34 300284 \\norg.apache.lucene.store.BufferedIndexOutput.&lt;init&gt; \\n  11  1.43% 30.29%\\t34 300562 java.lang.Object.clone \\n  12  1.17% 31.46%\\t28 300346 java.io.StringReader.read \\n  13  1.01% 32.47%\\t24 300363 \\norg.apache.lucene.index.DocumentWriter.writeNorms \\n\\n (Note: The Socket reading element is the JDBC driver retrieving the results). \\n\\n cheers, \\n\\n Paul              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322383\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322383&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322383\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mario@ops.co.at\\\" id=\\\"commentauthor_12322383_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mario%40ops.co.at\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mario@ops.co.at\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mario Ivankovits\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322383_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T14:54:53+0000\'\u003e24\\/May\\/05 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhere do the java.lang.Throwable.fillInStackTrace come from?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mario@ops.co.at\\\" id=\\\"commentauthor_12322383_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mario%40ops.co.at\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mario@ops.co.at\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mario Ivankovits\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322383_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T14:54:53+0000\'\u003e24\\/May\\/05 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Where do the java.lang.Throwable.fillInStackTrace come from?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322384\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322384&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322384\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"whoschek@lbl.gov\\\" id=\\\"commentauthor_12322384_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=whoschek%40lbl.gov\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"whoschek@lbl.gov\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e hoschek\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322384_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 15:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T15:14:23+0000\'\u003e24\\/May\\/05 15:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMost likely the IOExceptions stem from FastCharStream of StandardAnalyzer, at least that\'s my experience. \u003cbr\\/\u003e\\nSee the header of your hprof file to check if that\'s the case.\u003c\\/p\u003e\\n\\n\u003cp\u003eJavacc has a gotcha in that it \\\"likes\\\" IOExceptions as part of the normal control flow on stream termination.\u003cbr\\/\u003e\\nI have performance patches for this that make FastCharStream 2-10 times faster for small inputs (it \u003cbr\\/\u003e\\ndoesn\'t matter on large inputs), but I never bothered submitted them since they were not crucial for me, \u003cbr\\/\u003e\\nand seeing that most submissions to lucene-dev go into a black hole anyway without any response, \u003cbr\\/\u003e\\nneither negative or positive, simply ignored... Hint \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"whoschek@lbl.gov\\\" id=\\\"commentauthor_12322384_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=whoschek%40lbl.gov\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"whoschek@lbl.gov\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e hoschek\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322384_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 15:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T15:14:23+0000\'\u003e24\\/May\\/05 15:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Most likely the IOExceptions stem from FastCharStream of StandardAnalyzer, at least that\'s my experience.  \\nSee the header of your hprof file to check if that\'s the case. \\n\\n Javacc has a gotcha in that it \\\"likes\\\" IOExceptions as part of the normal control flow on stream termination. \\nI have performance patches for this that make FastCharStream 2-10 times faster for small inputs (it  \\ndoesn\'t matter on large inputs), but I never bothered submitted them since they were not crucial for me,  \\nand seeing that most submissions to lucene-dev go into a black hole anyway without any response,  \\nneither negative or positive, simply ignored... Hint                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322385\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322385&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322385\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322385_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322385_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T16:02:50+0000\'\u003e24\\/May\\/05 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI expanded the depth of the HPFOF test (will attach shortly) but in summary,\u003cbr\\/\u003e\\nthis is where it comes from:\u003c\\/p\u003e\\n\\n\u003cp\u003eTRACE 300351:\u003cbr\\/\u003e\\n        java.lang.Throwable.fillInStackTrace(Throwable.java:Unknown line)\u003cbr\\/\u003e\\n        java.lang.Throwable.&lt;init&gt;(Throwable.java:196)\u003cbr\\/\u003e\\n        java.lang.Exception.&lt;init&gt;(Exception.java:41)\u003cbr\\/\u003e\\n        java.lang.RuntimeException.&lt;init&gt;(RuntimeException.java:43)\u003cbr\\/\u003e\\n        java.lang.ClassCastException.&lt;init&gt;(ClassCastException.java:39)\u003cbr\\/\u003e\\n        org.apache.lucene.document.Field.readerValue(Field.java:262)\u003c\\/p\u003e\\n\\n\u003cp\u003eorg.apache.lucene.index.DocumentWriter.invertDocument(DocumentWriter.java:152)\u003cbr\\/\u003e\\n        org.apache.lucene.index.DocumentWriter.addDocument(DocumentWriter.java:93)\u003c\\/p\u003e\\n\\n\u003cp\u003eVery strang I must say, I will have to look into that in more detail.  Anyone\u003cbr\\/\u003e\\ncare to comment?  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322385_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322385_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T16:02:50+0000\'\u003e24\\/May\\/05 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I expanded the depth of the HPFOF test (will attach shortly) but in summary, \\nthis is where it comes from: \\n\\n TRACE 300351: \\n        java.lang.Throwable.fillInStackTrace(Throwable.java:Unknown line) \\n        java.lang.Throwable.&lt;init&gt;(Throwable.java:196) \\n        java.lang.Exception.&lt;init&gt;(Exception.java:41) \\n        java.lang.RuntimeException.&lt;init&gt;(RuntimeException.java:43) \\n        java.lang.ClassCastException.&lt;init&gt;(ClassCastException.java:39) \\n        org.apache.lucene.document.Field.readerValue(Field.java:262) \\n\\n org.apache.lucene.index.DocumentWriter.invertDocument(DocumentWriter.java:152) \\n        org.apache.lucene.index.DocumentWriter.addDocument(DocumentWriter.java:93) \\n\\n Very strang I must say, I will have to look into that in more detail.  Anyone \\ncare to comment?                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322386\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322386&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322386\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322386_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322386_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T16:07:09+0000\'\u003e24\\/May\\/05 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15141)\u003cbr\\/\u003e\\nSame HPFOF trace, patch applied, but with deeper stack trace\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322386_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322386_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T16:07:09+0000\'\u003e24\\/May\\/05 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15141) \\nSame HPFOF trace, patch applied, but with deeper stack trace              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322387\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322387&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322387\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322387_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322387_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T16:34:07+0000\'\u003e24\\/May\\/05 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSee Bug 35037 for related info\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322387_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322387_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/May\\/05 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-24T16:34:07+0000\'\u003e24\\/May\\/05 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    See Bug 35037 for related info              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322388\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322388&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322388\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322388_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322388_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/05 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-25T10:22:55+0000\'\u003e25\\/May\\/05 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e(In reply to comment #12)\u003cbr\\/\u003e\\n&gt; Most likely the IOExceptions stem from FastCharStream of StandardAnalyzer, at\u003cbr\\/\u003e\\nleast that\'s my experience. \u003cbr\\/\u003e\\n&gt; See the header of your hprof file to check if that\'s the case.\u003cbr\\/\u003e\\n&gt; \u003cbr\\/\u003e\\n&gt; Javacc has a gotcha in that it \\\"likes\\\" IOExceptions as part of the normal\u003cbr\\/\u003e\\ncontrol flow on stream termination.\u003cbr\\/\u003e\\n&gt; I have performance patches for this that make FastCharStream 2-10 times faster\u003cbr\\/\u003e\\nfor small inputs (it \u003cbr\\/\u003e\\n&gt; doesn\'t matter on large inputs), but I never bothered submitted them since\u003cbr\\/\u003e\\nthey were not crucial for me, \u003cbr\\/\u003e\\n&gt; and seeing that most submissions to lucene-dev go into a black hole anyway\u003cbr\\/\u003e\\nwithout any response, \u003cbr\\/\u003e\\n&gt; neither negative or positive, simply ignored... Hint \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eHey, could you send me the patch for this?  I\'d like to test it out. I\'ve\u003cbr\\/\u003e\\nverified the FastCharStream class does throw IOException when EOF, which of\u003cbr\\/\u003e\\ncourse occurs very frequently when indexing small Fields.  I can\'t see a quick\u003cbr\\/\u003e\\nand easy solution to indicate EOF without the exception, so I\'m keen to see your\u003cbr\\/\u003e\\nwork and test it out with my scenarios.\u003c\\/p\u003e\\n\\n\u003cp\u003echeers,\u003c\\/p\u003e\\n\\n\u003cp\u003ePaul Smith\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12322388_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322388_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/05 10:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-25T10:22:55+0000\'\u003e25\\/May\\/05 10:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    (In reply to comment #12) \\n&gt; Most likely the IOExceptions stem from FastCharStream of StandardAnalyzer, at \\nleast that\'s my experience.  \\n&gt; See the header of your hprof file to check if that\'s the case. \\n&gt;  \\n&gt; Javacc has a gotcha in that it \\\"likes\\\" IOExceptions as part of the normal \\ncontrol flow on stream termination. \\n&gt; I have performance patches for this that make FastCharStream 2-10 times faster \\nfor small inputs (it  \\n&gt; doesn\'t matter on large inputs), but I never bothered submitted them since \\nthey were not crucial for me,  \\n&gt; and seeing that most submissions to lucene-dev go into a black hole anyway \\nwithout any response,  \\n&gt; neither negative or positive, simply ignored... Hint   \\n\\n Hey, could you send me the patch for this?  I\'d like to test it out. I\'ve \\nverified the FastCharStream class does throw IOException when EOF, which of \\ncourse occurs very frequently when indexing small Fields.  I can\'t see a quick \\nand easy solution to indicate EOF without the exception, so I\'m keen to see your \\nwork and test it out with my scenarios. \\n\\n cheers, \\n\\n Paul Smith \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12322389\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12322389&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12322389\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"whoschek@lbl.gov\\\" id=\\\"commentauthor_12322389_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=whoschek%40lbl.gov\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"whoschek@lbl.gov\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e hoschek\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322389_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/05 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-25T13:40:54+0000\'\u003e25\\/May\\/05 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYep, throwing and catching exception in the critical path is always a performance gotcha, common case \u003cbr\\/\u003e\\nor not. See any VM implementation performance papers such as in the IBM Systems journal some years \u003cbr\\/\u003e\\nago, and others. \u003c\\/p\u003e\\n\\n\u003cp\u003eNo idea why the javacc folks didn\'t come up with an API that does not involve exceptions for \u003cb\u003enormal\u003c\\/b\u003e \u003cbr\\/\u003e\\ncontrol flow. Well, javacc has probably been unmaintained dead code for some time now. [Even Xerces \u003cbr\\/\u003e\\nhas such gotchas deep inside it\'s low level native API - I chatted with this some time ago with a Sun \u003cbr\\/\u003e\\nengineer].\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, you can preallocate the IOException in FastCharStream in  a private static final var, and then \u003cbr\\/\u003e\\nthrow the same exception object again and again on EOS. That gives some factor 2x the cheap way \u003cbr\\/\u003e\\nbecause the stack trace does not have to be generated and filled repeatadly (Same for the QueryParser \u003cbr\\/\u003e\\ncopy of FastCharStream).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe other additional 5x comes from getting rid of the exception completely - catching exceptions is \u003cbr\\/\u003e\\nexpensive. This is done via dirty patching the javacc generated code to not require EOS exceptions at \u003cbr\\/\u003e\\nall. Instead you can return 0xFFFF as an EOS marker, or some other unused Unicode value. Look at the \u003cbr\\/\u003e\\njavacc generated code and see where it catches the EOS exception. That\'s where you\'d need to fiddle \u003cbr\\/\u003e\\naround, making sure true abnormal exceptions are still handled properly. It\'s really an akward \u003cbr\\/\u003e\\nmaintainance nightmare because it interferes with generated code, so I don\'t really recommend this. \u003c\\/p\u003e\\n\\n\u003cp\u003eStill, StandardAnalyzer eats CPU (and buffer memory) like there\'s no tomorrow. Instead, I\'d recommend \u003cbr\\/\u003e\\ngiving PatternAnalyzer (from the \\\"memory\\\" SVN contrib area) a try. The functionality is almost the same \u003cbr\\/\u003e\\nas StandardAnalyzer, but it can be many times faster, especially when using it with a String rather than \u003cbr\\/\u003e\\na Reader, and you don\'t have to wait indefinitely for lucene to get fixed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"whoschek@lbl.gov\\\" id=\\\"commentauthor_12322389_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=whoschek%40lbl.gov\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"whoschek@lbl.gov\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e hoschek\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12322389_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/05 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-05-25T13:40:54+0000\'\u003e25\\/May\\/05 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yep, throwing and catching exception in the critical path is always a performance gotcha, common case  \\nor not. See any VM implementation performance papers such as in the IBM Systems journal some years  \\nago, and others.  \\n\\n No idea why the javacc folks didn\'t come up with an API that does not involve exceptions for  normal   \\ncontrol flow. Well, javacc has probably been unmaintained dead code for some time now. [Even Xerces  \\nhas such gotchas deep inside it\'s low level native API - I chatted with this some time ago with a Sun  \\nengineer]. \\n\\n Anyway, you can preallocate the IOException in FastCharStream in  a private static final var, and then  \\nthrow the same exception object again and again on EOS. That gives some factor 2x the cheap way  \\nbecause the stack trace does not have to be generated and filled repeatadly (Same for the QueryParser  \\ncopy of FastCharStream). \\n\\n The other additional 5x comes from getting rid of the exception completely - catching exceptions is  \\nexpensive. This is done via dirty patching the javacc generated code to not require EOS exceptions at  \\nall. Instead you can return 0xFFFF as an EOS marker, or some other unused Unicode value. Look at the  \\njavacc generated code and see where it catches the EOS exception. That\'s where you\'d need to fiddle  \\naround, making sure true abnormal exceptions are still handled properly. It\'s really an akward  \\nmaintainance nightmare because it interferes with generated code, so I don\'t really recommend this.  \\n\\n Still, StandardAnalyzer eats CPU (and buffer memory) like there\'s no tomorrow. Instead, I\'d recommend  \\ngiving PatternAnalyzer (from the \\\"memory\\\" SVN contrib area) a try. The functionality is almost the same  \\nas StandardAnalyzer, but it can be many times faster, especially when using it with a String rather than  \\na Reader, and you don\'t have to wait indefinitely for lucene to get fixed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427743\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427743&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427743\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12427743_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427743_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/06 08:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-13T08:17:54+0000\'\u003e13\\/Aug\\/06 08:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis last patch looks good to me, and I remember looking at this issue when Paul brought it up.  If I recall correctly, I saw the same wasted time in maybeMergeSegments().\u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests pass, so I\'m committing this, only 15 months after it was reported \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e.  Thanks Paul!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12427743_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427743_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/06 08:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-13T08:17:54+0000\'\u003e13\\/Aug\\/06 08:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This last patch looks good to me, and I remember looking at this issue when Paul brought it up.  If I recall correctly, I saw the same wasted time in maybeMergeSegments(). \\n\\n All tests pass, so I\'m committing this, only 15 months after it was reported  .  Thanks Paul!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427787\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427787&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427787\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucenebugs@danielnaber.de\\\" id=\\\"commentauthor_12427787_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucenebugs%40danielnaber.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucenebugs@danielnaber.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427787_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/06 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-13T23:49:01+0000\'\u003e13\\/Aug\\/06 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSomething is wrong with this patch (as it has been applied) as it increases memory usage. Indexing files with the IndexFiles demo worked before using writer.setMaxBufferedDocs(50) and a tight JVM memory setting (-Xmx2M), now it fails with an OutOfMemoryError.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucenebugs@danielnaber.de\\\" id=\\\"commentauthor_12427787_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucenebugs%40danielnaber.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucenebugs@danielnaber.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427787_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/06 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-13T23:49:01+0000\'\u003e13\\/Aug\\/06 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Something is wrong with this patch (as it has been applied) as it increases memory usage. Indexing files with the IndexFiles demo worked before using writer.setMaxBufferedDocs(50) and a tight JVM memory setting (-Xmx2M), now it fails with an OutOfMemoryError.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427794\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427794&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427794\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427794_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427794_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 03:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T03:46:35+0000\'\u003e14\\/Aug\\/06 03:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne problem I see:\u003cbr\\/\u003e\\nIf you continuously add batches of documents of size less than maxBufferedDocs, maybeMergeSegments will never trigger a merge.  On a close(), it looks like there is some merging logic in flushRamSegments, but it doesn\'t do full multi-level merging like maybeMergeSegments does.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think I know how to fix it, but perhaps this should be reverted in the meantime?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427794_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427794_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 03:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T03:46:35+0000\'\u003e14\\/Aug\\/06 03:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One problem I see: \\nIf you continuously add batches of documents of size less than maxBufferedDocs, maybeMergeSegments will never trigger a merge.  On a close(), it looks like there is some merging logic in flushRamSegments, but it doesn\'t do full multi-level merging like maybeMergeSegments does. \\n\\n I think I know how to fix it, but perhaps this should be reverted in the meantime?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427796\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427796&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427796\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427796_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427796_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 04:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T04:14:32+0000\'\u003e14\\/Aug\\/06 04:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother problem I see even for single-sessions is that bufferedDocCount is not maintained correctly... all merges are subtracted, not just those of the buffered docs.  This will lead to fewer and fewer merges than expected over time.\u003c\\/p\u003e\\n\\n\u003cp\u003eI definitely vote to revert this.  There isn\'t an easy fix to this patch - a different approach is required.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427796_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427796_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 04:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T04:14:32+0000\'\u003e14\\/Aug\\/06 04:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another problem I see even for single-sessions is that bufferedDocCount is not maintained correctly... all merges are subtracted, not just those of the buffered docs.  This will lead to fewer and fewer merges than expected over time. \\n\\n I definitely vote to revert this.  There isn\'t an easy fix to this patch - a different approach is required.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427818\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427818&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427818\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12427818_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427818_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 06:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T06:29:55+0000\'\u003e14\\/Aug\\/06 06:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003egeez, yep definitely don\'t put this in, my patch was only a \'suggestion\' to highlight how it fixes the root cause of the problem. iIt is interesting that originally, all the test cases still pass, yet the problems Yonik highlights is real.  Might warrant some extra test cases to cover exactly those situation, even if this problem is not addressed.\u003c\\/p\u003e\\n\\n\u003cp\u003eBe great if this could be fixed completely though, but I haven\'t got any headspace left to continue research on this one.. sorry \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12427818_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427818_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 06:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T06:29:55+0000\'\u003e14\\/Aug\\/06 06:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    geez, yep definitely don\'t put this in, my patch was only a \'suggestion\' to highlight how it fixes the root cause of the problem. iIt is interesting that originally, all the test cases still pass, yet the problems Yonik highlights is real.  Might warrant some extra test cases to cover exactly those situation, even if this problem is not addressed. \\n\\n Be great if this could be fixed completely though, but I haven\'t got any headspace left to continue research on this one.. sorry                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427821\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427821&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427821\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12427821_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427821_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 06:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T06:58:33+0000\'\u003e14\\/Aug\\/06 06:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAh, too bad. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  Reverted.  I do recall seeing maybeMergeSegments being called a lot, although I don\'t recall how much actual time was spent in there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12427821_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427821_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 06:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T06:58:33+0000\'\u003e14\\/Aug\\/06 06:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ah, too bad.    Reverted.  I do recall seeing maybeMergeSegments being called a lot, although I don\'t recall how much actual time was spent in there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427932\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427932&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427932\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427932_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427932_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T16:28:45+0000\'\u003e14\\/Aug\\/06 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHow does this patch look?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s designed to exactly match the previous merging behavior, and it\'s conservative (an exact count is not maintained at all times).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427932_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427932_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T16:28:45+0000\'\u003e14\\/Aug\\/06 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    How does this patch look? \\n\\n It\'s designed to exactly match the previous merging behavior, and it\'s conservative (an exact count is not maintained at all times).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427967\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427967&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427967\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucenebugs@danielnaber.de\\\" id=\\\"commentauthor_12427967_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucenebugs%40danielnaber.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucenebugs@danielnaber.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427967_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T21:15:43+0000\'\u003e14\\/Aug\\/06 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Yonik, I just tested the patch: sorry, but the problem is the same as before: I get an OutOfMemoryError using settings that without the patch. That doesn\'t mean that the patch is wrong of course, but as we\'re after performance improvements it wouldn\'t make sense to compare it to the old version which uses less memory.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucenebugs@danielnaber.de\\\" id=\\\"commentauthor_12427967_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucenebugs%40danielnaber.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucenebugs@danielnaber.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427967_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T21:15:43+0000\'\u003e14\\/Aug\\/06 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Yonik, I just tested the patch: sorry, but the problem is the same as before: I get an OutOfMemoryError using settings that without the patch. That doesn\'t mean that the patch is wrong of course, but as we\'re after performance improvements it wouldn\'t make sense to compare it to the old version which uses less memory.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427969\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427969&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427969\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427969_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427969_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T21:25:42+0000\'\u003e14\\/Aug\\/06 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; the problem is the same as before: I get an OutOfMemoryError using settings that without the patch\u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s worrisome though... the increase in code and data is minimal, and my patch should not trigger any different merging behavior.  Unless the previous version was passing the low-mem test by a few bytes, something is still wrong.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427969_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427969_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T21:25:42+0000\'\u003e14\\/Aug\\/06 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; the problem is the same as before: I get an OutOfMemoryError using settings that without the patch \\n\\n That\'s worrisome though... the increase in code and data is minimal, and my patch should not trigger any different merging behavior.  Unless the previous version was passing the low-mem test by a few bytes, something is still wrong.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427975\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427975&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427975\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12427975_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427975_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 22:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T22:08:07+0000\'\u003e14\\/Aug\\/06 22:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is where some tracing logging code would be useful.  Maybe a YourKit memory snapshot to see what\'s going on.. ?  I can\'t see Yonik\'s patch should influence the memory profile. It\'s just delaying the check for merging until an appropriate time, and should not be removing opportunities to merge segments.  I can\'t see why checking less often uses more memory.\u003c\\/p\u003e\\n\\n\u003cp\u003eObviously something strange is happening.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"psmith@apache.org\\\" id=\\\"commentauthor_12427975_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=psmith%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"psmith@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Paul Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427975_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 22:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T22:08:07+0000\'\u003e14\\/Aug\\/06 22:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is where some tracing logging code would be useful.  Maybe a YourKit memory snapshot to see what\'s going on.. ?  I can\'t see Yonik\'s patch should influence the memory profile. It\'s just delaying the check for merging until an appropriate time, and should not be removing opportunities to merge segments.  I can\'t see why checking less often uses more memory. \\n\\n Obviously something strange is happening.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427976\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427976&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427976\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427976_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427976_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 22:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T22:19:55+0000\'\u003e14\\/Aug\\/06 22:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, the patch changes what the hotspot is, so the hotspot compiler could be trying to compile different code...\u003c\\/p\u003e\\n\\n\u003cp\u003eDaniel, what is the exact test you are running?  what JVM and other settings?\u003cbr\\/\u003e\\nPerhaps trying both versions with -Xbatch or -Xint would remove the differences?\u003c\\/p\u003e\\n\\n\u003cp\u003ePerhaps we need a method to determine if index \\\"invariants\\\" have been met...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12427976_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427976_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 22:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T22:19:55+0000\'\u003e14\\/Aug\\/06 22:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, the patch changes what the hotspot is, so the hotspot compiler could be trying to compile different code... \\n\\n Daniel, what is the exact test you are running?  what JVM and other settings? \\nPerhaps trying both versions with -Xbatch or -Xint would remove the differences? \\n\\n Perhaps we need a method to determine if index \\\"invariants\\\" have been met...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427981\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427981&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427981\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucenebugs@danielnaber.de\\\" id=\\\"commentauthor_12427981_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucenebugs%40danielnaber.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucenebugs@danielnaber.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427981_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 23:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T23:05:37+0000\'\u003e14\\/Aug\\/06 23:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just see that this OOM is not exactly reproducible. I would have expected that it always happens when it has happened once when indexing the same data with the same settings (though not necessarily at the same time). But that doesn\'t seem to be the case. I use Java 1.4.2, -Xmx2M, writer.setMaxBufferedDocs(50) and I am indexing 2200 files with the IndexFiles class from the Lucene demo package. Also, I let the code run in Eclipse, maybe this has negative side effects.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo your code is probably okay, although I suggest you set up a similar test case just to be sure.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucenebugs@danielnaber.de\\\" id=\\\"commentauthor_12427981_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucenebugs%40danielnaber.de\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucenebugs@danielnaber.de\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Daniel Naber\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427981_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 23:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T23:05:37+0000\'\u003e14\\/Aug\\/06 23:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just see that this OOM is not exactly reproducible. I would have expected that it always happens when it has happened once when indexing the same data with the same settings (though not necessarily at the same time). But that doesn\'t seem to be the case. I use Java 1.4.2, -Xmx2M, writer.setMaxBufferedDocs(50) and I am indexing 2200 files with the IndexFiles class from the Lucene demo package. Also, I let the code run in Eclipse, maybe this has negative side effects. \\n\\n So your code is probably okay, although I suggest you set up a similar test case just to be sure.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12427984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12427984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12427984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dmsmith555\\\" id=\\\"commentauthor_12427984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dmsmith555\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dmsmith555\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e DM Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T23:14:52+0000\'\u003e14\\/Aug\\/06 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn Eclipse you can set the run to use its own JVM. Otherwise it runs in Eclipse\'s JVM and it has negative memory side effects.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dmsmith555\\\" id=\\\"commentauthor_12427984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dmsmith555\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dmsmith555\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e DM Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12427984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/06 23:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-14T23:14:52+0000\'\u003e14\\/Aug\\/06 23:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    In Eclipse you can set the run to use its own JVM. Otherwise it runs in Eclipse\'s JVM and it has negative memory side effects.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428033\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428033&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428033\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428033_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428033_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/06 04:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-15T04:02:16+0000\'\u003e15\\/Aug\\/06 04:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSomething is wrong with my patch... the behavior still differs from the original.\u003cbr\\/\u003e\\nI wrote a testInvariants() method, and merges are not always done when they need to be.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428033_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428033_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/06 04:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-15T04:02:16+0000\'\u003e15\\/Aug\\/06 04:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Something is wrong with my patch... the behavior still differs from the original. \\nI wrote a testInvariants() method, and merges are not always done when they need to be.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428038\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428038&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428038\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428038_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428038_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/06 05:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-15T05:11:24+0000\'\u003e15\\/Aug\\/06 05:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGot it!\u003c\\/p\u003e\\n\\n\u003cp\u003eAttatching new version with a minor change... I forgot to take into account deleted documents.  After a merge, instead of setting the count to minMergeDocs, we set it to 0, forcing a recount on the next add.  The reason is that deleted docs could have been squeezed out during the merge ,leaving a smaller segment that might be used in another merge shortly.\u003c\\/p\u003e\\n\\n\u003cp\u003eExample of original behavior (minMergeDocs=10):\u003cbr\\/\u003e\\n   \\/\\/ segment sizes = 55,8,1\u003cbr\\/\u003e\\n  add  doc\u003cbr\\/\u003e\\n   \\/\\/ segment sizes = 55,8,1,1\u003cbr\\/\u003e\\n  maybe merge\u003cbr\\/\u003e\\n  \\/\\/ segment sizes = 55,9     (not 10 because of a previously deleted doc)\u003cbr\\/\u003e\\n  add doc\u003cbr\\/\u003e\\n   \\/\\/ segment sizes = 55,9,1\u003cbr\\/\u003e\\n  maybe merge\u003cbr\\/\u003e\\n   \\/\\/ segment sizes = 55,10\u003c\\/p\u003e\\n\\n\u003cp\u003eNow, the original behavior isn\'t necessarily desirable,  but we are taking baby steps... first \\\"do no harm\\\".  A separate patch can address merging behavior in the presence of deleted documents.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428038_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428038_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/06 05:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-15T05:11:24+0000\'\u003e15\\/Aug\\/06 05:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Got it! \\n\\n Attatching new version with a minor change... I forgot to take into account deleted documents.  After a merge, instead of setting the count to minMergeDocs, we set it to 0, forcing a recount on the next add.  The reason is that deleted docs could have been squeezed out during the merge ,leaving a smaller segment that might be used in another merge shortly. \\n\\n Example of original behavior (minMergeDocs=10): \\n   \\/\\/ segment sizes = 55,8,1 \\n  add  doc \\n   \\/\\/ segment sizes = 55,8,1,1 \\n  maybe merge \\n  \\/\\/ segment sizes = 55,9     (not 10 because of a previously deleted doc) \\n  add doc \\n   \\/\\/ segment sizes = 55,9,1 \\n  maybe merge \\n   \\/\\/ segment sizes = 55,10 \\n\\n Now, the original behavior isn\'t necessarily desirable,  but we are taking baby steps... first \\\"do no harm\\\".  A separate patch can address merging behavior in the presence of deleted documents.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428522\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428522&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428522\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428522_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428522_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/06 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-16T22:07:04+0000\'\u003e16\\/Aug\\/06 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt seems that the excessive cpu usage is mainly for (re)scanning those single-doc segments at the top of the \\\"stack\\\". \u003c\\/p\u003e\\n\\n\u003cp\u003eThe following simple patch (small modification to previous one) only keeps track of the number of single doc segments, and when iterating for merge candidate segments, takes all those single doc segments in one step. \u003c\\/p\u003e\\n\\n\u003cp\u003eAll tests pass with this patch, running a bit faster (3 seconds - can be just noise). A \\\"tight mem setting\\\" (2048 cacm files with -Xmx3m and setMaxBufferedDocs(50) ) that fails with previous patch passes with this one. I checked the trace for which segments were merged - same merge decisions as before this change for these 2048 filess.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428522_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428522_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/06 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-16T22:07:04+0000\'\u003e16\\/Aug\\/06 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It seems that the excessive cpu usage is mainly for (re)scanning those single-doc segments at the top of the \\\"stack\\\".  \\n\\n The following simple patch (small modification to previous one) only keeps track of the number of single doc segments, and when iterating for merge candidate segments, takes all those single doc segments in one step.  \\n\\n All tests pass with this patch, running a bit faster (3 seconds - can be just noise). A \\\"tight mem setting\\\" (2048 cacm files with -Xmx3m and setMaxBufferedDocs(50) ) that fails with previous patch passes with this one. I checked the trace for which segments were merged - same merge decisions as before this change for these 2048 filess.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428527\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428527&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428527\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428527_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428527_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/06 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-16T22:33:04+0000\'\u003e16\\/Aug\\/06 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was literally a minute away from committing my version when Doron sumbitted his  \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\nActually, I think I like Doron\'s \\\"singleDocSegmentsCount\\\" better.... it\'s easier to understand at a glance.\u003c\\/p\u003e\\n\\n\u003cp\u003eI was testing the performance for mine... not as much of a speeup as I would have liked...\u003cbr\\/\u003e\\n5 to 6% better with maxBufferedDocs=1000, and a trivial single field document.\u003cbr\\/\u003e\\nYou need to go to maxBufferedDocs=10000 to see a good speedup, and that\'s probably not advisable for most real indicies (and the maxBufferedDocs=1000 used much less memory and was slightly faster anyway).\u003c\\/p\u003e\\n\\n\u003cp\u003eHere is the code I added to IndexWriter to test my version (add testInvariants() after add() call and after flushRamSegments() in close(), then do \\\"ant test\\\")\u003c\\/p\u003e\\n\\n\u003cp\u003e  private synchronized void testInvariants() {\u003cbr\\/\u003e\\n    \\/\\/ index segments should decrease in size\u003cbr\\/\u003e\\n    int maxSegLevel = 0;\u003cbr\\/\u003e\\n    for (int i=segmentInfos.size()\u003cdel\u003e1; i&gt;=0; i\u003c\\/del\u003e-) {\u003cbr\\/\u003e\\n      SegmentInfo si = segmentInfos.info\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/information.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e;\u003cbr\\/\u003e\\n      int segLevel = (si.docCount)\\/minMergeDocs;\u003cbr\\/\u003e\\n      if (segLevel &lt; maxSegLevel) \u003c\\/p\u003e\\n{\\n\\n        throw new RuntimeException(\\\"Segment #\\\" + i + \\\" is too small. \\\" + segInfo());\\n      }\\n\u003cp\u003e      maxSegLevel = Math.max(maxSegLevel,segLevel);\u003cbr\\/\u003e\\n    }\u003c\\/p\u003e\\n\\n\u003cp\u003e    \\/\\/ check if merges needed\u003cbr\\/\u003e\\n    long targetMergeDocs = minMergeDocs;\u003cbr\\/\u003e\\n    int minSegment = segmentInfos.size();\u003c\\/p\u003e\\n\\n\u003cp\u003e    while (targetMergeDocs &lt;= maxMergeDocs &amp;&amp; minSegment&gt;=0) {\u003cbr\\/\u003e\\n      int mergeDocs = 0;\u003cbr\\/\u003e\\n      while (--minSegment &gt;= 0) \u003c\\/p\u003e\\n{\\n        SegmentInfo si = segmentInfos.info(minSegment);\\n        if (si.docCount &gt;= targetMergeDocs) break;\\n        mergeDocs += si.docCount;\\n      }\\n\\n\u003cp\u003e      if (mergeDocs &gt;= targetMergeDocs) \u003c\\/p\u003e\\n{\\n        throw new RuntimeException(\\\"Merge needed at level \\\"+targetMergeDocs + \\\" :\\\"+segInfo());\\n      }\\n\\n\u003cp\u003e      targetMergeDocs *= mergeFactor;\\t\\t  \\/\\/ increase target size\u003cbr\\/\u003e\\n    }\u003cbr\\/\u003e\\n  }\u003c\\/p\u003e\\n\\n\u003cp\u003e  private String segInfo() {\u003cbr\\/\u003e\\n    StringBuffer sb = new StringBuffer(\\\"minMergeDocs=\\\"\u003cins\u003eminMergeDocs\u003c\\/ins\u003e\\\"docsLeftBeforeMerge=\\\"\u003cins\u003edocsLeftBeforeMerge\u003c\\/ins\u003e\\\" segsizes:\\\");\u003cbr\\/\u003e\\n    for (int i=0; i&lt;segmentInfos.size(); i++) \u003c\\/p\u003e\\n{\\n      sb.append(segmentInfos.info(i).docCount);\\n      sb.append(\\\",\\\");\\n    }\\n\u003cp\u003e    return sb.toString();\u003cbr\\/\u003e\\n  }\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428527_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428527_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/06 22:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-16T22:33:04+0000\'\u003e16\\/Aug\\/06 22:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was literally a minute away from committing my version when Doron sumbitted his    \\nActually, I think I like Doron\'s \\\"singleDocSegmentsCount\\\" better.... it\'s easier to understand at a glance. \\n\\n I was testing the performance for mine... not as much of a speeup as I would have liked... \\n5 to 6% better with maxBufferedDocs=1000, and a trivial single field document. \\nYou need to go to maxBufferedDocs=10000 to see a good speedup, and that\'s probably not advisable for most real indicies (and the maxBufferedDocs=1000 used much less memory and was slightly faster anyway). \\n\\n Here is the code I added to IndexWriter to test my version (add testInvariants() after add() call and after flushRamSegments() in close(), then do \\\"ant test\\\") \\n\\n   private synchronized void testInvariants() { \\n    \\/\\/ index segments should decrease in size \\n    int maxSegLevel = 0; \\n    for (int i=segmentInfos.size() 1; i&gt;=0; i -) { \\n      SegmentInfo si = segmentInfos.info ; \\n      int segLevel = (si.docCount)\\/minMergeDocs; \\n      if (segLevel &lt; maxSegLevel)  \\n{\\n\\n        throw new RuntimeException(\\\"Segment #\\\" + i + \\\" is too small. \\\" + segInfo());\\n      }\\n       maxSegLevel = Math.max(maxSegLevel,segLevel); \\n    } \\n\\n     \\/\\/ check if merges needed \\n    long targetMergeDocs = minMergeDocs; \\n    int minSegment = segmentInfos.size(); \\n\\n     while (targetMergeDocs &lt;= maxMergeDocs &amp;&amp; minSegment&gt;=0) { \\n      int mergeDocs = 0; \\n      while (--minSegment &gt;= 0)  \\n{\\n        SegmentInfo si = segmentInfos.info(minSegment);\\n        if (si.docCount &gt;= targetMergeDocs) break;\\n        mergeDocs += si.docCount;\\n      }\\n\\n       if (mergeDocs &gt;= targetMergeDocs)  \\n{\\n        throw new RuntimeException(\\\"Merge needed at level \\\"+targetMergeDocs + \\\" :\\\"+segInfo());\\n      }\\n\\n       targetMergeDocs *= mergeFactor;\\t\\t  \\/\\/ increase target size \\n    } \\n  } \\n\\n   private String segInfo() { \\n    StringBuffer sb = new StringBuffer(\\\"minMergeDocs=\\\" minMergeDocs \\\"docsLeftBeforeMerge=\\\" docsLeftBeforeMerge \\\" segsizes:\\\"); \\n    for (int i=0; i&lt;segmentInfos.size(); i++)  \\n{\\n      sb.append(segmentInfos.info(i).docCount);\\n      sb.append(\\\",\\\");\\n    }\\n     return sb.toString(); \\n  }              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428560\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428560&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428560\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428560_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428560_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Aug\\/06 02:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-17T02:54:42+0000\'\u003e17\\/Aug\\/06 02:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve committed Doron\'s version after review and further testing with my testInvariants() (also committed, but commented out).  Thanks Doron &amp; Paul!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12428560_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428560_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Aug\\/06 02:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-17T02:54:42+0000\'\u003e17\\/Aug\\/06 02:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve committed Doron\'s version after review and further testing with my testInvariants() (also committed, but commented out).  Thanks Doron &amp; Paul!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428953\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428953&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428953\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428953_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428953_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 09:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T09:21:28+0000\'\u003e18\\/Aug\\/06 09:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ewell....  there is a problem in the current patch after all... the counter is not decremented when a merge is triggerred by a call to optimize. It is only decremented when a merge is called from maybeMergeSegments(). Therefore the counter decrement should move to mergeSegments(int,int). I am testing this fix now and will add a new patch for this soon.\u003cbr\\/\u003e\\nDoron\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428953_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428953_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 09:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T09:21:28+0000\'\u003e18\\/Aug\\/06 09:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    well....  there is a problem in the current patch after all... the counter is not decremented when a merge is triggerred by a call to optimize. It is only decremented when a merge is called from maybeMergeSegments(). Therefore the counter decrement should move to mergeSegments(int,int). I am testing this fix now and will add a new patch for this soon. \\nDoron              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12428964\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12428964&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12428964\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428964_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428964_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 10:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T10:03:14+0000\'\u003e18\\/Aug\\/06 10:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe attached doron_2_IndexWriter.patch is fixing the updating of singleDocSegmentsCount to take place in mergeSegments(minSegment, end) so that it would apply also when optimize() is called. The update of the counter now considers the range of the merge (so the counter is not necessarily updated to 0).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe bug in previous implementation was occasionally using TestIndexModifier.testIndexWithThreads() to fail with ArrayIndexOutOfBoundsException on the segments array.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran this test several times with this fix and now it consistently passes. \\\"ant test\\\" passes as well.\u003c\\/p\u003e\\n\\n\u003cp\u003eI hope we\'re done with this bug...\u003c\\/p\u003e\\n\\n\u003cp\u003eDoron\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12428964_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12428964_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 10:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T10:03:14+0000\'\u003e18\\/Aug\\/06 10:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The attached doron_2_IndexWriter.patch is fixing the updating of singleDocSegmentsCount to take place in mergeSegments(minSegment, end) so that it would apply also when optimize() is called. The update of the counter now considers the range of the merge (so the counter is not necessarily updated to 0). \\n\\n The bug in previous implementation was occasionally using TestIndexModifier.testIndexWithThreads() to fail with ArrayIndexOutOfBoundsException on the segments array. \\n\\n I ran this test several times with this fix and now it consistently passes. \\\"ant test\\\" passes as well. \\n\\n I hope we\'re done with this bug... \\n\\n Doron              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429012\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429012&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429012\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429012_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429012_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 13:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T13:34:35+0000\'\u003e18\\/Aug\\/06 13:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Doron, I caught that too and I was just going to set the count to 0 in mergeSegments (mergeSegments is always called with end == size() currently I think).  Your fix is better though - gives more flexibility.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429012_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429012_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 13:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T13:34:35+0000\'\u003e18\\/Aug\\/06 13:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Doron, I caught that too and I was just going to set the count to 0 in mergeSegments (mergeSegments is always called with end == size() currently I think).  Your fix is better though - gives more flexibility.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429027\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429027&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429027\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429027_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429027_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 14:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T14:27:33+0000\'\u003e18\\/Aug\\/06 14:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe could also make the following change to flushRamSegments, right?\u003c\\/p\u003e\\n\\n\u003cp\u003e  private final void flushRamSegments() throws IOException {\u003cbr\\/\u003e\\n    int minSegment = segmentInfos.size() - singleDocSegmentsCount;\u003cbr\\/\u003e\\n    int docCount = singleDocSegmentsCount;\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429027_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429027_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 14:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T14:27:33+0000\'\u003e18\\/Aug\\/06 14:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We could also make the following change to flushRamSegments, right? \\n\\n   private final void flushRamSegments() throws IOException { \\n    int minSegment = segmentInfos.size() - singleDocSegmentsCount; \\n    int docCount = singleDocSegmentsCount;              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429069\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429069&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429069\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12429069_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429069_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T17:42:18+0000\'\u003e18\\/Aug\\/06 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRight... actually it should be like this:\u003c\\/p\u003e\\n\\n\u003cp\u003e   int minSegment = segmentInfos.size() - singleDocSegmentsCount - 1; \u003c\\/p\u003e\\n\\n\u003cp\u003eBut since flushRamSegments() is only called by close() and optimize(), no real performance gain is expected here. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo I\'m not sure what my preference is between - \u003cbr\\/\u003e\\n(a) do not to change here, because \\\"why change a working code to be perhaps a bit more complex for no performance gain\\\". \u003cbr\\/\u003e\\n(b) change here too, also to be consistent with how this counter is used in maybeMergeSegments().\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway I tested this change and it works - so I am attaching also this version - doron_2b_IndexWriter.patch - in case there is a favor for (b).\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eDoron\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12429069_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429069_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Aug\\/06 17:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-18T17:42:18+0000\'\u003e18\\/Aug\\/06 17:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Right... actually it should be like this: \\n\\n    int minSegment = segmentInfos.size() - singleDocSegmentsCount - 1;  \\n\\n But since flushRamSegments() is only called by close() and optimize(), no real performance gain is expected here.  \\n\\n So I\'m not sure what my preference is between -  \\n(a) do not to change here, because \\\"why change a working code to be perhaps a bit more complex for no performance gain\\\".  \\n(b) change here too, also to be consistent with how this counter is used in maybeMergeSegments(). \\n\\n Anyway I tested this change and it works - so I am attaching also this version - doron_2b_IndexWriter.patch - in case there is a favor for (b). \\n\\n \\n\\t Doron \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429248\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429248&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429248\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12429248_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429248_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/06 07:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-20T07:02:41+0000\'\u003e20\\/Aug\\/06 07:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePaul, would you like to re-open this issue for (re)solving it with one of the two recent patches (2 or 2b)  - I think that once an issue is resolved it can be re-opened (or closed) by the developer who opened it. (I assume commiters can also re-open, but I\'m not sure - well, at least I can\'t.)\u003cbr\\/\u003e\\nThanks, Doron\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12429248_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429248_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/06 07:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-20T07:02:41+0000\'\u003e20\\/Aug\\/06 07:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Paul, would you like to re-open this issue for (re)solving it with one of the two recent patches (2 or 2b)  - I think that once an issue is resolved it can be re-opened (or closed) by the developer who opened it. (I assume commiters can also re-open, but I\'m not sure - well, at least I can\'t.) \\nThanks, Doron              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429262\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429262&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429262\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429262_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429262_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/06 13:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-20T13:47:32+0000\'\u003e20\\/Aug\\/06 13:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNo need to re-open Doron, I committed doron_2_IndexWriter.patch at the same time as my first reply (shortly after you posted it).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429262_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429262_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/06 13:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-20T13:47:32+0000\'\u003e20\\/Aug\\/06 13:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    No need to re-open Doron, I committed doron_2_IndexWriter.patch at the same time as my first reply (shortly after you posted it).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429522\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429522&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429522\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12429522_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429522_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 20:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T20:40:29+0000\'\u003e21\\/Aug\\/06 20:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh - sorry for the \'noise\'  - got used to systems where a commit must be attached to an issue\\/defect - should have checked the commits list or the code itself - I\'m learning all the time...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12429522_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429522_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 20:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T20:40:29+0000\'\u003e21\\/Aug\\/06 20:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh - sorry for the \'noise\'  - got used to systems where a commit must be attached to an issue\\/defect - should have checked the commits list or the code itself - I\'m learning all the time...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12429525\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-388?focusedCommentId=12429525&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12429525\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429525_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429525_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 20:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T20:46:33+0000\'\u003e21\\/Aug\\/06 20:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNo problem... I probably should have put \\\"\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-388\\\" title=\\\"[PATCH] IndexWriter.maybeMergeSegments() takes lots of CPU resources\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-388\\\"\u003e\u003cdel\u003eLUCENE-388\u003c\\/del\u003e\u003c\\/a\u003e\\\" in the commit log (it allows JIRA to link up the related commits automatically)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12429525_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12429525_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/06 20:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-08-21T20:46:33+0000\'\u003e21\\/Aug\\/06 20:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    No problem... I probably should have put \\\"  LUCENE-388  \\\" in the commit log (it allows JIRA to link up the related commits automatically)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520241870267"> 
    <input type="hidden" title="jira.request.server.time" value="238"> 
    <input type="hidden" title="jira.request.id" value="564x94481495x5"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="27"> 
    <input type="hidden" title="db.conns.time.in.ms" value="33"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 564x94481495x5
	          REQUEST TIMESTAMP : [05/Mar/2018:09:24:30 +0000]
	               REQUEST TIME : 0.2380
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=16, elapsedTotal=27176809, elapsedMin=456459, elapsedMax=11369674, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=20, elapsedTotal=33464982, elapsedMin=495934, elapsedMax=11401111, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>