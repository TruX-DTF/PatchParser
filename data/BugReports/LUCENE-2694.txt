<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|5ee7b9ce37f6ac42a3a15efdbfa05384559124ec|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"89325fe785b4ba\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-2694"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-2694] MTQ rewrite + weight/scorer init should be single pass - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-2694] MTQ rewrite + weight/scorer init should be single pass - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2694">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-2694" href="/jira/browse/LUCENE-2694" id="key-val" rel="12476949">LUCENE-2694</a></li>
                </ol>
                <h1 id="summary-val">MTQ rewrite + weight/scorer init should be single pass</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2694"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-2694/LUCENE-2694.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-2694/LUCENE-2694.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-2694/LUCENE-2694.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-2694/LUCENE-2694.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Fsearch%22" title="core/search issues with search code">core/search</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12476949-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Spinoff of <a href="https://issues.apache.org/jira/browse/LUCENE-2690" title="Do MultiTermQuery boolean rewrites per segment" class="issue-link" data-issue-key="LUCENE-2690"><del>LUCENE-2690</del></a> (see the hacked patch on that issue)...</p> 
                  <p>Once we fix MTQ rewrite to be per-segment, we should take it further and make weight/scorer init also run in the same single pass as rewrite.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-2694?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-2694?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-2694?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-2694?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12467887" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12467887/LUCENE-2694_hack.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2694_hack.patch:https://issues.apache.org/jira/secure/attachment/12467887/LUCENE-2694_hack.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12467887/LUCENE-2694_hack.patch" title="Latest  10/Jan/11 13:35 - Robert Muir" draggable="true" data-downloadurl="text/plain:LUCENE-2694_hack.patch:https://issues.apache.org/jira/secure/attachment/12467887/LUCENE-2694_hack.patch">LUCENE-2694_hack.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-10T13:35:07.451Z">10/Jan/11 13:35</time>
                   </dd>
                   <dd class="attachment-size">
                    92 kB
                   </dd>
                   <dd class="attachment-author">
                    Robert Muir
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12468165" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468165/LUCENE-2694.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468165/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468165/LUCENE-2694.patch" title="Latest  12/Jan/11 21:32 - Simon Willnauer" draggable="true" data-downloadurl="text/plain:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468165/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-12T21:32:31.334Z">12/Jan/11 21:32</time>
                   </dd>
                   <dd class="attachment-size">
                    85 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12468135" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468135/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468135/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468135/LUCENE-2694.patch" title=" 12/Jan/11 16:23 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468135/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-12T16:23:35.043Z">12/Jan/11 16:23</time>
                   </dd>
                   <dd class="attachment-size">
                    84 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12468131" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468131/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468131/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468131/LUCENE-2694.patch" title=" 12/Jan/11 14:07 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468131/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-12T14:07:38.596Z">12/Jan/11 14:07</time>
                   </dd>
                   <dd class="attachment-size">
                    83 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12468015" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12468015/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468015/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12468015/LUCENE-2694.patch" title=" 11/Jan/11 15:26 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12468015/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-11T15:26:20.405Z">11/Jan/11 15:26</time>
                   </dd>
                   <dd class="attachment-size">
                    84 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12467998" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12467998/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12467998/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12467998/LUCENE-2694.patch" title=" 11/Jan/11 11:44 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12467998/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-11T11:44:41.839Z">11/Jan/11 11:44</time>
                   </dd>
                   <dd class="attachment-size">
                    94 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12467881" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12467881/LUCENE-2694.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12467881/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12467881/LUCENE-2694.patch" title=" 10/Jan/11 11:27 - Simon Willnauer" draggable="true" data-downloadurl="text/plain:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12467881/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-01-10T11:27:15.195Z">10/Jan/11 11:27</time>
                   </dd>
                   <dd class="attachment-size">
                    95 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12466724" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12466724/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466724/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12466724/LUCENE-2694.patch" title=" 21/Dec/10 15:33 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466724/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-12-21T15:33:13.346Z">21/Dec/10 15:33</time>
                   </dd>
                   <dd class="attachment-size">
                    92 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12466638" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12466638/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466638/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12466638/LUCENE-2694.patch" title=" 20/Dec/10 15:25 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466638/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-12-20T15:25:59.145Z">20/Dec/10 15:25</time>
                   </dd>
                   <dd class="attachment-size">
                    92 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12466487" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12466487/LUCENE-2694.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466487/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12466487/LUCENE-2694.patch" title=" 17/Dec/10 19:24 - Simon Willnauer" draggable="true" data-downloadurl="text/plain:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466487/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-12-17T19:24:41.747Z">17/Dec/10 19:24</time>
                   </dd>
                   <dd class="attachment-size">
                    82 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12466390" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12466390/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466390/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12466390/LUCENE-2694.patch" title=" 16/Dec/10 15:57 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12466390/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-12-16T15:57:52.913Z">16/Dec/10 15:57</time>
                   </dd>
                   <dd class="attachment-size">
                    78 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12460020" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12460020/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12460020/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12460020/LUCENE-2694.patch" title=" 19/Nov/10 16:54 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12460020/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-19T16:54:08.754Z">19/Nov/10 16:54</time>
                   </dd>
                   <dd class="attachment-size">
                    73 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12459929" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12459929/LUCENE-2694.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12459929/LUCENE-2694.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12459929/LUCENE-2694.patch" title=" 18/Nov/10 17:46 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2694.patch:https://issues.apache.org/jira/secure/attachment/12459929/LUCENE-2694.patch">LUCENE-2694.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-11-18T17:46:53.855Z">18/Nov/10 17:46</time>
                   </dd>
                   <dd class="attachment-size">
                    39 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12466529" data-issue-id="12476949" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12466529/LUCENE-2694-FTE.patch" draggable="true" data-downloadurl="text/plain:LUCENE-2694-FTE.patch:https://issues.apache.org/jira/secure/attachment/12466529/LUCENE-2694-FTE.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12466529/LUCENE-2694-FTE.patch" title="Latest  18/Dec/10 11:36 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-2694-FTE.patch:https://issues.apache.org/jira/secure/attachment/12466529/LUCENE-2694-FTE.patch">LUCENE-2694-FTE.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-12-18T11:36:11.062Z">18/Dec/10 11:36</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="blocks">
                   blocks
                  </dt> 
                  <dd id="internal-12478260_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-2723: Speed up Lucene's low level bulk postings read API"> <a href="/jira/browse/LUCENE-2723" data-issue-key="LUCENE-2723" class="issue-link link-title resolution">LUCENE-2723</a> <span class="link-summary">Speed up Lucene's low level bulk postings read API</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is blocked by">
                   is blocked by
                  </dt> 
                  <dd id="internal-12493981_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-2831: Revise Weight#scorer &amp; Filter#getDocIdSet API to pass Readers context"> <a href="/jira/browse/LUCENE-2831" data-issue-key="LUCENE-2831" class="issue-link link-title resolution">LUCENE-2831</a> <span class="link-summary">Revise Weight#scorer &amp; Filter#getDocIdSet API to pass Readers context</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12476825_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-2690: Do MultiTermQuery boolean rewrites per segment"> <a href="/jira/browse/LUCENE-2690" data-issue-key="LUCENE-2690" class="issue-link link-title resolution">LUCENE-2690</a> <span class="link-summary">Do MultiTermQuery boolean rewrites per segment</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_simonw" rel="simonw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Simon Willnauer&quot;,&quot;emailAddress&quot;:&quot;simonw@apache.org&quot;,&quot;username&quot;:&quot;simonw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="simonw"></span></span> Simon Willnauer </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="10/Oct/10 11:23"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2010-10-10T11:23:24+0000">10/Oct/10 11:23</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:42"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:42:54+0000">10/May/13 10:42</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="12/Jan/11 21:40"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-01-12T21:40:50+0000">12/Jan/11 21:40</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2694?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2694?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12933499\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933499&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933499\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933499_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933499_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 17:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T17:46:53+0000\'\u003e18\\/Nov\\/10 17:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI started on this issue with a rough idea and wanna upload it to get some initial feedback. The idea is to provide access to TermState via the TermsEnum Attribute API to eventually use the TermState inside of TermQuery to prevent a second lookup as well as term cache. Its very rough and I tried to go the least intrusive way as possible so the implementation is mainly to show the main principles.\u003c\\/p\u003e\\n\\n\u003cp\u003efeedback welcome.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933499_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933499_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 17:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T17:46:53+0000\'\u003e18\\/Nov\\/10 17:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I started on this issue with a rough idea and wanna upload it to get some initial feedback. The idea is to provide access to TermState via the TermsEnum Attribute API to eventually use the TermState inside of TermQuery to prevent a second lookup as well as term cache. Its very rough and I tried to go the least intrusive way as possible so the implementation is mainly to show the main principles. \\n\\n feedback welcome.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933505\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933505&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933505\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12933505_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933505_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 18:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T18:06:55+0000\'\u003e18\\/Nov\\/10 18:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Nov\\/10 18:10\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHavent looked closely into the patch (still need to understand the whole thing), just some comments from attribute policeman in general:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThe TermStateAttributeImpl.copyTo should throw ClassCastEx if attributes are not conform (compare other impls), so the if statement should not be there. AttributeSource takes care of copying. This is not used, but for completeness.\u003c\\/li\u003e\\n\\t\u003cli\u003ethe convenience addClause() method in abstract base class should be final! Else you could incorrectly override the wrong one. We already have code duplication in your patch because of this. When you make it final you will see!\u003c\\/li\u003e\\n\\t\u003cli\u003ewhy is the attribute using a SetOnce? Attributes generally should be modifiable multiple times. Now you have to call clear() first. This may change in future when we have set-once attributes, but for now that violates the contract \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003eIs the docFreq no already part of the state so TermCollectingRewrite does not need to expose it separately?\u003c\\/li\u003e\\n\\t\u003cli\u003eWhat happens in the term collectors when the same term with different states are merged in the PQ\\/TermsHash\\/...?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12933505_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933505_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 18:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T18:06:55+0000\'\u003e18\\/Nov\\/10 18:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Nov\\/10 18:10\\\"\u003eedited\u003c\\/span\u003e                   Havent looked closely into the patch (still need to understand the whole thing), just some comments from attribute policeman in general: \\n \\n\\t The TermStateAttributeImpl.copyTo should throw ClassCastEx if attributes are not conform (compare other impls), so the if statement should not be there. AttributeSource takes care of copying. This is not used, but for completeness. \\n\\t the convenience addClause() method in abstract base class should be final! Else you could incorrectly override the wrong one. We already have code duplication in your patch because of this. When you make it final you will see! \\n\\t why is the attribute using a SetOnce? Attributes generally should be modifiable multiple times. Now you have to call clear() first. This may change in future when we have set-once attributes, but for now that violates the contract   \\n\\t Is the docFreq no already part of the state so TermCollectingRewrite does not need to expose it separately? \\n\\t What happens in the term collectors when the same term with different states are merged in the PQ\\/TermsHash\\/...? \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933517\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933517&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933517\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12933517_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933517_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 18:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T18:45:03+0000\'\u003e18\\/Nov\\/10 18:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI would rather not use an attribute here &#8211; this is a very core thing so I think we should extend TermsEnum API.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe can just add a getTermState and a seek(TermState) to terms enum (and, actually, remove cacheTermState)?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, then we wouldn\'t need to add the get docs\\/positions enum methods to TermState.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12933517_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933517_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 18:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T18:45:03+0000\'\u003e18\\/Nov\\/10 18:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I would rather not use an attribute here &#8211; this is a very core thing so I think we should extend TermsEnum API. \\n\\n We can just add a getTermState and a seek(TermState) to terms enum (and, actually, remove cacheTermState)? \\n\\n Also, then we wouldn\'t need to add the get docs\\/positions enum methods to TermState.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933522\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933522&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933522\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933522_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933522_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 18:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T18:49:32+0000\'\u003e18\\/Nov\\/10 18:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUwe I agree with your comments - I just didn\'t pay lots of attention to it since I was rather interested in feedback for the idea....\u003c\\/p\u003e\\n\\n\u003cp\u003eI actually think that we should move the getTermState into the termsEnum though rather than using an attribute but for now that was easier to implement though.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhat happens in the term collectors when the same term with different states are merged in the PQ\\/TermsHash\\/...?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThat one should work since I map the TermState per reader in a PerReaderTermState though.\u003c\\/p\u003e\\n\\n\u003cp\u003esimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933522_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933522_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 18:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T18:49:32+0000\'\u003e18\\/Nov\\/10 18:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Uwe I agree with your comments - I just didn\'t pay lots of attention to it since I was rather interested in feedback for the idea.... \\n\\n I actually think that we should move the getTermState into the termsEnum though rather than using an attribute but for now that was easier to implement though. \\n\\n  What happens in the term collectors when the same term with different states are merged in the PQ\\/TermsHash\\/...?  \\n That one should work since I map the TermState per reader in a PerReaderTermState though. \\n\\n simon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933541\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933541&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933541\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933541_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933541_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T19:43:23+0000\'\u003e18\\/Nov\\/10 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWe can just add a getTermState and a seek(TermState) to terms enum (and, actually, remove cacheTermState)?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYes! please! - i used the attribute to move faster here since it didn\'t require to change the API really.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlso, then we wouldn\'t need to add the get docs\\/positions enum methods to TermState.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eyeah see above....\u003c\\/p\u003e\\n\\n\u003cp\u003ei will workout a cleaner patch\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933541_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933541_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Nov\\/10 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-18T19:43:23+0000\'\u003e18\\/Nov\\/10 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     We can just add a getTermState and a seek(TermState) to terms enum (and, actually, remove cacheTermState)?  \\n Yes! please! - i used the attribute to move faster here since it didn\'t require to change the API really. \\n\\n  Also, then we wouldn\'t need to add the get docs\\/positions enum methods to TermState.  \\n\\n yeah see above.... \\n\\n i will workout a cleaner patch              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933862\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933862&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933862\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933862_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933862_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/10 16:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-19T16:54:08+0000\'\u003e19\\/Nov\\/10 16:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003enext iteration. This patch removes the term cache completely and exposes getTermState via TermsEnum. Terms, TermsEnum and IndexReader can now obtain a DocEnum directly by passing in a TermState.\u003c\\/p\u003e\\n\\n\u003cp\u003eI need to run some benchmarks on an index with several segments on a index with two segments its just slightly faster...\u003cbr\\/\u003e\\nmike do you have one ready?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12933862_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933862_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/10 16:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-19T16:54:08+0000\'\u003e19\\/Nov\\/10 16:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    next iteration. This patch removes the term cache completely and exposes getTermState via TermsEnum. Terms, TermsEnum and IndexReader can now obtain a DocEnum directly by passing in a TermState. \\n\\n I need to run some benchmarks on an index with several segments on a index with two segments its just slightly faster... \\nmike do you have one ready?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12933888\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12933888&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12933888\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12933888_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933888_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/10 17:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-19T17:57:09+0000\'\u003e19\\/Nov\\/10 17:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePhew that was fast!\u003c\\/p\u003e\\n\\n\u003cp\u003eWow, you nuked the terms dict cache \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e Nice!\u003c\\/p\u003e\\n\\n\u003cp\u003eThough it makes me a bit nervous... like there\'ll always be a risk\u003cbr\\/\u003e\\nwe\'ve missed some path through Lucene that does two lookups...  And,\u003cbr\\/\u003e\\neven for external reasons (eg same query arrives to Lucene, looking\u003cbr\\/\u003e\\nfor next page or something), the cache is useful.\u003c\\/p\u003e\\n\\n\u003cp\u003eEG, a straight TermQuery (not spawned by MTQ) is now hitting the terms\u003cbr\\/\u003e\\ndict twice.  Once inside Sim.idfExplain, where it calls\u003cbr\\/\u003e\\nsearcher.docFreq(term), and then again to pull the scorers per sub\u003cbr\\/\u003e\\nreader.  Probably, TermQuery should pull the PerReaderTermState, up\u003cbr\\/\u003e\\nfront, if it wasn\'t already handed it?  And then pass the docFreq to\u003cbr\\/\u003e\\nSim.idfExplain.\u003c\\/p\u003e\\n\\n\u003cp\u003eShould we add a PerReaderTermState.docFreq(), which just sums up\u003cbr\\/\u003e\\nacross all subs?\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes TermState really need field()?  Seems wasteful to have to store\u003cbr\\/\u003e\\nthat... eg an MTQ will store many TermStates against the same field.\u003cbr\\/\u003e\\nI think we should keep TermState lean.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, I think it shouldn\'t need that clone method?\u003c\\/p\u003e\\n\\n\u003cp\u003eI think instead of duplicating docs\\/docsAndPositions (and soon\u003cbr\\/\u003e\\nbulkPostings) on TermsEnum, once for TermState and once without, we\u003cbr\\/\u003e\\nshould just add a seek(TermState)?  And then the single\u003cbr\\/\u003e\\ndocs\\/docsAndPositions\\/etc. method can be used to get the enum for that\u003cbr\\/\u003e\\nterm.  (Likewise for Terms) Also, we should remove docFreq and ord\u003cbr\\/\u003e\\nfrom TermsEnum since you should get it from TermState?\u003c\\/p\u003e\\n\\n\u003cp\u003eI think IndexReader can offer the sugar methods (that take either\u003cbr\\/\u003e\\nBytesRef term or String field + TermState state).\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso: I tried to run the benchmark on beast but unfortunately there\'s\u003cbr\\/\u003e\\na bug somewhere (even though Lucene core tests pass) &#8211; I see\u003cbr\\/\u003e\\ndifferent results for some fuzzy queries.\u003c\\/p\u003e\\n\\n\u003cp\u003eNice work!!  Getting to single term lookup for all queries will be awesome!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12933888_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12933888_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Nov\\/10 17:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-19T17:57:09+0000\'\u003e19\\/Nov\\/10 17:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Phew that was fast! \\n\\n Wow, you nuked the terms dict cache   Nice! \\n\\n Though it makes me a bit nervous... like there\'ll always be a risk \\nwe\'ve missed some path through Lucene that does two lookups...  And, \\neven for external reasons (eg same query arrives to Lucene, looking \\nfor next page or something), the cache is useful. \\n\\n EG, a straight TermQuery (not spawned by MTQ) is now hitting the terms \\ndict twice.  Once inside Sim.idfExplain, where it calls \\nsearcher.docFreq(term), and then again to pull the scorers per sub \\nreader.  Probably, TermQuery should pull the PerReaderTermState, up \\nfront, if it wasn\'t already handed it?  And then pass the docFreq to \\nSim.idfExplain. \\n\\n Should we add a PerReaderTermState.docFreq(), which just sums up \\nacross all subs? \\n\\n Does TermState really need field()?  Seems wasteful to have to store \\nthat... eg an MTQ will store many TermStates against the same field. \\nI think we should keep TermState lean. \\n\\n Also, I think it shouldn\'t need that clone method? \\n\\n I think instead of duplicating docs\\/docsAndPositions (and soon \\nbulkPostings) on TermsEnum, once for TermState and once without, we \\nshould just add a seek(TermState)?  And then the single \\ndocs\\/docsAndPositions\\/etc. method can be used to get the enum for that \\nterm.  (Likewise for Terms) Also, we should remove docFreq and ord \\nfrom TermsEnum since you should get it from TermState? \\n\\n I think IndexReader can offer the sugar methods (that take either \\nBytesRef term or String field + TermState state). \\n\\n Also: I tried to run the benchmark on beast but unfortunately there\'s \\na bug somewhere (even though Lucene core tests pass) &#8211; I see \\ndifferent results for some fuzzy queries. \\n\\n Nice work!!  Getting to single term lookup for all queries will be awesome!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12934260\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12934260&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12934260\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12934260_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12934260_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/10 12:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-21T12:04:05+0000\'\u003e21\\/Nov\\/10 12:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBTW, one use case where this patch should show a sizable performance gain is a \\\"primary key lookup\\\" against a multi-segment index.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo this\'d be a TermQuery against eg an \\\"id\\\" field, where the app knows at most one doc contains the requested value.\u003c\\/p\u003e\\n\\n\u003cp\u003eToday, we pay a high price for the 2nd pass, because we do not cache a miss against a segment.  So on the first pass (computing IDF) we know which segment has a match and which segments do not, but then on the 2nd pass we re-pay the lookup cost against all the misses (the single segment w\\/ the hit will be cached).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo this ought to be a big win... especially once we combine this w\\/ the speedups from pulsing codec (we still need to cutover to this as a default) then primary key lookups in a Lucene index will be much faster...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12934260_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12934260_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/10 12:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-11-21T12:04:05+0000\'\u003e21\\/Nov\\/10 12:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    BTW, one use case where this patch should show a sizable performance gain is a \\\"primary key lookup\\\" against a multi-segment index. \\n\\n So this\'d be a TermQuery against eg an \\\"id\\\" field, where the app knows at most one doc contains the requested value. \\n\\n Today, we pay a high price for the 2nd pass, because we do not cache a miss against a segment.  So on the first pass (computing IDF) we know which segment has a match and which segments do not, but then on the 2nd pass we re-pay the lookup cost against all the misses (the single segment w\\/ the hit will be cached). \\n\\n So this ought to be a big win... especially once we combine this w\\/ the speedups from pulsing codec (we still need to cutover to this as a default) then primary key lookups in a Lucene index will be much faster...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972125\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972125&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972125\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12972125_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972125_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/10 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-16T15:57:52+0000\'\u003e16\\/Dec\\/10 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttaching current state - all test pass for me and luceneutils brings consistent results with trunk.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n               Query   QPS trunkQPS termstate  Pct diff\\n            unit~2.0       14.70       14.39     -2.1%\\n          united~2.0        6.91        6.83     -1.1%\\n          united~1.0        7.42        7.38     -0.6%\\n        \u003cspan class=\\\"code-quote\\\"\u003e\\\"unit state\\\"\u003c\\/span\u003e       12.31       12.37      0.5%\\n            unit~1.0       15.41       15.49      0.5%\\n                uni*        7.18        7.22      0.6%\\n                un*d        7.97        8.04      0.9%\\n               unit*       12.89       13.09      1.6%\\n        +unit +state       28.16       28.64      1.7%\\n    +nebraska +state       81.26       82.67      1.7%\\nspanNear([unit, state], 10, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e)       11.60       11.83      2.0%\\n               state       40.50       41.47      2.4%\\n  spanFirst(unit, 5)       47.65       48.84      2.5%\\n          unit state       17.72       18.19      2.7%\\n                 u*d        4.27        4.48      5.0%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003ethose are the results I have for now.... Fuzzy only expands to 50 terms so that might no be very meaningful. I re-added the TermCache for this patch though... \u003cbr\\/\u003e\\nWill attach more info tomorrow.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12972125_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972125_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/10 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-16T15:57:52+0000\'\u003e16\\/Dec\\/10 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attaching current state - all test pass for me and luceneutils brings consistent results with trunk. \\n\\n  \\n \\n               Query   QPS trunkQPS termstate  Pct diff\\n            unit~2.0       14.70       14.39     -2.1%\\n          united~2.0        6.91        6.83     -1.1%\\n          united~1.0        7.42        7.38     -0.6%\\n         \\\"unit state\\\"        12.31       12.37      0.5%\\n            unit~1.0       15.41       15.49      0.5%\\n                uni*        7.18        7.22      0.6%\\n                un*d        7.97        8.04      0.9%\\n               unit*       12.89       13.09      1.6%\\n        +unit +state       28.16       28.64      1.7%\\n    +nebraska +state       81.26       82.67      1.7%\\nspanNear([unit, state], 10,  true )       11.60       11.83      2.0%\\n               state       40.50       41.47      2.4%\\n  spanFirst(unit, 5)       47.65       48.84      2.5%\\n          unit state       17.72       18.19      2.7%\\n                 u*d        4.27        4.48      5.0%\\n \\n  \\n those are the results I have for now.... Fuzzy only expands to 50 terms so that might no be very meaningful. I re-added the TermCache for this patch though...  \\nWill attach more info tomorrow.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972127\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972127&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972127\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12972127_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972127_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/10 16:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-16T16:06:15+0000\'\u003e16\\/Dec\\/10 16:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe shouldn\'t lose the clone() optimization in StandardPostingsReader... \u003cbr\\/\u003e\\nthe class is final so it should use \'copy\' instead of calling super.clone()\u003cbr\\/\u003e\\nThis is important for -client.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12972127_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972127_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Dec\\/10 16:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-16T16:06:15+0000\'\u003e16\\/Dec\\/10 16:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We shouldn\'t lose the clone() optimization in StandardPostingsReader...  \\nthe class is final so it should use \'copy\' instead of calling super.clone() \\nThis is important for -client.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972586\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972586&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972586\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12972586_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972586_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/10 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-17T18:40:41+0000\'\u003e17\\/Dec\\/10 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFYI - there is a coding error in the latest patch that causes the TermState to be ignored - TermWeight uses the wrong reference to the PerReaderTermState. I will upload a new patch later this weekend\u003c\\/p\u003e\\n\\n\u003cp\u003esimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12972586_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972586_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/10 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-17T18:40:41+0000\'\u003e17\\/Dec\\/10 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FYI - there is a coding error in the latest patch that causes the TermState to be ignored - TermWeight uses the wrong reference to the PerReaderTermState. I will upload a new patch later this weekend \\n\\n simon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972607\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972607&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972607\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12972607_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972607_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/10 19:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-17T19:24:41+0000\'\u003e17\\/Dec\\/10 19:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere is a new patch. I removed the hacky TermWeight part to make only MTQ single pass for now. Other TermQueries will hit the TermCache for now.  No nocommit left. Currently there is some duplication \\/ unncessary classes in the TermState hierarchy - that needs cleanup. \u003c\\/p\u003e\\n\\n\u003cp\u003eBTW. I see some highlighter test failing - will look into this later...\u003cbr\\/\u003e\\nsimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12972607_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972607_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/10 19:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-17T19:24:41+0000\'\u003e17\\/Dec\\/10 19:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here is a new patch. I removed the hacky TermWeight part to make only MTQ single pass for now. Other TermQueries will hit the TermCache for now.  No nocommit left. Currently there is some duplication \\/ unncessary classes in the TermState hierarchy - that needs cleanup.  \\n\\n BTW. I see some highlighter test failing - will look into this later... \\nsimon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972758\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972758&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972758\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12972758_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972758_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 09:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T09:35:21+0000\'\u003e18\\/Dec\\/10 09:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf I force scoring BQ rewrite for wildcard &amp; prefix queries (ie set that rewrite mode and then relax BQ max clause count) I see healthy speedups (~23-27%) for these queries!  Great \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eWhile this doesn\'t happen w\\/ our default settings (ie these queries quickly cutover to constant filter rewrite), apps that change these defaults will see a gain, plus, the term cache (which today \\\"protects\\\" you) is terribly fragile since apps w\\/ many MTQ queries in flight can thrash that cache thus killing performance.  This patch prevents that entirely since MTQs do their own caching of the TermStates they need: awesome.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12972758_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972758_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 09:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T09:35:21+0000\'\u003e18\\/Dec\\/10 09:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If I force scoring BQ rewrite for wildcard &amp; prefix queries (ie set that rewrite mode and then relax BQ max clause count) I see healthy speedups (~23-27%) for these queries!  Great   \\n\\n While this doesn\'t happen w\\/ our default settings (ie these queries quickly cutover to constant filter rewrite), apps that change these defaults will see a gain, plus, the term cache (which today \\\"protects\\\" you) is terribly fragile since apps w\\/ many MTQ queries in flight can thrash that cache thus killing performance.  This patch prevents that entirely since MTQs do their own caching of the TermStates they need: awesome.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972759\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972759&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972759\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12972759_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972759_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 09:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T09:35:43+0000\'\u003e18\\/Dec\\/10 09:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI love seeing cacheCurrentTerm removed!!\u003c\\/p\u003e\\n\\n\u003cp\u003eOK I think we are close!  A bunch of smallish things:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI think we should remove TermsEnum.docFreq and .ord?  Ie replace\u003cbr\\/\u003e\\n    with .termState().docFreq() and .ord()?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAt first I was thinking we should merge up TermStateBase into\u003cbr\\/\u003e\\n    TermState but actually there are cases (eg PulsingCodec, which )\u003cbr\\/\u003e\\n    where you want the separation.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMaybe rename TermStateBase -&gt; PrefixCodedTermState?  Ie this is\u003cbr\\/\u003e\\n    really the TermState impl used by any codec using\u003cbr\\/\u003e\\n    PrefixCodedTerms?  EG the fact that it stores the filePointer into\u003cbr\\/\u003e\\n    a _X.tis file is particular to it...\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMaybe rename MockTermState -&gt; BasicTermState?  At first I was\u003cbr\\/\u003e\\n    thinking the codec should return null if it cannot seek by\u003cbr\\/\u003e\\n    TermState... (I generally don\'t like mock returns that hide\\/lose\u003cbr\\/\u003e\\n    information...) but then it\'s convenient to always have something\u003cbr\\/\u003e\\n    to hold the docFreq for the term to avoid lots of special cased\u003cbr\\/\u003e\\n    code... so I think it\'s OK?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWe lost the \\\"clone using new\\\" in StandardTermState...\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMaybe revert changes to AppendingCodec?  (Ie let it pass its terms\u003cbr\\/\u003e\\n    dict cache size again)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI wonder if we can somehow make PerReaderTermState use an array\u003cbr\\/\u003e\\n    (keyed by sub reader index) instead... seems like a new HashMap\u003cbr\\/\u003e\\n    per Term in an MTQ could be heavy.  It\'s tricky because we don\'t\u003cbr\\/\u003e\\n    store enough information (ie to quickly map parent reader + sub\u003cbr\\/\u003e\\n    reader -&gt; sub index). But I don\'t think this should hold up\u003cbr\\/\u003e\\n    committing... since our defaults don\'t typically allow for \u003cb\u003ethat\u003c\\/b\u003e\u003cbr\\/\u003e\\n    many terms in-flight it should be fine...\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eIt\'s a little spooky the TermQuery.scorer calls .take()\u003cbr\\/\u003e\\n    (destructive), eg it means if you ask for scorer again on same\u003cbr\\/\u003e\\n    reader you get diff\'t behavior?  Can we make that a .get() instead\u003cbr\\/\u003e\\n    of .take()?  (This may also bite us if we use diff\'t threads to\u003cbr\\/\u003e\\n    score each segment, ie suddenly this .take() must be thread safe).\u003cbr\\/\u003e\\n    In fact, same deal w\\/ nulling out the TQ.perReaderTermState?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThe comment on top of TermStateByteStart looks wrong?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eSmall whitespace issue &#8211; missing space on \\\"if(\\\".  Also, our\u003cbr\\/\u003e\\n    generics are not supposed to have whitespace inside, eg we\u003cbr\\/\u003e\\n    shouldn\'t have the space in \\\"new DoubleBarrelLRUCache&lt;FieldAndTerm, TermStateBase&gt;(termsCacheSize);\\\"\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI think the TQ ctor that takes both docFreq and states can drop\u003cbr\\/\u003e\\n    the docFreq?  Ie it can ask the states for it?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12972759_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972759_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 09:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T09:35:43+0000\'\u003e18\\/Dec\\/10 09:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I love seeing cacheCurrentTerm removed!! \\n\\n OK I think we are close!  A bunch of smallish things: \\n\\n \\n\\t I think we should remove TermsEnum.docFreq and .ord?  Ie replace \\n    with .termState().docFreq() and .ord()? \\n \\n\\n\\n \\n\\t At first I was thinking we should merge up TermStateBase into \\n    TermState but actually there are cases (eg PulsingCodec, which ) \\n    where you want the separation. \\n \\n\\n\\n \\n\\t Maybe rename TermStateBase -&gt; PrefixCodedTermState?  Ie this is \\n    really the TermState impl used by any codec using \\n    PrefixCodedTerms?  EG the fact that it stores the filePointer into \\n    a _X.tis file is particular to it... \\n \\n\\n\\n \\n\\t Maybe rename MockTermState -&gt; BasicTermState?  At first I was \\n    thinking the codec should return null if it cannot seek by \\n    TermState... (I generally don\'t like mock returns that hide\\/lose \\n    information...) but then it\'s convenient to always have something \\n    to hold the docFreq for the term to avoid lots of special cased \\n    code... so I think it\'s OK? \\n \\n\\n\\n \\n\\t We lost the \\\"clone using new\\\" in StandardTermState... \\n \\n\\n\\n \\n\\t Maybe revert changes to AppendingCodec?  (Ie let it pass its terms \\n    dict cache size again) \\n \\n\\n\\n \\n\\t I wonder if we can somehow make PerReaderTermState use an array \\n    (keyed by sub reader index) instead... seems like a new HashMap \\n    per Term in an MTQ could be heavy.  It\'s tricky because we don\'t \\n    store enough information (ie to quickly map parent reader + sub \\n    reader -&gt; sub index). But I don\'t think this should hold up \\n    committing... since our defaults don\'t typically allow for  that  \\n    many terms in-flight it should be fine... \\n \\n\\n\\n \\n\\t It\'s a little spooky the TermQuery.scorer calls .take() \\n    (destructive), eg it means if you ask for scorer again on same \\n    reader you get diff\'t behavior?  Can we make that a .get() instead \\n    of .take()?  (This may also bite us if we use diff\'t threads to \\n    score each segment, ie suddenly this .take() must be thread safe). \\n    In fact, same deal w\\/ nulling out the TQ.perReaderTermState? \\n \\n\\n\\n \\n\\t The comment on top of TermStateByteStart looks wrong? \\n \\n\\n\\n \\n\\t Small whitespace issue &#8211; missing space on \\\"if(\\\".  Also, our \\n    generics are not supposed to have whitespace inside, eg we \\n    shouldn\'t have the space in \\\"new DoubleBarrelLRUCache&lt;FieldAndTerm, TermStateBase&gt;(termsCacheSize);\\\" \\n \\n\\n\\n \\n\\t I think the TQ ctor that takes both docFreq and states can drop \\n    the docFreq?  Ie it can ask the states for it? \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972769\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972769&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972769\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12972769_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972769_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 10:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T10:34:57+0000\'\u003e18\\/Dec\\/10 10:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Dec\\/10 10:43\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have also some things:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eWe currently don\'t support seeking a FilteredTermsEnum, this is disallowed by UnsupportedOperationException (we may change this, but its complicated, Robert and me are thinking about it, but for now its disallowed, as it would break the enum logic). So the TermState seek method in FilteredTermsEnum should also throw UOE:\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\/** This \u003cspan class=\\\"code-keyword\\\"\u003eenum\u003c\\/span\u003e does not support seeking!\\n * @\u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e UnsupportedOperationException\\n *\\/\\n@Override\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e SeekStatus seek(BytesRef term, \u003cspan class=\\\"code-object\\\"\u003eboolean\u003c\\/span\u003e useCache) \u003cspan class=\\\"code-keyword\\\"\u003ethrows\u003c\\/span\u003e IOException {\\n  \u003cspan class=\\\"code-keyword\\\"\u003ethrow\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e UnsupportedOperationException(getClass().getName()+\u003cspan class=\\\"code-quote\\\"\u003e\\\" does not support seeking\\\"\u003c\\/span\u003e);\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003eAdditionally, can the next() implementation in FilteredTermsEnum use TermState? It does lots of seeking on the underlying (filtered) TermsEnum. This is the reason why sekking on the FilteredTermsEnum is not allowed. Filtering is done here on the accept() methods.\u003c\\/li\u003e\\n\\t\u003cli\u003eFor what is setNextReader in TermCollector? I don\'t like that, but you seems to need it for the PerReaderTermState. The collector should really only work on the enum not on any reader. At least the\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThats what I have seen on first patch review, will now apply patch and look closer into it \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e But the first point is important, FilteredTermsEnum currently should not support seeking.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12972769_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972769_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 10:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T10:34:57+0000\'\u003e18\\/Dec\\/10 10:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Dec\\/10 10:43\\\"\u003eedited\u003c\\/span\u003e                   I have also some things: \\n \\n\\t We currently don\'t support seeking a FilteredTermsEnum, this is disallowed by UnsupportedOperationException (we may change this, but its complicated, Robert and me are thinking about it, but for now its disallowed, as it would break the enum logic). So the TermState seek method in FilteredTermsEnum should also throw UOE:\\n  \\n \\/** This  enum  does not support seeking!\\n * @ throws  UnsupportedOperationException\\n *\\/\\n@Override\\n public  SeekStatus seek(BytesRef term,  boolean  useCache)  throws  IOException {\\n   throw   new  UnsupportedOperationException(getClass().getName()+ \\\" does not support seeking\\\" );\\n}\\n \\n   \\n\\t Additionally, can the next() implementation in FilteredTermsEnum use TermState? It does lots of seeking on the underlying (filtered) TermsEnum. This is the reason why sekking on the FilteredTermsEnum is not allowed. Filtering is done here on the accept() methods. \\n\\t For what is setNextReader in TermCollector? I don\'t like that, but you seems to need it for the PerReaderTermState. The collector should really only work on the enum not on any reader. At least the \\n \\n\\n\\n Thats what I have seen on first patch review, will now apply patch and look closer into it   But the first point is important, FilteredTermsEnum currently should not support seeking.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12972777\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12972777&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12972777\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12972777_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972777_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 11:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T11:36:11+0000\'\u003e18\\/Dec\\/10 11:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere just the patch for a correct behaving FilteredTermsEnum (according to docs, that it does currently not support seeking). The assert is also not needed, as tenum is guranteed to be not null (its final and ctor already asserts this) \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_12972777_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12972777_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/10 11:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-18T11:36:11+0000\'\u003e18\\/Dec\\/10 11:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here just the patch for a correct behaving FilteredTermsEnum (according to docs, that it does currently not support seeking). The assert is also not needed, as tenum is guranteed to be not null (its final and ctor already asserts this)                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973003\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973003&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973003\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973003_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973003_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 15:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T15:46:54+0000\'\u003e19\\/Dec\\/10 15:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think we should remove TermsEnum.docFreq and .ord? Ie replace\u003cbr\\/\u003e\\nwith .termState().docFreq() and .ord()?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI disagree on that - at least docFreq() is an essential part of the API and we should not force TermState creation just to get the df. Yet, TermState is an expert API you should not need to pull an expert API to get something essential like df.\u003cbr\\/\u003e\\nI would leave those as they are or only pull ord into TermState.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eMaybe rename TermStateBase -&gt; PrefixCodedTermState? Ie this is\u003cbr\\/\u003e\\nreally the TermState impl used by any codec using\u003cbr\\/\u003e\\nPrefixCodedTerms? EG the fact that it stores the filePointer into\u003cbr\\/\u003e\\na _X.tis file is particular to it..\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYeah that sounds reasonable.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eMaybe rename MockTermState -&gt; BasicTermState? At first I was\u003cbr\\/\u003e\\nthinking the codec should return null if it cannot seek by\u003cbr\\/\u003e\\nTermState... (I generally don\'t like mock returns that hide\\/lose\u003cbr\\/\u003e\\ninformation...) but then it\'s convenient to always have something\u003cbr\\/\u003e\\nto hold the docFreq for the term to avoid lots of special cased\u003cbr\\/\u003e\\ncode... so I think it\'s OK?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we can get rid of it entirely. We can use TermStateBase for it and let PrefixCodedTermState just add the pointer though. That way we get rid of it nicely. I would like to keep that api as it is since it makes the usage easier especially in the rewrite methods..\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWe lost the \\\"clone using new\\\" in StandardTermState...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI don\'t get that really - IMO this is quite minor but I will look into it again... \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eMaybe revert changes to AppendingCodec? (Ie let it pass its terms\u003cbr\\/\u003e\\ndict cache size again)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eunintentional - will fix \u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\\n\u003cp\u003e wonder if we can somehow make PerReaderTermState use an array\u003cbr\\/\u003e\\n(keyed by sub reader index) instead... seems like a new HashMap\u003cbr\\/\u003e\\nper Term in an MTQ could be heavy. It\'s tricky because we don\'t\u003cbr\\/\u003e\\nstore enough information (ie to quickly map parent reader + sub\u003cbr\\/\u003e\\nreader -&gt; sub index). But I don\'t think this should hold up\u003cbr\\/\u003e\\ncommitting... since our defaults don\'t typically allow for that\u003cbr\\/\u003e\\nmany terms in-flight it should be fine...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI actually had this in a very similar way. I used a custom linked list and relied on the fact that the incoming reader are applied in the same order and skipped until the next reader with that term appeared. I changed that back to Map impl to make it simpler since I didn\'t see speedups - well this was caused by a very nifty coding error \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/biggrin.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003ei think I have that patch around somewhere is the history... lets see..\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think the TQ ctor that takes both docFreq and states can drop the docFreq? Ie it can ask the states for it?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eyeah sure - well the patch is my current state since I had to drop everything and leave on friday... I clean up an upload a new patch early this week\u003c\\/p\u003e\\n\\n\u003cp\u003e@Uwe: I will incorporate your fix - thanks\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973003_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973003_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 15:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T15:46:54+0000\'\u003e19\\/Dec\\/10 15:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think we should remove TermsEnum.docFreq and .ord? Ie replace \\nwith .termState().docFreq() and .ord()?  \\n\\n I disagree on that - at least docFreq() is an essential part of the API and we should not force TermState creation just to get the df. Yet, TermState is an expert API you should not need to pull an expert API to get something essential like df. \\nI would leave those as they are or only pull ord into TermState. \\n\\n \\n Maybe rename TermStateBase -&gt; PrefixCodedTermState? Ie this is \\nreally the TermState impl used by any codec using \\nPrefixCodedTerms? EG the fact that it stores the filePointer into \\na _X.tis file is particular to it..  \\n Yeah that sounds reasonable. \\n\\n \\n Maybe rename MockTermState -&gt; BasicTermState? At first I was \\nthinking the codec should return null if it cannot seek by \\nTermState... (I generally don\'t like mock returns that hide\\/lose \\ninformation...) but then it\'s convenient to always have something \\nto hold the docFreq for the term to avoid lots of special cased \\ncode... so I think it\'s OK?  \\n\\n I think we can get rid of it entirely. We can use TermStateBase for it and let PrefixCodedTermState just add the pointer though. That way we get rid of it nicely. I would like to keep that api as it is since it makes the usage easier especially in the rewrite methods.. \\n\\n  We lost the \\\"clone using new\\\" in StandardTermState...  \\n I don\'t get that really - IMO this is quite minor but I will look into it again...  \\n\\n \\n Maybe revert changes to AppendingCodec? (Ie let it pass its terms \\ndict cache size again)  \\n\\n unintentional - will fix  \\n\\n\\n \\n  wonder if we can somehow make PerReaderTermState use an array \\n(keyed by sub reader index) instead... seems like a new HashMap \\nper Term in an MTQ could be heavy. It\'s tricky because we don\'t \\nstore enough information (ie to quickly map parent reader + sub \\nreader -&gt; sub index). But I don\'t think this should hold up \\ncommitting... since our defaults don\'t typically allow for that \\nmany terms in-flight it should be fine...  \\n\\n I actually had this in a very similar way. I used a custom linked list and relied on the fact that the incoming reader are applied in the same order and skipped until the next reader with that term appeared. I changed that back to Map impl to make it simpler since I didn\'t see speedups - well this was caused by a very nifty coding error    \\n\\n i think I have that patch around somewhere is the history... lets see.. \\n\\n  I think the TQ ctor that takes both docFreq and states can drop the docFreq? Ie it can ask the states for it?  \\n\\n yeah sure - well the patch is my current state since I had to drop everything and leave on friday... I clean up an upload a new patch early this week \\n\\n @Uwe: I will incorporate your fix - thanks \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973018\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973018&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973018\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12973018_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973018_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 16:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T16:57:22+0000\'\u003e19\\/Dec\\/10 16:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI would leave those as they are or only pull ord into TermState.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree about docfreq, but ord should go. Ord should be in e.g. StandardTermState, but not in TermState nor TermsEnum.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is an implementation detail for our current terms dictionary, and its silly how we just throw UOE for other codecs:\u003cbr\\/\u003e\\nIts codec-specific. Other terms implementations might have \\\"something like an ord\\\" but it definitely might not even be a long!\u003c\\/p\u003e\\n\\n\u003cp\u003eWithin StandardCodec etc this creates no problem as it still has access to it. If we find ourselves wanting\\/needing to use ord\u003cbr\\/\u003e\\noutside of Standard we should ask ourselves why this is and instead fix the APIs to not depend on some codec-specific long value.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12973018_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973018_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 16:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T16:57:22+0000\'\u003e19\\/Dec\\/10 16:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I would leave those as they are or only pull ord into TermState.  \\n\\n I agree about docfreq, but ord should go. Ord should be in e.g. StandardTermState, but not in TermState nor TermsEnum. \\n\\n This is an implementation detail for our current terms dictionary, and its silly how we just throw UOE for other codecs: \\nIts codec-specific. Other terms implementations might have \\\"something like an ord\\\" but it definitely might not even be a long! \\n\\n Within StandardCodec etc this creates no problem as it still has access to it. If we find ourselves wanting\\/needing to use ord \\noutside of Standard we should ask ourselves why this is and instead fix the APIs to not depend on some codec-specific long value.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973031\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973031&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973031\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973031_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973031_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 18:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T18:38:56+0000\'\u003e19\\/Dec\\/10 18:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere are some numbers for the latest patch with 10M wiki index (commitpoint: delmulti) and all MTQ rewriting to ScoreBoolean:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e               Query    QPS base    QPS spec  Pct diff\\n    +nebraska +state       42.96       42.17     -1.8%\\n          unit state        3.63        3.61     -0.4%\\n        \u003cspan class=\\\"code-quote\\\"\u003e\\\"unit state\\\"\u003c\\/span\u003e        1.72        1.71     -0.3%\\n               state       10.55       10.54     -0.1%\\nspanNear([unit, state], 10, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e)        0.96        0.96      0.1%\\n        +unit +state        4.03        4.04      0.2%\\n  spanFirst(unit, 5)        4.83        4.86      0.7%\\n          united~1.0        4.76        4.86      2.1%\\n            unit~1.0        2.62        2.69      2.7%\\n          united~2.0        0.82        0.84      2.8%\\n            unit~2.0        0.34        0.37      8.2%\\n                un*d        3.55        4.14     16.6%\\n                uni*        0.52        0.61     18.1%\\n                 u*d        0.47        0.57     19.9%\\n               unit*        2.04        2.52     23.8%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973031_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973031_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 18:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T18:38:56+0000\'\u003e19\\/Dec\\/10 18:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here are some numbers for the latest patch with 10M wiki index (commitpoint: delmulti) and all MTQ rewriting to ScoreBoolean: \\n\\n  \\n                Query    QPS base    QPS spec  Pct diff\\n    +nebraska +state       42.96       42.17     -1.8%\\n          unit state        3.63        3.61     -0.4%\\n         \\\"unit state\\\"         1.72        1.71     -0.3%\\n               state       10.55       10.54     -0.1%\\nspanNear([unit, state], 10,  true )        0.96        0.96      0.1%\\n        +unit +state        4.03        4.04      0.2%\\n  spanFirst(unit, 5)        4.83        4.86      0.7%\\n          united~1.0        4.76        4.86      2.1%\\n            unit~1.0        2.62        2.69      2.7%\\n          united~2.0        0.82        0.84      2.8%\\n            unit~2.0        0.34        0.37      8.2%\\n                un*d        3.55        4.14     16.6%\\n                uni*        0.52        0.61     18.1%\\n                 u*d        0.47        0.57     19.9%\\n               unit*        2.04        2.52     23.8%\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973046\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973046&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973046\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973046_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973046_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 22:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T22:19:41+0000\'\u003e19\\/Dec\\/10 22:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI disagree on that - at least docFreq() is an essential part of the API and we should not force TermState creation just to get the df. Yet, TermState is an expert API you should not need to pull an expert API to get something essential like df.\u003cbr\\/\u003e\\nI would leave those as they are or only pull ord into TermState.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK I agree, let\'s leave at least dF directly in TermsEnum.\u003c\\/p\u003e\\n\\n\u003cp\u003eCalling .termState presumably entails a clone right?  Ie the returned object is guaranteed private?  So that\'s a good reason not to require it...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI actually had this in a very similar way. I used a custom linked list and relied on the fact that the incoming reader are applied in the same order and skipped until the next reader with that term appeared. I changed that back to Map impl to make it simpler since I didn\'t see speedups - well this was caused by a very nifty coding error \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eLet\'s just stick w\\/ map for now I think?  Progress not perfection!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973046_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973046_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/10 22:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-19T22:19:41+0000\'\u003e19\\/Dec\\/10 22:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I disagree on that - at least docFreq() is an essential part of the API and we should not force TermState creation just to get the df. Yet, TermState is an expert API you should not need to pull an expert API to get something essential like df. \\nI would leave those as they are or only pull ord into TermState.  \\n\\n OK I agree, let\'s leave at least dF directly in TermsEnum. \\n\\n Calling .termState presumably entails a clone right?  Ie the returned object is guaranteed private?  So that\'s a good reason not to require it... \\n\\n \\n I actually had this in a very similar way. I used a custom linked list and relied on the fact that the incoming reader are applied in the same order and skipped until the next reader with that term appeared. I changed that back to Map impl to make it simpler since I didn\'t see speedups - well this was caused by a very nifty coding error   \\n\\n Let\'s just stick w\\/ map for now I think?  Progress not perfection!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973226\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973226&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973226\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973226_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973226_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/10 15:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-20T15:25:59+0000\'\u003e20\\/Dec\\/10 15:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere is a new patch with a slightly different implementation of PerReaderTermState. I build a view from the subreader used to build the MTQ which is shared across all PerReaderTermState instance for the query. The PrTS then uses only the ordinal from the ReaderView to reference a TermState which prevents us from creating Map instances for each term. In turn this also made it possible to fall back to re-seeking the TermDict if the reader is not in the view. \u003c\\/p\u003e\\n\\n\u003cp\u003eI fixed all other issues and all tests including the highlighter pass now.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973226_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973226_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/10 15:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-20T15:25:59+0000\'\u003e20\\/Dec\\/10 15:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here is a new patch with a slightly different implementation of PerReaderTermState. I build a view from the subreader used to build the MTQ which is shared across all PerReaderTermState instance for the query. The PrTS then uses only the ordinal from the ReaderView to reference a TermState which prevents us from creating Map instances for each term. In turn this also made it possible to fall back to re-seeking the TermDict if the reader is not in the view.  \\n\\n I fixed all other issues and all tests including the highlighter pass now. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973295\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973295&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973295\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973295_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973295_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/10 18:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-20T18:46:03+0000\'\u003e20\\/Dec\\/10 18:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003emike - do you mind if I take this?\u003c\\/p\u003e\\n\\n\u003cp\u003esimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973295_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973295_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/10 18:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-20T18:46:03+0000\'\u003e20\\/Dec\\/10 18:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    mike - do you mind if I take this? \\n\\n simon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973589\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973589&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973589\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973589_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973589_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 11:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T11:43:23+0000\'\u003e21\\/Dec\\/10 11:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003emike - do you mind if I take this?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOf course not!  Please take it \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973589_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973589_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 11:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T11:43:23+0000\'\u003e21\\/Dec\\/10 11:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     mike - do you mind if I take this?  \\n\\n Of course not!  Please take it                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973591\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973591&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973591\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973591_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973591_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 11:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T11:44:04+0000\'\u003e21\\/Dec\\/10 11:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch looks awesome!\u003c\\/p\u003e\\n\\n\u003cp\u003eReally, ord() support is a function of the terms dict impl, not the\u003cbr\\/\u003e\\ncodec (well, indirectly codec has ord() support if its terms dict impl\u003cbr\\/\u003e\\ndoes).  PrefixCodedTermsDict, in turn, supports ord() only if its\u003cbr\\/\u003e\\nterms index does.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan we move TermStateBase (now under codecs.standard) up into codecs\u003cbr\\/\u003e\\nand rename it to PrefixCodedTermState?  Ie, it\'s awkward that\u003cbr\\/\u003e\\nPrefixCodedTermsReader (a terms dict impl shared across many codecs)\u003cbr\\/\u003e\\nis reaching into standard codec to get its TermState impl.  Then, the\u003cbr\\/\u003e\\nprivate static class in StandardPostingsReader can be renamed to\u003cbr\\/\u003e\\nStandardTermState?\u003c\\/p\u003e\\n\\n\u003cp\u003eI like this new ReaderView!  I think it can be more generally useful\u003cbr\\/\u003e\\noutside of PerReaderTermState, eg Filter\\/Collector could receive this\u003cbr\\/\u003e\\nso that they can map sub reader to context in parent.  But let\'s leave\u003cbr\\/\u003e\\nthat for another day.\u003c\\/p\u003e\\n\\n\u003cp\u003eStill some small whitespace issues, eg if(\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973591_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973591_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 11:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T11:44:04+0000\'\u003e21\\/Dec\\/10 11:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch looks awesome! \\n\\n Really, ord() support is a function of the terms dict impl, not the \\ncodec (well, indirectly codec has ord() support if its terms dict impl \\ndoes).  PrefixCodedTermsDict, in turn, supports ord() only if its \\nterms index does. \\n\\n Can we move TermStateBase (now under codecs.standard) up into codecs \\nand rename it to PrefixCodedTermState?  Ie, it\'s awkward that \\nPrefixCodedTermsReader (a terms dict impl shared across many codecs) \\nis reaching into standard codec to get its TermState impl.  Then, the \\nprivate static class in StandardPostingsReader can be renamed to \\nStandardTermState? \\n\\n I like this new ReaderView!  I think it can be more generally useful \\noutside of PerReaderTermState, eg Filter\\/Collector could receive this \\nso that they can map sub reader to context in parent.  But let\'s leave \\nthat for another day. \\n\\n Still some small whitespace issues, eg if(              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973592\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973592&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973592\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973592_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973592_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 11:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T11:46:43+0000\'\u003e21\\/Dec\\/10 11:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I tested perf on 10 M wiki index, multi-segment no deletes.  For the test I \u003cspan class=\\\"error\\\"\u003e&#91;unnaturally&#93;\u003c\\/span\u003e forced Prefix &amp; Wildcard queries to always use scoring BQ rewrite (and upped the BQ max clause count way high) to force testing of TermState.\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eQuery\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eQPS mmap\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eQPS mmap\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003ePct diff\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"unit state\\\"~3\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e5.29\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.96\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-6.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit state\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.70\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.21\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-4.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"unit state\\\"\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e7.80\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e7.71\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-1.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003espanNear(\u003cspan class=\\\"error\\\"\u003e&#91;unit, state&#93;\u003c\\/span\u003e, 10, true)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.58\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.53\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-1.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003estate\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e29.42\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e29.39\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-0.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit~2.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e9.90\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e9.91\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003edoctimesecnum:\u003cspan class=\\\"error\\\"\u003e&#91;10000 TO 60000&#93;\u003c\\/span\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e9.52\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e9.55\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+unit +state\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.04\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.09\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit~1.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10.11\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10.19\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited~2.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e3.34\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e3.36\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003espanFirst(unit, 5)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e16.71\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e16.93\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+nebraska +state\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e195.03\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e198.25\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited~1.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e15.78\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e16.11\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.1%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eun*d\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e12.59\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e29.45\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e133.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e6.87\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e16.54\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e140.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eu*d\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e2.39\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e6.66\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e178.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003euni*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1.82\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e5.29\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e190.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eAwesome speedups!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973592_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973592_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 11:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T11:46:43+0000\'\u003e21\\/Dec\\/10 11:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I tested perf on 10 M wiki index, multi-segment no deletes.  For the test I  &#91;unnaturally&#93;  forced Prefix &amp; Wildcard queries to always use scoring BQ rewrite (and upped the BQ max clause count way high) to force testing of TermState. \\n\\n \\n  \\n \\n Query \\n QPS mmap \\n QPS mmap \\n Pct diff \\n \\n \\n \\\"unit state\\\"~3 \\n 5.29 \\n 4.96 \\n  -6.3%  \\n \\n \\n unit state \\n 11.70 \\n 11.21 \\n  -4.2%  \\n \\n \\n \\\"unit state\\\" \\n 7.80 \\n 7.71 \\n  -1.2%  \\n \\n \\n spanNear( &#91;unit, state&#93; , 10, true) \\n 4.58 \\n 4.53 \\n  -1.1%  \\n \\n \\n state \\n 29.42 \\n 29.39 \\n  -0.1%  \\n \\n \\n unit~2.0 \\n 9.90 \\n 9.91 \\n  0.2%  \\n \\n \\n doctimesecnum: &#91;10000 TO 60000&#93;  \\n 9.52 \\n 9.55 \\n  0.3%  \\n \\n \\n +unit +state \\n 11.04 \\n 11.09 \\n  0.4%  \\n \\n \\n unit~1.0 \\n 10.11 \\n 10.19 \\n  0.7%  \\n \\n \\n united~2.0 \\n 3.34 \\n 3.36 \\n  0.8%  \\n \\n \\n spanFirst(unit, 5) \\n 16.71 \\n 16.93 \\n  1.3%  \\n \\n \\n +nebraska +state \\n 195.03 \\n 198.25 \\n  1.7%  \\n \\n \\n united~1.0 \\n 15.78 \\n 16.11 \\n  2.1%  \\n \\n \\n un*d \\n 12.59 \\n 29.45 \\n  133.9%  \\n \\n \\n unit* \\n 6.87 \\n 16.54 \\n  140.7%  \\n \\n \\n u*d \\n 2.39 \\n 6.66 \\n  178.2%  \\n \\n \\n uni* \\n 1.82 \\n 5.29 \\n  190.6%  \\n \\n  \\n \\n\\n\\n Awesome speedups!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973703\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973703&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973703\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973703_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973703_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T15:33:13+0000\'\u003e21\\/Dec\\/10 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eCan we move TermStateBase (now under codecs.standard) up into codecs\u003cbr\\/\u003e\\nand rename it to PrefixCodedTermState? Ie, it\'s awkward that\u003cbr\\/\u003e\\nPrefixCodedTermsReader (a terms dict impl shared across many codecs)\u003cbr\\/\u003e\\nis reaching into standard codec to get its TermState impl. Then, the\u003cbr\\/\u003e\\nprivate static class in StandardPostingsReader can be renamed to\u003cbr\\/\u003e\\nStandardTermState?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003edone - that makes sense \u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eStill some small whitespace issues, eg if(\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003edone\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we are close \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12973703_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973703_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T15:33:13+0000\'\u003e21\\/Dec\\/10 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Can we move TermStateBase (now under codecs.standard) up into codecs \\nand rename it to PrefixCodedTermState? Ie, it\'s awkward that \\nPrefixCodedTermsReader (a terms dict impl shared across many codecs) \\nis reaching into standard codec to get its TermState impl. Then, the \\nprivate static class in StandardPostingsReader can be renamed to \\nStandardTermState?  \\n done - that makes sense  \\n\\n\\n  Still some small whitespace issues, eg if(  \\n done \\n\\n I think we are close               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12973895\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12973895&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12973895\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973895_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973895_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T21:25:31+0000\'\u003e21\\/Dec\\/10 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think instead of ReaderView we could change Weight.scorer API so that instead of receiving IndexReader reader, it receives a struct that has parent reader, sub reader, ord of that sub?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s easy to be back compat because we could just forward to prior scorer method with only the sub?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12973895_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12973895_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Dec\\/10 21:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-21T21:25:31+0000\'\u003e21\\/Dec\\/10 21:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think instead of ReaderView we could change Weight.scorer API so that instead of receiving IndexReader reader, it receives a struct that has parent reader, sub reader, ord of that sub? \\n\\n It\'s easy to be back compat because we could just forward to prior scorer method with only the sub?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12974121\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12974121&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12974121\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12974121_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12974121_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/10 09:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-22T09:28:34+0000\'\u003e22\\/Dec\\/10 09:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think instead of ReaderView we could change Weight.scorer API so that instead of receiving IndexReader reader, it receives a struct that has parent reader, sub reader, ord of that sub?\u003cbr\\/\u003e\\nIt\'s easy to be back compat because we could just forward to prior scorer method with only the sub?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eMike I am not sure if that helps us here. If you use this method you can not disambiguate between the set of readers that where used to create the PerReaderTermState and the once that have a certain ord assigned to it. Disambiguation would be more difficult if we do that. IMO sharing a ReaderView seems to be the best solution so far. I don\'t think we should bind it to an IR directly since users can easily build a ReaderView from a Composite Reader. Yet, for searching it would be nice to have a ReaderView on Seacher \\/ IndexSearcher which can be triggered upon weight creation.\u003cbr\\/\u003e\\nThat way we can also disambiguate between PerReaderTermState given to the TermQuery ctor when we create the weight so that if the view doesn\' t match we either create a new PerReaderTermState or just don\'t use it for this weight.\u003c\\/p\u003e\\n\\n\u003cp\u003eI thought about TermsEnum#ord() again. I don\' t think we should really add it back though. Its really an implementation detail and folks that wanna use it should be aware of that and cast correctly. On the other hand I don\'t like to have the seek(ord) in TermsEnum either if we remove #ord(). I think we should remove it from the interface entirely though.\u003c\\/p\u003e\\n\\n\u003cp\u003esimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12974121_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12974121_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/10 09:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-22T09:28:34+0000\'\u003e22\\/Dec\\/10 09:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think instead of ReaderView we could change Weight.scorer API so that instead of receiving IndexReader reader, it receives a struct that has parent reader, sub reader, ord of that sub? \\nIt\'s easy to be back compat because we could just forward to prior scorer method with only the sub?  \\n Mike I am not sure if that helps us here. If you use this method you can not disambiguate between the set of readers that where used to create the PerReaderTermState and the once that have a certain ord assigned to it. Disambiguation would be more difficult if we do that. IMO sharing a ReaderView seems to be the best solution so far. I don\'t think we should bind it to an IR directly since users can easily build a ReaderView from a Composite Reader. Yet, for searching it would be nice to have a ReaderView on Seacher \\/ IndexSearcher which can be triggered upon weight creation. \\nThat way we can also disambiguate between PerReaderTermState given to the TermQuery ctor when we create the weight so that if the view doesn\' t match we either create a new PerReaderTermState or just don\'t use it for this weight. \\n\\n I thought about TermsEnum#ord() again. I don\' t think we should really add it back though. Its really an implementation detail and folks that wanna use it should be aware of that and cast correctly. On the other hand I don\'t like to have the seek(ord) in TermsEnum either if we remove #ord(). I think we should remove it from the interface entirely though. \\n\\n simon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12974251\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12974251&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12974251\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12974251_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12974251_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/10 15:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-22T15:53:55+0000\'\u003e22\\/Dec\\/10 15:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think instead of ReaderView we could change Weight.scorer API so that instead of receiving IndexReader reader, it receives a struct that has parent reader, sub reader, ord of that sub?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eso I changed the Weight#scorer API to use a class called ScoreContext that holds the parent reader, the current sub and the subs ord. That change is absolutely massive! I don\'t upload that change since I think if we do that we need to do it in a different issue anyway. I ran into a couple of problems:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eif we pass in such a context we also need to change the explain interface since its calling Weight#scorer here and there\u003c\\/li\u003e\\n\\t\u003cli\u003eOnce we pass in the Context stuff like QueryWrapperFilter doesn\'t work anymore since it doesn\'t know which ord the incoming reader has. So Filters would need a context too. I don\'t like that!\u003c\\/li\u003e\\n\\t\u003cli\u003eStuff like scoreDocsInOrder are hard to put into such a context since almost all scorers internally are called with scoreDocsInOrder=true with a contant. meaning that nobody really respects the incoming value for subscorers though. but if i just forward the context the member needs to be set to true or the context needs to be cloned for subs - see BooleanQuery for instance.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003esuch a context would somehow enforce that MTQ are only executed against the Reader they where rewritten against. Which is how it should be IMO but we are also depending on that everybody who uses a MTQ knows exactly how the query was rewritten which is kind of not obvious. I think we need a better way to enforce stuff like that.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eafter all I think this must be done in a different issue though. This issue was meant to make MTQ single pass so lets do that first.... progress over perfection ey mike \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e. \u003cbr\\/\u003e\\nNonetheless, it seems like that we need to rethink the Weight API entirely I also don\'t like that Weight operates on Searcher instead of IndexSearcher though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12974251_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12974251_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/10 15:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-22T15:53:55+0000\'\u003e22\\/Dec\\/10 15:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think instead of ReaderView we could change Weight.scorer API so that instead of receiving IndexReader reader, it receives a struct that has parent reader, sub reader, ord of that sub?  \\n\\n so I changed the Weight#scorer API to use a class called ScoreContext that holds the parent reader, the current sub and the subs ord. That change is absolutely massive! I don\'t upload that change since I think if we do that we need to do it in a different issue anyway. I ran into a couple of problems: \\n\\n \\n\\t if we pass in such a context we also need to change the explain interface since its calling Weight#scorer here and there \\n\\t Once we pass in the Context stuff like QueryWrapperFilter doesn\'t work anymore since it doesn\'t know which ord the incoming reader has. So Filters would need a context too. I don\'t like that! \\n\\t Stuff like scoreDocsInOrder are hard to put into such a context since almost all scorers internally are called with scoreDocsInOrder=true with a contant. meaning that nobody really respects the incoming value for subscorers though. but if i just forward the context the member needs to be set to true or the context needs to be cloned for subs - see BooleanQuery for instance. \\n \\n\\n\\n \\n\\t such a context would somehow enforce that MTQ are only executed against the Reader they where rewritten against. Which is how it should be IMO but we are also depending on that everybody who uses a MTQ knows exactly how the query was rewritten which is kind of not obvious. I think we need a better way to enforce stuff like that. \\n \\n\\n\\n after all I think this must be done in a different issue though. This issue was meant to make MTQ single pass so lets do that first.... progress over perfection ey mike  .  \\nNonetheless, it seems like that we need to rethink the Weight API entirely I also don\'t like that Weight operates on Searcher instead of IndexSearcher though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12974265\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12974265&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12974265\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12974265_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12974265_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/10 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-22T16:32:48+0000\'\u003e22\\/Dec\\/10 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eafter all I think this must be done in a different issue though\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cp\u003eIf, when we now pass a naked IndexReader (eg to Weight.scorer, Weight.explain, Filter.getDocIdSet) we replace that with a ReaderContext which has reader, its parent, and its ord, then this precursor makes both TermState (this issue) and the awesome PK speedup (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2829\\\" title=\\\"improve termquery &quot;pk lookup&quot; performance\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2829\\\"\u003e\u003cdel\u003eLUCENE-2829\u003c\\/del\u003e\u003c\\/a\u003e) much simpler.  And I agree we should break it out as its own issue.  It\'s good to do that as its own issue since that\'s a rote API cutover &#8211; we are passing a struct instead of a naked reader, but otherwise no change.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis also lets us solve cases where the Filter needs the full context, eg \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2348\\\" title=\\\"DuplicateFilter incorrectly handles multiple calls to getDocIdSet for segment readers\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2348\\\"\u003eLUCENE-2348\u003c\\/a\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, with this I think we should sharpen in the jdocs that when you call Query.rewrite the returned query must be searched only against he same reader you rewrote against.  Similarly when you create a Weight, it should only be used against the same Searcher used to create it from a Query.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12974265_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12974265_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/10 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-12-22T16:32:48+0000\'\u003e22\\/Dec\\/10 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     after all I think this must be done in a different issue though  \\n\\n +1 \\n\\n If, when we now pass a naked IndexReader (eg to Weight.scorer, Weight.explain, Filter.getDocIdSet) we replace that with a ReaderContext which has reader, its parent, and its ord, then this precursor makes both TermState (this issue) and the awesome PK speedup (  LUCENE-2829  ) much simpler.  And I agree we should break it out as its own issue.  It\'s good to do that as its own issue since that\'s a rote API cutover &#8211; we are passing a struct instead of a naked reader, but otherwise no change. \\n\\n This also lets us solve cases where the Filter needs the full context, eg  LUCENE-2348 . \\n\\n Also, with this I think we should sharpen in the jdocs that when you call Query.rewrite the returned query must be searched only against he same reader you rewrote against.  Similarly when you create a Weight, it should only be used against the same Searcher used to create it from a Query.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12979544\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12979544&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12979544\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12979544_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12979544_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/11 11:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-10T11:27:15+0000\'\u003e10\\/Jan\\/11 11:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnother iteration on this after \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2831\\\" title=\\\"Revise Weight#scorer &amp; Filter#getDocIdSet API to pass Readers context\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2831\\\"\u003e\u003cdel\u003eLUCENE-2831\u003c\\/del\u003e\u003c\\/a\u003e was committed last week. \u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eupdated to trunk &amp; all test pass\u003c\\/li\u003e\\n\\t\u003cli\u003ere-added all ord() related stuff back to TermsEnum since I think we should decouple this and solve it in a different issue. There is already enough changes in here and discussions should be focused on making MTQ single pass.\u003c\\/li\u003e\\n\\t\u003cli\u003eChanged IndexSearcher to run concurrent searches on a \\\"leaf slice\\\" rather than on a leaf converted to a Top-Level Context. That made the callables a bit simpler and is more consistent since the hierarchy is preserved.\u003c\\/li\u003e\\n\\t\u003cli\u003eTermState is now referenced by leaf ordinal and asserted using the leaf\'s top-level ctx.\u003c\\/li\u003e\\n\\t\u003cli\u003eTermQuery is not single pass for all queries while state is only hold in Weight unless PerReaderTermState as not set. But even then the top-level ctx must be identical to the given IS\'s top-level ctx otherwise the give PerReaderTermState is not used.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ethis one seems pretty close \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12979544_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12979544_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/11 11:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-10T11:27:15+0000\'\u003e10\\/Jan\\/11 11:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Another iteration on this after   LUCENE-2831   was committed last week.  \\n\\n \\n\\t updated to trunk &amp; all test pass \\n\\t re-added all ord() related stuff back to TermsEnum since I think we should decouple this and solve it in a different issue. There is already enough changes in here and discussions should be focused on making MTQ single pass. \\n\\t Changed IndexSearcher to run concurrent searches on a \\\"leaf slice\\\" rather than on a leaf converted to a Top-Level Context. That made the callables a bit simpler and is more consistent since the hierarchy is preserved. \\n\\t TermState is now referenced by leaf ordinal and asserted using the leaf\'s top-level ctx. \\n\\t TermQuery is not single pass for all queries while state is only hold in Weight unless PerReaderTermState as not set. But even then the top-level ctx must be identical to the given IS\'s top-level ctx otherwise the give PerReaderTermState is not used. \\n \\n\\n\\n this one seems pretty close               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12979562\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12979562&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12979562\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12979562_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12979562_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/11 12:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-10T12:21:58+0000\'\u003e10\\/Jan\\/11 12:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne question, I\'m look at the definition of TermState:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eHolds all state required for {@link TermsEnum} to produce a {@link DocsEnum} without re-seeking the terms dict.\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo why do we have seek(BytesRef, TermState)\u003cbr\\/\u003e\\nshouldnt it just be seek(Termstate) ?\u003cbr\\/\u003e\\nI think its confusing it takes an unnecessary bytes parameter.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12979562_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12979562_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/11 12:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-10T12:21:58+0000\'\u003e10\\/Jan\\/11 12:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One question, I\'m look at the definition of TermState: \\n  \\n Holds all state required for {@link TermsEnum} to produce a {@link DocsEnum} without re-seeking the terms dict.\\n \\n  \\n\\n So why do we have seek(BytesRef, TermState) \\nshouldnt it just be seek(Termstate) ? \\nI think its confusing it takes an unnecessary bytes parameter.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12979576\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12979576&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12979576\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12979576_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12979576_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/11 13:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-10T13:35:07+0000\'\u003e10\\/Jan\\/11 13:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere\'s a hack patch (dont think it actually works) just showing what i mean.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think termsenum should only have seek(TermState).\u003cbr\\/\u003e\\nin the hack-patch, i made the termState() and seekTermState() non-abstract:\u003cbr\\/\u003e\\nthe default impl returns a \'SimpleTermState\' containing the term bytes and saved docFreq and implements seek(TermState) with those bytes.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is basically what the patch had everywhere anyway as an implementation (for many of these, we should use more efficient impls, i fixed this for MemoryIndex as an example, but MultiTermsEnum comes to mind).\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, i don\'t understand what was going on with setting bytes on the DeltaBytesReader with your seek(BytesRef, TermState) before.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf StandardCodec needs to know the shared byte[] prefix or something like that to reposition the enum, then it\u003cbr\\/\u003e\\nshould put this in its termstate.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12979576_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12979576_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/11 13:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-10T13:35:07+0000\'\u003e10\\/Jan\\/11 13:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here\'s a hack patch (dont think it actually works) just showing what i mean. \\n\\n I think termsenum should only have seek(TermState). \\nin the hack-patch, i made the termState() and seekTermState() non-abstract: \\nthe default impl returns a \'SimpleTermState\' containing the term bytes and saved docFreq and implements seek(TermState) with those bytes. \\n\\n This is basically what the patch had everywhere anyway as an implementation (for many of these, we should use more efficient impls, i fixed this for MemoryIndex as an example, but MultiTermsEnum comes to mind). \\n\\n Also, i don\'t understand what was going on with setting bytes on the DeltaBytesReader with your seek(BytesRef, TermState) before. \\n\\n If StandardCodec needs to know the shared byte[] prefix or something like that to reposition the enum, then it \\nshould put this in its termstate. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980065\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980065&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980065\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980065_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980065_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 11:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T11:44:41+0000\'\u003e11\\/Jan\\/11 11:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNext iteration.  I took roberts patch and cleaned up a few things and added a new OrdTermState that can be used for instanceof testing and thoughout all TermsEnum that use ord primarily. I also removed the docFreq() getter from TermState since its really an impl. detail. The downside of this patch is that PrefixCodedTermState is kind of heavyweight now since it carries the BytesRef to re-init the DeltaBytesReader but I didn\'t see another way to fix this right now.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980065_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980065_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 11:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T11:44:41+0000\'\u003e11\\/Jan\\/11 11:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Next iteration.  I took roberts patch and cleaned up a few things and added a new OrdTermState that can be used for instanceof testing and thoughout all TermsEnum that use ord primarily. I also removed the docFreq() getter from TermState since its really an impl. detail. The downside of this patch is that PrefixCodedTermState is kind of heavyweight now since it carries the BytesRef to re-init the DeltaBytesReader but I didn\'t see another way to fix this right now. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980081\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980081&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980081\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12980081_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980081_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 12:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T12:18:39+0000\'\u003e11\\/Jan\\/11 12:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe failure in TestFSTs is because PrefixCodedTermsReader is somehow returning an OrdTermState when its terms index (var gap) does not support ord.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe ord member of PrefixCodedTermState is undefined when the terms dict doesn\'t support ord (ie when ord() throws UOE).\u003c\\/p\u003e\\n\\n\u003cp\u003eSo to fix this we should fix TestFSTs to go back to calling .ord() and catching the UOE, maybe?  Separately, make sure you don\'t overwrite storeOrds in that test.  Ie the test randomly sets it to true or false (so that we test both cases); only if the terms index cannot suppord ord should we wire it to false.  If it can support ord then we should leave it as the random value...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12980081_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980081_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 12:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T12:18:39+0000\'\u003e11\\/Jan\\/11 12:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The failure in TestFSTs is because PrefixCodedTermsReader is somehow returning an OrdTermState when its terms index (var gap) does not support ord. \\n\\n The ord member of PrefixCodedTermState is undefined when the terms dict doesn\'t support ord (ie when ord() throws UOE). \\n\\n So to fix this we should fix TestFSTs to go back to calling .ord() and catching the UOE, maybe?  Separately, make sure you don\'t overwrite storeOrds in that test.  Ie the test randomly sets it to true or false (so that we test both cases); only if the terms index cannot suppord ord should we wire it to false.  If it can support ord then we should leave it as the random value...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980144\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980144&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980144\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980144_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980144_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T15:26:20+0000\'\u003e11\\/Jan\\/11 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003efixed the TestFST - thanks mike for looking into that and updated to trunk\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980144_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980144_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/11 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-11T15:26:20+0000\'\u003e11\\/Jan\\/11 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    fixed the TestFST - thanks mike for looking into that and updated to trunk              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980722\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980722&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980722\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980722_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980722_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T14:07:38+0000\'\u003e12\\/Jan\\/11 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch changes TermsEnum#seek(TermState) back to TermsEnum#seek(BytesRef, TermState). Yet, TermState is opaque now and TermsEnum has a default impl for TermsEnum#seek(BytesRef, TermState). Holding the BytesRef in TermState for our PrefixCoded* based codecs seems way too costly though. seems like this time perf rules out purity in the interface.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980722_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980722_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 14:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T14:07:38+0000\'\u003e12\\/Jan\\/11 14:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch changes TermsEnum#seek(TermState) back to TermsEnum#seek(BytesRef, TermState). Yet, TermState is opaque now and TermsEnum has a default impl for TermsEnum#seek(BytesRef, TermState). Holding the BytesRef in TermState for our PrefixCoded* based codecs seems way too costly though. seems like this time perf rules out purity in the interface.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980748\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980748&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980748\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12980748_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980748_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 15:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T15:22:14+0000\'\u003e12\\/Jan\\/11 15:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eseems like this time perf rules out purity in the interface.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI know i didn\'t like this aspect of the patch, but I am ok with it for now as long as we keep things experimental and try to keep an eye on improving the \'purity\' of TermsEnum a bit.\u003cbr\\/\u003e\\nwe are making a lot of progress on the terms handling with flexible indexing and i could easily see more interesting implementations being available other than just PrefixCoded...\u003cbr\\/\u003e\\nIn some ideal world I guess i\'d prefer if TermsEnum was an attributesource with seek() and next(), FilteredTermsEnum was like tokenFilter, and TermState was just captureState\\/restoreState...\u003cbr\\/\u003e\\nbut I agree we should just lean towards whatever works for now.\u003c\\/p\u003e\\n\\n\u003cp\u003edefinitely like it better now that things such as docFreq() are pulled out of termstate and its completely opaque, i think this is the right way to go.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_12980748_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980748_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 15:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T15:22:14+0000\'\u003e12\\/Jan\\/11 15:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     seems like this time perf rules out purity in the interface.  \\n\\n I know i didn\'t like this aspect of the patch, but I am ok with it for now as long as we keep things experimental and try to keep an eye on improving the \'purity\' of TermsEnum a bit. \\nwe are making a lot of progress on the terms handling with flexible indexing and i could easily see more interesting implementations being available other than just PrefixCoded... \\nIn some ideal world I guess i\'d prefer if TermsEnum was an attributesource with seek() and next(), FilteredTermsEnum was like tokenFilter, and TermState was just captureState\\/restoreState... \\nbut I agree we should just lean towards whatever works for now. \\n\\n definitely like it better now that things such as docFreq() are pulled out of termstate and its completely opaque, i think this is the right way to go.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980778\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980778&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980778\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980778_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980778_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T16:23:35+0000\'\u003e12\\/Jan\\/11 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded Changes.txt entry and fixed the remaining JavaDoc on TermState. \u003c\\/p\u003e\\n\\n\u003cp\u003eMy latest benchmark results with that patch are here:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\\n          unit state        3.81        3.70     -2.9%\\n    +nebraska +state       41.26       40.61     -1.6%\\n        +unit +state        3.95        3.90     -1.1%\\n  spanFirst(unit, 5)        4.55        4.51     -0.9%\\n               state       10.11       10.07     -0.3%\\n      \u003cspan class=\\\"code-quote\\\"\u003e\\\"unit state\\\"\u003c\\/span\u003e~3        0.98        0.98     -0.2%\\n        \u003cspan class=\\\"code-quote\\\"\u003e\\\"unit state\\\"\u003c\\/span\u003e        1.49        1.49     -0.0%\\n          united~1.0        3.66        3.72      1.5%\\n            unit~1.0        2.33        2.37      1.6%\\n          united~2.0        0.81        0.83      2.7%\\n            unit~2.0        0.35        0.38     10.1%\\n                 u*d        0.52        0.67     29.5%\\ndoctitle:.*[Uu]nited.*        0.19        0.25     31.6%\\n                un*d        3.59        4.77     33.0%\\n                uni*        0.56        0.75     34.9%\\n               unit*        2.20        3.15     43.3%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI think we are ready to go - I will commit later today if nobody objects\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980778_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980778_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T16:23:35+0000\'\u003e12\\/Jan\\/11 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added Changes.txt entry and fixed the remaining JavaDoc on TermState.  \\n\\n My latest benchmark results with that patch are here: \\n  \\n \\n          unit state        3.81        3.70     -2.9%\\n    +nebraska +state       41.26       40.61     -1.6%\\n        +unit +state        3.95        3.90     -1.1%\\n  spanFirst(unit, 5)        4.55        4.51     -0.9%\\n               state       10.11       10.07     -0.3%\\n       \\\"unit state\\\" ~3        0.98        0.98     -0.2%\\n         \\\"unit state\\\"         1.49        1.49     -0.0%\\n          united~1.0        3.66        3.72      1.5%\\n            unit~1.0        2.33        2.37      1.6%\\n          united~2.0        0.81        0.83      2.7%\\n            unit~2.0        0.35        0.38     10.1%\\n                 u*d        0.52        0.67     29.5%\\ndoctitle:.*[Uu]nited.*        0.19        0.25     31.6%\\n                un*d        3.59        4.77     33.0%\\n                uni*        0.56        0.75     34.9%\\n               unit*        2.20        3.15     43.3%\\n \\n  \\n\\n I think we are ready to go - I will commit later today if nobody objects              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980805\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980805&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980805\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980805_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980805_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T16:55:45+0000\'\u003e12\\/Jan\\/11 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just figured that PKLookups are actually slower with this patch 164 msec for 1000 lookups (164 us per lookup) vs 144 msec for 1000 lookups (144 us per lookup) on trunk. I will dig!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980805_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980805_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 16:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T16:55:45+0000\'\u003e12\\/Jan\\/11 16:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just figured that PKLookups are actually slower with this patch 164 msec for 1000 lookups (164 us per lookup) vs 144 msec for 1000 lookups (144 us per lookup) on trunk. I will dig!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980921\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980921&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980921\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12980921_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980921_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 20:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T20:53:39+0000\'\u003e12\\/Jan\\/11 20:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eActually I see PK lookups faster &#8211; 23 usec w\\/ patch vs 33 usec w\\/ trunk (per lookup) for 20K lookups.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd good speedups on many-term MTQs when I force BQ rewrite:\u003c\\/p\u003e\\n\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003eQuery\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eQPS base\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003eQPS termstate\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003ePct diff\u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+nebraska +state\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e169.75\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e154.64\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-8.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003edoctitle:.\u003cb\u003e\u003cspan class=\\\"error\\\"\u003e&#91;Uu&#93;\u003c\\/span\u003enited.\u003c\\/b\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.26\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.11\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-3.5%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e+unit +state\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.40\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.09\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-2.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003espanFirst(unit, 5)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e17.38\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e16.93\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-2.6%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003espanNear(\u003cspan class=\\\"error\\\"\u003e&#91;unit, state&#93;\u003c\\/span\u003e, 10, true)\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.37\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.32\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-1.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"unit state\\\"~3\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.94\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.89\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-1.0%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\\\"unit state\\\"\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e8.05\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e8.03\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"red\\\"\u003e-0.2%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003estate\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e26.58\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e26.76\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e0.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit state\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.24\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.46\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e1.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited~2.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e3.87\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e3.98\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e2.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003edoctimesecnum:\u003cspan class=\\\"error\\\"\u003e&#91;10000 TO 60000&#93;\u003c\\/span\u003e\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e8.26\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e8.70\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit~2.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10.04\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10.59\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e5.4%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunited~1.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e16.84\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e18.13\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e7.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit~1.0\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10.09\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e10.99\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e8.9%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eun*d\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e11.96\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e21.63\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e80.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eunit*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e7.60\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e14.23\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e87.3%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eu*d\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e2.22\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e4.17\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e87.8%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003euni*\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e1.83\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e3.53\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e93.7%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003e+1 to commit!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12980921_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980921_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 20:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T20:53:39+0000\'\u003e12\\/Jan\\/11 20:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Actually I see PK lookups faster &#8211; 23 usec w\\/ patch vs 33 usec w\\/ trunk (per lookup) for 20K lookups. \\n\\n And good speedups on many-term MTQs when I force BQ rewrite: \\n\\n\\n \\n  \\n \\n Query \\n QPS base \\n QPS termstate \\n Pct diff \\n \\n \\n +nebraska +state \\n 169.75 \\n 154.64 \\n  -8.9%  \\n \\n \\n doctitle:.  &#91;Uu&#93; nited.  \\n 4.26 \\n 4.11 \\n  -3.5%  \\n \\n \\n +unit +state \\n 11.40 \\n 11.09 \\n  -2.7%  \\n \\n \\n spanFirst(unit, 5) \\n 17.38 \\n 16.93 \\n  -2.6%  \\n \\n \\n spanNear( &#91;unit, state&#93; , 10, true) \\n 4.37 \\n 4.32 \\n  -1.2%  \\n \\n \\n \\\"unit state\\\"~3 \\n 4.94 \\n 4.89 \\n  -1.0%  \\n \\n \\n \\\"unit state\\\" \\n 8.05 \\n 8.03 \\n  -0.2%  \\n \\n \\n state \\n 26.58 \\n 26.76 \\n  0.7%  \\n \\n \\n unit state \\n 11.24 \\n 11.46 \\n  1.9%  \\n \\n \\n united~2.0 \\n 3.87 \\n 3.98 \\n  2.8%  \\n \\n \\n doctimesecnum: &#91;10000 TO 60000&#93;  \\n 8.26 \\n 8.70 \\n  5.3%  \\n \\n \\n unit~2.0 \\n 10.04 \\n 10.59 \\n  5.4%  \\n \\n \\n united~1.0 \\n 16.84 \\n 18.13 \\n  7.7%  \\n \\n \\n unit~1.0 \\n 10.09 \\n 10.99 \\n  8.9%  \\n \\n \\n un*d \\n 11.96 \\n 21.63 \\n  80.8%  \\n \\n \\n unit* \\n 7.60 \\n 14.23 \\n  87.3%  \\n \\n \\n u*d \\n 2.22 \\n 4.17 \\n  87.8%  \\n \\n \\n uni* \\n 1.83 \\n 3.53 \\n  93.7%  \\n \\n  \\n \\n\\n\\n +1 to commit!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980938\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980938&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980938\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980938_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980938_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 21:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T21:32:31+0000\'\u003e12\\/Jan\\/11 21:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is a final patch, I opened up Terms#getThreadTermsEnum() to reuse TermsEnum in PRTE#build().\u003cbr\\/\u003e\\nPRTE#build() now also accepts a boolean if the termlookup should be cached or not which makes sense for common TermQuery.\u003c\\/p\u003e\\n\\n\u003cp\u003eI will commit that shortly - yay!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980938_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980938_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 21:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T21:32:31+0000\'\u003e12\\/Jan\\/11 21:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is a final patch, I opened up Terms#getThreadTermsEnum() to reuse TermsEnum in PRTE#build(). \\nPRTE#build() now also accepts a boolean if the termlookup should be cached or not which makes sense for common TermQuery. \\n\\n I will commit that shortly - yay!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980941\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980941&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980941\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980941_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980941_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T21:34:29+0000\'\u003e12\\/Jan\\/11 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eActually I see PK lookups faster - 23 usec w\\/ patch vs 33 usec w\\/ trunk (per lookup) for 20K lookups.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eso I run that on a 32bit machine which is quite slow in general though. I will further investigate that on 32bit platform vs. 64 bit. Yet, I only used 1k lookups though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980941_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980941_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T21:34:29+0000\'\u003e12\\/Jan\\/11 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Actually I see PK lookups faster - 23 usec w\\/ patch vs 33 usec w\\/ trunk (per lookup) for 20K lookups.  \\n so I run that on a 32bit machine which is quite slow in general though. I will further investigate that on 32bit platform vs. 64 bit. Yet, I only used 1k lookups though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12980947\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2694?focusedCommentId=12980947&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12980947\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980947_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980947_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 21:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T21:40:50+0000\'\u003e12\\/Jan\\/11 21:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted revision 1058328.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_12980947_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12980947_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jan\\/11 21:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-01-12T21:40:50+0000\'\u003e12\\/Jan\\/11 21:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed revision 1058328.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516203195596"> 
    <input type="hidden" title="jira.request.server.time" value="570"> 
    <input type="hidden" title="jira.request.id" value="933x7707365x8"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="10"> 
    <input type="hidden" title="db.reads.time.in.ms" value="41"> 
    <input type="hidden" title="db.conns.time.in.ms" value="51"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 933x7707365x8
	          REQUEST TIMESTAMP : [17/Jan/2018:15:33:15 +0000]
	               REQUEST TIME : 0.5700
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 10

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=26, elapsedTotal=41781771, elapsedMin=606536, elapsedMax=15352406, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=30, elapsedTotal=51122581, elapsedMin=614382, elapsedMax=15448804, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>