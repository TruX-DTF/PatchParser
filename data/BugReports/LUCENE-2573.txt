<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|0fdcbf607aca35d091b106cfcf2dbbd332844a40|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"fb084db08f3210\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-2573"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-2573] Tiered flushing of DWPTs by RAM with low/high water marks - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-2573] Tiered flushing of DWPTs by RAM with low/high water marks - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2573">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-2573" href="/jira/browse/LUCENE-2573" id="key-val" rel="12470358">LUCENE-2573</a></li>
                </ol>
                <h1 id="summary-val">Tiered flushing of DWPTs by RAM with low/high water marks</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-2573"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-2573/LUCENE-2573.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-2573/LUCENE-2573.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-2573/LUCENE-2573.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-2573/LUCENE-2573.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+%22Realtime+Branch%22" title="Realtime Branch Branch for realtime search (searching on RAM buffer)">Realtime Branch</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12470358-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Now that we have DocumentsWriterPerThreads we need to track total consumed RAM across all DWPTs.</p> 
                  <p>A flushing strategy idea that was discussed in <a href="https://issues.apache.org/jira/browse/LUCENE-2324" title="Per thread DocumentsWriters that write their own private segments" class="issue-link" data-issue-key="LUCENE-2324"><del>LUCENE-2324</del></a> was to use a tiered approach: </p> 
                  <ul class="alternate" type="square"> 
                   <li>Flush the first DWPT at a low water mark (e.g. at 90% of allowed RAM)</li> 
                   <li>Flush all DWPTs at a high water mark (e.g. at 110%)</li> 
                   <li>Use linear steps in between high and low watermark: E.g. when 5 DWPTs are used, flush at 90%, 95%, 100%, 105% and 110%.</li> 
                  </ul> 
                  <p>Should we allow the user to configure the low and high water mark values explicitly using total values (e.g. low water mark at 120MB, high water mark at 140MB)? Or shall we keep for simplicity the single setRAMBufferSizeMB() config method and use something like 90% and 110% for the water marks?</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-2573?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-2573?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-2573?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-2573?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12474885" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12474885/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12474885/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12474885/LUCENE-2573.patch" title="Latest  29/Mar/11 14:46 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12474885/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-29T14:46:29.059Z">29/Mar/11 14:46</time>
                   </dd>
                   <dd class="attachment-size">
                    104 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12474404" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12474404/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12474404/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12474404/LUCENE-2573.patch" title=" 23/Mar/11 15:28 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12474404/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-23T15:28:18.790Z">23/Mar/11 15:28</time>
                   </dd>
                   <dd class="attachment-size">
                    85 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12474007" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12474007/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12474007/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12474007/LUCENE-2573.patch" title=" 18/Mar/11 15:36 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12474007/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-18T15:36:40.801Z">18/Mar/11 15:36</time>
                   </dd>
                   <dd class="attachment-size">
                    69 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12473580" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12473580/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12473580/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12473580/LUCENE-2573.patch" title=" 14/Mar/11 15:02 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12473580/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-14T15:02:36.372Z">14/Mar/11 15:02</time>
                   </dd>
                   <dd class="attachment-size">
                    71 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12472932" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12472932/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12472932/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12472932/LUCENE-2573.patch" title=" 08/Mar/11 11:39 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12472932/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-08T11:39:03.234Z">08/Mar/11 11:39</time>
                   </dd>
                   <dd class="attachment-size">
                    61 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12472834" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12472834/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12472834/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12472834/LUCENE-2573.patch" title=" 07/Mar/11 16:51 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12472834/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-03-07T16:51:07.560Z">07/Mar/11 16:51</time>
                   </dd>
                   <dd class="attachment-size">
                    58 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12454055" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454055/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12454055/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454055/LUCENE-2573.patch" title=" 07/Sep/10 23:42 - Jason Rutherglen" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12454055/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-07T23:42:33.366Z">07/Sep/10 23:42</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Jason Rutherglen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12454034" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12454034/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12454034/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12454034/LUCENE-2573.patch" title=" 07/Sep/10 18:09 - Jason Rutherglen" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12454034/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-07T18:09:42.592Z">07/Sep/10 18:09</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Jason Rutherglen
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12453960" data-issue-id="12470358" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12453960/LUCENE-2573.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12453960/LUCENE-2573.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12453960/LUCENE-2573.patch" title=" 06/Sep/10 19:00 - Jason Rutherglen" draggable="true" data-downloadurl="text/x-patch:LUCENE-2573.patch:https://issues.apache.org/jira/secure/attachment/12453960/LUCENE-2573.patch">LUCENE-2573.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2010-09-06T19:00:57.332Z">06/Sep/10 19:00</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Jason Rutherglen
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="blocks">
                   blocks
                  </dt> 
                  <dd id="internal-12470294_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21148&amp;avatarType=issuetype" width="16" height="16" title="Task - A task that needs to be done." alt="Task - A task that needs to be done."> <span title="LUCENE-2571: Indexing performance tests with realtime branch"> <a href="/jira/browse/LUCENE-2571" data-issue-key="LUCENE-2571" class="issue-link link-title resolution">LUCENE-2571</a> <span class="link-summary">Indexing performance tests with realtime branch</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list "> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12459100_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="LUCENE-2324: Per thread DocumentsWriters that write their own private segments"> <a href="/jira/browse/LUCENE-2324" data-issue-key="LUCENE-2324" class="issue-link link-title resolution">LUCENE-2324</a> <span class="link-summary">Per thread DocumentsWriters that write their own private segments</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_simonw" rel="simonw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Simon Willnauer&quot;,&quot;emailAddress&quot;:&quot;simonw@apache.org&quot;,&quot;username&quot;:&quot;simonw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="simonw"></span></span> Simon Willnauer </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_michaelbusch" rel="michaelbusch" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael Busch&quot;,&quot;emailAddress&quot;:&quot;buschmic@gmail.com&quot;,&quot;username&quot;:&quot;michaelbusch&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="michaelbusch"></span></span> Michael Busch </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">1</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">3</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="28/Jul/10 16:38"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2010-07-28T16:38:46+0000">28/Jul/10 16:38</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="14/Apr/11 12:19"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-04-14T12:19:57+0000">14/Apr/11 12:19</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="14/Apr/11 12:19"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-04-14T12:19:57+0000">14/Apr/11 12:19</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2573?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-2573?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12893248\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893248&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893248\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12893248_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893248_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/10 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-28T17:01:09+0000\'\u003e28\\/Jul\\/10 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think just keep it simple?  User sets RAM buffer size, and we compute fixed high\\/low watermarks from there?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12893248_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893248_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/10 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-28T17:01:09+0000\'\u003e28\\/Jul\\/10 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think just keep it simple?  User sets RAM buffer size, and we compute fixed high\\/low watermarks from there?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893256\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893256&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893256\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893256_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893256_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/10 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-28T17:10:01+0000\'\u003e28\\/Jul\\/10 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah I like that better too.  Will implement that approach.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893256_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893256_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/10 17:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-28T17:10:01+0000\'\u003e28\\/Jul\\/10 17:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah I like that better too.  Will implement that approach.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893265\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893265&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893265\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893265_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893265_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/10 17:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-28T17:22:42+0000\'\u003e28\\/Jul\\/10 17:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUsers probably won\'t customize to that level of detail, and RAM usage isn\'t entirely accurate in Java anyways.  Lets keep it as is (ie, setting the ram buffer size).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893265_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893265_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/10 17:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-28T17:22:42+0000\'\u003e28\\/Jul\\/10 17:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Users probably won\'t customize to that level of detail, and RAM usage isn\'t entirely accurate in Java anyways.  Lets keep it as is (ie, setting the ram buffer size).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893683\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893683&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893683\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893683_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893683_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 16:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T16:14:11+0000\'\u003e29\\/Jul\\/10 16:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJason, are you still up for working on a patch for this one?\u003c\\/p\u003e\\n\\n\u003cp\u003eWe should probably get the realtime branch in a healthy state first and run some performance tests before we start working on all the fun stuff.\u003cbr\\/\u003e\\nAlmost there!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893683_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893683_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 16:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T16:14:11+0000\'\u003e29\\/Jul\\/10 16:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Jason, are you still up for working on a patch for this one? \\n\\n We should probably get the realtime branch in a healthy state first and run some performance tests before we start working on all the fun stuff. \\nAlmost there!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893702\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893702&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893702\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893702_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893702_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T17:03:48+0000\'\u003e29\\/Jul\\/10 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMichael, I could, I was working on the terms dictionary, reading\u003cbr\\/\u003e\\npostings etc, so that deletes will operate correctly. It\'d be\u003cbr\\/\u003e\\ngreat to nail down the concurrency of the *BlockPools first \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2575\\\" title=\\\"Concurrent byte and int block implementations\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2575\\\"\u003eLUCENE-2575\u003c\\/a\u003e, as\u003cbr\\/\u003e\\nso much uses them, then test performance etc, otherwise we\'ll\u003cbr\\/\u003e\\nhave a lot of code relying on something that could be changing?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893702_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893702_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 17:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T17:03:48+0000\'\u003e29\\/Jul\\/10 17:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Michael, I could, I was working on the terms dictionary, reading \\npostings etc, so that deletes will operate correctly. It\'d be \\ngreat to nail down the concurrency of the *BlockPools first  LUCENE-2575 , as \\nso much uses them, then test performance etc, otherwise we\'ll \\nhave a lot of code relying on something that could be changing?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893707\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893707&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893707\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893707_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893707_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 17:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T17:13:51+0000\'\u003e29\\/Jul\\/10 17:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSo yeah I\'ll work on a patch for this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893707_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893707_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 17:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T17:13:51+0000\'\u003e29\\/Jul\\/10 17:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    So yeah I\'ll work on a patch for this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893757\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893757&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893757\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893757_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893757_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 18:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T18:29:40+0000\'\u003e29\\/Jul\\/10 18:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMichael, DWPT.numBytesUsed isn\'t currently being updated?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893757_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893757_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 18:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T18:29:40+0000\'\u003e29\\/Jul\\/10 18:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Michael, DWPT.numBytesUsed isn\'t currently being updated?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893789\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893789&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893789\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893789_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893789_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 19:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T19:28:56+0000\'\u003e29\\/Jul\\/10 19:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMichael, DWPT.numBytesUsed isn\'t currently being updated? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou can delete that one.  I factored all the memory allocation\\/tracking into DocumentsWriterRAMAllocator.  You might have to get some memory related stuff from trunk, e.g. the balanceRAM() code and adapt it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893789_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893789_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Jul\\/10 19:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-29T19:28:56+0000\'\u003e29\\/Jul\\/10 19:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Michael, DWPT.numBytesUsed isn\'t currently being updated?   \\n\\n You can delete that one.  I factored all the memory allocation\\/tracking into DocumentsWriterRAMAllocator.  You might have to get some memory related stuff from trunk, e.g. the balanceRAM() code and adapt it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893891\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893891&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893891\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893891_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893891_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/10 01:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-30T01:17:43+0000\'\u003e30\\/Jul\\/10 01:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIs DocumentsWriterRAMAllocator.numBytesUsed accurate then?  It seems like some things are being recorded into it, however I\'m not immediately sure everything is...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12893891_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893891_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/10 01:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-30T01:17:43+0000\'\u003e30\\/Jul\\/10 01:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Is DocumentsWriterRAMAllocator.numBytesUsed accurate then?  It seems like some things are being recorded into it, however I\'m not immediately sure everything is...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12893928\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12893928&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12893928\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893928_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893928_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/10 04:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-30T04:32:42+0000\'\u003e30\\/Jul\\/10 04:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m not 100% sure, I need to review the code to refresh my memory...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12893928_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12893928_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/10 04:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-07-30T04:32:42+0000\'\u003e30\\/Jul\\/10 04:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m not 100% sure, I need to review the code to refresh my memory...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12898675\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12898675&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12898675\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12898675_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12898675_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/10 09:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-08-15T09:52:03+0000\'\u003e15\\/Aug\\/10 09:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Jason, are you still working on the patch here?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_12898675_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12898675_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/10 09:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-08-15T09:52:03+0000\'\u003e15\\/Aug\\/10 09:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Jason, are you still working on the patch here?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12898742\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12898742&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12898742\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12898742_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12898742_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/10 20:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-08-15T20:06:34+0000\'\u003e15\\/Aug\\/10 20:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Jason Rutherglen - 15\\/Aug\\/10 20:07\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMichael, I\'ve been on holiday in Europe for the last 2 weeks.  When I\'m back tomorrow I\'ll resume work on it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12898742_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12898742_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/10 20:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-08-15T20:06:34+0000\'\u003e15\\/Aug\\/10 20:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Jason Rutherglen - 15\\/Aug\\/10 20:07\\\"\u003eedited\u003c\\/span\u003e                   Michael, I\'ve been on holiday in Europe for the last 2 weeks.  When I\'m back tomorrow I\'ll resume work on it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906423\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906423&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906423\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906423_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906423_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 02:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T02:48:01+0000\'\u003e06\\/Sep\\/10 02:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m not sure if after a DWPT is flushing we need to decrement what would effectively be a \\\"projected RAM usage post current DWPT flush completion\\\".  Otherwise we could in many cases, start the flush of most\\/all of the DWPTs.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906423_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906423_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 02:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T02:48:01+0000\'\u003e06\\/Sep\\/10 02:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m not sure if after a DWPT is flushing we need to decrement what would effectively be a \\\"projected RAM usage post current DWPT flush completion\\\".  Otherwise we could in many cases, start the flush of most\\/all of the DWPTs.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906427\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906427&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906427\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906427_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906427_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 03:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T03:45:43+0000\'\u003e06\\/Sep\\/10 03:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt looks like StoredFieldsWriter is reused after flushing a DWPT, however we\'re not resetting isClosed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906427_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906427_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 03:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T03:45:43+0000\'\u003e06\\/Sep\\/10 03:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It looks like StoredFieldsWriter is reused after flushing a DWPT, however we\'re not resetting isClosed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906431\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906431&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906431\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906431_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906431_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 05:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T05:13:14+0000\'\u003e06\\/Sep\\/10 05:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe probably need a test that delays the flush process, otherwise flushing to RAM occurs too fast to proceed to the next tier.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906431_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906431_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 05:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T05:13:14+0000\'\u003e06\\/Sep\\/10 05:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We probably need a test that delays the flush process, otherwise flushing to RAM occurs too fast to proceed to the next tier.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906565\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906565&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906565\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906565_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906565_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:00:57+0000\'\u003e06\\/Sep\\/10 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a first cut...\u003c\\/p\u003e\\n\\n\u003cp\u003eThe TestDWPTFlushByRAM doesn\'t do much at this point.  It adds documents in 2 threads, and prints the RAM usage to stdout.  It more or less shows the tiered flushing working.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t think we\'re tracking all of the RAM usage yet, maybe just the terms?  I need to review.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906565_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906565_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:00:57+0000\'\u003e06\\/Sep\\/10 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s a first cut... \\n\\n The TestDWPTFlushByRAM doesn\'t do much at this point.  It adds documents in 2 threads, and prints the RAM usage to stdout.  It more or less shows the tiered flushing working.   \\n\\n I don\'t think we\'re tracking all of the RAM usage yet, maybe just the terms?  I need to review.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906566\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906566&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906566\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906566_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906566_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:08:17+0000\'\u003e06\\/Sep\\/10 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe DWPT that happens to exceed the first tier, is flushed out.  This was easier to implement than finding the highest RAM consuming DWPT and flushing it, from a different thread.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906566_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906566_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:08:17+0000\'\u003e06\\/Sep\\/10 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The DWPT that happens to exceed the first tier, is flushed out.  This was easier to implement than finding the highest RAM consuming DWPT and flushing it, from a different thread.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906568\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906568&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906568\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906568_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906568_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:21:16+0000\'\u003e06\\/Sep\\/10 19:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI did a search through the code and ByteBlockAllocator.perDocAllocator has no references, it can probably be removed, unless there was some other intention for it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906568_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906568_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:21:16+0000\'\u003e06\\/Sep\\/10 19:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I did a search through the code and ByteBlockAllocator.perDocAllocator has no references, it can probably be removed, unless there was some other intention for it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906573\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906573&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906573\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906573_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906573_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:36:39+0000\'\u003e06\\/Sep\\/10 19:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we can\\/should track the RAM consumption directly in IntBlockPool and ByteBlockPool.  I\'m not sure if we\'re tracking those allocations right now, however if we are or are not, it\'d be clearer to add a getBytesUsed to these pool classes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906573_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906573_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 19:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T19:36:39+0000\'\u003e06\\/Sep\\/10 19:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we can\\/should track the RAM consumption directly in IntBlockPool and ByteBlockPool.  I\'m not sure if we\'re tracking those allocations right now, however if we are or are not, it\'d be clearer to add a getBytesUsed to these pool classes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906580\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906580&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906580\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906580_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906580_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 20:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T20:15:08+0000\'\u003e06\\/Sep\\/10 20:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe last comment is incorrect, DocumentsWriterRAMAllocator does keep track of all allocations of int[] and byte[], and the number of bytes used.  I\'m not sure why the test is reporting zero bytes used after documents have been successfully added.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906580_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906580_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Sep\\/10 20:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-06T20:15:08+0000\'\u003e06\\/Sep\\/10 20:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The last comment is incorrect, DocumentsWriterRAMAllocator does keep track of all allocations of int[] and byte[], and the number of bytes used.  I\'m not sure why the test is reporting zero bytes used after documents have been successfully added.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906626\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906626&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906626\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906626_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906626_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 00:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T00:12:35+0000\'\u003e07\\/Sep\\/10 00:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn DocumentsWriterRAMAllocator, we\'re only recording the addition of more bytes when a new block is created, however because previous blocks may be recycled, it is the recycled blocks that are not being recorded as bytes used.  Should we record all allocated blocks as \\\"in use\\\" ie, count them as bytes used, or wait until they are \\\"in use\\\" again to be counted as consuming RAM?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906626_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906626_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 00:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T00:12:35+0000\'\u003e07\\/Sep\\/10 00:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    In DocumentsWriterRAMAllocator, we\'re only recording the addition of more bytes when a new block is created, however because previous blocks may be recycled, it is the recycled blocks that are not being recorded as bytes used.  Should we record all allocated blocks as \\\"in use\\\" ie, count them as bytes used, or wait until they are \\\"in use\\\" again to be counted as consuming RAM?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906723\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906723&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906723\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12906723_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906723_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 09:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T09:34:13+0000\'\u003e07\\/Sep\\/10 09:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWe probably need a test that delays the flush process, otherwise flushing to RAM occurs too fast to proceed to the next tier.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe can modify MockRAMDir to optionally \\\"take its sweet time\\\" when writing certain files?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI\'m not sure if after a DWPT is flushing we need to decrement what would effectively be a \\\"projected RAM usage post current DWPT flush completion\\\". Otherwise we could in many cases, start the flush of most\\/all of the DWPTs.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut shouldn\'t tiered flushing take care of this?  Ie you only decr RAM consumed when the flush of the DWPT finishes, not before?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThe DWPT that happens to exceed the first tier, is flushed out. This was easier to implement than finding the highest RAM consuming DWPT and flushing it, from a different thread.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm but this won\'t be most efficient, in general?  Ie we could end up creating tiny segments depending on luck-of-the-thread-scheduling?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI did a search through the code and ByteBlockAllocator.perDocAllocator has no references, it can probably be removed, unless there was some other intention for it.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think this makes sense &#8211; each DWPT now immediately flushes to its private doc store files, so there\'s no longer a need to track per-doc pending RAM?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eIn DocumentsWriterRAMAllocator, we\'re only recording the addition of more bytes when a new block is created, however because previous blocks may be recycled, it is the recycled blocks that are not being recorded as bytes used. Should we record all allocated blocks as \\\"in use\\\" ie, count them as bytes used, or wait until they are \\\"in use\\\" again to be counted as consuming RAM?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we have to track both.  If a buffer is not in the pool (ie not free), then it\'s in use and we count that as RAM used, and that counter is used to trigger tiered flushing.  Separately we have to track net allocated, in order to trim the buffers (drop them, so GC can reclaim) when we are over the .setRAMBufferSizeMB.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12906723_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906723_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 09:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T09:34:13+0000\'\u003e07\\/Sep\\/10 09:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     We probably need a test that delays the flush process, otherwise flushing to RAM occurs too fast to proceed to the next tier.  \\n\\n We can modify MockRAMDir to optionally \\\"take its sweet time\\\" when writing certain files? \\n\\n \\n I\'m not sure if after a DWPT is flushing we need to decrement what would effectively be a \\\"projected RAM usage post current DWPT flush completion\\\". Otherwise we could in many cases, start the flush of most\\/all of the DWPTs.  \\n\\n But shouldn\'t tiered flushing take care of this?  Ie you only decr RAM consumed when the flush of the DWPT finishes, not before? \\n\\n  The DWPT that happens to exceed the first tier, is flushed out. This was easier to implement than finding the highest RAM consuming DWPT and flushing it, from a different thread.  \\n\\n Hmm but this won\'t be most efficient, in general?  Ie we could end up creating tiny segments depending on luck-of-the-thread-scheduling? \\n\\n  I did a search through the code and ByteBlockAllocator.perDocAllocator has no references, it can probably be removed, unless there was some other intention for it.  \\n\\n I think this makes sense &#8211; each DWPT now immediately flushes to its private doc store files, so there\'s no longer a need to track per-doc pending RAM? \\n\\n \\n In DocumentsWriterRAMAllocator, we\'re only recording the addition of more bytes when a new block is created, however because previous blocks may be recycled, it is the recycled blocks that are not being recorded as bytes used. Should we record all allocated blocks as \\\"in use\\\" ie, count them as bytes used, or wait until they are \\\"in use\\\" again to be counted as consuming RAM?  \\n\\n I think we have to track both.  If a buffer is not in the pool (ie not free), then it\'s in use and we count that as RAM used, and that counter is used to trigger tiered flushing.  Separately we have to track net allocated, in order to trim the buffers (drop them, so GC can reclaim) when we are over the .setRAMBufferSizeMB.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906798\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906798&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906798\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906798_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906798_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T13:46:51+0000\'\u003e07\\/Sep\\/10 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eshouldn\'t tiered flushing take care of this\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eFaulty thinking for a few minutes.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ebut this won\'t be most efficient, in general? Ie we could end up creating tiny segments depending on luck-of-the-thread-scheduling?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eTrue.  Instead, we may want to simply not-flush the current DWPT if it is in fact not the highest RAM user.  When addDoc is called on the thread with the highest RAM usage, we can then flush it.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ethere\'s no longer a need to track per-doc pending RAM\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'ll remove it from the code.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIf a buffer is not in the pool (ie not free), then it\'s in use and we count that as RAM used\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOk, I\'ll make the change.  \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ewe have to track net allocated, in order to trim the buffers (drop them, so GC can reclaim) when we are over the .setRAMBufferSizeMB\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI haven\'t seen this in the realtime branch.  Reclamation of extra allocated free blocks may need to be reimplemented.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll increment num bytes used when a block is returned for use.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn this topic, do you have any thoughts yet about how to make the block pools concurrent?  I\'m still leaning towards a random access file (seek style) interface because this is easy to make concurrent, and hides the underlying block management mechanism, rather than directly exposes it like today, which can lend itself to problematic usage in the future.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906798_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906798_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 13:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T13:46:51+0000\'\u003e07\\/Sep\\/10 13:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     shouldn\'t tiered flushing take care of this  \\n\\n Faulty thinking for a few minutes. \\n\\n  but this won\'t be most efficient, in general? Ie we could end up creating tiny segments depending on luck-of-the-thread-scheduling?  \\n\\n True.  Instead, we may want to simply not-flush the current DWPT if it is in fact not the highest RAM user.  When addDoc is called on the thread with the highest RAM usage, we can then flush it. \\n\\n  there\'s no longer a need to track per-doc pending RAM  \\n\\n I\'ll remove it from the code. \\n\\n  If a buffer is not in the pool (ie not free), then it\'s in use and we count that as RAM used  \\n\\n Ok, I\'ll make the change.   \\n\\n  we have to track net allocated, in order to trim the buffers (drop them, so GC can reclaim) when we are over the .setRAMBufferSizeMB  \\n\\n I haven\'t seen this in the realtime branch.  Reclamation of extra allocated free blocks may need to be reimplemented.   \\n\\n I\'ll increment num bytes used when a block is returned for use. \\n\\n On this topic, do you have any thoughts yet about how to make the block pools concurrent?  I\'m still leaning towards a random access file (seek style) interface because this is easy to make concurrent, and hides the underlying block management mechanism, rather than directly exposes it like today, which can lend itself to problematic usage in the future.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906801\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906801&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906801\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906801_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906801_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 13:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T13:49:53+0000\'\u003e07\\/Sep\\/10 13:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWe can modify MockRAMDir to optionally \\\"take its sweet time\\\" when writing certain files?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, I think we need to implement something of this nature.  We \u003cb\u003ecould\u003c\\/b\u003e even randomly assign a different delay value per flush.  Of course how the test would instigate this from outside of DW, is somewhat of a different issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906801_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906801_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 13:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T13:49:53+0000\'\u003e07\\/Sep\\/10 13:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     We can modify MockRAMDir to optionally \\\"take its sweet time\\\" when writing certain files?  \\n\\n Yes, I think we need to implement something of this nature.  We  could  even randomly assign a different delay value per flush.  Of course how the test would instigate this from outside of DW, is somewhat of a different issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906914\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906914&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906914\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906914_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906914_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 18:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T18:09:42+0000\'\u003e07\\/Sep\\/10 18:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cul\u003e\\n\\t\u003cli\u003eperDocAllocator is removed from DocumentsWriterRAMAllocator\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003egetByteBlock and getIntBlock always increments the numBytesUsed\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe test that simply prints out debugging messages looks better.  I need to figure out unit tests.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906914_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906914_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 18:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T18:09:42+0000\'\u003e07\\/Sep\\/10 18:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n\\t perDocAllocator is removed from DocumentsWriterRAMAllocator \\n \\n\\n\\n \\n\\t getByteBlock and getIntBlock always increments the numBytesUsed \\n \\n\\n\\n The test that simply prints out debugging messages looks better.  I need to figure out unit tests.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12906918\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12906918&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12906918\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906918_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906918_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 18:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T18:17:22+0000\'\u003e07\\/Sep\\/10 18:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe last patch also only flushes a DWPT if it\'s the highest RAM consumer.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12906918_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12906918_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 18:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T18:17:22+0000\'\u003e07\\/Sep\\/10 18:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The last patch also only flushes a DWPT if it\'s the highest RAM consumer.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12907029\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12907029&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12907029\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12907029_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12907029_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 23:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T23:42:33+0000\'\u003e07\\/Sep\\/10 23:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThere was a small bug in the choice of the max DWPT, in that all DWPTs, including ones that were scheduled to flush were being compared against the current DWPT (ie the one being examined for possible flushing).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12907029_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12907029_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Sep\\/10 23:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-07T23:42:33+0000\'\u003e07\\/Sep\\/10 23:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    There was a small bug in the choice of the max DWPT, in that all DWPTs, including ones that were scheduled to flush were being compared against the current DWPT (ie the one being examined for possible flushing).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12914296\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=12914296&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12914296\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12914296_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914296_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T00:44:18+0000\'\u003e24\\/Sep\\/10 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was hoping something clever would come to me about how to unit test this, nothing has.  We can do the slowdown of writes to the file(s) via a Thread.sleep, however this will only emulate a real file system in RAM, what then?  I thought about testing the percentage however is it going to be exact?  We could test a percentage range of each of the segments flushed?  I guess I just need to run the all of the unit tests, however some of those will fail because deletes aren\'t working properly yet.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_12914296_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12914296_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Sep\\/10 00:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2010-09-24T00:44:18+0000\'\u003e24\\/Sep\\/10 00:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was hoping something clever would come to me about how to unit test this, nothing has.  We can do the slowdown of writes to the file(s) via a Thread.sleep, however this will only emulate a real file system in RAM, what then?  I thought about testing the percentage however is it going to be exact?  We could test a percentage range of each of the segments flushed?  I guess I just need to run the all of the unit tests, however some of those will fail because deletes aren\'t working properly yet.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13003426\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13003426&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13003426\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13003426_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003426_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/11 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-07T16:51:07+0000\'\u003e07\\/Mar\\/11 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere is my first cut \\/ current status on this issue. First of all I have a couple of failures related to deletes but they seem not to be related (directly) to this patch since I can reproduce them even without the patch. \u003cbr\\/\u003e\\nall of the failures are related to deletes in some way so I suspect that there is another issue for that, no?\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch implements a tiered flush strategy combined with a concurrent flush approach. \u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAll decisions are based on a FlushPolicy which operates on a DocumentsWriterSession (does the ram tracking and housekeeping), once the flush policy encounters a transition to the next tier it marks the \\\"largest\\\" ram consuming thread\u003cbr\\/\u003e\\nas flushPending if we transition from a lower level and all threads if we transition from the upper watermark (level). DocumentsWriterSession shifts the memory of a pending thread to a new memory \\\"level\\\" (pendingBytes) and marks the thread as pending. \u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eOnce FlushPolicy#findFlushes(..) returns the caller tries to check if itself needs to flush and if so it \\\"checks-out\\\" its DWPT and replaces it with a complete new instance. Releases the lock on the ThreadState and continues to flush the \\\"checked-out\\\" DWPT. After this is done or if the current DWPT doesn\'t need flushing the indexing thread checks if there are any other pending flushes and tries to (non-blocking) obtain their lock. It only tries to get the lock and only tries once since if the lock is taken another thread is already holding it and will see the flushPending once finished adding the document.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eThis approach tries to utilize as much conccurrency as possible while flushing the DWPT and releaseing its ThreadState with an entirely new DWPT. Yet, this might also have problems especially if IO is slow and we filling up indexing RAM too fast. To prevent us from bloating up the memory too much I introduced a notation of \\\"healtiness\\\" which operates on the net-bytes used in the DocumentsWriterSession (flushBytes + pendingBytes + activeBytes) &#8211; (flushBytes - mem consumption of currently flushing DWPT, pendingBytes - mem consumption of marked as pending ThreadStates \\/ DWPT, activeBytes mem consuption of the indexing DWPT). If net-bytes reach a certain threshold (2*maxRam currently) I stop incoming threads until the session becomes healty again.\u003c\\/p\u003e\\n\\n\u003cp\u003eI run luceneutil with trunk vs. \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2573\\\" title=\\\"Tiered flushing of DWPTs by RAM with low\\/high water marks\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2573\\\"\u003e\u003cdel\u003eLUCENE-2573\u003c\\/del\u003e\u003c\\/a\u003e indexing 300k wikipedia docs with 1GB MaxRamBuffer and 4 Threads. Searches on both indexes yield identical results (Phew!) \u003cbr\\/\u003e\\nIndexing time in ms look promising\u003c\\/p\u003e\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003cth class=\'confluenceTh\'\u003etrunk\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003epatch\u003c\\/th\u003e\\n\u003cth class=\'confluenceTh\'\u003e diff \u003c\\/th\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003e134129 ms\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e102932 ms\u003c\\/td\u003e\\n\u003ctd class=\'confluenceTd\'\u003e\u003cfont color=\\\"green\\\"\u003e23.25%\u003c\\/font\u003e\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eThis patch is still kind of rough and needs iterations so reviews and questions are very much welcome.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13003426_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003426_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/11 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-07T16:51:07+0000\'\u003e07\\/Mar\\/11 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here is my first cut \\/ current status on this issue. First of all I have a couple of failures related to deletes but they seem not to be related (directly) to this patch since I can reproduce them even without the patch.  \\nall of the failures are related to deletes in some way so I suspect that there is another issue for that, no? \\n\\n This patch implements a tiered flush strategy combined with a concurrent flush approach.  \\n\\n \\n\\t All decisions are based on a FlushPolicy which operates on a DocumentsWriterSession (does the ram tracking and housekeeping), once the flush policy encounters a transition to the next tier it marks the \\\"largest\\\" ram consuming thread \\nas flushPending if we transition from a lower level and all threads if we transition from the upper watermark (level). DocumentsWriterSession shifts the memory of a pending thread to a new memory \\\"level\\\" (pendingBytes) and marks the thread as pending.  \\n \\n\\n\\n \\n\\t Once FlushPolicy#findFlushes(..) returns the caller tries to check if itself needs to flush and if so it \\\"checks-out\\\" its DWPT and replaces it with a complete new instance. Releases the lock on the ThreadState and continues to flush the \\\"checked-out\\\" DWPT. After this is done or if the current DWPT doesn\'t need flushing the indexing thread checks if there are any other pending flushes and tries to (non-blocking) obtain their lock. It only tries to get the lock and only tries once since if the lock is taken another thread is already holding it and will see the flushPending once finished adding the document. \\n \\n\\n\\n\\n This approach tries to utilize as much conccurrency as possible while flushing the DWPT and releaseing its ThreadState with an entirely new DWPT. Yet, this might also have problems especially if IO is slow and we filling up indexing RAM too fast. To prevent us from bloating up the memory too much I introduced a notation of \\\"healtiness\\\" which operates on the net-bytes used in the DocumentsWriterSession (flushBytes + pendingBytes + activeBytes) &#8211; (flushBytes - mem consumption of currently flushing DWPT, pendingBytes - mem consumption of marked as pending ThreadStates \\/ DWPT, activeBytes mem consuption of the indexing DWPT). If net-bytes reach a certain threshold (2*maxRam currently) I stop incoming threads until the session becomes healty again. \\n\\n I run luceneutil with trunk vs.   LUCENE-2573   indexing 300k wikipedia docs with 1GB MaxRamBuffer and 4 Threads. Searches on both indexes yield identical results (Phew!)  \\nIndexing time in ms look promising \\n \\n  \\n \\n trunk \\n patch \\n  diff  \\n \\n \\n 134129 ms \\n 102932 ms \\n  23.25%  \\n \\n  \\n \\n\\n\\n This patch is still kind of rough and needs iterations so reviews and questions are very much welcome. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13003650\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13003650&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13003650\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13003650_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003650_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/11 22:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-07T22:13:20+0000\'\u003e07\\/Mar\\/11 22:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I tested trunk vs RT branch + patch, indexing 10M Wikipedia docs\u003cbr\\/\u003e\\nwith 1 GB RAM buffer and 8 threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eTrunk took 298 sec for initial indexing, then 198 sec to wait for\u003cbr\\/\u003e\\nmerges to catch up, and 24 sec to commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eRT+patch took 289 sec for initial indexing, then 225 sec to wait for\u003cbr\\/\u003e\\nmerges, then 26 sec to commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eNot sure yet why I\'m not seeing real concurrency gains here... is\u003cbr\\/\u003e\\nthere anything printed to infoStream if the safety net (hijack app\u003cbr\\/\u003e\\nthreads) kicks in?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13003650_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003650_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/11 22:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-07T22:13:20+0000\'\u003e07\\/Mar\\/11 22:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I tested trunk vs RT branch + patch, indexing 10M Wikipedia docs \\nwith 1 GB RAM buffer and 8 threads. \\n\\n Trunk took 298 sec for initial indexing, then 198 sec to wait for \\nmerges to catch up, and 24 sec to commit. \\n\\n RT+patch took 289 sec for initial indexing, then 225 sec to wait for \\nmerges, then 26 sec to commit. \\n\\n Not sure yet why I\'m not seeing real concurrency gains here... is \\nthere anything printed to infoStream if the safety net (hijack app \\nthreads) kicks in?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13003879\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13003879&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13003879\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13003879_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003879_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 09:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T09:50:30+0000\'\u003e08\\/Mar\\/11 09:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWoops &#8211; I screwed up the above test!\u003c\\/p\u003e\\n\\n\u003cp\u003eCorrected numbers: trunk takes 439 sec to index 10M docs, 202 sec to waitForMerges, 17 sec to commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eRT + patch: 289 sec to index 10M docs, 225 sec to waitForMerges, 26 sec to commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is w\\/ 8 threads (machine has 24 cores), writing to Intel X25M G2 ssd.\u003c\\/p\u003e\\n\\n\u003cp\u003eAwesome speedup!!  Nice work everyone \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  Looking forward to making a new blog post soon!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13003879_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003879_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 09:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T09:50:30+0000\'\u003e08\\/Mar\\/11 09:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Woops &#8211; I screwed up the above test! \\n\\n Corrected numbers: trunk takes 439 sec to index 10M docs, 202 sec to waitForMerges, 17 sec to commit. \\n\\n RT + patch: 289 sec to index 10M docs, 225 sec to waitForMerges, 26 sec to commit. \\n\\n This is w\\/ 8 threads (machine has 24 cores), writing to Intel X25M G2 ssd. \\n\\n Awesome speedup!!  Nice work everyone    Looking forward to making a new blog post soon!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13003903\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13003903&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13003903\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13003903_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003903_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 11:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T11:39:03+0000\'\u003e08\\/Mar\\/11 11:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere is an updated patch that writes more stuff to the infostream including if we are unhealthy and block threads.\u003cbr\\/\u003e\\nI also fixed some issues with TestIndexWriterExceptions.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnother idea we should follow IMO is to see if we can biggypack the indexing threads on commit \\/ flushAll instead of waiting to be able to lock each DWPT and flush it sequentially. This should be fairly easy since we can simply mark them as flushPending and let incoming indexing thread do the flush in parallel. Depending on how we index and how big the DWPTs are this could give us another sizable gain. For instance if  you index and frequently commit, lets say every 10k docs (so many folks do stuff like that) but keep on indexing we should see concurrency helping us a lot since commit is not blocking all incoming indexing threads. I think we should spinoff another issues once this is ready\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13003903_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003903_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 11:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T11:39:03+0000\'\u003e08\\/Mar\\/11 11:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here is an updated patch that writes more stuff to the infostream including if we are unhealthy and block threads. \\nI also fixed some issues with TestIndexWriterExceptions. \\n\\n Another idea we should follow IMO is to see if we can biggypack the indexing threads on commit \\/ flushAll instead of waiting to be able to lock each DWPT and flush it sequentially. This should be fairly easy since we can simply mark them as flushPending and let incoming indexing thread do the flush in parallel. Depending on how we index and how big the DWPTs are this could give us another sizable gain. For instance if  you index and frequently commit, lets say every 10k docs (so many folks do stuff like that) but keep on indexing we should see concurrency helping us a lot since commit is not blocking all incoming indexing threads. I think we should spinoff another issues once this is ready              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13003909\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13003909&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13003909\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13003909_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003909_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 11:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T11:57:37+0000\'\u003e08\\/Mar\\/11 11:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNot done reviewing the patch but here\'s some initial feedback:\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eVery cool (and super advanced) that this adds a FlushPolicy!  But for\u003cbr\\/\u003e\\n\\\"normal\\\" usage we go and make either DocCountFP or TieredFP, depending\u003cbr\\/\u003e\\non whether IWC is flushing by docCount, RAM or both right?  Ie one\u003cbr\\/\u003e\\nnormally need not make their own FlushPolicy.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe rename TieredFP -&gt; ByRAMFP?  Also, I\'m not sure we need the N\u003cbr\\/\u003e\\ntiers?  I suspect that may flush too heavily?  Can we instead simplify\u003cbr\\/\u003e\\nit and have only the low and high water marks?  So we flush when\u003cbr\\/\u003e\\nactive RAM is over low water mark?  (And we stall if active + flushing\u003cbr\\/\u003e\\nRAM exceeds high water mark).\u003c\\/p\u003e\\n\\n\u003cp\u003eCan we rename isHealthy to isStalled (ie, invert it)?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m still unsure we should even include any healthy check APIs.  This\u003cbr\\/\u003e\\nis an exceptional situation and I don\'t think we need API exposure for\u003cbr\\/\u003e\\nit?  If apps really want to, they can turn on infoStream (we should\u003cbr\\/\u003e\\nmake sure \\\"stalling\\\" is logged, just like it is for merging) and\u003cbr\\/\u003e\\ndebug from there?\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe rename pendingBytes to flushingBytes?  Or maybe\u003cbr\\/\u003e\\nflushPendingBytes?  (Just to make it clear what we are pending on...).\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe rename FP.printInfo(String msg) --&gt; FP.message?  (Consistent w\\/\u003cbr\\/\u003e\\nour other classes).\u003c\\/p\u003e\\n\\n\u003cp\u003eI wonder if FP.findFlushes should be renamed to something like\u003cbr\\/\u003e\\nFP.visit, and return void?  Ie, it\'s called for its side effects of\u003cbr\\/\u003e\\nmarking DWPTs for flushing, right?  Separately, whether or not this\u003cbr\\/\u003e\\nthread will go and flush a DWPT is for IW to decide?  (Like it could\u003cbr\\/\u003e\\nbe this thread didn\'t mark any new flush required, but it should go\u003cbr\\/\u003e\\noff and pull a DWPT previously marked by another thread).  So then IW\u003cbr\\/\u003e\\nwould have a private volatile boolean recording whether any active\u003cbr\\/\u003e\\nDWPTs have flushPending.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13003909_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13003909_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 11:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T11:57:37+0000\'\u003e08\\/Mar\\/11 11:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Not done reviewing the patch but here\'s some initial feedback: \\n\\n\\n Very cool (and super advanced) that this adds a FlushPolicy!  But for \\n\\\"normal\\\" usage we go and make either DocCountFP or TieredFP, depending \\non whether IWC is flushing by docCount, RAM or both right?  Ie one \\nnormally need not make their own FlushPolicy. \\n\\n Maybe rename TieredFP -&gt; ByRAMFP?  Also, I\'m not sure we need the N \\ntiers?  I suspect that may flush too heavily?  Can we instead simplify \\nit and have only the low and high water marks?  So we flush when \\nactive RAM is over low water mark?  (And we stall if active + flushing \\nRAM exceeds high water mark). \\n\\n Can we rename isHealthy to isStalled (ie, invert it)? \\n\\n I\'m still unsure we should even include any healthy check APIs.  This \\nis an exceptional situation and I don\'t think we need API exposure for \\nit?  If apps really want to, they can turn on infoStream (we should \\nmake sure \\\"stalling\\\" is logged, just like it is for merging) and \\ndebug from there? \\n\\n Maybe rename pendingBytes to flushingBytes?  Or maybe \\nflushPendingBytes?  (Just to make it clear what we are pending on...). \\n\\n Maybe rename FP.printInfo(String msg) --&gt; FP.message?  (Consistent w\\/ \\nour other classes). \\n\\n I wonder if FP.findFlushes should be renamed to something like \\nFP.visit, and return void?  Ie, it\'s called for its side effects of \\nmarking DWPTs for flushing, right?  Separately, whether or not this \\nthread will go and flush a DWPT is for IW to decide?  (Like it could \\nbe this thread didn\'t mark any new flush required, but it should go \\noff and pull a DWPT previously marked by another thread).  So then IW \\nwould have a private volatile boolean recording whether any active \\nDWPTs have flushPending.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13004006\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13004006&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13004006\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13004006_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004006_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T15:57:28+0000\'\u003e08\\/Mar\\/11 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eMaybe rename TieredFP -&gt; ByRAMFP? Also, I\'m not sure we need the N\u003cbr\\/\u003e\\ntiers? I suspect that may flush too heavily? Can we instead simplify\u003cbr\\/\u003e\\nit and have only the low and high water marks? So we flush when\u003cbr\\/\u003e\\nactive RAM is over low water mark? (And we stall if active + flushing\u003cbr\\/\u003e\\nRAM exceeds high water mark).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ethis really sounds like a different FlushPolicy to me. But is worth a try - should be easy to add with this patch. so you mean we always flush ALL DWPT once we reached the low watermark? I don\'t think this is a good idea. And I wonder if that is a bit too aggressive to say you put DW into stalled mode if we exceed the high watermark. Anyway we can try and see what works better right?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eCan we rename isHealthy to isStalled (ie, invert it)?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003esure isStalled sounds fine\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m still unsure we should even include any healthy check APIs.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003efor now this is internal only so even if we decide to I would shift that to a different issue.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eMaybe rename pendingBytes to flushingBytes? Or maybe\u003cbr\\/\u003e\\nflushPendingBytes? (Just to make it clear what we are pending on...).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eyeah that is true - flushPendingBytes to make it consistent - my fault...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eI wonder if FP.findFlushes should be renamed to something like\u003cbr\\/\u003e\\nFP.visit, and return void? Ie, it\'s called for its side effects of\u003cbr\\/\u003e\\nmarking DWPTs for flushing, right? Separately, whether or not this\u003cbr\\/\u003e\\nthread will go and flush a DWPT is for IW to decide? (Like it could\u003cbr\\/\u003e\\nbe this thread didn\'t mark any new flush required, but it should go\u003cbr\\/\u003e\\noff and pull a DWPT previously marked by another thread). So then IW\u003cbr\\/\u003e\\nwould have a private volatile boolean recording whether any active\u003cbr\\/\u003e\\nDWPTs have flushPending.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI was unsure about the name too so I just made it consistent with MergePolicy. Visit is ok I think.\u003cbr\\/\u003e\\nthe return value is maybe a relict from earlier version where I haven\'t had the DocWriterSession#hasPendingFlushes() yeah I think we can make that void and simply check if there are any. I think I do that today already \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13004006_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004006_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T15:57:28+0000\'\u003e08\\/Mar\\/11 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Maybe rename TieredFP -&gt; ByRAMFP? Also, I\'m not sure we need the N \\ntiers? I suspect that may flush too heavily? Can we instead simplify \\nit and have only the low and high water marks? So we flush when \\nactive RAM is over low water mark? (And we stall if active + flushing \\nRAM exceeds high water mark).  \\n this really sounds like a different FlushPolicy to me. But is worth a try - should be easy to add with this patch. so you mean we always flush ALL DWPT once we reached the low watermark? I don\'t think this is a good idea. And I wonder if that is a bit too aggressive to say you put DW into stalled mode if we exceed the high watermark. Anyway we can try and see what works better right? \\n\\n  Can we rename isHealthy to isStalled (ie, invert it)?  \\n sure isStalled sounds fine \\n\\n  I\'m still unsure we should even include any healthy check APIs.  \\n for now this is internal only so even if we decide to I would shift that to a different issue. \\n\\n \\n Maybe rename pendingBytes to flushingBytes? Or maybe \\nflushPendingBytes? (Just to make it clear what we are pending on...).  \\n\\n yeah that is true - flushPendingBytes to make it consistent - my fault... \\n\\n \\n I wonder if FP.findFlushes should be renamed to something like \\nFP.visit, and return void? Ie, it\'s called for its side effects of \\nmarking DWPTs for flushing, right? Separately, whether or not this \\nthread will go and flush a DWPT is for IW to decide? (Like it could \\nbe this thread didn\'t mark any new flush required, but it should go \\noff and pull a DWPT previously marked by another thread). So then IW \\nwould have a private volatile boolean recording whether any active \\nDWPTs have flushPending.  \\n I was unsure about the name too so I just made it consistent with MergePolicy. Visit is ok I think. \\nthe return value is maybe a relict from earlier version where I haven\'t had the DocWriterSession#hasPendingFlushes() yeah I think we can make that void and simply check if there are any. I think I do that today already               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13004099\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13004099&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13004099\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13004099_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004099_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T18:02:18+0000\'\u003e08\\/Mar\\/11 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAwesome speedup!!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYAY! Glad the branch is actually faster \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for helping out with this patch, Simon. I\'ll try to look at the patch soon. My last week was super busy.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13004099_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004099_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 18:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T18:02:18+0000\'\u003e08\\/Mar\\/11 18:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Awesome speedup!!  \\n\\n YAY! Glad the branch is actually faster   \\n\\n Thanks for helping out with this patch, Simon. I\'ll try to look at the patch soon. My last week was super busy.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13004184\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13004184&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13004184\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13004184_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004184_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 20:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T20:27:15+0000\'\u003e08\\/Mar\\/11 20:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eso you mean we always flush ALL DWPT once we reached the low watermark? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo, I mean: as soon as we pass low wm, pick biggest DWPT and flush it.\u003cbr\\/\u003e\\nAs soon as you mark that DWPT as flushPending, its RAM used is removed\u003cbr\\/\u003e\\nfrom active pool and added to flushPending pool.\u003c\\/p\u003e\\n\\n\u003cp\u003eThen, if the active pool again crosses low wm, pick the biggest and\u003cbr\\/\u003e\\nmark as flush pending, etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut if the flushing cannot keep up, and the sum of active +\u003cbr\\/\u003e\\nflushPending pools crosses high wm, you hijack (stall) incoming\u003cbr\\/\u003e\\nthreads.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this may make a good \\\"flush by RAM\\\" policy, but I agree we should\u003cbr\\/\u003e\\ntest.  I think the fully tiered approach may be overly complex...\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003efor now this is internal only so even if we decide to I would shift that to a different issue.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK sounds good.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, if the app really cares about this (I suspect none will) they\u003cbr\\/\u003e\\ncould make a custom FlushPolicy that they could directly query to find\u003cbr\\/\u003e\\nout when threads get stalled.\u003c\\/p\u003e\\n\\n\u003cp\u003eBesides this, is it only getting flushing of deletes working\u003cbr\\/\u003e\\ncorrectly that remains, before landing RT?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13004184_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004184_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 20:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T20:27:15+0000\'\u003e08\\/Mar\\/11 20:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     so you mean we always flush ALL DWPT once we reached the low watermark?   \\n\\n No, I mean: as soon as we pass low wm, pick biggest DWPT and flush it. \\nAs soon as you mark that DWPT as flushPending, its RAM used is removed \\nfrom active pool and added to flushPending pool. \\n\\n Then, if the active pool again crosses low wm, pick the biggest and \\nmark as flush pending, etc. \\n\\n But if the flushing cannot keep up, and the sum of active + \\nflushPending pools crosses high wm, you hijack (stall) incoming \\nthreads. \\n\\n I think this may make a good \\\"flush by RAM\\\" policy, but I agree we should \\ntest.  I think the fully tiered approach may be overly complex... \\n\\n\\n  for now this is internal only so even if we decide to I would shift that to a different issue.  \\n\\n OK sounds good. \\n\\n Also, if the app really cares about this (I suspect none will) they \\ncould make a custom FlushPolicy that they could directly query to find \\nout when threads get stalled. \\n\\n Besides this, is it only getting flushing of deletes working \\ncorrectly that remains, before landing RT?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13004194\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13004194&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13004194\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13004194_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004194_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 20:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T20:35:13+0000\'\u003e08\\/Mar\\/11 20:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI think this may make a good \\\"flush by RAM\\\" policy, but I agree we should\u003cbr\\/\u003e\\ntest. I think the fully tiered approach may be overly complex...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eyeah possibly, I think simplifying this is easy now though...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eAlso, if the app really cares about this (I suspect none will) they\u003cbr\\/\u003e\\ncould make a custom FlushPolicy that they could directly query to find\u003cbr\\/\u003e\\nout when threads get stalled.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eyeah I think we don\'t need to expose that through IW.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eBesides this, is it only getting flushing of deletes working\u003cbr\\/\u003e\\ncorrectly that remains, before landing RT?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ewe need to fix \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2881\\\" title=\\\"Track FieldInfo per segment instead of per-IW-session\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2881\\\"\u003e\u003cdel\u003eLUCENE-2881\u003c\\/del\u003e\u003c\\/a\u003e first too.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13004194_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004194_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 20:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T20:35:13+0000\'\u003e08\\/Mar\\/11 20:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I think this may make a good \\\"flush by RAM\\\" policy, but I agree we should \\ntest. I think the fully tiered approach may be overly complex...  \\n\\n yeah possibly, I think simplifying this is easy now though... \\n\\n \\n Also, if the app really cares about this (I suspect none will) they \\ncould make a custom FlushPolicy that they could directly query to find \\nout when threads get stalled.  \\n\\n yeah I think we don\'t need to expose that through IW. \\n\\n \\n Besides this, is it only getting flushing of deletes working \\ncorrectly that remains, before landing RT?  \\n\\n we need to fix   LUCENE-2881   first too. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13004291\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13004291&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13004291\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13004291_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004291_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T23:49:42+0000\'\u003e08\\/Mar\\/11 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ewe need to fix \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2881\\\" title=\\\"Track FieldInfo per segment instead of per-IW-session\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2881\\\"\u003e\u003cdel\u003eLUCENE-2881\u003c\\/del\u003e\u003c\\/a\u003e first too.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah, I haven\'t merged with trunk since we rolled back 2881, so we should fix it first, catch up with trunk, and then make deletes work.  I might have a bit time tonight to work on 2881.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13004291_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13004291_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Mar\\/11 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-08T23:49:42+0000\'\u003e08\\/Mar\\/11 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     we need to fix   LUCENE-2881   first too.  \\n\\n Yeah, I haven\'t merged with trunk since we rolled back 2881, so we should fix it first, catch up with trunk, and then make deletes work.  I might have a bit time tonight to work on 2881.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13006451\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13006451&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13006451\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13006451_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006451_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T15:02:36+0000\'\u003e14\\/Mar\\/11 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003enext iteration on this patch. I changed some naming issues and separated a ByRAMFlushPolicy as an abstract base class. This patch contains the original MultiTierFlushPolicy and a SingleTierFlushPolicy that only has a low and a high watermark. This policy tries to flush the biggest DWPT once LW is crossed and flushed all DWPT once HW is crossed. \u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch also adds a \\\"flush if stalled\\\" control that hijacks indexing threads if the DW is stalled and there are still pending flushes. If so the incoming thread tries to check out a pending DWPT and flushes it before it adds the actual document.\u003c\\/p\u003e\\n\\n\u003cp\u003eI didn\'t benchmark the more complex MultiTierFP vs. SingleTierFP yet. I hope I get to this soon.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13006451_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006451_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T15:02:36+0000\'\u003e14\\/Mar\\/11 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    next iteration on this patch. I changed some naming issues and separated a ByRAMFlushPolicy as an abstract base class. This patch contains the original MultiTierFlushPolicy and a SingleTierFlushPolicy that only has a low and a high watermark. This policy tries to flush the biggest DWPT once LW is crossed and flushed all DWPT once HW is crossed.  \\n\\n This patch also adds a \\\"flush if stalled\\\" control that hijacks indexing threads if the DW is stalled and there are still pending flushes. If so the incoming thread tries to check out a pending DWPT and flushes it before it adds the actual document. \\n\\n I didn\'t benchmark the more complex MultiTierFP vs. SingleTierFP yet. I hope I get to this soon.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13006579\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13006579&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13006579\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13006579_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006579_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T19:06:29+0000\'\u003e14\\/Mar\\/11 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI still see a healtiness (mis-spelled) in DW.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'d rather not have the stalling\\/healthiness be baked into the API, at\u003cbr\\/\u003e\\nall.  Can we put the hijack logic entirely private in the flush-by-ram\u003cbr\\/\u003e\\npolicies?  (Ie remove isStalled()\\/hijackThreadsForFlush()).\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead of\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e+    synchronized (docWriter.docWriterSession) {\\n+      netBytes = docWriter.docWriterSession.netBytes();\\n+    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e, shouldn\'t we just make that method sync\'d?\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eBe careful defaulting TermsHash.trackAllocations to true &#8211; eg term\u003cbr\\/\u003e\\nvectors wants this to be false.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan we move FlushSpecification out of FlushPolicy?  Ie, it\'s a private\u003cbr\\/\u003e\\nimpl detail of DW right?  (Not part of FlushPolicy\'s API).  Actually\u003cbr\\/\u003e\\nwhy do we need it?  Can\'t we just return the DWPT?\u003c\\/p\u003e\\n\\n\u003cp\u003eWhy do we have a separate DocWriterSession?  Can\'t this be absorbed\u003cbr\\/\u003e\\ninto DocWriter?\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead of FlushPolicy.message, can\'t the policy call DW.message?\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the by-RAM flush policies... when you hit the high water mark, we\u003cbr\\/\u003e\\nshould 1) flush all DWPTs and 2) stall any other threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhy do we dereference the DWPTs with their ord?  EG, can\'t we just\u003cbr\\/\u003e\\nstore their \\\"state\\\" (active or flushPending) on the DWPT instead of in\u003cbr\\/\u003e\\na separate states[]?\u003c\\/p\u003e\\n\\n\u003cp\u003eDo we really need FlushState.Aborted?  And if not... do we really need\u003cbr\\/\u003e\\nFlushState (since it just becomes 2 states, ie, Active or Flushing,\u003cbr\\/\u003e\\nwhich I think is then redundant w\\/ flushPending boolean?).\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the default low water should be 1X of your RAM buffer?  And\u003cbr\\/\u003e\\nhigh water maybe 2X?  (For both flush-by-RAM policies).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13006579_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006579_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/11 19:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-14T19:06:29+0000\'\u003e14\\/Mar\\/11 19:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I still see a healtiness (mis-spelled) in DW. \\n\\n I\'d rather not have the stalling\\/healthiness be baked into the API, at \\nall.  Can we put the hijack logic entirely private in the flush-by-ram \\npolicies?  (Ie remove isStalled()\\/hijackThreadsForFlush()). \\n\\n Instead of \\n\\n  \\n +    synchronized (docWriter.docWriterSession) {\\n+      netBytes = docWriter.docWriterSession.netBytes();\\n+    }\\n \\n  \\n\\n , shouldn\'t we just make that method sync\'d? \\n\\n\\n Be careful defaulting TermsHash.trackAllocations to true &#8211; eg term \\nvectors wants this to be false. \\n\\n Can we move FlushSpecification out of FlushPolicy?  Ie, it\'s a private \\nimpl detail of DW right?  (Not part of FlushPolicy\'s API).  Actually \\nwhy do we need it?  Can\'t we just return the DWPT? \\n\\n Why do we have a separate DocWriterSession?  Can\'t this be absorbed \\ninto DocWriter? \\n\\n Instead of FlushPolicy.message, can\'t the policy call DW.message? \\n\\n On the by-RAM flush policies... when you hit the high water mark, we \\nshould 1) flush all DWPTs and 2) stall any other threads. \\n\\n Why do we dereference the DWPTs with their ord?  EG, can\'t we just \\nstore their \\\"state\\\" (active or flushPending) on the DWPT instead of in \\na separate states[]? \\n\\n Do we really need FlushState.Aborted?  And if not... do we really need \\nFlushState (since it just becomes 2 states, ie, Active or Flushing, \\nwhich I think is then redundant w\\/ flushPending boolean?). \\n\\n I think the default low water should be 1X of your RAM buffer?  And \\nhigh water maybe 2X?  (For both flush-by-RAM policies).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13006871\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13006871&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13006871\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13006871_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006871_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/11 10:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-15T10:48:32+0000\'\u003e15\\/Mar\\/11 10:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI still see a healtiness (mis-spelled) in DW.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eugh. I will fix\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eI\'d rather not have the stalling\\/healthiness be baked into the API, at\u003cbr\\/\u003e\\nall. Can we put the hijack logic entirely private in the flush-by-ram\u003cbr\\/\u003e\\npolicies? (Ie remove isStalled()\\/hijackThreadsForFlush()).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree for the hijack part but the isStalled is something I might want to control. I mean we can still open it up eventually so rather make it private for now but keep a not on in. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eCan we move FlushSpecification out of FlushPolicy? Ie, it\'s a private\u003cbr\\/\u003e\\nimpl detail of DW right? (Not part of FlushPolicy\'s API). Actually\u003cbr\\/\u003e\\nwhy do we need it? Can\'t we just return the DWPT?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eit currently holds the ram usage for that DWPT when it was checked out so that I can reduce the flushBytes accordingly. We can maybe get rid of it entirely but I don\'t want to rely on the DWPT bytesUsed() though.\u003cbr\\/\u003e\\nWe can certainly move it out - this inner class is a relict though.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhy do we have a separate DocWriterSession? Can\'t this be absorbed\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003einto DocWriter?\u003c\\/p\u003e\\n\\n\u003cp\u003eI generally don\'t like cluttering DocWriter and let it grow like IW. DocWriterSession might not be the ideal name for this class but its really a ram tracker for this DW. Yet, we can move out some parts that do not directly relate to mem tracking. Maybe DocWriterBytes?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBe careful defaulting TermsHash.trackAllocations to true \\u2013 eg term\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003evectors wants this to be false.\u003c\\/p\u003e\\n\\n\u003cp\u003eI need to go through the IndexingChain and check carefully where to track memory anyway. I haven\'t got to that yet but good that you mention it that one could easily get lost.\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eInstead of FlushPolicy.message, can\'t the policy call DW.message?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI don\'t want to couple that API to DW. What would be the benefit beside from saving a single method?\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eOn the by-RAM flush policies... when you hit the high water mark, we\\u2028should 1) flush all DWPTs and 2) stall any other threads.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWell I am not sure if we should do that. I don\'t really see why we should forcefully stop the world here. Incoming threads will pick up a flush immediately and if we have enough resources to index further why should we wait until all DWPT are flushed. if we stall I fear that we could queue up threads that could help flushing while stalling would simply stop them doing anything, right? You can still control this with the healthiness though. We currently do flush all DWPT btw. once we hit the HW. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eWhy do we dereference the DWPTs with their ord? EG, can\'t we just\\u2028store their \\\"state\\\" (active or flushPending) on the DWPT instead of in\\u2028a separate states[]?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eThat is definitely an option. I will give that a go.\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eDo we really need FlushState.Aborted? And if not... do we really need\\u2028FlushState (since it just becomes 2 states, ie, Active or Flushing,\\u2028which I think is then redundant w\\/ flushPending boolean?).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ethis needs some more refactoring I will attach another iteration\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eI think the default low water should be 1X of your RAM buffer? And\\u2028high water maybe 2X? (For both flush-by-RAM policies).\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ehmm, I think we need to revise the maxRAMBufferMB Javadoc anyway so we have all the freedom to do whatever we want. yet, I think we should try to keep the RAM consumption similar to what it would have used in a previous release. So if we say HW is 2x then suddenly some apps might run out of memory. I am not sure if we should do that or rather stick to the 90% to 110% for now.  We need to find good defaults for this anyway.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13006871_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13006871_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/11 10:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-15T10:48:32+0000\'\u003e15\\/Mar\\/11 10:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I still see a healtiness (mis-spelled) in DW.  \\n ugh. I will fix \\n \\n I\'d rather not have the stalling\\/healthiness be baked into the API, at \\nall. Can we put the hijack logic entirely private in the flush-by-ram \\npolicies? (Ie remove isStalled()\\/hijackThreadsForFlush()).  \\n\\n I agree for the hijack part but the isStalled is something I might want to control. I mean we can still open it up eventually so rather make it private for now but keep a not on in.  \\n\\n \\n Can we move FlushSpecification out of FlushPolicy? Ie, it\'s a private \\nimpl detail of DW right? (Not part of FlushPolicy\'s API). Actually \\nwhy do we need it? Can\'t we just return the DWPT?  \\n\\n it currently holds the ram usage for that DWPT when it was checked out so that I can reduce the flushBytes accordingly. We can maybe get rid of it entirely but I don\'t want to rely on the DWPT bytesUsed() though. \\nWe can certainly move it out - this inner class is a relict though. \\n\\n  Why do we have a separate DocWriterSession? Can\'t this be absorbed  \\n into DocWriter? \\n\\n I generally don\'t like cluttering DocWriter and let it grow like IW. DocWriterSession might not be the ideal name for this class but its really a ram tracker for this DW. Yet, we can move out some parts that do not directly relate to mem tracking. Maybe DocWriterBytes? \\n\\n  Be careful defaulting TermsHash.trackAllocations to true \\u2013 eg term  \\n vectors wants this to be false. \\n\\n I need to go through the IndexingChain and check carefully where to track memory anyway. I haven\'t got to that yet but good that you mention it that one could easily get lost. \\n\\n\\n\\n\\n\\n  Instead of FlushPolicy.message, can\'t the policy call DW.message?  \\n I don\'t want to couple that API to DW. What would be the benefit beside from saving a single method? \\n \\n On the by-RAM flush policies... when you hit the high water mark, we\\u2028should 1) flush all DWPTs and 2) stall any other threads.  \\n Well I am not sure if we should do that. I don\'t really see why we should forcefully stop the world here. Incoming threads will pick up a flush immediately and if we have enough resources to index further why should we wait until all DWPT are flushed. if we stall I fear that we could queue up threads that could help flushing while stalling would simply stop them doing anything, right? You can still control this with the healthiness though. We currently do flush all DWPT btw. once we hit the HW.  \\n\\n \\n Why do we dereference the DWPTs with their ord? EG, can\'t we just\\u2028store their \\\"state\\\" (active or flushPending) on the DWPT instead of in\\u2028a separate states[]?  \\n That is definitely an option. I will give that a go. \\n \\n Do we really need FlushState.Aborted? And if not... do we really need\\u2028FlushState (since it just becomes 2 states, ie, Active or Flushing,\\u2028which I think is then redundant w\\/ flushPending boolean?).  \\n this needs some more refactoring I will attach another iteration \\n \\n I think the default low water should be 1X of your RAM buffer? And\\u2028high water maybe 2X? (For both flush-by-RAM policies).  \\n hmm, I think we need to revise the maxRAMBufferMB Javadoc anyway so we have all the freedom to do whatever we want. yet, I think we should try to keep the RAM consumption similar to what it would have used in a previous release. So if we say HW is 2x then suddenly some apps might run out of memory. I am not sure if we should do that or rather stick to the 90% to 110% for now.  We need to find good defaults for this anyway.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13007003\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13007003&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13007003\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13007003_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13007003_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/11 16:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-15T16:42:15+0000\'\u003e15\\/Mar\\/11 16:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eit currently holds the ram usage for that DWPT when it was checked out so that I can reduce the flushBytes accordingly. We can maybe get rid of it entirely but I don\'t want to rely on the DWPT bytesUsed() though.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm, but, once a DWPT is pulled from production, its bytesUsed()\u003cbr\\/\u003e\\nshould not be changing anymore?  Like why can\'t we use it to hold its\u003cbr\\/\u003e\\nbytesUsed?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI generally don\'t like cluttering DocWriter and let it grow like IW. DocWriterSession might not be the ideal name for this class but its really a ram tracker for this DW. Yet, we can move out some parts that do not directly relate to mem tracking. Maybe DocWriterBytes?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWell DocWriter is quite small now \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e (On RT branch).  And adding\u003cbr\\/\u003e\\nanother class means we have to be careful about proper sync\'ing (lock\u003cbr\\/\u003e\\norder, to avoid deadlock)... and I think it should get smaller if we\u003cbr\\/\u003e\\ncan remove state[] array, FlushState enum, etc. but, OK I guess we can\u003cbr\\/\u003e\\nleave it as separate for now.  How about DocumentsWriterRAMUsage?\u003cbr\\/\u003e\\nRAMTracker?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eInstead of FlushPolicy.message, can\'t the policy call DW.message?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t want to couple that API to DW. What would be the benefit beside from saving a single method?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm, good point.  Though, it already has a SetOnce&lt;DocumentsWriter&gt; &#8211;\u003cbr\\/\u003e\\nhow come?  Can the policy call IW.message?  I just think FlushPolicy\u003cbr\\/\u003e\\nought to be very lean, ie show you exactly what you need to\u003cbr\\/\u003e\\nimplement...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003ebq. On the by-RAM flush policies... when you hit the high water mark, we\\u2028should 1) flush all DWPTs and 2) stall any other threads.\u003c\\/p\u003e\\n\\n\u003cp\u003eWell I am not sure if we should do that. I don\'t really see why we should forcefully stop the world here. Incoming threads will pick up a flush immediately and if we have enough resources to index further why should we wait until all DWPT are flushed. if we stall I fear that we could queue up threads that could help flushing while stalling would simply stop them doing anything, right? You can still control this with the healthiness though. We currently do flush all DWPT btw. once we hit the HW.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAs long as we default the high mark to something \\\"generous\\\" (2X low\u003cbr\\/\u003e\\nmark), I think this approach should work well.\u003c\\/p\u003e\\n\\n\u003cp\u003eIe, we \\\"begin\\\" flushing as soon as low mark is crossed on active RAM.\u003cbr\\/\u003e\\nWe pick the biggest DWPT and take it of rotation, and immediately\u003cbr\\/\u003e\\ndeduct its RAM usage from the active pool.  If, while we are still\u003cbr\\/\u003e\\nflushing, active RAM again grows above the low mark, then we pull\u003cbr\\/\u003e\\nanother DWPT, etc.  But then if ever the total flushing + active\u003cbr\\/\u003e\\nexceeds the high mark, we stall.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW why do we track flushPending RAM vs flushing RAM?  Is that\u003cbr\\/\u003e\\ndistinction necessary?  (Can\'t we just track \\\"flushing\\\" RAM?).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13007003_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13007003_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/11 16:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-15T16:42:15+0000\'\u003e15\\/Mar\\/11 16:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     it currently holds the ram usage for that DWPT when it was checked out so that I can reduce the flushBytes accordingly. We can maybe get rid of it entirely but I don\'t want to rely on the DWPT bytesUsed() though.  \\n\\n Hmm, but, once a DWPT is pulled from production, its bytesUsed() \\nshould not be changing anymore?  Like why can\'t we use it to hold its \\nbytesUsed? \\n\\n  I generally don\'t like cluttering DocWriter and let it grow like IW. DocWriterSession might not be the ideal name for this class but its really a ram tracker for this DW. Yet, we can move out some parts that do not directly relate to mem tracking. Maybe DocWriterBytes?  \\n\\n Well DocWriter is quite small now   (On RT branch).  And adding \\nanother class means we have to be careful about proper sync\'ing (lock \\norder, to avoid deadlock)... and I think it should get smaller if we \\ncan remove state[] array, FlushState enum, etc. but, OK I guess we can \\nleave it as separate for now.  How about DocumentsWriterRAMUsage? \\nRAMTracker? \\n\\n \\n  Instead of FlushPolicy.message, can\'t the policy call DW.message?  \\n\\n I don\'t want to couple that API to DW. What would be the benefit beside from saving a single method?  \\n\\n Hmm, good point.  Though, it already has a SetOnce&lt;DocumentsWriter&gt; &#8211; \\nhow come?  Can the policy call IW.message?  I just think FlushPolicy \\nought to be very lean, ie show you exactly what you need to \\nimplement... \\n\\n \\n bq. On the by-RAM flush policies... when you hit the high water mark, we\\u2028should 1) flush all DWPTs and 2) stall any other threads. \\n\\n Well I am not sure if we should do that. I don\'t really see why we should forcefully stop the world here. Incoming threads will pick up a flush immediately and if we have enough resources to index further why should we wait until all DWPT are flushed. if we stall I fear that we could queue up threads that could help flushing while stalling would simply stop them doing anything, right? You can still control this with the healthiness though. We currently do flush all DWPT btw. once we hit the HW.  \\n\\n As long as we default the high mark to something \\\"generous\\\" (2X low \\nmark), I think this approach should work well. \\n\\n Ie, we \\\"begin\\\" flushing as soon as low mark is crossed on active RAM. \\nWe pick the biggest DWPT and take it of rotation, and immediately \\ndeduct its RAM usage from the active pool.  If, while we are still \\nflushing, active RAM again grows above the low mark, then we pull \\nanother DWPT, etc.  But then if ever the total flushing + active \\nexceeds the high mark, we stall. \\n\\n BTW why do we track flushPending RAM vs flushing RAM?  Is that \\ndistinction necessary?  (Can\'t we just track \\\"flushing\\\" RAM?).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13008474\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13008474&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13008474\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13008474_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13008474_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/11 15:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-18T15:36:40+0000\'\u003e18\\/Mar\\/11 15:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003enext iteration containing a large number of refactorings.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI moved all responsibilities related to flushing including synchronization into the DocsWriterSession and renamed it to DocumentsWriterFlushControl.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDWFC now only tracks active and flush bytes since the relict from my initial patch where pending memory was tracked is not needed anymore.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDWFC took over all synchronization so there is not synchronized (flushControl) \\n{...}\\n\u003cp\u003e in DocumentsWriter anymore. Seem way cleaner too though.\u003c\\/p\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eHealthiness now blocks once we reach 2x maxMemory and SingleTierFlushPolicy uses 0.9 maxRam as low watermark and 2x low watermark as its HW to flush all threads. The multi tier one is still unchanged and flushes in linear steps from 0.9 to 1.10 x maxRam. We should actually test if this does better worse than the single tier FP.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFlushPolicy now has only a visit method and uses the IW.message to write to info stream.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThreadState now holds a boolean flag that indicates if a flush is pending which is synced and written by DWFC. States[] is gone in DWFC.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFlushSpecification is gone and DWFC returns DWPT upon checkoutForFlush. Yet, I still track the mem for the flushing DWPT seperatly since the DWPT#bytesUsed() changes during flush and I don\'t want to rely on that this doesn\'t change. As a nice side-effect I can check if a checked out DWPT is passed to doAfterFlush and assert on that.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003enext steps here are benchmarking and getting good defaults for the flush policies. I think we are close though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13008474_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13008474_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/11 15:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-18T15:36:40+0000\'\u003e18\\/Mar\\/11 15:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    next iteration containing a large number of refactorings. \\n\\n \\n\\t I moved all responsibilities related to flushing including synchronization into the DocsWriterSession and renamed it to DocumentsWriterFlushControl. \\n \\n\\n\\n \\n\\t DWFC now only tracks active and flush bytes since the relict from my initial patch where pending memory was tracked is not needed anymore. \\n \\n\\n\\n \\n\\t DWFC took over all synchronization so there is not synchronized (flushControl) \\n{...}\\n  in DocumentsWriter anymore. Seem way cleaner too though.  \\n \\n\\n\\n \\n\\t Healthiness now blocks once we reach 2x maxMemory and SingleTierFlushPolicy uses 0.9 maxRam as low watermark and 2x low watermark as its HW to flush all threads. The multi tier one is still unchanged and flushes in linear steps from 0.9 to 1.10 x maxRam. We should actually test if this does better worse than the single tier FP. \\n \\n\\n\\n \\n\\t FlushPolicy now has only a visit method and uses the IW.message to write to info stream. \\n \\n\\n\\n \\n\\t ThreadState now holds a boolean flag that indicates if a flush is pending which is synced and written by DWFC. States[] is gone in DWFC. \\n \\n\\n\\n \\n\\t FlushSpecification is gone and DWFC returns DWPT upon checkoutForFlush. Yet, I still track the mem for the flushing DWPT seperatly since the DWPT#bytesUsed() changes during flush and I don\'t want to rely on that this doesn\'t change. As a nice side-effect I can check if a checked out DWPT is passed to doAfterFlush and assert on that. \\n \\n\\n\\n next steps here are benchmarking and getting good defaults for the flush policies. I think we are close though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13008776\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13008776&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13008776\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13008776_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13008776_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Mar\\/11 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-19T14:29:09+0000\'\u003e19\\/Mar\\/11 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cul\u003e\\n\\t\u003cli\u003eI think once we sync up to trunk again, the FP should hold the\u003cbr\\/\u003e\\n    IW\'s config instance, and pull settings \\\"live\\\" from it?  Ie this\u003cbr\\/\u003e\\n    way we keep our live changes to flush-by-RAM.  Also, Healthiness\u003cbr\\/\u003e\\n    (it won\'t get updates to RAM buffer now).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eShould we rename *ByRAMFP --&gt; *ByRAMOrDocCountFP?  Since it \\\"ors\\\"\u003cbr\\/\u003e\\n    docCount and RAM usage trigger right?  Oh, I see, not quite &#8211; it\u003cbr\\/\u003e\\n    requires RAM buffer be set.  I think we should relax that?  Ie a\u003cbr\\/\u003e\\n    single flush policy (the default) flushes by either\\/or?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eShouldn\'t these flush policies also trigger by\u003cbr\\/\u003e\\n    maxBufferedDelCount?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMaybe FP.init should throw IllegalStateExc not IllegalArgExc?\u003cbr\\/\u003e\\n    (Because, no arg is allowed once the \\\"state\\\" of FP has already\u003cbr\\/\u003e\\n    been init\'ed).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eProbably FP.writer should be a SetOnce?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eHmm we still have a FlushPolicy.message?  Can\'t we just make IW\u003cbr\\/\u003e\\n    protected and then FlushPolicy impl can call IW.message?  (And\u003cbr\\/\u003e\\n    also remove FP.setInfoStream).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eIs IW.FlushControl not really used anymore?  We should remove it?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI still think LW should be 1.0 of your RAM buffer.  Ie, IW will\u003cbr\\/\u003e\\n    start flushing once that much RAM is in use.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI still see \\\"synchronized (docWriter.flushControl) {\\\" in\u003cbr\\/\u003e\\n    IndexWriter\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWe should jdoc that IWC.setFlushPolicy takes effect only on init\u003cbr\\/\u003e\\n    of IW?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eAdd \\\"for testing only\\\" comment to IW.getDocsWriter?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI wonder whether we should convey \\\"what changed\\\" to the FP?  EG,\u003cbr\\/\u003e\\n    we can 1) buffer a new del term, 2) add a new doc, 3) both\u003cbr\\/\u003e\\n    (updateDocument).  It could be we have onUpdate, onAdd, onDelete?\u003cbr\\/\u003e\\n    Or maybe we keep single method but rename to onChange?  Ie, it\'s\u003cbr\\/\u003e\\n    called because \u003cb\u003esomething\u003c\\/b\u003e about the incoming DWPT has changed.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThe flush policy shouldn\'t have to compute \\\"delta\\\" RAM like it\u003cbr\\/\u003e\\n    does now?  Actually why can\'t it just call\u003cbr\\/\u003e\\n    flushControl.activeBytes(), and we ensure the delta was already\u003cbr\\/\u003e\\n    folded into that?  Ie we\'d call commmitPerThreadBytes before\u003cbr\\/\u003e\\n    FP.visit.  (Then commitPerThreadBytes wouldn\'t ever add to\u003cbr\\/\u003e\\n    flushBytes, which is sort of spooky &#8211; like flushBytes should get\u003cbr\\/\u003e\\n    incr\'d only when we pull a DWPT out for flushing).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI don\'t think we should ever markAllWritersPending, ie, that\'s\u003cbr\\/\u003e\\n    not the right \\\"reaction\\\" when flushing is too slow (eg you\'re on a\u003cbr\\/\u003e\\n    slow hard drive) since over time this will result in flushing lots\u003cbr\\/\u003e\\n    of tiny segments unnecessarily.  A better reaction is to stall the\u003cbr\\/\u003e\\n    incoming threads; this way the flusher threads catch up, and once\u003cbr\\/\u003e\\n    you resume, then the small DPWTs have a chance to get big before\u003cbr\\/\u003e\\n    they are flushed.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMisspelled: markLargesWriterPending -&gt; markLargestWriterPending\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13008776_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13008776_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Mar\\/11 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-19T14:29:09+0000\'\u003e19\\/Mar\\/11 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n\\t I think once we sync up to trunk again, the FP should hold the \\n    IW\'s config instance, and pull settings \\\"live\\\" from it?  Ie this \\n    way we keep our live changes to flush-by-RAM.  Also, Healthiness \\n    (it won\'t get updates to RAM buffer now). \\n \\n\\n\\n \\n\\t Should we rename *ByRAMFP --&gt; *ByRAMOrDocCountFP?  Since it \\\"ors\\\" \\n    docCount and RAM usage trigger right?  Oh, I see, not quite &#8211; it \\n    requires RAM buffer be set.  I think we should relax that?  Ie a \\n    single flush policy (the default) flushes by either\\/or? \\n \\n\\n\\n \\n\\t Shouldn\'t these flush policies also trigger by \\n    maxBufferedDelCount? \\n \\n\\n\\n \\n\\t Maybe FP.init should throw IllegalStateExc not IllegalArgExc? \\n    (Because, no arg is allowed once the \\\"state\\\" of FP has already \\n    been init\'ed). \\n \\n\\n\\n \\n\\t Probably FP.writer should be a SetOnce? \\n \\n\\n\\n \\n\\t Hmm we still have a FlushPolicy.message?  Can\'t we just make IW \\n    protected and then FlushPolicy impl can call IW.message?  (And \\n    also remove FP.setInfoStream). \\n \\n\\n\\n \\n\\t Is IW.FlushControl not really used anymore?  We should remove it? \\n \\n\\n\\n \\n\\t I still think LW should be 1.0 of your RAM buffer.  Ie, IW will \\n    start flushing once that much RAM is in use. \\n \\n\\n\\n \\n\\t I still see \\\"synchronized (docWriter.flushControl) {\\\" in \\n    IndexWriter \\n \\n\\n\\n \\n\\t We should jdoc that IWC.setFlushPolicy takes effect only on init \\n    of IW? \\n \\n\\n\\n \\n\\t Add \\\"for testing only\\\" comment to IW.getDocsWriter? \\n \\n\\n\\n \\n\\t I wonder whether we should convey \\\"what changed\\\" to the FP?  EG, \\n    we can 1) buffer a new del term, 2) add a new doc, 3) both \\n    (updateDocument).  It could be we have onUpdate, onAdd, onDelete? \\n    Or maybe we keep single method but rename to onChange?  Ie, it\'s \\n    called because  something  about the incoming DWPT has changed. \\n \\n\\n\\n \\n\\t The flush policy shouldn\'t have to compute \\\"delta\\\" RAM like it \\n    does now?  Actually why can\'t it just call \\n    flushControl.activeBytes(), and we ensure the delta was already \\n    folded into that?  Ie we\'d call commmitPerThreadBytes before \\n    FP.visit.  (Then commitPerThreadBytes wouldn\'t ever add to \\n    flushBytes, which is sort of spooky &#8211; like flushBytes should get \\n    incr\'d only when we pull a DWPT out for flushing). \\n \\n\\n\\n \\n\\t I don\'t think we should ever markAllWritersPending, ie, that\'s \\n    not the right \\\"reaction\\\" when flushing is too slow (eg you\'re on a \\n    slow hard drive) since over time this will result in flushing lots \\n    of tiny segments unnecessarily.  A better reaction is to stall the \\n    incoming threads; this way the flusher threads catch up, and once \\n    you resume, then the small DPWTs have a chance to get big before \\n    they are flushed. \\n \\n\\n\\n \\n\\t Misspelled: markLargesWriterPending -&gt; markLargestWriterPending \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13010178\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13010178&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13010178\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13010178_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13010178_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/11 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-23T15:28:18+0000\'\u003e23\\/Mar\\/11 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere is my current state on this issue. I did\'t add all JDocs needed (by far) and I will wait until we settled on the API for FlushPolicy.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI removed the complex TieredFlushPolicy entirely and added one DefaultFlushPolicy that flushes at IWC.getRAMBufferSizeMB() \\/ sets biggest DWPT pending.\u003c\\/li\u003e\\n\\t\u003cli\u003eDW will stall threads if we reach 2 x maxNetRam which is retrieved from FlushPolicy so folks can lower that depending on their env.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eDWFlushControl checks if a single DWPT grows too large and sets it forcefully pending once its ram consumption is &gt; 1.9 GB. That should be enough buffer to not reach the 2048MB limit. We should consider making this configurable.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFlushPolicy has now three methods onInsert, onUpdate and onDelete while DefaultFlushPolicy only implements onInsert and onDelete, the Abstract base class just calls those on an update.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI removed FlushControl from IW\u003c\\/li\u003e\\n\\t\u003cli\u003eadded documentation on IWC for FlushPolicy and removed the jdocs for the RAM limit. I think we should add some lines about how RAM is now used and that users should balance the RAM with the number of threads they are using. Will do that later on though.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFor testing I added a ThrottledIndexOutput that makes flushing slow so I can test if we are stalled and \\/ or blocked. This is passed to MockDirectoryWrapper. Its currently under util but it rather should go under store, no?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ebyte consumption is now committed before FlushPolicy is called since we don\'t have the multitier flush which required that to reliably proceed across tier boundaries (not required but it was easier to test really). So FP doesn\'t need to take care of the delta\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFlushPolicy now also flushes on maxBufferedDeleteTerms while the buffered delete terms is not yet connected to the DW#getNumBufferedDeleteTerms() which causes some failures though. I added \\/\\/nocommit &amp; @Ignore to those tests.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ethis patch also contains a @Ignore on TestPersistentSnapshotDeletionPolicy which I couldn\'t figure out why it is failing but it could be due to an old version of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2881\\\" title=\\\"Track FieldInfo per segment instead of per-IW-session\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2881\\\"\u003e\u003cdel\u003eLUCENE-2881\u003c\\/del\u003e\u003c\\/a\u003e on this branch. I will see if it still fails once we merged.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eHealthiness now doesn\'t stall if we are not flushing on RAM consumption to ensure we don\'t lock in threads.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eover all this seems much closer now. I will start writing jdocs. Flush on buffered delete terms might need some tests and I should also write a more reliable test for Healthiness... current it relies on that the ThrottledIndexOutput is slowing down indexing enough to block which might not be true all the time. It didn\'t fail yet. \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13010178_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13010178_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Mar\\/11 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-23T15:28:18+0000\'\u003e23\\/Mar\\/11 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here is my current state on this issue. I did\'t add all JDocs needed (by far) and I will wait until we settled on the API for FlushPolicy. \\n\\n \\n\\t I removed the complex TieredFlushPolicy entirely and added one DefaultFlushPolicy that flushes at IWC.getRAMBufferSizeMB() \\/ sets biggest DWPT pending. \\n\\t DW will stall threads if we reach 2 x maxNetRam which is retrieved from FlushPolicy so folks can lower that depending on their env. \\n \\n\\n\\n \\n\\t DWFlushControl checks if a single DWPT grows too large and sets it forcefully pending once its ram consumption is &gt; 1.9 GB. That should be enough buffer to not reach the 2048MB limit. We should consider making this configurable. \\n \\n\\n\\n \\n\\t FlushPolicy has now three methods onInsert, onUpdate and onDelete while DefaultFlushPolicy only implements onInsert and onDelete, the Abstract base class just calls those on an update. \\n \\n\\n\\n \\n\\t I removed FlushControl from IW \\n\\t added documentation on IWC for FlushPolicy and removed the jdocs for the RAM limit. I think we should add some lines about how RAM is now used and that users should balance the RAM with the number of threads they are using. Will do that later on though. \\n \\n\\n\\n \\n\\t For testing I added a ThrottledIndexOutput that makes flushing slow so I can test if we are stalled and \\/ or blocked. This is passed to MockDirectoryWrapper. Its currently under util but it rather should go under store, no? \\n \\n\\n\\n \\n\\t byte consumption is now committed before FlushPolicy is called since we don\'t have the multitier flush which required that to reliably proceed across tier boundaries (not required but it was easier to test really). So FP doesn\'t need to take care of the delta \\n \\n\\n\\n \\n\\t FlushPolicy now also flushes on maxBufferedDeleteTerms while the buffered delete terms is not yet connected to the DW#getNumBufferedDeleteTerms() which causes some failures though. I added \\/\\/nocommit &amp; @Ignore to those tests. \\n \\n\\n\\n \\n\\t this patch also contains a @Ignore on TestPersistentSnapshotDeletionPolicy which I couldn\'t figure out why it is failing but it could be due to an old version of   LUCENE-2881   on this branch. I will see if it still fails once we merged. \\n \\n\\n\\n \\n\\t Healthiness now doesn\'t stall if we are not flushing on RAM consumption to ensure we don\'t lock in threads. \\n \\n\\n\\n\\n over all this seems much closer now. I will start writing jdocs. Flush on buffered delete terms might need some tests and I should also write a more reliable test for Healthiness... current it relies on that the ThrottledIndexOutput is slowing down indexing enough to block which might not be true all the time. It didn\'t fail yet.  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13011333\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13011333&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13011333\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13011333_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13011333_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Mar\\/11 18:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-25T18:27:59+0000\'\u003e25\\/Mar\\/11 18:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch is looking better!  I love how simple DefaultFP is now \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003e1900 * 1024 * 1024 is actually 1.86 GB; maybe just change comment\u003cbr\\/\u003e\\n    to 1900 MB?  Or we could really make the limit 1.9 GB (= 1945.6\u003cbr\\/\u003e\\n    MB)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI think we should make the 1.9 GB changeable\u003cbr\\/\u003e\\n    (setRAMPerThreadHardLimitMB?)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eHow come we lost \'assert !bufferedDeletesStream.any();\' in\u003cbr\\/\u003e\\n    IndexWriter.java?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWhy default trackAllocations to true when ctor always sets it (in\u003cbr\\/\u003e\\n    TermsHash.java)?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eCan we not simply not invoke the FP if flushPending is already set\u003cbr\\/\u003e\\n    for the given DWPT?  (So that every FP need not check that).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eIn DefaultFP.onDelete &#8211; we shouldn\'t just return if numDocsInRAM\u003cbr\\/\u003e\\n    is 0?  Ie an app could open IW, delete 2M terms, close, and we\u003cbr\\/\u003e\\n    need to flush several times due to RAM usage or del term count...\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eMaybe rename DefaultFP --&gt; FlushByRAMOrCounts?\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWon\'t the new do\\/while loop added to ThreadAffinityDWThreadPool\u003cbr\\/\u003e\\n    run hot, if minThreadState is constantly null...?  (Separately\u003cbr\\/\u003e\\n    that source needs a header)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eI love the ThrottledIndexOutput!\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFor the InterruptedException in ThrottledIndexOutput.sleep, we\u003cbr\\/\u003e\\n    should rethrow w\\/ oal.util.ThreadInterruptedException (best\u003cbr\\/\u003e\\n    practice... probably doesn\'t really matter here)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWe should fix DefaultFlushPolicy to first pull the relevant config\u003cbr\\/\u003e\\n    from IWC (eg maxBufferedDocs), then check if that config is -1 or\u003cbr\\/\u003e\\n    not, etc., because IWC\'s config can be changed at any time (live)\u003cbr\\/\u003e\\n    so we may read eg 10000 at first and then -1 the second time.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eMaybe, for stalling, instead of triggering by max RAM, we can take\u003cbr\\/\u003e\\nthis simple approach: if the number of flushing DWPTs ever exceeds one\u003cbr\\/\u003e\\nplus number of active DWPTs, then we stall (and resume once it\'s below\u003cbr\\/\u003e\\nagain).\u003c\\/p\u003e\\n\\n\u003cp\u003eThis approach would then work for flush-by-docCount policies too, and\u003cbr\\/\u003e\\nwould still roughly equate to up to 2X RAM usage for flush-by.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s really odd that TestPersistentSDP fails now... this should be\u003cbr\\/\u003e\\nunrelated to the (admittedly, major) changes we\'re making here...\u003c\\/p\u003e\\n\\n\u003cp\u003eHmm.... deletes are actually tricky, because somehow the FlushPolicy\u003cbr\\/\u003e\\nneeds access to the \\\"global\\\" deletes count (and also the to per-DWPT\u003cbr\\/\u003e\\ndeletes count).  If a given DWPT has 0 buffered docs, then indeed the\u003cbr\\/\u003e\\nbuffered deletes in its pool doesn\'t matter.  But, we do need to respect\u003cbr\\/\u003e\\nthe buffered deletes in the global pool...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13011333_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13011333_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Mar\\/11 18:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-25T18:27:59+0000\'\u003e25\\/Mar\\/11 18:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch is looking better!  I love how simple DefaultFP is now   \\n\\n \\n\\t 1900 * 1024 * 1024 is actually 1.86 GB; maybe just change comment \\n    to 1900 MB?  Or we could really make the limit 1.9 GB (= 1945.6 \\n    MB) \\n \\n\\n\\n \\n\\t I think we should make the 1.9 GB changeable \\n    (setRAMPerThreadHardLimitMB?) \\n \\n\\n\\n \\n\\t How come we lost \'assert !bufferedDeletesStream.any();\' in \\n    IndexWriter.java? \\n \\n\\n\\n \\n\\t Why default trackAllocations to true when ctor always sets it (in \\n    TermsHash.java)? \\n \\n\\n\\n \\n\\t Can we not simply not invoke the FP if flushPending is already set \\n    for the given DWPT?  (So that every FP need not check that). \\n \\n\\n\\n \\n\\t In DefaultFP.onDelete &#8211; we shouldn\'t just return if numDocsInRAM \\n    is 0?  Ie an app could open IW, delete 2M terms, close, and we \\n    need to flush several times due to RAM usage or del term count... \\n \\n\\n\\n \\n\\t Maybe rename DefaultFP --&gt; FlushByRAMOrCounts? \\n \\n\\n\\n \\n\\t Won\'t the new do\\/while loop added to ThreadAffinityDWThreadPool \\n    run hot, if minThreadState is constantly null...?  (Separately \\n    that source needs a header) \\n \\n\\n\\n \\n\\t I love the ThrottledIndexOutput! \\n \\n\\n\\n \\n\\t For the InterruptedException in ThrottledIndexOutput.sleep, we \\n    should rethrow w\\/ oal.util.ThreadInterruptedException (best \\n    practice... probably doesn\'t really matter here) \\n \\n\\n\\n \\n\\t We should fix DefaultFlushPolicy to first pull the relevant config \\n    from IWC (eg maxBufferedDocs), then check if that config is -1 or \\n    not, etc., because IWC\'s config can be changed at any time (live) \\n    so we may read eg 10000 at first and then -1 the second time. \\n \\n\\n\\n Maybe, for stalling, instead of triggering by max RAM, we can take \\nthis simple approach: if the number of flushing DWPTs ever exceeds one \\nplus number of active DWPTs, then we stall (and resume once it\'s below \\nagain). \\n\\n This approach would then work for flush-by-docCount policies too, and \\nwould still roughly equate to up to 2X RAM usage for flush-by. \\n\\n It\'s really odd that TestPersistentSDP fails now... this should be \\nunrelated to the (admittedly, major) changes we\'re making here... \\n\\n Hmm.... deletes are actually tricky, because somehow the FlushPolicy \\nneeds access to the \\\"global\\\" deletes count (and also the to per-DWPT \\ndeletes count).  If a given DWPT has 0 buffered docs, then indeed the \\nbuffered deletes in its pool doesn\'t matter.  But, we do need to respect \\nthe buffered deletes in the global pool...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13012069\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13012069&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13012069\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13012069_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13012069_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Mar\\/11 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-28T14:11:34+0000\'\u003e28\\/Mar\\/11 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHow come we lost \'assert !bufferedDeletesStream.any();\' inIndexWriter.java?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eso this is tricky here. Since we are flushing concurrently this could false fail. The same assertion is in bufferedDeletesStream.prune(segmentInfos); which is synced. But another thread could sneak in between the prune and the any() check updating \\/ deleting a document this could false fail. Or do I miss something here?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMaybe, for stalling, instead of triggering by max RAM, we can take\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ethis simple approach: if the number of flushing DWPTs ever exceeds one\u003cbr\\/\u003e\\nplus number of active DWPTs, then we stall (and resume once it\'s below\u003cbr\\/\u003e\\nagain).\u003c\\/p\u003e\\n\\n\u003cp\u003eAwesome idea mike! I will do that!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eWe should fix DefaultFlushPolicy to first pull the relevant config\u003cbr\\/\u003e\\nfrom IWC (eg maxBufferedDocs), then check if that config is -1 or\u003cbr\\/\u003e\\nnot, etc., because IWC\'s config can be changed at any time (live)\u003cbr\\/\u003e\\nso we may read eg 10000 at first and then -1 the second time.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhat you mean is we should check if we flush by Ram, DocCount etc. and only if so we check the live values for Ram, DocCount etc.?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eHmm.... deletes are actually tricky, because somehow the FlushPolicy\u003cbr\\/\u003e\\nneeds access to the \\\"global\\\" deletes count (and also the to per-DWPT\u003cbr\\/\u003e\\ndeletes count). If a given DWPT has 0 buffered docs, then indeed the\u003cbr\\/\u003e\\nbuffered deletes in its pool doesn\'t matter. But, we do need to respect\u003cbr\\/\u003e\\nthe buffered deletes in the global pool...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI think it does not make sense to check both the global count and the DWPT count against the same value. If we have a DWPT that exceeds it we also exceed globally or could it happen that a DWPT has more deletes than the global pool? Further if we observe the global pool and we exceed the limit do we flush all as written on the IWC documentation?\u003c\\/p\u003e\\n\\n\u003cp\u003eonce we sort this out I upload a new patch with javadoc etc for flush policy. we seem to be close here man! \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13012069_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13012069_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Mar\\/11 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-28T14:11:34+0000\'\u003e28\\/Mar\\/11 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     How come we lost \'assert !bufferedDeletesStream.any();\' inIndexWriter.java?  \\n so this is tricky here. Since we are flushing concurrently this could false fail. The same assertion is in bufferedDeletesStream.prune(segmentInfos); which is synced. But another thread could sneak in between the prune and the any() check updating \\/ deleting a document this could false fail. Or do I miss something here? \\n\\n  Maybe, for stalling, instead of triggering by max RAM, we can take  \\n this simple approach: if the number of flushing DWPTs ever exceeds one \\nplus number of active DWPTs, then we stall (and resume once it\'s below \\nagain). \\n\\n Awesome idea mike! I will do that! \\n\\n \\n We should fix DefaultFlushPolicy to first pull the relevant config \\nfrom IWC (eg maxBufferedDocs), then check if that config is -1 or \\nnot, etc., because IWC\'s config can be changed at any time (live) \\nso we may read eg 10000 at first and then -1 the second time.  \\n\\n What you mean is we should check if we flush by Ram, DocCount etc. and only if so we check the live values for Ram, DocCount etc.? \\n\\n \\n Hmm.... deletes are actually tricky, because somehow the FlushPolicy \\nneeds access to the \\\"global\\\" deletes count (and also the to per-DWPT \\ndeletes count). If a given DWPT has 0 buffered docs, then indeed the \\nbuffered deletes in its pool doesn\'t matter. But, we do need to respect \\nthe buffered deletes in the global pool...  \\n I think it does not make sense to check both the global count and the DWPT count against the same value. If we have a DWPT that exceeds it we also exceed globally or could it happen that a DWPT has more deletes than the global pool? Further if we observe the global pool and we exceed the limit do we flush all as written on the IWC documentation? \\n\\n once we sort this out I upload a new patch with javadoc etc for flush policy. we seem to be close here man!               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13012509\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13012509&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13012509\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13012509_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13012509_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/11 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-29T14:46:29+0000\'\u003e29\\/Mar\\/11 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003enext iterations.\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eadded JavaDoc to all classes and interfaces.\u003c\\/li\u003e\\n\\t\u003cli\u003efixed the possible hot loop in DWPTThreadPool\u003c\\/li\u003e\\n\\t\u003cli\u003echanged stalling logic to block if more flushing DWPT are around than active ones.\u003c\\/li\u003e\\n\\t\u003cli\u003echeck IWC setting on init and listen to live changes for those who have not been disabled.\u003c\\/li\u003e\\n\\t\u003cli\u003emade the hard per thread RAM limit configurable and added DEFAULT_RAM_PER_THREAD_HARD_LIMIT set to 1945MB\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003erenamed  DefaultFP --&gt; FlushByRAMOrCounts\u003c\\/li\u003e\\n\\t\u003cli\u003eadded setFlushDeletes to DWFlushControl that is checked each time we add a delete and if set we flush the global deletes.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ethis seems somewhat close though. its time to benchmark it again.\u003c\\/p\u003e\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13012509_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13012509_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/Mar\\/11 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-29T14:46:29+0000\'\u003e29\\/Mar\\/11 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    next iterations. \\n \\n\\t added JavaDoc to all classes and interfaces. \\n\\t fixed the possible hot loop in DWPTThreadPool \\n\\t changed stalling logic to block if more flushing DWPT are around than active ones. \\n\\t check IWC setting on init and listen to live changes for those who have not been disabled. \\n\\t made the hard per thread RAM limit configurable and added DEFAULT_RAM_PER_THREAD_HARD_LIMIT set to 1945MB \\n \\n\\n\\n \\n\\t renamed  DefaultFP --&gt; FlushByRAMOrCounts \\n\\t added setFlushDeletes to DWFlushControl that is checked each time we add a delete and if set we flush the global deletes. \\n \\n\\n\\n this seems somewhat close though. its time to benchmark it again. \\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13012953\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13012953&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13012953\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13012953_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13012953_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/11 13:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-30T13:36:27+0000\'\u003e30\\/Mar\\/11 13:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eToday I merged with trunk and updated my patch. I fixed the testcases that had an @Ignore on them and run tests. 1 out of 5 tests fails on TestStressIndexing and TestNRTThreads which is due to the update issues which should be addressed in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2956\\\" title=\\\"Support updateDocument() with DWPTs\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2956\\\"\u003e\u003cdel\u003eLUCENE-2956\u003c\\/del\u003e\u003c\\/a\u003e. All other tests pass including all RAM \\/ NumDoc \\/ BufferedDeleteTerms related tests. As a consequence I committed the current state of this issue to the RT branch too. I will keep this issue open for now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13012953_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13012953_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/11 13:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-30T13:36:27+0000\'\u003e30\\/Mar\\/11 13:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Today I merged with trunk and updated my patch. I fixed the testcases that had an @Ignore on them and run tests. 1 out of 5 tests fails on TestStressIndexing and TestNRTThreads which is due to the update issues which should be addressed in   LUCENE-2956  . All other tests pass including all RAM \\/ NumDoc \\/ BufferedDeleteTerms related tests. As a consequence I committed the current state of this issue to the RT branch too. I will keep this issue open for now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13013559\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13013559&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13013559\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13013559_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13013559_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/11 17:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-30T17:53:53+0000\'\u003e30\\/Mar\\/11 17:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Simon!\u003cbr\\/\u003e\\nI\'ll work on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-2956\\\" title=\\\"Support updateDocument() with DWPTs\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-2956\\\"\u003e\u003cdel\u003eLUCENE-2956\u003c\\/del\u003e\u003c\\/a\u003e next.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13013559_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13013559_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Mar\\/11 17:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-30T17:53:53+0000\'\u003e30\\/Mar\\/11 17:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Simon! \\nI\'ll work on   LUCENE-2956   next.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13013974\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13013974&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13013974\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13013974_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13013974_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/11 13:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-31T13:42:55+0000\'\u003e31\\/Mar\\/11 13:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI run a couple of benchmarks with interesting results the graph below show documents per second for the RT branch with DWPT yielding a very good IO\\/CPU utilization and overall throughput is much better than trunks.\u003cbr\\/\u003e\\n\u003cspan class=\\\"image-wrap\\\" style=\\\"\\\"\u003e\u003cimg src=\\\"http:\\/\\/people.apache.org\\/~simonw\\/DocumentsWriterPerThread_dps.png\\\" style=\\\"border: 0px solid black\\\" \\/\u003e\u003c\\/span\u003e \u003cbr\\/\u003e\\nYet, when we look at trunk the peak performance is much better on trunk than on DWPT. The reason for that I think is that we flush concurrently which takes at most one thread out of the loop, those are the little drops in docs\\/sec. This does not yet explain the reason for the constantly lower max indexing rate, I suspect that this is at least influenced due to the fact that flushing is very very CPU intensive. At the same time CMS might kick in way more often since we are writing more segments which are also smaller compared to trunk. Eventually, I need to run a profiler and see what is going on.\u003cbr\\/\u003e\\n\u003cspan class=\\\"image-wrap\\\" style=\\\"\\\"\u003e\u003cimg src=\\\"http:\\/\\/people.apache.org\\/~simonw\\/Trunk_dps.png\\\" style=\\\"border: 0px solid black\\\" \\/\u003e\u003c\\/span\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eInteresting is that beside the nice CPU utilization we also have an nearly perfect IO utilization. The graph below shows that we are consistently using IO to flush segments. the width of the bars show the time it took to flush a single DWPT, there is almost no overlap.\u003cbr\\/\u003e\\n\u003cspan class=\\\"image-wrap\\\" style=\\\"\\\"\u003e\u003cimg src=\\\"http:\\/\\/people.apache.org\\/~simonw\\/DocumentsWriterPerThread_flush.png\\\" style=\\\"border: 0px solid black\\\" \\/\u003e\u003c\\/span\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eOverall those are super results! Good job everybody!\u003c\\/p\u003e\\n\\n\u003cp\u003esimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13013974_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13013974_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/11 13:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-31T13:42:55+0000\'\u003e31\\/Mar\\/11 13:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I run a couple of benchmarks with interesting results the graph below show documents per second for the RT branch with DWPT yielding a very good IO\\/CPU utilization and overall throughput is much better than trunks. \\n     \\nYet, when we look at trunk the peak performance is much better on trunk than on DWPT. The reason for that I think is that we flush concurrently which takes at most one thread out of the loop, those are the little drops in docs\\/sec. This does not yet explain the reason for the constantly lower max indexing rate, I suspect that this is at least influenced due to the fact that flushing is very very CPU intensive. At the same time CMS might kick in way more often since we are writing more segments which are also smaller compared to trunk. Eventually, I need to run a profiler and see what is going on. \\n     \\n\\n Interesting is that beside the nice CPU utilization we also have an nearly perfect IO utilization. The graph below shows that we are consistently using IO to flush segments. the width of the bars show the time it took to flush a single DWPT, there is almost no overlap. \\n     \\n\\n Overall those are super results! Good job everybody! \\n\\n simon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13014016\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13014016&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13014016\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_13014016_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014016_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/11 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-31T15:26:46+0000\'\u003e31\\/Mar\\/11 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003einfluenced due to the fact that flushing is very very CPU intensive\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDo you think this is due mostly to the vint decoding?  We\'re not interleaving postings on flush with this patch so the CPU consumption should be somewhat lower.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAt the same time CMS might kick in way more often since we are writing more segments which are also smaller compared to trunk\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis\'s probably the more likely case.  In general, we may be able to default to a higher overall RAM buffer size, and perhaps there won\'t be degradation in indexing performance like there is with trunk?  In the future with RT we could get fancy and selectively merge segments as we\'re flushing, if writing larger segments is important.  \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'d personally prefer to write out 1-2 GB segments, and limit the number of DWPTs to 2-3, mainly for servers that are concurrently indexing and searching (eg, the RT use case).  I think the current default number of thread states is a bit high.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jasonrutherglen\\\" id=\\\"commentauthor_13014016_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jasonrutherglen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jasonrutherglen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Rutherglen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014016_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/11 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-31T15:26:46+0000\'\u003e31\\/Mar\\/11 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     influenced due to the fact that flushing is very very CPU intensive  \\n\\n Do you think this is due mostly to the vint decoding?  We\'re not interleaving postings on flush with this patch so the CPU consumption should be somewhat lower. \\n\\n  At the same time CMS might kick in way more often since we are writing more segments which are also smaller compared to trunk  \\n\\n This\'s probably the more likely case.  In general, we may be able to default to a higher overall RAM buffer size, and perhaps there won\'t be degradation in indexing performance like there is with trunk?  In the future with RT we could get fancy and selectively merge segments as we\'re flushing, if writing larger segments is important.   \\n\\n I\'d personally prefer to write out 1-2 GB segments, and limit the number of DWPTs to 2-3, mainly for servers that are concurrently indexing and searching (eg, the RT use case).  I think the current default number of thread states is a bit high.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13014046\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13014046&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13014046\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13014046_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014046_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/11 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-31T16:07:54+0000\'\u003e31\\/Mar\\/11 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Simon, for running the benchmarks! Good results overall, even though it\'s puzzling why flushing would be CPU intensive.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe should probably do some profiling to figure out where the time is spent. I can probably do that Sunday, but feel free to beat me \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13014046_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014046_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/Mar\\/11 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-03-31T16:07:54+0000\'\u003e31\\/Mar\\/11 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Simon, for running the benchmarks! Good results overall, even though it\'s puzzling why flushing would be CPU intensive. \\n\\n We should probably do some profiling to figure out where the time is spent. I can probably do that Sunday, but feel free to beat me                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13014538\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13014538&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13014538\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13014538_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014538_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/11 12:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-04-01T12:35:47+0000\'\u003e01\\/Apr\\/11 12:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThanks, Simon, for running the benchmarks! Good results overall, even though it\'s puzzling why flushing would be CPU intensive.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ewell during flush we are encoding lots of VInts thats making it cpu intensive.\u003c\\/p\u003e\\n\\n\u003cp\u003eI actually run the benchmark through a profiler and found out what the problem was with my benchmarks.\u003cbr\\/\u003e\\nWhen I indexed with DWPT my HDD was soo busy flushing segments concurrently that the read performance suffered and my indexing threads blocked on the line doc file where I read the records from. This explains the large amounts of spikes towards 0 doc\\/sec. The profiler also showed that we are waiting on ThreadState#lock() constantly with at least 3 threads. I changed the current behavior of the threadpool to not clear the thread bindings when I replace a DWPT for flushing an voila! we have comparable peak ingest rate. \u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"image-wrap\\\" style=\\\"\\\"\u003e\u003cimg src=\\\"http:\\/\\/people.apache.org\\/~simonw\\/DocumentsWriterPerThread_dps_01.png\\\" style=\\\"border: 0px solid black\\\" \\/\u003e\u003c\\/span\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eNote the difference DWPT indexes the documents in 6 min 15 seconds!\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"image-wrap\\\" style=\\\"\\\"\u003e\u003cimg src=\\\"http:\\/\\/people.apache.org\\/~simonw\\/Trunk_dps_01.png\\\" style=\\\"border: 0px solid black\\\" \\/\u003e\u003c\\/span\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eHere we have 13 min 40 seconds! NICE!\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003cspan class=\\\"image-wrap\\\" style=\\\"\\\"\u003e\u003cimg src=\\\"http:\\/\\/people.apache.org\\/~simonw\\/DocumentsWriterPerThread_flush_01.png\\\" style=\\\"border: 0px solid black\\\" \\/\u003e\u003c\\/span\u003e \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13014538_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014538_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/11 12:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-04-01T12:35:47+0000\'\u003e01\\/Apr\\/11 12:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Thanks, Simon, for running the benchmarks! Good results overall, even though it\'s puzzling why flushing would be CPU intensive.  \\n well during flush we are encoding lots of VInts thats making it cpu intensive. \\n\\n I actually run the benchmark through a profiler and found out what the problem was with my benchmarks. \\nWhen I indexed with DWPT my HDD was soo busy flushing segments concurrently that the read performance suffered and my indexing threads blocked on the line doc file where I read the records from. This explains the large amounts of spikes towards 0 doc\\/sec. The profiler also showed that we are waiting on ThreadState#lock() constantly with at least 3 threads. I changed the current behavior of the threadpool to not clear the thread bindings when I replace a DWPT for flushing an voila! we have comparable peak ingest rate.  \\n\\n      \\n\\n Note the difference DWPT indexes the documents in 6 min 15 seconds! \\n\\n      \\n\\n Here we have 13 min 40 seconds! NICE! \\n\\n                   \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13014724\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13014724&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13014724\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13014724_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014724_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/11 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-04-01T16:32:19+0000\'\u003e01\\/Apr\\/11 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAwesome speedup! Finally all this work shows great results!!\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat\'s surprising is that the merge time is lower with DWPT. How can that be, considering we\'re doing more merges?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"michaelbusch\\\" id=\\\"commentauthor_13014724_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=michaelbusch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"michaelbusch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael Busch\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13014724_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Apr\\/11 16:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-04-01T16:32:19+0000\'\u003e01\\/Apr\\/11 16:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Awesome speedup! Finally all this work shows great results!! \\n\\n What\'s surprising is that the merge time is lower with DWPT. How can that be, considering we\'re doing more merges?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13019802\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-2573?focusedCommentId=13019802&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13019802\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13019802_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13019802_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/11 12:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-04-14T12:19:57+0000\'\u003e14\\/Apr\\/11 12:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ethis is committed to branch reviews should go through \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3023\\\" title=\\\"Land DWPT on trunk\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3023\\\"\u003e\u003cdel\u003eLUCENE-3023\u003c\\/del\u003e\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13019802_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13019802_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Apr\\/11 12:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-04-14T12:19:57+0000\'\u003e14\\/Apr\\/11 12:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    this is committed to branch reviews should go through   LUCENE-3023                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516203114360"> 
    <input type="hidden" title="jira.request.server.time" value="869"> 
    <input type="hidden" title="jira.request.id" value="931x7704157x5"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="47"> 
    <input type="hidden" title="db.conns.time.in.ms" value="58"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 931x7704157x5
	          REQUEST TIMESTAMP : [17/Jan/2018:15:31:54 +0000]
	               REQUEST TIME : 0.8690
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=28, elapsedTotal=47637926, elapsedMin=722285, elapsedMax=12792085, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=32, elapsedTotal=58433438, elapsedMin=796833, elapsedMax=12890927, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>