<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|5958d9db9caa0eaa3d92943145e9bbf0f070a5b5|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"df0f3bf113d989\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-3653"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-3653] Lucene Search not scalling - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-3653] Lucene Search not scalling - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-3653">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-3653" href="/jira/browse/LUCENE-3653" id="key-val" rel="12535526">LUCENE-3653</a></li>
                </ol>
                <h1 id="summary-val">Lucene Search not scalling</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-3653"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-3653/LUCENE-3653.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-3653/LUCENE-3653.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-3653/LUCENE-3653.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-3653/LUCENE-3653.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+3.6" title="3.6 Major release after 3.5">3.6</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-ALPHA" title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12535526-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span>, 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>I've noticed that when doing thousands of searches in a single thread the average time is quite low i.e. a few milliseconds. When adding more concurrent searches doing exactly the same search the average time increases drastically. <br> I've profiled the search classes and found that the whole of lucene blocks on </p> 
                  <p>org.apache.lucene.index.SegmentCoreReaders.getTermsReader<br> org.apache.lucene.util.VirtualMethod<br> public synchronized int getImplementationDistance <br> org.apache.lucene.util.AttributeSourcew.getAttributeInterfaces</p> 
                  <p>These cause search times to increase from a few milliseconds to up to 2 seconds when doing 500 concurrent searches on the same in memory index. Note: That the index is not being updates at all, so not refresh methods are called at any stage.</p> 
                  <p>Some questions:<br> Why do we need synchronization here?<br> There must be a non-lockable solution for these, they basically cause lucene to be ok for single thread applications but disastrous for any concurrent implementation.</p> 
                  <p>I'll do some experiments by removing the synchronization from the methods of these classes.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-3653?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-3653?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-3653?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-3653?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507796" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507796/App.java" draggable="true" data-downloadurl="text/x-java:App.java:https://issues.apache.org/jira/secure/attachment/12507796/App.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="Java Source File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507796/App.java" title="Latest  17/Dec/11 19:39 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="text/x-java:App.java:https://issues.apache.org/jira/secure/attachment/12507796/App.java">App.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:39:27.696Z">17/Dec/11 19:39</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12508358" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12508358/LUCENE-3653.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-3653.patch:https://issues.apache.org/jira/secure/attachment/12508358/LUCENE-3653.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12508358/LUCENE-3653.patch" title="Latest  22/Dec/11 08:45 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-3653.patch:https://issues.apache.org/jira/secure/attachment/12508358/LUCENE-3653.patch">LUCENE-3653.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-22T08:45:46.162Z">22/Dec/11 08:45</time>
                   </dd>
                   <dd class="attachment-size">
                    0.9 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12507882" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507882/LUCENE-3653.patch" draggable="true" data-downloadurl="text/x-patch:LUCENE-3653.patch:https://issues.apache.org/jira/secure/attachment/12507882/LUCENE-3653.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507882/LUCENE-3653.patch" title=" 19/Dec/11 08:59 - Simon Willnauer" draggable="true" data-downloadurl="text/x-patch:LUCENE-3653.patch:https://issues.apache.org/jira/secure/attachment/12507882/LUCENE-3653.patch">LUCENE-3653.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T08:59:13.976Z">19/Dec/11 08:59</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507893" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507893/LUCENE-3653.patch-BiasedLockingStartupDelay_1.png" draggable="true" data-downloadurl="image/png:LUCENE-3653.patch-BiasedLockingStartupDelay_1.png:https://issues.apache.org/jira/secure/attachment/12507893/LUCENE-3653.patch-BiasedLockingStartupDelay_1.png" file-preview-id="12507893" file-preview-title="LUCENE-3653.patch-BiasedLockingStartupDelay_1.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507893/LUCENE-3653.patch-BiasedLockingStartupDelay_1.png" title="Latest  19/Dec/11 11:05 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:LUCENE-3653.patch-BiasedLockingStartupDelay_1.png:https://issues.apache.org/jira/secure/attachment/12507893/LUCENE-3653.patch-BiasedLockingStartupDelay_1.png" file-preview-id="12507893" file-preview-title="LUCENE-3653.patch-BiasedLockingStartupDelay_1.png" file-preview-type="image">LUCENE-3653.patch-BiasedLockingStartupDelay_1.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T11:05:13.605Z">19/Dec/11 11:05</time>
                   </dd>
                   <dd class="attachment-size">
                    130 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507892" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507892/LUCENE-3653.patch-BiasedLockingStartupDelay_2.png" draggable="true" data-downloadurl="image/png:LUCENE-3653.patch-BiasedLockingStartupDelay_2.png:https://issues.apache.org/jira/secure/attachment/12507892/LUCENE-3653.patch-BiasedLockingStartupDelay_2.png" file-preview-id="12507892" file-preview-title="LUCENE-3653.patch-BiasedLockingStartupDelay_2.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507892/LUCENE-3653.patch-BiasedLockingStartupDelay_2.png" title="Latest  19/Dec/11 11:05 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:LUCENE-3653.patch-BiasedLockingStartupDelay_2.png:https://issues.apache.org/jira/secure/attachment/12507892/LUCENE-3653.patch-BiasedLockingStartupDelay_2.png" file-preview-id="12507892" file-preview-title="LUCENE-3653.patch-BiasedLockingStartupDelay_2.png" file-preview-type="image">LUCENE-3653.patch-BiasedLockingStartupDelay_2.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T11:05:13.594Z">19/Dec/11 11:05</time>
                   </dd>
                   <dd class="attachment-size">
                    129 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507891" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507891/LUCENE-3653.patch-BiasedLockingStartupDelay_3.png" draggable="true" data-downloadurl="image/png:LUCENE-3653.patch-BiasedLockingStartupDelay_3.png:https://issues.apache.org/jira/secure/attachment/12507891/LUCENE-3653.patch-BiasedLockingStartupDelay_3.png" file-preview-id="12507891" file-preview-title="LUCENE-3653.patch-BiasedLockingStartupDelay_3.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507891/LUCENE-3653.patch-BiasedLockingStartupDelay_3.png" title="Latest  19/Dec/11 11:05 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:LUCENE-3653.patch-BiasedLockingStartupDelay_3.png:https://issues.apache.org/jira/secure/attachment/12507891/LUCENE-3653.patch-BiasedLockingStartupDelay_3.png" file-preview-id="12507891" file-preview-title="LUCENE-3653.patch-BiasedLockingStartupDelay_3.png" file-preview-type="image">LUCENE-3653.patch-BiasedLockingStartupDelay_3.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T11:05:13.584Z">19/Dec/11 11:05</time>
                   </dd>
                   <dd class="attachment-size">
                    129 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507898" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507898/LUCENE-3653-no-sync.png" draggable="true" data-downloadurl="image/png:LUCENE-3653-no-sync.png:https://issues.apache.org/jira/secure/attachment/12507898/LUCENE-3653-no-sync.png" file-preview-id="12507898" file-preview-title="LUCENE-3653-no-sync.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507898/LUCENE-3653-no-sync.png" title="Latest  19/Dec/11 12:14 - Simon Willnauer" draggable="true" data-downloadurl="image/png:LUCENE-3653-no-sync.png:https://issues.apache.org/jira/secure/attachment/12507898/LUCENE-3653-no-sync.png" file-preview-id="12507898" file-preview-title="LUCENE-3653-no-sync.png" file-preview-type="image">LUCENE-3653-no-sync.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T12:14:12.731Z">19/Dec/11 12:14</time>
                   </dd>
                   <dd class="attachment-size">
                    33 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507899" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507899/LUCENE-3653-sync-.png" draggable="true" data-downloadurl="image/png:LUCENE-3653-sync-.png:https://issues.apache.org/jira/secure/attachment/12507899/LUCENE-3653-sync-.png" file-preview-id="12507899" file-preview-title="LUCENE-3653-sync-.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507899/LUCENE-3653-sync-.png" title="Latest  19/Dec/11 12:14 - Simon Willnauer" draggable="true" data-downloadurl="image/png:LUCENE-3653-sync-.png:https://issues.apache.org/jira/secure/attachment/12507899/LUCENE-3653-sync-.png" file-preview-id="12507899" file-preview-title="LUCENE-3653-sync-.png" file-preview-type="image">LUCENE-3653-sync-.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T12:14:12.749Z">19/Dec/11 12:14</time>
                   </dd>
                   <dd class="attachment-size">
                    32 kB
                   </dd>
                   <dd class="attachment-author">
                    Simon Willnauer
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507840" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507840/LUCENE-3653-VirtualMethod%2BAttributeSource.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3653-VirtualMethod+AttributeSource.patch:https://issues.apache.org/jira/secure/attachment/12507840/LUCENE-3653-VirtualMethod%2BAttributeSource.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507840/LUCENE-3653-VirtualMethod%2BAttributeSource.patch" title="Latest  18/Dec/11 17:01 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3653-VirtualMethod+AttributeSource.patch:https://issues.apache.org/jira/secure/attachment/12507840/LUCENE-3653-VirtualMethod%2BAttributeSource.patch">LUCENE-3653-VirtualMethod+AttributeSource.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-18T17:01:48.444Z">18/Dec/11 17:01</time>
                   </dd>
                   <dd class="attachment-size">
                    21 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12507821" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507821/LUCENE-3653-VirtualMethod%2BAttributeSource.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3653-VirtualMethod+AttributeSource.patch:https://issues.apache.org/jira/secure/attachment/12507821/LUCENE-3653-VirtualMethod%2BAttributeSource.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507821/LUCENE-3653-VirtualMethod%2BAttributeSource.patch" title=" 18/Dec/11 01:23 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3653-VirtualMethod+AttributeSource.patch:https://issues.apache.org/jira/secure/attachment/12507821/LUCENE-3653-VirtualMethod%2BAttributeSource.patch">LUCENE-3653-VirtualMethod+AttributeSource.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-18T01:23:52.218Z">18/Dec/11 01:23</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12507818" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507818/LUCENE-3653-VirtualMethod%2BAttributeSource.patch" draggable="true" data-downloadurl="text/plain:LUCENE-3653-VirtualMethod+AttributeSource.patch:https://issues.apache.org/jira/secure/attachment/12507818/LUCENE-3653-VirtualMethod%2BAttributeSource.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507818/LUCENE-3653-VirtualMethod%2BAttributeSource.patch" title=" 18/Dec/11 00:58 - Uwe Schindler" draggable="true" data-downloadurl="text/plain:LUCENE-3653-VirtualMethod+AttributeSource.patch:https://issues.apache.org/jira/secure/attachment/12507818/LUCENE-3653-VirtualMethod%2BAttributeSource.patch">LUCENE-3653-VirtualMethod+AttributeSource.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-18T00:58:34.215Z">18/Dec/11 00:58</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Uwe Schindler
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507822" data-issue-id="12535526" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507822/lucene-unsync.diff" draggable="true" data-downloadurl="text/x-patch:lucene-unsync.diff:https://issues.apache.org/jira/secure/attachment/12507822/lucene-unsync.diff"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507822/lucene-unsync.diff" title="Latest  18/Dec/11 01:25 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="text/x-patch:lucene-unsync.diff:https://issues.apache.org/jira/secure/attachment/12507822/lucene-unsync.diff">lucene-unsync.diff</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-18T01:25:20.762Z">18/Dec/11 01:25</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507788" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507788/profile_1_a.png" draggable="true" data-downloadurl="image/png:profile_1_a.png:https://issues.apache.org/jira/secure/attachment/12507788/profile_1_a.png" file-preview-id="12507788" file-preview-title="profile_1_a.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507788/profile_1_a.png" title="Latest  17/Dec/11 19:27 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_1_a.png:https://issues.apache.org/jira/secure/attachment/12507788/profile_1_a.png" file-preview-id="12507788" file-preview-title="profile_1_a.png" file-preview-type="image">profile_1_a.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:27:37.991Z">17/Dec/11 19:27</time>
                   </dd>
                   <dd class="attachment-size">
                    133 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507789" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507789/profile_1_b.png" draggable="true" data-downloadurl="image/png:profile_1_b.png:https://issues.apache.org/jira/secure/attachment/12507789/profile_1_b.png" file-preview-id="12507789" file-preview-title="profile_1_b.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507789/profile_1_b.png" title="Latest  17/Dec/11 19:27 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_1_b.png:https://issues.apache.org/jira/secure/attachment/12507789/profile_1_b.png" file-preview-id="12507789" file-preview-title="profile_1_b.png" file-preview-type="image">profile_1_b.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:27:38.009Z">17/Dec/11 19:27</time>
                   </dd>
                   <dd class="attachment-size">
                    143 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507790" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507790/profile_1_c.png" draggable="true" data-downloadurl="image/png:profile_1_c.png:https://issues.apache.org/jira/secure/attachment/12507790/profile_1_c.png" file-preview-id="12507790" file-preview-title="profile_1_c.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507790/profile_1_c.png" title="Latest  17/Dec/11 19:27 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_1_c.png:https://issues.apache.org/jira/secure/attachment/12507790/profile_1_c.png" file-preview-id="12507790" file-preview-title="profile_1_c.png" file-preview-type="image">profile_1_c.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:27:38.036Z">17/Dec/11 19:27</time>
                   </dd>
                   <dd class="attachment-size">
                    162 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507791" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507791/profile_1_d.png" draggable="true" data-downloadurl="image/png:profile_1_d.png:https://issues.apache.org/jira/secure/attachment/12507791/profile_1_d.png" file-preview-id="12507791" file-preview-title="profile_1_d.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507791/profile_1_d.png" title="Latest  17/Dec/11 19:27 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_1_d.png:https://issues.apache.org/jira/secure/attachment/12507791/profile_1_d.png" file-preview-id="12507791" file-preview-title="profile_1_d.png" file-preview-type="image">profile_1_d.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:27:38.045Z">17/Dec/11 19:27</time>
                   </dd>
                   <dd class="attachment-size">
                    171 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507793" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507793/profile_2_a.png" draggable="true" data-downloadurl="image/png:profile_2_a.png:https://issues.apache.org/jira/secure/attachment/12507793/profile_2_a.png" file-preview-id="12507793" file-preview-title="profile_2_a.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507793/profile_2_a.png" title="Latest  17/Dec/11 19:30 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_2_a.png:https://issues.apache.org/jira/secure/attachment/12507793/profile_2_a.png" file-preview-id="12507793" file-preview-title="profile_2_a.png" file-preview-type="image">profile_2_a.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:30:08.263Z">17/Dec/11 19:30</time>
                   </dd>
                   <dd class="attachment-size">
                    128 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507794" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507794/profile_2_b.png" draggable="true" data-downloadurl="image/png:profile_2_b.png:https://issues.apache.org/jira/secure/attachment/12507794/profile_2_b.png" file-preview-id="12507794" file-preview-title="profile_2_b.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507794/profile_2_b.png" title="Latest  17/Dec/11 19:30 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_2_b.png:https://issues.apache.org/jira/secure/attachment/12507794/profile_2_b.png" file-preview-id="12507794" file-preview-title="profile_2_b.png" file-preview-type="image">profile_2_b.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:30:08.273Z">17/Dec/11 19:30</time>
                   </dd>
                   <dd class="attachment-size">
                    160 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507795" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507795/profile_2_c.png" draggable="true" data-downloadurl="image/png:profile_2_c.png:https://issues.apache.org/jira/secure/attachment/12507795/profile_2_c.png" file-preview-id="12507795" file-preview-title="profile_2_c.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507795/profile_2_c.png" title="Latest  17/Dec/11 19:30 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:profile_2_c.png:https://issues.apache.org/jira/secure/attachment/12507795/profile_2_c.png" file-preview-id="12507795" file-preview-title="profile_2_c.png" file-preview-type="image">profile_2_c.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-17T19:30:08.281Z">17/Dec/11 19:30</time>
                   </dd>
                   <dd class="attachment-size">
                    135 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12507894" data-issue-id="12535526" data-attachment-type="image" data-attachment-thumbnail="false">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12507894/Threads-LUCENE-3653.patch.png" draggable="true" data-downloadurl="image/png:Threads-LUCENE-3653.patch.png:https://issues.apache.org/jira/secure/attachment/12507894/Threads-LUCENE-3653.patch.png" file-preview-id="12507894" file-preview-title="Threads-LUCENE-3653.patch.png" file-preview-type="image"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-image" title="PNG File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12507894/Threads-LUCENE-3653.patch.png" title="Latest  19/Dec/11 11:05 - Gerrit Jansen van Vuuren" draggable="true" data-downloadurl="image/png:Threads-LUCENE-3653.patch.png:https://issues.apache.org/jira/secure/attachment/12507894/Threads-LUCENE-3653.patch.png" file-preview-id="12507894" file-preview-title="Threads-LUCENE-3653.patch.png" file-preview-type="image">Threads-LUCENE-3653.patch.png</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2011-12-19T11:05:13.614Z">19/Dec/11 11:05</time>
                   </dd>
                   <dd class="attachment-size">
                    128 kB
                   </dd>
                   <dd class="attachment-author">
                    Gerrit Jansen van Vuuren
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_simonw" rel="simonw" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Simon Willnauer&quot;,&quot;emailAddress&quot;:&quot;simonw@apache.org&quot;,&quot;username&quot;:&quot;simonw&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="simonw"></span></span> Simon Willnauer </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_gerritjvv" rel="gerritjvv" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Gerrit Jansen van Vuuren&quot;,&quot;emailAddress&quot;:&quot;gerritjvv@gmail.com&quot;,&quot;username&quot;:&quot;gerritjvv&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="gerritjvv"></span></span> Gerrit Jansen van Vuuren </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">0</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="16/Dec/11 22:52"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-12-16T22:52:05+0000">16/Dec/11 22:52</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="10/May/13 10:43"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2013-05-10T10:43:08+0000">10/May/13 10:43</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="22/Dec/11 12:37"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-12-22T12:37:58+0000">22/Dec/11 12:37</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3653?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-3653?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13171367\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171367&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171367\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171367_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171367_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 00:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T00:30:18+0000\'\u003e17\\/Dec\\/11 00:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe problems you are mentioning are no issues at all:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eVirtualMethod is only used during class instantiations and class loading and must be synchronized. There is unlikely contention at all, just because its synchronized it does not mean its slow.\u003c\\/li\u003e\\n\\t\u003cli\u003egetAttributeInterfaces must be synchronized, too, as it has a reflection cache and is also only used during TokenStream instantiation. Analyzers should reuse TokenStreams so its not an issue at all. Fix your analyzers to resuse TokenStreams.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eOn concurency the average time increases because of eventual contention in your file system directory implementation, not because methods may be synchronized.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171367_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171367_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 00:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T00:30:18+0000\'\u003e17\\/Dec\\/11 00:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The problems you are mentioning are no issues at all: \\n \\n\\t VirtualMethod is only used during class instantiations and class loading and must be synchronized. There is unlikely contention at all, just because its synchronized it does not mean its slow. \\n\\t getAttributeInterfaces must be synchronized, too, as it has a reflection cache and is also only used during TokenStream instantiation. Analyzers should reuse TokenStreams so its not an issue at all. Fix your analyzers to resuse TokenStreams. \\n \\n\\n\\n On concurency the average time increases because of eventual contention in your file system directory implementation, not because methods may be synchronized.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171645\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171645&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171645\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171645_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171645_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:27:38+0000\'\u003e17\\/Dec\\/11 19:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eprofile_1_\u003cspan class=\\\"error\\\"\u003e&#91;x&#93;\u003c\\/span\u003e.png images shows lucene 3.4 used in the sample application App.java profiled using YourKit.\u003c\\/p\u003e\\n\\n\u003cp\u003e1_a : shows the threads Blocking.\u003cbr\\/\u003e\\n1_b : shows where the threads block. I went through all of the methods and almost all were blocking on SegmentCoreReaders\u003cbr\\/\u003e\\n1_c : Shows the monitors on which the threads are blocking.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171645_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171645_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:27:38+0000\'\u003e17\\/Dec\\/11 19:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    profile_1_ &#91;x&#93; .png images shows lucene 3.4 used in the sample application App.java profiled using YourKit. \\n\\n 1_a : shows the threads Blocking. \\n1_b : shows where the threads block. I went through all of the methods and almost all were blocking on SegmentCoreReaders \\n1_c : Shows the monitors on which the threads are blocking. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171647\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171647&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171647\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171647_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171647_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:30:08+0000\'\u003e17\\/Dec\\/11 19:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eprofile_2_\u003cspan class=\\\"error\\\"\u003e&#91;X&#93;\u003c\\/span\u003e.png shows have lucene performs after having removed all synchronized methods from SegmentCoreReaders and some other areas which I\'m still investigating if they had effect or not.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e2_a : shows the thread view. Threads are not blocking any more but there is some thread sleep going on.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171647_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171647_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:30:08+0000\'\u003e17\\/Dec\\/11 19:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    profile_2_ &#91;X&#93; .png shows have lucene performs after having removed all synchronized methods from SegmentCoreReaders and some other areas which I\'m still investigating if they had effect or not. \\n\\n\\n 2_a : shows the thread view. Threads are not blocking any more but there is some thread sleep going on. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171649\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171649&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171649\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171649_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171649_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:37:49+0000\'\u003e17\\/Dec\\/11 19:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Uwe,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the fast response. Maybe it would help you to understand my use case:\u003c\\/p\u003e\\n\\n\u003cp\u003e-------------- Start ------------------------\u003cbr\\/\u003e\\nI receive a customer request.\u003cbr\\/\u003e\\nThe create a Query based on the customer data.\u003cbr\\/\u003e\\nSearch a Lucene index in memory, not disk activity is done. i.e. I use RAMDirectory.\u003cbr\\/\u003e\\nThen return the response to the customer.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith a single request I get on average 3ms response times.\u003cbr\\/\u003e\\nIf I ramp it up to 200 requests I start getting 200-500ms response times.\u003cbr\\/\u003e\\n------------ End ------------------------\u003cbr\\/\u003e\\nFor my application every millisecond counts, just does and out of my control.\u003c\\/p\u003e\\n\\n\u003cp\u003eAssumptions:\u003cbr\\/\u003e\\n (1)  I create a new Instance of Query on each Request. The Query object is not shared ever. So, no locking is needed and no thread blocking should ever happen.\u003cbr\\/\u003e\\n (2)  The index is read only, and in memory so no OS file locking is applicable or will ever occur.\u003cbr\\/\u003e\\n (3) No index refresh happens and no writing, this is purely read only.\u003c\\/p\u003e\\n\\n\u003cp\u003ePoint is no need for locking anywhere.\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171649_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171649_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:37:49+0000\'\u003e17\\/Dec\\/11 19:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Uwe, \\n\\n Thanks for the fast response. Maybe it would help you to understand my use case: \\n\\n -------------- Start ------------------------ \\nI receive a customer request. \\nThe create a Query based on the customer data. \\nSearch a Lucene index in memory, not disk activity is done. i.e. I use RAMDirectory. \\nThen return the response to the customer. \\n\\n With a single request I get on average 3ms response times. \\nIf I ramp it up to 200 requests I start getting 200-500ms response times. \\n------------ End ------------------------ \\nFor my application every millisecond counts, just does and out of my control. \\n\\n Assumptions: \\n (1)  I create a new Instance of Query on each Request. The Query object is not shared ever. So, no locking is needed and no thread blocking should ever happen. \\n (2)  The index is read only, and in memory so no OS file locking is applicable or will ever occur. \\n (3) No index refresh happens and no writing, this is purely read only. \\n\\n Point is no need for locking anywhere. \\n\\n\\n\\n\\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171652\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171652&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171652\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171652_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171652_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:42:12+0000\'\u003e17\\/Dec\\/11 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust to explain App.java:\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve created this app to show the problem.\u003cbr\\/\u003e\\nBasically I create 500 threads.\u003cbr\\/\u003e\\n Each thread do:\u003cbr\\/\u003e\\n        Create a Single Query.\u003cbr\\/\u003e\\n        Does 10000 search requests against the lucene index.\u003cbr\\/\u003e\\n        Calculate max,min,average\u003cbr\\/\u003e\\n Wait for threads to complete.\u003cbr\\/\u003e\\n Print out max,min,average\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eThe images attached are taken from profiling while running this class.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171652_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171652_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T19:42:12+0000\'\u003e17\\/Dec\\/11 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just to explain App.java: \\n\\n I\'ve created this app to show the problem. \\nBasically I create 500 threads. \\n Each thread do: \\n        Create a Single Query. \\n        Does 10000 search requests against the lucene index. \\n        Calculate max,min,average \\n Wait for threads to complete. \\n Print out max,min,average \\n\\n\\n The images attached are taken from profiling while running this class. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171677\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171677&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171677\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171677_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171677_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 21:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T21:10:19+0000\'\u003e17\\/Dec\\/11 21:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eshort comment about your code and how to remove parts of the sync:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThe SegmentCoreReaders sync cannot be removed in Lucene 3.x, as segments are read\\/write. You can remove the synchronization partly in \u003cb\u003eyour\u003c\\/b\u003e Lucene instance by patching it, the risk is on your side! This is not a bug in Lucene. In Lucene trunk, most of this sync is removed as IndexReaders will be pure read-only. We are currently working on removing contention in SegmentReader\'s SegmentCore.\u003c\\/li\u003e\\n\\t\u003cli\u003eYou are not resusing the Analyzer. Create \u003cb\u003eone\u003c\\/b\u003e analyzer instance and reuse it for indexing and for QueryParser! When you do this, you will see no contention on TokenStream creation (VirtualMethod.getImplementationDistance, AttributeSource.getAttributeInterfaces). TokenStream creation by Analyzers is a heavy operation (not only the reflection cache contention), so use only one Analyzer per app and pass it to all you QueryParsers. Removing sync from AttributeSource\\/VirtualMethod caches will corrupt the cache and cause bugs - but thats unneeded if you reuse as already said.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171677_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171677_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 21:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T21:10:19+0000\'\u003e17\\/Dec\\/11 21:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n short comment about your code and how to remove parts of the sync: \\n \\n\\t The SegmentCoreReaders sync cannot be removed in Lucene 3.x, as segments are read\\/write. You can remove the synchronization partly in  your  Lucene instance by patching it, the risk is on your side! This is not a bug in Lucene. In Lucene trunk, most of this sync is removed as IndexReaders will be pure read-only. We are currently working on removing contention in SegmentReader\'s SegmentCore. \\n\\t You are not resusing the Analyzer. Create  one  analyzer instance and reuse it for indexing and for QueryParser! When you do this, you will see no contention on TokenStream creation (VirtualMethod.getImplementationDistance, AttributeSource.getAttributeInterfaces). TokenStream creation by Analyzers is a heavy operation (not only the reflection cache contention), so use only one Analyzer per app and pass it to all you QueryParsers. Removing sync from AttributeSource\\/VirtualMethod caches will corrupt the cache and cause bugs - but thats unneeded if you reuse as already said. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171691\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171691&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171691\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13171691_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171691_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 22:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T22:10:50+0000\'\u003e17\\/Dec\\/11 22:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe SegmentCoreReaders sync cannot be removed in Lucene 3.x, as segments are read\\/write. You can remove the synchronization partly in your Lucene instance by patching it, the risk is on your side! This is not a bug in Lucene. In Lucene trunk, most of this sync is removed as IndexReaders will be pure read-only. We are currently working on removing contention in SegmentReader\'s SegmentCore.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eUwe, I had a quick look at it and I think we can remove this. We set the tis in the ctor or if we load a NRT reader. So basically we can assign the tisNoIndex reader to the tis instead of leaving it will a null ref and use a second boolean to actually signal if it was loaded or not. for read access this is not necessarily required to be synced since if you pull a NRT reader you can rely on the IW sync \\/ mem barrier to see the latest reference. I will take a closer look at this next week.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13171691_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171691_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 22:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T22:10:50+0000\'\u003e17\\/Dec\\/11 22:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The SegmentCoreReaders sync cannot be removed in Lucene 3.x, as segments are read\\/write. You can remove the synchronization partly in your Lucene instance by patching it, the risk is on your side! This is not a bug in Lucene. In Lucene trunk, most of this sync is removed as IndexReaders will be pure read-only. We are currently working on removing contention in SegmentReader\'s SegmentCore.  \\n\\n Uwe, I had a quick look at it and I think we can remove this. We set the tis in the ctor or if we load a NRT reader. So basically we can assign the tisNoIndex reader to the tis instead of leaving it will a null ref and use a second boolean to actually signal if it was loaded or not. for read access this is not necessarily required to be synced since if you pull a NRT reader you can rely on the IW sync \\/ mem barrier to see the latest reference. I will take a closer look at this next week.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171697\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171697&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171697\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171697_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171697_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T22:26:55+0000\'\u003e17\\/Dec\\/11 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Simon, Mike is currently working on that in Trunk (SegmentReader is getting so simple now...). For 3.x your solution might work.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171697_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171697_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/11 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-17T22:26:55+0000\'\u003e17\\/Dec\\/11 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Simon, Mike is currently working on that in Trunk (SegmentReader is getting so simple now...). For 3.x your solution might work.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171726\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171726&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171726\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171726_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171726_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 00:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T00:58:34+0000\'\u003e18\\/Dec\\/11 00:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Dec\\/11 01:05\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBased on my work for another issue I added removal of synchronization for the caches in VirtualMethod and AttributeSource. As those caches are generally read (should be without synchronization) and seldom populated, ConcurrentHashMap is the best choice, as gets are without locks.\u003cbr\\/\u003e\\nThe problem is that those reflection caches need a WeakHashMap, but there is no ConcurrentWeakHashMap. Based on the work on issue \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3531\\\" title=\\\"Improve CachingWrapperFilter to optionally also cache acceptDocs, if identical to liveDocs\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3531\\\"\u003e\u003cdel\u003eLUCENE-3531\u003c\\/del\u003e\u003c\\/a\u003e, I reactivated my WeakIdentityMap and made the backing map exchangeable (there are 2 static factory methods allowing ConcurrentHashMap or simple HashMaps as backing map). For the reflection caches, identity is also fine (Class.equals\\/hashcode is based on class identity). The reflection caches also have no problem doing the heavy reflection work twice if two threads are requesting the same class at the same time - work is done twice and stored twice in map, but who cares?\u003c\\/p\u003e\\n\\n\u003cp\u003eThis patch improves concurrency on creation of TokenStreams and instantiation of all classes using VirtualMethod for backwards compatibility.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171726_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171726_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 00:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T00:58:34+0000\'\u003e18\\/Dec\\/11 00:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Dec\\/11 01:05\\\"\u003eedited\u003c\\/span\u003e                   Based on my work for another issue I added removal of synchronization for the caches in VirtualMethod and AttributeSource. As those caches are generally read (should be without synchronization) and seldom populated, ConcurrentHashMap is the best choice, as gets are without locks. \\nThe problem is that those reflection caches need a WeakHashMap, but there is no ConcurrentWeakHashMap. Based on the work on issue   LUCENE-3531  , I reactivated my WeakIdentityMap and made the backing map exchangeable (there are 2 static factory methods allowing ConcurrentHashMap or simple HashMaps as backing map). For the reflection caches, identity is also fine (Class.equals\\/hashcode is based on class identity). The reflection caches also have no problem doing the heavy reflection work twice if two threads are requesting the same class at the same time - work is done twice and stored twice in map, but who cares? \\n\\n This patch improves concurrency on creation of TokenStreams and instantiation of all classes using VirtualMethod for backwards compatibility.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171739\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171739&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171739\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171739_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171739_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 01:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T01:23:52+0000\'\u003e18\\/Dec\\/11 01:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch (code cleanup, javadocs)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171739_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171739_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 01:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T01:23:52+0000\'\u003e18\\/Dec\\/11 01:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch (code cleanup, javadocs)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171742\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171742&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171742\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171742_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171742_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T01:24:42+0000\'\u003e18\\/Dec\\/11 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 18\\/Dec\\/11 01:25\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, I\'ll keep an eye on the things happening in the trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eCreating a Single Tokenizer does help, but the thread blocking still happens because of the synchronization used in several classes.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve made some quick changes during the last few days on lucene-3.5, and have included the diff. (this is not an svn diff sorry).\u003c\\/p\u003e\\n\\n\u003cp\u003eI agree, if anybody has to decide between, concurrency or storing things twice then concurrency wins, eventually all the cache data will be available to all threads, and the overhead goes away. But with synchronization the overhead never goes away.\u003c\\/p\u003e\\n\\n\u003cp\u003eSome other points of contention are:\u003cbr\\/\u003e\\n RAMFile : all methods are synchronized.\u003cbr\\/\u003e\\n RAMInputStream: clone() \u003cbr\\/\u003e\\n             This method came up during the profiling allot. I changed it from calling clone to: just create an new instance directly.\u003c\\/p\u003e\\n\\n\\n\\n\u003cp\u003eI\'ll try to cleanup some of the code and add a better diff.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171742_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171742_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T01:24:42+0000\'\u003e18\\/Dec\\/11 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 18\\/Dec\\/11 01:25\\\"\u003eedited\u003c\\/span\u003e                   Thanks, I\'ll keep an eye on the things happening in the trunk. \\n\\n Creating a Single Tokenizer does help, but the thread blocking still happens because of the synchronization used in several classes. \\n\\n I\'ve made some quick changes during the last few days on lucene-3.5, and have included the diff. (this is not an svn diff sorry). \\n\\n I agree, if anybody has to decide between, concurrency or storing things twice then concurrency wins, eventually all the cache data will be available to all threads, and the overhead goes away. But with synchronization the overhead never goes away. \\n\\n Some other points of contention are: \\n RAMFile : all methods are synchronized. \\n RAMInputStream: clone()  \\n             This method came up during the profiling allot. I changed it from calling clone to: just create an new instance directly. \\n\\n\\n\\n I\'ll try to cleanup some of the code and add a better diff. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171754\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171754&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171754\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171754_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171754_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 02:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T02:03:55+0000\'\u003e18\\/Dec\\/11 02:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Dec\\/11 02:04\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eCreating a Single -Tokenizer-Analyzer does help, but the thread blocking still happens because of the synchronization used in several classes.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNot reusing is stupid because of heavy construction cost (not contention)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI agree, if anybody has to decide between, concurrency or storing things twice then concurrency wins, eventually all the cache data will be available to all threads, and the overhead goes away. But with synchronization the overhead never goes away.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere are places where we cannot remove synchronization - and those places are no issue at all. Just because there is synchronization, there is not necessarily a bottleneck. Not everything you mention is an issue.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eRAMFile : all methods are synchronized.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere is contention, but will not slowdown your search. Please keep synchronization there. every RAMFile is only opened once and then contention is gone. Not everything what your profiler shows as contention is one, only the first query will have some minor contention.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eRAMInputStream: clone() This method came up during the profiling allot. I changed it from calling clone to: just create an new instance directly.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats fine, but same applies here. You only have contention on first few queries.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'ll try to cleanup some of the code and add a better diff.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe VirtualMethod and AttributeSource is already fixed in my patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the time-line of your profiler output I see no improvement in speed. How much faster does your code get?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171754_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171754_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 02:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T02:03:55+0000\'\u003e18\\/Dec\\/11 02:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 18\\/Dec\\/11 02:04\\\"\u003eedited\u003c\\/span\u003e                    Creating a Single -Tokenizer-Analyzer does help, but the thread blocking still happens because of the synchronization used in several classes.  \\n\\n Not reusing is stupid because of heavy construction cost (not contention) \\n\\n  I agree, if anybody has to decide between, concurrency or storing things twice then concurrency wins, eventually all the cache data will be available to all threads, and the overhead goes away. But with synchronization the overhead never goes away.  \\n\\n There are places where we cannot remove synchronization - and those places are no issue at all. Just because there is synchronization, there is not necessarily a bottleneck. Not everything you mention is an issue. \\n\\n  RAMFile : all methods are synchronized.  \\n\\n There is contention, but will not slowdown your search. Please keep synchronization there. every RAMFile is only opened once and then contention is gone. Not everything what your profiler shows as contention is one, only the first query will have some minor contention. \\n\\n  RAMInputStream: clone() This method came up during the profiling allot. I changed it from calling clone to: just create an new instance directly.  \\n\\n Thats fine, but same applies here. You only have contention on first few queries. \\n\\n  I\'ll try to cleanup some of the code and add a better diff.  \\n\\n The VirtualMethod and AttributeSource is already fixed in my patch. \\n\\n On the time-line of your profiler output I see no improvement in speed. How much faster does your code get?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171760\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171760&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171760\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171760_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171760_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 02:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T02:42:18+0000\'\u003e18\\/Dec\\/11 02:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 18\\/Dec\\/11 02:43\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eThere is contention, but will not slowdown your search. Please keep synchronization there. every RAMFile is\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eonly opened once and then contention is gone.\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eI\'m not clear on this one, you mean every RAMFile is opened once per search? or Will be reused across all searches? If the later all threads will block on RAMFile always, this is not minor but major, especially taking into account that I want to move from 200 concurrent requests to 8000.\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eNot everything what your profiler shows as contention is one,only the first query will have some minor contention.\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003e\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  yes indeed. Thats why I\'ve run several tests with warmups and try to fish out based on call frequency, total time spent and total time a Thread  was blocking on a certain monitor.\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eOn the time-line of your profiler output I see no improvement in speed. How much faster does your code get?\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eI\'ve not profiled for individual search speed, but rather for contention, doing the tests on my laptop first and will move these changes to a production system during next week to test total search time with loading.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith the current version i.e. with the synchronization in there the search times go up drastically, as I\'ve mentioned above. On our production deploy and indexes search times go from 3ms on single requests to 200-500ms and more on average when 200 concurrent requests are made. \u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171760_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171760_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 02:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T02:42:18+0000\'\u003e18\\/Dec\\/11 02:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 18\\/Dec\\/11 02:43\\\"\u003eedited\u003c\\/span\u003e                   \\n  \\n \\n There is contention, but will not slowdown your search. Please keep synchronization there. every RAMFile is \\n \\n \\n only opened once and then contention is gone. \\n \\n  \\n \\n\\n\\n I\'m not clear on this one, you mean every RAMFile is opened once per search? or Will be reused across all searches? If the later all threads will block on RAMFile always, this is not minor but major, especially taking into account that I want to move from 200 concurrent requests to 8000. \\n\\n \\n  \\n \\n Not everything what your profiler shows as contention is one,only the first query will have some minor contention. \\n \\n  \\n \\n\\n\\n    yes indeed. Thats why I\'ve run several tests with warmups and try to fish out based on call frequency, total time spent and total time a Thread  was blocking on a certain monitor. \\n\\n \\n  \\n \\n On the time-line of your profiler output I see no improvement in speed. How much faster does your code get? \\n \\n  \\n \\n\\n\\n I\'ve not profiled for individual search speed, but rather for contention, doing the tests on my laptop first and will move these changes to a production system during next week to test total search time with loading. \\n\\n With the current version i.e. with the synchronization in there the search times go up drastically, as I\'ve mentioned above. On our production deploy and indexes search times go from 3ms on single requests to 200-500ms and more on average when 200 concurrent requests are made.  \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171800\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171800&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171800\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171800_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171800_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 08:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T08:47:55+0000\'\u003e18\\/Dec\\/11 08:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'m not clear on this one, you mean every RAMFile is opened once per search? or Will be reused across all searches? If the later all threads will block on RAMFile always, this is not minor but major, especially taking into account that I want to move from 200 concurrent requests to 8000.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOnce per opening IndexReader, during searches there is no file open\\/closing done at all. Synchronization on the directory of files is only done when writing the files, and only when opening files during IndexReader openm, but not on every access. When files are deleted there are other contention points, but not during searches, as IndexReader is opened R\\/O.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171800_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171800_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 08:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T08:47:55+0000\'\u003e18\\/Dec\\/11 08:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'m not clear on this one, you mean every RAMFile is opened once per search? or Will be reused across all searches? If the later all threads will block on RAMFile always, this is not minor but major, especially taking into account that I want to move from 200 concurrent requests to 8000.  \\n\\n Once per opening IndexReader, during searches there is no file open\\/closing done at all. Synchronization on the directory of files is only done when writing the files, and only when opening files during IndexReader openm, but not on every access. When files are deleted there are other contention points, but not during searches, as IndexReader is opened R\\/O.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171858\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171858&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171858\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171858_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171858_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 13:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T13:01:37+0000\'\u003e18\\/Dec\\/11 13:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, so for searching (after loading) the RAMFile synced methods would not be called, now bare with me for a moment:\u003c\\/p\u003e\\n\\n\u003cp\u003eThis does not seem to be the case when you retrieve the Document, which is probably to be expected.\u003cbr\\/\u003e\\nIn my code I do:\u003c\\/p\u003e\\n\\n\u003cp\u003esearcher.doc(matched\u003cspan class=\\\"error\\\"\u003e&#91;i&#93;\u003c\\/span\u003e.doc) \\/\\/searcher == IndexSearcer and matched[] == ScoreDoc[] \u003c\\/p\u003e\\n\\n\u003cp\u003eIn my code I see the following call trace (Top to Bottom):\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eIndexSearcher.doc\u003cbr\\/\u003e\\nIndexReader.document\u003cbr\\/\u003e\\nDirectoryReader.document\u003cbr\\/\u003e\\nSegementReader.document\u003cbr\\/\u003e\\nFieldsReader.doc\u003cbr\\/\u003e\\nRAMInputStream.seek\u003cbr\\/\u003e\\nRAMInputStream.switchCurrentBuffer\u003cbr\\/\u003e\\nRAMFile.getBuffer\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eWhich means I can search concurrently but as soon as I try to retrieve something again I hit contention. \u003cbr\\/\u003e\\nNow I appreciate that with File IO this is required but a fully in memory index should not have these problems. I\'m trying to change the RAMFile usage so that it does not require synchronization.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13171858_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171858_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 13:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T13:01:37+0000\'\u003e18\\/Dec\\/11 13:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, so for searching (after loading) the RAMFile synced methods would not be called, now bare with me for a moment: \\n\\n This does not seem to be the case when you retrieve the Document, which is probably to be expected. \\nIn my code I do: \\n\\n searcher.doc(matched &#91;i&#93; .doc) \\/\\/searcher == IndexSearcer and matched[] == ScoreDoc[]  \\n\\n In my code I see the following call trace (Top to Bottom): \\n\\n\\n IndexSearcher.doc \\nIndexReader.document \\nDirectoryReader.document \\nSegementReader.document \\nFieldsReader.doc \\nRAMInputStream.seek \\nRAMInputStream.switchCurrentBuffer \\nRAMFile.getBuffer \\n\\n\\n Which means I can search concurrently but as soon as I try to retrieve something again I hit contention.  \\nNow I appreciate that with File IO this is required but a fully in memory index should not have these problems. I\'m trying to change the RAMFile usage so that it does not require synchronization. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171899\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171899&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171899\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171899_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171899_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T17:01:48+0000\'\u003e18\\/Dec\\/11 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch with test for the concurrent weak hash map. I will commit this to 3.x and trunk as it improves the sophisticated\\u2122 backwards layers and creation cost of AttributeSource (because ConcurrentHashMap has lockless get).\u003c\\/p\u003e\\n\\n\u003cp\u003eI will keep this issue open for Simon to check the SegmentCoreReaders.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171899_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171899_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T17:01:48+0000\'\u003e18\\/Dec\\/11 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch with test for the concurrent weak hash map. I will commit this to 3.x and trunk as it improves the sophisticated\\u2122 backwards layers and creation cost of AttributeSource (because ConcurrentHashMap has lockless get). \\n\\n I will keep this issue open for Simon to check the SegmentCoreReaders.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171905\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171905&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171905\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171905_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171905_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 17:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T17:36:35+0000\'\u003e18\\/Dec\\/11 17:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted VirtualMethod\\/AttributeSource improvements in trunk revision: 1220458, 3.x revision: 1220464\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171905_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171905_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 17:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T17:36:35+0000\'\u003e18\\/Dec\\/11 17:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed VirtualMethod\\/AttributeSource improvements in trunk revision: 1220458, 3.x revision: 1220464              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13171949\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13171949&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13171949\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171949_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171949_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T22:35:35+0000\'\u003e18\\/Dec\\/11 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted improvement for WeakIndentityMap to not use ReferenceQueue on get\\/contains\\/remove operations, only put (trunk: 1220555, 3.x:  r1220557)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13171949_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13171949_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/11 22:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-18T22:35:35+0000\'\u003e18\\/Dec\\/11 22:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed improvement for WeakIndentityMap to not use ReferenceQueue on get\\/contains\\/remove operations, only put (trunk: 1220555, 3.x:  r1220557)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172111\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172111&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172111\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172111_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172111_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 08:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T08:51:28+0000\'\u003e19\\/Dec\\/11 08:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGerrit, before I spend time on fixing this single IMO likely uncontented lock in org.apache.lucene.index.SegmentCoreReaders.getTermsReader() can I ask you to run your tests \\/ benchmarks with -XX:BiasedLockingStartupDelay=0 as far as I can see you are running micro benchmarks which start up very quickly. Locks accessed right after startup behave differently in the JVM than other locks ie. sync blocks. Can you retest and report back?\u003c\\/p\u003e\\n\\n\u003cp\u003esimon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172111_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172111_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 08:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T08:51:28+0000\'\u003e19\\/Dec\\/11 08:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Gerrit, before I spend time on fixing this single IMO likely uncontented lock in org.apache.lucene.index.SegmentCoreReaders.getTermsReader() can I ask you to run your tests \\/ benchmarks with -XX:BiasedLockingStartupDelay=0 as far as I can see you are running micro benchmarks which start up very quickly. Locks accessed right after startup behave differently in the JVM than other locks ie. sync blocks. Can you retest and report back? \\n\\n simon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172114\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172114&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172114\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172114_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172114_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 08:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T08:59:14+0000\'\u003e19\\/Dec\\/11 08:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere is a patch that removes the sync on SegmentCoreReaders#getTermsReader() - since this method is access on basically every search we should try to prevent any sync even if they are cheap in the uncontended case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172114_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172114_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 08:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T08:59:14+0000\'\u003e19\\/Dec\\/11 08:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here is a patch that removes the sync on SegmentCoreReaders#getTermsReader() - since this method is access on basically every search we should try to prevent any sync even if they are cheap in the uncontended case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172167\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172167&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172167\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172167_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172167_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 10:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T10:10:09+0000\'\u003e19\\/Dec\\/11 10:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Simon,\u003cbr\\/\u003e\\nThanks, I\'ll try these on our production systems.\u003cbr\\/\u003e\\nOne other change I\'ve made, which I\'ll submit a patch for (pending testing) is introducing a ReadonlyRAMFile.\u003c\\/p\u003e\\n\\n\u003cp\u003eSearch for my use case is split into two:\u003cbr\\/\u003e\\n             (1) Search \u003cbr\\/\u003e\\n             (2) Get Stored data from index.\u003cbr\\/\u003e\\nNow in an in memory index almost zero locking can be achieved.\u003cbr\\/\u003e\\n   All the patches will do great for (1), the ReadonlyRAMFile seems to solve item (2).\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172167_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172167_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 10:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T10:10:09+0000\'\u003e19\\/Dec\\/11 10:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Simon, \\nThanks, I\'ll try these on our production systems. \\nOne other change I\'ve made, which I\'ll submit a patch for (pending testing) is introducing a ReadonlyRAMFile. \\n\\n Search for my use case is split into two: \\n             (1) Search  \\n             (2) Get Stored data from index. \\nNow in an in memory index almost zero locking can be achieved. \\n   All the patches will do great for (1), the ReadonlyRAMFile seems to solve item (2). \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172190\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172190&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172190\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172190_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172190_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 11:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T11:05:13+0000\'\u003e19\\/Dec\\/11 11:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThese are the results from profiling with the Latest trunk checkout as from 2011-12-19 11:03.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe Thread-LUCENE_3653.patch.png is without BiasedLockingStartupDelay.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe others are with this option added to java + the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve included 3 images of the later so show that contention has improved but still other areas of contention exist that are probably related to the RAMFile itself being fully synchronized.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172190_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172190_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 11:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T11:05:13+0000\'\u003e19\\/Dec\\/11 11:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    These are the results from profiling with the Latest trunk checkout as from 2011-12-19 11:03. \\n\\n The Thread-LUCENE_3653.patch.png is without BiasedLockingStartupDelay. \\n\\n The others are with this option added to java + the patch. \\n\\n I\'ve included 3 images of the later so show that contention has improved but still other areas of contention exist that are probably related to the RAMFile itself being fully synchronized.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172210\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172210&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172210\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172210_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172210_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 11:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T11:47:44+0000\'\u003e19\\/Dec\\/11 11:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think this is all profiler ghosts.\u003c\\/p\u003e\\n\\n\u003cp\u003eGuys lets be careful not to introduce bugs over what isn\'t a performance problem at all.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172210_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172210_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 11:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T11:47:44+0000\'\u003e19\\/Dec\\/11 11:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think this is all profiler ghosts. \\n\\n Guys lets be careful not to introduce bugs over what isn\'t a performance problem at all.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172214\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172214&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172214\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13172214_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172214_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:01:40+0000\'\u003e19\\/Dec\\/11 12:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhy are we using ConcurrentHashMap when we know there\'s a JVM deadlock bug, on certain 1.5.x\'s and certain CPUs...?  (\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3235\\\" title=\\\"TestDoubleBarrelLRUCache hangs under Java 1.5, 3.x and trunk, likely JVM bug\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3235\\\"\u003eLUCENE-3235\u003c\\/a\u003e)\u003c\\/p\u003e\\n\\n\u003cp\u003eShouldn\'t we move in the other direction here (don\'t use CHM unless it cannot be avoided)?\u003c\\/p\u003e\\n\\n\u003cp\u003eFor example it\'s crazy to use this class to back the core\\/reader closed listeners.... and I don\'t think we should back the AttrSource with it...?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13172214_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172214_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:01:40+0000\'\u003e19\\/Dec\\/11 12:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Why are we using ConcurrentHashMap when we know there\'s a JVM deadlock bug, on certain 1.5.x\'s and certain CPUs...?  ( LUCENE-3235 ) \\n\\n Shouldn\'t we move in the other direction here (don\'t use CHM unless it cannot be avoided)? \\n\\n For example it\'s crazy to use this class to back the core\\/reader closed listeners.... and I don\'t think we should back the AttrSource with it...?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172217\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172217&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172217\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172217_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172217_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:12:50+0000\'\u003e19\\/Dec\\/11 12:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eFor example it\'s crazy to use this class to back the core\\/reader closed listeners.... and I don\'t think we should back the AttrSource with it...?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCHM is only risky on contention. Contention here is unlikely as once all classes are \\\"inspected\\\" there are only read accesses.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn my tests, creating lots of AttributeSources and IndexSearchers are improved. The problem is that both VirtualMethod and AttributeSource block on construction on these cache locks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172217_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172217_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:12:50+0000\'\u003e19\\/Dec\\/11 12:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     For example it\'s crazy to use this class to back the core\\/reader closed listeners.... and I don\'t think we should back the AttrSource with it...?  \\n\\n CHM is only risky on contention. Contention here is unlikely as once all classes are \\\"inspected\\\" there are only read accesses. \\n\\n On my tests, creating lots of AttributeSources and IndexSearchers are improved. The problem is that both VirtualMethod and AttributeSource block on construction on these cache locks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172218\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172218&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172218\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172218_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172218_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:13:00+0000\'\u003e19\\/Dec\\/11 12:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGerrit, I looked at your test and what you are seeing with soo many threads is certainly profiler ghosts. 500 threads is a lot even on a highly concurrent system. the blocking you see might not be due to a monitor.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think this is all profiler ghosts.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eI disagree I ran Gerrits simple test with 100 threads and its 2x faster without the locking on SegmentCoreReaders#getTermsReader() I agree this is not the part which takes time on a big index but this locking is certainly unnecessary and it takes up CPU resources. We should make the path down the IR as efficient as possible. \u003c\\/p\u003e\\n\\n\u003cp\u003eI will attache my profiling session with and without the patch and you will see the differences.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172218_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172218_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:13:00+0000\'\u003e19\\/Dec\\/11 12:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Gerrit, I looked at your test and what you are seeing with soo many threads is certainly profiler ghosts. 500 threads is a lot even on a highly concurrent system. the blocking you see might not be due to a monitor. \\n\\n  I think this is all profiler ghosts.  \\n I disagree I ran Gerrits simple test with 100 threads and its 2x faster without the locking on SegmentCoreReaders#getTermsReader() I agree this is not the part which takes time on a big index but this locking is certainly unnecessary and it takes up CPU resources. We should make the path down the IR as efficient as possible.  \\n\\n I will attache my profiling session with and without the patch and you will see the differences.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172219\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172219&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172219\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172219_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172219_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:14:12+0000\'\u003e19\\/Dec\\/11 12:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehere are two runs with 100 threads and 100000 iterations per thread. I think this is definitly something we can prevent with the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3653\\\" title=\\\"Lucene Search not scalling\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3653\\\"\u003e\u003cdel\u003eLUCENE-3653\u003c\\/del\u003e\u003c\\/a\u003e.patch\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172219_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172219_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:14:12+0000\'\u003e19\\/Dec\\/11 12:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    here are two runs with 100 threads and 100000 iterations per thread. I think this is definitly something we can prevent with the   LUCENE-3653  .patch              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172224\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172224&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172224\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172224_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172224_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:22:02+0000\'\u003e19\\/Dec\\/11 12:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI disagree I ran Gerrits simple test with 100 threads and its 2x faster without the locking on SegmentCoreReaders#getTermsReader() \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWait, if this stuff is a big problem, surely we can just use luceneutil with lots of threads right?\u003c\\/p\u003e\\n\\n\u003cp\u003eI want to see the QPS change, I don\'t trust the benchmarks or the various fancy jvm tools being used on this issue. I think its all ghosts.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172224_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172224_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:22:02+0000\'\u003e19\\/Dec\\/11 12:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I disagree I ran Gerrits simple test with 100 threads and its 2x faster without the locking on SegmentCoreReaders#getTermsReader()   \\n\\n Wait, if this stuff is a big problem, surely we can just use luceneutil with lots of threads right? \\n\\n I want to see the QPS change, I don\'t trust the benchmarks or the various fancy jvm tools being used on this issue. I think its all ghosts.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172229\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172229&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172229\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172229_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172229_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:32:51+0000\'\u003e19\\/Dec\\/11 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWait, if this stuff is a big problem, surely we can just use luceneutil with lots of threads right?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eas I said, the index is tiny so just measuring the overhead of the lock on SegmentCoreReaders#getTermsReader() - this is a low hanging fruit IMO which we should pick even  if there is no real change in QPS. Its unnecessary and the patch is simple, any objections?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172229_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172229_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:32:51+0000\'\u003e19\\/Dec\\/11 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Wait, if this stuff is a big problem, surely we can just use luceneutil with lots of threads right?  \\n as I said, the index is tiny so just measuring the overhead of the lock on SegmentCoreReaders#getTermsReader() - this is a low hanging fruit IMO which we should pick even  if there is no real change in QPS. Its unnecessary and the patch is simple, any objections?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172234\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172234&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172234\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172234_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172234_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:37:26+0000\'\u003e19\\/Dec\\/11 12:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI general if we can remove contention anywhere we should do it. As I said, contention on thing that generally only reads but very seldom writes is horrible. Just write a test that creates 200 threads and creates TokenStreams or IndexSearchers (around a single IndexReader). They will all lock on the cache (ok, without reflection cache it would even be slower...)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172234_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172234_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:37:26+0000\'\u003e19\\/Dec\\/11 12:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I general if we can remove contention anywhere we should do it. As I said, contention on thing that generally only reads but very seldom writes is horrible. Just write a test that creates 200 threads and creates TokenStreams or IndexSearchers (around a single IndexReader). They will all lock on the cache (ok, without reflection cache it would even be slower...)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:50:32+0000\'\u003e19\\/Dec\\/11 12:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eJust write a test that creates 200 threads and creates TokenStreams or IndexSearchers (around a single IndexReader). They will all lock on the cache (ok, without reflection cache it would even be slower...)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t care. They should be reusing tokenstreams in their application.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe don\'t need to make lucene more complicated to (possibly) speed up someones broken code.\u003c\\/p\u003e\\n\\n\u003cp\u003eLots of commits here, a title that says \'lucene doesn\'t scale, lots of arguing that there are locking problems, but not one luceneutil benchmark run?\u003c\\/p\u003e\\n\\n\u003cp\u003eSeriously?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 12:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T12:50:32+0000\'\u003e19\\/Dec\\/11 12:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Just write a test that creates 200 threads and creates TokenStreams or IndexSearchers (around a single IndexReader). They will all lock on the cache (ok, without reflection cache it would even be slower...)  \\n\\n I don\'t care. They should be reusing tokenstreams in their application. \\n\\n We don\'t need to make lucene more complicated to (possibly) speed up someones broken code. \\n\\n Lots of commits here, a title that says \'lucene doesn\'t scale, lots of arguing that there are locking problems, but not one luceneutil benchmark run? \\n\\n Seriously?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172258\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172258&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172258\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172258_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172258_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 13:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T13:22:24+0000\'\u003e19\\/Dec\\/11 13:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe code for the commit was standing here more than 24 hours and was tested extensively to remove contention on creation on all classes using VirtualMethod (IndexSearcher and TokenStream are only example). What\'s your problem with it? The latest commit 1 hr ago was only a fix in the tests and had nothing to do with ConcurrentHashMap.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs I said, CHM is used for read-access only, but the guard is needed, if two ctors are running at same time and need to add a new entry to cache. All other cases are read-only, so lockless is better. It is just stupid to wait on a ctor, just because there is a lock on a map thats never be updated once your code is running an no new classes using VirtualMethod are loaded. We can also use Google Guava to use their MapMaker or wait until Java 8, where Doug Lea\'s ConcurrentWeakHashMap is maybe added (JSR-166).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact the code of AttributeSource got simplier because we have no sync blocks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172258_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172258_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 13:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T13:22:24+0000\'\u003e19\\/Dec\\/11 13:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The code for the commit was standing here more than 24 hours and was tested extensively to remove contention on creation on all classes using VirtualMethod (IndexSearcher and TokenStream are only example). What\'s your problem with it? The latest commit 1 hr ago was only a fix in the tests and had nothing to do with ConcurrentHashMap. \\n\\n As I said, CHM is used for read-access only, but the guard is needed, if two ctors are running at same time and need to add a new entry to cache. All other cases are read-only, so lockless is better. It is just stupid to wait on a ctor, just because there is a lock on a map thats never be updated once your code is running an no new classes using VirtualMethod are loaded. We can also use Google Guava to use their MapMaker or wait until Java 8, where Doug Lea\'s ConcurrentWeakHashMap is maybe added (JSR-166). \\n\\n In fact the code of AttributeSource got simplier because we have no sync blocks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172274\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172274&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172274\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172274_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172274_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 13:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T13:48:16+0000\'\u003e19\\/Dec\\/11 13:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 13:50\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eFor example it\'s crazy to use this class \u003cspan class=\\\"error\\\"\u003e&#91;ConcurrentHashMap&#93;\u003c\\/span\u003e to back the core\\/reader closed listeners\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis is indeed totally crazy, as this is the wrong use-case for this map. This map should be used when you have lot\'s of reads and less writes to the map. For this case, you have only one thread reading (on close only, LOL), but maybe mayn adding listeners. So this is in general a bug to use CHM here. Should be a simple sycnrhonized HashMap (which performs better on writes, as it has less complexity inside).\u003c\\/p\u003e\\n\\n\u003cp\u003e=&gt; We should open issue for that!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172274_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172274_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 13:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T13:48:16+0000\'\u003e19\\/Dec\\/11 13:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 13:50\\\"\u003eedited\u003c\\/span\u003e                    For example it\'s crazy to use this class  &#91;ConcurrentHashMap&#93;  to back the core\\/reader closed listeners  \\n\\n This is indeed totally crazy, as this is the wrong use-case for this map. This map should be used when you have lot\'s of reads and less writes to the map. For this case, you have only one thread reading (on close only, LOL), but maybe mayn adding listeners. So this is in general a bug to use CHM here. Should be a simple sycnrhonized HashMap (which performs better on writes, as it has less complexity inside). \\n\\n =&gt; We should open issue for that!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172289\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172289&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172289\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172289_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172289_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:08:13+0000\'\u003e19\\/Dec\\/11 14:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 19\\/Dec\\/11 14:08\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust to clear up on some comments:\u003c\\/p\u003e\\n\\n\u003cp\u003eGuys I\'m testing this on a production deploy and the use case is simple. Parser Query, Search, Get Doc fields. Contention was seen without profiling and profiling was used to find where the contention in the application.\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eI don\'t care. They should be reusing tokenstreams in their application.\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eToken streams is not the only place of contention discussed here. Please look at the test attached (App.java). It does not recreate the token streams on each search, only (by mistake) for each thread. But still this only has a very small impact. Searches are repeated from each thread reusing the same token stream.\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eWe don\'t need to make lucene more complicated to (possibly) speed up someones broken code.\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003ePlease write an example and show me your findings. I\'ve done the same already. Have a look at App.java\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eI want to see the QPS change, I don\'t trust the benchmarks or the various fancy jvm tools being used on this issue. \u003cbr\\/\u003e\\nI think its all ghosts.\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eYourkit is a standard Profiling tool. I didn\'t just wake up and say hey I\'ll profile lucene. I only started after I noticed the contention on a production application where we are trying to use lucene in memory.\u003c\\/p\u003e\\n\\n\u003cdiv class=\'table-wrap\'\u003e\\n\u003ctable class=\'confluenceTable\'\u003e\u003ctbody\u003e\\n\u003ctr\u003e\\n\u003ctd class=\'confluenceTd\'\u003eLots of commits here, a title that says \'lucene doesn\'t scale, lots of arguing that there are locking problems, but not one luceneutil benchmark run\u003c\\/td\u003e\\n\u003c\\/tr\u003e\\n\u003c\\/tbody\u003e\u003c\\/table\u003e\\n\u003c\\/div\u003e\\n\\n\\n\u003cp\u003e??, You don\'t need to be a scientist nor use a profiling tool to see that all threads will block on a synchronized block or method on each request if that method is called during each search request, from that it doesn\'t take much to know that this does not scale. \u003c\\/p\u003e\\n\\n\\n\u003cp\u003eAgain, this is not a go at lucene, the heading \'Lucene Search not scalling\' is causing toooo much problems here I see, I could have chosen a better heading and if we can change it to something else please do so. I think lucene is really great, thats why I\'m trying to use it. Thanks for the support, ideas and patches so far. \u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172289_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172289_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:08:13+0000\'\u003e19\\/Dec\\/11 14:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 19\\/Dec\\/11 14:08\\\"\u003eedited\u003c\\/span\u003e                   Just to clear up on some comments: \\n\\n Guys I\'m testing this on a production deploy and the use case is simple. Parser Query, Search, Get Doc fields. Contention was seen without profiling and profiling was used to find where the contention in the application. \\n\\n \\n  \\n \\n I don\'t care. They should be reusing tokenstreams in their application. \\n \\n  \\n \\n\\n\\n Token streams is not the only place of contention discussed here. Please look at the test attached (App.java). It does not recreate the token streams on each search, only (by mistake) for each thread. But still this only has a very small impact. Searches are repeated from each thread reusing the same token stream. \\n\\n \\n  \\n \\n We don\'t need to make lucene more complicated to (possibly) speed up someones broken code. \\n \\n  \\n \\n\\n\\n Please write an example and show me your findings. I\'ve done the same already. Have a look at App.java \\n\\n \\n  \\n \\n I want to see the QPS change, I don\'t trust the benchmarks or the various fancy jvm tools being used on this issue.  \\nI think its all ghosts. \\n \\n  \\n \\n\\n\\n Yourkit is a standard Profiling tool. I didn\'t just wake up and say hey I\'ll profile lucene. I only started after I noticed the contention on a production application where we are trying to use lucene in memory. \\n\\n \\n  \\n \\n Lots of commits here, a title that says \'lucene doesn\'t scale, lots of arguing that there are locking problems, but not one luceneutil benchmark run \\n \\n  \\n \\n\\n\\n ??, You don\'t need to be a scientist nor use a profiling tool to see that all threads will block on a synchronized block or method on each request if that method is called during each search request, from that it doesn\'t take much to know that this does not scale.  \\n\\n\\n Again, this is not a go at lucene, the heading \'Lucene Search not scalling\' is causing toooo much problems here I see, I could have chosen a better heading and if we can change it to something else please do so. I think lucene is really great, thats why I\'m trying to use it. Thanks for the support, ideas and patches so far.  \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172297\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172297&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172297\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172297_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172297_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:16:22+0000\'\u003e19\\/Dec\\/11 14:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSorry, I don\'t care what Yourkit says: its wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003ea synchronized method that is just a \u003cb\u003egetter\u003c\\/b\u003e only called once per-segment is \u003cb\u003eNOT\u003c\\/b\u003e locking up your search.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172297_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172297_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:16:22+0000\'\u003e19\\/Dec\\/11 14:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sorry, I don\'t care what Yourkit says: its wrong. \\n\\n a synchronized method that is just a  getter  only called once per-segment is  NOT  locking up your search.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172302\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172302&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172302\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172302_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172302_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:24:43+0000\'\u003e19\\/Dec\\/11 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eGerrit, what robert is saying is that if your index has a reasonable size the cost of a search is not dominated by calling the getter nor by the lock its using. You App is using 1k documents with a tiny number of terms. you are also using 500 threads where scheduling actually dominates the cost. A reasonable benchmark will not see a significant impact due to this synchronization in SegmentCoreReaders#getTermsReader() it will be dominated by retrieving the documents etc. What you are measuring is literally the impact of the lock in a case where your search is super super cheap. I still think we can and should get rid of the SegmentCoreReaders#getTermsReader() sync but in general saving a couple of cpu cycles but paying the price for more complicated code is not worth it IMO. so I agree with robert there will likely be no contention there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13172302_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172302_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:24:43+0000\'\u003e19\\/Dec\\/11 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Gerrit, what robert is saying is that if your index has a reasonable size the cost of a search is not dominated by calling the getter nor by the lock its using. You App is using 1k documents with a tiny number of terms. you are also using 500 threads where scheduling actually dominates the cost. A reasonable benchmark will not see a significant impact due to this synchronization in SegmentCoreReaders#getTermsReader() it will be dominated by retrieving the documents etc. What you are measuring is literally the impact of the lock in a case where your search is super super cheap. I still think we can and should get rid of the SegmentCoreReaders#getTermsReader() sync but in general saving a couple of cpu cycles but paying the price for more complicated code is not worth it IMO. so I agree with robert there will likely be no contention there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172303\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172303&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172303\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172303_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172303_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:25:03+0000\'\u003e19\\/Dec\\/11 14:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003ethis is not a problem if your ok with 200 or less requests on a server and your search time can be 0.5 or more seconds. But if your whole execution window is measured in milliseconds and you get 7000-10000 requests per second on a server then yes it does matter.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf that method is called in each thread that is trying to search on the index then it becomes a point of contention, if there are several synchronized separately synchronized methods it only becomes worse. Your basically saying its ok for all threads to wait sequentially in several areas of the code during an in memory readonly index search. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172303_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172303_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:25:03+0000\'\u003e19\\/Dec\\/11 14:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n this is not a problem if your ok with 200 or less requests on a server and your search time can be 0.5 or more seconds. But if your whole execution window is measured in milliseconds and you get 7000-10000 requests per second on a server then yes it does matter. \\n\\n If that method is called in each thread that is trying to search on the index then it becomes a point of contention, if there are several synchronized separately synchronized methods it only becomes worse. Your basically saying its ok for all threads to wait sequentially in several areas of the code during an in memory readonly index search.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172308\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172308&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172308\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172308_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172308_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:29:08+0000\'\u003e19\\/Dec\\/11 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 19\\/Dec\\/11 14:31\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust to clarify, my index is 2 gigs (may grow to 10 gigs, I\'ve got 72gigs of RAM to work with), with thousands of documents, documents are not big. The total processing time in my app without the index searches is on average 2-3 milliseconds (after warmup), this includes searching through a treemap with 11million entries.\u003c\\/p\u003e\\n\\n\u003cp\u003eContention was not only seen on the single method in SegmentCoreReaders#getTermsReader() but also on all methods in RAMFile and SegmentNorms etc. Its not just about a single method, that\'s what I\'ve been trying to make clear in my comments from the start.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172308_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172308_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:29:08+0000\'\u003e19\\/Dec\\/11 14:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Gerrit Jansen van Vuuren - 19\\/Dec\\/11 14:31\\\"\u003eedited\u003c\\/span\u003e                   Just to clarify, my index is 2 gigs (may grow to 10 gigs, I\'ve got 72gigs of RAM to work with), with thousands of documents, documents are not big. The total processing time in my app without the index searches is on average 2-3 milliseconds (after warmup), this includes searching through a treemap with 11million entries. \\n\\n Contention was not only seen on the single method in SegmentCoreReaders#getTermsReader() but also on all methods in RAMFile and SegmentNorms etc. Its not just about a single method, that\'s what I\'ve been trying to make clear in my comments from the start.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:35:08+0000\'\u003e19\\/Dec\\/11 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eContention was not only seen on the single method in SegmentCoreReaders#getTermsReader() but also on all methods in RAMFile and SegmentNorms etc.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNot actually seen, just spit out by a profiling tool. I really don\'t think you should interpret what Yourkit is telling you as gospel truth.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13172312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:35:08+0000\'\u003e19\\/Dec\\/11 14:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Contention was not only seen on the single method in SegmentCoreReaders#getTermsReader() but also on all methods in RAMFile and SegmentNorms etc.  \\n\\n Not actually seen, just spit out by a profiling tool. I really don\'t think you should interpret what Yourkit is telling you as gospel truth.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172322\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172322&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172322\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172322_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172322_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:47:54+0000\'\u003e19\\/Dec\\/11 14:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIndexSearch.doc calls RAMFile indirectly through RAMInputStream, once search is complete you need to know what\'s been found so IndexSearch.doc needs to be called.\u003cbr\\/\u003e\\ni.e. RAMInputStream calls RAMFile.numBuffers and getBuffer on the switchCurrentBuffer which happens allot during my searches. \u003c\\/p\u003e\\n\\n\u003cp\u003eIndexSearcher calls TermQuery$TermWeightScorer.scorer which calls SegmentReader.norms, which calls SegmentNorms.bytes on each search.\u003cbr\\/\u003e\\nSegmentNorms has almost all methods synchronized.\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172322_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172322_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 14:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T14:47:54+0000\'\u003e19\\/Dec\\/11 14:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    IndexSearch.doc calls RAMFile indirectly through RAMInputStream, once search is complete you need to know what\'s been found so IndexSearch.doc needs to be called. \\ni.e. RAMInputStream calls RAMFile.numBuffers and getBuffer on the switchCurrentBuffer which happens allot during my searches.  \\n\\n IndexSearcher calls TermQuery$TermWeightScorer.scorer which calls SegmentReader.norms, which calls SegmentNorms.bytes on each search. \\nSegmentNorms has almost all methods synchronized. \\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172332\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172332&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172332\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172332_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172332_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:08:35+0000\'\u003e19\\/Dec\\/11 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 15:12\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIndexSearcher calls TermQuery$TermWeightScorer.scorer which calls SegmentReader.norms, which calls SegmentNorms.bytes on each search. SegmentNorms has almost all methods synchronized.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats the idea behind this class, it caches norms, as they are heavy to load. Even accidently loading them two times because of double-checked-locking is too expensive. Hotspot does the removal of sync later!\u003c\\/p\u003e\\n\\n\u003cp\u003eHave you thought about yourkit effectively disabling hotspot, so your analysis is bogus here?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172332_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172332_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:08:35+0000\'\u003e19\\/Dec\\/11 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 15:12\\\"\u003eedited\u003c\\/span\u003e                    IndexSearcher calls TermQuery$TermWeightScorer.scorer which calls SegmentReader.norms, which calls SegmentNorms.bytes on each search. SegmentNorms has almost all methods synchronized.  \\n\\n Thats the idea behind this class, it caches norms, as they are heavy to load. Even accidently loading them two times because of double-checked-locking is too expensive. Hotspot does the removal of sync later! \\n\\n Have you thought about yourkit effectively disabling hotspot, so your analysis is bogus here?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172337\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172337&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172337\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172337_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172337_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:17:34+0000\'\u003e19\\/Dec\\/11 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK got you. Just keep in mind that I\'m still profiling this and will post my findings as I go along. \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172337_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172337_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:17:34+0000\'\u003e19\\/Dec\\/11 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK got you. Just keep in mind that I\'m still profiling this and will post my findings as I go along.  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172338\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172338&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172338\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172338_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172338_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:23:13+0000\'\u003e19\\/Dec\\/11 15:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 15:28\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIndexSearch.doc calls RAMFile indirectly through RAMInputStream, once search is complete you need to know what\'s been found so IndexSearch.doc needs to be called. i.e. RAMInputStream calls RAMFile.numBuffers and getBuffer on the switchCurrentBuffer which happens allot during my searches.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIf you use RAMDirectory on a large index its slowing down things as it drives the garbage collector crazy. Use an on-disk index with MMapDirectory, which has no locking at all (only on sometimes called IndexInput.clone, but if you remove that your JVM will SIGSEGV if you use Lucene incorrectly with multiple threads).\u003c\\/p\u003e\\n\\n\u003cp\u003eRAMDirectory is written for tests, not for production use. There are already plans to remove it from Lucene trunk and move to tests only. Have you seen that it allocates buffers in 8 Kilobytes blocks? Calculate how many byte[] you have on a 50 Gigabytes index... GC will drive crazy when it starts to cleanup. And then it stops your whole application, not because it locks inside RAMFile, because it does a stop-the world GC.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are working on a RAM-Dir like approach storing the files outside Java heap using a large DirectByteBuffer (which is the same code as MMapDirctory). The problem is writing to such a directory, but reading is as fast (or even faster) than RAMDirectory without locks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172338_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172338_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:23:13+0000\'\u003e19\\/Dec\\/11 15:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 15:28\\\"\u003eedited\u003c\\/span\u003e                    IndexSearch.doc calls RAMFile indirectly through RAMInputStream, once search is complete you need to know what\'s been found so IndexSearch.doc needs to be called. i.e. RAMInputStream calls RAMFile.numBuffers and getBuffer on the switchCurrentBuffer which happens allot during my searches.  \\n\\n If you use RAMDirectory on a large index its slowing down things as it drives the garbage collector crazy. Use an on-disk index with MMapDirectory, which has no locking at all (only on sometimes called IndexInput.clone, but if you remove that your JVM will SIGSEGV if you use Lucene incorrectly with multiple threads). \\n\\n RAMDirectory is written for tests, not for production use. There are already plans to remove it from Lucene trunk and move to tests only. Have you seen that it allocates buffers in 8 Kilobytes blocks? Calculate how many byte[] you have on a 50 Gigabytes index... GC will drive crazy when it starts to cleanup. And then it stops your whole application, not because it locks inside RAMFile, because it does a stop-the world GC. \\n\\n We are working on a RAM-Dir like approach storing the files outside Java heap using a large DirectByteBuffer (which is the same code as MMapDirctory). The problem is writing to such a directory, but reading is as fast (or even faster) than RAMDirectory without locks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172343\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172343&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172343\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172343_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172343_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:29:56+0000\'\u003e19\\/Dec\\/11 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOh, ok I thought RAMDirectory would make things faster, good to know. I will try with MMapDirectory then post back.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13172343_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172343_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:29:56+0000\'\u003e19\\/Dec\\/11 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Oh, ok I thought RAMDirectory would make things faster, good to know. I will try with MMapDirectory then post back.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172348\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172348&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172348\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172348_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172348_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:38:02+0000\'\u003e19\\/Dec\\/11 15:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eOh, ok I thought RAMDirectory would make things faster, good to know. I will try with MMapDirectory then post back.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats a hard to eliminate misbelief - same like \\\"optimizing indexes is good\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eJust remember that MMapDirectory will use memory outside the JVM heap. If the whole index is in file system cache, Lucene can directly access the cache using MMapDirectory (thats like a swap file, loaded on demand). So reduce JVM heap and supply lots of space for the OS kernel to cache file contents, as those are mapped by MMAP into Java\'s process space.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172348_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172348_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 15:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T15:38:02+0000\'\u003e19\\/Dec\\/11 15:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Oh, ok I thought RAMDirectory would make things faster, good to know. I will try with MMapDirectory then post back.  \\n\\n Thats a hard to eliminate misbelief - same like \\\"optimizing indexes is good\\\". \\n\\n Just remember that MMapDirectory will use memory outside the JVM heap. If the whole index is in file system cache, Lucene can directly access the cache using MMapDirectory (thats like a swap file, loaded on demand). So reduce JVM heap and supply lots of space for the OS kernel to cache file contents, as those are mapped by MMAP into Java\'s process space.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172446\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172446&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172446\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dmsmith\\\" id=\\\"commentauthor_13172446_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dmsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dmsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e DM Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172446_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T17:50:54+0000\'\u003e19\\/Dec\\/11 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThats a hard to eliminate misbelief - same like \\\"optimizing indexes is good\\\".\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNot sure why it is a misbelief? On Win98 and XP with Lucene 1.4.x, when creating an index, with Symantec AV and Windows Fast indexing both on, indexing of 64K small documents, took 40+ minutes. With them off, it took about 4 minutes. Going with a RAM dir took &gt;40 seconds.\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom what I could tell (and remember), Lucene was writing and deleting tens of thousands of documents. It appeared, that the OS was updating its fast search index for each file change hitting the disk. And Symantec, seemed to be scanning every on file creation.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs this was a desktop application, we couldn\'t ask end users to turn off those features or to tune them.\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes MMapDirectory avoid this too many transient files problem?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dmsmith\\\" id=\\\"commentauthor_13172446_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dmsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dmsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e DM Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172446_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T17:50:54+0000\'\u003e19\\/Dec\\/11 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Thats a hard to eliminate misbelief - same like \\\"optimizing indexes is good\\\".  \\n\\n Not sure why it is a misbelief? On Win98 and XP with Lucene 1.4.x, when creating an index, with Symantec AV and Windows Fast indexing both on, indexing of 64K small documents, took 40+ minutes. With them off, it took about 4 minutes. Going with a RAM dir took &gt;40 seconds. \\n\\n From what I could tell (and remember), Lucene was writing and deleting tens of thousands of documents. It appeared, that the OS was updating its fast search index for each file change hitting the disk. And Symantec, seemed to be scanning every on file creation. \\n\\n As this was a desktop application, we couldn\'t ask end users to turn off those features or to tune them. \\n\\n Does MMapDirectory avoid this too many transient files problem?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172453\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172453&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172453\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172453_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172453_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 17:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T17:58:55+0000\'\u003e19\\/Dec\\/11 17:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 18:14\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDM: At lucene 1.4 times the indexer was working different and really created lots of files. With new merging this is no longer the case.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact we were talking here about searching not indexing. It makes no sense to clone a huge RAM directory from disk to heap and run searches on it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172453_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172453_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 17:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T17:58:55+0000\'\u003e19\\/Dec\\/11 17:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 18:14\\\"\u003eedited\u003c\\/span\u003e                   DM: At lucene 1.4 times the indexer was working different and really created lots of files. With new merging this is no longer the case. \\n\\n In fact we were talking here about searching not indexing. It makes no sense to clone a huge RAM directory from disk to heap and run searches on it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172484\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172484&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172484\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13172484_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172484_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T18:40:42+0000\'\u003e19\\/Dec\\/11 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI still think we can and should get rid of the SegmentCoreReaders#getTermsReader() sync\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1, I think Simon\'s patch is a good improvement, even if in practice this sync\'d getter should be a tiny cost.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13172484_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172484_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 18:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T18:40:42+0000\'\u003e19\\/Dec\\/11 18:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I still think we can and should get rid of the SegmentCoreReaders#getTermsReader() sync  \\n\\n +1, I think Simon\'s patch is a good improvement, even if in practice this sync\'d getter should be a tiny cost.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172578\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172578&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172578\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dmsmith\\\" id=\\\"commentauthor_13172578_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dmsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dmsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e DM Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172578_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 20:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T20:22:57+0000\'\u003e19\\/Dec\\/11 20:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"DM Smith - 19\\/Dec\\/11 20:24\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIn fact we were talking here about searching not indexing. It makes no sense to clone a huge RAM directory from disk to heap and run searches on it.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI saw that this issue is on searching not indexing. I didn\'t mean to try to hijack it. I was responding to the statement that RAMDirectory going away (BTW, the statement on optimize does not regard a search feature but an index one). I\'ll have to test to see if the same index problem still is around.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegarding MMap, there is an open issue with it on Windows: Lucene-1669.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dmsmith\\\" id=\\\"commentauthor_13172578_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dmsmith\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dmsmith\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e DM Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172578_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 20:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T20:22:57+0000\'\u003e19\\/Dec\\/11 20:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"DM Smith - 19\\/Dec\\/11 20:24\\\"\u003eedited\u003c\\/span\u003e                    In fact we were talking here about searching not indexing. It makes no sense to clone a huge RAM directory from disk to heap and run searches on it.  \\n\\n I saw that this issue is on searching not indexing. I didn\'t mean to try to hijack it. I was responding to the statement that RAMDirectory going away (BTW, the statement on optimize does not regard a search feature but an index one). I\'ll have to test to see if the same index problem still is around. \\n\\n Regarding MMap, there is an open issue with it on Windows: Lucene-1669.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13172637\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13172637&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13172637\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172637_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172637_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T21:34:10+0000\'\u003e19\\/Dec\\/11 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 22:16\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-1669\\\" title=\\\"MMapDirectory on Windows silently fails to write to a file if also open for read\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-1669\\\"\u003e\u003cdel\u003eLUCENE-1669\u003c\\/del\u003e\u003c\\/a\u003e seems to be relict and should already be solved since Lucene 2.9 in newer Windows versions? And BTW, MMap is only useful for reading indexes, written are they by NIO\\/SimpleFS.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBTW, the statement on optimize does not regard a search feature but an index one\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThis statement was just a comparison, to underline that both statements \\\"RAMDir is fast\\\" and \\\"Optimize is needed\\\" are myths.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI was responding to the statement that RAMDirectory going away \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSee my previous comment:\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWe are working on a RAM-Dir like approach storing the files outside Java heap using a large DirectByteBuffer (which is the same code as MMapDirctory). The problem is writing to such a directory, but reading is as fast (or even faster) than RAMDirectory without locks.\u003c\\/p\u003e\u003c\\/blockquote\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13172637_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13172637_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/11 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-19T21:34:10+0000\'\u003e19\\/Dec\\/11 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Uwe Schindler - 19\\/Dec\\/11 22:16\\\"\u003eedited\u003c\\/span\u003e                     LUCENE-1669   seems to be relict and should already be solved since Lucene 2.9 in newer Windows versions? And BTW, MMap is only useful for reading indexes, written are they by NIO\\/SimpleFS. \\n\\n  BTW, the statement on optimize does not regard a search feature but an index one  \\n\\n This statement was just a comparison, to underline that both statements \\\"RAMDir is fast\\\" and \\\"Optimize is needed\\\" are myths. \\n\\n  I was responding to the statement that RAMDirectory going away   \\n\\n See my previous comment: \\n\\n  We are working on a RAM-Dir like approach storing the files outside Java heap using a large DirectByteBuffer (which is the same code as MMapDirctory). The problem is writing to such a directory, but reading is as fast (or even faster) than RAMDirectory without locks.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13173284\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13173284&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13173284\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13173284_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13173284_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/11 16:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-20T16:27:03+0000\'\u003e20\\/Dec\\/11 16:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve tested my application using \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eUsing a single Tokenizer\u003c\\/li\u003e\\n\\t\u003cli\u003eMMapDirectory,\u003c\\/li\u003e\\n\\t\u003cli\u003ethe latest trunk build that contains the patches committed here.\u003c\\/li\u003e\\n\\t\u003cli\u003ewith the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3653\\\" title=\\\"Lucene Search not scalling\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3653\\\"\u003e\u003cdel\u003eLUCENE-3653\u003c\\/del\u003e\u003c\\/a\u003e.patch applied.\u003c\\/li\u003e\\n\\t\u003cli\u003eplus using the XX:BiasedLockingStartupDelay=0 option.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eMy app request time has gone down from a terrible 400 ms to 120-140ms on average and is constant over 10-200-500 threads (after a 3 hour warmup). (Running java 1.6.0_29 64 bit centos 5.4).\u003c\\/p\u003e\\n\\n\u003cp\u003eStill strange that I can do a single threaded request 10000 times and get 3-5 ms on average response time.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks, Uwe, Simon, your input, comments, and patches have helped allot.\u003c\\/p\u003e\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"gerritjvv\\\" id=\\\"commentauthor_13173284_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=gerritjvv\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"gerritjvv\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Gerrit Jansen van Vuuren\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13173284_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/11 16:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-20T16:27:03+0000\'\u003e20\\/Dec\\/11 16:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n I\'ve tested my application using  \\n \\n\\t Using a single Tokenizer \\n\\t MMapDirectory, \\n\\t the latest trunk build that contains the patches committed here. \\n\\t with the   LUCENE-3653  .patch applied. \\n\\t plus using the XX:BiasedLockingStartupDelay=0 option. \\n \\n\\n\\n My app request time has gone down from a terrible 400 ms to 120-140ms on average and is constant over 10-200-500 threads (after a 3 hour warmup). (Running java 1.6.0_29 64 bit centos 5.4). \\n\\n Still strange that I can do a single threaded request 10000 times and get 3-5 ms on average response time. \\n\\n Thanks, Uwe, Simon, your input, comments, and patches have helped allot. \\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174693\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13174693&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174693\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13174693_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174693_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 08:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T08:45:46+0000\'\u003e22\\/Dec\\/11 08:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003e+1, I think Simon\'s patch is a good improvement, even if in practice this sync\'d getter should be a tiny cost.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree. However, I don\'t think we can get entirely rid of a mem-barrier here. Even if this is synced by the IW a thread could reopen the reader and another search thread gets the new instance without yet another barrier. This means that search thread would not use the dictionary resulting in a possibly slow search. I removed the sync and made the tis member volatile. That seems the safest option to me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13174693_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174693_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 08:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T08:45:46+0000\'\u003e22\\/Dec\\/11 08:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     +1, I think Simon\'s patch is a good improvement, even if in practice this sync\'d getter should be a tiny cost.  \\n\\n I agree. However, I don\'t think we can get entirely rid of a mem-barrier here. Even if this is synced by the IW a thread could reopen the reader and another search thread gets the new instance without yet another barrier. This means that search thread would not use the dictionary resulting in a possibly slow search. I removed the sync and made the tis member volatile. That seems the safest option to me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174741\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13174741&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174741\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13174741_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174741_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 10:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T10:23:33+0000\'\u003e22\\/Dec\\/11 10:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Simon, for 3.x I agree. In trunk we already have no synchronization at all (committed 2 days ago; improved yesterday: \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3631\\\" title=\\\"Remove write access from SegmentReader and possibly move to separate class or IndexWriter\\/BufferedDeletes\\/...\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3631\\\"\u003e\u003cdel\u003eLUCENE-3631\u003c\\/del\u003e\u003c\\/a\u003e), so there is no need to change anything.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13174741_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174741_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 10:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T10:23:33+0000\'\u003e22\\/Dec\\/11 10:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Simon, for 3.x I agree. In trunk we already have no synchronization at all (committed 2 days ago; improved yesterday:   LUCENE-3631  ), so there is no need to change anything.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174753\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13174753&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174753\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13174753_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174753_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 10:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T10:36:13+0000\'\u003e22\\/Dec\\/11 10:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHi Simon, for 3.x I agree. In trunk we already have no synchronization at all (committed 2 days ago; improved yesterday: \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-3631\\\" title=\\\"Remove write access from SegmentReader and possibly move to separate class or IndexWriter\\/BufferedDeletes\\/...\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-3631\\\"\u003e\u003cdel\u003eLUCENE-3631\u003c\\/del\u003e\u003c\\/a\u003e), so there is no need to change anything.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003euwe that patch is against 3.x - I didn\'t intend to apply this to 4.0 since we do totally different things there. I will commit this if nobody objects in a bit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13174753_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174753_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 10:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T10:36:13+0000\'\u003e22\\/Dec\\/11 10:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Hi Simon, for 3.x I agree. In trunk we already have no synchronization at all (committed 2 days ago; improved yesterday:   LUCENE-3631  ), so there is no need to change anything.  \\n uwe that patch is against 3.x - I didn\'t intend to apply this to 4.0 since we do totally different things there. I will commit this if nobody objects in a bit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13174767\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-3653?focusedCommentId=13174767&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13174767\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13174767_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174767_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 11:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T11:57:33+0000\'\u003e22\\/Dec\\/11 11:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e+1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13174767_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13174767_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Dec\\/11 11:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-12-22T11:57:33+0000\'\u003e22\\/Dec\\/11 11:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    +1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516203891662"> 
    <input type="hidden" title="jira.request.server.time" value="293"> 
    <input type="hidden" title="jira.request.id" value="944x7737525x8"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="8"> 
    <input type="hidden" title="db.reads.time.in.ms" value="56"> 
    <input type="hidden" title="db.conns.time.in.ms" value="62"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 944x7737525x8
	          REQUEST TIMESTAMP : [17/Jan/2018:15:44:51 +0000]
	               REQUEST TIME : 0.2930
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 8

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=25, elapsedTotal=56621672, elapsedMin=561790, elapsedMax=32289386, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=29, elapsedTotal=62070291, elapsedMin=590431, elapsedMax=32351022, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>