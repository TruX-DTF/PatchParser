<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|70d133abf40dc9a95597333c33ca112ae14d3ecb|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"4d6409da6810df\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-140"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-140] docs out of order - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-140] docs out of order - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-140">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-140" href="/jira/browse/LUCENE-140" id="key-val" rel="12314290">LUCENE-140</a></li>
                </ol>
                <h1 id="summary-val">docs out of order</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-140"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-140/LUCENE-140.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-140/LUCENE-140.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-140/LUCENE-140.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-140/LUCENE-140.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+2.1" title="2.1 ">2.1</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12314290-value">None</span> 
                   </div> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap"> 
                   <strong class="name">Environment:</strong> 
                   <div id="environment-val" class="value"> 
                    <p>Operating System: Linux<br> Platform: PC</p> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_10010" class="item"> 
                     <div class="wrap"> 
                      <strong title="Bugzilla Id" class="name">Bugzilla Id:</strong> 
                      <div id="customfield_10010-val" class="value type-importid" data-fieldtype="importid" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:importid">
                        23650 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Hello,<br> I can not find out, why (and what) it is happening all the time. I got an<br> exception:<br> java.lang.IllegalStateException: docs out of order<br> at<br> org.apache.lucene.index.SegmentMerger.appendPostings(SegmentMerger.java:219)<br> at<br> org.apache.lucene.index.SegmentMerger.mergeTermInfo(SegmentMerger.java:191)<br> at<br> org.apache.lucene.index.SegmentMerger.mergeTermInfos(SegmentMerger.java:172)<br> at org.apache.lucene.index.SegmentMerger.mergeTerms(SegmentMerger.java:135)<br> at org.apache.lucene.index.SegmentMerger.merge(SegmentMerger.java:88)<br> at org.apache.lucene.index.IndexWriter.mergeSegments(IndexWriter.java:341)<br> at org.apache.lucene.index.IndexWriter.optimize(IndexWriter.java:250)<br> at Optimize.main(Optimize.java:29)</p> 
                  <p>It happens either in 1.2 and 1.3rc1 (anyway what happened to it? I can not find<br> it neither in download nor in version list in this form). Everything seems OK. I<br> can search through index, but I can not optimize it. Even worse after this<br> exception every time I add new documents and close IndexWriter new segments is<br> created! I think it has all documents added before, because of its size.</p> 
                  <p>My index is quite big: 500.000 docs, about 5gb of index directory.</p> 
                  <p>It is <em>repeatable</em>. I drop index, reindex everything. Afterwards I add a few<br> docs, try to optimize and receive above exception.</p> 
                  <p>My documents' structure is:<br> static Document indexIt(String id_strony, Reader reader, String data_wydania,<br> String id_wydania, String id_gazety, String data_wstawienia)<br> {<br> Document doc = new Document();</p> 
                  <p> doc.add(Field.Keyword("id", id_strony ));<br> doc.add(Field.Keyword("data_wydania", data_wydania));<br> doc.add(Field.Keyword("id_wydania", id_wydania));<br> doc.add(Field.Text("id_gazety", id_gazety));<br> doc.add(Field.Keyword("data_wstawienia", data_wstawienia));<br> doc.add(Field.Text("tresc", reader));</p> 
                  <p> return doc;<br> }</p> 
                  <p>Sincerely,<br> legez</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-140?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-140?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-140?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-140?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12312257" data-issue-id="12314290" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12312257/ASF.LICENSE.NOT.GRANTED--bug23650.txt" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--bug23650.txt:https://issues.apache.org/jira/secure/attachment/12312257/ASF.LICENSE.NOT.GRANTED--bug23650.txt"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12312257/ASF.LICENSE.NOT.GRANTED--bug23650.txt" title="Latest  14/Jun/05 23:46 - Arvind Srinivasan" draggable="true" data-downloadurl="text/plain:ASF.LICENSE.NOT.GRANTED--bug23650.txt:https://issues.apache.org/jira/secure/attachment/12312257/ASF.LICENSE.NOT.GRANTED--bug23650.txt">ASF.LICENSE.NOT.GRANTED--bug23650.txt</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2005-06-14T23:46:42.000Z">14/Jun/05 23:46</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Arvind Srinivasan
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12322202" data-issue-id="12314290" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12322202/corrupted.part1.rar" draggable="true" data-downloadurl="application/x-rar-compressed:corrupted.part1.rar:https://issues.apache.org/jira/secure/attachment/12322202/corrupted.part1.rar"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12322202/corrupted.part1.rar" title="Latest  21/Jan/06 07:41 - Jarrod Cuzens" draggable="true" data-downloadurl="application/x-rar-compressed:corrupted.part1.rar:https://issues.apache.org/jira/secure/attachment/12322202/corrupted.part1.rar">corrupted.part1.rar</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-01-21T07:41:44.000Z">21/Jan/06 07:41</time>
                   </dd>
                   <dd class="attachment-size">
                    9.00 MB
                   </dd>
                   <dd class="attachment-author">
                    Jarrod Cuzens
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12322203" data-issue-id="12314290" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12322203/corrupted.part2.rar" draggable="true" data-downloadurl="application/x-rar-compressed:corrupted.part2.rar:https://issues.apache.org/jira/secure/attachment/12322203/corrupted.part2.rar"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12322203/corrupted.part2.rar" title="Latest  21/Jan/06 07:44 - Jarrod Cuzens" draggable="true" data-downloadurl="application/x-rar-compressed:corrupted.part2.rar:https://issues.apache.org/jira/secure/attachment/12322203/corrupted.part2.rar">corrupted.part2.rar</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2006-01-21T07:44:02.000Z">21/Jan/06 07:44</time>
                   </dd>
                   <dd class="attachment-size">
                    3.35 MB
                   </dd>
                   <dd class="attachment-author">
                    Jarrod Cuzens
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12348606" data-issue-id="12314290" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12348606/indexing-failure.log" draggable="true" data-downloadurl="text/x-log:indexing-failure.log:https://issues.apache.org/jira/secure/attachment/12348606/indexing-failure.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12348606/indexing-failure.log" title="Latest  10/Jan/07 00:50 - Jed Wesley-Smith" draggable="true" data-downloadurl="text/x-log:indexing-failure.log:https://issues.apache.org/jira/secure/attachment/12348606/indexing-failure.log">indexing-failure.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-01-10T00:50:50.178Z">10/Jan/07 00:50</time>
                   </dd>
                   <dd class="attachment-size">
                    2.75 MB
                   </dd>
                   <dd class="attachment-author">
                    Jed Wesley-Smith
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12348553" data-issue-id="12314290" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12348553/LUCENE-140-2007-01-09-instrumentation.patch" draggable="true" data-downloadurl="text/plain:LUCENE-140-2007-01-09-instrumentation.patch:https://issues.apache.org/jira/secure/attachment/12348553/LUCENE-140-2007-01-09-instrumentation.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12348553/LUCENE-140-2007-01-09-instrumentation.patch" title="Latest  09/Jan/07 14:49 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-140-2007-01-09-instrumentation.patch:https://issues.apache.org/jira/secure/attachment/12348553/LUCENE-140-2007-01-09-instrumentation.patch">LUCENE-140-2007-01-09-instrumentation.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2007-01-09T14:49:26.107Z">09/Jan/07 14:49</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_mikemccand" rel="mikemccand" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Michael McCandless&quot;,&quot;emailAddress&quot;:&quot;lucene@mikemccandless.com&quot;,&quot;username&quot;:&quot;mikemccand&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="mikemccand"></span></span> Michael McCandless </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_gegez@wp.pl" rel="gegez@wp.pl" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;legez&quot;,&quot;emailAddress&quot;:&quot;gegez@wp.pl&quot;,&quot;username&quot;:&quot;gegez@wp.pl&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="gegez@wp.pl"></span></span> legez </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">5</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">3</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="07/Oct/03 20:05"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2003-10-07T20:05:52+0000">07/Oct/03 20:05</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="02/Jun/11 22:04"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-06-02T22:04:35+0000">02/Jun/11 22:04</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="11/Jan/07 12:14"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2007-01-11T12:14:18+0000">11/Jan/07 12:14</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-140?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-140?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-12321387\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12321387&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12321387\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis@apache.org\\\" id=\\\"commentauthor_12321387_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321387_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Nov\\/03 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2003-11-25T19:35:32+0000\'\u003e25\\/Nov\\/03 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSince the bug submitter hasn\'t followed up to this \'repeatable\' issue in almost\u003cbr\\/\u003e\\ntwo months, I shall assume that this was not a bug in Lucene, but a misuse of\u003cbr\\/\u003e\\nLucene.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere is also no self-contained code that demonstrates the bug.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf this is indeed a Lucene bug, please re-open this bug entry, and provise\u003cbr\\/\u003e\\nself-sufficient unit test that demonstrates this problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis@apache.org\\\" id=\\\"commentauthor_12321387_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321387_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Nov\\/03 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2003-11-25T19:35:32+0000\'\u003e25\\/Nov\\/03 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Since the bug submitter hasn\'t followed up to this \'repeatable\' issue in almost \\ntwo months, I shall assume that this was not a bug in Lucene, but a misuse of \\nLucene. \\n\\n There is also no self-contained code that demonstrates the bug. \\n\\n If this is indeed a Lucene bug, please re-open this bug entry, and provise \\nself-sufficient unit test that demonstrates this problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12321388\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12321388&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12321388\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucene@ziplip.com\\\" id=\\\"commentauthor_12321388_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucene%40ziplip.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucene@ziplip.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Arvind Srinivasan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321388_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/05 23:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-06-14T23:42:25+0000\'\u003e14\\/Jun\\/05 23:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMore Data Integrity Issue: Docs out of Order\u003c\\/p\u003e\\n\\n\u003cp\u003eHi,\u003cbr\\/\u003e\\nSeeing similar issue to the one reported in:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/nagoya.apache.org\\/bugzilla\\/show_bug.cgi?id=23650\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/nagoya.apache.org\\/bugzilla\\/show_bug.cgi?id=23650\u003c\\/a\u003e\u003cbr\\/\u003e\\nOn examining the segments, following inconsistencies were found\u003cbr\\/\u003e\\n(a) The merging segments had doc number that is greater than maxDoc.\u003cbr\\/\u003e\\nDon\'t know how it go in this state, but this occurs using standard lucene\u003cbr\\/\u003e\\ncode.\u003cbr\\/\u003e\\n(b) Strangely, some documents had terms with zero frequency.  And when it \u003cbr\\/\u003e\\noccurred,\u003cbr\\/\u003e\\nthe zero frequency term has several posting as (docid 0)\u003cbr\\/\u003e\\nExample.. (docid freq)  &#8211; MaxDoc = 7749 - NO DELETION.\u003cbr\\/\u003e\\nMerging msgBody; text=it; sz=2  &#8212; The field name is msgBody and term is \\\"it\\\"\u003cbr\\/\u003e\\n                                    and two segments have the term.\u003cbr\\/\u003e\\n(0 0)(0 0)(0 0)..........(0 0)(4 6)(5 3)(6 1)(9 1)(10 2)(12 1)......\u003cbr\\/\u003e\\n...(6791 2)(6794 3)(6796 2)(6798 16)(6801 1)(6805 1)(6806 5)\u003cbr\\/\u003e\\n(6808 1)(6810 1)(6815 2)(6816 3)(6817 1)(6818 1)(6821 4)(6822 1)\u003cbr\\/\u003e\\n(6824 3)(6826 4)(6828 1)(6829 3)(12549 2)doc exceeds count\u003cbr\\/\u003e\\n749(13570 1)doc exceeds count 7749(14896 1)doc exceeds count 7749\u003cbr\\/\u003e\\n(15028 1)doc exceeds count 7749(15357 1)doc exceeds count 7749\u003cbr\\/\u003e\\n(15427 1)doc exceeds count 7749(15534 1)doc exceeds count 7749\u003cbr\\/\u003e\\n(15535 1)doc exceeds count 7749(15653 1)doc exceeds count 7749\u003cbr\\/\u003e\\n(16530 1)doc exceeds count 7749(17108 1).......\u003cbr\\/\u003e\\n(c) Also the zero frequency was not limited to the 0 document, there was\u003cbr\\/\u003e\\nanother instance.\u003c\\/p\u003e\\n\\n\u003cp\u003eOne work around that seemed to resolve the issue was to:\u003cbr\\/\u003e\\n(a) keep the maxDoc as a member variable in SegmentMergeInfo\u003cbr\\/\u003e\\nand ignore\\/throw exception if an inconsistent state is detected.\u003c\\/p\u003e\\n\\n\u003cp\u003e****ADD To SegmentMerger just before \\\"docs out of order\\\" check.\u003cbr\\/\u003e\\n  if (postings.freq() == 0) \u003c\\/p\u003e\\n{\\n            continue;\\n   }\\n\u003cp\u003e   if (doc &gt;= smi.maxDoc) \u003c\\/p\u003e\\n{\\n      \\/\\/sbLog.append(\\\"doc exceeds count \\\\r\\\\n \\\" + smi.maxDoc);\\n      continue;\\n   }\\n\u003cp\u003e****\u003c\\/p\u003e\\n\\n\u003cp\u003eAtleast putting a check would not corrupt the segments and would\u003cbr\\/\u003e\\nget us closer to the real problem as to why freq=0 and doc number exceeds\u003cbr\\/\u003e\\nmaxDoc. Note, the code has had the fix to the other Segment corruption issue\u003cbr\\/\u003e\\nthat I previously reported (namely, Using a zero length file).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucene@ziplip.com\\\" id=\\\"commentauthor_12321388_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucene%40ziplip.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucene@ziplip.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Arvind Srinivasan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321388_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/05 23:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-06-14T23:42:25+0000\'\u003e14\\/Jun\\/05 23:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    More Data Integrity Issue: Docs out of Order \\n\\n Hi, \\nSeeing similar issue to the one reported in: \\n http:\\/\\/nagoya.apache.org\\/bugzilla\\/show_bug.cgi?id=23650  \\nOn examining the segments, following inconsistencies were found \\n(a) The merging segments had doc number that is greater than maxDoc. \\nDon\'t know how it go in this state, but this occurs using standard lucene \\ncode. \\n(b) Strangely, some documents had terms with zero frequency.  And when it  \\noccurred, \\nthe zero frequency term has several posting as (docid 0) \\nExample.. (docid freq)  &#8211; MaxDoc = 7749 - NO DELETION. \\nMerging msgBody; text=it; sz=2  &#8212; The field name is msgBody and term is \\\"it\\\" \\n                                    and two segments have the term. \\n(0 0)(0 0)(0 0)..........(0 0)(4 6)(5 3)(6 1)(9 1)(10 2)(12 1)...... \\n...(6791 2)(6794 3)(6796 2)(6798 16)(6801 1)(6805 1)(6806 5) \\n(6808 1)(6810 1)(6815 2)(6816 3)(6817 1)(6818 1)(6821 4)(6822 1) \\n(6824 3)(6826 4)(6828 1)(6829 3)(12549 2)doc exceeds count \\n749(13570 1)doc exceeds count 7749(14896 1)doc exceeds count 7749 \\n(15028 1)doc exceeds count 7749(15357 1)doc exceeds count 7749 \\n(15427 1)doc exceeds count 7749(15534 1)doc exceeds count 7749 \\n(15535 1)doc exceeds count 7749(15653 1)doc exceeds count 7749 \\n(16530 1)doc exceeds count 7749(17108 1)....... \\n(c) Also the zero frequency was not limited to the 0 document, there was \\nanother instance. \\n\\n One work around that seemed to resolve the issue was to: \\n(a) keep the maxDoc as a member variable in SegmentMergeInfo \\nand ignore\\/throw exception if an inconsistent state is detected. \\n\\n ****ADD To SegmentMerger just before \\\"docs out of order\\\" check. \\n  if (postings.freq() == 0)  \\n{\\n            continue;\\n   }\\n    if (doc &gt;= smi.maxDoc)  \\n{\\n      \\/\\/sbLog.append(\\\"doc exceeds count \\\\r\\\\n \\\" + smi.maxDoc);\\n      continue;\\n   }\\n **** \\n\\n Atleast putting a check would not corrupt the segments and would \\nget us closer to the real problem as to why freq=0 and doc number exceeds \\nmaxDoc. Note, the code has had the fix to the other Segment corruption issue \\nthat I previously reported (namely, Using a zero length file).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12321389\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12321389&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12321389\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucene@ziplip.com\\\" id=\\\"commentauthor_12321389_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucene%40ziplip.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucene@ziplip.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Arvind Srinivasan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321389_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/05 23:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-06-14T23:46:42+0000\'\u003e14\\/Jun\\/05 23:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCreated an attachment (id=15405)\u003cbr\\/\u003e\\nAnalysis of corrupted segments and suggestions.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"lucene@ziplip.com\\\" id=\\\"commentauthor_12321389_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=lucene%40ziplip.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"lucene@ziplip.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Arvind Srinivasan\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321389_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/05 23:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-06-14T23:46:42+0000\'\u003e14\\/Jun\\/05 23:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Created an attachment (id=15405) \\nAnalysis of corrupted segments and suggestions.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12321390\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12321390&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12321390\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis@apache.org\\\" id=\\\"commentauthor_12321390_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321390_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/05 12:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-06-22T12:04:49+0000\'\u003e22\\/Jun\\/05 12:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eArvind, thanks for following up on this issue.  From your report I can see that\u003cbr\\/\u003e\\nthe index really ends up containing invalid data, but I\'ve never even seen this\u003cbr\\/\u003e\\nhappen myself.  Could you please put together sample code that gets the index in\u003cbr\\/\u003e\\nthis state?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis@apache.org\\\" id=\\\"commentauthor_12321390_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis%40apache.org\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis@apache.org\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12321390_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/05 12:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-06-22T12:04:49+0000\'\u003e22\\/Jun\\/05 12:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Arvind, thanks for following up on this issue.  From your report I can see that \\nthe index really ends up containing invalid data, but I\'ve never even seen this \\nhappen myself.  Could you please put together sample code that gets the index in \\nthis state?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12357178\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12357178&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12357178\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12357178_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12357178_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/05 11:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-11-10T11:59:30+0000\'\u003e10\\/Nov\\/05 11:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve never seen this... can anyone reproduce with Lucene 1.9?\u003cbr\\/\u003e\\nCCing this to Arvind\'s email...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_12357178_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12357178_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/05 11:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-11-10T11:59:30+0000\'\u003e10\\/Nov\\/05 11:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve never seen this... can anyone reproduce with Lucene 1.9? \\nCCing this to Arvind\'s email...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12357180\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12357180&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12357180\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12357180_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12357180_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/05 12:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-11-10T12:05:56+0000\'\u003e10\\/Nov\\/05 12:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e2 years later, I still haven\'t seen this error.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_12357180_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12357180_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/05 12:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2005-11-10T12:05:56+0000\'\u003e10\\/Nov\\/05 12:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    2 years later, I still haven\'t seen this error.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12362310\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12362310&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12362310\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12362310_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362310_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/06 16:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-10T16:30:44+0000\'\u003e10\\/Jan\\/06 16:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFirst I think that Lucene is great and it manages to do an incredible job. However, this issue is also causing us significant problems. We originally had an AOP interceptor that would update documents in our HTTP threads however when we started to see this issue we were concerned that it was caused by multiple threads accessing the index at the same time. We put extra concurrency controls on the updates using the LuceneIndexAccess API that was posted into bugzilla by another user. This issue still remained after we added the extra concurrency control.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince then we have abandoned the AOP approach completely and moved the index rebuild to a scheduled thread which collects things that were modified from the database (using datestamp versioning) and then proceeds to update their lucene indexes. We hoped this would solve the problem because only 1 thread in 1 process would be modifying the index at any given time. Alas, we are still getting docs out of order exceptions. It is difficult for us to reproduce as it mainly happens in production and we cannot provide a testcase for it (I wish we could!). \u003c\\/p\u003e\\n\\n\u003cp\u003eI know that this must be a difficult issue because it is difficult to reproduce. I can\'t think of anything strange that we are doing with the indexes (one process, one thread modifying). This probably isn\'t much help but I just wanted to let you know that we are also experiencing the problem. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12362310_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362310_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/06 16:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-10T16:30:44+0000\'\u003e10\\/Jan\\/06 16:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    First I think that Lucene is great and it manages to do an incredible job. However, this issue is also causing us significant problems. We originally had an AOP interceptor that would update documents in our HTTP threads however when we started to see this issue we were concerned that it was caused by multiple threads accessing the index at the same time. We put extra concurrency controls on the updates using the LuceneIndexAccess API that was posted into bugzilla by another user. This issue still remained after we added the extra concurrency control. \\n\\n Since then we have abandoned the AOP approach completely and moved the index rebuild to a scheduled thread which collects things that were modified from the database (using datestamp versioning) and then proceeds to update their lucene indexes. We hoped this would solve the problem because only 1 thread in 1 process would be modifying the index at any given time. Alas, we are still getting docs out of order exceptions. It is difficult for us to reproduce as it mainly happens in production and we cannot provide a testcase for it (I wish we could!).  \\n\\n I know that this must be a difficult issue because it is difficult to reproduce. I can\'t think of anything strange that we are doing with the indexes (one process, one thread modifying). This probably isn\'t much help but I just wanted to let you know that we are also experiencing the problem.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12362354\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12362354&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12362354\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12362354_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362354_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/06 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-11T02:28:02+0000\'\u003e11\\/Jan\\/06 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFile corruption could cause this.  Please look in your system logs to see if there are any reports of problems accessing the drive that stores this index.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"cutting\\\" id=\\\"commentauthor_12362354_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=cutting\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"cutting\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doug Cutting\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362354_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/06 02:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-11T02:28:02+0000\'\u003e11\\/Jan\\/06 02:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    File corruption could cause this.  Please look in your system logs to see if there are any reports of problems accessing the drive that stores this index.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12362866\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12362866&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12362866\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12362866_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362866_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/06 02:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-17T02:45:00+0000\'\u003e17\\/Jan\\/06 02:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Doug,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for your suggestion (and great work on Lucene!). I looked in the logs and could not find any indication of corruption. In addition we actually have the system running in a cluster where each node in the cluster has its own lucene search index. We had the issue on a different machine before we moved to the cluster and we now see it on both machines in our cluster \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/sad.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e. Next time it occurs I will get the indexes and try to post them here if you think that would be helpful.\u003c\\/p\u003e\\n\\n\u003cp\u003eJust some additional info: \u003cbr\\/\u003e\\n1)  We are running SUSE 10 Linux.\u003cbr\\/\u003e\\n2)  We run two quartz jobs: One job runs every 2 minutes and updates lucene with changes from the db if necessary. The other job runs at 3:30AM in the morning and does full index rebuilds. We use the LuceneIndexAccess api when working with the IndexReader\\/IndexWriter. Only one thread should modify the index at any time although it is possible that the full rebuild job and the update job execute concurrently they shouldn\'t both modify the index due to the LuceneIndexAccess API\'s synchronization.\u003cbr\\/\u003e\\n3) Currently when doing searches we create a new IndexSearcher everytime a search is to be performed; We do not use the LuceneIndexAccess API.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I refer to the LuceneIndexAccess API I am referring to the contribution by Mark Schreiber:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/www.blizzy.de\\/lucene\\/lucene-indexaccess-0.1.0.zip\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/www.blizzy.de\\/lucene\\/lucene-indexaccess-0.1.0.zip\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for any help!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12362866_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12362866_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jan\\/06 02:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-17T02:45:00+0000\'\u003e17\\/Jan\\/06 02:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Doug, \\n\\n Thanks for your suggestion (and great work on Lucene!). I looked in the logs and could not find any indication of corruption. In addition we actually have the system running in a cluster where each node in the cluster has its own lucene search index. We had the issue on a different machine before we moved to the cluster and we now see it on both machines in our cluster  . Next time it occurs I will get the indexes and try to post them here if you think that would be helpful. \\n\\n Just some additional info:  \\n1)  We are running SUSE 10 Linux. \\n2)  We run two quartz jobs: One job runs every 2 minutes and updates lucene with changes from the db if necessary. The other job runs at 3:30AM in the morning and does full index rebuilds. We use the LuceneIndexAccess api when working with the IndexReader\\/IndexWriter. Only one thread should modify the index at any time although it is possible that the full rebuild job and the update job execute concurrently they shouldn\'t both modify the index due to the LuceneIndexAccess API\'s synchronization. \\n3) Currently when doing searches we create a new IndexSearcher everytime a search is to be performed; We do not use the LuceneIndexAccess API. \\n\\n When I refer to the LuceneIndexAccess API I am referring to the contribution by Mark Schreiber: \\n http:\\/\\/www.blizzy.de\\/lucene\\/lucene-indexaccess-0.1.0.zip  \\n\\n Thanks for any help!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12363156\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12363156&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12363156\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rmajewski\\\" id=\\\"commentauthor_12363156_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rmajewski\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rmajewski\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rafal Majewski\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12363156_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/06 05:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-19T05:57:46+0000\'\u003e19\\/Jan\\/06 05:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eI have recently experienced the same problem on relase 1.4.3. It happended in production(more than once). Filesystem index directory is used. One application is accountable for indexing, another for searching the index(it also uses IndexReader for query rewriting). Access to index directory(which is singleton) is synchronized within each application\'s scope. These two applications create separate directory instances and access it independently. Unfortunately,  the code doesn\'t lead to repeatable occurances of this exception. I assume that  these two applications having not synchronized access to the index might couse the problem, but I have received information that it had also occured with the searching application being down.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks in advance for any help.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rmajewski\\\" id=\\\"commentauthor_12363156_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rmajewski\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rmajewski\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Rafal Majewski\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12363156_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jan\\/06 05:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-19T05:57:46+0000\'\u003e19\\/Jan\\/06 05:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n I have recently experienced the same problem on relase 1.4.3. It happended in production(more than once). Filesystem index directory is used. One application is accountable for indexing, another for searching the index(it also uses IndexReader for query rewriting). Access to index directory(which is singleton) is synchronized within each application\'s scope. These two applications create separate directory instances and access it independently. Unfortunately,  the code doesn\'t lead to repeatable occurances of this exception. I assume that  these two applications having not synchronized access to the index might couse the problem, but I have received information that it had also occured with the searching application being down. \\n\\n Thanks in advance for any help.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12363471\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12363471&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12363471\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12363471_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12363471_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/06 07:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-21T07:41:44+0000\'\u003e21\\/Jan\\/06 07:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI am posting our corrupted index (I have to do it in two  parts because it is 14.5M). I looked at it in Luke but Luke doesn\'t really have any tools to help really diagnose corruption issues. At this point we are considering changing our system to do builds on one machine, test them, and then have them distributed to the other machines in our cluster.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf anybody could look at this it would be greatly appreciated!\u003cbr\\/\u003e\\nThanks!\u003cbr\\/\u003e\\nJarrod\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12363471_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12363471_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/06 07:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-21T07:41:44+0000\'\u003e21\\/Jan\\/06 07:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I am posting our corrupted index (I have to do it in two  parts because it is 14.5M). I looked at it in Luke but Luke doesn\'t really have any tools to help really diagnose corruption issues. At this point we are considering changing our system to do builds on one machine, test them, and then have them distributed to the other machines in our cluster. \\n\\n If anybody could look at this it would be greatly appreciated! \\nThanks! \\nJarrod              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12363473\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12363473&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12363473\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12363473_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12363473_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/06 07:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-21T07:44:02+0000\'\u003e21\\/Jan\\/06 07:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSecond part. \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jcuzens\\\" id=\\\"commentauthor_12363473_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jcuzens\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jcuzens\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jarrod Cuzens\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12363473_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Jan\\/06 07:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-01-21T07:44:02+0000\'\u003e21\\/Jan\\/06 07:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Second part.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12374312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12374312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12374312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"alesj\\\" id=\\\"commentauthor_12374312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=alesj\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"alesj\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ales Justin\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12374312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/06 16:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-13T16:13:41+0000\'\u003e13\\/Apr\\/06 16:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe used Lucene 1.4.3. for a half year now.\u003cbr\\/\u003e\\nBut just out of the sudden this issue appeared.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe have synchronized access to index - synchronized singleton handling all write \\/ read operations.\u003c\\/p\u003e\\n\\n\u003cp\u003eIs there any progress on finding the cause?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"alesj\\\" id=\\\"commentauthor_12374312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=alesj\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"alesj\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ales Justin\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12374312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Apr\\/06 16:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-13T16:13:41+0000\'\u003e13\\/Apr\\/06 16:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We used Lucene 1.4.3. for a half year now. \\nBut just out of the sudden this issue appeared. \\n\\n We have synchronized access to index - synchronized singleton handling all write \\/ read operations. \\n\\n Is there any progress on finding the cause?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12376780\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12376780&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12376780\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jlambert\\\" id=\\\"commentauthor_12376780_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jlambert\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jlambert\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Lambert\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12376780_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Apr\\/06 01:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-28T01:49:21+0000\'\u003e28\\/Apr\\/06 01:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI was having this problem intermittently while indexing over multiple threads and I have found that the following steps can cause this error (with Lucene 1.3 and 1.4.x):\u003c\\/p\u003e\\n\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eOpen an IndexReader (#1) over an existing index (this reader is used for searching while updating the index)\u003c\\/li\u003e\\n\\t\u003cli\u003eUsing this reader (#1) do a search for the document(s) that you would like to update; obtain their document ID numbers\u003c\\/li\u003e\\n\\t\u003cli\u003eCreate an IndexWriter and add several new documents to the index (for me, this writing is done in other threads) \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003eClose the IndexWriter \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003eOpen another IndexReader (#2) over the index\u003c\\/li\u003e\\n\\t\u003cli\u003eDelete the previously found documents by their document ID numbers using reader #2\u003c\\/li\u003e\\n\\t\u003cli\u003eClose the #2 reader\u003c\\/li\u003e\\n\\t\u003cli\u003eCreate another IndexWriter (#2) and re-add the updated documents\u003c\\/li\u003e\\n\\t\u003cli\u003eClose the IndexWriter #2\u003c\\/li\u003e\\n\\t\u003cli\u003eClose the original IndexReader (#1) and open a new reader for general searching\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIf I ensure that the steps marked with an asterisk \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e do not happen (i.e. using thread synchronization), I never get this error.  Otherwise, it will happen intermittently while closing the second IndexWriter (#2)  (sometimes I get an ArrayIndexOutOfBoundsException during the deletion).  These \'extra\' writes cause the initial \'segments\' file to be updated after which it is re-read while opening the second IndexReader (#2).\u003c\\/p\u003e\\n\\n\u003cp\u003eThis can end up deleting documents using possibly non-existent IDs, most likely causing the index corruption that this error signals.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jlambert\\\" id=\\\"commentauthor_12376780_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jlambert\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jlambert\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jason Lambert\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12376780_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Apr\\/06 01:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-04-28T01:49:21+0000\'\u003e28\\/Apr\\/06 01:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I was having this problem intermittently while indexing over multiple threads and I have found that the following steps can cause this error (with Lucene 1.3 and 1.4.x): \\n\\n \\n\\t Open an IndexReader (#1) over an existing index (this reader is used for searching while updating the index) \\n\\t Using this reader (#1) do a search for the document(s) that you would like to update; obtain their document ID numbers \\n\\t Create an IndexWriter and add several new documents to the index (for me, this writing is done in other threads)   \\n\\t Close the IndexWriter   \\n\\t Open another IndexReader (#2) over the index \\n\\t Delete the previously found documents by their document ID numbers using reader #2 \\n\\t Close the #2 reader \\n\\t Create another IndexWriter (#2) and re-add the updated documents \\n\\t Close the IndexWriter #2 \\n\\t Close the original IndexReader (#1) and open a new reader for general searching \\n \\n\\n\\n If I ensure that the steps marked with an asterisk   do not happen (i.e. using thread synchronization), I never get this error.  Otherwise, it will happen intermittently while closing the second IndexWriter (#2)  (sometimes I get an ArrayIndexOutOfBoundsException during the deletion).  These \'extra\' writes cause the initial \'segments\' file to be updated after which it is re-read while opening the second IndexReader (#2). \\n\\n This can end up deleting documents using possibly non-existent IDs, most likely causing the index corruption that this error signals.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12458669\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12458669&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12458669\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12458669_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458669_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Dec\\/06 04:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-15T04:11:17+0000\'\u003e15\\/Dec\\/06 04:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe have seen this one as well. We don\'t have the same usage as above, we only ever delete documents with IndexReader.deleteDocuments(Term)\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are using Lucene 1.9.1\u003c\\/p\u003e\\n\\n\u003cp\u003eIt occurs in two places, inside IndexWriter.addDocument():\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.lang.IllegalStateException: docs out of order\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.appendPostings([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)I(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfo([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)V(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfos()V(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.mergeTerms()V(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.merge()I(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(I)V(IndexWriter.java:658)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.maybeMergeSegments()V(IndexWriter.java:646)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;Lorg\\/apache\\/lucene\\/analysis\\/Analyzer;)V(IndexWriter.java:453)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;)V(IndexWriter.java:436)\u003c\\/p\u003e\\n\\n\u003cp\u003eand inside IndexWriter.close():\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.lang.IllegalStateException: docs out of order\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.appendPostings([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)I(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfo([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)V(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfos()V(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.mergeTerms()V(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.SegmentMerger.merge()I(Optimized Method)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(I)V(IndexWriter.java:658)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.flushRamSegments()V(IndexWriter.java:628)\u003cbr\\/\u003e\\n\\tat org.apache.lucene.index.IndexWriter.close()V(IndexWriter.java:375)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe second one exposes a problem in the close() method which is that the index write.lock is not released when exceptions are thrown in close() causing subsequent attempts to open an IndexWriter to fail.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12458669_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12458669_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Dec\\/06 04:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-15T04:11:17+0000\'\u003e15\\/Dec\\/06 04:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We have seen this one as well. We don\'t have the same usage as above, we only ever delete documents with IndexReader.deleteDocuments(Term) \\n\\n We are using Lucene 1.9.1 \\n\\n It occurs in two places, inside IndexWriter.addDocument(): \\n\\n java.lang.IllegalStateException: docs out of order \\n\\tat org.apache.lucene.index.SegmentMerger.appendPostings([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)I(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfo([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)V(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfos()V(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.mergeTerms()V(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.merge()I(Optimized Method) \\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681) \\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(I)V(IndexWriter.java:658) \\n\\tat org.apache.lucene.index.IndexWriter.maybeMergeSegments()V(IndexWriter.java:646) \\n\\tat org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;Lorg\\/apache\\/lucene\\/analysis\\/Analyzer;)V(IndexWriter.java:453) \\n\\tat org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;)V(IndexWriter.java:436) \\n\\n and inside IndexWriter.close(): \\n\\n java.lang.IllegalStateException: docs out of order \\n\\tat org.apache.lucene.index.SegmentMerger.appendPostings([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)I(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfo([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)V(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.mergeTermInfos()V(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.mergeTerms()V(Optimized Method) \\n\\tat org.apache.lucene.index.SegmentMerger.merge()I(Optimized Method) \\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681) \\n\\tat org.apache.lucene.index.IndexWriter.mergeSegments(I)V(IndexWriter.java:658) \\n\\tat org.apache.lucene.index.IndexWriter.flushRamSegments()V(IndexWriter.java:628) \\n\\tat org.apache.lucene.index.IndexWriter.close()V(IndexWriter.java:375) \\n\\n The second one exposes a problem in the close() method which is that the index write.lock is not released when exceptions are thrown in close() causing subsequent attempts to open an IndexWriter to fail.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12459457\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12459457&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12459457\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12459457_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459457_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/06 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-18T20:57:43+0000\'\u003e18\\/Dec\\/06 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI just resolved \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-603\\\" title=\\\"index optimize problem\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-603\\\"\u003e\u003cdel\u003eLUCENE-603\u003c\\/del\u003e\u003c\\/a\u003e as a dup of this issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be awesome if we could get a test case that shows this happening.  Enough people seem to hit it that it seems likely something is lurking out there so I\'d like to get it fixed!!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12459457_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12459457_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Dec\\/06 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2006-12-18T20:57:43+0000\'\u003e18\\/Dec\\/06 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I just resolved   LUCENE-603   as a dup of this issue. \\n\\n It would be awesome if we could get a test case that shows this happening.  Enough people seem to hit it that it seems likely something is lurking out there so I\'d like to get it fixed!!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12462949\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12462949&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12462949\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12462949_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12462949_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 05:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T05:42:15+0000\'\u003e08\\/Jan\\/07 05:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe have now seen this in a number of customer sites since upgrading JIRA to use Lucene 1.9.1. The JIRA report is here: \u003ca href=\\\"http:\\/\\/jira.atlassian.com\\/browse\\/JRA-11861\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/jira.atlassian.com\\/browse\\/JRA-11861\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eWe only seem to have seen it since the upgrade from 1.4.3 to 1.9.1, we hadn\'t seen it before then.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is now a major issue for us, it is hitting a number of our customers. I am trying to generate a repeatable test for it as a matter of urgency.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs a follow-up we sometimes see the old ArrayIndexOutOfBoundsEx in BitVector.get() (BitVector.java:63)\u003c\\/p\u003e\\n\\n\u003cp\u003ewill post more if I find something worth sharing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12462949_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12462949_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 05:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T05:42:15+0000\'\u003e08\\/Jan\\/07 05:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We have now seen this in a number of customer sites since upgrading JIRA to use Lucene 1.9.1. The JIRA report is here:  http:\\/\\/jira.atlassian.com\\/browse\\/JRA-11861  \\n\\n We only seem to have seen it since the upgrade from 1.4.3 to 1.9.1, we hadn\'t seen it before then. \\n\\n This is now a major issue for us, it is hitting a number of our customers. I am trying to generate a repeatable test for it as a matter of urgency. \\n\\n As a follow-up we sometimes see the old ArrayIndexOutOfBoundsEx in BitVector.get() (BitVector.java:63) \\n\\n will post more if I find something worth sharing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12462950\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12462950&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12462950\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12462950_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12462950_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 05:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T05:44:17+0000\'\u003e08\\/Jan\\/07 05:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eand we also see ArrayIndexOutOfBoundsEx in the SegmentReader.isDeleted() method:\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.lang.ArrayIndexOutOfBoundsException\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentReader.isDeleted(I)Z(Optimized Method)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.mergeFields()I(Optimized Method)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.merge()I(Optimized Method)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12462950_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12462950_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 05:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T05:44:17+0000\'\u003e08\\/Jan\\/07 05:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    and we also see ArrayIndexOutOfBoundsEx in the SegmentReader.isDeleted() method: \\n\\n java.lang.ArrayIndexOutOfBoundsException \\n        at org.apache.lucene.index.SegmentReader.isDeleted(I)Z(Optimized Method) \\n        at org.apache.lucene.index.SegmentMerger.mergeFields()I(Optimized Method) \\n        at org.apache.lucene.index.SegmentMerger.merge()I(Optimized Method) \\n        at org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463029\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463029&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463029\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463029_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463029_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T13:09:05+0000\'\u003e08\\/Jan\\/07 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK: I finally found one way that this corruption can occur!  I will\u003cbr\\/\u003e\\ncreate a unit test &amp; commit a fix.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you delete by document number, and, that document number is larger\u003cbr\\/\u003e\\nthan maxDoc, but only by a little, then the call to\u003cbr\\/\u003e\\ndeletedDocs.set(num) may in fact succeed (ie, no exception), but will\u003cbr\\/\u003e\\nhave set bits that are \\\"out of bounds\\\" in the BitVector\'s bits array.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is because the bits array is an array of bytes and so you can\u003cbr\\/\u003e\\nhave up to 7 of these unused bits at the end.  Once this has happened,\u003cbr\\/\u003e\\nany attempt to merge this segment will hit the \\\"docs out of order\\\"\u003cbr\\/\u003e\\nexception because the BitVector\'s count() method will count these\u003cbr\\/\u003e\\n\\\"illegally set\\\" bits and thus make the SegmentMerger think too many\u003cbr\\/\u003e\\ndocs are deleted. \u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately, this case only occurs if you use deleteDocument(int),\u003cbr\\/\u003e\\nso I can\'t yet explain how this happens when using only\u003cbr\\/\u003e\\ndeleteDocument(Term).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463029_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463029_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T13:09:05+0000\'\u003e08\\/Jan\\/07 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK: I finally found one way that this corruption can occur!  I will \\ncreate a unit test &amp; commit a fix. \\n\\n If you delete by document number, and, that document number is larger \\nthan maxDoc, but only by a little, then the call to \\ndeletedDocs.set(num) may in fact succeed (ie, no exception), but will \\nhave set bits that are \\\"out of bounds\\\" in the BitVector\'s bits array. \\n\\n This is because the bits array is an array of bytes and so you can \\nhave up to 7 of these unused bits at the end.  Once this has happened, \\nany attempt to merge this segment will hit the \\\"docs out of order\\\" \\nexception because the BitVector\'s count() method will count these \\n\\\"illegally set\\\" bits and thus make the SegmentMerger think too many \\ndocs are deleted.  \\n\\n Unfortunately, this case only occurs if you use deleteDocument(int), \\nso I can\'t yet explain how this happens when using only \\ndeleteDocument(Term).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463093\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463093&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463093\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463093_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463093_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T18:34:10+0000\'\u003e08\\/Jan\\/07 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eI\'ve committed a fix for this one case to the trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m leaving the issue open so folks above can try the fix and confirm\u003cbr\\/\u003e\\nwhether or not this fixes their cases.\u003c\\/p\u003e\\n\\n\u003cp\u003eJed (or any other folks who have hit this above and are still\u003cbr\\/\u003e\\nlistening!), the fix is really trivial and would be easy to back\u003cbr\\/\u003e\\nport to prior releases: just run \\\"svn diff -r 494135:494136\\\" from\u003cbr\\/\u003e\\na Lucene checkout to see them.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you are willing\\/able to try this in one of the environments where\u003cbr\\/\u003e\\nyou keep hitting this issue, that would be awesome: if this is in fact\u003cbr\\/\u003e\\nyour root cause, then you would see an ArrayIndexOutOfBoundsException\u003cbr\\/\u003e\\nat the point that the delete of a too-large docNum occurred (rather\u003cbr\\/\u003e\\nthan silent corruption and the above exception much later that you now\u003cbr\\/\u003e\\nsee); and if it\'s not your root cause after testing the fix, then we\u003cbr\\/\u003e\\nwould know for sure to look for another cause here.\u003c\\/p\u003e\\n\\n\u003cp\u003eAre you sure that you only ever do IndexReader.deleteDocuments(Term)\u003cbr\\/\u003e\\nand not deleteDocuments(int docNum)?  I still can\'t explain how this\u003cbr\\/\u003e\\nerror could happen without using that second method.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463093_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463093_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jan\\/07 18:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-08T18:34:10+0000\'\u003e08\\/Jan\\/07 18:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n I\'ve committed a fix for this one case to the trunk. \\n\\n I\'m leaving the issue open so folks above can try the fix and confirm \\nwhether or not this fixes their cases. \\n\\n Jed (or any other folks who have hit this above and are still \\nlistening!), the fix is really trivial and would be easy to back \\nport to prior releases: just run \\\"svn diff -r 494135:494136\\\" from \\na Lucene checkout to see them. \\n\\n If you are willing\\/able to try this in one of the environments where \\nyou keep hitting this issue, that would be awesome: if this is in fact \\nyour root cause, then you would see an ArrayIndexOutOfBoundsException \\nat the point that the delete of a too-large docNum occurred (rather \\nthan silent corruption and the above exception much later that you now \\nsee); and if it\'s not your root cause after testing the fix, then we \\nwould know for sure to look for another cause here. \\n\\n Are you sure that you only ever do IndexReader.deleteDocuments(Term) \\nand not deleteDocuments(int docNum)?  I still can\'t explain how this \\nerror could happen without using that second method.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463176\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463176&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463176\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12463176_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463176_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 01:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T01:27:24+0000\'\u003e09\\/Jan\\/07 01:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAmazed by this long lasting bug report I was going similar routes to Mike, and I noticed 3 things - \u003c\\/p\u003e\\n\\n\u003cp\u003e(1) the sequence of ops brought by Jason is wrong: \u003cbr\\/\u003e\\n \u003cdel\u003ea\u003c\\/del\u003e Open an IndexReader (#1) over an existing index (this reader is used for searching while updating the index)\u003cbr\\/\u003e\\n \u003cdel\u003eb\u003c\\/del\u003e Using this reader (#1) do a search for the document(s) that you would like to update; obtain their document ID numbers\u003cbr\\/\u003e\\n \u003cdel\u003ec\u003c\\/del\u003e Create an IndexWriter and add several new documents to the index (for me, this writing is done in other threads) \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\n \u003cdel\u003ed\u003c\\/del\u003e Close the IndexWriter \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\n \u003cdel\u003ee\u003c\\/del\u003e Open another IndexReader (#2) over the index\u003cbr\\/\u003e\\n \u003cdel\u003ef\u003c\\/del\u003e Delete the previously found documents by their document ID numbers using reader #2\u003cbr\\/\u003e\\n \u003cdel\u003eg\u003c\\/del\u003e Close the #2 reader\u003cbr\\/\u003e\\n \u003cdel\u003eh\u003c\\/del\u003e Create another IndexWriter (#2) and re-add the updated documents\u003cbr\\/\u003e\\n \u003cdel\u003ei\u003c\\/del\u003e Close the IndexWriter #2\u003cbr\\/\u003e\\n \u003cdel\u003ej\u003c\\/del\u003e Close the original IndexReader (#1) and open a new reader for general searching\u003c\\/p\u003e\\n\\n\u003cp\u003eProblem here is that the docIDs found in (b) may be altered in step (d) and so step (f) would delete the wrong docs. In particular, it might attempt to delete ids that are out of the range. This might expose exactly the BitVector problem, and would explain the whole thing, but I too cannot see how it explains the delete-by-term case.\u003c\\/p\u003e\\n\\n\u003cp\u003e(2) BitVectort silent ignoring of attempts to delete slightly-out-of-bound docs that fall in the higher byte - this the problem that Mike fixed. I think the fix is okay - though some applications might now get exceptions they did not get in the past - but I believe this is for their own good. \u003cbr\\/\u003e\\nHowever when I first ran into this I didn\'t notice that BitVector.size() would become wrong as result of this - nice catch Mike!\u003c\\/p\u003e\\n\\n\u003cp\u003eI think however that the test Mike added does not expose the docs out of order bug - I tried this test without the fix and it only fail on the \\\"gotException assert\\\" - if you comment this assert the test pass. \u003c\\/p\u003e\\n\\n\u003cp\u003eThe following test would expose the out-of-order bug - it would fail with out-of-order before the fix, and would succeed without it. \u003c\\/p\u003e\\n\\n\u003cp\u003e  public void testOutOfOrder () throws IOException {\u003cbr\\/\u003e\\n    String tempDir = System.getProperty(\\\"java.io.tmpdir\\\");\u003cbr\\/\u003e\\n    if (tempDir == null) \u003c\\/p\u003e\\n{\\n      throw new IOException(\\\"java.io.tmpdir undefined, cannot run test: \\\"+getName());\\n    }\\n\\n\u003cp\u003e    File indexDir = new File(tempDir, \\\"lucenetestindexTemp\\\");\u003cbr\\/\u003e\\n    Directory dir = FSDirectory.getDirectory(indexDir, true);\u003c\\/p\u003e\\n\\n\u003cp\u003e    boolean create = true;\u003cbr\\/\u003e\\n    int numDocs = 0;\u003cbr\\/\u003e\\n    int maxDoc = 0;\u003cbr\\/\u003e\\n    while (numDocs &lt; 100) {\u003cbr\\/\u003e\\n      IndexWriter iw = new IndexWriter(dir,anlzr,create);\u003cbr\\/\u003e\\n      create = false;\u003cbr\\/\u003e\\n      iw.setUseCompoundFile(false);\u003cbr\\/\u003e\\n      for (int i=0; i&lt;2; i++) \u003c\\/p\u003e\\n{\\n        Document d = new Document();\\n        d.add(new Field(\\\"body\\\",\\\"body\\\"+i,Store.NO,Index.UN_TOKENIZED));\\n        iw.addDocument(d);\\n      }\\n\u003cp\u003e      iw.optimize();\u003cbr\\/\u003e\\n      iw.close();\u003cbr\\/\u003e\\n      IndexReader ir = IndexReader.open(dir);\u003cbr\\/\u003e\\n      numDocs = ir.numDocs();\u003cbr\\/\u003e\\n      maxDoc = ir.maxDoc();\u003cbr\\/\u003e\\n      assertEquals(numDocs,maxDoc);\u003cbr\\/\u003e\\n      for (int i=7; i &gt;=\u003cdel\u003e1; i\u003c\\/del\u003e-) {\u003cbr\\/\u003e\\n        try \u003c\\/p\u003e\\n{\\n          ir.deleteDocument(maxDoc+i);\\n        }\\n\u003cp\u003e catch (ArrayIndexOutOfBoundsException e) {  \u003cbr\\/\u003e\\n        }\u003cbr\\/\u003e\\n      }\u003cbr\\/\u003e\\n      ir.close();\u003cbr\\/\u003e\\n    }\u003cbr\\/\u003e\\n  }\u003c\\/p\u003e\\n\\n\u003cp\u003eMike, do you agree?\u003c\\/p\u003e\\n\\n\u003cp\u003e(3) maxDoc() computation in SegmentReader is based (on some paths) in RandomAccessFile.length(). IIRC I saw cases (in previous project) where File.length() or RAF.length() (not sure which of the two) did not always reflect real length, if the system was very busy IO wise, unless FD.sync() was called (with performance hit). \u003c\\/p\u003e\\n\\n\u003cp\u003eThis post seems relevant - RAF.length over 2GB in NFS - \u003ca href=\\\"http:\\/\\/forum.java.sun.com\\/thread.jspa?threadID=708670&amp;messageID=4103657\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/forum.java.sun.com\\/thread.jspa?threadID=708670&amp;messageID=4103657\u003c\\/a\u003e \u003c\\/p\u003e\\n\\n\u003cp\u003eNot sure if this can be the case here but at least we can discuss whether it is better to always store the length.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12463176_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463176_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 01:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T01:27:24+0000\'\u003e09\\/Jan\\/07 01:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Amazed by this long lasting bug report I was going similar routes to Mike, and I noticed 3 things -  \\n\\n (1) the sequence of ops brought by Jason is wrong:  \\n  a  Open an IndexReader (#1) over an existing index (this reader is used for searching while updating the index) \\n  b  Using this reader (#1) do a search for the document(s) that you would like to update; obtain their document ID numbers \\n  c  Create an IndexWriter and add several new documents to the index (for me, this writing is done in other threads)   \\n  d  Close the IndexWriter   \\n  e  Open another IndexReader (#2) over the index \\n  f  Delete the previously found documents by their document ID numbers using reader #2 \\n  g  Close the #2 reader \\n  h  Create another IndexWriter (#2) and re-add the updated documents \\n  i  Close the IndexWriter #2 \\n  j  Close the original IndexReader (#1) and open a new reader for general searching \\n\\n Problem here is that the docIDs found in (b) may be altered in step (d) and so step (f) would delete the wrong docs. In particular, it might attempt to delete ids that are out of the range. This might expose exactly the BitVector problem, and would explain the whole thing, but I too cannot see how it explains the delete-by-term case. \\n\\n (2) BitVectort silent ignoring of attempts to delete slightly-out-of-bound docs that fall in the higher byte - this the problem that Mike fixed. I think the fix is okay - though some applications might now get exceptions they did not get in the past - but I believe this is for their own good.  \\nHowever when I first ran into this I didn\'t notice that BitVector.size() would become wrong as result of this - nice catch Mike! \\n\\n I think however that the test Mike added does not expose the docs out of order bug - I tried this test without the fix and it only fail on the \\\"gotException assert\\\" - if you comment this assert the test pass.  \\n\\n The following test would expose the out-of-order bug - it would fail with out-of-order before the fix, and would succeed without it.  \\n\\n   public void testOutOfOrder () throws IOException { \\n    String tempDir = System.getProperty(\\\"java.io.tmpdir\\\"); \\n    if (tempDir == null)  \\n{\\n      throw new IOException(\\\"java.io.tmpdir undefined, cannot run test: \\\"+getName());\\n    }\\n\\n     File indexDir = new File(tempDir, \\\"lucenetestindexTemp\\\"); \\n    Directory dir = FSDirectory.getDirectory(indexDir, true); \\n\\n     boolean create = true; \\n    int numDocs = 0; \\n    int maxDoc = 0; \\n    while (numDocs &lt; 100) { \\n      IndexWriter iw = new IndexWriter(dir,anlzr,create); \\n      create = false; \\n      iw.setUseCompoundFile(false); \\n      for (int i=0; i&lt;2; i++)  \\n{\\n        Document d = new Document();\\n        d.add(new Field(\\\"body\\\",\\\"body\\\"+i,Store.NO,Index.UN_TOKENIZED));\\n        iw.addDocument(d);\\n      }\\n       iw.optimize(); \\n      iw.close(); \\n      IndexReader ir = IndexReader.open(dir); \\n      numDocs = ir.numDocs(); \\n      maxDoc = ir.maxDoc(); \\n      assertEquals(numDocs,maxDoc); \\n      for (int i=7; i &gt;= 1; i -) { \\n        try  \\n{\\n          ir.deleteDocument(maxDoc+i);\\n        }\\n  catch (ArrayIndexOutOfBoundsException e) {   \\n        } \\n      } \\n      ir.close(); \\n    } \\n  } \\n\\n Mike, do you agree? \\n\\n (3) maxDoc() computation in SegmentReader is based (on some paths) in RandomAccessFile.length(). IIRC I saw cases (in previous project) where File.length() or RAF.length() (not sure which of the two) did not always reflect real length, if the system was very busy IO wise, unless FD.sync() was called (with performance hit).  \\n\\n This post seems relevant - RAF.length over 2GB in NFS -  http:\\/\\/forum.java.sun.com\\/thread.jspa?threadID=708670&amp;messageID=4103657   \\n\\n Not sure if this can be the case here but at least we can discuss whether it is better to always store the length. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463202\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463202&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463202\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463202_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463202_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 06:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T06:38:56+0000\'\u003e09\\/Jan\\/07 06:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Michael,\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is awesome, I have prepared a patched 1.9.1: \u003ca href=\\\"http:\\/\\/jira.atlassian.com\\/secure\\/attachment\\/19390\\/lucene-core-1.9.1-atlassian-patched-2007-01-09.jar\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/jira.atlassian.com\\/secure\\/attachment\\/19390\\/lucene-core-1.9.1-atlassian-patched-2007-01-09.jar\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eUnfortunately we don\'t have a repeatable test for this so we will have to distribute to afflicted customers and - well, pray I guess. We have been seeing this sporadically in our main JIRA instance \u003ca href=\\\"http:\\/\\/jira.atlassian.com\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/jira.atlassian.com\u003c\\/a\u003e so we will hopefully not observe it now.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe do only use the deleteDocuments(Term) method, so we are not sure whether this will truly fix our problem, but we note that that method calls deleteDocument(int) based on the TermDocs returned for the Term - and maybe they can be incorrect???\u003c\\/p\u003e\\n\\n\u003cp\u003eOut of interest, apart from changing from 1.4.3 to 1.9.1, in the JIRA 3.7 release we changed our default merge factor to 4 from 10. We hadn\'t seen this problem before, and suddenly we have had a reasonable number of occurrences. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463202_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463202_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 06:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T06:38:56+0000\'\u003e09\\/Jan\\/07 06:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Michael, \\n\\n This is awesome, I have prepared a patched 1.9.1:  http:\\/\\/jira.atlassian.com\\/secure\\/attachment\\/19390\\/lucene-core-1.9.1-atlassian-patched-2007-01-09.jar  \\n\\n Unfortunately we don\'t have a repeatable test for this so we will have to distribute to afflicted customers and - well, pray I guess. We have been seeing this sporadically in our main JIRA instance  http:\\/\\/jira.atlassian.com  so we will hopefully not observe it now. \\n\\n We do only use the deleteDocuments(Term) method, so we are not sure whether this will truly fix our problem, but we note that that method calls deleteDocument(int) based on the TermDocs returned for the Term - and maybe they can be incorrect??? \\n\\n Out of interest, apart from changing from 1.4.3 to 1.9.1, in the JIRA 3.7 release we changed our default merge factor to 4 from 10. We hadn\'t seen this problem before, and suddenly we have had a reasonable number of occurrences.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 06:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T06:41:40+0000\'\u003e09\\/Jan\\/07 06:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlas, this doesn\'t appear to be the problem. We are still getting it, but we do at least have a little more info. We added the doc and lastDoc to the IllegalArgEx and we are getting very strange numbers:\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.lang.IllegalStateException: docs out of order (-1764 &lt; 0)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.appendPostings([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)I(SegmentMerger.java:335)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.mergeTermInfo([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)V(SegmentMerger.java:298)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.mergeTermInfos()V(SegmentMerger.java:272) \u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.mergeTerms()V(SegmentMerger.java:236)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.SegmentMerger.merge()I(SegmentMerger.java:89)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.IndexWriter.mergeSegments(I)V(IndexWriter.java:658)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.IndexWriter.maybeMergeSegments()V(IndexWriter.java:646)\u003cbr\\/\u003e\\n        at org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;Lorg\\/apache\\/lucene\\/analysis\\/Analyzer;)V(IndexWriter.java:453) \u003cbr\\/\u003e\\n        at org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;)V(IndexWriter.java:436)\u003c\\/p\u003e\\n\\n\u003cp\u003ewhere doc = -1764 and lastDoc is zero\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 06:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T06:41:40+0000\'\u003e09\\/Jan\\/07 06:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Alas, this doesn\'t appear to be the problem. We are still getting it, but we do at least have a little more info. We added the doc and lastDoc to the IllegalArgEx and we are getting very strange numbers: \\n\\n java.lang.IllegalStateException: docs out of order (-1764 &lt; 0) \\n        at org.apache.lucene.index.SegmentMerger.appendPostings([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)I(SegmentMerger.java:335) \\n        at org.apache.lucene.index.SegmentMerger.mergeTermInfo([Lorg\\/apache\\/lucene\\/index\\/SegmentMergeInfo;I)V(SegmentMerger.java:298) \\n        at org.apache.lucene.index.SegmentMerger.mergeTermInfos()V(SegmentMerger.java:272)  \\n        at org.apache.lucene.index.SegmentMerger.mergeTerms()V(SegmentMerger.java:236) \\n        at org.apache.lucene.index.SegmentMerger.merge()I(SegmentMerger.java:89) \\n        at org.apache.lucene.index.IndexWriter.mergeSegments(II)V(IndexWriter.java:681) \\n        at org.apache.lucene.index.IndexWriter.mergeSegments(I)V(IndexWriter.java:658) \\n        at org.apache.lucene.index.IndexWriter.maybeMergeSegments()V(IndexWriter.java:646) \\n        at org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;Lorg\\/apache\\/lucene\\/analysis\\/Analyzer;)V(IndexWriter.java:453)  \\n        at org.apache.lucene.index.IndexWriter.addDocument(Lorg\\/apache\\/lucene\\/document\\/Document;)V(IndexWriter.java:436) \\n\\n where doc = -1764 and lastDoc is zero              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463243\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463243&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463243\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463243_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463243_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 11:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T11:18:16+0000\'\u003e09\\/Jan\\/07 11:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJed, thanks for testing the fix!\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Alas, this doesn\'t appear to be the problem. We are still getting\u003cbr\\/\u003e\\n&gt; it, but we do at least have a little more info. We added the doc and\u003cbr\\/\u003e\\n&gt; lastDoc to the IllegalArgEx and we are getting very strange numbers:\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; java.lang.IllegalStateException: docs out of order (-1764 &lt; 0)\u003cbr\\/\u003e\\n&gt; ...\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; where doc = -1764 and lastDoc is zero\u003c\\/p\u003e\\n\\n\u003cp\u003eOK, so we\'ve definitely got something else at play here (bummer!). That\u003cbr\\/\u003e\\n(negative doc number) is very strange.  I will keep looking a this.  I\u003cbr\\/\u003e\\nwill prepare a patch on 1.9.1 that adds some more instrumentation so\u003cbr\\/\u003e\\nwe can get more details when you hit this ...\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; We do only use the deleteDocuments(Term) method, so we are not sure\u003cbr\\/\u003e\\n&gt; whether this will truly fix our problem, but we note that that\u003cbr\\/\u003e\\n&gt; method calls deleteDocument(int) based on the TermDocs returned for\u003cbr\\/\u003e\\n&gt; the Term - and maybe they can be incorrect???\u003c\\/p\u003e\\n\\n\u003cp\u003eRight, but I had thought the docNum\'s coming in from this path would\u003cbr\\/\u003e\\nbe correct.  It sounds like we have another issue at play here that\u003cbr\\/\u003e\\ncan somehow get even these doc numbers messed up.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; Out of interest, apart from changing from 1.4.3 to 1.9.1, in the\u003cbr\\/\u003e\\n&gt; JIRA 3.7 release we changed our default merge factor to 4 from\u003cbr\\/\u003e\\n&gt; 10. We hadn\'t seen this problem before, and suddenly we have had a\u003cbr\\/\u003e\\n&gt; reasonable number of occurrences.\u003c\\/p\u003e\\n\\n\u003cp\u003eInteresting.  Maybe try changing back to 4 and see if it suppresses\u003cbr\\/\u003e\\nthe bug?  Might give us \u003cspan class=\\\"error\\\"\u003e&#91;desperately needed&#93;\u003c\\/span\u003e more data to cling to\u003cbr\\/\u003e\\nhere!  On the 1.4.3 -&gt; 1.9.1 change, some of the cases above were even\u003cbr\\/\u003e\\npre-1.4.x (though they could have been from yet another root cause or\u003cbr\\/\u003e\\nmaybe filesystem) so it\'s hard to draw hard conclusions on this\u003cbr\\/\u003e\\nfront.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463243_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463243_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 11:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T11:18:16+0000\'\u003e09\\/Jan\\/07 11:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Jed, thanks for testing the fix! \\n\\n &gt; Alas, this doesn\'t appear to be the problem. We are still getting \\n&gt; it, but we do at least have a little more info. We added the doc and \\n&gt; lastDoc to the IllegalArgEx and we are getting very strange numbers: \\n&gt; \\n&gt; java.lang.IllegalStateException: docs out of order (-1764 &lt; 0) \\n&gt; ... \\n&gt; \\n&gt; where doc = -1764 and lastDoc is zero \\n\\n OK, so we\'ve definitely got something else at play here (bummer!). That \\n(negative doc number) is very strange.  I will keep looking a this.  I \\nwill prepare a patch on 1.9.1 that adds some more instrumentation so \\nwe can get more details when you hit this ... \\n\\n &gt; We do only use the deleteDocuments(Term) method, so we are not sure \\n&gt; whether this will truly fix our problem, but we note that that \\n&gt; method calls deleteDocument(int) based on the TermDocs returned for \\n&gt; the Term - and maybe they can be incorrect??? \\n\\n Right, but I had thought the docNum\'s coming in from this path would \\nbe correct.  It sounds like we have another issue at play here that \\ncan somehow get even these doc numbers messed up. \\n\\n &gt; Out of interest, apart from changing from 1.4.3 to 1.9.1, in the \\n&gt; JIRA 3.7 release we changed our default merge factor to 4 from \\n&gt; 10. We hadn\'t seen this problem before, and suddenly we have had a \\n&gt; reasonable number of occurrences. \\n\\n Interesting.  Maybe try changing back to 4 and see if it suppresses \\nthe bug?  Might give us  &#91;desperately needed&#93;  more data to cling to \\nhere!  On the 1.4.3 -&gt; 1.9.1 change, some of the cases above were even \\npre-1.4.x (though they could have been from yet another root cause or \\nmaybe filesystem) so it\'s hard to draw hard conclusions on this \\nfront. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463247\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463247&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463247\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463247_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463247_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 11:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T11:32:04+0000\'\u003e09\\/Jan\\/07 11:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eDoron,\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; (1) the sequence of ops brought by Jason is wrong:\u003cbr\\/\u003e\\n&gt;   ...\u003cbr\\/\u003e\\n&gt;\u003cbr\\/\u003e\\n&gt; Problem here is that the docIDs found in (b) may be altered in step\u003cbr\\/\u003e\\n&gt; (d) and so step (f) would delete the wrong docs. In particular, it\u003cbr\\/\u003e\\n&gt; might attempt to delete ids that are out of the range. This might\u003cbr\\/\u003e\\n&gt; expose exactly the BitVector problem, and would explain the whole\u003cbr\\/\u003e\\n&gt; thing, but I too cannot see how it explains the delete-by-term case.\u003c\\/p\u003e\\n\\n\u003cp\u003eRight, the case I fixed only happens when the Lucene\u003cbr\\/\u003e\\ndeleteDocument(int docNum) is \u003cspan class=\\\"error\\\"\u003e&#91;slightly&#93;\u003c\\/span\u003e mis-used.  Ie if you are\u003cbr\\/\u003e\\n\\\"playing by the rules\\\" you would never have hit this bug.  And this\u003cbr\\/\u003e\\nparticular use case is indeed incorrect: doc numbers are only valid to\u003cbr\\/\u003e\\nthe one reader that you got them from.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I think however that the test Mike added does not expose the docs\u003cbr\\/\u003e\\n&gt; out of order bug - I tried this test without the fix and it only\u003cbr\\/\u003e\\n&gt; fail on the \\\"gotException assert\\\" - if you comment this assert the\u003cbr\\/\u003e\\n&gt; test pass.\u003c\\/p\u003e\\n\\n\u003cp\u003eHuh, I see my test case (in IndexReader) indeed hitting the original\u003cbr\\/\u003e\\n\\\"docs out of order\\\" exception.  If I take the current trunk and\u003cbr\\/\u003e\\ncomment out the (one line) bounds check in BitVector.set and run that\u003cbr\\/\u003e\\ntest, it hits the \\\"docs out of order\\\" exception.\u003c\\/p\u003e\\n\\n\u003cp\u003eAre you sure you updated the change (to tighten the check to a &lt;= from\u003cbr\\/\u003e\\na &lt;) to index\\/SegmentMerger.java?  Because, I did indeed find that the\u003cbr\\/\u003e\\ntest failed to fail when I first wrote it (but should have).  So in\u003cbr\\/\u003e\\ndigging why it didn\'t fail as expected, I found that the check for\u003cbr\\/\u003e\\n\\\"docs out of order\\\" missed the boundary case of the same doc number\u003cbr\\/\u003e\\ntwice in a row.  Once I fixed that, the test failed as expected.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; (3) maxDoc() computation in SegmentReader is based (on some paths)\u003cbr\\/\u003e\\n&gt; in RandomAccessFile.length(). IIRC I saw cases (in previous project)\u003cbr\\/\u003e\\n&gt; where File.length() or RAF.length() (not sure which of the two) did\u003cbr\\/\u003e\\n&gt; not always reflect real length, if the system was very busy IO wise,\u003cbr\\/\u003e\\n&gt; unless FD.sync() was called (with performance hit).\u003c\\/p\u003e\\n\\n\u003cp\u003eYes I saw this too.  From the follow-on discussion it sounds like we\u003cbr\\/\u003e\\nhaven\'t found a specific known JVM bug here.  Still, it does make me\u003cbr\\/\u003e\\nnervous that we rely on file length to derive maxDoc.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn general I think we should rely on as little as possible from the\u003cbr\\/\u003e\\nfile system (there are so many cross platform issues\\/differences) and\u003cbr\\/\u003e\\ninstead explicitly store things like maxDoc into the index.  I will\u003cbr\\/\u003e\\nopen a separate Jira issue to track this.  Also I will record this\u003cbr\\/\u003e\\npath in the instrumentation patch for 1.9.1 just to see if we are\u003cbr\\/\u003e\\nactually hitting something here (I think unlikely but possible).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463247_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463247_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 11:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T11:32:04+0000\'\u003e09\\/Jan\\/07 11:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Doron, \\n\\n &gt; (1) the sequence of ops brought by Jason is wrong: \\n&gt;   ... \\n&gt; \\n&gt; Problem here is that the docIDs found in (b) may be altered in step \\n&gt; (d) and so step (f) would delete the wrong docs. In particular, it \\n&gt; might attempt to delete ids that are out of the range. This might \\n&gt; expose exactly the BitVector problem, and would explain the whole \\n&gt; thing, but I too cannot see how it explains the delete-by-term case. \\n\\n Right, the case I fixed only happens when the Lucene \\ndeleteDocument(int docNum) is  &#91;slightly&#93;  mis-used.  Ie if you are \\n\\\"playing by the rules\\\" you would never have hit this bug.  And this \\nparticular use case is indeed incorrect: doc numbers are only valid to \\nthe one reader that you got them from. \\n\\n &gt; I think however that the test Mike added does not expose the docs \\n&gt; out of order bug - I tried this test without the fix and it only \\n&gt; fail on the \\\"gotException assert\\\" - if you comment this assert the \\n&gt; test pass. \\n\\n Huh, I see my test case (in IndexReader) indeed hitting the original \\n\\\"docs out of order\\\" exception.  If I take the current trunk and \\ncomment out the (one line) bounds check in BitVector.set and run that \\ntest, it hits the \\\"docs out of order\\\" exception. \\n\\n Are you sure you updated the change (to tighten the check to a &lt;= from \\na &lt;) to index\\/SegmentMerger.java?  Because, I did indeed find that the \\ntest failed to fail when I first wrote it (but should have).  So in \\ndigging why it didn\'t fail as expected, I found that the check for \\n\\\"docs out of order\\\" missed the boundary case of the same doc number \\ntwice in a row.  Once I fixed that, the test failed as expected. \\n\\n &gt; (3) maxDoc() computation in SegmentReader is based (on some paths) \\n&gt; in RandomAccessFile.length(). IIRC I saw cases (in previous project) \\n&gt; where File.length() or RAF.length() (not sure which of the two) did \\n&gt; not always reflect real length, if the system was very busy IO wise, \\n&gt; unless FD.sync() was called (with performance hit). \\n\\n Yes I saw this too.  From the follow-on discussion it sounds like we \\nhaven\'t found a specific known JVM bug here.  Still, it does make me \\nnervous that we rely on file length to derive maxDoc. \\n\\n In general I think we should rely on as little as possible from the \\nfile system (there are so many cross platform issues\\/differences) and \\ninstead explicitly store things like maxDoc into the index.  I will \\nopen a separate Jira issue to track this.  Also I will record this \\npath in the instrumentation patch for 1.9.1 just to see if we are \\nactually hitting something here (I think unlikely but possible).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463249\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463249&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463249\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463249_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463249_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 11:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T11:40:58+0000\'\u003e09\\/Jan\\/07 11:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I created \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-767\\\" title=\\\"maxDoc should be explicitly stored in the index, not derived from file length\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-767\\\"\u003e\u003cdel\u003eLUCENE-767\u003c\\/del\u003e\u003c\\/a\u003e for the \\\"maxDoc should be explicitly stored in the index\\\" issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463249_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463249_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 11:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T11:40:58+0000\'\u003e09\\/Jan\\/07 11:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I created   LUCENE-767   for the \\\"maxDoc should be explicitly stored in the index\\\" issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463294\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463294&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463294\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463294_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463294_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T14:50:21+0000\'\u003e09\\/Jan\\/07 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eJed, one question: when you tested the fix, you fully rebuilt your\u003cbr\\/\u003e\\nindex from scratch, right?  Just want to verify that.  You have to\u003cbr\\/\u003e\\nre-index because once the index is corrupted it will eventually hit\u003cbr\\/\u003e\\nthe \\\"docs out of order\\\" exception even if you fix the original cause.\u003c\\/p\u003e\\n\\n\u003cp\u003eOK I\'ve prepared a patch off 1.9.1 (just attached it).  The patch\u003cbr\\/\u003e\\npasses all unit tests on 1.9.1.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt has the changes I committed to the trunk yesterday, plus\u003cbr\\/\u003e\\ninstrumentation (messages printed to a PrintStream) to catch places\u003cbr\\/\u003e\\nwhere doc numbers are not correct.\u003c\\/p\u003e\\n\\n\u003cp\u003eAll messages I added print to a newly added infoStream static member\u003cbr\\/\u003e\\nof SegmentMerger.  You can do SegmentMerger.setInfoStream(...) to\u003cbr\\/\u003e\\nchange it (it defaults to System.err).\u003c\\/p\u003e\\n\\n\u003cp\u003eJed if you could get the error to re-occur with this patch and then\u003cbr\\/\u003e\\npost the resulting messages, that would be great.  Hopefully it gives\u003cbr\\/\u003e\\nus enough information to find the source here or at least to have\u003cbr\\/\u003e\\nanother iteration with yet more instrumentation.  Thanks!\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463294_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463294_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jan\\/07 14:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-09T14:50:21+0000\'\u003e09\\/Jan\\/07 14:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Jed, one question: when you tested the fix, you fully rebuilt your \\nindex from scratch, right?  Just want to verify that.  You have to \\nre-index because once the index is corrupted it will eventually hit \\nthe \\\"docs out of order\\\" exception even if you fix the original cause. \\n\\n OK I\'ve prepared a patch off 1.9.1 (just attached it).  The patch \\npasses all unit tests on 1.9.1. \\n\\n It has the changes I committed to the trunk yesterday, plus \\ninstrumentation (messages printed to a PrintStream) to catch places \\nwhere doc numbers are not correct. \\n\\n All messages I added print to a newly added infoStream static member \\nof SegmentMerger.  You can do SegmentMerger.setInfoStream(...) to \\nchange it (it defaults to System.err). \\n\\n Jed if you could get the error to re-occur with this patch and then \\npost the resulting messages, that would be great.  Hopefully it gives \\nus enough information to find the source here or at least to have \\nanother iteration with yet more instrumentation.  Thanks! \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463440\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463440&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463440\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463440_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463440_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 00:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T00:57:48+0000\'\u003e10\\/Jan\\/07 00:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Michael,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the patch, applied and recreated. Attached is the log.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo be explicit, we are recreating the index via the IndexWriter ctor with the create flag set and then completely rebuilding the index. We are not completely deleting the entire directory. There ARE old index files (_\u003cb\u003e.cfs &amp; _\u003c\\/b\u003e.del) in the directory with updated timestamps that are months old. If I completely recreate the directory the problem does go away. This is a fairly trivial \\\"fix\\\", but we are still investigating as we want to know if this is indeed the problem, how we have come to make it prevalent, and what the root cause is.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for all the help everyone.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463440_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463440_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 00:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T00:57:48+0000\'\u003e10\\/Jan\\/07 00:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Michael, \\n\\n Thanks for the patch, applied and recreated. Attached is the log. \\n\\n To be explicit, we are recreating the index via the IndexWriter ctor with the create flag set and then completely rebuilding the index. We are not completely deleting the entire directory. There ARE old index files (_ .cfs &amp; _ .del) in the directory with updated timestamps that are months old. If I completely recreate the directory the problem does go away. This is a fairly trivial \\\"fix\\\", but we are still investigating as we want to know if this is indeed the problem, how we have come to make it prevalent, and what the root cause is. \\n\\n Thanks for all the help everyone.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463470\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463470&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463470\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463470_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463470_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 06:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T06:07:58+0000\'\u003e10\\/Jan\\/07 06:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBTW. We have looked at all the open files referenced by the VM when the indexing errors occur, and there does not seem to be any reference to the old index segment files, so I am not sure how those files are influencing this problem.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463470_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463470_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 06:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T06:07:58+0000\'\u003e10\\/Jan\\/07 06:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    BTW. We have looked at all the open files referenced by the VM when the indexing errors occur, and there does not seem to be any reference to the old index segment files, so I am not sure how those files are influencing this problem.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463483\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463483&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463483\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12463483_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463483_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 07:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T07:36:28+0000\'\u003e10\\/Jan\\/07 07:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJed, is it possible that when re-creating the index, while IndexWriter is constructed with create=true, FSDirectory is opened with create=false?\u003cbr\\/\u003e\\nI suspect so, because otherwise, old  .del files would have been deleted. \u003cbr\\/\u003e\\nIf indeed so, newly created segments, which have same names as segments in previous (bad) runs, when opened, would read the (bad) old .del file. \u003cbr\\/\u003e\\nThis would possibly expose the bug fixed by Michael. \u003cbr\\/\u003e\\nI may be over speculating here, but if this is the case, it can also explain why changing the merge factor from 4 to 10 exposed the problem. \u003c\\/p\u003e\\n\\n\u003cp\u003eIn fact, let me speculate even further - if indeed when creating the index from scratch, the FSDirectory is (mistakenly) opened with create=false, as long as you always repeated the same sequencing of adding and deleting docs, you were likely to almost not suffer from this mistake, because segments created with same names as (old) .del files simply see docs as deleted before the docs are actually deleted by the program. The search behaves wrongly, not finding these docs before they are actually deleted, but no exception is thrown when adding docs. However once the merge factor was changed from 4 to 10, the matching between old .del files and new segments (with same names) was broken, and the out-of-order exception appeared. \u003c\\/p\u003e\\n\\n\u003cp\u003e...and if this is not the case, we would need to look for something else...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"doronc\\\" id=\\\"commentauthor_12463483_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=doronc\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"doronc\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Doron Cohen\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463483_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 07:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T07:36:28+0000\'\u003e10\\/Jan\\/07 07:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Jed, is it possible that when re-creating the index, while IndexWriter is constructed with create=true, FSDirectory is opened with create=false? \\nI suspect so, because otherwise, old  .del files would have been deleted.  \\nIf indeed so, newly created segments, which have same names as segments in previous (bad) runs, when opened, would read the (bad) old .del file.  \\nThis would possibly expose the bug fixed by Michael.  \\nI may be over speculating here, but if this is the case, it can also explain why changing the merge factor from 4 to 10 exposed the problem.  \\n\\n In fact, let me speculate even further - if indeed when creating the index from scratch, the FSDirectory is (mistakenly) opened with create=false, as long as you always repeated the same sequencing of adding and deleting docs, you were likely to almost not suffer from this mistake, because segments created with same names as (old) .del files simply see docs as deleted before the docs are actually deleted by the program. The search behaves wrongly, not finding these docs before they are actually deleted, but no exception is thrown when adding docs. However once the merge factor was changed from 4 to 10, the matching between old .del files and new segments (with same names) was broken, and the out-of-order exception appeared.  \\n\\n ...and if this is not the case, we would need to look for something else...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463524\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463524&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463524\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463524_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463524_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 10:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T10:48:05+0000\'\u003e10\\/Jan\\/07 10:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK from that indexing-failure.log (thanks Jed!) I can see that indeed\u003cbr\\/\u003e\\nthere are segments whose maxDoc() is much smaller than\u003cbr\\/\u003e\\ndeleteDocs.count().  This then leads to negative doc numbers on\u003cbr\\/\u003e\\nmerging these segments.\u003c\\/p\u003e\\n\\n\u003cp\u003eJed when you say \\\"there are old files (_\u003cb\u003e.cfs &amp; _\u003c\\/b\u003e.del) in this\u003cbr\\/\u003e\\ndirectory with updated timestamps that are months old\\\" what do you\u003cbr\\/\u003e\\nmean by \\\"with updated timestamps\\\"?  Which timestamp is months old and\u003cbr\\/\u003e\\nwhich one is updated?\u003c\\/p\u003e\\n\\n\u003cp\u003eOK, assuming Jed you are indeed sending \\\"create=false\\\" when creating\u003cbr\\/\u003e\\nthe Directory and then passing that directory to IndexWriter with\u003cbr\\/\u003e\\ncreate=true, I think we now have this case fully explained (thanks\u003cbr\\/\u003e\\nDoron): your old _*.del files are being incorrectly opened &amp; re-used\u003cbr\\/\u003e\\nby Lucene, when they should not be.\u003c\\/p\u003e\\n\\n\u003cp\u003eLucene (all released versions but not the trunk version, see below)\u003cbr\\/\u003e\\ndoes a simple fileExists(\\\"_XXX.del\\\") call to determine if a segment\u003cbr\\/\u003e\\nXXX has deletes.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut when that _XXX.del is a leftover from a previous index, it very\u003cbr\\/\u003e\\nlikely doesn\'t \\\"match\\\" the newly created _XXX segment.  (Especially if\u003cbr\\/\u003e\\nmerge factor has changed but also if order of operations has changed,\u003cbr\\/\u003e\\nwhich I would expect in this use case).\u003c\\/p\u003e\\n\\n\u003cp\u003eIf that file exists, Lucene assumes it\'s for this segment and so opens\u003cbr\\/\u003e\\nit and uses it.  If it happens that this _XXX.del file has more\u003cbr\\/\u003e\\ndocuments in it than the newly created _XXX.cfs segment, then negative\u003cbr\\/\u003e\\ndoc numbers will result (and then later cause the \\\"docs out of order\\\"\u003cbr\\/\u003e\\nexception).  If it happens that the _XXX.del file has fewer documents\u003cbr\\/\u003e\\nthan the newly created _XXX.cfs segment then you\'ll hit\u003cbr\\/\u003e\\nArrayIndexOutOfBounds exceptions in calls to isDeleted(...).  If they\u003cbr\\/\u003e\\nare exactly equal then you\'d randomly see some of your docs got\u003cbr\\/\u003e\\ndeleted.\u003c\\/p\u003e\\n\\n\u003cp\u003eNote that the trunk version of Lucene has already fixed this bug (as\u003cbr\\/\u003e\\npart of lockless commits):\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eWhether a segment has deletions or not is now explictly stored in\u003cbr\\/\u003e\\n    the segments file rather than relying on a \\\"fileExists(...)\\\" call.\u003cbr\\/\u003e\\n    So, if an old _XXX.del existed in the filesystem, the newly\u003cbr\\/\u003e\\n    created _XXX segment would not open it.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFurthermore, the trunk version of Lucene uses a new\u003cbr\\/\u003e\\n    IndexFileDelter class to remove any unreferenced index files.\u003cbr\\/\u003e\\n    This means it would have removed these old _\u003cb\u003e.cfs and _\u003c\\/b\u003e.del files\u003cbr\\/\u003e\\n    even in the case where a directory was created with \\\"create=false\\\"\u003cbr\\/\u003e\\n    and the IndexWriter was created with \\\"create=true\\\".\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eTo summarize:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThere was one case where if you gave slightly illegal doc numbers\u003cbr\\/\u003e\\n    (within 7 of the actual maxDoc) Lucene may silently accept the\u003cbr\\/\u003e\\n    call but would corrupt your index only to be seen later as an\u003cbr\\/\u003e\\n    \\\"docs out of order\\\" IllegalStateException when the segment is\u003cbr\\/\u003e\\n    merged.  This was just a missing boundary case check.  This case\u003cbr\\/\u003e\\n    is now fixed in the trunk (you get an\u003cbr\\/\u003e\\n    ArrayIndexOutOfBoundsException if doc number is too large).\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThere is also another case, that only happens if you have old\u003cbr\\/\u003e\\n    _*.del files leftover from a previous index while re-creating a\u003cbr\\/\u003e\\n    new index.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e    The workaround is simple here: always open the Directory with\u003cbr\\/\u003e\\n    create=true (or, remove the directory contents yourself before\u003cbr\\/\u003e\\n    hand).  (IndexWriter does this if you give it a String or File\u003cbr\\/\u003e\\n    with create=true).\u003c\\/p\u003e\\n\\n\u003cp\u003e    This is really a bug in Lucene, but given that it\'s already fixed\u003cbr\\/\u003e\\n    in the trunk, and the workaround is simple, I\'m inclined to not\u003cbr\\/\u003e\\n    fix it in prior releases and instead publicize the issue (I will\u003cbr\\/\u003e\\n    do so on java-user).\u003c\\/p\u003e\\n\\n\u003cp\u003e    But, I will commit two additional IllegalStateException checks to\u003cbr\\/\u003e\\n    the trunk when a segment is first initialized: 1) check that the\u003cbr\\/\u003e\\n    two different sources of \\\"maxDoc\\\" (fieldsReader.size() and\u003cbr\\/\u003e\\n    si.docCount) are the same, and 2) check that the number of pending\u003cbr\\/\u003e\\n    deletions does not exceed maxDoc().  When an index has\u003cbr\\/\u003e\\n    inconsistency I think the earlier it\'s detected the better.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463524_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463524_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 10:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T10:48:05+0000\'\u003e10\\/Jan\\/07 10:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK from that indexing-failure.log (thanks Jed!) I can see that indeed \\nthere are segments whose maxDoc() is much smaller than \\ndeleteDocs.count().  This then leads to negative doc numbers on \\nmerging these segments. \\n\\n Jed when you say \\\"there are old files (_ .cfs &amp; _ .del) in this \\ndirectory with updated timestamps that are months old\\\" what do you \\nmean by \\\"with updated timestamps\\\"?  Which timestamp is months old and \\nwhich one is updated? \\n\\n OK, assuming Jed you are indeed sending \\\"create=false\\\" when creating \\nthe Directory and then passing that directory to IndexWriter with \\ncreate=true, I think we now have this case fully explained (thanks \\nDoron): your old _*.del files are being incorrectly opened &amp; re-used \\nby Lucene, when they should not be. \\n\\n Lucene (all released versions but not the trunk version, see below) \\ndoes a simple fileExists(\\\"_XXX.del\\\") call to determine if a segment \\nXXX has deletes. \\n\\n But when that _XXX.del is a leftover from a previous index, it very \\nlikely doesn\'t \\\"match\\\" the newly created _XXX segment.  (Especially if \\nmerge factor has changed but also if order of operations has changed, \\nwhich I would expect in this use case). \\n\\n If that file exists, Lucene assumes it\'s for this segment and so opens \\nit and uses it.  If it happens that this _XXX.del file has more \\ndocuments in it than the newly created _XXX.cfs segment, then negative \\ndoc numbers will result (and then later cause the \\\"docs out of order\\\" \\nexception).  If it happens that the _XXX.del file has fewer documents \\nthan the newly created _XXX.cfs segment then you\'ll hit \\nArrayIndexOutOfBounds exceptions in calls to isDeleted(...).  If they \\nare exactly equal then you\'d randomly see some of your docs got \\ndeleted. \\n\\n Note that the trunk version of Lucene has already fixed this bug (as \\npart of lockless commits): \\n\\n \\n\\t Whether a segment has deletions or not is now explictly stored in \\n    the segments file rather than relying on a \\\"fileExists(...)\\\" call. \\n    So, if an old _XXX.del existed in the filesystem, the newly \\n    created _XXX segment would not open it. \\n \\n\\n\\n \\n\\t Furthermore, the trunk version of Lucene uses a new \\n    IndexFileDelter class to remove any unreferenced index files. \\n    This means it would have removed these old _ .cfs and _ .del files \\n    even in the case where a directory was created with \\\"create=false\\\" \\n    and the IndexWriter was created with \\\"create=true\\\". \\n \\n\\n\\n To summarize: \\n\\n \\n\\t There was one case where if you gave slightly illegal doc numbers \\n    (within 7 of the actual maxDoc) Lucene may silently accept the \\n    call but would corrupt your index only to be seen later as an \\n    \\\"docs out of order\\\" IllegalStateException when the segment is \\n    merged.  This was just a missing boundary case check.  This case \\n    is now fixed in the trunk (you get an \\n    ArrayIndexOutOfBoundsException if doc number is too large). \\n \\n\\n\\n \\n\\t There is also another case, that only happens if you have old \\n    _*.del files leftover from a previous index while re-creating a \\n    new index. \\n \\n\\n\\n     The workaround is simple here: always open the Directory with \\n    create=true (or, remove the directory contents yourself before \\n    hand).  (IndexWriter does this if you give it a String or File \\n    with create=true). \\n\\n     This is really a bug in Lucene, but given that it\'s already fixed \\n    in the trunk, and the workaround is simple, I\'m inclined to not \\n    fix it in prior releases and instead publicize the issue (I will \\n    do so on java-user). \\n\\n     But, I will commit two additional IllegalStateException checks to \\n    the trunk when a segment is first initialized: 1) check that the \\n    two different sources of \\\"maxDoc\\\" (fieldsReader.size() and \\n    si.docCount) are the same, and 2) check that the number of pending \\n    deletions does not exceed maxDoc().  When an index has \\n    inconsistency I think the earlier it\'s detected the better.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463674\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463674&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463674\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463674_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463674_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 19:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T19:18:57+0000\'\u003e10\\/Jan\\/07 19:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt; BTW. We have looked at all the open files referenced by the VM when\u003cbr\\/\u003e\\n&gt; the indexing errors occur, and there does not seem to be any reference\u003cbr\\/\u003e\\n&gt; to the old index segment files, so I am not sure how those files are\u003cbr\\/\u003e\\n&gt; influencing this problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eJed just to answer this question: the _XXX.del files are opened very\u003cbr\\/\u003e\\nbriefly because the contents of this file are loaded \\/ cached in\u003cbr\\/\u003e\\nmemory, and the the file handle is closed.  I don\'t think the _XXX.cfs\u003cbr\\/\u003e\\nfiles are affecting this issue (are not opened).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463674_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463674_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jan\\/07 19:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-10T19:18:57+0000\'\u003e10\\/Jan\\/07 19:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt; BTW. We have looked at all the open files referenced by the VM when \\n&gt; the indexing errors occur, and there does not seem to be any reference \\n&gt; to the old index segment files, so I am not sure how those files are \\n&gt; influencing this problem. \\n\\n Jed just to answer this question: the _XXX.del files are opened very \\nbriefly because the contents of this file are loaded \\/ cached in \\nmemory, and the the file handle is closed.  I don\'t think the _XXX.cfs \\nfiles are affecting this issue (are not opened).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463781\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463781&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463781\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463781_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463781_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 01:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T01:18:32+0000\'\u003e11\\/Jan\\/07 01:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMichael, Doron, you guys are legends!\u003c\\/p\u003e\\n\\n\u003cp\u003eIndeed the problem is using only the IndexWriter with create true to recreate the directory. Creating a new Directory with create true does fix the problem. The javadoc for this constructor is fairly explicit that it should recreate the index for you (no caveat), so I would consider that a bug, but - given that head fixes it - not one that requires any action.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks guys for the prompt attention, excellent and thorough analysis.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jedws\\\" id=\\\"commentauthor_12463781_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jedws\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jedws\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Jed Wesley-Smith\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463781_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 01:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T01:18:32+0000\'\u003e11\\/Jan\\/07 01:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Michael, Doron, you guys are legends! \\n\\n Indeed the problem is using only the IndexWriter with create true to recreate the directory. Creating a new Directory with create true does fix the problem. The javadoc for this constructor is fairly explicit that it should recreate the index for you (no caveat), so I would consider that a bug, but - given that head fixes it - not one that requires any action. \\n\\n Thanks guys for the prompt attention, excellent and thorough analysis.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463872\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463872&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463872\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463872_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463872_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 11:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T11:46:20+0000\'\u003e11\\/Jan\\/07 11:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePhew!  I\'m glad we finally got to the bottom of this one.\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you for your persistent and fast testing iterations, Jed; this\u003cbr\\/\u003e\\nissue has been open for far too long!\u003c\\/p\u003e\\n\\n\u003cp\u003eI will send a summary email to java-user and resolve this issue,\u003cbr\\/\u003e\\nfinally.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463872_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463872_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 11:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T11:46:20+0000\'\u003e11\\/Jan\\/07 11:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Phew!  I\'m glad we finally got to the bottom of this one. \\n\\n Thank you for your persistent and fast testing iterations, Jed; this \\nissue has been open for far too long! \\n\\n I will send a summary email to java-user and resolve this issue, \\nfinally.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463875\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463875&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463875\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463875_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463875_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 12:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T12:09:01+0000\'\u003e11\\/Jan\\/07 12:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eActually, this reminds me that, as of lockless commits, there is one\u003cbr\\/\u003e\\nimportant tradeoff on which \\\"create=true\\\" to use (the case on windows\u003cbr\\/\u003e\\nwhere you want to re-create the index but readers are currently using\u003cbr\\/\u003e\\nit).  I will call out this difference in the javadocs.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlthough, why do we even have a \\\"create\\\" parameter in the directory?\u003cbr\\/\u003e\\nI think it\'s confusing (and dangerous, pre-trunk, due to this issue)\u003cbr\\/\u003e\\nto have two ways of doing the same thing?\u003c\\/p\u003e\\n\\n\u003cp\u003eLogically, I don\'t think a Directory should take the responsibility of\u003cbr\\/\u003e\\ndeleting old files (including old lock files).  It should be a clean\u003cbr\\/\u003e\\ninterface for doing so, but I think the IndexWriter alone should be\u003cbr\\/\u003e\\nthe class that deletes files from the directory.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith lockless commits this has become an important difference, ie, the\u003cbr\\/\u003e\\nnew IndexFileDeleter class (used by IndexWriter) handles re-trying\u003cbr\\/\u003e\\nfiles that are in-use (on Windows) whereas FSDirectory will throw an\u003cbr\\/\u003e\\nexception if create=true and there are index files are in use.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think we should deprecate the \\\"create\\\" argument to\u003cbr\\/\u003e\\nFSDirectory.getDirectory\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/star_yellow.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e and leave only the create argument in\u003cbr\\/\u003e\\nIndexWriter\'s constructors.  Am I missing something?  Is there are a\u003cbr\\/\u003e\\nreason not to do this?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463875_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463875_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 12:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T12:09:01+0000\'\u003e11\\/Jan\\/07 12:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n Actually, this reminds me that, as of lockless commits, there is one \\nimportant tradeoff on which \\\"create=true\\\" to use (the case on windows \\nwhere you want to re-create the index but readers are currently using \\nit).  I will call out this difference in the javadocs. \\n\\n Although, why do we even have a \\\"create\\\" parameter in the directory? \\nI think it\'s confusing (and dangerous, pre-trunk, due to this issue) \\nto have two ways of doing the same thing? \\n\\n Logically, I don\'t think a Directory should take the responsibility of \\ndeleting old files (including old lock files).  It should be a clean \\ninterface for doing so, but I think the IndexWriter alone should be \\nthe class that deletes files from the directory. \\n\\n With lockless commits this has become an important difference, ie, the \\nnew IndexFileDeleter class (used by IndexWriter) handles re-trying \\nfiles that are in-use (on Windows) whereas FSDirectory will throw an \\nexception if create=true and there are index files are in use. \\n\\n I think we should deprecate the \\\"create\\\" argument to \\nFSDirectory.getDirectory  and leave only the create argument in \\nIndexWriter\'s constructors.  Am I missing something?  Is there are a \\nreason not to do this?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12463877\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12463877&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12463877\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463877_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463877_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 12:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T12:14:18+0000\'\u003e11\\/Jan\\/07 12:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eResolving this now, finally (I\'ll move the two \\\"create\\\" arguments\u003cbr\\/\u003e\\ndiscussion to a separate issue if we decide to go forward with that):\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFixed (in the trunk) to catch boundary cases of incorrect docNum\'s\u003cbr\\/\u003e\\n    to deleteDocuments.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eFixed (in the trunk) to do earlier \\\"IllegalState\\\" checks to catch\u003cbr\\/\u003e\\n    index corruption sooner.  Also fixed the existing IllegalState\u003cbr\\/\u003e\\n    check to catch missing boundary cases.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eThe re-using of old _XXX.del files is already fixed with lockless\u003cbr\\/\u003e\\n    commits (in trunk).  This remains open for past releases, but the\u003cbr\\/\u003e\\n    workaround is simple and I\'ve now publicized this on java-user.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12463877_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12463877_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jan\\/07 12:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-01-11T12:14:18+0000\'\u003e11\\/Jan\\/07 12:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Resolving this now, finally (I\'ll move the two \\\"create\\\" arguments \\ndiscussion to a separate issue if we decide to go forward with that): \\n\\n \\n\\t Fixed (in the trunk) to catch boundary cases of incorrect docNum\'s \\n    to deleteDocuments. \\n \\n\\n\\n \\n\\t Fixed (in the trunk) to do earlier \\\"IllegalState\\\" checks to catch \\n    index corruption sooner.  Also fixed the existing IllegalState \\n    check to catch missing boundary cases. \\n \\n\\n\\n \\n\\t The re-using of old _XXX.del files is already fixed with lockless \\n    commits (in trunk).  This remains open for past releases, but the \\n    workaround is simple and I\'ve now publicized this on java-user. \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-12476252\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-140?focusedCommentId=12476252&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-12476252\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476252_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476252_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T18:10:32+0000\'\u003e27\\/Feb\\/07 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eClosing all issues that were resolved for 2.1.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_12476252_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_12476252_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Feb\\/07 18:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2007-02-27T18:10:32+0000\'\u003e27\\/Feb\\/07 18:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Closing all issues that were resolved for 2.1.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520241738556"> 
    <input type="hidden" title="jira.request.server.time" value="241"> 
    <input type="hidden" title="jira.request.id" value="562x94475748x6"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="4"> 
    <input type="hidden" title="db.reads.time.in.ms" value="33"> 
    <input type="hidden" title="db.conns.time.in.ms" value="40"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 562x94475748x6
	          REQUEST TIMESTAMP : [05/Mar/2018:09:22:18 +0000]
	               REQUEST TIME : 0.2410
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 4

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=20, elapsedTotal=33861523, elapsedMin=634004, elapsedMax=13982542, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=24, elapsedTotal=40139299, elapsedMin=664431, elapsedMax=14012562, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>