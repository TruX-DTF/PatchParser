<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|6263933689a54fbda4205c2044e60e9fc782a2da|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"b149432243fc5d\"";
WRM._unparsedData["project-id"]="12310110";
WRM._unparsedData["project-key"]="\"LUCENE\"";
WRM._unparsedData["project-name"]="\"Lucene - Core\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310110";
WRM._unparsedData["projectKey"]="\"LUCENE\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="LUCENE-4069"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[LUCENE-4069] Segment-level Bloom filters - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[LUCENE-4069] Segment-level Bloom filters - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/LUCENE" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4069">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310110" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Lucene - Core'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310110&amp;avatarId=10061"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/LUCENE">Lucene - Core</a></li>
                 <li><a class="issue-link" data-issue-key="LUCENE-4069" href="/jira/browse/LUCENE-4069" id="key-val" rel="12556412">LUCENE-4069</a></li>
                </ol>
                <h1 id="summary-val">Segment-level Bloom filters</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FLUCENE-4069"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/LUCENE-4069/LUCENE-4069.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/LUCENE-4069/LUCENE-4069.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/LUCENE-4069/LUCENE-4069.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/LUCENE-4069/LUCENE-4069.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/minor.svg" title="Minor - Minor loss of function, or other problem where easy workaround is present." width="16"> Minor </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> <span class="shorten" id="versions-field"> <span title="3.6 Major release after 3.5">3.6</span>, <span title="4.0-ALPHA Alpha release of the 4.x series">4.0-ALPHA</span> </span> </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+4.0-BETA" title="4.0-BETA Beta release after 4.0-ALPHA">4.0-BETA</a>, <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+fixVersion+%3D+6.0" title="6.0 Major release after 5.5">6.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> <span class="shorten" id="components-field"> <a href="/jira/issues/?jql=project+%3D+LUCENE+AND+component+%3D+%22core%2Findex%22" title="core/index issues with indexing code">core/index</a> </span> </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12556412-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
                <div id="customfieldmodule"> 
                 <div class="aui-tabs horizontal-tabs" id="customfield-tabs"> 
                  <div id="customfield-panel-1" class="tabs-pane active-pane"> 
                   <ul class="property-list"> 
                    <li id="rowForcustomfield_12310120" class="item"> 
                     <div class="wrap"> 
                      <strong title="Lucene Fields" class="name">Lucene Fields:</strong> 
                      <div id="customfield_12310120-val" class="value type-multicheckboxes" data-fieldtype="multicheckboxes" data-fieldtypecompletekey="com.atlassian.jira.plugin.system.customfieldtypes:multicheckboxes"> 
                       <div class="shorten" id="customfield_12310120-field"> 
                        <span>New</span>, 
                        <span>Patch Available</span> 
                       </div> 
                      </div> 
                     </div> </li> 
                   </ul> 
                  </div> 
                 </div>
                </div> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>An addition to each segment which stores a Bloom filter for selected fields in order to give fast-fail to term searches, helping avoid wasted disk access.</p> 
                  <p>Best suited for low-frequency fields e.g. primary keys on big indexes with many segments but also speeds up general searching in my tests.</p> 
                  <p>Overview slideshow here: <a href="http://www.slideshare.net/MarkHarwood/lucene-bloomfilteredsegments" class="external-link" rel="nofollow">http://www.slideshare.net/MarkHarwood/lucene-bloomfilteredsegments</a></p> 
                  <p>Benchmarks based on Wikipedia content here: <a href="http://goo.gl/X7QqU" class="external-link" rel="nofollow">http://goo.gl/X7QqU</a></p> 
                  <p>Patch based on 3.6 codebase attached.<br> There are no 3.6 API changes currently - to play just add a field with "_blm" on the end of the name to invoke special indexing/querying capability. Clearly a new Field or schema declaration<img class="emoticon" src="/jira/images/icons/emoticons/warning.png" height="16" width="16" align="absmiddle" alt="" border="0"> would need adding to APIs to configure the service properly.</p> 
                  <p>Also, a patch for Lucene4.0 codebase introducing a new PostingsFormat</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/LUCENE-4069?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/LUCENE-4069?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/LUCENE-4069?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/LUCENE-4069?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12537358" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12537358/4069Failure.zip" draggable="true" data-downloadurl="application/zip:4069Failure.zip:https://issues.apache.org/jira/secure/attachment/12537358/4069Failure.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12537358/4069Failure.zip" title="Latest  20/Jul/12 15:08 - Mark Harwood" draggable="true" data-downloadurl="application/zip:4069Failure.zip:https://issues.apache.org/jira/secure/attachment/12537358/4069Failure.zip">4069Failure.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-07-20T15:08:22.328Z">20/Jul/12 15:08</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Harwood
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12538794" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12538794/BloomFilterPostingsBranch4x.patch" draggable="true" data-downloadurl="text/plain:BloomFilterPostingsBranch4x.patch:https://issues.apache.org/jira/secure/attachment/12538794/BloomFilterPostingsBranch4x.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12538794/BloomFilterPostingsBranch4x.patch" title="Latest  01/Aug/12 15:32 - Mark Harwood" draggable="true" data-downloadurl="text/plain:BloomFilterPostingsBranch4x.patch:https://issues.apache.org/jira/secure/attachment/12538794/BloomFilterPostingsBranch4x.patch">BloomFilterPostingsBranch4x.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-08-01T15:32:30.201Z">01/Aug/12 15:32</time>
                   </dd>
                   <dd class="attachment-size">
                    54 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Harwood
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12533877" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12533877/LUCENE-4069-tryDeleteDocument.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4069-tryDeleteDocument.patch:https://issues.apache.org/jira/secure/attachment/12533877/LUCENE-4069-tryDeleteDocument.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12533877/LUCENE-4069-tryDeleteDocument.patch" title="Latest  28/Jun/12 19:31 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-4069-tryDeleteDocument.patch:https://issues.apache.org/jira/secure/attachment/12533877/LUCENE-4069-tryDeleteDocument.patch">LUCENE-4069-tryDeleteDocument.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-28T19:31:12.780Z">28/Jun/12 19:31</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12535724" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12535724/LUCENE-4203.patch" draggable="true" data-downloadurl="text/plain:LUCENE-4203.patch:https://issues.apache.org/jira/secure/attachment/12535724/LUCENE-4203.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12535724/LUCENE-4203.patch" title="Latest  09/Jul/12 19:22 - Michael McCandless" draggable="true" data-downloadurl="text/plain:LUCENE-4203.patch:https://issues.apache.org/jira/secure/attachment/12535724/LUCENE-4203.patch">LUCENE-4203.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-07-09T19:22:21.797Z">09/Jul/12 19:22</time>
                   </dd>
                   <dd class="attachment-size">
                    3 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12528086" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12528086/MHBloomFilterOn3.6Branch.patch" draggable="true" data-downloadurl="text/plain:MHBloomFilterOn3.6Branch.patch:https://issues.apache.org/jira/secure/attachment/12528086/MHBloomFilterOn3.6Branch.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12528086/MHBloomFilterOn3.6Branch.patch" title="Latest  18/May/12 15:45 - Mark Harwood" draggable="true" data-downloadurl="text/plain:MHBloomFilterOn3.6Branch.patch:https://issues.apache.org/jira/secure/attachment/12528086/MHBloomFilterOn3.6Branch.patch">MHBloomFilterOn3.6Branch.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-05-18T15:45:42.987Z">18/May/12 15:45</time>
                   </dd>
                   <dd class="attachment-size">
                    17 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Harwood
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12535721" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12535721/PKLookupUpdatePerfTest.java" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12535721/PKLookupUpdatePerfTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12535721/PKLookupUpdatePerfTest.java" title="Latest  09/Jul/12 19:15 - Michael McCandless" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12535721/PKLookupUpdatePerfTest.java">PKLookupUpdatePerfTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-07-09T19:15:37.228Z">09/Jul/12 19:15</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12535378" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12535378/PKLookupUpdatePerfTest.java" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12535378/PKLookupUpdatePerfTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12535378/PKLookupUpdatePerfTest.java" title=" 06/Jul/12 15:46 - Mark Harwood" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12535378/PKLookupUpdatePerfTest.java">PKLookupUpdatePerfTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-07-06T15:46:47.679Z">06/Jul/12 15:46</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Harwood
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12533876" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12533876/PKLookupUpdatePerfTest.java" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12533876/PKLookupUpdatePerfTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12533876/PKLookupUpdatePerfTest.java" title=" 28/Jun/12 19:31 - Michael McCandless" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12533876/PKLookupUpdatePerfTest.java">PKLookupUpdatePerfTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-28T19:31:12.741Z">28/Jun/12 19:31</time>
                   </dd>
                   <dd class="attachment-size">
                    19 kB
                   </dd>
                   <dd class="attachment-author">
                    Michael McCandless
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12533069" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12533069/PKLookupUpdatePerfTest.java" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12533069/PKLookupUpdatePerfTest.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12533069/PKLookupUpdatePerfTest.java" title=" 22/Jun/12 16:44 - Mark Harwood" draggable="true" data-downloadurl="text/plain:PKLookupUpdatePerfTest.java:https://issues.apache.org/jira/secure/attachment/12533069/PKLookupUpdatePerfTest.java">PKLookupUpdatePerfTest.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-22T16:44:45.788Z">22/Jun/12 16:44</time>
                   </dd>
                   <dd class="attachment-size">
                    9 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Harwood
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12532704" data-issue-id="12556412" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12532704/PrimaryKeyPerfTest40.java" draggable="true" data-downloadurl="text/plain:PrimaryKeyPerfTest40.java:https://issues.apache.org/jira/secure/attachment/12532704/PrimaryKeyPerfTest40.java"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12532704/PrimaryKeyPerfTest40.java" title="Latest  20/Jun/12 15:09 - Mark Harwood" draggable="true" data-downloadurl="text/plain:PrimaryKeyPerfTest40.java:https://issues.apache.org/jira/secure/attachment/12532704/PrimaryKeyPerfTest40.java">PrimaryKeyPerfTest40.java</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-20T15:09:59.080Z">20/Jun/12 15:09</time>
                   </dd>
                   <dd class="attachment-size">
                    10 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Harwood
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12433627_10030"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype" width="16" height="16" title="New Feature - A new feature of the product, which has yet to be developed." alt="New Feature - A new feature of the product, which has yet to be developed."> <span title="SOLR-1375: BloomFilter on a field"> <a href="/jira/browse/SOLR-1375" data-issue-key="SOLR-1375" class="issue-link link-title">SOLR-1375</a> <span class="link-summary">BloomFilter on a field</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_markh" rel="markh" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Mark Harwood&quot;,&quot;emailAddress&quot;:&quot;markharw00d@yahoo.co.uk&quot;,&quot;username&quot;:&quot;markh&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="markh"></span></span> Mark Harwood </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_markh" rel="markh" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Mark Harwood&quot;,&quot;emailAddress&quot;:&quot;markharw00d@yahoo.co.uk&quot;,&quot;username&quot;:&quot;markh&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="markh"></span></span> Mark Harwood </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">4</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">8</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="18/May/12 15:44"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-05-18T15:44:29+0000">18/May/12 15:44</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/May/16 18:35"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-09T18:35:43+0000">09/May/16 18:35</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="02/Aug/12 13:25"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2012-08-02T13:25:33+0000">02/Aug/12 13:25</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4069?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/LUCENE-4069?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13278888\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13278888&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13278888\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13278888_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13278888_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/May\\/12 15:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-18T15:45:43+0000\'\u003e18\\/May\\/12 15:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eInitial patch\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13278888_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13278888_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/May\\/12 15:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-18T15:45:43+0000\'\u003e18\\/May\\/12 15:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Initial patch              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13283520\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13283520&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13283520\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13283520_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283520_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T15:12:02+0000\'\u003e25\\/May\\/12 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve ported this Bloom Filtering code to work as a 4.0 Codec now.\u003cbr\\/\u003e\\nI see a 35% improvement over standard Codecs on random lookups on a warmed index. \u003c\\/p\u003e\\n\\n\u003cp\u003eI also notice that the PulsingCodec is no longer faster than standard Codec - is this news to people as I thought it was supposed to be the way forward?\u003c\\/p\u003e\\n\\n\u003cp\u003eMy test rig (adapted from Mike\'s original primary key test rig here \u003ca href=\\\"http:\\/\\/blog.mikemccandless.com\\/2010\\/06\\/lucenes-pulsingcodec-on-primary-key.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/blog.mikemccandless.com\\/2010\\/06\\/lucenes-pulsingcodec-on-primary-key.html\u003c\\/a\u003e) is attached as a zip.\u003cbr\\/\u003e\\nThe new BloomFilteringCodec is also attached here as a patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eSearches against plain text fields also look to be faster (using AOL500k queries searching Wikipedia English) but obviously that particular test rig is harder to include as an attachment here.\u003c\\/p\u003e\\n\\n\u003cp\u003eI can open a seperate JIRA issue for this 4.0 version of the code if that makes more sense.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13283520_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283520_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 15:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T15:12:02+0000\'\u003e25\\/May\\/12 15:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve ported this Bloom Filtering code to work as a 4.0 Codec now. \\nI see a 35% improvement over standard Codecs on random lookups on a warmed index.  \\n\\n I also notice that the PulsingCodec is no longer faster than standard Codec - is this news to people as I thought it was supposed to be the way forward? \\n\\n My test rig (adapted from Mike\'s original primary key test rig here  http:\\/\\/blog.mikemccandless.com\\/2010\\/06\\/lucenes-pulsingcodec-on-primary-key.html ) is attached as a zip. \\nThe new BloomFilteringCodec is also attached here as a patch. \\n\\n Searches against plain text fields also look to be faster (using AOL500k queries searching Wikipedia English) but obviously that particular test rig is harder to include as an attachment here. \\n\\n I can open a seperate JIRA issue for this 4.0 version of the code if that makes more sense. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13283574\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13283574&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13283574\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13283574_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283574_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T16:20:31+0000\'\u003e25\\/May\\/12 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI see a 35% improvement over standard Codecs on random lookups on a warmed index.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eImpressive!  This is for primary key lookups?\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like the primary keys are GUID-like right?  (Ie randomly generated).  I wonder if they had some structure instead (eg \'%09d\' % (id++)) how the results would look...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI also notice that the PulsingCodec is no longer faster than standard Codec - is this news to people as I thought it was supposed to be the way forward?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s baffling to me: it should only save seeks vs Lucene40 codec, so on a cold index you should see substantial gains, and on a warm index I\'d still expect some gains.  Not sure what\'s up...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI can open a seperate JIRA issue for this 4.0 version of the code if that makes more sense.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think it\'s fine to do it here?  Really 3.6.x is only for bug fixes now ... so I think we should commit this to trunk.\u003c\\/p\u003e\\n\\n\u003cp\u003eI wonder if you can wrap any other PostingsFormat (ie instead of hard-coding to Lucene40PostingsFormat)?  This way users can wrap any PF they have w\\/ the bloom filter...\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you use FixedBitSet instead of OpenBitSet?  Or is there a reason to use OpenBitSet here...?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13283574_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283574_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 16:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T16:20:31+0000\'\u003e25\\/May\\/12 16:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I see a 35% improvement over standard Codecs on random lookups on a warmed index.  \\n\\n Impressive!  This is for primary key lookups? \\n\\n It looks like the primary keys are GUID-like right?  (Ie randomly generated).  I wonder if they had some structure instead (eg \'%09d\' % (id++)) how the results would look... \\n\\n  I also notice that the PulsingCodec is no longer faster than standard Codec - is this news to people as I thought it was supposed to be the way forward?  \\n\\n That\'s baffling to me: it should only save seeks vs Lucene40 codec, so on a cold index you should see substantial gains, and on a warm index I\'d still expect some gains.  Not sure what\'s up... \\n\\n  I can open a seperate JIRA issue for this 4.0 version of the code if that makes more sense.  \\n\\n I think it\'s fine to do it here?  Really 3.6.x is only for bug fixes now ... so I think we should commit this to trunk. \\n\\n I wonder if you can wrap any other PostingsFormat (ie instead of hard-coding to Lucene40PostingsFormat)?  This way users can wrap any PF they have w\\/ the bloom filter... \\n\\n Can you use FixedBitSet instead of OpenBitSet?  Or is there a reason to use OpenBitSet here...?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13283583\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13283583&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13283583\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13283583_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283583_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T16:34:04+0000\'\u003e25\\/May\\/12 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMy current focus is speeding up primary key lookups but this may have applications outside of that (Zipf tells us there is a lot of low frequency stuff in free text).\u003c\\/p\u003e\\n\\n\u003cp\u003eFollowing the principle of the best IO is no IO the Bloom Filter helps us quickly understand which segments to even bother looking in. That has to be a win overall.\u003c\\/p\u003e\\n\\n\u003cp\u003eI started trying to write this Codec as a wrapper for any other Codec (it simply listens to a stream of terms and stores a bitset of recorded hashes in a \\\".blm\\\" file). However that was trickier than I expected - I\'d need to encode a special entry in my blm files just to know the name of the delegated codec I needed to instantiate at read-time because Lucene\'s normal Codec-instantiation logic would be looking for \\\"BloomCodec\\\" and I\'d have to discover the delegate that was used to write all of the non-blm files.\u003c\\/p\u003e\\n\\n\u003cp\u003eNot looked at FixedBitSet but I imagine that could be used instead.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13283583_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283583_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T16:34:04+0000\'\u003e25\\/May\\/12 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    My current focus is speeding up primary key lookups but this may have applications outside of that (Zipf tells us there is a lot of low frequency stuff in free text). \\n\\n Following the principle of the best IO is no IO the Bloom Filter helps us quickly understand which segments to even bother looking in. That has to be a win overall. \\n\\n I started trying to write this Codec as a wrapper for any other Codec (it simply listens to a stream of terms and stores a bitset of recorded hashes in a \\\".blm\\\" file). However that was trickier than I expected - I\'d need to encode a special entry in my blm files just to know the name of the delegated codec I needed to instantiate at read-time because Lucene\'s normal Codec-instantiation logic would be looking for \\\"BloomCodec\\\" and I\'d have to discover the delegate that was used to write all of the non-blm files. \\n\\n Not looked at FixedBitSet but I imagine that could be used instead.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13283615\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13283615&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13283615\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13283615_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283615_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 17:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T17:31:39+0000\'\u003e25\\/May\\/12 17:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdate- I\'ve discovered this Bloom Filter Codec currently has a bug where it doesn\'t handle indexes with &gt;1 field.\u003cbr\\/\u003e\\nIt\'s probably all tangled up in the \\\"PerField...\\\" codec logic so I need to do some more digging.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13283615_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13283615_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/May\\/12 17:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-25T17:31:39+0000\'\u003e25\\/May\\/12 17:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Update- I\'ve discovered this Bloom Filter Codec currently has a bug where it doesn\'t handle indexes with &gt;1 field. \\nIt\'s probably all tangled up in the \\\"PerField...\\\" codec logic so I need to do some more digging.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13284475\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13284475&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13284475\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13284475_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284475_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T16:51:01+0000\'\u003e28\\/May\\/12 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFixed the issue with &gt;1 field in an index.\u003cbr\\/\u003e\\nTests on random lookups on Wikipedia titles (unique keys) now show a 3 x speed up for a Bloom-filtered index over standard 4.0 Codec for fully warmed indexes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13284475_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284475_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T16:51:01+0000\'\u003e28\\/May\\/12 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fixed the issue with &gt;1 field in an index. \\nTests on random lookups on Wikipedia titles (unique keys) now show a 3 x speed up for a Bloom-filtered index over standard 4.0 Codec for fully warmed indexes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13284520\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13284520&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13284520\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13284520_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284520_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 19:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T19:09:53+0000\'\u003e28\\/May\\/12 19:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehey mark, this looks very interesting. I wonder if that also helps indexing in terms of applying deletes. did you test that at all or is that something are looking into as well? For deletes this could be very handy since bloom filters should help a lot when a given key is likely to only in one segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegarding the code, I think BloomFilter should be like Pulsing and only be a PostingsFormat. You should make the BloomFilterPostingsFormat abstract and pass in the \\\"wrapped\\\" postings format and delegate independent of the field. PostingsFormat is per field and is resolved by the codec. An actual implementation should subclass the abstract BloomFilterPostingsFormat that way you have a fixed PostingsFormat per \\\"delegate\\\" and don\'t need to deal with \\\"which field got which delegate\\\" bla bla. \u003c\\/p\u003e\\n\\n\u003cp\u003eWe should not have a Bloomfilter codec but rather swap in the bloomfilter postings format in test via random codec. I also wonder if we can extract a \\\"bloomfilter\\\" class into utils that builds an BloomFilter this could be useful elsewhere. \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13284520_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284520_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 19:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T19:09:53+0000\'\u003e28\\/May\\/12 19:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    hey mark, this looks very interesting. I wonder if that also helps indexing in terms of applying deletes. did you test that at all or is that something are looking into as well? For deletes this could be very handy since bloom filters should help a lot when a given key is likely to only in one segment. \\n\\n Regarding the code, I think BloomFilter should be like Pulsing and only be a PostingsFormat. You should make the BloomFilterPostingsFormat abstract and pass in the \\\"wrapped\\\" postings format and delegate independent of the field. PostingsFormat is per field and is resolved by the codec. An actual implementation should subclass the abstract BloomFilterPostingsFormat that way you have a fixed PostingsFormat per \\\"delegate\\\" and don\'t need to deal with \\\"which field got which delegate\\\" bla bla.  \\n\\n We should not have a Bloomfilter codec but rather swap in the bloomfilter postings format in test via random codec. I also wonder if we can extract a \\\"bloomfilter\\\" class into utils that builds an BloomFilter this could be useful elsewhere.  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13284536\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13284536&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13284536\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13284536_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284536_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 20:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T20:06:00+0000\'\u003e28\\/May\\/12 20:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI wonder if that also helps indexing in terms of applying deletes. did you test that\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'ve not looked into that particularly but I imagine this may be relevant. \u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the tips for making the patch more generic. I\'ll get on it tomorrow and changed to FixedBitSet while I\'m at it.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI also wonder if we can extract a \\\"bloomfilter\\\" class into utils\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere\'s some reusable stuff in this patch for downsizing the Bitset (according to desired saturation levels) having accumulated a stream of values.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13284536_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284536_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 20:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T20:06:00+0000\'\u003e28\\/May\\/12 20:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I wonder if that also helps indexing in terms of applying deletes. did you test that  \\n\\n I\'ve not looked into that particularly but I imagine this may be relevant.  \\n\\n Thanks for the tips for making the patch more generic. I\'ll get on it tomorrow and changed to FixedBitSet while I\'m at it. \\n\\n  I also wonder if we can extract a \\\"bloomfilter\\\" class into utils  \\n\\n There\'s some reusable stuff in this patch for downsizing the Bitset (according to desired saturation levels) having accumulated a stream of values.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13284545\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13284545&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13284545\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13284545_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284545_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 20:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T20:48:10+0000\'\u003e28\\/May\\/12 20:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThanks for the tips for making the patch more generic. I\'ll get on it tomorrow and changed to FixedBitSet while I\'m at it.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYW! A couple of things regarding your patch. I think you should write a header for the bloomfilter file using CodecUtils.writeHeader() to be consistent. Once you are ready you should also look at the other *PostingsFormat impls how we document the file formats there. We try to have versioned file formats instead of the monolithic one on the website. I saw some minor things like \u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003efinally\u003c\\/span\u003e {\\n  \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (output != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e)  {\\n    output.close();\\n  }\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eyou can use IOUtils.close*() for that which handles some exception cases etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eI briefly looked at your reuse code for TermsEnum and it seems it has the same issues as pulsing has (sovled). When you get a TermsEnum that is infact a Bloomfilter wrapper but wraps another codec underneath you keep on switching back an forth creating new delegated TermsEnum instances. You can look at PulsingPostingsReader and in particular at PulsingEnumAttributeImpl how we solved that in Pulsing. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13284545_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284545_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 20:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T20:48:10+0000\'\u003e28\\/May\\/12 20:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Thanks for the tips for making the patch more generic. I\'ll get on it tomorrow and changed to FixedBitSet while I\'m at it.  \\n YW! A couple of things regarding your patch. I think you should write a header for the bloomfilter file using CodecUtils.writeHeader() to be consistent. Once you are ready you should also look at the other *PostingsFormat impls how we document the file formats there. We try to have versioned file formats instead of the monolithic one on the website. I saw some minor things like  \\n\\n  \\n  finally  {\\n   if  (output !=  null )  {\\n    output.close();\\n  }\\n}\\n \\n  \\n\\n you can use IOUtils.close*() for that which handles some exception cases etc. \\n\\n I briefly looked at your reuse code for TermsEnum and it seems it has the same issues as pulsing has (sovled). When you get a TermsEnum that is infact a Bloomfilter wrapper but wraps another codec underneath you keep on switching back an forth creating new delegated TermsEnum instances. You can look at PulsingPostingsReader and in particular at PulsingEnumAttributeImpl how we solved that in Pulsing.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13284562\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13284562&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13284562\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13284562_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284562_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 22:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T22:11:46+0000\'\u003e28\\/May\\/12 22:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt looks like MurmurHash.java is missing from the patch?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, with \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4055\\\" title=\\\"Refactor SegmentInfo \\/ FieldInfo to make them extensible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4055\\\"\u003e\u003cdel\u003eLUCENE-4055\u003c\\/del\u003e\u003c\\/a\u003e landing it looks like the patch no longer compiles (sorry!)...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13284562_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284562_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/May\\/12 22:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-28T22:11:46+0000\'\u003e28\\/May\\/12 22:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It looks like MurmurHash.java is missing from the patch? \\n\\n Also, with   LUCENE-4055   landing it looks like the patch no longer compiles (sorry!)...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13284945\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13284945&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13284945\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13284945_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284945_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/12 17:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-29T17:20:01+0000\'\u003e29\\/May\\/12 17:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated to work with trunk.\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eChanged to use FixedBitSet\u003c\\/li\u003e\\n\\t\u003cli\u003eIs now a PostingsFormat abstract base class\u003c\\/li\u003e\\n\\t\u003cli\u003eAdded missing MurmurHash class\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eTODOs\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eMove Bloom filter logic to common utils classes\u003c\\/li\u003e\\n\\t\u003cli\u003eUse Service Providers for pluggable choice of hash algos?\u003c\\/li\u003e\\n\\t\u003cli\u003eExpose settings for memory\\/saturation\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13284945_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13284945_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/12 17:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-29T17:20:01+0000\'\u003e29\\/May\\/12 17:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated to work with trunk. \\n \\n\\t Changed to use FixedBitSet \\n\\t Is now a PostingsFormat abstract base class \\n\\t Added missing MurmurHash class \\n \\n\\n\\n TODOs \\n \\n\\t Move Bloom filter logic to common utils classes \\n\\t Use Service Providers for pluggable choice of hash algos? \\n\\t Expose settings for memory\\/saturation \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285054\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285054&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285054\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13285054_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285054_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/12 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-29T19:43:50+0000\'\u003e29\\/May\\/12 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Simon Willnauer - 29\\/May\\/12 19:45\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ehey mark, \u003c\\/p\u003e\\n\\n\u003cp\u003eI think you should really not provide any field handling at all. this should be done in user code ie. a general codes\\/postings format per field. What would be very useful here is integration into RandomCodec so we can randomly swap it in. Same is true for the hash algos &amp; memory settings, I think they should be part of the abstract class ctor and if a user wants to use its own algo they should write their own codec ie. subclass. this stuff is very expert and apps like solr can handle this on top. \u003c\\/p\u003e\\n\\n\u003cp\u003eI am still worried about the TermsEnum reuse code, are you planning to look into this?\u003c\\/p\u003e\\n\\n\u003cp\u003eyou should also add license headers to the files you are adding, note that we don\'t do javadoc license headers anymore so they should just be block comments.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13285054_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285054_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/12 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-29T19:43:50+0000\'\u003e29\\/May\\/12 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Simon Willnauer - 29\\/May\\/12 19:45\\\"\u003eedited\u003c\\/span\u003e                   hey mark,  \\n\\n I think you should really not provide any field handling at all. this should be done in user code ie. a general codes\\/postings format per field. What would be very useful here is integration into RandomCodec so we can randomly swap it in. Same is true for the hash algos &amp; memory settings, I think they should be part of the abstract class ctor and if a user wants to use its own algo they should write their own codec ie. subclass. this stuff is very expert and apps like solr can handle this on top.  \\n\\n I am still worried about the TermsEnum reuse code, are you planning to look into this? \\n\\n you should also add license headers to the files you are adding, note that we don\'t do javadoc license headers anymore so they should just be block comments.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285100\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285100&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285100\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285100_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285100_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/12 20:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-29T20:46:10+0000\'\u003e29\\/May\\/12 20:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think you should really not provide any field handling at all.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBy that I think you mean keep the abstract BloomFilteringPostingsFormatBase and dispense with the BloomFilteringLucene40Codec (and BloomFilteredLucene40PostingsFormat?). I was trying to limit the extensions apps would have to write to use this service (1 custom postings format subclass, 1 custom Codec subclass and 1 custom SPI config file) but I can see that equally we shouldn\'t offer implementations for all the many different service permutations.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll look at adding something to RandomCodec for Bloom-plus-random delegate PostingsFormat.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI am still worried about the TermsEnum reuse code, are you planning to look into this?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eyou keep on switching back an forth creating new delegated TermsEnum instances\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m not sure what you mean in creating new delegated TermsEnum instances?\u003cbr\\/\u003e\\nIn my impl of\\\"iterator(TermsEnum reuse)\\\" I take care to unwrap my wrapper for TermsEnum to find the original delegate\'s TermsEnum and then call the delegateTerms iterator method with this object as the reuse parameter. At this stage shouldn\'t the delegate Terms just recycle that unwrapped TermsEnum as per the normal reuse contract when no wrapping has been done? \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eyou should also add license headers to the files you are adding\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWill do.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285100_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285100_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'29\\/May\\/12 20:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-29T20:46:10+0000\'\u003e29\\/May\\/12 20:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think you should really not provide any field handling at all.  \\n\\n By that I think you mean keep the abstract BloomFilteringPostingsFormatBase and dispense with the BloomFilteringLucene40Codec (and BloomFilteredLucene40PostingsFormat?). I was trying to limit the extensions apps would have to write to use this service (1 custom postings format subclass, 1 custom Codec subclass and 1 custom SPI config file) but I can see that equally we shouldn\'t offer implementations for all the many different service permutations. \\n\\n I\'ll look at adding something to RandomCodec for Bloom-plus-random delegate PostingsFormat. \\n\\n  I am still worried about the TermsEnum reuse code, are you planning to look into this?  \\n  you keep on switching back an forth creating new delegated TermsEnum instances  \\n\\n I\'m not sure what you mean in creating new delegated TermsEnum instances? \\nIn my impl of\\\"iterator(TermsEnum reuse)\\\" I take care to unwrap my wrapper for TermsEnum to find the original delegate\'s TermsEnum and then call the delegateTerms iterator method with this object as the reuse parameter. At this stage shouldn\'t the delegate Terms just recycle that unwrapped TermsEnum as per the normal reuse contract when no wrapping has been done?  \\n\\n  you should also add license headers to the files you are adding  \\n\\n Will do. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285327\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285327&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285327\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285327_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285327_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 01:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T01:54:57+0000\'\u003e30\\/May\\/12 01:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI was trying to limit the extensions apps would have to write to use this service (1 custom postings format subclass, 1 custom Codec subclass and 1 custom SPI config file)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAs far as Codec goes, we don\'t need to provide one for specialized per-field PostingsFormats.\u003c\\/p\u003e\\n\\n\u003cp\u003eUsers can just use an anonymous Lucene40Codec, which already has a hook for doing stuff like this (a protected method you can override to changeup postings format per-field).\u003c\\/p\u003e\\n\\n\u003cp\u003eexample that sets SimpleText on just the \\\"id\\\" field:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    indexWriterConfig.setCodec(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40Codec() {\\n      @Override\\n      \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e PostingsFormat getPostingsFormatForField(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {\\n        \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"id\\\"\u003c\\/span\u003e.equals(field)) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleTextPostingsFormat();\\n        } \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e.getPostingsFormatForField(field);\\n        }\\n      } \\n    });\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ethis is only necessary to set on the indexwriterconfig for writing: PerFieldPostingsFormat records for \u003cbr\\/\u003e\\nthat id field that it was encoded with \\\"SimpleText\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003ewhen the segment is opened, assuming \\\"SimpleText\\\" is in the classpath and registered, it will just work.\u003c\\/p\u003e\\n\\n\u003cp\u003efrom the solr side, they dont need to set any codec either, as its schema already uses this hook, so there its just:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e&lt;fieldType name=\u003cspan class=\\\"code-quote\\\"\u003e\\\"string_simpletext\\\"\u003c\\/span\u003e class=\u003cspan class=\\\"code-quote\\\"\u003e\\\"solr.StrField\\\"\u003c\\/span\u003e postingsFormat=\u003cspan class=\\\"code-quote\\\"\u003e\\\"SimpleText\\\"\u003c\\/span\u003e\\/&gt;\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285327_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285327_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 01:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T01:54:57+0000\'\u003e30\\/May\\/12 01:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I was trying to limit the extensions apps would have to write to use this service (1 custom postings format subclass, 1 custom Codec subclass and 1 custom SPI config file)  \\n\\n As far as Codec goes, we don\'t need to provide one for specialized per-field PostingsFormats. \\n\\n Users can just use an anonymous Lucene40Codec, which already has a hook for doing stuff like this (a protected method you can override to changeup postings format per-field). \\n\\n example that sets SimpleText on just the \\\"id\\\" field: \\n  \\n     indexWriterConfig.setCodec( new  Lucene40Codec() {\\n      @Override\\n       public  PostingsFormat getPostingsFormatForField( String  field) {\\n         if  ( \\\"id\\\" .equals(field)) {\\n           return   new  SimpleTextPostingsFormat();\\n        }  else  {\\n           return   super .getPostingsFormatForField(field);\\n        }\\n      } \\n    });\\n \\n  \\n\\n this is only necessary to set on the indexwriterconfig for writing: PerFieldPostingsFormat records for  \\nthat id field that it was encoded with \\\"SimpleText\\\" \\n\\n when the segment is opened, assuming \\\"SimpleText\\\" is in the classpath and registered, it will just work. \\n\\n from the solr side, they dont need to set any codec either, as its schema already uses this hook, so there its just: \\n\\n  \\n &lt;fieldType name= \\\"string_simpletext\\\"  class= \\\"solr.StrField\\\"  postingsFormat= \\\"SimpleText\\\" \\/&gt;\\n \\n  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285518\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285518&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285518\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285518_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285518_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 08:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T08:57:56+0000\'\u003e30\\/May\\/12 08:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the comment, Rob.\u003cbr\\/\u003e\\nWhile the choice of Codec can be an anonymous inner class, resolving the choice of PostingsFormat is trickier.\u003cbr\\/\u003e\\nBloomFilterPostingsFormat is now intended to wrap any another choice of PostingsFormat and Simon has suggested leaving the Bloom support purely abstract.\u003cbr\\/\u003e\\nHowever, as an end user if I want to use Bloom support on the standard Lucene codec I would then have to write one of these:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eMyBloomFilteredLucene40Postings.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eMyBloomFilteredLucene40Postingsextends BloomFilteringPostingsFormatBase {\\n\\n  \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e MyBloomFilteredLucene40Postings() {\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/declare my choice of PostingsFormat to be wrapped and provide a unique name \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e combo of Bloom-plus-delegate\\n\u003c\\/span\u003e    \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e(\u003cspan class=\\\"code-quote\\\"\u003e\\\"myBL40\\\"\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40PostingsFormat());\\n  }\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eThe resulting index files are then named \u003cspan class=\\\"error\\\"\u003e&#91;segname&#93;\u003c\\/span\u003e_myBL40.\u003cspan class=\\\"error\\\"\u003e&#91;filetypesuffix&#93;\u003c\\/span\u003e.\u003cbr\\/\u003e\\nAt read-time the \\\"myBL40\\\" bit of the filename is used to lookup via Service Provider registrations the decoding class so \\\"com.xx.MyBloomFilteredLucene40Postings\\\" would need adding to a o.a.l.codecs.PostingsFormat file for the registration to work.\u003c\\/p\u003e\\n\\n\u003cp\u003eI imagine Bloom-plus-Lucene40Postings would be a common combo and if both are in core it would be annoying to have to code support for this in each app or for things like Luke to have to have classpaths redefined to access the app-specific class that was created purely to bind this combo of core components.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think a better option might be to change the Bloom filtering base class to record the choice of delegate PostingsFormat in it\'s own \\\"blm\\\" file at write-time and instantiate the appropriate delegate instance at read-time using the recorded name. The BloomFilteringBaseClass would need changing to a final class rather than an abstract so that core Lucene could load it as the handler for \u003cspan class=\\\"error\\\"\u003e&#91;segname&#93;\u003c\\/span\u003e_BloomPosting.xxx files and it would then have to examine the \u003cspan class=\\\"error\\\"\u003e&#91;segname&#93;\u003c\\/span\u003e.blm file to discover and instantiate the choice of delegate PostingsFormat using the standard service registration mechanism. At write-time clients would need to instantiate the BloomFilterPostingsFormat, passing a choice of PostingsFormat delegate to the constructor. At read-time Lucene core would invoke a zero-arg constructor.\u003cbr\\/\u003e\\nI\'ll look into this as an approach.\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285518_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285518_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 08:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T08:57:56+0000\'\u003e30\\/May\\/12 08:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the comment, Rob. \\nWhile the choice of Codec can be an anonymous inner class, resolving the choice of PostingsFormat is trickier. \\nBloomFilterPostingsFormat is now intended to wrap any another choice of PostingsFormat and Simon has suggested leaving the Bloom support purely abstract. \\nHowever, as an end user if I want to use Bloom support on the standard Lucene codec I would then have to write one of these: \\n   MyBloomFilteredLucene40Postings.java   \\n  public   class  MyBloomFilteredLucene40Postingsextends BloomFilteringPostingsFormatBase {\\n\\n   public  MyBloomFilteredLucene40Postings() {\\n     \\/\\/declare my choice of PostingsFormat to be wrapped and provide a unique name  for   this  combo of Bloom-plus-delegate\\n      super ( \\\"myBL40\\\" ,  new  Lucene40PostingsFormat());\\n  }\\n}\\n \\n  \\n The resulting index files are then named  &#91;segname&#93; _myBL40. &#91;filetypesuffix&#93; . \\nAt read-time the \\\"myBL40\\\" bit of the filename is used to lookup via Service Provider registrations the decoding class so \\\"com.xx.MyBloomFilteredLucene40Postings\\\" would need adding to a o.a.l.codecs.PostingsFormat file for the registration to work. \\n\\n I imagine Bloom-plus-Lucene40Postings would be a common combo and if both are in core it would be annoying to have to code support for this in each app or for things like Luke to have to have classpaths redefined to access the app-specific class that was created purely to bind this combo of core components. \\n\\n I think a better option might be to change the Bloom filtering base class to record the choice of delegate PostingsFormat in it\'s own \\\"blm\\\" file at write-time and instantiate the appropriate delegate instance at read-time using the recorded name. The BloomFilteringBaseClass would need changing to a final class rather than an abstract so that core Lucene could load it as the handler for  &#91;segname&#93; _BloomPosting.xxx files and it would then have to examine the  &#91;segname&#93; .blm file to discover and instantiate the choice of delegate PostingsFormat using the standard service registration mechanism. At write-time clients would need to instantiate the BloomFilterPostingsFormat, passing a choice of PostingsFormat delegate to the constructor. At read-time Lucene core would invoke a zero-arg constructor. \\nI\'ll look into this as an approach. \\n\\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285706\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285706&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285706\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285706_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285706_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 14:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T14:43:59+0000\'\u003e30\\/May\\/12 14:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAaaargh. Unless I\'ve missed something, I have concerns with the fundamental design of the current Codec loading mechanism.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems too tied to the concept of a ServiceProvider class-loading mechanism, forcing users to write new SPI-registered classes in order to simply declare what amount to index schema configuration choices.\u003c\\/p\u003e\\n\\n\u003cp\u003eExample: If I take Rob\'s sample Codec above and choose to use a subtly different configuration of the same PostingsFormat class for different fields it breaks:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eThisBreaks.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e      Codec fooCodec=\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40Codec() {\\n        @Override\\n        \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e PostingsFormat getPostingsFormatForField(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"text\\\"\u003c\\/span\u003e.equals(field)) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e FooPostingsFormat(1);\\n          }\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"title\\\"\u003c\\/span\u003e.equals(field)) {\\n            \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/same impl as \u003cspan class=\\\"code-quote\\\"\u003e\\\"text\\\"\u003c\\/span\u003e field, different constructor settings        \\n\u003c\\/span\u003e            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e FooPostingsFormat(2);\\n          }          \\n          \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e.getPostingsFormatForField(field);\\n        } \\n      };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eThis causes a file overwrite error as PerFieldPostingsFormat uses the same name from FooPostingsFormat(1) and FooPostingsFormat(2) to create files.\u003cbr\\/\u003e\\nIn order to safely make use of differently configured choices of the same PostingsFormat we are forced to declare a brand new subclass with a unique new service name and entry in the service provider registration. This is essentially where I have got to in trying to integrate this Bloom filtering logic.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis dependency on writing custom classes seems to make everything a bit fragile, no? What hope has Luke got in opening the average index without careful assembly of classpaths etc?\u003cbr\\/\u003e\\nIf I contrast this with the world of database schemas it seems absurd to have a reliance on writing custom classes with no behaviour simply in order to preserve a configuration of an application\'s schema settings. Even an IOC container with XML declarations would offer a more agile means of assembling pre-configured \u003cb\u003ebeans\u003c\\/b\u003e rather than relying on a Service Provider mechanism that is only serving as a registry of \u003cb\u003eclasses\u003c\\/b\u003e.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyone else see this as a major pain?\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285706_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285706_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 14:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T14:43:59+0000\'\u003e30\\/May\\/12 14:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Aaaargh. Unless I\'ve missed something, I have concerns with the fundamental design of the current Codec loading mechanism. \\n\\n It seems too tied to the concept of a ServiceProvider class-loading mechanism, forcing users to write new SPI-registered classes in order to simply declare what amount to index schema configuration choices. \\n\\n Example: If I take Rob\'s sample Codec above and choose to use a subtly different configuration of the same PostingsFormat class for different fields it breaks: \\n\\n   ThisBreaks.java   \\n       Codec fooCodec= new  Lucene40Codec() {\\n        @Override\\n         public  PostingsFormat getPostingsFormatForField( String  field) {\\n           if  ( \\\"text\\\" .equals(field)) {\\n             return   new  FooPostingsFormat(1);\\n          }\\n           if  ( \\\"title\\\" .equals(field)) {\\n             \\/\\/same impl as  \\\"text\\\"  field, different constructor settings        \\n              return   new  FooPostingsFormat(2);\\n          }          \\n           return   super .getPostingsFormatForField(field);\\n        } \\n      };\\n \\n  \\n This causes a file overwrite error as PerFieldPostingsFormat uses the same name from FooPostingsFormat(1) and FooPostingsFormat(2) to create files. \\nIn order to safely make use of differently configured choices of the same PostingsFormat we are forced to declare a brand new subclass with a unique new service name and entry in the service provider registration. This is essentially where I have got to in trying to integrate this Bloom filtering logic. \\n\\n This dependency on writing custom classes seems to make everything a bit fragile, no? What hope has Luke got in opening the average index without careful assembly of classpaths etc? \\nIf I contrast this with the world of database schemas it seems absurd to have a reliance on writing custom classes with no behaviour simply in order to preserve a configuration of an application\'s schema settings. Even an IOC container with XML declarations would offer a more agile means of assembling pre-configured  beans  rather than relying on a Service Provider mechanism that is only serving as a registry of  classes . \\n\\n Anyone else see this as a major pain? \\n\\n\\n\\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285726\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285726&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285726\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285726_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285726_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:08:18+0000\'\u003e30\\/May\\/12 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m not sure this is true: e.g. if your postings format requires parameters to decode the segment, then this enforces that it records said parameters,\u003cbr\\/\u003e\\ne.g. Pulsing records these parameters.\u003c\\/p\u003e\\n\\n\u003cp\u003eCodec parameters are at index-time, at read-time its your responsibility to be able to decode them solely from the index (this enforces that there doesnt need\u003cbr\\/\u003e\\nto be a crazy matching of user configuration at write and read time).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285726_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285726_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:08:18+0000\'\u003e30\\/May\\/12 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m not sure this is true: e.g. if your postings format requires parameters to decode the segment, then this enforces that it records said parameters, \\ne.g. Pulsing records these parameters. \\n\\n Codec parameters are at index-time, at read-time its your responsibility to be able to decode them solely from the index (this enforces that there doesnt need \\nto be a crazy matching of user configuration at write and read time).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285744\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285744&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285744\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285744_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285744_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:33:39+0000\'\u003e30\\/May\\/12 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis fails if you add docs with title and text fields:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eThisCrashes.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e      Codec fooCodec=\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40Codec() {\\n        @Override\\n        \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e PostingsFormat getPostingsFormatForField(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"text\\\"\u003c\\/span\u003e.equals(field)) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e MemoryPostingsFormat(\u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e);\\n          }\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"title\\\"\u003c\\/span\u003e.equals(field)) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e MemoryPostingsFormat(\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n          }          \\n          \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e.getPostingsFormatForField(field);\\n          }\\n        } \\n      };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e  Exception in thread \\\"main\\\" java.io.IOException: Cannot overwrite: C:\\\\temp\\\\luceneCodecs&#95;2_Memory.ram\u003c\\/p\u003e\\n\\n\u003cp\u003eThis also fails:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eThisToo.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e       Codec fooCodec=\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40Codec() {\\n        SimpleTextPostingsFormat theSimple = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleTextPostingsFormat();\\n        @Override\\n        \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e PostingsFormat getPostingsFormatForField(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"text\\\"\u003c\\/span\u003e.equals(field)) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleTextPostingsFormat();\\n          }\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (\u003cspan class=\\\"code-quote\\\"\u003e\\\"title\\\"\u003c\\/span\u003e.equals(field)) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleTextPostingsFormat();\\n          }          \\n          \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e.getPostingsFormatForField(field);\\n          }\\n        } \\n      };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003ewith \u003cbr\\/\u003e\\n  Exception in thread \\\"main\\\" java.io.IOException: Cannot overwrite: C:\\\\temp\\\\luceneCodecs&#95;1_SimpleText.pst\u003c\\/p\u003e\\n\\n\u003cp\u003eWhereas sharing the same instance of a PostingsFormat class across fields works:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eThisWorks.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e      Codec fooCodec=\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40Codec() {\\n        SimpleTextPostingsFormat theSimple = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SimpleTextPostingsFormat();\\n        @Override\\n        \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e PostingsFormat getPostingsFormatForField(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {\\n          \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e ((\u003cspan class=\\\"code-quote\\\"\u003e\\\"text\\\"\u003c\\/span\u003e.equals(field))|| (\u003cspan class=\\\"code-quote\\\"\u003e\\\"title\\\"\u003c\\/span\u003e.equals(field))) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e theSimple;\\n          }          \\n          \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003esuper\u003c\\/span\u003e.getPostingsFormatForField(field);\\n          }\\n        } \\n      };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285744_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285744_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:33:39+0000\'\u003e30\\/May\\/12 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This fails if you add docs with title and text fields: \\n   ThisCrashes.java   \\n       Codec fooCodec= new  Lucene40Codec() {\\n        @Override\\n         public  PostingsFormat getPostingsFormatForField( String  field) {\\n           if  ( \\\"text\\\" .equals(field)) {\\n             return   new  MemoryPostingsFormat( false );\\n          }\\n           if  ( \\\"title\\\" .equals(field)) {\\n             return   new  MemoryPostingsFormat( true );\\n          }          \\n           else  {\\n             return   super .getPostingsFormatForField(field);\\n          }\\n        } \\n      };\\n \\n  \\n\\n   Exception in thread \\\"main\\\" java.io.IOException: Cannot overwrite: C:\\\\temp\\\\luceneCodecs&#95;2_Memory.ram \\n\\n This also fails: \\n\\n   ThisToo.java   \\n        Codec fooCodec= new  Lucene40Codec() {\\n        SimpleTextPostingsFormat theSimple =  new  SimpleTextPostingsFormat();\\n        @Override\\n         public  PostingsFormat getPostingsFormatForField( String  field) {\\n           if  ( \\\"text\\\" .equals(field)) {\\n             return   new  SimpleTextPostingsFormat();\\n          }\\n           if  ( \\\"title\\\" .equals(field)) {\\n             return   new  SimpleTextPostingsFormat();\\n          }          \\n           else  {\\n             return   super .getPostingsFormatForField(field);\\n          }\\n        } \\n      };\\n \\n  \\n with  \\n  Exception in thread \\\"main\\\" java.io.IOException: Cannot overwrite: C:\\\\temp\\\\luceneCodecs&#95;1_SimpleText.pst \\n\\n Whereas sharing the same instance of a PostingsFormat class across fields works: \\n\\n   ThisWorks.java   \\n       Codec fooCodec= new  Lucene40Codec() {\\n        SimpleTextPostingsFormat theSimple =  new  SimpleTextPostingsFormat();\\n        @Override\\n         public  PostingsFormat getPostingsFormatForField( String  field) {\\n           if  (( \\\"text\\\" .equals(field))|| ( \\\"title\\\" .equals(field))) {\\n             return  theSimple;\\n          }          \\n           else  {\\n             return   super .getPostingsFormatForField(field);\\n          }\\n        } \\n      };\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285745\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285745&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285745\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285745_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285745_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:33:46+0000\'\u003e30\\/May\\/12 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAs far as your problem with parameters, this is actually just a limitation I created (on accident) of PerFieldPostingsFormat\u003cbr\\/\u003e\\non \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4055\\\" title=\\\"Refactor SegmentInfo \\/ FieldInfo to make them extensible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4055\\\"\u003e\u003cdel\u003eLUCENE-4055\u003c\\/del\u003e\u003c\\/a\u003e. Because we use the postingsformat name as the segment suffix, its not possible to have e.g. id field with Pulsing(1)\u003cbr\\/\u003e\\nand date field with Pulsing(2).\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll open an issue and fix this, again its just an issue with PerFieldPostingsFormat. you should be able to use the same name here\u003cbr\\/\u003e\\nwith different configs, as long as your PostingsFormat writes what it needs to read the files. Thanks for bringing this up.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285745_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285745_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:33:46+0000\'\u003e30\\/May\\/12 15:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    As far as your problem with parameters, this is actually just a limitation I created (on accident) of PerFieldPostingsFormat \\non   LUCENE-4055  . Because we use the postingsformat name as the segment suffix, its not possible to have e.g. id field with Pulsing(1) \\nand date field with Pulsing(2). \\n\\n I\'ll open an issue and fix this, again its just an issue with PerFieldPostingsFormat. you should be able to use the same name here \\nwith different configs, as long as your PostingsFormat writes what it needs to read the files. Thanks for bringing this up.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285746\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285746&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285746\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13285746_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285746_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:34:44+0000\'\u003e30\\/May\\/12 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhen I run all tests with the bloom 4.0 postings format (\u003ctt\u003eant test-core -Dtests.postingsformat=BloomFilteredLucene40PostingsFormat\u003c\\/tt\u003e), I see a lot of failures..., eg lots of CheckIndex failures like:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e   [junit4]   1&gt; java.lang.RuntimeException: vector term=[e4 b8 80 74 77 6f] field=textField2Utf8 does not exist in postings; doc=0\\n   [junit4]   1&gt; \\tat org.apache.lucene.index.CheckIndex.testTermVectors(CheckIndex.java:1440)\\n   [junit4]   1&gt; \\tat org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:575)\\n   [junit4]   1&gt; \\tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:186)\\n   [junit4]   1&gt; \\tat org.apache.lucene.store.MockDirectoryWrapper.close(MockDirectoryWrapper.java:587)\\n   [junit4]   1&gt; \\tat org.apache.lucene.index.TestFieldsReader.afterClass(TestFieldsReader.java:72)\\n   [junit4]   1&gt; \\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\\n   [junit4]   1&gt; \\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eBut also other spooky failures.  Are these known issues?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13285746_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285746_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:34:44+0000\'\u003e30\\/May\\/12 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    When I run all tests with the bloom 4.0 postings format ( ant test-core -Dtests.postingsformat=BloomFilteredLucene40PostingsFormat ), I see a lot of failures..., eg lots of CheckIndex failures like: \\n\\n  \\n    [junit4]   1&gt; java.lang.RuntimeException: vector term=[e4 b8 80 74 77 6f] field=textField2Utf8 does not exist in postings; doc=0\\n   [junit4]   1&gt; \\tat org.apache.lucene.index.CheckIndex.testTermVectors(CheckIndex.java:1440)\\n   [junit4]   1&gt; \\tat org.apache.lucene.index.CheckIndex.checkIndex(CheckIndex.java:575)\\n   [junit4]   1&gt; \\tat org.apache.lucene.util._TestUtil.checkIndex(_TestUtil.java:186)\\n   [junit4]   1&gt; \\tat org.apache.lucene.store.MockDirectoryWrapper.close(MockDirectoryWrapper.java:587)\\n   [junit4]   1&gt; \\tat org.apache.lucene.index.TestFieldsReader.afterClass(TestFieldsReader.java:72)\\n   [junit4]   1&gt; \\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\\n   [junit4]   1&gt; \\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\\n \\n  \\n\\n But also other spooky failures.  Are these known issues?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285757\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285757&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285757\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285757_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285757_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:45:17+0000\'\u003e30\\/May\\/12 15:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark: I opened \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4090\\\" title=\\\"PerFieldPostingsFormat cannot use name as suffix\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4090\\\"\u003e\u003cdel\u003eLUCENE-4090\u003c\\/del\u003e\u003c\\/a\u003e.. I broke it, so I\'ll fix it \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285757_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285757_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:45:17+0000\'\u003e30\\/May\\/12 15:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mark: I opened   LUCENE-4090  .. I broke it, so I\'ll fix it   \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285765\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285765&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285765\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285765_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285765_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:51:07+0000\'\u003e30\\/May\\/12 15:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eits just an issue with PerFieldPostingsFormat\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK, thanks. My guess is you\'ll effectively be having to supplement postingsformat.getName() with object-instanceID in file names.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285765_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285765_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:51:07+0000\'\u003e30\\/May\\/12 15:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     its just an issue with PerFieldPostingsFormat  \\n\\n OK, thanks. My guess is you\'ll effectively be having to supplement postingsformat.getName() with object-instanceID in file names.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285768\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285768&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285768\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285768_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285768_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:59:20+0000\'\u003e30\\/May\\/12 15:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRight, its not bad. Separately I\'m not happy that its a little trappy in situations like your ThisToo.java,\u003c\\/p\u003e\\n\\n\u003cp\u003eits certainly easy and safe to continue to use identityhashmap but I think we will need to require equals\\/hashcode on postingsformats.\u003c\\/p\u003e\\n\\n\u003cp\u003eOtherwise its going to make the situation trappy in the future, e.g. we will want to add mechanisms to solr so that you can specify these parameters\u003cbr\\/\u003e\\nin the schema.xml (today you cannot), and this would create massive amounts of files if we did so (add to the fact it disables compound files by default\u003cbr\\/\u003e\\nand its a disaster...)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13285768_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285768_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 15:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T15:59:20+0000\'\u003e30\\/May\\/12 15:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Right, its not bad. Separately I\'m not happy that its a little trappy in situations like your ThisToo.java, \\n\\n its certainly easy and safe to continue to use identityhashmap but I think we will need to require equals\\/hashcode on postingsformats. \\n\\n Otherwise its going to make the situation trappy in the future, e.g. we will want to add mechanisms to solr so that you can specify these parameters \\nin the schema.xml (today you cannot), and this would create massive amounts of files if we did so (add to the fact it disables compound files by default \\nand its a disaster...)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13285773\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13285773&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13285773\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285773_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285773_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T16:02:18+0000\'\u003e30\\/May\\/12 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWhen I run all tests with the bloom 4.0 postings format (ant test-core -Dtests.postingsformat=BloomFilteredLucene40PostingsFormat), \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThanks for the pointer on targeting codec testing. I have another patch to upload with various tweaks e.g. configurable choice of hash functions, RandomCodec additions so I will concentrate testing on that before uploading.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13285773_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13285773_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/12 16:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-30T16:02:18+0000\'\u003e30\\/May\\/12 16:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     When I run all tests with the bloom 4.0 postings format (ant test-core -Dtests.postingsformat=BloomFilteredLucene40PostingsFormat),   \\n\\n Thanks for the pointer on targeting codec testing. I have another patch to upload with various tweaks e.g. configurable choice of hash functions, RandomCodec additions so I will concentrate testing on that before uploading.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286551\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286551&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286551\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286551_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286551_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:20:07+0000\'\u003e31\\/May\\/12 13:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is looking more promising.\u003c\\/p\u003e\\n\\n\u003cp\u003eRunning \\\"ant test-core -Dtests.postingsformat=TestBloomFilteredLucene40Postings\\\" now passes all tests but causes OOM exception on 3 tests:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eTestConsistentFieldNumbers.testManyFields\u003c\\/li\u003e\\n\\t\u003cli\u003eTestIndexableField.testArbitraryFields\u003c\\/li\u003e\\n\\t\u003cli\u003eTestIndexWriter.testManyFields\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAny pointers on how to annotate or otherwise avoid the BloomFilter class for \\\"many-field\\\" tests would be welcome. These are not realistic tests for this class (we don\'t expect indexes with 100s of primary-key like fields).\u003c\\/p\u003e\\n\\n\u003cp\u003eIn this patch I\'ve\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eadded an SPI lookup mechanism for pluggable hash algos.\u003c\\/li\u003e\\n\\t\u003cli\u003edocumented the file format\u003c\\/li\u003e\\n\\t\u003cli\u003efixed issues with TermVector tests\u003c\\/li\u003e\\n\\t\u003cli\u003echanged the API\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eTo use:\u003cbr\\/\u003e\\nBloomFilteringPostingFormat now takes a delegate PostingsFormat and a set of field names that are to have bloom-filters created.\u003cbr\\/\u003e\\nFields that are not listed in the filter set can be safely indexed as per normal and doing so is beneficial because it allows filtered and non filtered field data to co-exist in the same physical files created by the delegate PostingsFormat.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286551_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286551_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:20:07+0000\'\u003e31\\/May\\/12 13:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is looking more promising. \\n\\n Running \\\"ant test-core -Dtests.postingsformat=TestBloomFilteredLucene40Postings\\\" now passes all tests but causes OOM exception on 3 tests: \\n \\n\\t TestConsistentFieldNumbers.testManyFields \\n\\t TestIndexableField.testArbitraryFields \\n\\t TestIndexWriter.testManyFields \\n \\n\\n\\n Any pointers on how to annotate or otherwise avoid the BloomFilter class for \\\"many-field\\\" tests would be welcome. These are not realistic tests for this class (we don\'t expect indexes with 100s of primary-key like fields). \\n\\n In this patch I\'ve \\n \\n\\t added an SPI lookup mechanism for pluggable hash algos. \\n\\t documented the file format \\n\\t fixed issues with TermVector tests \\n\\t changed the API \\n \\n\\n\\n\\n To use: \\nBloomFilteringPostingFormat now takes a delegate PostingsFormat and a set of field names that are to have bloom-filters created. \\nFields that are not listed in the filter set can be safely indexed as per normal and doing so is beneficial because it allows filtered and non filtered field data to co-exist in the same physical files created by the delegate PostingsFormat.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286554\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286554&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286554\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286554_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286554_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:27:24+0000\'\u003e31\\/May\\/12 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded missing class\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286554_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286554_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:27:24+0000\'\u003e31\\/May\\/12 13:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added missing class              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286555\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286555&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286555\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286555_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286555_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:29:23+0000\'\u003e31\\/May\\/12 13:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t think the abstract class should be registered in the SPI.\u003c\\/p\u003e\\n\\n\u003cp\u003eInstead i think the concrete Bloom+Lucene40 that you have in tests should be moved into src\\/java and registered there, just call it Bloom40 or something. The abstract api is still available for someone that wants to do something more specialized.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is just like how pulsing (another wrapper) is implemented.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs far as disabling this for certain tests, import o.a.l.util.LuceneTestCase.SuppressCodecs and put something like this at class level:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e@SuppressCodecs(\u003cspan class=\\\"code-quote\\\"\u003e\\\"Bloom40\\\"\u003c\\/span\u003e)\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eTestFoo...\\n\\n@SuppressCodecs({\u003cspan class=\\\"code-quote\\\"\u003e\\\"Bloom40\\\"\u003c\\/span\u003e, \u003cspan class=\\\"code-quote\\\"\u003e\\\"Memory\\\"\u003c\\/span\u003e})\\n\u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e \u003cspan class=\\\"code-keyword\\\"\u003eclass \u003c\\/span\u003eTestBar...\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eThe strings in here can be codecs or postings formats\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286555_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286555_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:29:23+0000\'\u003e31\\/May\\/12 13:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t think the abstract class should be registered in the SPI. \\n\\n Instead i think the concrete Bloom+Lucene40 that you have in tests should be moved into src\\/java and registered there, just call it Bloom40 or something. The abstract api is still available for someone that wants to do something more specialized. \\n\\n This is just like how pulsing (another wrapper) is implemented. \\n\\n As far as disabling this for certain tests, import o.a.l.util.LuceneTestCase.SuppressCodecs and put something like this at class level: \\n\\n  \\n @SuppressCodecs( \\\"Bloom40\\\" )\\n public   class  TestFoo...\\n\\n@SuppressCodecs({ \\\"Bloom40\\\" ,  \\\"Memory\\\" })\\n public   class  TestBar...\\n \\n  \\n\\n The strings in here can be codecs or postings formats              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286562\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286562&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286562\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286562_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286562_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:41:18+0000\'\u003e31\\/May\\/12 13:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSeeing the tests in question though, i dont think you want to disable this for these entire test classes.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe dont have a way to disable this on a per-method basis: and I think its generally not possible because\u003cbr\\/\u003e\\nmany classes create indexes in @BeforeClass etc.\u003c\\/p\u003e\\n\\n\u003cp\u003eAn alternative would be to just pick this less often in RandomCodec: see the SimpleText hack \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286562_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286562_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 13:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T13:41:18+0000\'\u003e31\\/May\\/12 13:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Seeing the tests in question though, i dont think you want to disable this for these entire test classes. \\n\\n We dont have a way to disable this on a per-method basis: and I think its generally not possible because \\nmany classes create indexes in @BeforeClass etc. \\n\\n An alternative would be to just pick this less often in RandomCodec: see the SimpleText hack                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286598\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286598&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286598\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286598_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286598_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:21:24+0000\'\u003e31\\/May\\/12 14:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eInstead i think the concrete Bloom+Lucene40 that you have in tests should be moved into src\\/java and registered there\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWhat problem would that be trying to solve? Registration (or creation) of any BloomFilteringPostingsFormat subclasses is not necessary to decode index contents. Offering a \\\"Bloom40\\\" would only buy users a pairing of Lucene40Postings and Bloom filtering but they would still have to declare which fields they want Bloom filtering on at write time. This isn\'t too hard using the code in the existing patch:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eThisWorks.java\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e        \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e Set&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt;bloomFilteredFields=\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e HashSet&lt;\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e&gt;();\\n        bloomFilteredFields.add(PRIMARY_KEY_FIELD_NAME);\\n\\n        iwc.setCodec(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40Codec(){\\n          BloomFilteringPostingsFormat postingOptions=\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e BloomFilteringPostingsFormat(\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e Lucene40PostingsFormat(), bloomFilteredFields);\\n          @Override\\n          \u003cspan class=\\\"code-keyword\\\"\u003epublic\u003c\\/span\u003e PostingsFormat getPostingsFormatForField(\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e field) {\\n            \u003cspan class=\\\"code-keyword\\\"\u003ereturn\u003c\\/span\u003e postingOptions;\\n          }          \\n        });\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eNo extra subclasses\\/registration required here to read the index built with the above setup.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286598_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286598_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:21:24+0000\'\u003e31\\/May\\/12 14:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Instead i think the concrete Bloom+Lucene40 that you have in tests should be moved into src\\/java and registered there  \\n\\n What problem would that be trying to solve? Registration (or creation) of any BloomFilteringPostingsFormat subclasses is not necessary to decode index contents. Offering a \\\"Bloom40\\\" would only buy users a pairing of Lucene40Postings and Bloom filtering but they would still have to declare which fields they want Bloom filtering on at write time. This isn\'t too hard using the code in the existing patch: \\n\\n   ThisWorks.java   \\n          final  Set&lt; String &gt;bloomFilteredFields= new  HashSet&lt; String &gt;();\\n        bloomFilteredFields.add(PRIMARY_KEY_FIELD_NAME);\\n\\n        iwc.setCodec( new  Lucene40Codec(){\\n          BloomFilteringPostingsFormat postingOptions= new  BloomFilteringPostingsFormat( new  Lucene40PostingsFormat(), bloomFilteredFields);\\n          @Override\\n           public  PostingsFormat getPostingsFormatForField( String  field) {\\n             return  postingOptions;\\n          }          \\n        });\\n \\n  \\n No extra subclasses\\/registration required here to read the index built with the above setup.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286599\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286599&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286599\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286599_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286599_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:24:48+0000\'\u003e31\\/May\\/12 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI dont understand why this handles fields. Someone should just pick that with perfieldpostingsformat.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo you have the abstract wrapper(takes the wrapped postings format, and a String name), not registered.\u003cbr\\/\u003e\\nAnd you have a concrete impl registered that is just abstractWrapper(lucene40, \\\"Bloom40\\\"): done.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286599_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286599_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:24:48+0000\'\u003e31\\/May\\/12 14:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I dont understand why this handles fields. Someone should just pick that with perfieldpostingsformat. \\n\\n So you have the abstract wrapper(takes the wrapped postings format, and a String name), not registered. \\nAnd you have a concrete impl registered that is just abstractWrapper(lucene40, \\\"Bloom40\\\"): done.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286600\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286600&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286600\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286600_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286600_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:28:05+0000\'\u003e31\\/May\\/12 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAn alternative would be to just pick this less often in RandomCodec: see the SimpleText hack \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAnother option might be to make the TestBloomFilteredLucene40Postings pick a ludicrously small Bitset sizing option for each field so that we can accommodate tests that create silly numbers of fields. The bitsets being so small will just quickly reach saturation and force all reads to hit the underlying FieldsProducer.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286600_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286600_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:28:05+0000\'\u003e31\\/May\\/12 14:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     An alternative would be to just pick this less often in RandomCodec: see the SimpleText hack   \\n\\n Another option might be to make the TestBloomFilteredLucene40Postings pick a ludicrously small Bitset sizing option for each field so that we can accommodate tests that create silly numbers of fields. The bitsets being so small will just quickly reach saturation and force all reads to hit the underlying FieldsProducer.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286616\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286616&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286616\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286616_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286616_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:37:52+0000\'\u003e31\\/May\\/12 14:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI dont understand why this handles fields. Someone should just pick that with perfieldpostingsformat.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat would be inefficient because your PFPF will see BloomFilteringPostingsFormat(field1 + Lucene40) and BloomFilteringPostingsFormat(field2 + Lucene40) as fundamentally different PostingsFormat instances and consequently create multiple files named differently because it assumes these instances may be capable of using radically different file structures.\u003cbr\\/\u003e\\nIn reality, the choice of BloomFilter with field 1 or BloomFilter with field 2 or indeed no BloomFilter does not fundamentally alter the underlying delegate PostingFormat\'s file format - it only adds a supplementary \\\"blm\\\" file on the side with the field summaries. For this reason it is a mistake to configure seperate BloomFilterPostingsFormat instances on a per-field basis if they can share a common delegate.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286616_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286616_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:37:52+0000\'\u003e31\\/May\\/12 14:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I dont understand why this handles fields. Someone should just pick that with perfieldpostingsformat.  \\n\\n That would be inefficient because your PFPF will see BloomFilteringPostingsFormat(field1 + Lucene40) and BloomFilteringPostingsFormat(field2 + Lucene40) as fundamentally different PostingsFormat instances and consequently create multiple files named differently because it assumes these instances may be capable of using radically different file structures. \\nIn reality, the choice of BloomFilter with field 1 or BloomFilter with field 2 or indeed no BloomFilter does not fundamentally alter the underlying delegate PostingFormat\'s file format - it only adds a supplementary \\\"blm\\\" file on the side with the field summaries. For this reason it is a mistake to configure seperate BloomFilterPostingsFormat instances on a per-field basis if they can share a common delegate. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286619\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286619&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286619\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286619_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286619_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:40:30+0000\'\u003e31\\/May\\/12 14:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eThat would be inefficient because your PFPF will see BloomFilteringPostingsFormat(field1 + Lucene40) and BloomFilteringPostingsFormat(field2 + Lucene40) as fundamentally different PostingsFormat instances and consequently create multiple files named differently because it assumes these instances may be capable of using radically different file structures.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eBut adding per-field handling here is not the way to solve this: its messy. \u003c\\/p\u003e\\n\\n\u003cp\u003ePer-Field handling should all be handled at a level above in PerFieldPostingsFormat.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo solve what you speak of we just need to resolve \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4093\\\" title=\\\"Implement better equals() on PostingsFormats where possible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4093\\\"\u003eLUCENE-4093\u003c\\/a\u003e. Then multiple postings format instances that are \'the same\' will be deduplicated correctly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286619_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286619_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 14:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T14:40:30+0000\'\u003e31\\/May\\/12 14:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n That would be inefficient because your PFPF will see BloomFilteringPostingsFormat(field1 + Lucene40) and BloomFilteringPostingsFormat(field2 + Lucene40) as fundamentally different PostingsFormat instances and consequently create multiple files named differently because it assumes these instances may be capable of using radically different file structures.  \\n\\n But adding per-field handling here is not the way to solve this: its messy.  \\n\\n Per-Field handling should all be handled at a level above in PerFieldPostingsFormat. \\n\\n To solve what you speak of we just need to resolve  LUCENE-4093 . Then multiple postings format instances that are \'the same\' will be deduplicated correctly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286707\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286707&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286707\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286707_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286707_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T16:19:02+0000\'\u003e31\\/May\\/12 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eTo solve what you speak of we just need to resolve \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4093\\\" title=\\\"Implement better equals() on PostingsFormats where possible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4093\\\"\u003eLUCENE-4093\u003c\\/a\u003e. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ePresumably the main objective here is that in order to cut down on the number of files we store, content consumers of various types should aim to consolidate multiple fields\' contents into a single file (if they share common config choices). \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eThen multiple postings format instances that are \'the same\' will be deduplicated correctly.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe complication in this case is that we essentially have 2 consumers (Bloom and Lucene40), one wrapped in the other with different but overlapping choices of fields e.g we want a single Lucene40 to process all fields but we want Bloom to handle only a subset of these fields. This will be a tough one for PFPF to untangle while we are stuck with a delegating model for composing consumers. \u003c\\/p\u003e\\n\\n\u003cp\u003eThis may be made easier if instead of delegating a single stream we have a \u003cb\u003estream-splitting\u003c\\/b\u003e capability via a multicast subscription e.g. Bloom filtering consumer registers interest in content streams for fields A and B while Lucene40 is consolidating content from fields A, B, C and D. A broadcast mechanism feeds each consumer a copy of the relevant stream and each consumer is responsible for inventing their own file-naming convention that avoids muddling files.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhile that may help for writing streams it doesn\'t solve the re-assembly of \\\"producer\\\" streams at read-time where BloomFilter absolutely has to position itself in front of the standard Lucene40 producer in order to offer fast-fail lookups. \u003c\\/p\u003e\\n\\n\u003cp\u003eIn the absence of a fancy optimised routing mechanism (this all may be overkill) my current solution was to put BloomFilter in the delegate chain armed with a subset of fieldnames to observe as a larger array of fields flow past to a common delegate. I added some Javadocs to describe the need to do it this way for an efficient configuration.\u003cbr\\/\u003e\\nYou are right that this is messy (ie open to bad configuration) but operating this deep down in Lucene that\'s always a possibility regardless of what we put in place.\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286707_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286707_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T16:19:02+0000\'\u003e31\\/May\\/12 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     To solve what you speak of we just need to resolve  LUCENE-4093 .   \\n\\n Presumably the main objective here is that in order to cut down on the number of files we store, content consumers of various types should aim to consolidate multiple fields\' contents into a single file (if they share common config choices).  \\n\\n  Then multiple postings format instances that are \'the same\' will be deduplicated correctly.  \\n\\n The complication in this case is that we essentially have 2 consumers (Bloom and Lucene40), one wrapped in the other with different but overlapping choices of fields e.g we want a single Lucene40 to process all fields but we want Bloom to handle only a subset of these fields. This will be a tough one for PFPF to untangle while we are stuck with a delegating model for composing consumers.  \\n\\n This may be made easier if instead of delegating a single stream we have a  stream-splitting  capability via a multicast subscription e.g. Bloom filtering consumer registers interest in content streams for fields A and B while Lucene40 is consolidating content from fields A, B, C and D. A broadcast mechanism feeds each consumer a copy of the relevant stream and each consumer is responsible for inventing their own file-naming convention that avoids muddling files. \\n\\n While that may help for writing streams it doesn\'t solve the re-assembly of \\\"producer\\\" streams at read-time where BloomFilter absolutely has to position itself in front of the standard Lucene40 producer in order to offer fast-fail lookups.  \\n\\n In the absence of a fancy optimised routing mechanism (this all may be overkill) my current solution was to put BloomFilter in the delegate chain armed with a subset of fieldnames to observe as a larger array of fields flow past to a common delegate. I added some Javadocs to describe the need to do it this way for an efficient configuration. \\nYou are right that this is messy (ie open to bad configuration) but operating this deep down in Lucene that\'s always a possibility regardless of what we put in place. \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286712\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286712&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286712\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286712_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286712_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 16:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T16:24:16+0000\'\u003e31\\/May\\/12 16:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003ebut overlapping choices of fields e.g we want a single Lucene40 to process all fields but we want Bloom to handle only a subset of these fields.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThats not true: I disagree. Its an implementation detail that Bloom as a postingsformat wraps another one (thats just the abstract implementation), and the file formats should not expose this in general for any format.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is true for a number of reasons: e.g. in the pulsing case the wrapped writer only gets a subset of the postings: therefore the wrapped writer\'s files are \\\"incomplete\\\" and an implementation detail.\u003c\\/p\u003e\\n\\n\u003cp\u003eits enough here that if you have 5 fields: 2 bloom and 3 not, that we detect there are only two postings formats in use, regardless of whether you have 2 or 5 actual object instances.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286712_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286712_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 16:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T16:24:16+0000\'\u003e31\\/May\\/12 16:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n but overlapping choices of fields e.g we want a single Lucene40 to process all fields but we want Bloom to handle only a subset of these fields.  \\n\\n Thats not true: I disagree. Its an implementation detail that Bloom as a postingsformat wraps another one (thats just the abstract implementation), and the file formats should not expose this in general for any format. \\n\\n This is true for a number of reasons: e.g. in the pulsing case the wrapped writer only gets a subset of the postings: therefore the wrapped writer\'s files are \\\"incomplete\\\" and an implementation detail. \\n\\n its enough here that if you have 5 fields: 2 bloom and 3 not, that we detect there are only two postings formats in use, regardless of whether you have 2 or 5 actual object instances.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286717\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286717&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286717\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286717_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286717_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 16:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T16:27:14+0000\'\u003e31\\/May\\/12 16:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAnd separately, you can always contain the number of files even today by:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eusing only unique instances yourself when writing (rather than waiting on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4093\\\" title=\\\"Implement better equals() on PostingsFormats where possible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4093\\\"\u003eLUCENE-4093\u003c\\/a\u003e)\u003c\\/li\u003e\\n\\t\u003cli\u003eusing the compound file format.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eThe purpose of \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4093\\\" title=\\\"Implement better equals() on PostingsFormats where possible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4093\\\"\u003eLUCENE-4093\u003c\\/a\u003e is just to make this simpler, but I opened it as a separate\u003cbr\\/\u003e\\nissue because its really solely an optimization, and only for a pretty rare case where\u003cbr\\/\u003e\\npeople are customizing the index format for different fields.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286717_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286717_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 16:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T16:27:14+0000\'\u003e31\\/May\\/12 16:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    And separately, you can always contain the number of files even today by: \\n \\n\\t using only unique instances yourself when writing (rather than waiting on  LUCENE-4093 ) \\n\\t using the compound file format. \\n \\n\\n\\n The purpose of  LUCENE-4093  is just to make this simpler, but I opened it as a separate \\nissue because its really solely an optimization, and only for a pretty rare case where \\npeople are customizing the index format for different fields.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286754\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286754&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286754\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286754_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286754_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 17:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T17:14:16+0000\'\u003e31\\/May\\/12 17:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIts true to say that Bloom is a different case to Pulsing - Bloom does not interfere in any with the normal recording of content in the wrapped delegate whereas Pulsing does.\u003cbr\\/\u003e\\nIt may prove useful for us to mark a formal distinction between these mutating\\/non mutating types so we can treat them differently and provide optimisations?\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eAnd separately, you can always contain the number of files even today by using only unique instances yourself when writing\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eContained but not optimal - roughly double the number of required files if I want the common case of a primary key indexed with Bloom. I can\'t see a way of indexing with Bloom-plus-Lucene40 on field \\\"A\\\" and indexing with just Lucene40 on fields B,C and D and winding up with only one Lucene40 set of files with a common segment suffix. The way I did find of achieving this was to add a \\\"bloomFilteredFields\\\" set into my single Bloom+Lucene40 instance used for all fields. Is there any other option here currently? \u003c\\/p\u003e\\n\\n\u003cp\u003eLooking to the future, 4093 may have more capabilities at optimising if it understands the distinction between mutating wrappers and non-mutating ones and how they are composed?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286754_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286754_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 17:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T17:14:16+0000\'\u003e31\\/May\\/12 17:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Its true to say that Bloom is a different case to Pulsing - Bloom does not interfere in any with the normal recording of content in the wrapped delegate whereas Pulsing does. \\nIt may prove useful for us to mark a formal distinction between these mutating\\/non mutating types so we can treat them differently and provide optimisations? \\n\\n\\n  And separately, you can always contain the number of files even today by using only unique instances yourself when writing  \\n\\n Contained but not optimal - roughly double the number of required files if I want the common case of a primary key indexed with Bloom. I can\'t see a way of indexing with Bloom-plus-Lucene40 on field \\\"A\\\" and indexing with just Lucene40 on fields B,C and D and winding up with only one Lucene40 set of files with a common segment suffix. The way I did find of achieving this was to add a \\\"bloomFilteredFields\\\" set into my single Bloom+Lucene40 instance used for all fields. Is there any other option here currently?  \\n\\n Looking to the future, 4093 may have more capabilities at optimising if it understands the distinction between mutating wrappers and non-mutating ones and how they are composed? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286756\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286756&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286756\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286756_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286756_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 17:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T17:17:37+0000\'\u003e31\\/May\\/12 17:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eContained but not optimal - roughly double the number of required files if I want the common case of a primary key indexed with Bloom.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThen use CFS, its optimal always (1). \u003c\\/p\u003e\\n\\n\u003cp\u003eI really dont think we should make this complex to save 2 or 3 files total (even in a complex config with many fields). Its not worth the complexity.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286756_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286756_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 17:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T17:17:37+0000\'\u003e31\\/May\\/12 17:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n Contained but not optimal - roughly double the number of required files if I want the common case of a primary key indexed with Bloom.  \\n\\n Then use CFS, its optimal always (1).  \\n\\n I really dont think we should make this complex to save 2 or 3 files total (even in a complex config with many fields). Its not worth the complexity.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286815\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286815&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286815\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286815_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286815_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 18:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T18:43:05+0000\'\u003e31\\/May\\/12 18:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIts not worth the complexity\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere\'s no real added complexity in BloomFilterPostingsFormat - it has to be capable of storing blooms for &gt;1 field anyway and using the fieldname set is roughly 2 extra lines of code to see if a TermsConsumer needs wrapping or not.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eFrom a client side you don\'t have to use this feature - the fieldname set can be null in which case it will wrap all fields sent its way. If you do chose to supply a set the wrapped PostingsFormat will have the advantage of being shared for bloomed and non-bloomed fields. We could add a constructor that removes the set and mark the others \\\"expert\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eFor me this falls into one of the many faster-if-you-know-about-it optimisations like FieldSelectors or recycling certain objects. Basically a useful hint to Lucene to save some extra effort but one which you dont \u003cb\u003eneed\u003c\\/b\u003e to use.\u003c\\/p\u003e\\n\\n\u003cp\u003eLucene-4093 may in future resolve the multi-file issue but I\'m not sure it will do so without significant complication.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286815_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286815_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 18:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T18:43:05+0000\'\u003e31\\/May\\/12 18:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Its not worth the complexity  \\n\\n There\'s no real added complexity in BloomFilterPostingsFormat - it has to be capable of storing blooms for &gt;1 field anyway and using the fieldname set is roughly 2 extra lines of code to see if a TermsConsumer needs wrapping or not. \\n\\n\\n From a client side you don\'t have to use this feature - the fieldname set can be null in which case it will wrap all fields sent its way. If you do chose to supply a set the wrapped PostingsFormat will have the advantage of being shared for bloomed and non-bloomed fields. We could add a constructor that removes the set and mark the others \\\"expert\\\". \\n\\n For me this falls into one of the many faster-if-you-know-about-it optimisations like FieldSelectors or recycling certain objects. Basically a useful hint to Lucene to save some extra effort but one which you dont  need  to use. \\n\\n Lucene-4093 may in future resolve the multi-file issue but I\'m not sure it will do so without significant complication.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286868\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286868&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286868\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13286868_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286868_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T19:42:42+0000\'\u003e31\\/May\\/12 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI really dont think we should make this complex to save 2 or 3 files total (even in a complex config with many fields). Its not worth the complexity.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree. I think those postings formats should only deal with encoding and not with handling certain fields different. A user \\/ app should handle this in the codec. Ideally you don\'t have any conditions in the relevant methods like termsConsumer etc. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eFor me this falls into one of the many faster-if-you-know-about-it optimisations like FieldSelectors or recycling certain objects. Basically a useful hint to Lucene to save some extra effort but one which you dont need to use.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ewhy is this a speed improvement? reading from one file vs. multiple is not really faster though.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, I think we should make this patch as simple as possible and don\'t handle fields in the PF. We can still open another issue or wait until \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4093\\\" title=\\\"Implement better equals() on PostingsFormats where possible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4093\\\"\u003eLUCENE-4093\u003c\\/a\u003e is in to discuss this issue?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13286868_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286868_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 19:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T19:42:42+0000\'\u003e31\\/May\\/12 19:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I really dont think we should make this complex to save 2 or 3 files total (even in a complex config with many fields). Its not worth the complexity.  \\n\\n I agree. I think those postings formats should only deal with encoding and not with handling certain fields different. A user \\/ app should handle this in the codec. Ideally you don\'t have any conditions in the relevant methods like termsConsumer etc.  \\n\\n  For me this falls into one of the many faster-if-you-know-about-it optimisations like FieldSelectors or recycling certain objects. Basically a useful hint to Lucene to save some extra effort but one which you dont need to use.  \\n\\n why is this a speed improvement? reading from one file vs. multiple is not really faster though. \\n\\n Anyway, I think we should make this patch as simple as possible and don\'t handle fields in the PF. We can still open another issue or wait until  LUCENE-4093  is in to discuss this issue?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286882\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286882&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286882\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286882_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286882_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 19:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T19:59:10+0000\'\u003e31\\/May\\/12 19:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eFor me this falls into one of the many faster-if-you-know-about-it optimisations like FieldSelectors or recycling certain objects. Basically a useful hint to Lucene to save some extra effort but one which you dont need to use.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI agree with Simon, its not going to be faster.\u003c\\/p\u003e\\n\\n\u003cp\u003eWorse, it creates a situation from the per-field perspective where multiple postings formats are sharing the same files for a segment.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis would make it harder to do things like refactorings of codec apis in the future.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo where is the benefit?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13286882_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286882_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 19:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T19:59:10+0000\'\u003e31\\/May\\/12 19:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n For me this falls into one of the many faster-if-you-know-about-it optimisations like FieldSelectors or recycling certain objects. Basically a useful hint to Lucene to save some extra effort but one which you dont need to use.  \\n\\n I agree with Simon, its not going to be faster. \\n\\n Worse, it creates a situation from the per-field perspective where multiple postings formats are sharing the same files for a segment. \\n\\n This would make it harder to do things like refactorings of codec apis in the future. \\n\\n So where is the benefit?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286916\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286916&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286916\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286916_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286916_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 20:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T20:44:52+0000\'\u003e31\\/May\\/12 20:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ewhy is this a speed improvement?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSorry - misleading. Replace the word \\\"faster\\\" in my comment with \\\"better\\\" and that makes more sense - I mean better in terms of resource usage and reduced open file handles. This seemed relevant given the earlier comments about Solr\'s use of non-compound files:\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e\u003cspan class=\\\"error\\\"\u003e&#91;Solr&#93;\u003c\\/span\u003e create massive amounts of files if we did so (add to the fact it disables compound files by default and its a disaster...)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI can see there is a useful simplification being sought for here if PerFieldPF can consider each of the unique top-level PFs presented to it as looking after an exclusive set of files. As the centralised allocator of file names it can then simply call each unique PF with a choice of segment suffix to name its various files without conflicting with other PFs. Lucene 4093 is all about better determining which PF is unique using .equals(). Unfortunately I don\'t think this approach is sufficiently complex. In order to avoid allocating all unnecessary file names PerFieldPF would have to further understand the nuances of which PFs were being wrapped by other PFs and which wrapped PFs would be reusable outside of their wrapped PF (as is the case with BloomPF\'s wrapped PF). That seems a more complex task than implementing equals(). \u003c\\/p\u003e\\n\\n\u003cp\u003eSo it seems we have 3 options:\u003cbr\\/\u003e\\n1) Ignore the problems of creating too many files in the case of BloomPF and any other examples of \\\"wrapping\\\" PFs\u003cbr\\/\u003e\\n2) Create a PerFieldPF implementation that reuses wrapped PFs using some generic means of discovering recyclable wrapped PFs (i.e go further than what 4093 currently proposes in adding .equals support)\u003cbr\\/\u003e\\n3) Retain my BloomPF-specific solution to the problem for those prepared to use lower-level APIs.\u003c\\/p\u003e\\n\\n\u003cp\u003eAm I missing any other options and which one do you want to go for?\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13286916_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286916_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 20:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T20:44:52+0000\'\u003e31\\/May\\/12 20:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     why is this a speed improvement?  \\n\\n Sorry - misleading. Replace the word \\\"faster\\\" in my comment with \\\"better\\\" and that makes more sense - I mean better in terms of resource usage and reduced open file handles. This seemed relevant given the earlier comments about Solr\'s use of non-compound files: \\n\\n   &#91;Solr&#93;  create massive amounts of files if we did so (add to the fact it disables compound files by default and its a disaster...)  \\n\\n I can see there is a useful simplification being sought for here if PerFieldPF can consider each of the unique top-level PFs presented to it as looking after an exclusive set of files. As the centralised allocator of file names it can then simply call each unique PF with a choice of segment suffix to name its various files without conflicting with other PFs. Lucene 4093 is all about better determining which PF is unique using .equals(). Unfortunately I don\'t think this approach is sufficiently complex. In order to avoid allocating all unnecessary file names PerFieldPF would have to further understand the nuances of which PFs were being wrapped by other PFs and which wrapped PFs would be reusable outside of their wrapped PF (as is the case with BloomPF\'s wrapped PF). That seems a more complex task than implementing equals().  \\n\\n So it seems we have 3 options: \\n1) Ignore the problems of creating too many files in the case of BloomPF and any other examples of \\\"wrapping\\\" PFs \\n2) Create a PerFieldPF implementation that reuses wrapped PFs using some generic means of discovering recyclable wrapped PFs (i.e go further than what 4093 currently proposes in adding .equals support) \\n3) Retain my BloomPF-specific solution to the problem for those prepared to use lower-level APIs. \\n\\n Am I missing any other options and which one do you want to go for? \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13286926\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13286926&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13286926\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13286926_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286926_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T20:54:30+0000\'\u003e31\\/May\\/12 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Simon Willnauer - 31\\/May\\/12 20:57\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThis seemed relevant given the earlier comments about Solr\'s use of non-compound files:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWe can\'t make \\\"wrong\\\" decisions just because higher level apps make \\\"wrong\\\" decisions. The dependency goes Solr -&gt; Lucene not the other way around. We provide fine grained control when to use CFS ie for smallish segments etc. If you have hundreds of fields all using different PF etc. you have to deal with tons of files but that is to be honest not very likely to be the common case.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eCreate a PerFieldPF implementation that reuses wrapped PFs using some generic means of discovering recyclable wrapped PFs (i.e go further than what 4093 currently proposes in adding .equals support)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we should investigate this further. Lets keep this issue simple and remove the field handling and fix this on a higher level!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"simonw\\\" id=\\\"commentauthor_13286926_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=simonw\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"simonw\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Simon Willnauer\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13286926_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'31\\/May\\/12 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-05-31T20:54:30+0000\'\u003e31\\/May\\/12 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Simon Willnauer - 31\\/May\\/12 20:57\\\"\u003eedited\u003c\\/span\u003e                    This seemed relevant given the earlier comments about Solr\'s use of non-compound files:  \\n We can\'t make \\\"wrong\\\" decisions just because higher level apps make \\\"wrong\\\" decisions. The dependency goes Solr -&gt; Lucene not the other way around. We provide fine grained control when to use CFS ie for smallish segments etc. If you have hundreds of fields all using different PF etc. you have to deal with tons of files but that is to be honest not very likely to be the common case. \\n\\n  Create a PerFieldPF implementation that reuses wrapped PFs using some generic means of discovering recyclable wrapped PFs (i.e go further than what 4093 currently proposes in adding .equals support)  \\n\\n I think we should investigate this further. Lets keep this issue simple and remove the field handling and fix this on a higher level!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13287258\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13287258&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13287258\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13287258_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13287258_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Jun\\/12 08:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-01T08:12:50+0000\'\u003e01\\/Jun\\/12 08:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve thought some more about option 2 (PerFieldPF reusing wrapped PFs) and it looks to get very ugly very quickly.\u003cbr\\/\u003e\\nThere\'s only so much PerFieldPF can do to rationalize a random jumble of PF instances presented to it by clients. I think the right place to draw the line is Lucene-4093 i.e. a simple .equals() comparison on top-level PFs to eliminate any duplicates. Any other approach that also tries to de-dup nested PFs looks to be adding a lot of complexity, especially when you consider what that does to the model of read-time object instantiation. This would be significant added complexity to solve a problem you have already suggested is insignificant (i.e. too many files doesn\'t really matter when using CFS).\u003c\\/p\u003e\\n\\n\u003cp\u003eI can remove the per-field stuff from BloomPF if you want but I imagine I will routinely subclass it to add this optimisation back in to my apps.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13287258_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13287258_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Jun\\/12 08:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-01T08:12:50+0000\'\u003e01\\/Jun\\/12 08:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve thought some more about option 2 (PerFieldPF reusing wrapped PFs) and it looks to get very ugly very quickly. \\nThere\'s only so much PerFieldPF can do to rationalize a random jumble of PF instances presented to it by clients. I think the right place to draw the line is Lucene-4093 i.e. a simple .equals() comparison on top-level PFs to eliminate any duplicates. Any other approach that also tries to de-dup nested PFs looks to be adding a lot of complexity, especially when you consider what that does to the model of read-time object instantiation. This would be significant added complexity to solve a problem you have already suggested is insignificant (i.e. too many files doesn\'t really matter when using CFS). \\n\\n I can remove the per-field stuff from BloomPF if you want but I imagine I will routinely subclass it to add this optimisation back in to my apps. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13291876\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13291876&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13291876\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13291876_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13291876_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/12 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-08T17:44:38+0000\'\u003e08\\/Jun\\/12 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated as follows:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eExtracted Bloom filter functionality as new oal.util.FuzzySet class - the name is changed because Bloom filtering is one application for a FuzzySet, fuzzy count distincts being another.\u003c\\/li\u003e\\n\\t\u003cli\u003eBloomFilterPostingsFormat now take a factory that can tailor choice of BloomFilter per field (bitset size\\/saturation settings and choice of hash algo). Provided a default factory implementation.\u003c\\/li\u003e\\n\\t\u003cli\u003eAll Unit tests pass now that I have a test PostingsFormat class that uses v small bitsets where before the many-field unit tests would cause OOM.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eWill follow up with benchmarks when I have more time to run and document them. Initial results from my large-scale tests on growing indexes show a nice flat line in the face of a growing index whereas a non-Bloomed index saw-tooths upwards as segments grow\\/merge.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13291876_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13291876_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/12 17:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-08T17:44:38+0000\'\u003e08\\/Jun\\/12 17:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated as follows: \\n \\n\\t Extracted Bloom filter functionality as new oal.util.FuzzySet class - the name is changed because Bloom filtering is one application for a FuzzySet, fuzzy count distincts being another. \\n\\t BloomFilterPostingsFormat now take a factory that can tailor choice of BloomFilter per field (bitset size\\/saturation settings and choice of hash algo). Provided a default factory implementation. \\n\\t All Unit tests pass now that I have a test PostingsFormat class that uses v small bitsets where before the many-field unit tests would cause OOM. \\n \\n\\n\\n Will follow up with benchmarks when I have more time to run and document them. Initial results from my large-scale tests on growing indexes show a nice flat line in the face of a growing index whereas a non-Bloomed index saw-tooths upwards as segments grow\\/merge.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13291879\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13291879&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13291879\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13291879_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13291879_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/12 17:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-08T17:47:07+0000\'\u003e08\\/Jun\\/12 17:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBenchmark tool adapted from Mike\'s original Pulsing codec benchmark. Now includes Bloom postings example.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13291879_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13291879_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Jun\\/12 17:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-08T17:47:07+0000\'\u003e08\\/Jun\\/12 17:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Benchmark tool adapted from Mike\'s original Pulsing codec benchmark. Now includes Bloom postings example.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295748\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13295748&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295748\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13295748_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295748_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/12 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-15T16:23:49+0000\'\u003e15\\/Jun\\/12 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran a benchmark on 10 M Wikipedia index; for the factory I used createSetBasedOnMemory and passed it 100 MB; I think that\'s enough to ensure we get the 10% saturation on save ...:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n              Fuzzy1      102.47        3.67       41.95        0.78  -61% -  -56%\\n              Fuzzy2       38.36        1.76       18.68        0.37  -54% -  -47%\\n             Respell       89.89        4.38       44.09        0.52  -53% -  -47%\\n            Wildcard       40.48        2.82       36.20        0.64  -17% -   -2%\\n        SloppyPhrase        7.96        0.28        8.07        0.07   -3% -    5%\\n             Prefix3       61.94        5.34       63.35        0.37   -6% -   12%\\n        TermBGroup1M       71.37        6.79       73.73        1.55   -7% -   16%\\n          AndHighMed       64.09        5.51       66.73        1.75   -6% -   16%\\n      TermBGroup1M1P       49.55        3.78       51.75        2.67   -7% -   18%\\n         AndHighHigh       16.05        1.12       16.77        0.53   -5% -   15%\\n         TermGroup1M       35.87        3.07       37.56        0.74   -5% -   16%\\n          OrHighHigh        9.60        1.38       10.15        0.65  -13% -   31%\\n           OrHighMed       11.93        1.91       12.63        0.93  -15% -   35%\\n              IntNRQ        9.12        1.25        9.68        0.11   -7% -   24%\\n                Term      154.55       19.60      165.32        0.97   -5% -   23%\\n              Phrase       11.40        0.33       12.21        0.18    2% -   11%\\n            SpanNear        4.31        0.07        4.73        0.03    7% -   12%\\n            PKLookup      122.78        1.42      145.95        5.22   13% -   24%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eBaseline is Lucene40 PostingsFormat even for the id field ... so PKLookup gets a good improvement.  This is on an index w\\/ 5 segments at each level.\u003c\\/p\u003e\\n\\n\u003cp\u003eOther queries seem to speed up as well (eg Term, Or*).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe queries that rely on Terms.intersect got much worse: is the BloomFilteredFieldsProducer should just pass through intersect to the delegate?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13295748_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295748_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/12 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-15T16:23:49+0000\'\u003e15\\/Jun\\/12 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran a benchmark on 10 M Wikipedia index; for the factory I used createSetBasedOnMemory and passed it 100 MB; I think that\'s enough to ensure we get the 10% saturation on save ...: \\n\\n  \\n                 Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n              Fuzzy1      102.47        3.67       41.95        0.78  -61% -  -56%\\n              Fuzzy2       38.36        1.76       18.68        0.37  -54% -  -47%\\n             Respell       89.89        4.38       44.09        0.52  -53% -  -47%\\n            Wildcard       40.48        2.82       36.20        0.64  -17% -   -2%\\n        SloppyPhrase        7.96        0.28        8.07        0.07   -3% -    5%\\n             Prefix3       61.94        5.34       63.35        0.37   -6% -   12%\\n        TermBGroup1M       71.37        6.79       73.73        1.55   -7% -   16%\\n          AndHighMed       64.09        5.51       66.73        1.75   -6% -   16%\\n      TermBGroup1M1P       49.55        3.78       51.75        2.67   -7% -   18%\\n         AndHighHigh       16.05        1.12       16.77        0.53   -5% -   15%\\n         TermGroup1M       35.87        3.07       37.56        0.74   -5% -   16%\\n          OrHighHigh        9.60        1.38       10.15        0.65  -13% -   31%\\n           OrHighMed       11.93        1.91       12.63        0.93  -15% -   35%\\n              IntNRQ        9.12        1.25        9.68        0.11   -7% -   24%\\n                Term      154.55       19.60      165.32        0.97   -5% -   23%\\n              Phrase       11.40        0.33       12.21        0.18    2% -   11%\\n            SpanNear        4.31        0.07        4.73        0.03    7% -   12%\\n            PKLookup      122.78        1.42      145.95        5.22   13% -   24%\\n \\n  \\n\\n Baseline is Lucene40 PostingsFormat even for the id field ... so PKLookup gets a good improvement.  This is on an index w\\/ 5 segments at each level. \\n\\n Other queries seem to speed up as well (eg Term, Or*). \\n\\n The queries that rely on Terms.intersect got much worse: is the BloomFilteredFieldsProducer should just pass through intersect to the delegate?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13395773\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13395773&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13395773\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13395773_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395773_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 09:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T09:48:50+0000\'\u003e18\\/Jun\\/12 09:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eInteresting results, Mike - thanks for taking the time to run them.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBloomFilteredFieldsProducer should just pass through intersect to the delegate?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI have tried to make the BloomFilteredFieldsProducer get out of the way of the client app and the delegate PostingsFormat as soon as it is safe to do so i.e. when the user is safely focused on a non-filtered field. While there is a chance the client may end up making a call to TermsEnum.seekExact(..) on a filtered field then I need to have a wrapper object in place which is in a position to intercept this call. In all other method invocations I just end up delegating calls so I wonder if all these extra method calls are the cause of the slowdown you see e.g. when Fuzzy is enumerating over many terms. \u003cbr\\/\u003e\\nThe only other alternatives to endlessly wrapping in this way are:\u003cbr\\/\u003e\\na) API change - e.g. allow TermsEnum.seekExact to have a pluggable call-out for just this one method.\u003cbr\\/\u003e\\nb) Mess around with byte-code manipulation techniques to weave in Bloom filtering(the sort of thing I recall Hibernate resorts to)\u003c\\/p\u003e\\n\\n\u003cp\u003eNeither of these seem particularly appealing options so I think we may have to live with fuzzy+bloom not being as fast as straight fuzzy.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor completeness sake - I don\'t have access to your benchmarking code but I would hope that PostingsFormat.fieldsProducer() isn\'t called more than once for the same segment as that\'s where the Bloom filters get loaded from disk so there\'s inherent cost there too. I can\'t imagine this is the case.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW I\'ve just finished a long-running set of tests which mixes up reads and writes here: \u003ca href=\\\"http:\\/\\/goo.gl\\/KJmGv\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/goo.gl\\/KJmGv\u003c\\/a\u003e\u003cbr\\/\u003e\\nThis benchmark represents how graph databases such as Neo4j use Lucene for an index when loading (I typically use the Wikipedia links as a test set). I look to get a 3.5 x speed up in Lucene 4 and Lucene 3.6 gets nearly 9 x speedup over the comparatively slower 3.6 codebase.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13395773_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395773_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 09:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T09:48:50+0000\'\u003e18\\/Jun\\/12 09:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Interesting results, Mike - thanks for taking the time to run them. \\n\\n  BloomFilteredFieldsProducer should just pass through intersect to the delegate?  \\n\\n I have tried to make the BloomFilteredFieldsProducer get out of the way of the client app and the delegate PostingsFormat as soon as it is safe to do so i.e. when the user is safely focused on a non-filtered field. While there is a chance the client may end up making a call to TermsEnum.seekExact(..) on a filtered field then I need to have a wrapper object in place which is in a position to intercept this call. In all other method invocations I just end up delegating calls so I wonder if all these extra method calls are the cause of the slowdown you see e.g. when Fuzzy is enumerating over many terms.  \\nThe only other alternatives to endlessly wrapping in this way are: \\na) API change - e.g. allow TermsEnum.seekExact to have a pluggable call-out for just this one method. \\nb) Mess around with byte-code manipulation techniques to weave in Bloom filtering(the sort of thing I recall Hibernate resorts to) \\n\\n Neither of these seem particularly appealing options so I think we may have to live with fuzzy+bloom not being as fast as straight fuzzy. \\n\\n For completeness sake - I don\'t have access to your benchmarking code but I would hope that PostingsFormat.fieldsProducer() isn\'t called more than once for the same segment as that\'s where the Bloom filters get loaded from disk so there\'s inherent cost there too. I can\'t imagine this is the case. \\n\\n BTW I\'ve just finished a long-running set of tests which mixes up reads and writes here:  http:\\/\\/goo.gl\\/KJmGv  \\nThis benchmark represents how graph databases such as Neo4j use Lucene for an index when loading (I typically use the Wikipedia links as a test set). I look to get a 3.5 x speed up in Lucene 4 and Lucene 3.6 gets nearly 9 x speedup over the comparatively slower 3.6 codebase.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13395830\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13395830&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13395830\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13395830_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395830_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 11:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T11:41:51+0000\'\u003e18\\/Jun\\/12 11:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eInteresting results, Mike - thanks for taking the time to run them.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYou\'re welcome!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eBloomFilteredFieldsProducer should just pass through intersect to the delegate?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI have tried to make the BloomFilteredFieldsProducer get out of the way of the client app and the delegate PostingsFormat as soon as it is safe to do so i.e. when the user is safely focused on a non-filtered field. While there is a chance the client may end up making a call to TermsEnum.seekExact(..) on a filtered field then I need to have a wrapper object in place which is in a position to intercept this call. In all other method invocations I just end up delegating calls so I wonder if all these extra method calls are the cause of the slowdown you see e.g. when Fuzzy is enumerating over many terms. \u003cbr\\/\u003e\\n The only other alternatives to endlessly wrapping in this way are:\u003cbr\\/\u003e\\n a) API change - e.g. allow TermsEnum.seekExact to have a pluggable call-out for just this one method.\u003cbr\\/\u003e\\n b) Mess around with byte-code manipulation techniques to weave in Bloom filtering(the sort of thing I recall Hibernate resorts to)\u003c\\/p\u003e\\n\\n\u003cp\u003eNeither of these seem particularly appealing options so I think we may have to live with fuzzy+bloom not being as fast as straight fuzzy.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think the fix is simple: you are not overriding Terms.intersect now,\u003cbr\\/\u003e\\nin BloomFilteredTerms.  I think you should override it and immediately\u003cbr\\/\u003e\\ndelegate and then FuzzyN\\/Respell performance should be just as good as\u003cbr\\/\u003e\\nLucene40 codec.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eFor completeness sake - I don\'t have access to your benchmarking code\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAll the benchmarking code is here: \u003ca href=\\\"http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI run it nightly (trunk) and publish the results here: \u003ca href=\\\"http:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ebut I would hope that PostingsFormat.fieldsProducer() isn\'t called more than once for the same segment as that\'s where the Bloom filters get loaded from disk so there\'s inherent cost there too. I can\'t imagine this is the case.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt\'s only called once on init\'ing the SegmentReader (or at least it\u003cbr\\/\u003e\\nbetter be!).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eBTW I\'ve just finished a long-running set of tests which mixes up reads and writes here: \u003ca href=\\\"http:\\/\\/goo.gl\\/KJmGv\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/goo.gl\\/KJmGv\u003c\\/a\u003e\u003cbr\\/\u003e\\n This benchmark represents how graph databases such as Neo4j use Lucene for an index when loading (I typically use the Wikipedia links as a test set). I look to get a 3.5 x speed up in Lucene 4 and Lucene 3.6 gets nearly 9 x speedup over the comparatively slower 3.6 codebase.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNice results!  It looks like bloom(3.6) is faster than bloom(4.0)?\u003cbr\\/\u003e\\nWhy is that...\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso I wonder why you see such sizable (3.5X speedup) gains on PK\u003cbr\\/\u003e\\nlookup but in my benchmark I see only ~13% - 24%.  My index has 5\u003cbr\\/\u003e\\nsegments per level...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13395830_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395830_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 11:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T11:41:51+0000\'\u003e18\\/Jun\\/12 11:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Interesting results, Mike - thanks for taking the time to run them.  \\n\\n You\'re welcome! \\n\\n \\n  BloomFilteredFieldsProducer should just pass through intersect to the delegate?  \\n\\n I have tried to make the BloomFilteredFieldsProducer get out of the way of the client app and the delegate PostingsFormat as soon as it is safe to do so i.e. when the user is safely focused on a non-filtered field. While there is a chance the client may end up making a call to TermsEnum.seekExact(..) on a filtered field then I need to have a wrapper object in place which is in a position to intercept this call. In all other method invocations I just end up delegating calls so I wonder if all these extra method calls are the cause of the slowdown you see e.g. when Fuzzy is enumerating over many terms.  \\n The only other alternatives to endlessly wrapping in this way are: \\n a) API change - e.g. allow TermsEnum.seekExact to have a pluggable call-out for just this one method. \\n b) Mess around with byte-code manipulation techniques to weave in Bloom filtering(the sort of thing I recall Hibernate resorts to) \\n\\n Neither of these seem particularly appealing options so I think we may have to live with fuzzy+bloom not being as fast as straight fuzzy.  \\n\\n I think the fix is simple: you are not overriding Terms.intersect now, \\nin BloomFilteredTerms.  I think you should override it and immediately \\ndelegate and then FuzzyN\\/Respell performance should be just as good as \\nLucene40 codec. \\n\\n  For completeness sake - I don\'t have access to your benchmarking code  \\n\\n All the benchmarking code is here:  http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/  \\n\\n I run it nightly (trunk) and publish the results here:  http:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/  \\n\\n  but I would hope that PostingsFormat.fieldsProducer() isn\'t called more than once for the same segment as that\'s where the Bloom filters get loaded from disk so there\'s inherent cost there too. I can\'t imagine this is the case.  \\n\\n It\'s only called once on init\'ing the SegmentReader (or at least it \\nbetter be!). \\n\\n \\n BTW I\'ve just finished a long-running set of tests which mixes up reads and writes here:  http:\\/\\/goo.gl\\/KJmGv  \\n This benchmark represents how graph databases such as Neo4j use Lucene for an index when loading (I typically use the Wikipedia links as a test set). I look to get a 3.5 x speed up in Lucene 4 and Lucene 3.6 gets nearly 9 x speedup over the comparatively slower 3.6 codebase.  \\n\\n Nice results!  It looks like bloom(3.6) is faster than bloom(4.0)? \\nWhy is that... \\n\\n Also I wonder why you see such sizable (3.5X speedup) gains on PK \\nlookup but in my benchmark I see only ~13% - 24%.  My index has 5 \\nsegments per level...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13395857\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13395857&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13395857\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13395857_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395857_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 12:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T12:25:26+0000\'\u003e18\\/Jun\\/12 12:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think the fix is simple: you are not overriding Terms.intersect now, in BloomFilteredTerms\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eGood catch - a quick test indeed shows a speed up on fuzzy queries. \u003cbr\\/\u003e\\nI\'ll prepare a new patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not sure on why 3.6+Bloom is faster than 4+Bloom in my tests. I\'ll take a closer look at your benchmark.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13395857_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395857_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 12:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T12:25:26+0000\'\u003e18\\/Jun\\/12 12:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think the fix is simple: you are not overriding Terms.intersect now, in BloomFilteredTerms  \\n\\n Good catch - a quick test indeed shows a speed up on fuzzy queries.  \\nI\'ll prepare a new patch. \\n\\n I\'m not sure on why 3.6+Bloom is faster than 4+Bloom in my tests. I\'ll take a closer look at your benchmark.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13395953\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13395953&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13395953\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13395953_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395953_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T15:20:36+0000\'\u003e18\\/Jun\\/12 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch with Terms.intersect overridden for faster Fuzzy queries.\u003cbr\\/\u003e\\nDidn\'t get too far with running the Wikipedia perf tests due to missing data file (see \u003ca href=\\\"http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/issues\\/detail?id=7\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/issues\\/detail?id=7\u003c\\/a\u003e )\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13395953_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395953_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 15:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T15:20:36+0000\'\u003e18\\/Jun\\/12 15:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch with Terms.intersect overridden for faster Fuzzy queries. \\nDidn\'t get too far with running the Wikipedia perf tests due to missing data file (see  http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/issues\\/detail?id=7  )              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13395980\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13395980&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13395980\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13395980_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395980_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T16:01:31+0000\'\u003e18\\/Jun\\/12 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eDidn\'t get too far with running the Wikipedia perf tests due to missing data file (see \u003ca href=\\\"http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/issues\\/detail?id=7\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/issues\\/detail?id=7\u003c\\/a\u003e )\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWoops sorry: I posted a comment there (new, more recent wikipedia export).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13395980_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13395980_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Jun\\/12 16:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-18T16:01:31+0000\'\u003e18\\/Jun\\/12 16:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Didn\'t get too far with running the Wikipedia perf tests due to missing data file (see  http:\\/\\/code.google.com\\/a\\/apache-extras.org\\/p\\/luceneutil\\/issues\\/detail?id=7  )  \\n\\n Woops sorry: I posted a comment there (new, more recent wikipedia export).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13396934\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13396934&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13396934\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13396934_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13396934_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T17:09:29+0000\'\u003e19\\/Jun\\/12 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMike, currently having various issues getting this benchmark framework up and running on my Windows platform here - is it easy for you to kick off another run with the latest patch on your setup? The latest change to the patch shouldn\'t require an index rebuild from your last run.\u003c\\/p\u003e\\n\\n\u003cp\u003eNo worries if this is too much hassle for you - I\'ll probably just try switch to testing on OSX at home.\u003c\\/p\u003e\\n\\n\u003cp\u003eCheers,\u003cbr\\/\u003e\\nMark\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13396934_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13396934_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 17:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T17:09:29+0000\'\u003e19\\/Jun\\/12 17:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mike, currently having various issues getting this benchmark framework up and running on my Windows platform here - is it easy for you to kick off another run with the latest patch on your setup? The latest change to the patch shouldn\'t require an index rebuild from your last run. \\n\\n No worries if this is too much hassle for you - I\'ll probably just try switch to testing on OSX at home. \\n\\n Cheers, \\nMark              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397010\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397010&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397010\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397010_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397010_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 19:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T19:38:06+0000\'\u003e19\\/Jun\\/12 19:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMike, currently having various issues getting this benchmark framework up and running on my Windows platform here\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAlas it\'s not easy ... please report back on how to make it easier to set up!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eis it easy for you to kick off another run with the latest patch on your setup?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo problem: I\'ll run perf test again.  It\'s easy...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397010_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397010_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 19:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T19:38:06+0000\'\u003e19\\/Jun\\/12 19:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Mike, currently having various issues getting this benchmark framework up and running on my Windows platform here  \\n\\n Alas it\'s not easy ... please report back on how to make it easier to set up! \\n\\n  is it easy for you to kick off another run with the latest patch on your setup?  \\n\\n No problem: I\'ll run perf test again.  It\'s easy...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397054\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397054&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397054\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13397054_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397054_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 20:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T20:41:44+0000\'\u003e19\\/Jun\\/12 20:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eproblem: I\'ll run perf test again. It\'s easy...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eGreat, thanks.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlas it\'s not easy ... please report back on how to make it easier to set up!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMy Windows-based woes were:\u003cbr\\/\u003e\\n1) Had to install python (used 2.7)\u003cbr\\/\u003e\\n2) Figure out python proxy settings for Wikipedia download\u003cbr\\/\u003e\\n3) PySVN missing - downloaded install exe but it claimed Python 2.7 wasn\'t installed\\/available so gave up and did svn checkout manually\u003cbr\\/\u003e\\n4) Ran first python test and it aborted with complaint about GnuPlot missing\u003c\\/p\u003e\\n\\n\u003cp\u003eI imagine most of what is needed here comes out of the box on typical OSX\\/Linux setup.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13397054_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397054_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 20:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T20:41:44+0000\'\u003e19\\/Jun\\/12 20:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     problem: I\'ll run perf test again. It\'s easy...  \\n\\n Great, thanks. \\n\\n  Alas it\'s not easy ... please report back on how to make it easier to set up!  \\n\\n My Windows-based woes were: \\n1) Had to install python (used 2.7) \\n2) Figure out python proxy settings for Wikipedia download \\n3) PySVN missing - downloaded install exe but it claimed Python 2.7 wasn\'t installed\\/available so gave up and did svn checkout manually \\n4) Ran first python test and it aborted with complaint about GnuPlot missing \\n\\n I imagine most of what is needed here comes out of the box on typical OSX\\/Linux setup. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397082\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397082&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397082\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397082_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397082_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T21:35:18+0000\'\u003e19\\/Jun\\/12 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eResults from last patch:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n              IntNRQ       11.35        1.27       10.14        0.62  -24% -    6%\\n              Fuzzy1      108.52        3.34      101.82        2.90  -11% -    0%\\n             Prefix3       64.87        2.17       61.55        1.61  -10% -    0%\\n            Wildcard       43.18        1.74       41.33        1.17  -10% -    2%\\n              Fuzzy2       41.76        1.40       40.05        1.00   -9% -    1%\\n                Term      151.71        4.38      147.24        4.42   -8% -    2%\\n            SpanNear        5.23        0.09        5.11        0.12   -6% -    1%\\n           OrHighMed       12.60        0.88       12.34        0.48  -11% -    9%\\n        SloppyPhrase        8.25        0.20        8.09        0.07   -5% -    1%\\n        TermBGroup1M       69.98        0.68       68.80        1.13   -4% -    0%\\n          OrHighHigh       10.06        0.66        9.93        0.39  -11% -    9%\\n              Phrase       12.73        0.30       12.57        0.35   -6% -    3%\\n         TermGroup1M       35.44        0.42       35.08        0.67   -4% -    2%\\n          AndHighMed       63.40        2.27       62.90        1.11   -5% -    4%\\n             Respell       93.11        3.70       92.81        2.33   -6% -    6%\\n      TermBGroup1M1P       50.93        1.53       50.96        1.75   -6% -    6%\\n         AndHighHigh       15.86        0.71       15.93        0.27   -5% -    6%\\n            PKLookup      127.44        2.15      134.85        8.68   -2% -   14%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eLooks like FuzzyN\\/Respell is good again ... PKLookup is a bit faster ... the rest is likely noise.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397082_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397082_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 21:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T21:35:18+0000\'\u003e19\\/Jun\\/12 21:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Results from last patch: \\n  \\n                 Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n              IntNRQ       11.35        1.27       10.14        0.62  -24% -    6%\\n              Fuzzy1      108.52        3.34      101.82        2.90  -11% -    0%\\n             Prefix3       64.87        2.17       61.55        1.61  -10% -    0%\\n            Wildcard       43.18        1.74       41.33        1.17  -10% -    2%\\n              Fuzzy2       41.76        1.40       40.05        1.00   -9% -    1%\\n                Term      151.71        4.38      147.24        4.42   -8% -    2%\\n            SpanNear        5.23        0.09        5.11        0.12   -6% -    1%\\n           OrHighMed       12.60        0.88       12.34        0.48  -11% -    9%\\n        SloppyPhrase        8.25        0.20        8.09        0.07   -5% -    1%\\n        TermBGroup1M       69.98        0.68       68.80        1.13   -4% -    0%\\n          OrHighHigh       10.06        0.66        9.93        0.39  -11% -    9%\\n              Phrase       12.73        0.30       12.57        0.35   -6% -    3%\\n         TermGroup1M       35.44        0.42       35.08        0.67   -4% -    2%\\n          AndHighMed       63.40        2.27       62.90        1.11   -5% -    4%\\n             Respell       93.11        3.70       92.81        2.33   -6% -    6%\\n      TermBGroup1M1P       50.93        1.53       50.96        1.75   -6% -    6%\\n         AndHighHigh       15.86        0.71       15.93        0.27   -5% -    6%\\n            PKLookup      127.44        2.15      134.85        8.68   -2% -   14%\\n \\n  \\n\\n Looks like FuzzyN\\/Respell is good again ... PKLookup is a bit faster ... the rest is likely noise.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397173\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397173&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397173\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397173_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397173_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T23:54:26+0000\'\u003e19\\/Jun\\/12 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eMy Windows-based woes were:\u003cbr\\/\u003e\\n 1) Had to install python (used 2.7)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e2) Figure out python proxy settings for Wikipedia download\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmmm ... you can also manually download separately.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e3) PySVN missing - downloaded install exe but it claimed Python 2.7 wasn\'t installed\\/available so gave up and did svn checkout manually\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOh I see: setup.py uses PySVN; hmm.  Just checking out manually is better...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e4) Ran first python test and it aborted with complaint about GnuPlot missing\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm we should default printIndexCharts to False (I\'ll fix).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI imagine most of what is needed here comes out of the box on typical OSX\\/Linux setup.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm I don\'t think pysvn does, nor gnuplot ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397173_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397173_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T23:54:26+0000\'\u003e19\\/Jun\\/12 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n My Windows-based woes were: \\n 1) Had to install python (used 2.7)  \\n\\n OK. \\n\\n  2) Figure out python proxy settings for Wikipedia download  \\n\\n Hmmm ... you can also manually download separately. \\n\\n  3) PySVN missing - downloaded install exe but it claimed Python 2.7 wasn\'t installed\\/available so gave up and did svn checkout manually  \\n\\n Oh I see: setup.py uses PySVN; hmm.  Just checking out manually is better... \\n\\n  4) Ran first python test and it aborted with complaint about GnuPlot missing  \\n\\n Hmm we should default printIndexCharts to False (I\'ll fix). \\n\\n  I imagine most of what is needed here comes out of the box on typical OSX\\/Linux setup.  \\n\\n Hmm I don\'t think pysvn does, nor gnuplot ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397174\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397174&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397174\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397174_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397174_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T23:54:26+0000\'\u003e19\\/Jun\\/12 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eMy Windows-based woes were:\u003cbr\\/\u003e\\n 1) Had to install python (used 2.7)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e2) Figure out python proxy settings for Wikipedia download\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmmm ... you can also manually download separately.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e3) PySVN missing - downloaded install exe but it claimed Python 2.7 wasn\'t installed\\/available so gave up and did svn checkout manually\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOh I see: setup.py uses PySVN; hmm.  Just checking out manually is better...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e4) Ran first python test and it aborted with complaint about GnuPlot missing\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm we should default printIndexCharts to False (I\'ll fix).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI imagine most of what is needed here comes out of the box on typical OSX\\/Linux setup.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm I don\'t think pysvn does, nor gnuplot ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397174_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397174_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jun\\/12 23:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-19T23:54:26+0000\'\u003e19\\/Jun\\/12 23:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n My Windows-based woes were: \\n 1) Had to install python (used 2.7)  \\n\\n OK. \\n\\n  2) Figure out python proxy settings for Wikipedia download  \\n\\n Hmmm ... you can also manually download separately. \\n\\n  3) PySVN missing - downloaded install exe but it claimed Python 2.7 wasn\'t installed\\/available so gave up and did svn checkout manually  \\n\\n Oh I see: setup.py uses PySVN; hmm.  Just checking out manually is better... \\n\\n  4) Ran first python test and it aborted with complaint about GnuPlot missing  \\n\\n Hmm we should default printIndexCharts to False (I\'ll fix). \\n\\n  I imagine most of what is needed here comes out of the box on typical OSX\\/Linux setup.  \\n\\n Hmm I don\'t think pysvn does, nor gnuplot ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397425\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397425&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397425\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397425_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397425_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 11:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T11:18:32+0000\'\u003e20\\/Jun\\/12 11:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmm somehow I messed up when testing the bloom postings format: all of my on-disk bloom bits sets are 8 MB, regardless of the size of the segment... so something is wrong (I would expect segments w\\/ more terms to have a larger bit set...).  This is what I did for the codec:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e    final Codec codec = new Lucene40Codec() {\\n      @Override\\n      public PostingsFormat getPostingsFormatForField(String field) {\\n        final String pfName = field.equals(\\\"id\\\") ? idFieldPostingsFormat : defaultPostingsFormat;\\n        if (pfName.equals(\\\"Bloom\\\")) {\\n          return new BloomFilteringPostingsFormat(PostingsFormat.forName(\\\"Lucene40\\\"),\\n                                                  new BloomFilterFactory() {\\n                                                    @Override\\n                                                    public FuzzySet getSetForField(FieldInfo info) {    \\n                                                      return FuzzySet.createSetBasedOnMaxMemory(100*1024*1024, new MurmurHash2());\\n                                                    }\\n                                                  });\\n        } else {\\n          return PostingsFormat.forName(pfName);\\n        }\\n      }\\n    };\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI thought that would use plenty of RAM (100 MB), and then downsize to the appropriately sized bit set (~10% saturation) when writing ... but somehow it didn\'t.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397425_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397425_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 11:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T11:18:32+0000\'\u003e20\\/Jun\\/12 11:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmm somehow I messed up when testing the bloom postings format: all of my on-disk bloom bits sets are 8 MB, regardless of the size of the segment... so something is wrong (I would expect segments w\\/ more terms to have a larger bit set...).  This is what I did for the codec: \\n  \\n     final Codec codec = new Lucene40Codec() {\\n      @Override\\n      public PostingsFormat getPostingsFormatForField(String field) {\\n        final String pfName = field.equals(\\\"id\\\") ? idFieldPostingsFormat : defaultPostingsFormat;\\n        if (pfName.equals(\\\"Bloom\\\")) {\\n          return new BloomFilteringPostingsFormat(PostingsFormat.forName(\\\"Lucene40\\\"),\\n                                                  new BloomFilterFactory() {\\n                                                    @Override\\n                                                    public FuzzySet getSetForField(FieldInfo info) {    \\n                                                      return FuzzySet.createSetBasedOnMaxMemory(100*1024*1024, new MurmurHash2());\\n                                                    }\\n                                                  });\\n        } else {\\n          return PostingsFormat.forName(pfName);\\n        }\\n      }\\n    };\\n \\n  \\n\\n I thought that would use plenty of RAM (100 MB), and then downsize to the appropriately sized bit set (~10% saturation) when writing ... but somehow it didn\'t.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397445\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397445&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397445\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397445_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397445_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 12:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T12:02:43+0000\'\u003e20\\/Jun\\/12 12:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK I think I found the problem w\\/ the patch: in BloomFilteringPostingsFormat.saveAppropriatelySizedBloomFilter, it should be \u003ctt\u003erightSizedSet.serialize(bloomOutput);\u003c\\/tt\u003e not \u003ctt\u003ebloomFilter.serialize(bloomOutput);\u003c\\/tt\u003e (it was saving the un-downsized version).  Now I see my .blm files varying in size according to how large the segment is...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397445_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397445_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 12:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T12:02:43+0000\'\u003e20\\/Jun\\/12 12:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK I think I found the problem w\\/ the patch: in BloomFilteringPostingsFormat.saveAppropriatelySizedBloomFilter, it should be  rightSizedSet.serialize(bloomOutput);  not  bloomFilter.serialize(bloomOutput);  (it was saving the un-downsized version).  Now I see my .blm files varying in size according to how large the segment is...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397457\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397457&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397457\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397457_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397457_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 12:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T12:26:39+0000\'\u003e20\\/Jun\\/12 12:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eResults after fixing the \\\"not downsizing\\\" bug:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n              Fuzzy1       97.02        1.43       88.67        3.08  -13% -   -4%\\n              Fuzzy2       42.50        1.15       40.32        1.75  -11% -    1%\\n         AndHighHigh       17.99        0.29       17.74        0.47   -5% -    2%\\n             Respell       82.76        2.96       81.66        3.54   -8% -    6%\\n          AndHighMed       55.77        1.02       55.06        1.51   -5% -    3%\\n         TermGroup1M       42.35        0.79       41.98        0.85   -4% -    3%\\n        TermBGroup1M       49.55        0.58       49.14        0.60   -3% -    1%\\n            SpanNear       12.53        0.15       12.49        0.09   -2% -    1%\\n      TermBGroup1M1P       64.36        0.83       64.34        0.83   -2% -    2%\\n             Prefix3       34.18        1.25       34.45        1.38   -6% -    8%\\n            Wildcard       34.42        1.12       34.75        1.35   -6% -    8%\\n        SloppyPhrase       11.48        0.17       11.61        0.22   -2% -    4%\\n              Phrase        8.47        0.30        8.57        0.25   -5% -    7%\\n                Term       94.06        4.50       95.45        2.34   -5% -    9%\\n              IntNRQ        9.84        0.63       10.07        0.71  -10% -   16%\\n           OrHighMed       34.57        2.07       35.78        2.24   -8% -   16%\\n          OrHighHigh       11.66        0.64       12.11        0.73   -7% -   16%\\n            PKLookup      129.75        2.37      153.80        2.31   14% -   22%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eBasically same as before ... which is good (it means target 10% saturation doesn\'t lose any perf).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13397457_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397457_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 12:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T12:26:39+0000\'\u003e20\\/Jun\\/12 12:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Results after fixing the \\\"not downsizing\\\" bug: \\n\\n  \\n                 Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n              Fuzzy1       97.02        1.43       88.67        3.08  -13% -   -4%\\n              Fuzzy2       42.50        1.15       40.32        1.75  -11% -    1%\\n         AndHighHigh       17.99        0.29       17.74        0.47   -5% -    2%\\n             Respell       82.76        2.96       81.66        3.54   -8% -    6%\\n          AndHighMed       55.77        1.02       55.06        1.51   -5% -    3%\\n         TermGroup1M       42.35        0.79       41.98        0.85   -4% -    3%\\n        TermBGroup1M       49.55        0.58       49.14        0.60   -3% -    1%\\n            SpanNear       12.53        0.15       12.49        0.09   -2% -    1%\\n      TermBGroup1M1P       64.36        0.83       64.34        0.83   -2% -    2%\\n             Prefix3       34.18        1.25       34.45        1.38   -6% -    8%\\n            Wildcard       34.42        1.12       34.75        1.35   -6% -    8%\\n        SloppyPhrase       11.48        0.17       11.61        0.22   -2% -    4%\\n              Phrase        8.47        0.30        8.57        0.25   -5% -    7%\\n                Term       94.06        4.50       95.45        2.34   -5% -    9%\\n              IntNRQ        9.84        0.63       10.07        0.71  -10% -   16%\\n           OrHighMed       34.57        2.07       35.78        2.24   -8% -   16%\\n          OrHighHigh       11.66        0.64       12.11        0.73   -7% -   16%\\n            PKLookup      129.75        2.37      153.80        2.31   14% -   22%\\n \\n  \\n\\n Basically same as before ... which is good (it means target 10% saturation doesn\'t lose any perf).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397571\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397571&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397571\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13397571_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397571_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 15:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T15:07:59+0000\'\u003e20\\/Jun\\/12 15:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFix for the \\\"not downsizing\\\" bug and a subsequent issue which that fix revealed. The 2nd issue was that on saturation, the downsize method would actually upsize into a bigger bitset. This causes false negatives on searches - it\'s safe to downsize the indexing bitset but not upsize as there is already some information loss involved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13397571_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397571_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 15:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T15:07:59+0000\'\u003e20\\/Jun\\/12 15:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fix for the \\\"not downsizing\\\" bug and a subsequent issue which that fix revealed. The 2nd issue was that on saturation, the downsize method would actually upsize into a bigger bitset. This causes false negatives on searches - it\'s safe to downsize the indexing bitset but not upsize as there is already some information loss involved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13397575\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13397575&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13397575\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13397575_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397575_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T15:09:59+0000\'\u003e20\\/Jun\\/12 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated Performance test code based on new IndexReader changes for accessing subreaders\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13397575_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13397575_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jun\\/12 15:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-20T15:09:59+0000\'\u003e20\\/Jun\\/12 15:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated Performance test code based on new IndexReader changes for accessing subreaders              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13399429\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13399429&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13399429\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13399429_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13399429_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/12 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-22T16:44:45+0000\'\u003e22\\/Jun\\/12 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached a performance test (adapted from Mike\'s PKLookupPerfTest) that demonstrates the worst-case scenario where BloomFilter offers the 2x speed up not previously revealed in Mike\'s other tests.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis test case mixes reads and writes on a growing index and is representative of the real-world scenario I am seeking to optimize. See the javadoc for test details.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13399429_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13399429_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jun\\/12 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-22T16:44:45+0000\'\u003e22\\/Jun\\/12 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached a performance test (adapted from Mike\'s PKLookupPerfTest) that demonstrates the worst-case scenario where BloomFilter offers the 2x speed up not previously revealed in Mike\'s other tests. \\n\\n This test case mixes reads and writes on a growing index and is representative of the real-world scenario I am seeking to optimize. See the javadoc for test details.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13400589\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13400589&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13400589\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13400589_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13400589_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jun\\/12 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-25T16:28:56+0000\'\u003e25\\/Jun\\/12 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded customizable saturation threshold after which Bloom filters are retired and no longer maintained (due to merges creating v large segments)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13400589_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13400589_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jun\\/12 16:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-25T16:28:56+0000\'\u003e25\\/Jun\\/12 16:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added customizable saturation threshold after which Bloom filters are retired and no longer maintained (due to merges creating v large segments)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13403402\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13403402&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13403402\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13403402_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403402_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 19:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T19:31:12+0000\'\u003e28\\/Jun\\/12 19:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI made various improvements to the PK lookup\\/update performance tester (called out as booleans at the top) so we can test the impact of:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003eReusing the enums\u003c\\/li\u003e\\n\\t\u003cli\u003ePre-sorting the keys before lookup\u003c\\/li\u003e\\n\\t\u003cli\u003eBest case (flush once after each update) vs worst case\u003c\\/li\u003e\\n\\t\u003cli\u003eUsing DocValues direct source instead of a stored field to hold the counter\u003c\\/li\u003e\\n\\t\u003cli\u003eUsing base 36 for the PK vs base 10\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eAlso, it\'s really wasteful that we go and lookup the docID by PK, to retrieve the old count, and then do an updateDocument call which forces IW to go and to the exact same (costly) lookup again.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I added a new method enabling deletion by document ID in IndexWriter.  I named it tryDeleteDocument, and it takes SegmentInfo and int docID.  If that segment has not been merged away, the delete succeeds, else it fails (and the app must delete through the \\\"normal\\\" way).  This seems to give ~20% speedup.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think eg Solr\'s \\\"update document field by retrieving old doc, changing field, calling IW.updateDocument\\\" could also use this method.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13403402_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403402_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 19:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T19:31:12+0000\'\u003e28\\/Jun\\/12 19:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I made various improvements to the PK lookup\\/update performance tester (called out as booleans at the top) so we can test the impact of: \\n \\n\\t Reusing the enums \\n\\t Pre-sorting the keys before lookup \\n\\t Best case (flush once after each update) vs worst case \\n\\t Using DocValues direct source instead of a stored field to hold the counter \\n\\t Using base 36 for the PK vs base 10 \\n \\n\\n\\n Also, it\'s really wasteful that we go and lookup the docID by PK, to retrieve the old count, and then do an updateDocument call which forces IW to go and to the exact same (costly) lookup again. \\n\\n So I added a new method enabling deletion by document ID in IndexWriter.  I named it tryDeleteDocument, and it takes SegmentInfo and int docID.  If that segment has not been merged away, the delete succeeds, else it fails (and the app must delete through the \\\"normal\\\" way).  This seems to give ~20% speedup. \\n\\n I think eg Solr\'s \\\"update document field by retrieving old doc, changing field, calling IW.updateDocument\\\" could also use this method.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13408083\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13408083&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13408083\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13408083_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13408083_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/12 15:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-06T15:46:47+0000\'\u003e06\\/Jul\\/12 15:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated performance test with option to alter the ratio of inserts vs updates via keyspace size.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13408083_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13408083_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/12 15:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-06T15:46:47+0000\'\u003e06\\/Jul\\/12 15:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated performance test with option to alter the ratio of inserts vs updates via keyspace size.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13408097\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13408097&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13408097\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13408097_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13408097_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/12 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-06T15:57:06+0000\'\u003e06\\/Jul\\/12 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the extra tests, Mike. That\'s tightened performance but that lookss a scary amount of code for the optimal solution of this basic incrementing operation \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve done some more benchmarks with the updated test and the performance characteristics are becoming clearer as shown in these results: \u003ca href=\\\"http:\\/\\/goo.gl\\/dtWSb\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/goo.gl\\/dtWSb\u003c\\/a\u003e\u003cbr\\/\u003e\\nBloom performance is better than Pulsing but the gap narrows with the volumes of deletes lying around in old segments, caused by updates. In these cases the BloomFilter gives a false positive and falls back to the equivalent operations of Pulsing. I added a 100mb start size for the BloomFilter for large-scale tests because without this it gets saturated and there were occasional big spikes in batch times.\u003cbr\\/\u003e\\nSo overall there still looks to be a benefit and especially in low-frequency update scenarios.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll wait for the dust to settle on Lucene-4190 (given this Codec introduces a new file) before thinking about committing.\u003c\\/p\u003e\\n\\n\u003cp\u003eCheers\u003cbr\\/\u003e\\nMark\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13408097_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13408097_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Jul\\/12 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-06T15:57:06+0000\'\u003e06\\/Jul\\/12 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the extra tests, Mike. That\'s tightened performance but that lookss a scary amount of code for the optimal solution of this basic incrementing operation   \\n\\n I\'ve done some more benchmarks with the updated test and the performance characteristics are becoming clearer as shown in these results:  http:\\/\\/goo.gl\\/dtWSb  \\nBloom performance is better than Pulsing but the gap narrows with the volumes of deletes lying around in old segments, caused by updates. In these cases the BloomFilter gives a false positive and falls back to the equivalent operations of Pulsing. I added a 100mb start size for the BloomFilter for large-scale tests because without this it gets saturated and there were occasional big spikes in batch times. \\nSo overall there still looks to be a benefit and especially in low-frequency update scenarios. \\n\\n I\'ll wait for the dust to settle on Lucene-4190 (given this Codec introduces a new file) before thinking about committing. \\n\\n Cheers \\nMark \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409676\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409676&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409676\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409676_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409676_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 17:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T17:47:40+0000\'\u003e09\\/Jul\\/12 17:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThat\'s tightened performance but that lookss a scary amount of code for the optimal solution of this basic incrementing operation\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWell the code now looks horribly complex since we have a ton of booleans to do the same thing in different ways \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eFrom my limited poking-around testing the fastest way seems to be lookupByReader=false, shareEnums=true, doSortKeys=true, useDocValues=true, useBase36=true, doDirectDelete=true.  Once you specialize the code for those booleans then it looks much more sane.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409676_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409676_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 17:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T17:47:40+0000\'\u003e09\\/Jul\\/12 17:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     That\'s tightened performance but that lookss a scary amount of code for the optimal solution of this basic incrementing operation  \\n\\n Well the code now looks horribly complex since we have a ton of booleans to do the same thing in different ways   \\n\\n From my limited poking-around testing the fastest way seems to be lookupByReader=false, shareEnums=true, doSortKeys=true, useDocValues=true, useBase36=true, doDirectDelete=true.  Once you specialize the code for those booleans then it looks much more sane.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409679\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409679&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409679\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409679_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409679_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 17:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T17:48:44+0000\'\u003e09\\/Jul\\/12 17:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAlso: in digging into this I found and fixed a silly performance bug in the nightly PKLookup perf test:\u003c\\/p\u003e\\n\\n\u003cp\u003e    \u003ca href=\\\"http:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/PKLookup.html\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/PKLookup.html\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eSo now we are close to 1M lookups\\/sec for a single thread!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409679_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409679_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 17:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T17:48:44+0000\'\u003e09\\/Jul\\/12 17:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Also: in digging into this I found and fixed a silly performance bug in the nightly PKLookup perf test: \\n\\n      http:\\/\\/people.apache.org\\/~mikemccand\\/lucenebench\\/PKLookup.html  \\n\\n So now we are close to 1M lookups\\/sec for a single thread!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T17:56:52+0000\'\u003e09\\/Jul\\/12 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI added a 100mb start size for the BloomFilter for large-scale tests because without this it gets saturated and there were occasional big spikes in batch times.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI wonder if somehow we can do a better job picking the right sized bit vector up front?  You basically need to know up front how many unique terms will be in the given field for this segment right?  This seems similar to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4198\\\" title=\\\"Allow codecs to index term impacts\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4198\\\"\u003eLUCENE-4198\u003c\\/a\u003e, where we want to improve Codec API so it has access to collection stats (like \\\"number of unique terms in this field\\\") up front.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 17:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T17:56:52+0000\'\u003e09\\/Jul\\/12 17:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I added a 100mb start size for the BloomFilter for large-scale tests because without this it gets saturated and there were occasional big spikes in batch times.  \\n\\n I wonder if somehow we can do a better job picking the right sized bit vector up front?  You basically need to know up front how many unique terms will be in the given field for this segment right?  This seems similar to  LUCENE-4198 , where we want to improve Codec API so it has access to collection stats (like \\\"number of unique terms in this field\\\") up front.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409693\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409693&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409693\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409693_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409693_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 18:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T18:05:43+0000\'\u003e09\\/Jul\\/12 18:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll open a separate issue for IndexWriter.tryDeleteDocument; I think it\'s worth exploring...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409693_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409693_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 18:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T18:05:43+0000\'\u003e09\\/Jul\\/12 18:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll open a separate issue for IndexWriter.tryDeleteDocument; I think it\'s worth exploring...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409746\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409746&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409746\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409746_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409746_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:14:30+0000\'\u003e09\\/Jul\\/12 19:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran with with the fastest configuration (lookupByReader=false,\u003cbr\\/\u003e\\nshareEnums=true, doSortKeys=true, useDocValues=true,\u003cbr\\/\u003e\\ndoDirectDelete=true, useBase36=true).\u003c\\/p\u003e\\n\\n\u003cp\u003eI used MMapDir, 10M numDocs and keySpaceSize, Java 1.7.0_04, 2 GB\u003cbr\\/\u003e\\nstarting\\/max heap.\u003c\\/p\u003e\\n\\n\u003cp\u003eWith doWorstCaseFlushing=false:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e  Lucene40\\n    55978 ms\\n\\n  Bloom\\n    49880 ms\\n\\n  Memory\\n    55965 ms\\n\\n  Pulsing\\n    56059 ms\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWith doWorstCaseFlushing=true:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e  Lucene40\\n    61097 ms\\n\\n  Bloom\\n    53698 ms\\n\\n  Memory\\n    61066 ms\\n\\n  Pulsing\\n    61355 ms\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSo Bloom is ~11-12% faster.  Very curious that Lucene40, Pulsing and\u003cbr\\/\u003e\\nMemory are basically the same!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409746_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409746_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:14:30+0000\'\u003e09\\/Jul\\/12 19:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran with with the fastest configuration (lookupByReader=false, \\nshareEnums=true, doSortKeys=true, useDocValues=true, \\ndoDirectDelete=true, useBase36=true). \\n\\n I used MMapDir, 10M numDocs and keySpaceSize, Java 1.7.0_04, 2 GB \\nstarting\\/max heap. \\n\\n With doWorstCaseFlushing=false: \\n\\n  \\n   Lucene40\\n    55978 ms\\n\\n  Bloom\\n    49880 ms\\n\\n  Memory\\n    55965 ms\\n\\n  Pulsing\\n    56059 ms\\n \\n  \\n\\n With doWorstCaseFlushing=true: \\n\\n  \\n   Lucene40\\n    61097 ms\\n\\n  Bloom\\n    53698 ms\\n\\n  Memory\\n    61066 ms\\n\\n  Pulsing\\n    61355 ms\\n \\n  \\n\\n So Bloom is ~11-12% faster.  Very curious that Lucene40, Pulsing and \\nMemory are basically the same!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409747\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409747&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409747\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409747_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409747_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:15:37+0000\'\u003e09\\/Jul\\/12 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOnly substantial change was I fixed the updates vs insert counting to work correctly when doDirectDelete is true.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409747_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409747_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:15:37+0000\'\u003e09\\/Jul\\/12 19:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Only substantial change was I fixed the updates vs insert counting to work correctly when doDirectDelete is true.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409758\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409758&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409758\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409758_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409758_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:22:21+0000\'\u003e09\\/Jul\\/12 19:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eInitial rough patch ... not ready to commit and needs a good random test.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409758_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409758_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:22:21+0000\'\u003e09\\/Jul\\/12 19:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Initial rough patch ... not ready to commit and needs a good random test.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13409762\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13409762&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13409762\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409762_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409762_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:26:22+0000\'\u003e09\\/Jul\\/12 19:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI opened \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4203\\\" title=\\\"Add IndexWriter.tryDeleteDocument, to delete by document id when possible\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4203\\\"\u003e\u003cdel\u003eLUCENE-4203\u003c\\/del\u003e\u003c\\/a\u003e for IndexWriter.tryDeleteDocument.\u003c\\/p\u003e\\n\\n\u003cp\u003eUrgh, patch is on the wrong issue ...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13409762_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13409762_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Jul\\/12 19:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-09T19:26:22+0000\'\u003e09\\/Jul\\/12 19:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I opened   LUCENE-4203   for IndexWriter.tryDeleteDocument. \\n\\n Urgh, patch is on the wrong issue ...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13410145\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13410145&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13410145\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13410145_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13410145_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jul\\/12 08:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-10T08:58:27+0000\'\u003e10\\/Jul\\/12 08:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eSo now we are close to 1M lookups\\/sec for a single thread!\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCool!\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI wonder if somehow we can do a better job picking the right sized bit vector up front? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eYou basically need to know up front how many unique terms will be in the given field for this segment right?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes - the job of anticipating the number of unique keys probably has 2 different contexts:\u003cbr\\/\u003e\\n1) Net new segments e.g. guessing up front how many docs\\/keys a user is likely to generate in a new segment before the flush settings kick in.\u003cbr\\/\u003e\\n2) Merged segments e.g. guessing how many unique keys survive a merge operation\u003c\\/p\u003e\\n\\n\u003cp\u003eEstimating key volumes in context 1 is probably hard without some additional hints from the end user. Arguably the BloomFilterFactory.getSetForField() method already represents where this setting can be controlled.\u003cbr\\/\u003e\\nIn context 2 where potentially large merges occur we could look at adding an extra method to BloomFilterFactory to handle this different context e.g. something like\u003cbr\\/\u003e\\n   FuzzySet getSetForMergeOpOnField(FieldInfo fi, OneMerge mergeContext)\u003cbr\\/\u003e\\nBased on the size of the segments being merged and volumes of deletes a more appropriate size of Bloom bitset could be allocated based on a worst-case estimate.\u003cbr\\/\u003e\\nNot sure how we get the OneMerge instance fed through the call stack - could that be held somewhere on a ThreadLocal as generally useful context?\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13410145_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13410145_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jul\\/12 08:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-10T08:58:27+0000\'\u003e10\\/Jul\\/12 08:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     So now we are close to 1M lookups\\/sec for a single thread!  \\n\\n Cool! \\n\\n  I wonder if somehow we can do a better job picking the right sized bit vector up front?   \\n  You basically need to know up front how many unique terms will be in the given field for this segment right?  \\n\\n Yes - the job of anticipating the number of unique keys probably has 2 different contexts: \\n1) Net new segments e.g. guessing up front how many docs\\/keys a user is likely to generate in a new segment before the flush settings kick in. \\n2) Merged segments e.g. guessing how many unique keys survive a merge operation \\n\\n Estimating key volumes in context 1 is probably hard without some additional hints from the end user. Arguably the BloomFilterFactory.getSetForField() method already represents where this setting can be controlled. \\nIn context 2 where potentially large merges occur we could look at adding an extra method to BloomFilterFactory to handle this different context e.g. something like \\n   FuzzySet getSetForMergeOpOnField(FieldInfo fi, OneMerge mergeContext) \\nBased on the size of the segments being merged and volumes of deletes a more appropriate size of Bloom bitset could be allocated based on a worst-case estimate. \\nNot sure how we get the OneMerge instance fed through the call stack - could that be held somewhere on a ThreadLocal as generally useful context? \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13412310\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13412310&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13412310\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412310_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412310_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T23:03:46+0000\'\u003e11\\/Jul\\/12 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebulk cleanup of 4.0-ALPHA \\/ 4.0 Jira versioning. all bulk edited issues have hoss20120711-bulk-40-change in a comment\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412310_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412310_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 23:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T23:03:46+0000\'\u003e11\\/Jul\\/12 23:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bulk cleanup of 4.0-ALPHA \\/ 4.0 Jira versioning. all bulk edited issues have hoss20120711-bulk-40-change in a comment              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13415092\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13415092&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13415092\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13415092_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415092_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 13:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T13:17:28+0000\'\u003e16\\/Jul\\/12 13:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded bloom package.html and changes.txt. I plan to commit in a day or two if there are no objections.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13415092_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415092_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 13:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T13:17:28+0000\'\u003e16\\/Jul\\/12 13:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added bloom package.html and changes.txt. I plan to commit in a day or two if there are no objections.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13415219\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13415219&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13415219\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13415219_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415219_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T15:28:14+0000\'\u003e16\\/Jul\\/12 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eEstimating key volumes in context 1 is probably hard without some additional hints from the end user.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eActually, the indexer knows exactly how many unique terms it\'s about to\u003cbr\\/\u003e\\nflush.  It\'s the unique term count (for this one segment) that you\u003cbr\\/\u003e\\nneed right?  We just have to plumb it somehow (add to\u003cbr\\/\u003e\\nSegmentWriteState?).\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003e2) Merged segments e.g. guessing how many unique keys survive a merge operation\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSeems like \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4198\\\" title=\\\"Allow codecs to index term impacts\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4198\\\"\u003eLUCENE-4198\u003c\\/a\u003e needs to solve this same problem.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eNot sure how we get the OneMerge instance fed through the call stack - could that be held somewhere on a ThreadLocal as generally useful context?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah I\'m not sure either ... but I agree an approx heuristic based on\u003cbr\\/\u003e\\nmerging segments unique term counts is better than nothing.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t like how you silently just get bad perf now if your up-front\u003cbr\\/\u003e\\nguess was too small ... I also don\'t like that the default guessing is\u003cbr\\/\u003e\\nstatic (8 MB): flushing tiny NRT segs are gonna pay an absurd price.\u003cbr\\/\u003e\\nI think we need a solution for this...\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe another option is to simply make a 2nd pass after the segment\u003cbr\\/\u003e\\n(flush or merge) is written, to build up the bit set; this way we know\u003cbr\\/\u003e\\nexactly how many unique terms we have.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13415219_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415219_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 15:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T15:28:14+0000\'\u003e16\\/Jul\\/12 15:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Estimating key volumes in context 1 is probably hard without some additional hints from the end user.  \\n\\n Actually, the indexer knows exactly how many unique terms it\'s about to \\nflush.  It\'s the unique term count (for this one segment) that you \\nneed right?  We just have to plumb it somehow (add to \\nSegmentWriteState?). \\n\\n  2) Merged segments e.g. guessing how many unique keys survive a merge operation  \\n\\n Seems like  LUCENE-4198  needs to solve this same problem. \\n\\n  Not sure how we get the OneMerge instance fed through the call stack - could that be held somewhere on a ThreadLocal as generally useful context?  \\n\\n Yeah I\'m not sure either ... but I agree an approx heuristic based on \\nmerging segments unique term counts is better than nothing. \\n\\n I don\'t like how you silently just get bad perf now if your up-front \\nguess was too small ... I also don\'t like that the default guessing is \\nstatic (8 MB): flushing tiny NRT segs are gonna pay an absurd price. \\nI think we need a solution for this... \\n\\n Maybe another option is to simply make a 2nd pass after the segment \\n(flush or merge) is written, to build up the bit set; this way we know \\nexactly how many unique terms we have.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13415221\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13415221&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13415221\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13415221_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415221_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T15:31:13+0000\'\u003e16\\/Jul\\/12 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI don\'t think we should use a separate factory class to provide the\u003cbr\\/\u003e\\nbloom filters; I think we should simplify.  EG add overridable methods\u003cbr\\/\u003e\\nto BloomFilteringPF; this way the default impl (8 MB, isSaturated)\u003cbr\\/\u003e\\nwould be in BloomFilteringPF.\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, why do we need to use SPI to find the HashFunction?  Seems like\u003cbr\\/\u003e\\noverkill... we don\'t (yet) have a bunch of hash functions that are\u003cbr\\/\u003e\\nvying here right?  We can make this pluggable at a later time... can\'t\u003cbr\\/\u003e\\nthe postings format impl pass in an instance of HashFunction when\u003cbr\\/\u003e\\nmaking the FuzzySet?  Default would just be MurmurHash.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you move the imports under the copyright header? (eg in\u003cbr\\/\u003e\\nHashFunction.java but maybe others).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13415221_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415221_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T15:31:13+0000\'\u003e16\\/Jul\\/12 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I don\'t think we should use a separate factory class to provide the \\nbloom filters; I think we should simplify.  EG add overridable methods \\nto BloomFilteringPF; this way the default impl (8 MB, isSaturated) \\nwould be in BloomFilteringPF. \\n\\n Also, why do we need to use SPI to find the HashFunction?  Seems like \\noverkill... we don\'t (yet) have a bunch of hash functions that are \\nvying here right?  We can make this pluggable at a later time... can\'t \\nthe postings format impl pass in an instance of HashFunction when \\nmaking the FuzzySet?  Default would just be MurmurHash. \\n\\n Can you move the imports under the copyright header? (eg in \\nHashFunction.java but maybe others).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13415362\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13415362&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13415362\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13415362_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415362_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T16:34:45+0000\'\u003e16\\/Jul\\/12 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIt\'s the unique term count (for this one segment) that you need right? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eYes, I need it before I start processing the stream of terms being flushed.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eSeems like \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4198\\\" title=\\\"Allow codecs to index term impacts\\\" class=\\\"issue-link\\\" data-issue-key=\\\"LUCENE-4198\\\"\u003eLUCENE-4198\u003c\\/a\u003e needs to solve this same problem.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAnother possibly related point on more access to \\\"merge context\\\" - custom codecs have a great opportunity at merge time to piggy-back some analysis on the data being streamed e.g. to spot \\\"trending\\\" terms whose term frequencies differ drastically between the merging source segments. This would require access to \\\"source segment\\\" as term postings are streamed to observe the change in counts. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eAlso, why do we need to use SPI to find the HashFunction? Seems like overkill... we don\'t (yet) have a bunch of hash functions that are vying here right?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere\'s already a MurmurHash3 algo - we\'re currently using v2 and so could anticipate an upgrade at some stage. This patch provides that future proofing.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ecan\'t the postings format impl pass in an instance of HashFunction when making the FuzzySet\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t think that is going to work. Currently all PostingFormat impls that extend BloomFilterPostingsFormat can be anonymous (i.e. unregistered via SPI). All their settings (fields, hash algo, thresholds) etc are recorded at write time by the base class in the segment. At read-time it is the BloomFilterPostingsFormat base class that is instantiated, not the write-time subclass and so we need to store the hash algo choice. We can\'t rely on the original subclass being around and configured appropriately with the original write-time choice of hashing function.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the current way feels safer over all and also allows other Lucene functions to safely record hashes along with a hashname string that can be used to reconstitute results. \u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eCan you move the imports under the copyright header?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWill do\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13415362_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415362_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 16:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T16:34:45+0000\'\u003e16\\/Jul\\/12 16:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     It\'s the unique term count (for this one segment) that you need right?   \\n Yes, I need it before I start processing the stream of terms being flushed. \\n\\n  Seems like  LUCENE-4198  needs to solve this same problem.  \\n\\n Another possibly related point on more access to \\\"merge context\\\" - custom codecs have a great opportunity at merge time to piggy-back some analysis on the data being streamed e.g. to spot \\\"trending\\\" terms whose term frequencies differ drastically between the merging source segments. This would require access to \\\"source segment\\\" as term postings are streamed to observe the change in counts.  \\n\\n  Also, why do we need to use SPI to find the HashFunction? Seems like overkill... we don\'t (yet) have a bunch of hash functions that are vying here right?  \\n\\n There\'s already a MurmurHash3 algo - we\'re currently using v2 and so could anticipate an upgrade at some stage. This patch provides that future proofing. \\n\\n  can\'t the postings format impl pass in an instance of HashFunction when making the FuzzySet  \\n\\n I don\'t think that is going to work. Currently all PostingFormat impls that extend BloomFilterPostingsFormat can be anonymous (i.e. unregistered via SPI). All their settings (fields, hash algo, thresholds) etc are recorded at write time by the base class in the segment. At read-time it is the BloomFilterPostingsFormat base class that is instantiated, not the write-time subclass and so we need to store the hash algo choice. We can\'t rely on the original subclass being around and configured appropriately with the original write-time choice of hashing function. \\n\\n I think the current way feels safer over all and also allows other Lucene functions to safely record hashes along with a hashname string that can be used to reconstitute results.  \\n\\n  Can you move the imports under the copyright header?  \\n\\n Will do \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13415604\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13415604&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13415604\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13415604_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415604_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 20:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T20:25:37+0000\'\u003e16\\/Jul\\/12 20:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eIt\'s the unique term count (for this one segment) that you need right? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYes, I need it before I start processing the stream of terms being flushed.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAt a minimum I think before committing we should make the\u003cbr\\/\u003e\\nSegmentWriteState accessible.  EG then at least I can use numDocs for\u003cbr\\/\u003e\\nmy primary key field.\u003c\\/p\u003e\\n\\n\u003cp\u003eI really don\'t like how easy it is to silently mis-configure this PF:\u003cbr\\/\u003e\\nthe default 8 MB is way to high for an NRT setting and way too low for\u003cbr\\/\u003e\\na large index.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eCurrently all PostingFormat impls that extend BloomFilterPostingsFormat can be anonymous (i.e. unregistered via SPI). \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm why is anonymity at search time important?  I think that\'s a\u003cbr\\/\u003e\\nnon-feature, and we shouldn\'t make our core code more complex for it?\u003c\\/p\u003e\\n\\n\u003cp\u003eIe, it\'s fine to require the app to have to make a named PF (that is\u003cbr\\/\u003e\\naccessible via SPI), implementing all their custom bloom logic (which\u003cbr\\/\u003e\\nfields are bloom\'d, what hash to use, etc.).\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen an app makes a custom Codec\\/PostingsFormat, it\'s expected that\u003cbr\\/\u003e\\nthat class is accessible via SPI at both index time and search time.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13415604_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13415604_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/12 20:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-16T20:25:37+0000\'\u003e16\\/Jul\\/12 20:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  It\'s the unique term count (for this one segment) that you need right?   \\n\\n Yes, I need it before I start processing the stream of terms being flushed.  \\n\\n At a minimum I think before committing we should make the \\nSegmentWriteState accessible.  EG then at least I can use numDocs for \\nmy primary key field. \\n\\n I really don\'t like how easy it is to silently mis-configure this PF: \\nthe default 8 MB is way to high for an NRT setting and way too low for \\na large index. \\n\\n  Currently all PostingFormat impls that extend BloomFilterPostingsFormat can be anonymous (i.e. unregistered via SPI).   \\n\\n Hmm why is anonymity at search time important?  I think that\'s a \\nnon-feature, and we shouldn\'t make our core code more complex for it? \\n\\n Ie, it\'s fine to require the app to have to make a named PF (that is \\naccessible via SPI), implementing all their custom bloom logic (which \\nfields are bloom\'d, what hash to use, etc.). \\n\\n When an app makes a custom Codec\\/PostingsFormat, it\'s expected that \\nthat class is accessible via SPI at both index time and search time.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416007\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416007&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416007\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416007_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416007_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 08:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T08:35:21+0000\'\u003e17\\/Jul\\/12 08:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAt a minimum I think before committing we should make the SegmentWriteState accessible.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK. Will that be the subject of a new Jira?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eHmm why is anonymity at search time important?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt would seem to be an established design principle - see \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4069#comment-13285726\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4069#comment-13285726\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eIt would be a pain if user config settings require a custom SPI-registered class around just to decode the index contents. There\'s the resource\\/classpath hell, the chance for misconfiguration and running Luke suddenly gets more complex.\u003cbr\\/\u003e\\nThe line to be drawn is between what are just config settings (field names, memory limits) and what are fundamentally different file formats (e.g. codec choices).\u003cbr\\/\u003e\\nThe design principle that looks to be adopted is that the former ought to be accommodated without the need for custom SPI-registered classes and the latter would need to locate an implementation via SPI to decode stored content. Seems reasonable.\u003cbr\\/\u003e\\nThe choice of hash algo does not fundamentally alter the on-disk format (they all produce an int) so I would suggest we treat this as a config setting rather than a fundamentally different choice of file format.\u003c\\/p\u003e\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416007_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416007_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 08:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T08:35:21+0000\'\u003e17\\/Jul\\/12 08:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     At a minimum I think before committing we should make the SegmentWriteState accessible.  \\n\\n OK. Will that be the subject of a new Jira? \\n\\n  Hmm why is anonymity at search time important?  \\n\\n It would seem to be an established design principle - see  https:\\/\\/issues.apache.org\\/jira\\/browse\\/LUCENE-4069#comment-13285726  \\n\\n It would be a pain if user config settings require a custom SPI-registered class around just to decode the index contents. There\'s the resource\\/classpath hell, the chance for misconfiguration and running Luke suddenly gets more complex. \\nThe line to be drawn is between what are just config settings (field names, memory limits) and what are fundamentally different file formats (e.g. codec choices). \\nThe design principle that looks to be adopted is that the former ought to be accommodated without the need for custom SPI-registered classes and the latter would need to locate an implementation via SPI to decode stored content. Seems reasonable. \\nThe choice of hash algo does not fundamentally alter the on-disk format (they all produce an int) so I would suggest we treat this as a config setting rather than a fundamentally different choice of file format. \\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416014\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416014&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416014\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13416014_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416014_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 08:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T08:45:35+0000\'\u003e17\\/Jul\\/12 08:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eIt would be a pain if user config settings require a custom SPI-registered class around just to decode the index contents. There\'s the resource\\/classpath hell, the chance for misconfiguration and running Luke suddenly gets more complex.\u003cbr\\/\u003e\\nThe line to be drawn is between what are just config settings (field names, memory limits) and what are fundamentally different file formats (e.g. codec choices).\u003cbr\\/\u003e\\nThe design principle that looks to be adopted is that the former ought to be accommodated without the need for custom SPI-registered classes and the latter would need to locate an implementation via SPI to decode stored content. Seems reasonable.\u003cbr\\/\u003e\\nThe choice of hash algo does not fundamentally alter the on-disk format (they all produce an int) so I would suggest we treat this as a config setting rather than a fundamentally different choice of file format.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe design principle here is very easy: We must follow the SPI pattern, if you write an index that could otherwise not be read with default settings and produces e.g. CorruptIndexException. If you have a codec that writes some special things for specific fields, it is required to write this information about the fields to the index. If you want to open this index using IndexReader again, there must not be any requirement for configuration settings on the reader itsself - a simple DirectoryReader.open() must be possible and a query must be able to execute. The IndexReader must be able to get all this information from the index files. If a special decoder for foobar is needed, it must be loadable by SPI. This is similar to postings. A new postings format needs a new SPI, otherwise you cannot read the index.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd it is not true that Luke is more complex to configure. Just put the JAR file into classpath that contains the SPI and you are fine. Setting up a build environment is more complicated but thats more the problem of shitty Eclipse resource handling. ANT\\/MAVEN\\/IDEA is easy.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13416014_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416014_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 08:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T08:45:35+0000\'\u003e17\\/Jul\\/12 08:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n It would be a pain if user config settings require a custom SPI-registered class around just to decode the index contents. There\'s the resource\\/classpath hell, the chance for misconfiguration and running Luke suddenly gets more complex. \\nThe line to be drawn is between what are just config settings (field names, memory limits) and what are fundamentally different file formats (e.g. codec choices). \\nThe design principle that looks to be adopted is that the former ought to be accommodated without the need for custom SPI-registered classes and the latter would need to locate an implementation via SPI to decode stored content. Seems reasonable. \\nThe choice of hash algo does not fundamentally alter the on-disk format (they all produce an int) so I would suggest we treat this as a config setting rather than a fundamentally different choice of file format.  \\n\\n The design principle here is very easy: We must follow the SPI pattern, if you write an index that could otherwise not be read with default settings and produces e.g. CorruptIndexException. If you have a codec that writes some special things for specific fields, it is required to write this information about the fields to the index. If you want to open this index using IndexReader again, there must not be any requirement for configuration settings on the reader itsself - a simple DirectoryReader.open() must be possible and a query must be able to execute. The IndexReader must be able to get all this information from the index files. If a special decoder for foobar is needed, it must be loadable by SPI. This is similar to postings. A new postings format needs a new SPI, otherwise you cannot read the index. \\n\\n And it is not true that Luke is more complex to configure. Just put the JAR file into classpath that contains the SPI and you are fine. Setting up a build environment is more complicated but thats more the problem of shitty Eclipse resource handling. ANT\\/MAVEN\\/IDEA is easy.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416037\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416037&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416037\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416037_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416037_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 09:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T09:20:14+0000\'\u003e17\\/Jul\\/12 09:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIf a special decoder for foobar is needed, it must be loadable by SPI. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI think we are in agreement on the broad principles. The fundamental question here though is do you want to treat an index\'s choice of Hash algo as something that would require a new SPI-registered PostingsFormat to decode or can that be handled as I have done here with a general purpose SPI framework for hashing algos? \u003c\\/p\u003e\\n\\n\u003cp\u003eActually, re-thinking this, I suspect rather than creating our own, I can use Java\'s existing SPI framework for hashing in the form of MessageDigest. I\'ll take a closer look into that...\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416037_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416037_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 09:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T09:20:14+0000\'\u003e17\\/Jul\\/12 09:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     If a special decoder for foobar is needed, it must be loadable by SPI.   \\n\\n I think we are in agreement on the broad principles. The fundamental question here though is do you want to treat an index\'s choice of Hash algo as something that would require a new SPI-registered PostingsFormat to decode or can that be handled as I have done here with a general purpose SPI framework for hashing algos?  \\n\\n Actually, re-thinking this, I suspect rather than creating our own, I can use Java\'s existing SPI framework for hashing in the form of MessageDigest. I\'ll take a closer look into that... \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416039\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416039&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416039\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13416039_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416039_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 09:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T09:25:37+0000\'\u003e17\\/Jul\\/12 09:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eActually, re-thinking this, I suspect rather than creating our own, I can use Java\'s existing SPI framework for hashing in the form of MessageDigest. I\'ll take a closer look into that...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s a good idea. MessageDigest.getInstance(name) should be the way to go. And this name string is encoded to the index. If the MessageDigest API is enough then one can e.g. use bouncycastle by just plugging into the calsspath. If on opening index, this is not available, he will get Exception just like when codec\\/postingsformat is missing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13416039_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416039_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 09:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T09:25:37+0000\'\u003e17\\/Jul\\/12 09:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Actually, re-thinking this, I suspect rather than creating our own, I can use Java\'s existing SPI framework for hashing in the form of MessageDigest. I\'ll take a closer look into that...  \\n\\n That\'s a good idea. MessageDigest.getInstance(name) should be the way to go. And this name string is encoded to the index. If the MessageDigest API is enough then one can e.g. use bouncycastle by just plugging into the calsspath. If on opening index, this is not available, he will get Exception just like when codec\\/postingsformat is missing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416084\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416084&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416084\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416084_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416084_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 11:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T11:03:45+0000\'\u003e17\\/Jul\\/12 11:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eMessageDigest.getInstance(name) should be the way to go\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m less keen now - a quick scan of the docs around MessageDigest throws up some issues:\u003cbr\\/\u003e\\n1) SPI registration of MessageDigest providers looks to get into permissions hell as it is closely related to security - see \u003ca href=\\\"http:\\/\\/docs.oracle.com\\/javase\\/1.4.2\\/docs\\/guide\\/security\\/CryptoSpec.html#ProviderInstalling\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/docs.oracle.com\\/javase\\/1.4.2\\/docs\\/guide\\/security\\/CryptoSpec.html#ProviderInstalling\u003c\\/a\u003e which talks about the steps required to approve a trusted \\\"provider\\\".\u003cbr\\/\u003e\\n2) MessageDigest as an interface is designed to stream content in potentially many method calls past the hashing algo. MurmurHash2.java is not currently written to process content this way and suits our needs in hashing small blocks of content in one hit. \u003c\\/p\u003e\\n\\n\u003cp\u003eFor these 2 reasons it looks like MessageDigest may be a pain to adopt and the existing approach proposed in this patch may be preferable.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416084_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416084_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 11:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T11:03:45+0000\'\u003e17\\/Jul\\/12 11:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     MessageDigest.getInstance(name) should be the way to go  \\n\\n I\'m less keen now - a quick scan of the docs around MessageDigest throws up some issues: \\n1) SPI registration of MessageDigest providers looks to get into permissions hell as it is closely related to security - see  http:\\/\\/docs.oracle.com\\/javase\\/1.4.2\\/docs\\/guide\\/security\\/CryptoSpec.html#ProviderInstalling  which talks about the steps required to approve a trusted \\\"provider\\\". \\n2) MessageDigest as an interface is designed to stream content in potentially many method calls past the hashing algo. MurmurHash2.java is not currently written to process content this way and suits our needs in hashing small blocks of content in one hit.  \\n\\n For these 2 reasons it looks like MessageDigest may be a pain to adopt and the existing approach proposed in this patch may be preferable.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416290\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416290&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416290\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13416290_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416290_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T15:31:24+0000\'\u003e17\\/Jul\\/12 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eAt a minimum I think before committing we should make the SegmentWriteState accessible.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOK. Will that be the subject of a new Jira?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNo, I mean we shouldn\'t commit this patch until SegmentWriteState is\u003cbr\\/\u003e\\naccessible when creating the FuzzySet.  I think we can just pass it to\u003cbr\\/\u003e\\nBloomFilterFactory.getSetForField?  This way if the app knows it\'s a\u003cbr\\/\u003e\\nPK field then it can use maxDoc to always size an appropriate\u003cbr\\/\u003e\\nbit set up front.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think we are in agreement on the broad principles. The fundamental question here though is do you want to treat an index\'s choice of Hash algo as something that would require a new SPI-registered PostingsFormat to decode or can that be handled as I have done here with a general purpose SPI framework for hashing algos?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1, that\'s exactly the question.\u003c\\/p\u003e\\n\\n\u003cp\u003eIe, where to draw the line between \\\"config of an existing PF\\\" and\u003cbr\\/\u003e\\n\\\"different PF\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I guess swapping in different hash impl should be seen as simple\u003cbr\\/\u003e\\nconfig change, so I think using SPI to find it at read time is OK.\u003c\\/p\u003e\\n\\n\u003cp\u003eI still don\'t like how trappy this approach is: the default hardwired\u003cbr\\/\u003e\\n(8 MB) can be way too big (silently slows down your NRT reopens,\u003cbr\\/\u003e\\nespecially if you bloom all fields) or way too small (silently turns\u003cbr\\/\u003e\\noff bloom filter for fields that have too many unique terms).\u003c\\/p\u003e\\n\\n\u003cp\u003eI also don\'t think this PF should be per-field: we have\u003cbr\\/\u003e\\nPerFieldPostingsFormat for that, and if there are limitations in PFPF,\u003cbr\\/\u003e\\nwe should address them rather than having to make all future PFs\u003cbr\\/\u003e\\nhandle per-field-ness themselves.  This PF should really handle one\u003cbr\\/\u003e\\nfield.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I don\'t think these issues need to hold up commit (except for\u003cbr\\/\u003e\\nmaking SegmentWriteState accessible)... we can improve over time.  I\u003cbr\\/\u003e\\nthink we may simply want to fold this into the terms dict somehow.\u003c\\/p\u003e\\n\\n\u003cp\u003eCan you add @lucene.experimental to all the new APIs?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13416290_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416290_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 15:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T15:31:24+0000\'\u003e17\\/Jul\\/12 15:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n  At a minimum I think before committing we should make the SegmentWriteState accessible.  \\n\\n OK. Will that be the subject of a new Jira?  \\n\\n No, I mean we shouldn\'t commit this patch until SegmentWriteState is \\naccessible when creating the FuzzySet.  I think we can just pass it to \\nBloomFilterFactory.getSetForField?  This way if the app knows it\'s a \\nPK field then it can use maxDoc to always size an appropriate \\nbit set up front. \\n\\n  I think we are in agreement on the broad principles. The fundamental question here though is do you want to treat an index\'s choice of Hash algo as something that would require a new SPI-registered PostingsFormat to decode or can that be handled as I have done here with a general purpose SPI framework for hashing algos?  \\n\\n +1, that\'s exactly the question. \\n\\n Ie, where to draw the line between \\\"config of an existing PF\\\" and \\n\\\"different PF\\\". \\n\\n But I guess swapping in different hash impl should be seen as simple \\nconfig change, so I think using SPI to find it at read time is OK. \\n\\n I still don\'t like how trappy this approach is: the default hardwired \\n(8 MB) can be way too big (silently slows down your NRT reopens, \\nespecially if you bloom all fields) or way too small (silently turns \\noff bloom filter for fields that have too many unique terms). \\n\\n I also don\'t think this PF should be per-field: we have \\nPerFieldPostingsFormat for that, and if there are limitations in PFPF, \\nwe should address them rather than having to make all future PFs \\nhandle per-field-ness themselves.  This PF should really handle one \\nfield. \\n\\n But I don\'t think these issues need to hold up commit (except for \\nmaking SegmentWriteState accessible)... we can improve over time.  I \\nthink we may simply want to fold this into the terms dict somehow. \\n\\n Can you add @lucene.experimental to all the new APIs?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416352\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416352&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416352\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416352_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416352_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 16:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T16:47:06+0000\'\u003e17\\/Jul\\/12 16:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch with use of SegmentWriteState to right-size the choice if bitset for volume of content.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416352_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416352_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 16:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T16:47:06+0000\'\u003e17\\/Jul\\/12 16:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch with use of SegmentWriteState to right-size the choice if bitset for volume of content.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416383\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416383&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416383\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416383_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416383_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 17:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T17:32:56+0000\'\u003e17\\/Jul\\/12 17:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eA quick benchmark looks like the new right-sized bitset as opposed to the old worst-case-scenario-sized bitset is buying us a small performance improvement.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI also don\'t think this PF should be per-field\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere was a lengthy discussion earlier on this topic. The approach presented here seems reasonable.\u003cbr\\/\u003e\\nFor the average user you have the DefaultBloomFilterFactory default which now has reasonable sizing for all fields passed its way (assuming a heuristic based on numDocs=numKeys to anticipate). For expert users you can provide a BloomFilterFactory with a custom choice of sizing heuristic per-field and can also simply return \\\"null\\\" for non-bloomed fields.\u003c\\/p\u003e\\n\\n\u003cp\u003eHaving a single, carefully configured BloomPF wrapper is preferable because you can channel appropriately configured bloom settings to a common PF delegate and avoid creating multiple .tii, .tis files etc because the PerFieldPF isn\'t smart enough to figure out that these Bloom-ing choices do not require different physical files for all the delegated tii etc structures.\u003c\\/p\u003e\\n\\n\u003cp\u003eYou don\'t \u003cb\u003ehave\u003c\\/b\u003e to use the Per-field stuff in BloomPF but there are benefits to be had in doing so which can\'t otherwise be achieved.\u003c\\/p\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eCan you add @lucene.experimental to all the new APIs?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDone.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13416383_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416383_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 17:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T17:32:56+0000\'\u003e17\\/Jul\\/12 17:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    A quick benchmark looks like the new right-sized bitset as opposed to the old worst-case-scenario-sized bitset is buying us a small performance improvement. \\n\\n  I also don\'t think this PF should be per-field  \\n\\n There was a lengthy discussion earlier on this topic. The approach presented here seems reasonable. \\nFor the average user you have the DefaultBloomFilterFactory default which now has reasonable sizing for all fields passed its way (assuming a heuristic based on numDocs=numKeys to anticipate). For expert users you can provide a BloomFilterFactory with a custom choice of sizing heuristic per-field and can also simply return \\\"null\\\" for non-bloomed fields. \\n\\n Having a single, carefully configured BloomPF wrapper is preferable because you can channel appropriately configured bloom settings to a common PF delegate and avoid creating multiple .tii, .tis files etc because the PerFieldPF isn\'t smart enough to figure out that these Bloom-ing choices do not require different physical files for all the delegated tii etc structures. \\n\\n You don\'t  have  to use the Per-field stuff in BloomPF but there are benefits to be had in doing so which can\'t otherwise be achieved. \\n\\n\\n  Can you add @lucene.experimental to all the new APIs?  \\n\\n Done.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13416417\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13416417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13416417\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13416417_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416417_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T18:12:37+0000\'\u003e17\\/Jul\\/12 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Mark.  +1 to commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eI still think we could\\/should somehow fold this into the terms dict but we can do that another day... this is a good step forward.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003ebecause the PerFieldPF isn\'t smart enough to figure out that these Bloom-ing choices do not require different physical files for all the delegated tii etc structures.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWe need to fix that, so that every PF wrapper that comes along doesn\'t feel like it must handle per-field-ness itself.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13416417_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13416417_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Jul\\/12 18:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-17T18:12:37+0000\'\u003e17\\/Jul\\/12 18:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Mark.  +1 to commit. \\n\\n I still think we could\\/should somehow fold this into the terms dict but we can do that another day... this is a good step forward. \\n\\n  because the PerFieldPF isn\'t smart enough to figure out that these Bloom-ing choices do not require different physical files for all the delegated tii etc structures.  \\n\\n We need to fix that, so that every PF wrapper that comes along doesn\'t feel like it must handle per-field-ness itself.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13418314\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13418314&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13418314\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13418314_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13418314_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/12 14:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-19T14:14:17+0000\'\u003e19\\/Jul\\/12 14:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOne more remaining issue before I commit which has appeared sporadically and looks to be consistently raised by this test:\u003cbr\\/\u003e\\nant test  -Dtestcase=TestIndexWriterCommit -Dtests.method=testCommitThreadSafety -Dtests.seed=EA320250471B75AE -Dtests.slow=true -Dtests.postingsformat=TestBloomFilteredLucene40Postings -Dtests.locale=no -Dtests.timezone=Europe\\/Belfast -Dtests.file.encoding=ISO-8859-1\u003c\\/p\u003e\\n\\n\u003cp\u003eThe error it produces is this: \u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;junit4:junit4&#93;\u003c\\/span\u003e    &gt; Caused by: java.lang.IllegalStateException: Missing \u003ca href=\\\"file:_9_TestBloomFilteredLucene40Postings_0.blm\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003efile:_9_TestBloomFilteredLucene40Postings_0.blm\u003c\\/a\u003e\u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;junit4:junit4&#93;\u003c\\/span\u003e    &gt;    at org.apache.lucene.codecs.bloom.BloomFilteringPostingsFormat$BloomFilteredFieldsProducer.&lt;init&gt;(BloomFilteringPostingsFormat.java:175)\u003cbr\\/\u003e\\n\u003cspan class=\\\"error\\\"\u003e&#91;junit4:junit4&#93;\u003c\\/span\u003e    &gt;    at org.apache.lucene.codecs.bloom.BloomFilteringPostingsFormat.fieldsProducer(BloomFilteringPostingsFormat.java:156)\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eMockDirectoryWrapper looks to be randomly deleting files (probably my \\\"blm\\\" file shown above) to simulate the effects of crashes.\u003cbr\\/\u003e\\nPresumably I am doing the \\\"right thing\\\" in always throwing an exception if the .blm file is missing? The alternative would be to silently ignore the missing file which seems undesirable.\u003cbr\\/\u003e\\nIF MDW is intended to only delete uncommitted files I\'m not sure how we end up in a scenario where BloomPF is being asked to open the uncommitted segment?\u003c\\/p\u003e\\n\\n\\n\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13418314_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13418314_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/12 14:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-19T14:14:17+0000\'\u003e19\\/Jul\\/12 14:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    One more remaining issue before I commit which has appeared sporadically and looks to be consistently raised by this test: \\nant test  -Dtestcase=TestIndexWriterCommit -Dtests.method=testCommitThreadSafety -Dtests.seed=EA320250471B75AE -Dtests.slow=true -Dtests.postingsformat=TestBloomFilteredLucene40Postings -Dtests.locale=no -Dtests.timezone=Europe\\/Belfast -Dtests.file.encoding=ISO-8859-1 \\n\\n The error it produces is this:  \\n &#91;junit4:junit4&#93;     &gt; Caused by: java.lang.IllegalStateException: Missing  file:_9_TestBloomFilteredLucene40Postings_0.blm  \\n &#91;junit4:junit4&#93;     &gt;    at org.apache.lucene.codecs.bloom.BloomFilteringPostingsFormat$BloomFilteredFieldsProducer.&lt;init&gt;(BloomFilteringPostingsFormat.java:175) \\n &#91;junit4:junit4&#93;     &gt;    at org.apache.lucene.codecs.bloom.BloomFilteringPostingsFormat.fieldsProducer(BloomFilteringPostingsFormat.java:156) \\n\\n\\n MockDirectoryWrapper looks to be randomly deleting files (probably my \\\"blm\\\" file shown above) to simulate the effects of crashes. \\nPresumably I am doing the \\\"right thing\\\" in always throwing an exception if the .blm file is missing? The alternative would be to silently ignore the missing file which seems undesirable. \\nIF MDW is intended to only delete uncommitted files I\'m not sure how we end up in a scenario where BloomPF is being asked to open the uncommitted segment? \\n\\n\\n\\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13418393\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13418393&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13418393\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13418393_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13418393_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/12 16:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-19T16:05:53+0000\'\u003e19\\/Jul\\/12 16:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ePresumably I am doing the \\\"right thing\\\" in always throwing an exception if the .blm file is missing? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDefinitely!  This should be considered a corrupt index.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIF MDW is intended to only delete uncommitted files I\'m not sure how we end up in a scenario where BloomPF is being asked to open the uncommitted segment?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eVery strange... IW will sync all files written by the codec, and only once all files for a given segment are sync\'d will it write a segments_N referencing that segment.  Not sure offhand why this file isn\'t being sync\'d... I wonder if it has to do w\\/ only opening the file in the close() method (most other PFs open files well before then).  It should be fine to do that ... but it\'s something different.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13418393_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13418393_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/12 16:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-19T16:05:53+0000\'\u003e19\\/Jul\\/12 16:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Presumably I am doing the \\\"right thing\\\" in always throwing an exception if the .blm file is missing?   \\n\\n Definitely!  This should be considered a corrupt index. \\n\\n  IF MDW is intended to only delete uncommitted files I\'m not sure how we end up in a scenario where BloomPF is being asked to open the uncommitted segment?  \\n\\n Very strange... IW will sync all files written by the codec, and only once all files for a given segment are sync\'d will it write a segments_N referencing that segment.  Not sure offhand why this file isn\'t being sync\'d... I wonder if it has to do w\\/ only opening the file in the close() method (most other PFs open files well before then).  It should be fine to do that ... but it\'s something different.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13418411\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13418411&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13418411\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13418411_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13418411_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/12 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-19T16:23:37+0000\'\u003e19\\/Jul\\/12 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI wonder if it has to do w\\/ only opening the file in the close() method (\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eJust tried opening the file earlier (in BloomFilteredConsumer constructor) and that didn\'t fix it.\u003cbr\\/\u003e\\nI previously also added an extra Directory.fileExists() sanity check immediately after closing the IndexOutput and all was well so I think it\'s something happening after that. Will need to dig deeper.\u003cbr\\/\u003e\\nI\'m running on WinXP 64bit if that is of any significance to MDW\'s behaviour.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13418411_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13418411_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Jul\\/12 16:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-19T16:23:37+0000\'\u003e19\\/Jul\\/12 16:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I wonder if it has to do w\\/ only opening the file in the close() method (  \\n\\n Just tried opening the file earlier (in BloomFilteredConsumer constructor) and that didn\'t fix it. \\nI previously also added an extra Directory.fileExists() sanity check immediately after closing the IndexOutput and all was well so I think it\'s something happening after that. Will need to dig deeper. \\nI\'m running on WinXP 64bit if that is of any significance to MDW\'s behaviour.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13419203\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13419203&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13419203\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13419203_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13419203_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jul\\/12 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-20T15:08:22+0000\'\u003e20\\/Jul\\/12 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAttached a log of thread activity showing how TestIndexWriterCommit.testCommitThreadSafety() is failing.\u003cbr\\/\u003e\\nAt this stage I can\'t tell if this is a failing in MockDirectoryWrapper or the test or the BloomPF class but it is related to files being removed unexpectedly.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13419203_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13419203_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Jul\\/12 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-20T15:08:22+0000\'\u003e20\\/Jul\\/12 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Attached a log of thread activity showing how TestIndexWriterCommit.testCommitThreadSafety() is failing. \\nAt this stage I can\'t tell if this is a failing in MockDirectoryWrapper or the test or the BloomPF class but it is related to files being removed unexpectedly.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13426524\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13426524&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13426524\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13426524_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13426524_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/12 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-01T11:11:42+0000\'\u003e01\\/Aug\\/12 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated with fix to issue explored in Lucene-4275\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13426524_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13426524_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/12 11:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-01T11:11:42+0000\'\u003e01\\/Aug\\/12 11:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated with fix to issue explored in Lucene-4275              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13426700\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13426700&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13426700\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13426700_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13426700_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/12 15:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-01T15:32:30+0000\'\u003e01\\/Aug\\/12 15:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated patch to bring in line with latest core API changes.\u003cbr\\/\u003e\\nAll tests now pass clean so will commit soon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13426700_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13426700_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/12 15:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-01T15:32:30+0000\'\u003e01\\/Aug\\/12 15:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Updated patch to bring in line with latest core API changes. \\nAll tests now pass clean so will commit soon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13427307\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13427307&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13427307\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13427307_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427307_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:25:34+0000\'\u003e02\\/Aug\\/12 13:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommitted to 4.0 branch, revision 1368442\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13427307_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427307_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:25:34+0000\'\u003e02\\/Aug\\/12 13:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Committed to 4.0 branch, revision 1368442              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13427317\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13427317&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13427317\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13427317_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427317_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:48:39+0000\'\u003e02\\/Aug\\/12 13:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Mark: I noticed this was committed only to the 4.x branch. \u003c\\/p\u003e\\n\\n\u003cp\u003ecan you also merge the change to trunk?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13427317_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427317_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:48:39+0000\'\u003e02\\/Aug\\/12 13:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Mark: I noticed this was committed only to the 4.x branch.  \\n\\n can you also merge the change to trunk?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13427318\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13427318&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13427318\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_13427318_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427318_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:48:51+0000\'\u003e02\\/Aug\\/12 13:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark, is there a reason why this patch hasn\'t been committed to trunk too?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jpountz\\\" id=\\\"commentauthor_13427318_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jpountz\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jpountz\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Adrien Grand\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427318_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:48:51+0000\'\u003e02\\/Aug\\/12 13:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mark, is there a reason why this patch hasn\'t been committed to trunk too?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13427322\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13427322&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13427322\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13427322_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427322_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:51:02+0000\'\u003e02\\/Aug\\/12 13:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWill do.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13427322_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427322_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 13:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T13:51:02+0000\'\u003e02\\/Aug\\/12 13:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Will do.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13427408\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13427408&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13427408\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13427408_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427408_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 16:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T16:08:15+0000\'\u003e02\\/Aug\\/12 16:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eApplied to trunk in revision 1368567\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13427408_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13427408_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Aug\\/12 16:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-02T16:08:15+0000\'\u003e02\\/Aug\\/12 16:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Applied to trunk in revision 1368567              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13428839\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13428839&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13428839\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13428839_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13428839_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Aug\\/12 12:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-05T12:13:35+0000\'\u003e05\\/Aug\\/12 12:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmm in testing Bloom + Lucene40 PF on luceneutil\'s \\\"id\\\" field I don\'t see any gains with what was committed (base=Lucene40 for id field, comp=Bloom + Lucene40 for id field; all other fields are just Lucene40):\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e                Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n            PKLookup      196.71        9.29      192.94        5.40   -8% -    5%\\n    HighSloppyPhrase        0.75        0.04        0.75        0.04  -10% -    9%\\n          HighPhrase        1.78        0.02        1.76        0.01   -2% -    0%\\n           MedPhrase        5.00        0.09        4.95        0.15   -5% -    3%\\n          AndHighMed       74.66        3.52       74.02        4.50  -11% -   10%\\n         AndHighHigh       16.94        0.82       16.83        0.78   -9% -    9%\\n     MedSloppyPhrase        4.10        0.11        4.08        0.12   -5% -    4%\\n           LowPhrase       13.35        0.19       13.31        0.24   -3% -    2%\\n     LowSloppyPhrase       31.91        0.52       31.90        0.58   -3% -    3%\\n          AndHighLow     1114.88       43.26     1121.52       33.72   -6% -    7%\\n         LowSpanNear        9.67        0.22        9.76        0.26   -4% -    5%\\n             LowTerm      421.55       14.96      426.55        5.23   -3% -    6%\\n             MedTerm      176.45        7.66      179.40        2.84   -4% -    7%\\n        HighSpanNear        1.43        0.03        1.45        0.05   -3% -    7%\\n         MedSpanNear        2.51        0.05        2.56        0.09   -3% -    7%\\n            HighTerm       15.52        0.95       15.90        0.24   -4% -   10%\\n             Respell       69.77        3.20       71.65        3.61   -6% -   13%\\n              Fuzzy1       88.19        2.49       91.04        3.06   -2% -    9%\\n              Fuzzy2       36.18        1.26       37.50        1.44   -3% -   11%\\n            Wildcard       45.33        1.52       47.04        1.10   -1% -    9%\\n             Prefix3       65.65        2.53       68.26        1.99   -2% -   11%\\n           OrHighLow       37.45        0.88       39.87        2.48   -2% -   15%\\n          OrHighHigh        9.58        0.10       10.23        0.64    0% -   14%\\n           OrHighMed       14.89        0.14       15.96        1.01    0% -   15%\\n              IntNRQ       10.24        1.04       11.07        1.33  -13% -   34%\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI just used the DefaultBloomFilterFactory, which should be good here since it targets 10% fill based on doc count.\u003c\\/p\u003e\\n\\n\u003cp\u003eMaybe even slight loss (but could easily be noise).  I confirmed that I\'m getting .blm files and that at search time the filter does in fact \\\"work\\\" (quickly returns false from seekExact).\u003c\\/p\u003e\\n\\n\u003cp\u003eThe differences vs. the dedicated benchmark on this issue is 1) luceneutil is only testing lookups, 2) the \\\"id\\\" field is just one field (ie we also have eg body\\/title\\/date for searching), 3) luceneutil is testing a bunch of other queries in other threads in addition to PKLookup.\u003c\\/p\u003e\\n\\n\u003cp\u003eOut of curiosity I also tried Memory vs Bloom + Memory, and Bloom was ~15% slower, I guess because computing the hash &amp; doing the lookup is non-trivial cost vs just walking the FST to find out the term doesn\'t exist.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13428839_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13428839_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Aug\\/12 12:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-05T12:13:35+0000\'\u003e05\\/Aug\\/12 12:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmm in testing Bloom + Lucene40 PF on luceneutil\'s \\\"id\\\" field I don\'t see any gains with what was committed (base=Lucene40 for id field, comp=Bloom + Lucene40 for id field; all other fields are just Lucene40): \\n\\n  \\n                 Task    QPS base StdDev base   QPS bloomStdDev bloom      Pct diff\\n            PKLookup      196.71        9.29      192.94        5.40   -8% -    5%\\n    HighSloppyPhrase        0.75        0.04        0.75        0.04  -10% -    9%\\n          HighPhrase        1.78        0.02        1.76        0.01   -2% -    0%\\n           MedPhrase        5.00        0.09        4.95        0.15   -5% -    3%\\n          AndHighMed       74.66        3.52       74.02        4.50  -11% -   10%\\n         AndHighHigh       16.94        0.82       16.83        0.78   -9% -    9%\\n     MedSloppyPhrase        4.10        0.11        4.08        0.12   -5% -    4%\\n           LowPhrase       13.35        0.19       13.31        0.24   -3% -    2%\\n     LowSloppyPhrase       31.91        0.52       31.90        0.58   -3% -    3%\\n          AndHighLow     1114.88       43.26     1121.52       33.72   -6% -    7%\\n         LowSpanNear        9.67        0.22        9.76        0.26   -4% -    5%\\n             LowTerm      421.55       14.96      426.55        5.23   -3% -    6%\\n             MedTerm      176.45        7.66      179.40        2.84   -4% -    7%\\n        HighSpanNear        1.43        0.03        1.45        0.05   -3% -    7%\\n         MedSpanNear        2.51        0.05        2.56        0.09   -3% -    7%\\n            HighTerm       15.52        0.95       15.90        0.24   -4% -   10%\\n             Respell       69.77        3.20       71.65        3.61   -6% -   13%\\n              Fuzzy1       88.19        2.49       91.04        3.06   -2% -    9%\\n              Fuzzy2       36.18        1.26       37.50        1.44   -3% -   11%\\n            Wildcard       45.33        1.52       47.04        1.10   -1% -    9%\\n             Prefix3       65.65        2.53       68.26        1.99   -2% -   11%\\n           OrHighLow       37.45        0.88       39.87        2.48   -2% -   15%\\n          OrHighHigh        9.58        0.10       10.23        0.64    0% -   14%\\n           OrHighMed       14.89        0.14       15.96        1.01    0% -   15%\\n              IntNRQ       10.24        1.04       11.07        1.33  -13% -   34%\\n \\n  \\n\\n I just used the DefaultBloomFilterFactory, which should be good here since it targets 10% fill based on doc count. \\n\\n Maybe even slight loss (but could easily be noise).  I confirmed that I\'m getting .blm files and that at search time the filter does in fact \\\"work\\\" (quickly returns false from seekExact). \\n\\n The differences vs. the dedicated benchmark on this issue is 1) luceneutil is only testing lookups, 2) the \\\"id\\\" field is just one field (ie we also have eg body\\/title\\/date for searching), 3) luceneutil is testing a bunch of other queries in other threads in addition to PKLookup. \\n\\n Out of curiosity I also tried Memory vs Bloom + Memory, and Bloom was ~15% slower, I guess because computing the hash &amp; doing the lookup is non-trivial cost vs just walking the FST to find out the term doesn\'t exist.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13428841\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13428841&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13428841\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13428841_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13428841_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Aug\\/12 12:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-05T12:14:35+0000\'\u003e05\\/Aug\\/12 12:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRemoving misleading 2X perf gain: it seems to depend heavily on the exact use case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mikemccand\\\" id=\\\"commentauthor_13428841_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mikemccand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mikemccand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Michael McCandless\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13428841_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Aug\\/12 12:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-05T12:14:35+0000\'\u003e05\\/Aug\\/12 12:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Removing misleading 2X perf gain: it seems to depend heavily on the exact use case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13430282\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13430282&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13430282\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhludnev\\\" id=\\\"commentauthor_13430282_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhludnev\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mikhail Khludnev\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13430282_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 10:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T10:52:20+0000\'\u003e07\\/Aug\\/12 10:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMark,\u003c\\/p\u003e\\n\\n\u003cp\u003eI see that several issues were fixed to land it to trunk\\/4.0. Is there bugs which should be fixed in initial 3.6 patch? I\'m asking because I need his feature but I\'m stuck with 3.x for a while. Do you recommend MHBloomFilterOn3.6Branch.patch for production use? \u003c\\/p\u003e\\n\\n\u003cp\u003ePS thanks for your contribution. it\'s awesome! \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mkhludnev\\\" id=\\\"commentauthor_13430282_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mkhludnev\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mkhludnev\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mikhail Khludnev\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13430282_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 10:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T10:52:20+0000\'\u003e07\\/Aug\\/12 10:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Mark, \\n\\n I see that several issues were fixed to land it to trunk\\/4.0. Is there bugs which should be fixed in initial 3.6 patch? I\'m asking because I need his feature but I\'m stuck with 3.x for a while. Do you recommend MHBloomFilterOn3.6Branch.patch for production use?  \\n\\n PS thanks for your contribution. it\'s awesome!               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13433045\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/LUCENE-4069?focusedCommentId=13433045&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13433045\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13433045_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13433045_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/12 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-13T10:29:25+0000\'\u003e13\\/Aug\\/12 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eRemoving misleading 2X perf gain: it seems to depend heavily on the exact use case.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eFair enough - the original patch targeted Lucene 3.6 which benefited more heavily from this technique. The issue then morphed into a 4.x patch where performance gains were harder to find. \u003cbr\\/\u003e\\nI think the sweet spot is in primary key searches on indexes with ongoing heavy changes (more segment fragmentation, less OS-level caching?). This is the use case I am targeting currently and my final tests using our primary-key-counting test rig saw a 10 to 15% improvement over Pulsing.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI\'m asking because I need his feature but I\'m stuck with 3.x for a while. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI have a client in a similar situation who are contemplating using the 3.6 patch.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIs there bugs which should be fixed in initial 3.6 patch? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIt has been a while since I looked at it - a quick run of \\\"ant test\\\" on my copy here showed no errors. I will be giving it a closer review if my client decides to go down this route and can post any fixes here.\u003cbr\\/\u003e\\nI expect if you use the patch and get into trouble you can use an un-patched version of 3.6 to read the same index files (it should just ignore the extra \\\"blm\\\" files created by the patched version).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markh\\\" id=\\\"commentauthor_13433045_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markh\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markh\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Harwood\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13433045_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/12 10:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-13T10:29:25+0000\'\u003e13\\/Aug\\/12 10:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Removing misleading 2X perf gain: it seems to depend heavily on the exact use case.  \\n\\n Fair enough - the original patch targeted Lucene 3.6 which benefited more heavily from this technique. The issue then morphed into a 4.x patch where performance gains were harder to find.  \\nI think the sweet spot is in primary key searches on indexes with ongoing heavy changes (more segment fragmentation, less OS-level caching?). This is the use case I am targeting currently and my final tests using our primary-key-counting test rig saw a 10 to 15% improvement over Pulsing. \\n\\n  I\'m asking because I need his feature but I\'m stuck with 3.x for a while.   \\n\\n I have a client in a similar situation who are contemplating using the 3.6 patch. \\n\\n  Is there bugs which should be fixed in initial 3.6 patch?   \\n\\n It has been a while since I looked at it - a quick run of \\\"ant test\\\" on my copy here showed no errors. I will be giving it a closer review if my client decides to go down this route and can post any fixes here. \\nI expect if you use the patch and get into trouble you can use an un-patched version of 3.6 to read the same index files (it should just ignore the extra \\\"blm\\\" files created by the patched version).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310110";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310110&amp;avatarId=10061\\\" alt=\\\"Lucene - Core\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/LUCENE\\/summary\\\" title=\\\"Lucene - Core\\\"\u003eLucene - Core\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/LUCENE?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1516204134064"> 
    <input type="hidden" title="jira.request.server.time" value="1511"> 
    <input type="hidden" title="jira.request.id" value="948x7747104x8"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="6"> 
    <input type="hidden" title="db.reads.time.in.ms" value="67"> 
    <input type="hidden" title="db.conns.time.in.ms" value="79"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 948x7747104x8
	          REQUEST TIMESTAMP : [17/Jan/2018:15:48:54 +0000]
	               REQUEST TIME : 1.5110
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 6

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=31, elapsedTotal=67736508, elapsedMin=700949, elapsedMax=25600275, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=35, elapsedTotal=79172642, elapsedMin=784142, elapsedMax=25719895, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>