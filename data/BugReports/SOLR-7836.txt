<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|dd8559a2db6848479ac8a6913fb08ecdbb67dd19|lout"> 
  <link rel="shortcut icon" href="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"jira.instrumentation.laas\":false,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"com.atlassian.jira.issuetable.draggable\":true,\"jira.create.linked.issue\":true,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"jira.jql.suggestrecentfields\":false,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"jira.jql.smartautoselectfirst\":false,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.priorities.per.project\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"jira.renderer.consider.variable.format\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/vnd.wap.wbmp,image/png,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"a5375a9bce19e1\"";
WRM._unparsedData["project-id"]="12310230";
WRM._unparsedData["project-key"]="\"SOLR\"";
WRM._unparsedData["project-name"]="\"Solr\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310230";
WRM._unparsedData["projectKey"]="\"SOLR\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/74ac580603ca910fff0cfdf319e54add-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/98ceb006e504d7924d5ffc411626c6bc-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/c1e4d26ea276469807c3dc0918df482c-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/fbf45109b31165e5b7740a9d72318cea/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/6bf9253c8d533109c3b02e26794be24e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/ccd2e67b523185973473e8bd5735c8f9-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/33e5e0166867c8c9228d44506f60b2e8/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/6579b6b8ba67abaa496e39b9242a18a4-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="SOLR-7836"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[SOLR-7836] Possible deadlock when closing refcounted index writers. - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[SOLR-7836] Possible deadlock when closing refcounted index writers. - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/SOLR" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-7836">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310230" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Solr'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310230&amp;avatarId=22151"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/SOLR">Solr</a></li>
                 <li><a class="issue-link" data-issue-key="SOLR-7836" href="/jira/browse/SOLR-7836" id="key-val" rel="12849423">SOLR-7836</a></li>
                </ol>
                <h1 id="summary-val">Possible deadlock when closing refcounted index writers.</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-7836"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/SOLR-7836/SOLR-7836.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/SOLR-7836/SOLR-7836.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/SOLR-7836/SOLR-7836.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/SOLR-7836/SOLR-7836.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" title="Bug - A problem which impairs or prevents the functions of the product." width="16"> Bug </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+5.4" title="5.4 Major release after 5.3">5.4</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+6.0" title="6.0 First 6.x release, Major release after 5.5">6.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12849423-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Preliminary patch for what looks like a possible race condition between writerFree and pauseWriter in DefaultSorlCoreState.</p> 
                  <p>Looking for comments and/or why I'm completely missing the boat.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/SOLR-7836?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/SOLR-7836?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/SOLR-7836?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/SOLR-7836?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12749915" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12749915/deadlock_3.res.zip" draggable="true" data-downloadurl="application/zip:deadlock_3.res.zip:https://issues.apache.org/jira/secure/attachment/12749915/deadlock_3.res.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12749915/deadlock_3.res.zip" title="Latest  11/Aug/15 19:30 - Erick Erickson" draggable="true" data-downloadurl="application/zip:deadlock_3.res.zip:https://issues.apache.org/jira/secure/attachment/12749915/deadlock_3.res.zip">deadlock_3.res.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-11T19:30:35.224Z">11/Aug/15 19:30</time>
                   </dd>
                   <dd class="attachment-size">
                    46 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12749942" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12749942/deadlock_5_pass_iw.res.zip" draggable="true" data-downloadurl="application/zip:deadlock_5_pass_iw.res.zip:https://issues.apache.org/jira/secure/attachment/12749942/deadlock_5_pass_iw.res.zip"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-zip" title="Zip Archive"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12749942/deadlock_5_pass_iw.res.zip" title="Latest  11/Aug/15 20:54 - Erick Erickson" draggable="true" data-downloadurl="application/zip:deadlock_5_pass_iw.res.zip:https://issues.apache.org/jira/secure/attachment/12749942/deadlock_5_pass_iw.res.zip">deadlock_5_pass_iw.res.zip</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-11T20:54:55.175Z">11/Aug/15 20:54</time>
                   </dd>
                   <dd class="attachment-size">
                    113 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12749916" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12749916/deadlock_test" draggable="true" data-downloadurl="text/html:deadlock_test:https://issues.apache.org/jira/secure/attachment/12749916/deadlock_test"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-code" title="HTML File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12749916/deadlock_test" title="Latest  11/Aug/15 19:30 - Erick Erickson" draggable="true" data-downloadurl="text/html:deadlock_test:https://issues.apache.org/jira/secure/attachment/12749916/deadlock_test">deadlock_test</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-11T19:30:35.238Z">11/Aug/15 19:30</time>
                   </dd>
                   <dd class="attachment-size">
                    0.8 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12753555" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12753555/SOLR-7836.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12753555/SOLR-7836.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12753555/SOLR-7836.patch" title="Latest  01/Sep/15 16:51 - Yonik Seeley" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12753555/SOLR-7836.patch">SOLR-7836.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-09-01T16:51:49.277Z">01/Sep/15 16:51</time>
                   </dd>
                   <dd class="attachment-size">
                    16 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12751557" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12751557/SOLR-7836.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12751557/SOLR-7836.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12751557/SOLR-7836.patch" title=" 20/Aug/15 19:08 - Yonik Seeley" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12751557/SOLR-7836.patch">SOLR-7836.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-20T19:08:20.448Z">20/Aug/15 19:08</time>
                   </dd>
                   <dd class="attachment-size">
                    15 kB
                   </dd>
                   <dd class="attachment-author">
                    Yonik Seeley
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12749423" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12749423/SOLR-7836.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12749423/SOLR-7836.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12749423/SOLR-7836.patch" title=" 08/Aug/15 16:39 - Erick Erickson" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12749423/SOLR-7836.patch">SOLR-7836.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-08T16:39:33.601Z">08/Aug/15 16:39</time>
                   </dd>
                   <dd class="attachment-size">
                    24 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12749404" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12749404/SOLR-7836.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12749404/SOLR-7836.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12749404/SOLR-7836.patch" title=" 08/Aug/15 05:30 - Erick Erickson" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12749404/SOLR-7836.patch">SOLR-7836.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-08T05:30:11.133Z">08/Aug/15 05:30</time>
                   </dd>
                   <dd class="attachment-size">
                    24 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12747427" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12747427/SOLR-7836.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12747427/SOLR-7836.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12747427/SOLR-7836.patch" title=" 27/Jul/15 21:28 - Erick Erickson" draggable="true" data-downloadurl="text/plain:SOLR-7836.patch:https://issues.apache.org/jira/secure/attachment/12747427/SOLR-7836.patch">SOLR-7836.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-07-27T21:28:55.029Z">27/Jul/15 21:28</time>
                   </dd>
                   <dd class="attachment-size">
                    5 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12751314" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12751314/SOLR-7836-reorg.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836-reorg.patch:https://issues.apache.org/jira/secure/attachment/12751314/SOLR-7836-reorg.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12751314/SOLR-7836-reorg.patch" title="Latest  19/Aug/15 18:11 - Erick Erickson" draggable="true" data-downloadurl="text/plain:SOLR-7836-reorg.patch:https://issues.apache.org/jira/secure/attachment/12751314/SOLR-7836-reorg.patch">SOLR-7836-reorg.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-19T18:11:40.002Z">19/Aug/15 18:11</time>
                   </dd>
                   <dd class="attachment-size">
                    6 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12749489" data-issue-id="12849423" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12749489/SOLR-7836-synch.patch" draggable="true" data-downloadurl="text/plain:SOLR-7836-synch.patch:https://issues.apache.org/jira/secure/attachment/12749489/SOLR-7836-synch.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12749489/SOLR-7836-synch.patch" title="Latest  09/Aug/15 21:34 - Erick Erickson" draggable="true" data-downloadurl="text/plain:SOLR-7836-synch.patch:https://issues.apache.org/jira/secure/attachment/12749489/SOLR-7836-synch.patch">SOLR-7836-synch.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2015-08-09T21:34:51.815Z">09/Aug/15 21:34</time>
                   </dd>
                   <dd class="attachment-size">
                    1 kB
                   </dd>
                   <dd class="attachment-author">
                    Erick Erickson
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_yseeley@gmail.com" rel="yseeley@gmail.com" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Yonik Seeley&quot;,&quot;emailAddress&quot;:&quot;yseeley@gmail.com&quot;,&quot;username&quot;:&quot;yseeley@gmail.com&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="yseeley@gmail.com"></span></span> Yonik Seeley </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_erickerickson" rel="erickerickson" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Erick Erickson&quot;,&quot;emailAddress&quot;:&quot;erickerickson@gmail.com&quot;,&quot;username&quot;:&quot;erickerickson&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="erickerickson"></span></span> Erick Erickson </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">0</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">5</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="27/Jul/15 20:39"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2015-07-27T20:39:50+0000">27/Jul/15 20:39</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/May/16 18:44"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-09T18:44:53+0000">09/May/16 18:44</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="03/Sep/15 15:16"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2015-09-03T15:16:37+0000">03/Sep/15 15:16</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-7836?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/SOLR-7836?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-14643433\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14643433&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14643433\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14643433_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14643433_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jul\\/15 21:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-07-27T21:28:55+0000\'\u003e27\\/Jul\\/15 21:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooking for comments:\u003c\\/p\u003e\\n\\n\u003cp\u003eThis looks like I changed more than I did. Expanded the scope of the try\\/finally block in newIndexWriter, moved the common code for initializing outside an else clause and put a try\\/finally block in closeIndexWriter. The rest of the diff is just noise due to indentation.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have a field report and stack traces of a deadlock, here\'s the stack trace:\u003c\\/p\u003e\\n\\n\u003cp\u003eI think that the first two in DefaultSolrCoreState are where I\'m guessing the root of the problem lies.\u003c\\/p\u003e\\n\\n\u003cp\u003e********************First thread in DefaultSolrCoreState \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThe thread that owns the updateLock is stuck waiting for pauseWriter to go to false so it can get the IndexWriter:\u003cbr\\/\u003e\\njava.lang.Object@c0d4b9 \u003cbr\\/\u003e\\njava.lang.Object.wait\\u200B(Native Method) \u003cbr\\/\u003e\\norg.apache.solr.update.DefaultSolrCoreState.getIndexWriter\\u200B(DefaultSolrCoreState.java:94) \u003cbr\\/\u003e\\norg.apache.solr.update.DirectUpdateHandler2.addAndDelete\\u200B(DirectUpdateHandler2.java:436) \u003cbr\\/\u003e\\norg.apache.solr.update.DirectUpdateHandler2.addDoc0\\u200B(DirectUpdateHandler2.java:216) \u003cbr\\/\u003e\\norg.apache.solr.update.DirectUpdateHandler2.addDoc\\u200B(DirectUpdateHandler2.java:160) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.RunUpdateProcessor.processAdd\\u200B(RunUpdateProcessorFactory.java:69) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.UpdateRequestProcessor.processAdd\\u200B(UpdateRequestProcessor.java:51) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd\\u200B(DistributedUpdateProcessor.java:928) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd\\u200B(DistributedUpdateProcessor.java:1082) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.DistributedUpdateProcessor.processAdd\\u200B(DistributedUpdateProcessor.java:695) \u003cbr\\/\u003e\\norg.apache.solr.handler.loader.JavabinLoader$1.update\\u200B(JavabinLoader.java:96) \u003cbr\\/\u003e\\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readOuterMostDocIterator\\u200B(JavaBinUpdateRequestCodec.java:166) \u003cbr\\/\u003e\\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readIterator\\u200B(JavaBinUpdateRequestCodec.java:136) \u003cbr\\/\u003e\\norg.apache.solr.common.util.JavaBinCodec.readVal\\u200B(JavaBinCodec.java:225) \u003cbr\\/\u003e\\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readNamedList\\u200B(JavaBinUpdateRequestCodec.java:121) \u003cbr\\/\u003e\\norg.apache.solr.common.util.JavaBinCodec.readVal\\u200B(JavaBinCodec.java:190) \u003cbr\\/\u003e\\norg.apache.solr.common.util.JavaBinCodec.unmarshal\\u200B(JavaBinCodec.java:116) \u003cbr\\/\u003e\\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.unmarshal\\u200B(JavaBinUpdateRequestCodec.java:173) \u003cbr\\/\u003e\\norg.apache.solr.handler.loader.JavabinLoader.parseAndLoadDocs\\u200B(JavabinLoader.java:106) \u003cbr\\/\u003e\\norg.apache.solr.handler.loader.JavabinLoader.load\\u200B(JavabinLoader.java:58) \u003cbr\\/\u003e\\norg.apache.solr.handler.UpdateRequestHandler$1.load\\u200B(UpdateRequestHandler.java:92) \u003cbr\\/\u003e\\norg.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody\\u200B(ContentStreamHandlerBase.java:74) \u003cbr\\/\u003e\\norg.apache.solr.handler.RequestHandlerBase.handleRequest\\u200B(RequestHandlerBase.java:135) \u003cbr\\/\u003e\\norg.apache.solr.core.SolrCore.execute\\u200B(SolrCore.java:1956) \u003cbr\\/\u003e\\norg.apache.solr.servlet.SolrDispatchFilter.execute\\u200B(SolrDispatchFilter.java:799) \u003cbr\\/\u003e\\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:422) \u003cbr\\/\u003e\\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:208) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419) \u003cbr\\/\u003e\\ncom.apple.cie.search.plugin.auth.TrustFilter.doFilter\\u200B(TrustFilter.java:43) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler.doHandle\\u200B(ServletHandler.java:455) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:137) \u003cbr\\/\u003e\\norg.eclipse.jetty.security.SecurityHandler.handle\\u200B(SecurityHandler.java:557) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.session.SessionHandler.doHandle\\u200B(SessionHandler.java:231) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ContextHandler.doHandle\\u200B(ContextHandler.java:1075) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler.doScope\\u200B(ServletHandler.java:384) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.session.SessionHandler.doScope\\u200B(SessionHandler.java:193) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ContextHandler.doScope\\u200B(ContextHandler.java:1009) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:135) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ContextHandlerCollection.handle\\u200B(ContextHandlerCollection.java:255) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.HandlerCollection.handle\\u200B(HandlerCollection.java:154) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.HandlerWrapper.handle\\u200B(HandlerWrapper.java:116) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.Server.handle\\u200B(Server.java:368) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.AbstractHttpConnection.handleRequest\\u200B(AbstractHttpConnection.java:489) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.BlockingHttpConnection.handleRequest\\u200B(BlockingHttpConnection.java:53) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.AbstractHttpConnection.content\\u200B(AbstractHttpConnection.java:953) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content\\u200B(AbstractHttpConnection.java:1014) \u003cbr\\/\u003e\\norg.eclipse.jetty.http.HttpParser.parseNext\\u200B(HttpParser.java:953) \u003cbr\\/\u003e\\norg.eclipse.jetty.http.HttpParser.parseAvailable\\u200B(HttpParser.java:240) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.BlockingHttpConnection.handle\\u200B(BlockingHttpConnection.java:72) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run\\u200B(SocketConnector.java:264) \u003cbr\\/\u003e\\norg.eclipse.jetty.util.thread.QueuedThreadPool.runJob\\u200B(QueuedThreadPool.java:608) \u003cbr\\/\u003e\\norg.eclipse.jetty.util.thread.QueuedThreadPool$3.run\\u200B(QueuedThreadPool.java:543) \u003cbr\\/\u003e\\njava.lang.Thread.run\\u200B(Thread.java:745)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003e********************Second thread in DefaultSolrCoreState \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eThe thread that sets pauseWriter to true that is supposed to later set it to false is stuck on waiting for writerFree to go to true:\u003cbr\\/\u003e\\njava.lang.Object@c0d4b9 \u003cbr\\/\u003e\\njava.lang.Object.wait\\u200B(Native Method) \u003cbr\\/\u003e\\norg.apache.solr.update.DefaultSolrCoreState.newIndexWriter\\u200B(DefaultSolrCoreState.java:156) \u003cbr\\/\u003e\\norg.apache.solr.core.SolrCore.reload\\u200B(SolrCore.java:431) \u003cbr\\/\u003e\\norg.apache.solr.core.CoreContainer.reload\\u200B(CoreContainer.java:586) \u003cbr\\/\u003e\\norg.apache.solr.handler.admin.CoreAdminHandler.handleReloadAction\\u200B(CoreAdminHandler.java:701) \u003cbr\\/\u003e\\norg.apache.solr.handler.admin.CoreAdminHandler.handleRequestInternal\\u200B(CoreAdminHandler.java:225) \u003cbr\\/\u003e\\norg.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody\\u200B(CoreAdminHandler.java:188) \u003cbr\\/\u003e\\norg.apache.solr.handler.RequestHandlerBase.handleRequest\\u200B(RequestHandlerBase.java:135) \u003cbr\\/\u003e\\norg.apache.solr.servlet.SolrDispatchFilter.handleAdminRequest\\u200B(SolrDispatchFilter.java:751) \u003cbr\\/\u003e\\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:259) \u003cbr\\/\u003e\\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:208) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419) \u003cbr\\/\u003e\\ncom.apple.cie.search.plugin.auth.TrustFilter.doFilter\\u200B(TrustFilter.java:43) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler.doHandle\\u200B(ServletHandler.java:455) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:137) \u003cbr\\/\u003e\\norg.eclipse.jetty.security.SecurityHandler.handle\\u200B(SecurityHandler.java:557) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.session.SessionHandler.doHandle\\u200B(SessionHandler.java:231) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ContextHandler.doHandle\\u200B(ContextHandler.java:1075) \u003cbr\\/\u003e\\norg.eclipse.jetty.servlet.ServletHandler.doScope\\u200B(ServletHandler.java:384) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.session.SessionHandler.doScope\\u200B(SessionHandler.java:193) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ContextHandler.doScope\\u200B(ContextHandler.java:1009) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:135) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.ContextHandlerCollection.handle\\u200B(ContextHandlerCollection.java:255) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.HandlerCollection.handle\\u200B(HandlerCollection.java:154) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.handler.HandlerWrapper.handle\\u200B(HandlerWrapper.java:116) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.Server.handle\\u200B(Server.java:368) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.AbstractHttpConnection.handleRequest\\u200B(AbstractHttpConnection.java:489) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.BlockingHttpConnection.handleRequest\\u200B(BlockingHttpConnection.java:53) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.AbstractHttpConnection.content\\u200B(AbstractHttpConnection.java:953) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content\\u200B(AbstractHttpConnection.java:1014) \u003cbr\\/\u003e\\norg.eclipse.jetty.http.HttpParser.parseNext\\u200B(HttpParser.java:861) \u003cbr\\/\u003e\\norg.eclipse.jetty.http.HttpParser.parseAvailable\\u200B(HttpParser.java:240) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.BlockingHttpConnection.handle\\u200B(BlockingHttpConnection.java:72) \u003cbr\\/\u003e\\norg.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run\\u200B(SocketConnector.java:264) \u003cbr\\/\u003e\\norg.eclipse.jetty.util.thread.QueuedThreadPool.runJob\\u200B(QueuedThreadPool.java:608) \u003cbr\\/\u003e\\norg.eclipse.jetty.util.thread.QueuedThreadPool$3.run\\u200B(QueuedThreadPool.java:543) \u003cbr\\/\u003e\\njava.lang.Thread.run\\u200B(Thread.java:745)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003e****************Lots of threads stuck in DirectUpdateHandler2, but I suspect these aren\'t where the problem really is:\u003cbr\\/\u003e\\njava.lang.Object@73cdbe11 \u003cbr\\/\u003e\\norg.apache.solr.update.DirectUpdateHandler2.addAndDelete\\u200B(DirectUpdateHandler2.java:435) \u003cbr\\/\u003e\\norg.apache.solr.update.DirectUpdateHandler2.addDoc0\\u200B(DirectUpdateHandler2.java:216) \u003cbr\\/\u003e\\norg.apache.solr.update.DirectUpdateHandler2.addDoc\\u200B(DirectUpdateHandler2.java:160) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.RunUpdateProcessor.processAdd\\u200B(RunUpdateProcessorFactory.java:69) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.UpdateRequestProcessor.processAdd\\u200B(UpdateRequestProcessor.java:51) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd\\u200B(DistributedUpdateProcessor.java:928) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd\\u200B(DistributedUpdateProcessor.java:1082) \u003cbr\\/\u003e\\norg.apache.solr.update.processor.DistributedUpdateProcessor.processAdd\\u200B(DistributedUpdateProcessor.java:695) \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14643433_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14643433_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jul\\/15 21:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-07-27T21:28:55+0000\'\u003e27\\/Jul\\/15 21:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looking for comments: \\n\\n This looks like I changed more than I did. Expanded the scope of the try\\/finally block in newIndexWriter, moved the common code for initializing outside an else clause and put a try\\/finally block in closeIndexWriter. The rest of the diff is just noise due to indentation. \\n\\n I have a field report and stack traces of a deadlock, here\'s the stack trace: \\n\\n I think that the first two in DefaultSolrCoreState are where I\'m guessing the root of the problem lies. \\n\\n ********************First thread in DefaultSolrCoreState  \\n \\n\\t The thread that owns the updateLock is stuck waiting for pauseWriter to go to false so it can get the IndexWriter: \\njava.lang.Object@c0d4b9  \\njava.lang.Object.wait\\u200B(Native Method)  \\norg.apache.solr.update.DefaultSolrCoreState.getIndexWriter\\u200B(DefaultSolrCoreState.java:94)  \\norg.apache.solr.update.DirectUpdateHandler2.addAndDelete\\u200B(DirectUpdateHandler2.java:436)  \\norg.apache.solr.update.DirectUpdateHandler2.addDoc0\\u200B(DirectUpdateHandler2.java:216)  \\norg.apache.solr.update.DirectUpdateHandler2.addDoc\\u200B(DirectUpdateHandler2.java:160)  \\norg.apache.solr.update.processor.RunUpdateProcessor.processAdd\\u200B(RunUpdateProcessorFactory.java:69)  \\norg.apache.solr.update.processor.UpdateRequestProcessor.processAdd\\u200B(UpdateRequestProcessor.java:51)  \\norg.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd\\u200B(DistributedUpdateProcessor.java:928)  \\norg.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd\\u200B(DistributedUpdateProcessor.java:1082)  \\norg.apache.solr.update.processor.DistributedUpdateProcessor.processAdd\\u200B(DistributedUpdateProcessor.java:695)  \\norg.apache.solr.handler.loader.JavabinLoader$1.update\\u200B(JavabinLoader.java:96)  \\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readOuterMostDocIterator\\u200B(JavaBinUpdateRequestCodec.java:166)  \\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readIterator\\u200B(JavaBinUpdateRequestCodec.java:136)  \\norg.apache.solr.common.util.JavaBinCodec.readVal\\u200B(JavaBinCodec.java:225)  \\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec$1.readNamedList\\u200B(JavaBinUpdateRequestCodec.java:121)  \\norg.apache.solr.common.util.JavaBinCodec.readVal\\u200B(JavaBinCodec.java:190)  \\norg.apache.solr.common.util.JavaBinCodec.unmarshal\\u200B(JavaBinCodec.java:116)  \\norg.apache.solr.client.solrj.request.JavaBinUpdateRequestCodec.unmarshal\\u200B(JavaBinUpdateRequestCodec.java:173)  \\norg.apache.solr.handler.loader.JavabinLoader.parseAndLoadDocs\\u200B(JavabinLoader.java:106)  \\norg.apache.solr.handler.loader.JavabinLoader.load\\u200B(JavabinLoader.java:58)  \\norg.apache.solr.handler.UpdateRequestHandler$1.load\\u200B(UpdateRequestHandler.java:92)  \\norg.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody\\u200B(ContentStreamHandlerBase.java:74)  \\norg.apache.solr.handler.RequestHandlerBase.handleRequest\\u200B(RequestHandlerBase.java:135)  \\norg.apache.solr.core.SolrCore.execute\\u200B(SolrCore.java:1956)  \\norg.apache.solr.servlet.SolrDispatchFilter.execute\\u200B(SolrDispatchFilter.java:799)  \\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:422)  \\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:208)  \\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419)  \\ncom.apple.cie.search.plugin.auth.TrustFilter.doFilter\\u200B(TrustFilter.java:43)  \\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419)  \\norg.eclipse.jetty.servlet.ServletHandler.doHandle\\u200B(ServletHandler.java:455)  \\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:137)  \\norg.eclipse.jetty.security.SecurityHandler.handle\\u200B(SecurityHandler.java:557)  \\norg.eclipse.jetty.server.session.SessionHandler.doHandle\\u200B(SessionHandler.java:231)  \\norg.eclipse.jetty.server.handler.ContextHandler.doHandle\\u200B(ContextHandler.java:1075)  \\norg.eclipse.jetty.servlet.ServletHandler.doScope\\u200B(ServletHandler.java:384)  \\norg.eclipse.jetty.server.session.SessionHandler.doScope\\u200B(SessionHandler.java:193)  \\norg.eclipse.jetty.server.handler.ContextHandler.doScope\\u200B(ContextHandler.java:1009)  \\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:135)  \\norg.eclipse.jetty.server.handler.ContextHandlerCollection.handle\\u200B(ContextHandlerCollection.java:255)  \\norg.eclipse.jetty.server.handler.HandlerCollection.handle\\u200B(HandlerCollection.java:154)  \\norg.eclipse.jetty.server.handler.HandlerWrapper.handle\\u200B(HandlerWrapper.java:116)  \\norg.eclipse.jetty.server.Server.handle\\u200B(Server.java:368)  \\norg.eclipse.jetty.server.AbstractHttpConnection.handleRequest\\u200B(AbstractHttpConnection.java:489)  \\norg.eclipse.jetty.server.BlockingHttpConnection.handleRequest\\u200B(BlockingHttpConnection.java:53)  \\norg.eclipse.jetty.server.AbstractHttpConnection.content\\u200B(AbstractHttpConnection.java:953)  \\norg.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content\\u200B(AbstractHttpConnection.java:1014)  \\norg.eclipse.jetty.http.HttpParser.parseNext\\u200B(HttpParser.java:953)  \\norg.eclipse.jetty.http.HttpParser.parseAvailable\\u200B(HttpParser.java:240)  \\norg.eclipse.jetty.server.BlockingHttpConnection.handle\\u200B(BlockingHttpConnection.java:72)  \\norg.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run\\u200B(SocketConnector.java:264)  \\norg.eclipse.jetty.util.thread.QueuedThreadPool.runJob\\u200B(QueuedThreadPool.java:608)  \\norg.eclipse.jetty.util.thread.QueuedThreadPool$3.run\\u200B(QueuedThreadPool.java:543)  \\njava.lang.Thread.run\\u200B(Thread.java:745) \\n \\n\\n\\n\\n ********************Second thread in DefaultSolrCoreState  \\n \\n\\t The thread that sets pauseWriter to true that is supposed to later set it to false is stuck on waiting for writerFree to go to true: \\njava.lang.Object@c0d4b9  \\njava.lang.Object.wait\\u200B(Native Method)  \\norg.apache.solr.update.DefaultSolrCoreState.newIndexWriter\\u200B(DefaultSolrCoreState.java:156)  \\norg.apache.solr.core.SolrCore.reload\\u200B(SolrCore.java:431)  \\norg.apache.solr.core.CoreContainer.reload\\u200B(CoreContainer.java:586)  \\norg.apache.solr.handler.admin.CoreAdminHandler.handleReloadAction\\u200B(CoreAdminHandler.java:701)  \\norg.apache.solr.handler.admin.CoreAdminHandler.handleRequestInternal\\u200B(CoreAdminHandler.java:225)  \\norg.apache.solr.handler.admin.CoreAdminHandler.handleRequestBody\\u200B(CoreAdminHandler.java:188)  \\norg.apache.solr.handler.RequestHandlerBase.handleRequest\\u200B(RequestHandlerBase.java:135)  \\norg.apache.solr.servlet.SolrDispatchFilter.handleAdminRequest\\u200B(SolrDispatchFilter.java:751)  \\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:259)  \\norg.apache.solr.servlet.SolrDispatchFilter.doFilter\\u200B(SolrDispatchFilter.java:208)  \\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419)  \\ncom.apple.cie.search.plugin.auth.TrustFilter.doFilter\\u200B(TrustFilter.java:43)  \\norg.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter\\u200B(ServletHandler.java:1419)  \\norg.eclipse.jetty.servlet.ServletHandler.doHandle\\u200B(ServletHandler.java:455)  \\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:137)  \\norg.eclipse.jetty.security.SecurityHandler.handle\\u200B(SecurityHandler.java:557)  \\norg.eclipse.jetty.server.session.SessionHandler.doHandle\\u200B(SessionHandler.java:231)  \\norg.eclipse.jetty.server.handler.ContextHandler.doHandle\\u200B(ContextHandler.java:1075)  \\norg.eclipse.jetty.servlet.ServletHandler.doScope\\u200B(ServletHandler.java:384)  \\norg.eclipse.jetty.server.session.SessionHandler.doScope\\u200B(SessionHandler.java:193)  \\norg.eclipse.jetty.server.handler.ContextHandler.doScope\\u200B(ContextHandler.java:1009)  \\norg.eclipse.jetty.server.handler.ScopedHandler.handle\\u200B(ScopedHandler.java:135)  \\norg.eclipse.jetty.server.handler.ContextHandlerCollection.handle\\u200B(ContextHandlerCollection.java:255)  \\norg.eclipse.jetty.server.handler.HandlerCollection.handle\\u200B(HandlerCollection.java:154)  \\norg.eclipse.jetty.server.handler.HandlerWrapper.handle\\u200B(HandlerWrapper.java:116)  \\norg.eclipse.jetty.server.Server.handle\\u200B(Server.java:368)  \\norg.eclipse.jetty.server.AbstractHttpConnection.handleRequest\\u200B(AbstractHttpConnection.java:489)  \\norg.eclipse.jetty.server.BlockingHttpConnection.handleRequest\\u200B(BlockingHttpConnection.java:53)  \\norg.eclipse.jetty.server.AbstractHttpConnection.content\\u200B(AbstractHttpConnection.java:953)  \\norg.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.content\\u200B(AbstractHttpConnection.java:1014)  \\norg.eclipse.jetty.http.HttpParser.parseNext\\u200B(HttpParser.java:861)  \\norg.eclipse.jetty.http.HttpParser.parseAvailable\\u200B(HttpParser.java:240)  \\norg.eclipse.jetty.server.BlockingHttpConnection.handle\\u200B(BlockingHttpConnection.java:72)  \\norg.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run\\u200B(SocketConnector.java:264)  \\norg.eclipse.jetty.util.thread.QueuedThreadPool.runJob\\u200B(QueuedThreadPool.java:608)  \\norg.eclipse.jetty.util.thread.QueuedThreadPool$3.run\\u200B(QueuedThreadPool.java:543)  \\njava.lang.Thread.run\\u200B(Thread.java:745) \\n \\n\\n\\n ****************Lots of threads stuck in DirectUpdateHandler2, but I suspect these aren\'t where the problem really is: \\njava.lang.Object@73cdbe11  \\norg.apache.solr.update.DirectUpdateHandler2.addAndDelete\\u200B(DirectUpdateHandler2.java:435)  \\norg.apache.solr.update.DirectUpdateHandler2.addDoc0\\u200B(DirectUpdateHandler2.java:216)  \\norg.apache.solr.update.DirectUpdateHandler2.addDoc\\u200B(DirectUpdateHandler2.java:160)  \\norg.apache.solr.update.processor.RunUpdateProcessor.processAdd\\u200B(RunUpdateProcessorFactory.java:69)  \\norg.apache.solr.update.processor.UpdateRequestProcessor.processAdd\\u200B(UpdateRequestProcessor.java:51)  \\norg.apache.solr.update.processor.DistributedUpdateProcessor.doLocalAdd\\u200B(DistributedUpdateProcessor.java:928)  \\norg.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd\\u200B(DistributedUpdateProcessor.java:1082)  \\norg.apache.solr.update.processor.DistributedUpdateProcessor.processAdd\\u200B(DistributedUpdateProcessor.java:695)               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14644312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14644312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14644312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14644312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14644312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/15 12:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-07-28T12:39:50+0000\'\u003e28\\/Jul\\/15 12:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, the patch doesn\'t address the real issue. I still think it\'s bad to leave those dangling pauseWriters around, but the \u003cem\u003ereal\u003c\\/em\u003e issue appears to be over in DirectUpdateHandler2. There\'s a ref counted index writer obtained in addDoc0. But then addDoc0 calls addAndDelete which tries to get a ref counted index writer again. If another thread sets pauseWriter in between, then it\'s deadlocked.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think the solution is to just pass the IndexWriter down to addAndDelete, but won\'t have time to really look until this evening.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14644312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14644312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/15 12:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-07-28T12:39:50+0000\'\u003e28\\/Jul\\/15 12:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, the patch doesn\'t address the real issue. I still think it\'s bad to leave those dangling pauseWriters around, but the  real  issue appears to be over in DirectUpdateHandler2. There\'s a ref counted index writer obtained in addDoc0. But then addDoc0 calls addAndDelete which tries to get a ref counted index writer again. If another thread sets pauseWriter in between, then it\'s deadlocked. \\n\\n I think the solution is to just pass the IndexWriter down to addAndDelete, but won\'t have time to really look until this evening.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14644420\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14644420&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14644420\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14644420_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14644420_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/15 14:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-07-28T14:21:13+0000\'\u003e28\\/Jul\\/15 14:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat sounds like it\'s right - been awhile since I\'ve looked at the code, but the idea is, you get a writer, use it briefly, then release it in a finally. There should not be code that gets a writer, then gets a writer, then tries to release both of them after.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14644420_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14644420_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jul\\/15 14:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-07-28T14:21:13+0000\'\u003e28\\/Jul\\/15 14:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That sounds like it\'s right - been awhile since I\'ve looked at the code, but the idea is, you get a writer, use it briefly, then release it in a finally. There should not be code that gets a writer, then gets a writer, then tries to release both of them after.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14661370\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14661370&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14661370\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14661370_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661370_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 05:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T05:45:15+0000\'\u003e07\\/Aug\\/15 05:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, I\'ve kicked the can down the road, but now there\'s a different deadlock. I wrote a test to beat the heck out of the update\\/delete-by-query\\/reload stuff and after the changes above....\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the morning when I\'m fresher I\'ll look at why there are so many different things that need to have locks on them. But we have updateLock, and loops like below that \u003cem\u003eseem\u003c\\/em\u003e to be locking each other out.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e (and anyone else) Loops like this seem fraught, or is it just me and it\'s late?:\u003cbr\\/\u003e\\n        while (!writerFree) {\u003cbr\\/\u003e\\n          try \u003c\\/p\u003e\\n{\\n            writerPauseLock.wait(100);\\n          }\\n\u003cp\u003e catch (InterruptedException e) {}\u003cbr\\/\u003e\\n          if (closed) \u003c\\/p\u003e\\n{\\n            throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE, \\\"SolrCoreState already closed\\\");\\n          }\\n\u003cp\u003e        }\u003c\\/p\u003e\\n\\n\u003cp\u003eand wait until some other thread sets writerFree to true. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14661370_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661370_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 05:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T05:45:15+0000\'\u003e07\\/Aug\\/15 05:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, I\'ve kicked the can down the road, but now there\'s a different deadlock. I wrote a test to beat the heck out of the update\\/delete-by-query\\/reload stuff and after the changes above.... \\n\\n In the morning when I\'m fresher I\'ll look at why there are so many different things that need to have locks on them. But we have updateLock, and loops like below that  seem  to be locking each other out. \\n\\n  Yonik Seeley   Mark Miller  (and anyone else) Loops like this seem fraught, or is it just me and it\'s late?: \\n        while (!writerFree) { \\n          try  \\n{\\n            writerPauseLock.wait(100);\\n          }\\n  catch (InterruptedException e) {} \\n          if (closed)  \\n{\\n            throw new SolrException(ErrorCode.SERVICE_UNAVAILABLE, \\\"SolrCoreState already closed\\\");\\n          }\\n         } \\n\\n and wait until some other thread sets writerFree to true.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14661739\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14661739&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14661739\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14661739_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661739_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 12:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T12:17:05+0000\'\u003e07\\/Aug\\/15 12:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat\'s wrong with the loop?\u003c\\/p\u003e\\n\\n\u003cp\u003eThe code in place is pretty tricky because it had to retrofitted onto a model that did not fit the right model to make it fit the right model \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m not exactly sure what you are point out in the loop though.\u003c\\/p\u003e\\n\\n\u003cp\u003eDo you have stack traces for the latest deadlock? Can you share the new test?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14661739_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661739_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 12:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T12:17:05+0000\'\u003e07\\/Aug\\/15 12:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What\'s wrong with the loop? \\n\\n The code in place is pretty tricky because it had to retrofitted onto a model that did not fit the right model to make it fit the right model   \\n\\n I\'m not exactly sure what you are point out in the loop though. \\n\\n Do you have stack traces for the latest deadlock? Can you share the new test?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14661898\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14661898&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14661898\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14661898_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661898_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T14:26:02+0000\'\u003e07\\/Aug\\/15 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWell, something that sits in a while loop waiting for another thread to change a variable before doing anything seems like it\'s harder to get right than some kind of notification. As I\'m finding. But I\'m terrified of changing the total approach. \u003c\\/p\u003e\\n\\n\u003cp\u003eI need to dig some more before posting stack traces, plus it\'s the trace with this patch applied (and maybe changed)....\u003c\\/p\u003e\\n\\n\u003cp\u003eMostly bringing it up to see if someone looks at the loops and says \\\"Yuck, how did we do \u003cem\u003eTHAT\u003c\\/em\u003e?\\\" before thinking about replacing the mechanism. You\'ve shot that hope in the head though \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e. And I\'m assuming that part of the complexity here is that we want the index writer to be held by a thread as briefly as possible so as to not introduce bottlenecks.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, I\'ll dig some more after I take care of morning tasks.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks!\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14661898_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661898_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T14:26:02+0000\'\u003e07\\/Aug\\/15 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Well, something that sits in a while loop waiting for another thread to change a variable before doing anything seems like it\'s harder to get right than some kind of notification. As I\'m finding. But I\'m terrified of changing the total approach.  \\n\\n I need to dig some more before posting stack traces, plus it\'s the trace with this patch applied (and maybe changed).... \\n\\n Mostly bringing it up to see if someone looks at the loops and says \\\"Yuck, how did we do  THAT ?\\\" before thinking about replacing the mechanism. You\'ve shot that hope in the head though  . And I\'m assuming that part of the complexity here is that we want the index writer to be held by a thread as briefly as possible so as to not introduce bottlenecks. \\n\\n Anyway, I\'ll dig some more after I take care of morning tasks. \\n\\n Thanks! \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14661956\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14661956&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14661956\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14661956_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661956_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T15:00:49+0000\'\u003e07\\/Aug\\/15 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 07\\/Aug\\/15 15:01\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePreviously it was done via notification - the time out and check of isClosed was added at some point because this could hang on shutdown (or at least it really slowed down shutdown - can\'t remember which).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14661956_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14661956_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/15 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-07T15:00:49+0000\'\u003e07\\/Aug\\/15 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Mark Miller - 07\\/Aug\\/15 15:01\\\"\u003eedited\u003c\\/span\u003e                   Previously it was done via notification - the time out and check of isClosed was added at some point because this could hang on shutdown (or at least it really slowed down shutdown - can\'t remember which).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14662814\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14662814&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14662814\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14662814_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14662814_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 05:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T05:30:11+0000\'\u003e08\\/Aug\\/15 05:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Erick Erickson - 08\\/Aug\\/15 15:21\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis might do it. I\'m running 1,000 iterations (or until morning, whichever comes first) but it\'s gone through 150 or so already which was usually more than enough to trigger the new deadlock I found so I\'m hopeful. Actually, I think this really the old deadlock, the first fix wasn\'t very good.\u003c\\/p\u003e\\n\\n\u003cp\u003eThere are two things I\'d appreciate any opinions on:\u003cbr\\/\u003e\\n1&gt; this patch moves the UpdateLog.add() command out of the ref counted IndexWriter in DirectUpdateHandler2.addDoc0() in multiple places (refactored to methods). But UpdateLog.add gets a new IndexWriter itself which is where the deadlock appears to be as it\'s fighting with CoreContainer.reload() which also calls DefaultSolrCoreState.newIndexWriter.\u003c\\/p\u003e\\n\\n\u003cp\u003e2&gt; There are two nocommits, but they are to make it easy for someone to see the other bit that other eyes would be most welcome on, I moved \u003cbr\\/\u003e\\nif (ulog != null) ulog.add(cmd, true); \u003cbr\\/\u003e\\nout of a synchronized block. This fits the pattern in other places in that code too, so I\'m not too worried, but wanted to draw attention to it if anyone wants to look. Actually, there are a lot of operations on ulog.something that are synchronized on solrCoreState.getUpdateLock(), and a bunch that aren\'t. What\'s up there? The change marked by \\/\\/nocommit matches the (non-synchronized) usages in addDoc0() though.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, the problem was in DirectUpdateHandler2.addDoc0(). The ulog.add command line being inside a ref-counted IndexWriter when adding documents (addAndDelete case). ulog.add eventually tries to get a new Searcher which can be deadlocked with another thread called from SolrCore.reload since the reload wants a new IndexWriter.\u003c\\/p\u003e\\n\\n\u003cp\u003eI haven\'t run precommit or the full test suite yet, I want to make sure the iterations I\'m doing tonight work.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis looks more intrusive than it is. I refactored some methods out of DirectUpdateHandler2.addDoc0() in order to make this pattern more visible. The original code concealed the fact that the ref counted index writer surrounded all the code, including the ulog.add.\u003c\\/p\u003e\\n\\n\u003cp\u003ethis is the pattern for all the refactored methods:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eRefCounted&lt;IndexWriter&gt; iw = solrCoreState.getIndexWriter(core);\\u2028\u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\u2028 \\n   IndexWriter writer = iw.get();\\u2028 \\n    \u003cspan class=\\\"code-keyword\\\"\u003edo\u003c\\/span\u003e the right thing\\n} \u003cspan class=\\\"code-keyword\\\"\u003efinally\u003c\\/span\u003e {\\n    iw.decref();\\n} \\n\\n\u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (ulog != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) ulog.add(cmd, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eI think this is a better approach than the original fix which passed the index writer down to the addAndDelete method. we\'d have had to pass the IndexWriter on to the ulog.add command or something which would have been a pain (even if it was possible).\u003c\\/p\u003e\\n\\n\u003cp\u003eNew test case is in this patch. Note that it\'s a race condition to get this to fail, so it needs to be run a lot. And using tests.iters apparently triggers the timeouts so....\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14662814_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14662814_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 05:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T05:30:11+0000\'\u003e08\\/Aug\\/15 05:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Erick Erickson - 08\\/Aug\\/15 15:21\\\"\u003eedited\u003c\\/span\u003e                   This might do it. I\'m running 1,000 iterations (or until morning, whichever comes first) but it\'s gone through 150 or so already which was usually more than enough to trigger the new deadlock I found so I\'m hopeful. Actually, I think this really the old deadlock, the first fix wasn\'t very good. \\n\\n There are two things I\'d appreciate any opinions on: \\n1&gt; this patch moves the UpdateLog.add() command out of the ref counted IndexWriter in DirectUpdateHandler2.addDoc0() in multiple places (refactored to methods). But UpdateLog.add gets a new IndexWriter itself which is where the deadlock appears to be as it\'s fighting with CoreContainer.reload() which also calls DefaultSolrCoreState.newIndexWriter. \\n\\n 2&gt; There are two nocommits, but they are to make it easy for someone to see the other bit that other eyes would be most welcome on, I moved  \\nif (ulog != null) ulog.add(cmd, true);  \\nout of a synchronized block. This fits the pattern in other places in that code too, so I\'m not too worried, but wanted to draw attention to it if anyone wants to look. Actually, there are a lot of operations on ulog.something that are synchronized on solrCoreState.getUpdateLock(), and a bunch that aren\'t. What\'s up there? The change marked by \\/\\/nocommit matches the (non-synchronized) usages in addDoc0() though. \\n\\n Anyway, the problem was in DirectUpdateHandler2.addDoc0(). The ulog.add command line being inside a ref-counted IndexWriter when adding documents (addAndDelete case). ulog.add eventually tries to get a new Searcher which can be deadlocked with another thread called from SolrCore.reload since the reload wants a new IndexWriter. \\n\\n I haven\'t run precommit or the full test suite yet, I want to make sure the iterations I\'m doing tonight work. \\n\\n This looks more intrusive than it is. I refactored some methods out of DirectUpdateHandler2.addDoc0() in order to make this pattern more visible. The original code concealed the fact that the ref counted index writer surrounded all the code, including the ulog.add. \\n\\n this is the pattern for all the refactored methods: \\n  \\n RefCounted&lt;IndexWriter&gt; iw = solrCoreState.getIndexWriter(core);\\u2028 try  {\\u2028 \\n   IndexWriter writer = iw.get();\\u2028 \\n     do  the right thing\\n}  finally  {\\n    iw.decref();\\n} \\n\\n if  (ulog !=  null ) ulog.add(cmd,  true );\\n \\n  \\n I think this is a better approach than the original fix which passed the index writer down to the addAndDelete method. we\'d have had to pass the IndexWriter on to the ulog.add command or something which would have been a pain (even if it was possible). \\n\\n New test case is in this patch. Note that it\'s a race condition to get this to fail, so it needs to be run a lot. And using tests.iters apparently triggers the timeouts so....              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14663030\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14663030&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14663030\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14663030_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663030_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T15:26:45+0000\'\u003e08\\/Aug\\/15 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCan we get the stress test in as a nightly?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14663030_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663030_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 15:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T15:26:45+0000\'\u003e08\\/Aug\\/15 15:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Can we get the stress test in as a nightly?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14663038\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14663038&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14663038\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14663038_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663038_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 15:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T15:41:51+0000\'\u003e08\\/Aug\\/15 15:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLooking a bit more, all the ulog.(some operation) commands have this at the top: \u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e) {\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \\n\u003cp\u003eso they\'re serialized. I don\'t like the fact that lots of these are called from within\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (solrCoreState.getUpdateLock()) {\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eas that seems like a good place for a deadlock if it ever happens that the ulog operations want to get that same lock, but I\'m not about to change that now by, say, moving all the ulog operations out of the synchronized blocks since I don\'t know why they were put in the first place, we can make that a separate JIRA if necessary\\/desirable. I\'m comfortable enough with the one I moved out to go ahead with this commit.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I\'ll clean up the patch and commit unless there are objections today\\/tomorrow.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14663038_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663038_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 15:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T15:41:51+0000\'\u003e08\\/Aug\\/15 15:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Looking a bit more, all the ulog.(some operation) commands have this at the top:  \\n  \\n  synchronized  ( this ) {\\n \\n   \\n so they\'re serialized. I don\'t like the fact that lots of these are called from within \\n  \\n  synchronized  (solrCoreState.getUpdateLock()) {\\n \\n  \\n as that seems like a good place for a deadlock if it ever happens that the ulog operations want to get that same lock, but I\'m not about to change that now by, say, moving all the ulog operations out of the synchronized blocks since I don\'t know why they were put in the first place, we can make that a separate JIRA if necessary\\/desirable. I\'m comfortable enough with the one I moved out to go ahead with this commit. \\n\\n So I\'ll clean up the patch and commit unless there are objections today\\/tomorrow.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14663062\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14663062&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14663062\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14663062_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663062_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T16:39:33+0000\'\u003e08\\/Aug\\/15 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFinal patch I think. It:\u003cbr\\/\u003e\\n1&gt; tightens up a bit acquiring the index writer in the extracted methods. This is really a minor nit.\u003c\\/p\u003e\\n\\n\u003cp\u003e2&gt; makes the test nightly.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll commit this tonight\\/tomorrow, need to run it through precommit and the rest of the tests.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14663062_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663062_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Aug\\/15 16:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-08T16:39:33+0000\'\u003e08\\/Aug\\/15 16:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Final patch I think. It: \\n1&gt; tightens up a bit acquiring the index writer in the extracted methods. This is really a minor nit. \\n\\n 2&gt; makes the test nightly. \\n\\n I\'ll commit this tonight\\/tomorrow, need to run it through precommit and the rest of the tests.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14663242\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14663242&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14663242\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14663242_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663242_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 03:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T03:38:09+0000\'\u003e09\\/Aug\\/15 03:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1694854 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=erickoerickson\\\" class=\\\"user-hover\\\" rel=\\\"erickoerickson\\\"\u003eErick Erickson\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1694854\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1694854\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e: Possible deadlock when closing refcounted index writers\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14663242_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663242_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 03:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T03:38:09+0000\'\u003e09\\/Aug\\/15 03:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1694854 from  Erick Erickson  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1694854  ] \\n\\n   SOLR-7836  : Possible deadlock when closing refcounted index writers              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14663271\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14663271&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14663271\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14663271_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663271_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 05:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T05:46:44+0000\'\u003e09\\/Aug\\/15 05:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1694855 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=erickoerickson\\\" class=\\\"user-hover\\\" rel=\\\"erickoerickson\\\"\u003eErick Erickson\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_5x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1694855\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1694855\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e: Possible deadlock when closing refcounted index writers\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14663271_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663271_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 05:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T05:46:44+0000\'\u003e09\\/Aug\\/15 05:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1694855 from  Erick Erickson  in branch \'dev\\/branches\\/branch_5x\' \\n[  https:\\/\\/svn.apache.org\\/r1694855  ] \\n\\n   SOLR-7836  : Possible deadlock when closing refcounted index writers              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14663272\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14663272&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14663272\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14663272_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663272_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 05:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T05:47:17+0000\'\u003e09\\/Aug\\/15 05:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Jessica!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14663272_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14663272_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 05:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T05:47:17+0000\'\u003e09\\/Aug\\/15 05:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Jessica!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679360\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679360&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679360\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14679360_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679360_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T21:34:51+0000\'\u003e09\\/Aug\\/15 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI modified the three refactored methods in DirectUpdateHandler2 to be:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e   \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/old code\\n\u003c\\/span\u003e    \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (ulog != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) ulog.add(cmd);\\n \\n\\n   \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/\u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e code\\n\u003c\\/span\u003e   \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e (solrCoreState.getUpdateLock()) {\\n      \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (ulog != \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) ulog.add(cmd);\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eand 200 iterations later no failures from TestStressReorder (I\'ll try the new test code momentarily, but it\'ll take longer).\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e\u003cbr\\/\u003e\\nHere\'s what I \u003cem\u003edon\'t\u003c\\/em\u003e like about this. None of these three operations (the three new methods: addAndDelete, doNormalUpdate and allowDuplicateUpdate) couples actually changing the index with the write to the ulog. Now, only the code in addAndDelete did before, except that we may have gotten away with this because the indexWriter was grabbed at the very top of addDoc0() and effectively locked other operations out. Maybe.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut if the ulog.add goes within the synch on the updatelock in addAndDelete, there\'s certainly a deadlock so putting it back the way it was isn\'t really an option.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m starting to wonder if this isn\'t a bit backwards. Rather than going at this piecemeal, what about synchronizing on updateLock at the top of addDoc0 \u003cem\u003eand\u003c\\/em\u003e in CoreContainer.reload() which drives one of the failure cases for deadlock? Not sure I really like the idea, but I\'ll give it a (local) test....\u003c\\/p\u003e\\n\\n\u003cp\u003eMeanwhile, I\'ll check the current fix in since it\'s certainly better pending more experimentation.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14679360_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679360_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 21:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T21:34:51+0000\'\u003e09\\/Aug\\/15 21:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I modified the three refactored methods in DirectUpdateHandler2 to be: \\n\\n  \\n     \\/\\/old code\\n      if  (ulog !=  null ) ulog.add(cmd);\\n \\n\\n    \\/\\/ new  code\\n     synchronized  (solrCoreState.getUpdateLock()) {\\n       if  (ulog !=  null ) ulog.add(cmd);\\n    }\\n \\n  \\n\\n and 200 iterations later no failures from TestStressReorder (I\'ll try the new test code momentarily, but it\'ll take longer). \\n\\n  Yonik Seeley   Mark Miller  \\nHere\'s what I  don\'t  like about this. None of these three operations (the three new methods: addAndDelete, doNormalUpdate and allowDuplicateUpdate) couples actually changing the index with the write to the ulog. Now, only the code in addAndDelete did before, except that we may have gotten away with this because the indexWriter was grabbed at the very top of addDoc0() and effectively locked other operations out. Maybe. \\n\\n But if the ulog.add goes within the synch on the updatelock in addAndDelete, there\'s certainly a deadlock so putting it back the way it was isn\'t really an option. \\n\\n I\'m starting to wonder if this isn\'t a bit backwards. Rather than going at this piecemeal, what about synchronizing on updateLock at the top of addDoc0  and  in CoreContainer.reload() which drives one of the failure cases for deadlock? Not sure I really like the idea, but I\'ll give it a (local) test.... \\n\\n Meanwhile, I\'ll check the current fix in since it\'s certainly better pending more experimentation.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679364\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679364&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679364\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14679364_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679364_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 21:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T21:46:43+0000\'\u003e09\\/Aug\\/15 21:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1694913 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=erickoerickson\\\" class=\\\"user-hover\\\" rel=\\\"erickoerickson\\\"\u003eErick Erickson\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1694913\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1694913\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e: Possible deadlock when closing refcounted index writers. Surrounded ulog updates with updatelock\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14679364_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679364_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 21:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T21:46:43+0000\'\u003e09\\/Aug\\/15 21:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1694913 from  Erick Erickson  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1694913  ] \\n\\n   SOLR-7836  : Possible deadlock when closing refcounted index writers. Surrounded ulog updates with updatelock              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679365\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679365&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679365\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14679365_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679365_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 21:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T21:47:29+0000\'\u003e09\\/Aug\\/15 21:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1694914 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=erickoerickson\\\" class=\\\"user-hover\\\" rel=\\\"erickoerickson\\\"\u003eErick Erickson\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_5x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1694914\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1694914\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e: Possible deadlock when closing refcounted index writers. Surrounded ulog updates with updatelock\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14679365_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679365_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 21:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T21:47:29+0000\'\u003e09\\/Aug\\/15 21:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1694914 from  Erick Erickson  in branch \'dev\\/branches\\/branch_5x\' \\n[  https:\\/\\/svn.apache.org\\/r1694914  ] \\n\\n   SOLR-7836  : Possible deadlock when closing refcounted index writers. Surrounded ulog updates with updatelock              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14679398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 23:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T23:20:00+0000\'\u003e09\\/Aug\\/15 23:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq: I\'m starting to wonder if this isn\'t a bit backwards. Rather than going at this piecemeal, what about synchronizing on updateLock at the top of addDoc0 and in CoreContainer.reload() which drives one of the failure cases for deadlock? Not sure I really like the idea, but I\'ll give it a (local) test....\u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s a really bad idea, fails first time every time.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14679398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Aug\\/15 23:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-09T23:20:00+0000\'\u003e09\\/Aug\\/15 23:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bq: I\'m starting to wonder if this isn\'t a bit backwards. Rather than going at this piecemeal, what about synchronizing on updateLock at the top of addDoc0 and in CoreContainer.reload() which drives one of the failure cases for deadlock? Not sure I really like the idea, but I\'ll give it a (local) test.... \\n\\n That\'s a really bad idea, fails first time every time.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679424\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679424&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679424\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679424_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679424_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 00:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T00:19:35+0000\'\u003e10\\/Aug\\/15 00:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat about the nightly test?\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e   \\/\\/new code\\n   synchronized (solrCoreState.getUpdateLock()) {\\n      if (ulog != null) ulog.add(cmd);\\n    }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWhile that says getUpdateLock, it appears to have been additionally proposed as a deleteLock judging by it\'s callers and variable name. It looks like the old index update lock was tied into also being a delete lock.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhat is the logic that says you now need that also locking adds other than this test? Why would the index update lock that did not block adds and also was used as a delete lock also lock adds now?\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e should really look at this as this looks like his code area.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m skeptical that this is the right fix.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679424_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679424_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 00:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T00:19:35+0000\'\u003e10\\/Aug\\/15 00:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What about the nightly test? \\n\\n  \\n    \\/\\/new code\\n   synchronized (solrCoreState.getUpdateLock()) {\\n      if (ulog != null) ulog.add(cmd);\\n    }\\n \\n  \\n\\n While that says getUpdateLock, it appears to have been additionally proposed as a deleteLock judging by it\'s callers and variable name. It looks like the old index update lock was tied into also being a delete lock. \\n\\n What is the logic that says you now need that also locking adds other than this test? Why would the index update lock that did not block adds and also was used as a delete lock also lock adds now? \\n\\n  Yonik Seeley  should really look at this as this looks like his code area. \\n\\n I\'m skeptical that this is the right fix.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679455\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679455&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679455\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14679455_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679455_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 01:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T01:32:27+0000\'\u003e10\\/Aug\\/15 01:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq: What about the nightly test?\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'m beating that up as well, 50+ runs and iterating without a problem so far.\u003c\\/p\u003e\\n\\n\u003cp\u003ebq: While that says getUpdateLock, it appears to have been additionally proposed as a deleteLock judging by it\'s callers and variable name. It looks like the old index update lock was tied into also being a delete lock\u003c\\/p\u003e\\n\\n\u003cp\u003eHmmm. which may explain why changing in in addAndDelete was a problem and apparently not in the other cases.\u003c\\/p\u003e\\n\\n\u003cp\u003ebq: What is the logic that says you now need that also locking adds other than this test?\u003c\\/p\u003e\\n\\n\u003cp\u003eMay well be flawed logic, but I find it really suspicious that the the ulog.add() call is sometimes protected and sometimes not. Although your point that it appears to really be about deletes (which the others don\'t do) may be why. Moving getting the indexwriter away from being done at the beginning of addDoc0() did remove a layer of protection around the ulog.add calls in all the code paths in addDoc0(). The ref counted index writer (unintentionally?) locked out some other updates possibly. ulog.add can get a new ref counted index writer which lead to the deadlock in the addAndDelete case.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14679455_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679455_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 01:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T01:32:27+0000\'\u003e10\\/Aug\\/15 01:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bq: What about the nightly test? \\n\\n I\'m beating that up as well, 50+ runs and iterating without a problem so far. \\n\\n bq: While that says getUpdateLock, it appears to have been additionally proposed as a deleteLock judging by it\'s callers and variable name. It looks like the old index update lock was tied into also being a delete lock \\n\\n Hmmm. which may explain why changing in in addAndDelete was a problem and apparently not in the other cases. \\n\\n bq: What is the logic that says you now need that also locking adds other than this test? \\n\\n May well be flawed logic, but I find it really suspicious that the the ulog.add() call is sometimes protected and sometimes not. Although your point that it appears to really be about deletes (which the others don\'t do) may be why. Moving getting the indexwriter away from being done at the beginning of addDoc0() did remove a layer of protection around the ulog.add calls in all the code paths in addDoc0(). The ref counted index writer (unintentionally?) locked out some other updates possibly. ulog.add can get a new ref counted index writer which lead to the deadlock in the addAndDelete case.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679959\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679959&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679959\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679959_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679959_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 11:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T11:14:49+0000\'\u003e10\\/Aug\\/15 11:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI find it really suspicious that the the ulog.add() call is sometimes protected and sometimes not. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat\'s pretty unsound logic for making a change in such a complicated area of code...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679959_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679959_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 11:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T11:14:49+0000\'\u003e10\\/Aug\\/15 11:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I find it really suspicious that the the ulog.add() call is sometimes protected and sometimes not.   \\n\\n That\'s pretty unsound logic for making a change in such a complicated area of code...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679961\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679961&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679961\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679961_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679961_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 11:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T11:17:13+0000\'\u003e10\\/Aug\\/15 11:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m pretty sure that deadlocks around accessing an index writer should not involved synchronization work with the tlog. It may have inadvertently helped, but the two things are pretty unrelated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679961_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679961_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 11:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T11:17:13+0000\'\u003e10\\/Aug\\/15 11:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m pretty sure that deadlocks around accessing an index writer should not involved synchronization work with the tlog. It may have inadvertently helped, but the two things are pretty unrelated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14679976\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14679976&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14679976\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679976_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679976_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 11:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T11:42:22+0000\'\u003e10\\/Aug\\/15 11:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOnce you get the stress test up, I\'m happy to do some parallel investigation into the deadlock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14679976_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14679976_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 11:42\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T11:42:22+0000\'\u003e10\\/Aug\\/15 11:42\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Once you get the stress test up, I\'m happy to do some parallel investigation into the deadlock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14680024\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14680024&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14680024\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14680024_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14680024_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 12:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T12:21:43+0000\'\u003e10\\/Aug\\/15 12:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eOnce you get the stress test up\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eNevermind, I see it\'s in an earlier test. I\'ll take a look.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14680024_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14680024_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 12:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T12:21:43+0000\'\u003e10\\/Aug\\/15 12:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Once you get the stress test up  \\n\\n Nevermind, I see it\'s in an earlier test. I\'ll take a look.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14680200\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14680200&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14680200\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14680200_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14680200_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T14:39:33+0000\'\u003e10\\/Aug\\/15 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq: I\'m pretty sure that deadlocks around accessing an index writer should not involved synchronization work with the tlog. It may have inadvertently helped, but the two things are pretty unrelated.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t disagree, but the update log and index writer are intertwined, that\'s the problem. I\'m perfectly willing to agree that they should be separated out completely, but haven\'t had any confirmation that they can be, or were ever intended to be separated.\u003c\\/p\u003e\\n\\n\u003cp\u003eulog.add() calls openNewSearcher which gets an indexWriter which is where things to south. Of course it calls getIndexWriter with null which has the note \\\"core == null is a signal to just return the current writer, or null\\\"; It doesn\'t really increment the reference count but does go through the interlock with pauseWriter and the like. Of course then openNewSearcher does a decref on the writer, which was never incremented in the first place and only works because the decref for index writer doesn\'t decrement if the count is 0.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve no objection to taking the two additional synchronized blocks out of DirectUpdateHandler2. The one in addAndDelete was already there although it was enclosed by getting an index writer (which is where all the problems happened). I\'m not adverse to taking that one out too\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, you can\'t use tests.iters for the new test. I didn\'t want to wait for the default suite timeout so I set it locally to 10 minutes and that timer apparently runs across all iters. I wrote a shell script to re-invoke the test for a long time (500 times last night).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14680200_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14680200_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Aug\\/15 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-10T14:39:33+0000\'\u003e10\\/Aug\\/15 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bq: I\'m pretty sure that deadlocks around accessing an index writer should not involved synchronization work with the tlog. It may have inadvertently helped, but the two things are pretty unrelated. \\n\\n I don\'t disagree, but the update log and index writer are intertwined, that\'s the problem. I\'m perfectly willing to agree that they should be separated out completely, but haven\'t had any confirmation that they can be, or were ever intended to be separated. \\n\\n ulog.add() calls openNewSearcher which gets an indexWriter which is where things to south. Of course it calls getIndexWriter with null which has the note \\\"core == null is a signal to just return the current writer, or null\\\"; It doesn\'t really increment the reference count but does go through the interlock with pauseWriter and the like. Of course then openNewSearcher does a decref on the writer, which was never incremented in the first place and only works because the decref for index writer doesn\'t decrement if the count is 0. \\n\\n I\'ve no objection to taking the two additional synchronized blocks out of DirectUpdateHandler2. The one in addAndDelete was already there although it was enclosed by getting an index writer (which is where all the problems happened). I\'m not adverse to taking that one out too \\n\\n BTW, you can\'t use tests.iters for the new test. I didn\'t want to wait for the default suite timeout so I set it locally to 10 minutes and that timer apparently runs across all iters. I wrote a shell script to re-invoke the test for a long time (500 times last night).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14681889\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14681889&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14681889\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14681889_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14681889_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T14:46:04+0000\'\u003e11\\/Aug\\/15 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStill trying to duplicate a hang with the above patch removed, but one strange thing I had to work around because the test kept failing relatively quickly for me (JVM bug?):\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eIndex: solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/core\\/SolrCore.java\\n===================================================================\\n--- solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/core\\/SolrCore.java\\t(revision 1695180)\\n+++ solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/core\\/SolrCore.java\\t(working copy)\\n@@ -1639,7 +1639,9 @@\\n           tmp = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SolrIndexSearcher(\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e, newIndexDir, getLatestSchema(),\\n               (realtime ? \u003cspan class=\\\"code-quote\\\"\u003e\\\"realtime\\\"\u003c\\/span\u003e:\u003cspan class=\\\"code-quote\\\"\u003e\\\"main\\\"\u003c\\/span\u003e), newReader, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e, !realtime, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e, directoryFactory);\\n         } \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e  {\\n-          RefCounted&lt;IndexWriter&gt; writer = getUpdateHandler().getSolrCoreState().getIndexWriter(\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e);\\n+          \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ when \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e was getUpdateHandler#getSolrCoreState it could hit an NPE somehow,\\n\u003c\\/span\u003e+          \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ even though variables are all \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e\\n\u003c\\/span\u003e+          RefCounted&lt;IndexWriter&gt; writer = solrCoreState.getIndexWriter(\u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e);\\n           DirectoryReader newReader = \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e;\\n           \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n             newReader = indexReaderFactory.newReader(writer.get(), \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e);\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14681889_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14681889_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 14:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T14:46:04+0000\'\u003e11\\/Aug\\/15 14:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Still trying to duplicate a hang with the above patch removed, but one strange thing I had to work around because the test kept failing relatively quickly for me (JVM bug?): \\n  \\n Index: solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/core\\/SolrCore.java\\n===================================================================\\n--- solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/core\\/SolrCore.java\\t(revision 1695180)\\n+++ solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/core\\/SolrCore.java\\t(working copy)\\n@@ -1639,7 +1639,9 @@\\n           tmp =  new  SolrIndexSearcher( this , newIndexDir, getLatestSchema(),\\n               (realtime ?  \\\"realtime\\\" : \\\"main\\\" ), newReader,  true , !realtime,  true , directoryFactory);\\n         }  else   {\\n-          RefCounted&lt;IndexWriter&gt; writer = getUpdateHandler().getSolrCoreState().getIndexWriter( this );\\n+           \\/\\/ when  this  was getUpdateHandler#getSolrCoreState it could hit an NPE somehow,\\n +           \\/\\/ even though variables are all  final \\n +          RefCounted&lt;IndexWriter&gt; writer = solrCoreState.getIndexWriter( this );\\n           DirectoryReader newReader =  null ;\\n            try  {\\n             newReader = indexReaderFactory.newReader(writer.get(),  this );\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14681912\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14681912&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14681912\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14681912_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14681912_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 15:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T15:01:21+0000\'\u003e11\\/Aug\\/15 15:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ethere are a lot of operations on ulog.something that are synchronized on solrCoreState.getUpdateLock(), and a bunch that aren\'t. What\'s up there? \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eSome background here: I wrote the original tlog code (and DUH2 code that called it).  There was no solrCoreState.getUpdateLock() (and no sharing writers across reloads even).  Mark implemented that part and changed synchronized(this) to synchronized(solrCoreState.getUpdateLock()) I believe (to account for the fact that we could have 2 DUH2 instances).\u003c\\/p\u003e\\n\\n\u003cp\u003eHopefully there are comments about when something is synchronized (and why it needed to be).  The intent was to have the common case unsynchronized for best throughput.  For example, I don\'t believe writer.updateDocument for the common case is synchronized.  That would be bad for indexing performance.\u003c\\/p\u003e\\n\\n\u003cp\u003edeleteByQuery (or an add where we detect a reordered DBQ that we need to apply again) contains the following\u003cbr\\/\u003e\\ncomment next to the synchronize statement:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ \u003cspan class=\\\"code-keyword\\\"\u003esynchronized\u003c\\/span\u003e to prevent deleteByQuery from running during the \u003cspan class=\\\"code-quote\\\"\u003e\\\"open \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e searcher\\\"\u003c\\/span\u003e\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ part of a commit.  DBQ needs to signal that a fresh reader will be needed \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ a realtime view of the index.  When a \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e searcher is opened after a DBQ, that\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ flag can be cleared.  If those thing happen concurrently, it\'s not thread safe.\\n\u003c\\/span\u003e      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/\u003c\\/span\u003e\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI\'m re-reviewing all this code now to get it back in my head...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14681912_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14681912_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 15:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T15:01:21+0000\'\u003e11\\/Aug\\/15 15:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     there are a lot of operations on ulog.something that are synchronized on solrCoreState.getUpdateLock(), and a bunch that aren\'t. What\'s up there?   \\n\\n Some background here: I wrote the original tlog code (and DUH2 code that called it).  There was no solrCoreState.getUpdateLock() (and no sharing writers across reloads even).  Mark implemented that part and changed synchronized(this) to synchronized(solrCoreState.getUpdateLock()) I believe (to account for the fact that we could have 2 DUH2 instances). \\n\\n Hopefully there are comments about when something is synchronized (and why it needed to be).  The intent was to have the common case unsynchronized for best throughput.  For example, I don\'t believe writer.updateDocument for the common case is synchronized.  That would be bad for indexing performance. \\n\\n deleteByQuery (or an add where we detect a reordered DBQ that we need to apply again) contains the following \\ncomment next to the synchronize statement: \\n  \\n        \\/\\/\\n        \\/\\/  synchronized  to prevent deleteByQuery from running during the  \\\"open  new  searcher\\\" \\n        \\/\\/ part of a commit.  DBQ needs to signal that a fresh reader will be needed  for \\n        \\/\\/ a realtime view of the index.  When a  new  searcher is opened after a DBQ, that\\n        \\/\\/ flag can be cleared.  If those thing happen concurrently, it\'s not thread safe.\\n        \\/\\/ \\n \\n  \\n\\n I\'m re-reviewing all this code now to get it back in my head...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14682096\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14682096&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14682096\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14682096_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682096_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T17:12:19+0000\'\u003e11\\/Aug\\/15 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks guys, getting it all in my head is...interesting.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e Yeah, I saw that comment. In that case, removing the two synchronizations in the refactored methods \u003cem\u003eother\u003c\\/em\u003e than addAndDelete is probably indicated. The one \u003cem\u003ein\u003c\\/em\u003e addAndDelete was there originally, just within the IndexWriter try\\/finally which is where the issues was since it\'d go out and get a new searcher eventually.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e I had to write a shell script to re-submit that individual test repeatedly, it\'d pretty much always fail for me by 50 runs. I\'ll back those changes out and run it on my machine where it fails reliably and post the results when I get a deadlock.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14682096_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682096_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 17:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T17:12:19+0000\'\u003e11\\/Aug\\/15 17:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks guys, getting it all in my head is...interesting. \\n\\n  Yonik Seeley  Yeah, I saw that comment. In that case, removing the two synchronizations in the refactored methods  other  than addAndDelete is probably indicated. The one  in  addAndDelete was there originally, just within the IndexWriter try\\/finally which is where the issues was since it\'d go out and get a new searcher eventually. \\n\\n  Mark Miller  I had to write a shell script to re-submit that individual test repeatedly, it\'d pretty much always fail for me by 50 runs. I\'ll back those changes out and run it on my machine where it fails reliably and post the results when I get a deadlock.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14682191\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14682191&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14682191\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14682191_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682191_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 18:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T18:08:22+0000\'\u003e11\\/Aug\\/15 18:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYeah, I have a beasting script that does the same, though can also launch runs in parallel (\u003ca href=\\\"https:\\/\\/gist.github.com\\/markrmiller\\/dbdb792216dc98b018ad\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/gist.github.com\\/markrmiller\\/dbdb792216dc98b018ad\u003c\\/a\u003e). Still no deadlock on my machine yet though. I\'ll keep trying for a while though.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14682191_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682191_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 18:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T18:08:22+0000\'\u003e11\\/Aug\\/15 18:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Yeah, I have a beasting script that does the same, though can also launch runs in parallel ( https:\\/\\/gist.github.com\\/markrmiller\\/dbdb792216dc98b018ad ). Still no deadlock on my machine yet though. I\'ll keep trying for a while though.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14682339\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14682339&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14682339\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14682339_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682339_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 19:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T19:30:35+0000\'\u003e11\\/Aug\\/15 19:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the stack trace. A few things:\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I got this source by \\\"svn checkout -r1694809 \u003ca href=\\\"https:\\/\\/svn.apache.org\\/repos\\/asf\\/lucene\\/dev\\/trunk\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/repos\\/asf\\/lucene\\/dev\\/trunk\u003c\\/a\u003e\\\" and added the test to that code base.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; It appears to need two things to fail; a reload operation and a delete by query.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; thread WRITER5 and TEST-TestReloadDeadlock.testReloadDeadlock-seed#\u003cspan class=\\\"error\\\"\u003e&#91;4CFFCB253DB33784&#93;\u003c\\/span\u003e\\\" are the ones I think are fighting here.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; The original fix was to pass the index writer from addDoc0() to addAndDelete, but this doesn\'t work either. I\'ll see if I can attach a run with that change for comparison.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt; I\'ve also attached the script I use to run this, although I don\'t run it in parallel.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14682339_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682339_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 19:30\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T19:30:35+0000\'\u003e11\\/Aug\\/15 19:30\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the stack trace. A few things: \\n\\n &gt; I got this source by \\\"svn checkout -r1694809  https:\\/\\/svn.apache.org\\/repos\\/asf\\/lucene\\/dev\\/trunk \\\" and added the test to that code base. \\n\\n &gt; It appears to need two things to fail; a reload operation and a delete by query. \\n\\n &gt; thread WRITER5 and TEST-TestReloadDeadlock.testReloadDeadlock-seed# &#91;4CFFCB253DB33784&#93; \\\" are the ones I think are fighting here. \\n\\n &gt; The original fix was to pass the index writer from addDoc0() to addAndDelete, but this doesn\'t work either. I\'ll see if I can attach a run with that change for comparison. \\n\\n &gt; I\'ve also attached the script I use to run this, although I don\'t run it in parallel. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14682486\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14682486&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14682486\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14682486_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682486_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T20:54:55+0000\'\u003e11\\/Aug\\/15 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s a fail with passing the index writer from addDoc0() to addAndDelete, my first attempt at a \\\"fix\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eI commented out the necessary lines rather than add or delete them, so the line numbers should correspond to the checkout I mentioned above.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14682486_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14682486_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Aug\\/15 20:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-11T20:54:55+0000\'\u003e11\\/Aug\\/15 20:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s a fail with passing the index writer from addDoc0() to addAndDelete, my first attempt at a \\\"fix\\\". \\n\\n I commented out the necessary lines rather than add or delete them, so the line numbers should correspond to the checkout I mentioned above.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695206\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695206&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695206\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695206_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695206_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 13:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T13:24:52+0000\'\u003e13\\/Aug\\/15 13:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStrange, I have not been able to get the deadlock with that test on my machine.\u003c\\/p\u003e\\n\\n\u003cp\u003eDo you have the full set of stack traces for a deadlock state available?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695206_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695206_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 13:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T13:24:52+0000\'\u003e13\\/Aug\\/15 13:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Strange, I have not been able to get the deadlock with that test on my machine. \\n\\n Do you have the full set of stack traces for a deadlock state available?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695341\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695341&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695341\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695341_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695341_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T15:17:06+0000\'\u003e13\\/Aug\\/15 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e I \u003cem\u003ethought\u003c\\/em\u003e everything was in the two zip files I attached a couple of days ago, what did I miss? See my comments two days ago for the provenance.\u003c\\/p\u003e\\n\\n\u003cp\u003eBTW, I\'ll be intermittently available today and not at all tomorrow (business hours CA time) if you\'d like to chat.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695341_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695341_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T15:17:06+0000\'\u003e13\\/Aug\\/15 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Mark Miller  I  thought  everything was in the two zip files I attached a couple of days ago, what did I miss? See my comments two days ago for the provenance. \\n\\n BTW, I\'ll be intermittently available today and not at all tomorrow (business hours CA time) if you\'d like to chat.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695417\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695417\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695417_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695417_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 15:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T15:55:44+0000\'\u003e13\\/Aug\\/15 15:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAh, sorry, I was looking for the full strack traces pre two days ago - didn\'t realize they were in the zip. I\'ve been having trouble extracting that into something viable on my mac. I\'ll try on my Ubuntu machine.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695417_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695417_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 15:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T15:55:44+0000\'\u003e13\\/Aug\\/15 15:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ah, sorry, I was looking for the full strack traces pre two days ago - didn\'t realize they were in the zip. I\'ve been having trouble extracting that into something viable on my mac. I\'ll try on my Ubuntu machine.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T16:07:52+0000\'\u003e13\\/Aug\\/15 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLet me know if you need them in another format. I did just download them and extract, so they probably aren\'t corrupt at least.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 16:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T16:07:52+0000\'\u003e13\\/Aug\\/15 16:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Let me know if you need them in another format. I did just download them and extract, so they probably aren\'t corrupt at least.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695610\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695610&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695610\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14695610_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695610_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 17:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T17:24:04+0000\'\u003e13\\/Aug\\/15 17:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eYeah, I saw that comment. In that case, removing the two synchronizations in the refactored methods other than addAndDelete is probably indicated. The one in addAndDelete was there originally, just within the IndexWriter try\\/finally which is where the issues was since it\'d go out and get a new searcher eventually.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eMaybe... but it\'s also worth noting that those comments (and my thinking around it) were before (i think) index writers could be shared across reloads.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks fine to me that you moved the ulog.add() outside of the writer get\\/release.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14695610_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695610_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 17:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T17:24:04+0000\'\u003e13\\/Aug\\/15 17:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yeah, I saw that comment. In that case, removing the two synchronizations in the refactored methods other than addAndDelete is probably indicated. The one in addAndDelete was there originally, just within the IndexWriter try\\/finally which is where the issues was since it\'d go out and get a new searcher eventually.  \\n\\n Maybe... but it\'s also worth noting that those comments (and my thinking around it) were before (i think) index writers could be shared across reloads. \\n\\n It looks fine to me that you moved the ulog.add() outside of the writer get\\/release.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695628\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695628&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695628\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14695628_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695628_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T17:35:09+0000\'\u003e13\\/Aug\\/15 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eLet me see how repeatable a deadlock is on my system, then we can look into removing some of the extra sync...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14695628_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695628_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 17:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T17:35:09+0000\'\u003e13\\/Aug\\/15 17:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Let me see how repeatable a deadlock is on my system, then we can look into removing some of the extra sync...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695714\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695714&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695714\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695714_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695714_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 18:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T18:16:47+0000\'\u003e13\\/Aug\\/15 18:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Erick Erickson - 13\\/Aug\\/15 18:20\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq: It looks fine to me that you moved the ulog.add() outside of the writer get\\/release.\u003c\\/p\u003e\\n\\n\u003cp\u003eThat\'s exactly what makes me nervous. But having it \u003cem\u003ewithin\u003c\\/em\u003e the get\\/release is where the problem was.\u003c\\/p\u003e\\n\\n\u003cp\u003eLet me know if there\'s anything you\'d like to chat about.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnd it wasn\'t predictably repeatable (of course). Sometimes the script I attached would run 10-15 iterations OK then barf. Sometimes faster. Never more than 50. With the changes I ran with 400-500 iterations without a problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eSince I can get it to fail reasonably predictably though, let me know if you want me to run any changes locally.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695714_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695714_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 18:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T18:16:47+0000\'\u003e13\\/Aug\\/15 18:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Erick Erickson - 13\\/Aug\\/15 18:20\\\"\u003eedited\u003c\\/span\u003e                   bq: It looks fine to me that you moved the ulog.add() outside of the writer get\\/release. \\n\\n That\'s exactly what makes me nervous. But having it  within  the get\\/release is where the problem was. \\n\\n Let me know if there\'s anything you\'d like to chat about. \\n\\n And it wasn\'t predictably repeatable (of course). Sometimes the script I attached would run 10-15 iterations OK then barf. Sometimes faster. Never more than 50. With the changes I ran with 400-500 iterations without a problem. \\n\\n Since I can get it to fail reasonably predictably though, let me know if you want me to run any changes locally.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695729\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695729&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695729\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695729_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695729_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 18:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T18:26:22+0000\'\u003e13\\/Aug\\/15 18:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eIt looks fine to me that you moved the ulog.add() outside of the writer get\\/release.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eDoh, that is my problem - I only reverted the first commit to DirectUpdateHandler2.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695729_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695729_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 18:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T18:26:22+0000\'\u003e13\\/Aug\\/15 18:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     It looks fine to me that you moved the ulog.add() outside of the writer get\\/release.  \\n\\n Doh, that is my problem - I only reverted the first commit to DirectUpdateHandler2.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695732\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695732&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695732\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695732_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695732_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 18:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T18:28:42+0000\'\u003e13\\/Aug\\/15 18:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThat\'s exactly what makes me nervous. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThat should make you nervous - the random test fails around the transcation log tests after should be more in the terrified range though \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14695732_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695732_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 18:28\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T18:28:42+0000\'\u003e13\\/Aug\\/15 18:28\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     That\'s exactly what makes me nervous.   \\n\\n That should make you nervous - the random test fails around the transcation log tests after should be more in the terrified range though                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695772\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695772&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695772\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14695772_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695772_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T19:03:38+0000\'\u003e13\\/Aug\\/15 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eErick, I just now ran across this email from you 4 days ago:\u003c\\/p\u003e\\n\u003cblockquote\u003e\\n\u003cp\u003eBacked out \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e changes and TestStressReorder doesn\'t fail in 100\u003cbr\\/\u003e\\niterations, failed 16 times in 100 iterations with changes.\u003cbr\\/\u003e\\nDigging....\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIs this still the case (that TestStressReorder now sometimes fails?)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14695772_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695772_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 19:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T19:03:38+0000\'\u003e13\\/Aug\\/15 19:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Erick, I just now ran across this email from you 4 days ago: \\n \\n Backed out   SOLR-7836   changes and TestStressReorder doesn\'t fail in 100 \\niterations, failed 16 times in 100 iterations with changes. \\nDigging....  \\n\\n Is this still the case (that TestStressReorder now sometimes fails?)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14695827\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14695827&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14695827\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695827_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695827_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 19:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T19:45:32+0000\'\u003e13\\/Aug\\/15 19:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq: Is this still the case (that TestStressReorder now sometimes fails?)\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e It better \u003cem\u003enot\u003c\\/em\u003e be still failing or I\'ll have to fall on my sword. I\'m pretty sure I fixed that up, I can\'t imagine that I would just check the changes in since the TestStressReorder was what I ripped off to make my new test to avoid that deadlock and the link between the two is pretty obvious, even to me \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eI can\'t do it right now, but I\'ll run TestStressReorder a lot this evening to be sure.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14695827_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14695827_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Aug\\/15 19:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-13T19:45:32+0000\'\u003e13\\/Aug\\/15 19:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bq: Is this still the case (that TestStressReorder now sometimes fails?) \\n\\n  Yonik Seeley  It better  not  be still failing or I\'ll have to fall on my sword. I\'m pretty sure I fixed that up, I can\'t imagine that I would just check the changes in since the TestStressReorder was what I ripped off to make my new test to avoid that deadlock and the link between the two is pretty obvious, even to me   \\n\\n I can\'t do it right now, but I\'ll run TestStressReorder a lot this evening to be sure. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14697613\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14697613&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14697613\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14697613_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697613_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 19:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T19:46:31+0000\'\u003e14\\/Aug\\/15 19:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, so it wasn\'t too hard for me to replicate the deadlocks w\\/ the latest commits backed out, and the traces are similar to what was posted before... it\'s getIndexWriter fighting with newIndexWriter.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  2&gt; \u003cspan class=\\\"code-quote\\\"\u003e\\\"WRITER10\\\"\u003c\\/span\u003e ID=28 TIMED_WAITING on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@d8cdd45\\n  2&gt;    at java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e.wait(Native Method)\\n  2&gt;    - timed waiting on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@d8cdd45\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.getIndexWriter(DefaultSolrCoreState.java:96)\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1588)\\n  2&gt;    at org.apache.solr.update.UpdateLog.add(UpdateLog.java:455)\\n  2&gt;    - locked org.apache.solr.update.UpdateLog@1df2955d\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addAndDelete(DirectUpdateHandler2.java:452)\\n[...]\\n  2&gt; \u003cspan class=\\\"code-quote\\\"\u003e\\\"TEST-TestReloadDeadlock.testReloadDeadlock-seed#[D13A45EBBFA304C4]\\\"\u003c\\/span\u003e ID=12 TIMED_WAITING on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@d8cdd45\\n  2&gt;    at java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e.wait(Native Method)\\n  2&gt;    - timed waiting on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@d8cdd45\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.newIndexWriter(DefaultSolrCoreState.java:158)\\n  2&gt;    - locked org.apache.solr.update.DefaultSolrCoreState@7d338874\\n  2&gt;    at org.apache.solr.core.SolrCore.reload(SolrCore.java:479)\\n  2&gt;    at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:830)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock.testReloadDeadlock(TestReloadDeadlock.java:182)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eOn straight trunk, I still get failures (just not deadlocks):\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  2&gt; 3406 ERROR (WRITER6) [    ] o.a.s.c.SolrCore org.apache.solr.common.SolrException: Error opening \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e searcher\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1673)\\n  2&gt;    at org.apache.solr.core.SolrCore.getRealtimeSearcher(SolrCore.java:1530)\\n  2&gt;    at org.apache.solr.update.VersionInfo.getVersionFromIndex(VersionInfo.java:202)\\n  2&gt;    at org.apache.solr.update.UpdateLog.lookupVersion(UpdateLog.java:783)\\n  2&gt;    at org.apache.solr.update.VersionInfo.lookupVersion(VersionInfo.java:195)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1088)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:705)\\n  2&gt;    at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.handleAdds(JsonLoader.java:470)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.processUpdate(JsonLoader.java:134)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.load(JsonLoader.java:113)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader.load(JsonLoader.java:76)\\n  2&gt;    at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:98)\\n  2&gt;    at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\\n  2&gt;    at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:151)\\n  2&gt;    at org.apache.solr.core.SolrCore.execute(SolrCore.java:2079)\\n  2&gt;    at org.apache.solr.servlet.DirectSolrConnection.request(DirectSolrConnection.java:131)\\n  2&gt;    at org.apache.solr.SolrTestCaseJ4.updateJ(SolrTestCaseJ4.java:1104)\\n  2&gt;    at org.apache.solr.SolrTestCaseJ4.addAndGetVersion(SolrTestCaseJ4.java:1250)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock.addDoc(TestReloadDeadlock.java:200)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock.access$100(TestReloadDeadlock.java:46)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock$1.run(TestReloadDeadlock.java:156)\\n  2&gt; Caused by: java.lang.NullPointerException\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1642)\\n  2&gt;    ... 21 more\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14697613_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697613_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 19:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T19:46:31+0000\'\u003e14\\/Aug\\/15 19:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, so it wasn\'t too hard for me to replicate the deadlocks w\\/ the latest commits backed out, and the traces are similar to what was posted before... it\'s getIndexWriter fighting with newIndexWriter. \\n\\n  \\n   2&gt;  \\\"WRITER10\\\"  ID=28 TIMED_WAITING on java.lang. Object @d8cdd45\\n  2&gt;    at java.lang. Object .wait(Native Method)\\n  2&gt;    - timed waiting on java.lang. Object @d8cdd45\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.getIndexWriter(DefaultSolrCoreState.java:96)\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1588)\\n  2&gt;    at org.apache.solr.update.UpdateLog.add(UpdateLog.java:455)\\n  2&gt;    - locked org.apache.solr.update.UpdateLog@1df2955d\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addAndDelete(DirectUpdateHandler2.java:452)\\n[...]\\n  2&gt;  \\\"TEST-TestReloadDeadlock.testReloadDeadlock-seed#[D13A45EBBFA304C4]\\\"  ID=12 TIMED_WAITING on java.lang. Object @d8cdd45\\n  2&gt;    at java.lang. Object .wait(Native Method)\\n  2&gt;    - timed waiting on java.lang. Object @d8cdd45\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.newIndexWriter(DefaultSolrCoreState.java:158)\\n  2&gt;    - locked org.apache.solr.update.DefaultSolrCoreState@7d338874\\n  2&gt;    at org.apache.solr.core.SolrCore.reload(SolrCore.java:479)\\n  2&gt;    at org.apache.solr.core.CoreContainer.reload(CoreContainer.java:830)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock.testReloadDeadlock(TestReloadDeadlock.java:182)\\n \\n  \\n\\n On straight trunk, I still get failures (just not deadlocks): \\n  \\n   2&gt; 3406 ERROR (WRITER6) [    ] o.a.s.c.SolrCore org.apache.solr.common.SolrException: Error opening  new  searcher\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1673)\\n  2&gt;    at org.apache.solr.core.SolrCore.getRealtimeSearcher(SolrCore.java:1530)\\n  2&gt;    at org.apache.solr.update.VersionInfo.getVersionFromIndex(VersionInfo.java:202)\\n  2&gt;    at org.apache.solr.update.UpdateLog.lookupVersion(UpdateLog.java:783)\\n  2&gt;    at org.apache.solr.update.VersionInfo.lookupVersion(VersionInfo.java:195)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.versionAdd(DistributedUpdateProcessor.java:1088)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.processAdd(DistributedUpdateProcessor.java:705)\\n  2&gt;    at org.apache.solr.update.processor.LogUpdateProcessor.processAdd(LogUpdateProcessorFactory.java:104)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.handleAdds(JsonLoader.java:470)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.processUpdate(JsonLoader.java:134)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader$SingleThreadedJsonLoader.load(JsonLoader.java:113)\\n  2&gt;    at org.apache.solr.handler.loader.JsonLoader.load(JsonLoader.java:76)\\n  2&gt;    at org.apache.solr.handler.UpdateRequestHandler$1.load(UpdateRequestHandler.java:98)\\n  2&gt;    at org.apache.solr.handler.ContentStreamHandlerBase.handleRequestBody(ContentStreamHandlerBase.java:74)\\n  2&gt;    at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:151)\\n  2&gt;    at org.apache.solr.core.SolrCore.execute(SolrCore.java:2079)\\n  2&gt;    at org.apache.solr.servlet.DirectSolrConnection.request(DirectSolrConnection.java:131)\\n  2&gt;    at org.apache.solr.SolrTestCaseJ4.updateJ(SolrTestCaseJ4.java:1104)\\n  2&gt;    at org.apache.solr.SolrTestCaseJ4.addAndGetVersion(SolrTestCaseJ4.java:1250)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock.addDoc(TestReloadDeadlock.java:200)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock.access$100(TestReloadDeadlock.java:46)\\n  2&gt;    at org.apache.solr.search.TestReloadDeadlock$1.run(TestReloadDeadlock.java:156)\\n  2&gt; Caused by: java.lang.NullPointerException\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1642)\\n  2&gt;    ... 21 more\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14697655\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14697655&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14697655\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14697655_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697655_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 20:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T20:02:45+0000\'\u003e14\\/Aug\\/15 20:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eand the traces are similar to what was posted before\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere is not a third thread that has the Writer out? Both of those traces line up with another thread having the writer. I don\'t spend why they would deadlock each other without another thread involved.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll take a closer look now that I can duplicate it. I still suspect the proper fix for this is in SolrCoreState.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14697655_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697655_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 20:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T20:02:45+0000\'\u003e14\\/Aug\\/15 20:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     and the traces are similar to what was posted before  \\n\\n There is not a third thread that has the Writer out? Both of those traces line up with another thread having the writer. I don\'t spend why they would deadlock each other without another thread involved. \\n\\n I\'ll take a closer look now that I can duplicate it. I still suspect the proper fix for this is in SolrCoreState.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14697747\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14697747&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14697747\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14697747_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697747_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 21:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T21:01:38+0000\'\u003e14\\/Aug\\/15 21:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran the StressTestReorder yesterday with the changes and didn\'t get it to fail for 50 runs on my laptop. Then last night I kicked off a 1,000 repetition run on my home machine and... didn\'t remember to look this morning before I left home.\u003c\\/p\u003e\\n\\n\u003cp\u003eSo I\'m pretty sure that StressTestReorder is OK with the latest patch, I\'ll look tonight to be sure.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e I saw what I think is the same failure on the dev list from a Jenkins build last night and AFAIK the changes are still in there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14697747_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697747_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 21:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T21:01:38+0000\'\u003e14\\/Aug\\/15 21:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran the StressTestReorder yesterday with the changes and didn\'t get it to fail for 50 runs on my laptop. Then last night I kicked off a 1,000 repetition run on my home machine and... didn\'t remember to look this morning before I left home. \\n\\n So I\'m pretty sure that StressTestReorder is OK with the latest patch, I\'ll look tonight to be sure. \\n\\n  Yonik Seeley  I saw what I think is the same failure on the dev list from a Jenkins build last night and AFAIK the changes are still in there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14697771\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14697771&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14697771\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14697771_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697771_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 21:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T21:21:30+0000\'\u003e14\\/Aug\\/15 21:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThere is not a third thread that has the Writer out?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI just checked again... didn\'t see another.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eBoth of those traces line up with another thread having the writer. I don\'t spend why they would deadlock each other without another thread involved.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThe first thread has the writer?  I have never really reviewed SolrCoreState in depth though... so I\'m still not really sure.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14697771_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697771_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 21:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T21:21:30+0000\'\u003e14\\/Aug\\/15 21:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     There is not a third thread that has the Writer out?  \\n\\n I just checked again... didn\'t see another. \\n\\n  Both of those traces line up with another thread having the writer. I don\'t spend why they would deadlock each other without another thread involved.  \\n\\n The first thread has the writer?  I have never really reviewed SolrCoreState in depth though... so I\'m still not really sure.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14697858\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14697858&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14697858\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14697858_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697858_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 22:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T22:20:17+0000\'\u003e14\\/Aug\\/15 22:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHere\'s the scenario w\\/ the old code.\u003c\\/p\u003e\\n\\n\u003cp\u003ethread1 does an add:\u003cbr\\/\u003e\\n  1) in DUH2, calls coreState.getIndexWriter()\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ethis increments the ref count on the writer and sets coreState.writerFree=false\u003cbr\\/\u003e\\n  2) calls UpdateLog.add\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ethread2 calls core reload():\u003cbr\\/\u003e\\n  3) calls coreState.newIndexWriter()\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ecoreState.pauseWriter is set to true, so no new references will be handed out\u003c\\/li\u003e\\n\\t\u003cli\u003egoes into a loop waiting for writerFree=true (for all other references that were handed out to be returned)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003ethread1:\u003cbr\\/\u003e\\n  4) UpdateLog.add continues and indirectly causes coreState.getIndexWriter() to be called\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003esees coreState.pauseWriter set to true and thus does into wait loop\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eSo: one can\'t call getIndexWriter() and then do anything else that will eventually call getIndexWriter() or newIndexWriter()\u003cbr\\/\u003e\\nIf we keep that restriction, then moving the ulog.add outside of the getIndexWriter\\/release block was correct.\u003c\\/p\u003e\\n\\n\u003cp\u003eDon\'t know about the other changes... the extra sync added in DUH2 does still seem unnecessary.  And I haven\'t looked at what changes were made to SolrCoreState yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14697858_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14697858_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Aug\\/15 22:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-14T22:20:17+0000\'\u003e14\\/Aug\\/15 22:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Here\'s the scenario w\\/ the old code. \\n\\n thread1 does an add: \\n  1) in DUH2, calls coreState.getIndexWriter() \\n \\n\\t this increments the ref count on the writer and sets coreState.writerFree=false \\n  2) calls UpdateLog.add \\n \\n\\n\\n thread2 calls core reload(): \\n  3) calls coreState.newIndexWriter() \\n \\n\\t coreState.pauseWriter is set to true, so no new references will be handed out \\n\\t goes into a loop waiting for writerFree=true (for all other references that were handed out to be returned) \\n \\n\\n\\n thread1: \\n  4) UpdateLog.add continues and indirectly causes coreState.getIndexWriter() to be called \\n \\n\\t sees coreState.pauseWriter set to true and thus does into wait loop \\n \\n\\n\\n So: one can\'t call getIndexWriter() and then do anything else that will eventually call getIndexWriter() or newIndexWriter() \\nIf we keep that restriction, then moving the ulog.add outside of the getIndexWriter\\/release block was correct. \\n\\n Don\'t know about the other changes... the extra sync added in DUH2 does still seem unnecessary.  And I haven\'t looked at what changes were made to SolrCoreState yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698050\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698050&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698050\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14698050_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698050_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 01:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T01:52:09+0000\'\u003e15\\/Aug\\/15 01:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e Glad to see you\'re seeing the same thing I saw, senility is not here yet!\u003c\\/p\u003e\\n\\n\u003cp\u003eI looked at the StressTestReorder when I got back home tonight and 1,000 iterations went through fine. Whew!\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll remove the extra synch in DUH2 and run the tests tonight to see what happens, along with some additional debugging in case we hit the null pointer exception again. Not a clue what\'s happening there.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14698050_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698050_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 01:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T01:52:09+0000\'\u003e15\\/Aug\\/15 01:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yonik Seeley  Glad to see you\'re seeing the same thing I saw, senility is not here yet! \\n\\n I looked at the StressTestReorder when I got back home tonight and 1,000 iterations went through fine. Whew! \\n\\n I\'ll remove the extra synch in DUH2 and run the tests tonight to see what happens, along with some additional debugging in case we hit the null pointer exception again. Not a clue what\'s happening there.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698083\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698083&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698083\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698083_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698083_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 03:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T03:22:01+0000\'\u003e15\\/Aug\\/15 03:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe NPE failures are likely unrelated to any changes made thus far... I think it\'s probably related to the fact that \\\"uhandler\\\" can abruptly change in the UpdateLog on a reload, and can be used perhaps before it\'s ready?  I haven\'t gone down that rabbit hole...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698083_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698083_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 03:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T03:22:01+0000\'\u003e15\\/Aug\\/15 03:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The NPE failures are likely unrelated to any changes made thus far... I think it\'s probably related to the fact that \\\"uhandler\\\" can abruptly change in the UpdateLog on a reload, and can be used perhaps before it\'s ready?  I haven\'t gone down that rabbit hole...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698257\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698257&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698257\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698257_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698257_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T13:09:12+0000\'\u003e15\\/Aug\\/15 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI ran a while with trunk, with removing the extra sync on the normal \\\"add\\\" case only, not the \\\"addDelete\\\" case.\u003cbr\\/\u003e\\nI hit another deadlock.\u003cbr\\/\u003e\\nThis looks like the case Mark was looking for before... with a different thread holding the writer.\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  2&gt; \u003cspan class=\\\"code-quote\\\"\u003e\\\"WRITER5\\\"\u003c\\/span\u003e ID=23 BLOCKED on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5764facb owned by \u003cspan class=\\\"code-quote\\\"\u003e\\\"WRITER4\\\"\u003c\\/span\u003e ID=22\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.commit(DirectUpdateHandler2.java:593)\\n  2&gt;    - blocked on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5764facb\\n  2&gt;    at org.apache.solr.update.processor.RunUpdateProcessor.processCommit(RunUpdateProcessorFactory.java:95)\\n  2&gt;    at org.apache.solr.update.processor.UpdateRequestProcessor.processCommit(UpdateRequestProcessor.java:64)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalCommit(DistributedUpdateProcessor.java:1641)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.processCommit(DistributedUpdateProcessor.java:1618)\\n  2&gt;    at org.apache.solr.update.processor.LogUpdateProcessor.processCommit(LogUpdateProcessorFactory.java:161)\\n  2&gt;    at org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:270)\\n[...]\\n  2&gt; \u003cspan class=\\\"code-quote\\\"\u003e\\\"WRITER4\\\"\u003c\\/span\u003e ID=22 TIMED_WAITING on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5a94059a\\n  2&gt;    at java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e.wait(Native Method)\\n  2&gt;    - timed waiting on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5a94059a\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.getIndexWriter(DefaultSolrCoreState.java:96)\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1588)\\n  2&gt;    at org.apache.solr.update.UpdateLog.add(UpdateLog.java:455)\\n  2&gt;    - locked org.apache.solr.update.UpdateLog@5911991e\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addAndDelete(DirectUpdateHandler2.java:331)\\n  2&gt;    - locked java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5764facb\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:200)\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:164)\\n  2&gt;    at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\\n[...]\\n  2&gt; \u003cspan class=\\\"code-quote\\\"\u003e\\\"TEST-TestReloadDeadlock.testReloadDeadlock-seed#[D4E455E167793E1]\\\"\u003c\\/span\u003e ID=12 TIMED_WAITING on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5a94059a\\n  2&gt;    at java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e.wait(Native Method)\\n  2&gt;    - timed waiting on java.lang.\u003cspan class=\\\"code-object\\\"\u003eObject\u003c\\/span\u003e@5a94059a\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.newIndexWriter(DefaultSolrCoreState.java:156)\\n  2&gt;    - locked org.apache.solr.update.DefaultSolrCoreState@1b88614d\\n  2&gt;    at org.apache.solr.core.SolrCore.reload(SolrCore.java:479)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eWriter5 wants to do a commit\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ecalls solrCoreState.getIndexWriter()\u003c\\/li\u003e\\n\\t\u003cli\u003eblocks waiting for updateLock\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eWriter4 wants to do an addAndDelete\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eaquires updateLock\u003c\\/li\u003e\\n\\t\u003cli\u003eaquires UpdateLog.this\u003c\\/li\u003e\\n\\t\u003cli\u003ecalls DefaultSolrCoreState.getIndexWriter and waits forever\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eMain-test-thread wants to do a reload:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003ecalls DefaultSolrCoreState.newIndexWriter and waits forever\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt feels like this type of deadlock can still be hit on trunk now unmodified?\u003cbr\\/\u003e\\nPerhaps the right solution was to just pass the IndexWriter down once you aquire it. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698257_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698257_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 13:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T13:09:12+0000\'\u003e15\\/Aug\\/15 13:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I ran a while with trunk, with removing the extra sync on the normal \\\"add\\\" case only, not the \\\"addDelete\\\" case. \\nI hit another deadlock. \\nThis looks like the case Mark was looking for before... with a different thread holding the writer. \\n\\n  \\n   2&gt;  \\\"WRITER5\\\"  ID=23 BLOCKED on java.lang. Object @5764facb owned by  \\\"WRITER4\\\"  ID=22\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.commit(DirectUpdateHandler2.java:593)\\n  2&gt;    - blocked on java.lang. Object @5764facb\\n  2&gt;    at org.apache.solr.update.processor.RunUpdateProcessor.processCommit(RunUpdateProcessorFactory.java:95)\\n  2&gt;    at org.apache.solr.update.processor.UpdateRequestProcessor.processCommit(UpdateRequestProcessor.java:64)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.doLocalCommit(DistributedUpdateProcessor.java:1641)\\n  2&gt;    at org.apache.solr.update.processor.DistributedUpdateProcessor.processCommit(DistributedUpdateProcessor.java:1618)\\n  2&gt;    at org.apache.solr.update.processor.LogUpdateProcessor.processCommit(LogUpdateProcessorFactory.java:161)\\n  2&gt;    at org.apache.solr.handler.loader.XMLLoader.processUpdate(XMLLoader.java:270)\\n[...]\\n  2&gt;  \\\"WRITER4\\\"  ID=22 TIMED_WAITING on java.lang. Object @5a94059a\\n  2&gt;    at java.lang. Object .wait(Native Method)\\n  2&gt;    - timed waiting on java.lang. Object @5a94059a\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.getIndexWriter(DefaultSolrCoreState.java:96)\\n  2&gt;    at org.apache.solr.core.SolrCore.openNewSearcher(SolrCore.java:1588)\\n  2&gt;    at org.apache.solr.update.UpdateLog.add(UpdateLog.java:455)\\n  2&gt;    - locked org.apache.solr.update.UpdateLog@5911991e\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addAndDelete(DirectUpdateHandler2.java:331)\\n  2&gt;    - locked java.lang. Object @5764facb\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addDoc0(DirectUpdateHandler2.java:200)\\n  2&gt;    at org.apache.solr.update.DirectUpdateHandler2.addDoc(DirectUpdateHandler2.java:164)\\n  2&gt;    at org.apache.solr.update.processor.RunUpdateProcessor.processAdd(RunUpdateProcessorFactory.java:69)\\n[...]\\n  2&gt;  \\\"TEST-TestReloadDeadlock.testReloadDeadlock-seed#[D4E455E167793E1]\\\"  ID=12 TIMED_WAITING on java.lang. Object @5a94059a\\n  2&gt;    at java.lang. Object .wait(Native Method)\\n  2&gt;    - timed waiting on java.lang. Object @5a94059a\\n  2&gt;    at org.apache.solr.update.DefaultSolrCoreState.newIndexWriter(DefaultSolrCoreState.java:156)\\n  2&gt;    - locked org.apache.solr.update.DefaultSolrCoreState@1b88614d\\n  2&gt;    at org.apache.solr.core.SolrCore.reload(SolrCore.java:479)\\n \\n  \\n\\n Writer5 wants to do a commit \\n \\n\\t calls solrCoreState.getIndexWriter() \\n\\t blocks waiting for updateLock \\n \\n\\n\\n Writer4 wants to do an addAndDelete \\n \\n\\t aquires updateLock \\n\\t aquires UpdateLog.this \\n\\t calls DefaultSolrCoreState.getIndexWriter and waits forever \\n \\n\\n\\n Main-test-thread wants to do a reload: \\n \\n\\t calls DefaultSolrCoreState.newIndexWriter and waits forever \\n \\n\\n\\n It feels like this type of deadlock can still be hit on trunk now unmodified? \\nPerhaps the right solution was to just pass the IndexWriter down once you aquire it.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698267\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698267&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698267\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698267_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698267_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T13:40:50+0000\'\u003e15\\/Aug\\/15 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePassing the indexWriter down would also fix the NPEs I think since then openReader wouldn\'t try to obtain it from the yet-to-be-finished new update handler?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698267_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698267_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Aug\\/15 13:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-15T13:40:50+0000\'\u003e15\\/Aug\\/15 13:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Passing the indexWriter down would also fix the NPEs I think since then openReader wouldn\'t try to obtain it from the yet-to-be-finished new update handler?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698671\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698671&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698671\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698671_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698671_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 13:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T13:49:27+0000\'\u003e16\\/Aug\\/15 13:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I let the current unmodified trunk run overnight.\u003cbr\\/\u003e\\nI got 14 fails, 4 of which were deadlocks.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s the only changes I made to the test:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eIndex: solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/search\\/TestReloadDeadlock.java\\n===================================================================\\n--- solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/search\\/TestReloadDeadlock.java\\t(revision 1695727)\\n+++ solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/search\\/TestReloadDeadlock.java\\t(working copy)\\n@@ -74,7 +74,7 @@\\n     \u003cspan class=\\\"code-object\\\"\u003eint\u003c\\/span\u003e nWriteThreads = 5 + random().nextInt(10);\\n \\n     \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ query variables\\n\u003c\\/span\u003e-    \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e AtomicLong reloads = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e AtomicLong(50);  \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ number of reloads. Increase \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e number to force failure.\\n\u003c\\/span\u003e+    \u003cspan class=\\\"code-keyword\\\"\u003efinal\u003c\\/span\u003e AtomicLong reloads = \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e AtomicLong(200);  \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ number of reloads. Increase \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e number to force failure.\\n\u003c\\/span\u003e \\n     ifVerbose(\u003cspan class=\\\"code-quote\\\"\u003e\\\"commitPercent\\\"\u003c\\/span\u003e, commitPercent, \u003cspan class=\\\"code-quote\\\"\u003e\\\"deleteByQueryPercent\\\"\u003c\\/span\u003e, deleteByQueryPercent\\n         , \u003cspan class=\\\"code-quote\\\"\u003e\\\"ndocs\\\"\u003c\\/span\u003e, ndocs, \u003cspan class=\\\"code-quote\\\"\u003e\\\"nWriteThreads\\\"\u003c\\/span\u003e, nWriteThreads, \u003cspan class=\\\"code-quote\\\"\u003e\\\"reloads\\\"\u003c\\/span\u003e, reloads);\\n@@ -177,7 +177,7 @@\\n \\n     \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ The reload operation really doesn\'t need to happen from multiple threads, we just want it firing pretty often.\\n\u003c\\/span\u003e     \u003cspan class=\\\"code-keyword\\\"\u003ewhile\u003c\\/span\u003e (reloads.get() &gt; 0) {\\n-      \u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.sleep(10 + random().nextInt(250));\\n+      \u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.sleep(1 + random().nextInt(50));\\n       reloads.decrementAndGet();\\n       h.getCoreContainer().reload(\u003cspan class=\\\"code-quote\\\"\u003e\\\"collection1\\\"\u003c\\/span\u003e);\\n     }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698671_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698671_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 13:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T13:49:27+0000\'\u003e16\\/Aug\\/15 13:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I let the current unmodified trunk run overnight. \\nI got 14 fails, 4 of which were deadlocks. \\n\\n Here\'s the only changes I made to the test: \\n  \\n Index: solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/search\\/TestReloadDeadlock.java\\n===================================================================\\n--- solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/search\\/TestReloadDeadlock.java\\t(revision 1695727)\\n+++ solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/search\\/TestReloadDeadlock.java\\t(working copy)\\n@@ -74,7 +74,7 @@\\n      int  nWriteThreads = 5 + random().nextInt(10);\\n \\n      \\/\\/ query variables\\n -     final  AtomicLong reloads =  new  AtomicLong(50);   \\/\\/ number of reloads. Increase  this  number to force failure.\\n +     final  AtomicLong reloads =  new  AtomicLong(200);   \\/\\/ number of reloads. Increase  this  number to force failure.\\n  \\n     ifVerbose( \\\"commitPercent\\\" , commitPercent,  \\\"deleteByQueryPercent\\\" , deleteByQueryPercent\\n         ,  \\\"ndocs\\\" , ndocs,  \\\"nWriteThreads\\\" , nWriteThreads,  \\\"reloads\\\" , reloads);\\n@@ -177,7 +177,7 @@\\n \\n      \\/\\/ The reload operation really doesn\'t need to happen from multiple threads, we just want it firing pretty often.\\n       while  (reloads.get() &gt; 0) {\\n-       Thread .sleep(10 + random().nextInt(250));\\n+       Thread .sleep(1 + random().nextInt(50));\\n       reloads.decrementAndGet();\\n       h.getCoreContainer().reload( \\\"collection1\\\" );\\n     }\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698680\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698680&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698680\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14698680_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698680_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:16:08+0000\'\u003e16\\/Aug\\/15 14:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eSo: one can\'t call getIndexWriter() and then do anything else that will eventually call getIndexWriter() or newIndexWriter()\u003cbr\\/\u003e\\nIf we keep that restriction, then moving the ulog.add outside of the getIndexWriter\\/release block was correct.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eRight - the expected use is to be careful and quickly get and release the writer so that you don\'t accidentally try and getwriter or newwriter in between. This is why I thought Erik\'s first fix attempt sounded right. But then I guess he started hitting the deadlock you are still getting and figured it was not correct. Seems like it is correct, but we also have to address this other issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14698680_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698680_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:16:08+0000\'\u003e16\\/Aug\\/15 14:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n So: one can\'t call getIndexWriter() and then do anything else that will eventually call getIndexWriter() or newIndexWriter() \\nIf we keep that restriction, then moving the ulog.add outside of the getIndexWriter\\/release block was correct.  \\n\\n Right - the expected use is to be careful and quickly get and release the writer so that you don\'t accidentally try and getwriter or newwriter in between. This is why I thought Erik\'s first fix attempt sounded right. But then I guess he started hitting the deadlock you are still getting and figured it was not correct. Seems like it is correct, but we also have to address this other issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698687\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698687&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698687\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14698687_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698687_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:22:37+0000\'\u003e16\\/Aug\\/15 14:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ePerhaps the right solution was to just pass the IndexWriter down once you aquire it.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003ePassing the indexWriter down would also fix the NPEs I think since then openReader wouldn\'t try to obtain it from the yet-to-be-finished new update handler?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eWasn\'t that Erik\'s first fix attempt?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI think the solution is to just pass the IndexWriter down to addAndDelete, but won\'t have time to really look until this evening.\u003c\\/p\u003e\u003c\\/blockquote\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14698687_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698687_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:22:37+0000\'\u003e16\\/Aug\\/15 14:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Perhaps the right solution was to just pass the IndexWriter down once you aquire it.  \\n  Passing the indexWriter down would also fix the NPEs I think since then openReader wouldn\'t try to obtain it from the yet-to-be-finished new update handler?  \\n\\n Wasn\'t that Erik\'s first fix attempt? \\n\\n  I think the solution is to just pass the IndexWriter down to addAndDelete, but won\'t have time to really look until this evening.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698697\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698697&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698697\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698697_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698697_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:39:38+0000\'\u003e16\\/Aug\\/15 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eWasn\'t that Erik\'s first fix attempt?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eYeah, I was essentially saying that seems to be the correct approach.\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698697_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698697_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:39:38+0000\'\u003e16\\/Aug\\/15 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Wasn\'t that Erik\'s first fix attempt?  \\n\\n Yeah, I was essentially saying that seems to be the correct approach. \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698699\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698699&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698699\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14698699_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698699_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:47:12+0000\'\u003e16\\/Aug\\/15 14:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmm, I wonder what was still not working about it yet. I should be able to duplicate this too now, I\'ll take a look at the stack traces with just that change.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14698699_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698699_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 14:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T14:47:12+0000\'\u003e16\\/Aug\\/15 14:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmm, I wonder what was still not working about it yet. I should be able to duplicate this too now, I\'ll take a look at the stack traces with just that change.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698724\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698724&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698724\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698724_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698724_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T15:29:12+0000\'\u003e16\\/Aug\\/15 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAt some point in time, it seems like everyone develops some sort of script to run a test over and over again...\u003cbr\\/\u003e\\nI really should have put this up years ago:\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/github.com\\/yonik\\/misc\\/blob\\/master\\/scripts\\/test.sh\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/github.com\\/yonik\\/misc\\/blob\\/master\\/scripts\\/test.sh\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14698724_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698724_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 15:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T15:29:12+0000\'\u003e16\\/Aug\\/15 15:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    At some point in time, it seems like everyone develops some sort of script to run a test over and over again... \\nI really should have put this up years ago: \\n https:\\/\\/github.com\\/yonik\\/misc\\/blob\\/master\\/scripts\\/test.sh               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698752\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698752&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698752\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14698752_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698752_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 16:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T16:48:02+0000\'\u003e16\\/Aug\\/15 16:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Erick Erickson - 16\\/Aug\\/15 17:14\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e If you check out trunk revision 1694809, then the stack trace above in the deadlock_5_pass_iw.res.zip is the problem I hit by passing the indexwriter down to DUH2.addanddelete. It really doesn\'t help because updatelog.add has this bit of code:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e        \u003cspan class=\\\"code-keyword\\\"\u003etry\u003c\\/span\u003e {\\n          RefCounted e1 = \u003cspan class=\\\"code-keyword\\\"\u003ethis\u003c\\/span\u003e.uhandler.core.openNewSearcher(\u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e, \u003cspan class=\\\"code-keyword\\\"\u003etrue\u003c\\/span\u003e);\\n          e1.decref();\\n        } \u003cspan class=\\\"code-keyword\\\"\u003ecatch\u003c\\/span\u003e (Exception var8) {\\n          SolrException.log(log, \u003cspan class=\\\"code-quote\\\"\u003e\\\"Error opening realtime searcher \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e deleteByQuery\\\"\u003c\\/span\u003e, var8);\\n        }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eso the IW passed to addAndDelete in DUH2 doesn\'t make a difference, the fact that the IW is held open is blocking the call to openNewSearcher above; it doesn\'t matter whether addAndDelete has an already opened IW passed in or opens its own, as long as the IW is open across the call to ulog.add(), a deadlock occurs. Sometimes.\u003c\\/p\u003e\\n\\n\u003cp\u003eBased on the exception message, would a better approach be to open up the new searcher in delete by query instead? Would that cover all the cases? I\'ll look a little here. Then I could move all the ulog.add()s back inside the associated IW and again tightly couple the document adds with updating the ulog.\u003c\\/p\u003e\\n\\n\u003cp\u003eOr maybe the answer is making realtime searchers sensitive to whether anything\'s been indexed since the last time it was opened rather than pre-opening a new one in addDoc0(). Don\'t even know if it\'s possible, haven\'t looked yet. Essentially this would make opening a realtime searcher \\\"lazy\\\". Which I can argue is a better solution than adding this overhead to all updates, although it also seems it would make realtime gets vary a lot depending on whether they had to open a searcher or not.\u003c\\/p\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14698752_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698752_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 16:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T16:48:02+0000\'\u003e16\\/Aug\\/15 16:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Erick Erickson - 16\\/Aug\\/15 17:14\\\"\u003eedited\u003c\\/span\u003e                    Mark Miller  If you check out trunk revision 1694809, then the stack trace above in the deadlock_5_pass_iw.res.zip is the problem I hit by passing the indexwriter down to DUH2.addanddelete. It really doesn\'t help because updatelog.add has this bit of code: \\n  \\n          try  {\\n          RefCounted e1 =  this .uhandler.core.openNewSearcher( true ,  true );\\n          e1.decref();\\n        }  catch  (Exception var8) {\\n          SolrException.log(log,  \\\"Error opening realtime searcher  for  deleteByQuery\\\" , var8);\\n        }\\n \\n  \\n so the IW passed to addAndDelete in DUH2 doesn\'t make a difference, the fact that the IW is held open is blocking the call to openNewSearcher above; it doesn\'t matter whether addAndDelete has an already opened IW passed in or opens its own, as long as the IW is open across the call to ulog.add(), a deadlock occurs. Sometimes. \\n\\n Based on the exception message, would a better approach be to open up the new searcher in delete by query instead? Would that cover all the cases? I\'ll look a little here. Then I could move all the ulog.add()s back inside the associated IW and again tightly couple the document adds with updating the ulog. \\n\\n Or maybe the answer is making realtime searchers sensitive to whether anything\'s been indexed since the last time it was opened rather than pre-opening a new one in addDoc0(). Don\'t even know if it\'s possible, haven\'t looked yet. Essentially this would make opening a realtime searcher \\\"lazy\\\". Which I can argue is a better solution than adding this overhead to all updates, although it also seems it would make realtime gets vary a lot depending on whether they had to open a searcher or not. \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14698792\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14698792&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14698792\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14698792_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698792_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 17:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T17:45:06+0000\'\u003e16\\/Aug\\/15 17:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePoking a little more, opening a new searcher in add happens only when clearCaches==true, which only happens explicitly in DUH2.addAndDelete which is where all this started. There\'s also a call in the CDCR code that passes a variable in, but I don\'t think that\'s really relevant.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt\'s simple enough to move opening a new searcher up to these two places, I\'ll give it a try to evaluate. I don\'t like that solution much since it\'s trappy; a new call to add(cmd, true) that fails to open a new searcher could re-introduce the problem that opening that searcher where it\'s done now is designed to prevent. I suppose a big fat warning is in order?\u003c\\/p\u003e\\n\\n\u003cp\u003eLet me try it just to see whether it cures things or not. I\'m pretty sure it\'ll cure the deadlock problem, I\'ll first try to just comment out the openSearcher and see if I can blow up the real time get tests, then move the open out and see if either realtime get tests or the new deadlock test fail with the reorganized code. When I collect that data we can discuss some more. Probably have something later today.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e Those numbers in the new test were chosen completely arbitrarily, I\'m guessing that the point of your changes is to drive the failure more often without lengthening the time the test takes, so I\'ll incorporate them.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14698792_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14698792_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Aug\\/15 17:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-16T17:45:06+0000\'\u003e16\\/Aug\\/15 17:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Poking a little more, opening a new searcher in add happens only when clearCaches==true, which only happens explicitly in DUH2.addAndDelete which is where all this started. There\'s also a call in the CDCR code that passes a variable in, but I don\'t think that\'s really relevant. \\n\\n It\'s simple enough to move opening a new searcher up to these two places, I\'ll give it a try to evaluate. I don\'t like that solution much since it\'s trappy; a new call to add(cmd, true) that fails to open a new searcher could re-introduce the problem that opening that searcher where it\'s done now is designed to prevent. I suppose a big fat warning is in order? \\n\\n Let me try it just to see whether it cures things or not. I\'m pretty sure it\'ll cure the deadlock problem, I\'ll first try to just comment out the openSearcher and see if I can blow up the real time get tests, then move the open out and see if either realtime get tests or the new deadlock test fail with the reorganized code. When I collect that data we can discuss some more. Probably have something later today. \\n\\n  Yonik Seeley  Those numbers in the new test were chosen completely arbitrarily, I\'m guessing that the point of your changes is to drive the failure more often without lengthening the time the test takes, so I\'ll incorporate them.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14703493\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14703493&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14703493\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14703493_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14703493_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/15 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-19T18:11:40+0000\'\u003e19\\/Aug\\/15 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch should be applied after \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e.patch if anyone is back-porting\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s a new patch for comment that \u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eputs the ulog writes back inside the IW blocks\u003c\\/li\u003e\\n\\t\u003cli\u003epulls out the problematic open searcher in ulog.add to a separate method.\u003c\\/li\u003e\\n\\t\u003cli\u003ecalls the extracted method from the two places that could call UpdateLog.add(cmd, true), which was the condition for opening a new searcher. The calls to the new method must be outside the IW block.\u003c\\/li\u003e\\n\\t\u003cli\u003eremoves the extra synchronized blocks on solrCoreState.getUpdatelock()\u003c\\/li\u003e\\n\\t\u003cli\u003echanges the test to hit this condition harder as per Yonik.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eIt\'s possible that the CDCR code calls ulog.add with clearCaches==true, in which case the extracted method in ulog is called. Frankly I doubt that\'s a necessary thing, but seems harmless.\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t particularly like decoupling the open searcher from the updatelog.add, but I like lockups even less. Not to mention possible tlog craziness. So I\'ll live with my dislike.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think this addresses concerns about the tlog synchronization.\u003c\\/p\u003e\\n\\n\u003cp\u003eI ran this last night for 360 iterations, then made some trivial changes (yeah, right). I\'ll try some beasting on this today plus StressTestReorder, then do the usual precommit and full test. Assuming all that goes well I\'ll probably check this in tomorrow and call this done unless there are objections.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis, coupled with Yoniks changes for the NPE should put this to bed.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e all comments welcome of course.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14703493_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14703493_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/15 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-19T18:11:40+0000\'\u003e19\\/Aug\\/15 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch should be applied after   SOLR-7836  .patch if anyone is back-porting \\n\\n Here\'s a new patch for comment that  \\n \\n\\t puts the ulog writes back inside the IW blocks \\n\\t pulls out the problematic open searcher in ulog.add to a separate method. \\n\\t calls the extracted method from the two places that could call UpdateLog.add(cmd, true), which was the condition for opening a new searcher. The calls to the new method must be outside the IW block. \\n\\t removes the extra synchronized blocks on solrCoreState.getUpdatelock() \\n\\t changes the test to hit this condition harder as per Yonik. \\n \\n\\n\\n It\'s possible that the CDCR code calls ulog.add with clearCaches==true, in which case the extracted method in ulog is called. Frankly I doubt that\'s a necessary thing, but seems harmless. \\n\\n I don\'t particularly like decoupling the open searcher from the updatelog.add, but I like lockups even less. Not to mention possible tlog craziness. So I\'ll live with my dislike. \\n\\n I think this addresses concerns about the tlog synchronization. \\n\\n I ran this last night for 360 iterations, then made some trivial changes (yeah, right). I\'ll try some beasting on this today plus StressTestReorder, then do the usual precommit and full test. Assuming all that goes well I\'ll probably check this in tomorrow and call this done unless there are objections. \\n\\n This, coupled with Yoniks changes for the NPE should put this to bed. \\n\\n  Mark Miller   Yonik Seeley  all comments welcome of course.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14705052\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14705052&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14705052\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14705052_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705052_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T14:53:40+0000\'\u003e20\\/Aug\\/15 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003epulls out the problematic open searcher in ulog.add to a separate method.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eThere are a few areas with complex synchronization that should not be changed unless one is confident about understanding why all the synchronization was there in the first place.  Having the tests pass isn\'t a high enough bar for these areas because of the difficulty in actually getting a test to expose subtle race conditions or thread safety issues.  This comes back to my original \\\"get it back in my head\\\" - I don\'t fee comfortable messing with this stuff either until I\'ve really internalized the bigger picture again... and it doesn\'t last \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/wink.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eFor the specific case above, one can\'t just take what was one synchronized block and break it up into two.  It certainly creates race conditions and breaks the invariants we try to keep.  The specific invariant here is that if it\'s not in the tlog maps, then it is guaranteed to be in the realtime reader.  Hopefully some of our tests would fail with this latest patch... but it\'s hard stuff to test.\u003c\\/p\u003e\\n\\n\u003cp\u003eI worked up a patch that passed down the IndexWriter (it needs to be passed \u003cb\u003eall\u003c\\/b\u003e the way down to SolrCore.openSearcher to actually avoid deadlocks).  That ended up changing more code than I\'d like... so now I\'m working up a patch to make IW locking re-entrant.  That approach should be less fragile going forward (i.e. less likely to easily introduce a deadlock through seemingly unrelated changes).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14705052_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705052_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 14:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T14:53:40+0000\'\u003e20\\/Aug\\/15 14:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     pulls out the problematic open searcher in ulog.add to a separate method.  \\n\\n There are a few areas with complex synchronization that should not be changed unless one is confident about understanding why all the synchronization was there in the first place.  Having the tests pass isn\'t a high enough bar for these areas because of the difficulty in actually getting a test to expose subtle race conditions or thread safety issues.  This comes back to my original \\\"get it back in my head\\\" - I don\'t fee comfortable messing with this stuff either until I\'ve really internalized the bigger picture again... and it doesn\'t last   \\n\\n For the specific case above, one can\'t just take what was one synchronized block and break it up into two.  It certainly creates race conditions and breaks the invariants we try to keep.  The specific invariant here is that if it\'s not in the tlog maps, then it is guaranteed to be in the realtime reader.  Hopefully some of our tests would fail with this latest patch... but it\'s hard stuff to test. \\n\\n I worked up a patch that passed down the IndexWriter (it needs to be passed  all  the way down to SolrCore.openSearcher to actually avoid deadlocks).  That ended up changing more code than I\'d like... so now I\'m working up a patch to make IW locking re-entrant.  That approach should be less fragile going forward (i.e. less likely to easily introduce a deadlock through seemingly unrelated changes).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14705157\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14705157&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14705157\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14705157_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705157_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T15:50:51+0000\'\u003e20\\/Aug\\/15 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI tried applying the last patch and running TestStressReorder and luckily it does fail often for me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14705157_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705157_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 15:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T15:50:51+0000\'\u003e20\\/Aug\\/15 15:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I tried applying the last patch and running TestStressReorder and luckily it does fail often for me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14705478\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14705478&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14705478\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14705478_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705478_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 18:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T18:19:23+0000\'\u003e20\\/Aug\\/15 18:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebq: I tried applying the last patch and running TestStressReorder and luckily it does fail often for me.\u003c\\/p\u003e\\n\\n\u003cp\u003eYep, I saw that last night. I looked a bit at whether it was a test artifact and apparently it\'s not so I was going to dive into that today.\u003c\\/p\u003e\\n\\n\u003cp\u003eAnyway, since you\'re working up alternatives, I\'ll leave it to you. The current checkin (not the latest patch which I won\'t commit) at least avoids the deadlock that started me down this path in the first place. Whether it creates other issues is, of course, the $64K question. Let me know if there\'s anything I can do besides cheer you on.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14705478_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705478_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 18:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T18:19:23+0000\'\u003e20\\/Aug\\/15 18:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bq: I tried applying the last patch and running TestStressReorder and luckily it does fail often for me. \\n\\n Yep, I saw that last night. I looked a bit at whether it was a test artifact and apparently it\'s not so I was going to dive into that today. \\n\\n Anyway, since you\'re working up alternatives, I\'ll leave it to you. The current checkin (not the latest patch which I won\'t commit) at least avoids the deadlock that started me down this path in the first place. Whether it creates other issues is, of course, the $64K question. Let me know if there\'s anything I can do besides cheer you on.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14705580\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14705580&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14705580\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14705580_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705580_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T19:08:20+0000\'\u003e20\\/Aug\\/15 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 20\\/Aug\\/15 19:11\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, here\'s a patch that uses a reentrant read-write lock in DefaultSolrCoreState.\u003c\\/p\u003e\\n\\n\u003cp\u003eNotes:\u003c\\/p\u003e\\n\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\u003cli\u003eno more pauseWriter \\/ freeWriter variables\u003c\\/li\u003e\\n\\t\u003cli\u003ereadlock is for grabbing the current writer, writeLock is for ensuring there are no readers\u003c\\/li\u003e\\n\\t\u003cli\u003ethe RefCounted&lt;IndexWriter&gt; doesn\'t do much any more... decRef releases the readLock, that\'s the only important thing.  I just kept it to keep the API the same for now.\u003c\\/li\u003e\\n\\t\u003cli\u003eall of newIndexWriter, closeIndexWriter, and openIndexWriter all delegate to changeIndexWriter to remove duplicated code.  This does change the semantics of some of these methods, but I hope for the better?\\n\\t\u003cul class=\\\"alternate\\\" type=\\\"square\\\"\u003e\\n\\t\\t\u003cli\u003eThe old openIndexWriter method only synchronized on writerPauseLock, so if there were any readers and writers in the lock loop, or even readers open, this method could go in and still change the writer anyway.  Sharing the code in changeWriter now means that it would wait for any readers to finish (which looking at the comments implies there should not be anyway?  and if there were, new IW creation would fail), close any existing old writer, and then open the new one.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eI reordered some things so that if we got an exception while opening a new writer, the writer reference would already be cleared so we won\'t simply default to using the old (presumably now closed) writer, but will try to open again.  Should be more resilient in the face of a spurious exception.\u003c\\/li\u003e\\n\\t\u003cli\u003eit\'s really not clear if polling is still needed in getIndexWriter, but I kept it for now just to be safe.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003elooping some tests now...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14705580_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705580_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 19:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T19:08:20+0000\'\u003e20\\/Aug\\/15 19:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Yonik Seeley - 20\\/Aug\\/15 19:11\\\"\u003eedited\u003c\\/span\u003e                   OK, here\'s a patch that uses a reentrant read-write lock in DefaultSolrCoreState. \\n\\n Notes: \\n \\n\\t no more pauseWriter \\/ freeWriter variables \\n\\t readlock is for grabbing the current writer, writeLock is for ensuring there are no readers \\n\\t the RefCounted&lt;IndexWriter&gt; doesn\'t do much any more... decRef releases the readLock, that\'s the only important thing.  I just kept it to keep the API the same for now. \\n\\t all of newIndexWriter, closeIndexWriter, and openIndexWriter all delegate to changeIndexWriter to remove duplicated code.  This does change the semantics of some of these methods, but I hope for the better?\\n\\t \\n\\t\\t The old openIndexWriter method only synchronized on writerPauseLock, so if there were any readers and writers in the lock loop, or even readers open, this method could go in and still change the writer anyway.  Sharing the code in changeWriter now means that it would wait for any readers to finish (which looking at the comments implies there should not be anyway?  and if there were, new IW creation would fail), close any existing old writer, and then open the new one. \\n\\t \\n\\t \\n\\t I reordered some things so that if we got an exception while opening a new writer, the writer reference would already be cleared so we won\'t simply default to using the old (presumably now closed) writer, but will try to open again.  Should be more resilient in the face of a spurious exception. \\n\\t it\'s really not clear if polling is still needed in getIndexWriter, but I kept it for now just to be safe. \\n \\n\\n\\n looping some tests now...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14705653\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14705653&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14705653\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14705653_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705653_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 19:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T19:54:57+0000\'\u003e20\\/Aug\\/15 19:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ll beast the stressdeadlock and stresstestreorder for a while as well.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14705653_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705653_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 19:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T19:54:57+0000\'\u003e20\\/Aug\\/15 19:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ll beast the stressdeadlock and stresstestreorder for a while as well. \\n\\n Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14705966\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14705966&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14705966\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14705966_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705966_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 23:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T23:22:29+0000\'\u003e20\\/Aug\\/15 23:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFWIW, 96 runs each (look, 96 divides by 6 processors evenly, OK?) and both StressTestReorder and TestReloadDeadlock seem happy, along with precommit. Running full test suite now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14705966_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14705966_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/15 23:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-20T23:22:29+0000\'\u003e20\\/Aug\\/15 23:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FWIW, 96 runs each (look, 96 divides by 6 processors evenly, OK?) and both StressTestReorder and TestReloadDeadlock seem happy, along with precommit. Running full test suite now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14707634\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14707634&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14707634\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14707634_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14707634_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/15 23:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-21T23:26:47+0000\'\u003e21\\/Aug\\/15 23:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e Since you\'ve done the heavy lifting here and I\'ve beasted both the the tests, and a full test also worked, do you want me to just go ahead and check it in? Or do you want to polish it yet?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14707634_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14707634_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/15 23:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-21T23:26:47+0000\'\u003e21\\/Aug\\/15 23:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yonik Seeley  Since you\'ve done the heavy lifting here and I\'ve beasted both the the tests, and a full test also worked, do you want me to just go ahead and check it in? Or do you want to polish it yet?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14707760\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14707760&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14707760\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14707760_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14707760_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/15 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-22T01:24:47+0000\'\u003e22\\/Aug\\/15 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m running some more tests and will do a little more polishing on comments...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14707760_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14707760_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/15 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-22T01:24:47+0000\'\u003e22\\/Aug\\/15 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m running some more tests and will do a little more polishing on comments...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14712222\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14712222&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14712222\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14712222_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14712222_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Aug\\/15 00:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-26T00:10:03+0000\'\u003e26\\/Aug\\/15 00:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve been running ChaosMonkeySafeLeaderTest for about 3 days with my test script that also searches for corrupt indexes or assertion failures even when the test still passes.\u003cbr\\/\u003e\\nCurrent trunk (as of last week): 9 corrupt indexes\u003cbr\\/\u003e\\nPatched trunk: 14 corrupt indexes and 2 test failures (inconsistent shards)\u003c\\/p\u003e\\n\\n\u003cp\u003eThe corrupt indexes \u003cb\u003emay\u003c\\/b\u003e not be a problem, I don\'t really know.  We kill off servers, perhaps during replication?  Seems like that could produce corrupt indexes, but I don\'t know if that\'s the scenario or not.  Increasing the incidence of those doesn\'t necessarily point to a problem either.  But inconsistent shards vs not... does seem like a problem if it holds.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve reviewed the locking code again, and it looks solid, so I\'m not sure what\'s going on.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s a typical corrupt index trace:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e  2&gt; 21946 WARN  (RecoveryThread-collection1) [n:127.0.0.1:51815_ c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.h.IndexFetcher Could not retrie\\nve checksum from file.\\n  2&gt; org.apache.lucene.index.CorruptIndexException: codec footer mismatch (file truncated?): actual footer=1698720114 vs expected footer=-1071082520 (resource=MMapIndexInput(path=\u003cspan class=\\\"code-quote\\\"\u003e\\\"\\/opt\\/code\\/lusolr_clean2\\/solr\\/build\\/solr-core\\/test\\/J0\\/temp\\/solr.cloud.ChaosMonkeySafeLeaderTest_B7DC9C42462BF20D-001\\/shard-2-001\\/cores\\/collection1\\/data\\/index\\/_0.fdt\\\"\u003c\\/span\u003e))\\n  2&gt;    at org.apache.lucene.codecs.CodecUtil.validateFooter(CodecUtil.java:416)\\n  2&gt;    at org.apache.lucene.codecs.CodecUtil.retrieveChecksum(CodecUtil.java:401)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.compareFile(IndexFetcher.java:876)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.downloadIndexFiles(IndexFetcher.java:839)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:437)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:265)\\n  2&gt;    at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:382)\\n  2&gt;    at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:162)\\n  2&gt;    at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:437)\\n  2&gt;    at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:227)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14712222_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14712222_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Aug\\/15 00:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-26T00:10:03+0000\'\u003e26\\/Aug\\/15 00:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve been running ChaosMonkeySafeLeaderTest for about 3 days with my test script that also searches for corrupt indexes or assertion failures even when the test still passes. \\nCurrent trunk (as of last week): 9 corrupt indexes \\nPatched trunk: 14 corrupt indexes and 2 test failures (inconsistent shards) \\n\\n The corrupt indexes  may  not be a problem, I don\'t really know.  We kill off servers, perhaps during replication?  Seems like that could produce corrupt indexes, but I don\'t know if that\'s the scenario or not.  Increasing the incidence of those doesn\'t necessarily point to a problem either.  But inconsistent shards vs not... does seem like a problem if it holds. \\n\\n I\'ve reviewed the locking code again, and it looks solid, so I\'m not sure what\'s going on. \\n\\n Here\'s a typical corrupt index trace: \\n  \\n   2&gt; 21946 WARN  (RecoveryThread-collection1) [n:127.0.0.1:51815_ c:collection1 s:shard1 r:core_node2 x:collection1] o.a.s.h.IndexFetcher Could not retrie\\nve checksum from file.\\n  2&gt; org.apache.lucene.index.CorruptIndexException: codec footer mismatch (file truncated?): actual footer=1698720114 vs expected footer=-1071082520 (resource=MMapIndexInput(path= \\\"\\/opt\\/code\\/lusolr_clean2\\/solr\\/build\\/solr-core\\/test\\/J0\\/temp\\/solr.cloud.ChaosMonkeySafeLeaderTest_B7DC9C42462BF20D-001\\/shard-2-001\\/cores\\/collection1\\/data\\/index\\/_0.fdt\\\" ))\\n  2&gt;    at org.apache.lucene.codecs.CodecUtil.validateFooter(CodecUtil.java:416)\\n  2&gt;    at org.apache.lucene.codecs.CodecUtil.retrieveChecksum(CodecUtil.java:401)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.compareFile(IndexFetcher.java:876)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.downloadIndexFiles(IndexFetcher.java:839)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:437)\\n  2&gt;    at org.apache.solr.handler.IndexFetcher.fetchLatestIndex(IndexFetcher.java:265)\\n  2&gt;    at org.apache.solr.handler.ReplicationHandler.doFetch(ReplicationHandler.java:382)\\n  2&gt;    at org.apache.solr.cloud.RecoveryStrategy.replicate(RecoveryStrategy.java:162)\\n  2&gt;    at org.apache.solr.cloud.RecoveryStrategy.doRecovery(RecoveryStrategy.java:437)\\n  2&gt;    at org.apache.solr.cloud.RecoveryStrategy.run(RecoveryStrategy.java:227)\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14716703\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14716703&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14716703\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14716703_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14716703_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Aug\\/15 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-27T13:56:33+0000\'\u003e27\\/Aug\\/15 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m trying some different variants of my patch, trying to pin down exactly what change in semantics are causing the fails.  It takes some time though... I normally need to let it loop for a day to get failures.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14716703_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14716703_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Aug\\/15 13:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-08-27T13:56:33+0000\'\u003e27\\/Aug\\/15 13:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m trying some different variants of my patch, trying to pin down exactly what change in semantics are causing the fails.  It takes some time though... I normally need to let it loop for a day to get failures.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14725676\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14725676&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14725676\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14725676_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14725676_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/15 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-01T16:51:49+0000\'\u003e01\\/Sep\\/15 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eOK, I found the issue.\u003cbr\\/\u003e\\nWhen I re-wrote the SolrCoreState locking to use reentrant read-write locks, I was using the current trunk as a reference.  Unfortunately, a previous commit in this issue had introduced a bug by changing the semantics.  I didn\'t realize it until I went back to look at trunk before any commits on this issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe bug was the addition of this to closeIndexWriter:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e     } \u003cspan class=\\\"code-keyword\\\"\u003efinally\u003c\\/span\u003e {\\n        pauseWriter = \u003cspan class=\\\"code-keyword\\\"\u003efalse\u003c\\/span\u003e;\\n        writerPauseLock.notifyAll();\\n      }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003ecloseIndexWriter \\/ newIndexWriter are meant to be used as a pair, and block any readers inbetween them being called.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve been looping ChaosMonkeySafeLeaderTest since yesterday afternoon and no fails yet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14725676_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14725676_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/15 16:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-01T16:51:49+0000\'\u003e01\\/Sep\\/15 16:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    OK, I found the issue. \\nWhen I re-wrote the SolrCoreState locking to use reentrant read-write locks, I was using the current trunk as a reference.  Unfortunately, a previous commit in this issue had introduced a bug by changing the semantics.  I didn\'t realize it until I went back to look at trunk before any commits on this issue. \\n\\n The bug was the addition of this to closeIndexWriter: \\n  \\n      }  finally  {\\n        pauseWriter =  false ;\\n        writerPauseLock.notifyAll();\\n      }\\n \\n  \\n\\n closeIndexWriter \\/ newIndexWriter are meant to be used as a pair, and block any readers inbetween them being called. \\n\\n I\'ve been looping ChaosMonkeySafeLeaderTest since yesterday afternoon and no fails yet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14726204\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14726204&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14726204\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14726204_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14726204_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/15 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-01T21:17:43+0000\'\u003e01\\/Sep\\/15 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThe bug was the addition of this to closeIndexWriter:\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eOuch, lucky to notice that. Shows how careful we have to be when touching update side synchronization. Quick commits can quickly get lost and introduce hard to track down bugs.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_14726204_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14726204_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Sep\\/15 21:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-01T21:17:43+0000\'\u003e01\\/Sep\\/15 21:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     The bug was the addition of this to closeIndexWriter:  \\n\\n Ouch, lucky to notice that. Shows how careful we have to be when touching update side synchronization. Quick commits can quickly get lost and introduce hard to track down bugs.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14726738\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14726738&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14726738\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14726738_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14726738_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Sep\\/15 04:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-02T04:46:58+0000\'\u003e02\\/Sep\\/15 04:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmmm, looks like I screwed the pooch on that one. Siiiggggghhhhh.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14726738_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14726738_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Sep\\/15 04:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-02T04:46:58+0000\'\u003e02\\/Sep\\/15 04:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmmm, looks like I screwed the pooch on that one. Siiiggggghhhhh.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14727456\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14727456&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14727456\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14727456_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14727456_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Sep\\/15 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-02T14:54:04+0000\'\u003e02\\/Sep\\/15 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWorth merging into 5.3 in case a 5.3.1 gets cut?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14727456_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14727456_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Sep\\/15 14:54\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-02T14:54:04+0000\'\u003e02\\/Sep\\/15 14:54\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Worth merging into 5.3 in case a 5.3.1 gets cut?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14729210\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14729210&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14729210\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14729210_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14729210_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/15 15:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-03T15:07:25+0000\'\u003e03\\/Sep\\/15 15:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1701043 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yonik%40apache.org\\\" class=\\\"user-hover\\\" rel=\\\"yonik@apache.org\\\"\u003eYonik Seeley\u003c\\/a\u003e in branch \'dev\\/trunk\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1701043\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1701043\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e: change SolrCoreState to use a reentrant locking implementation to fix deadlocks\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14729210_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14729210_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/15 15:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-03T15:07:25+0000\'\u003e03\\/Sep\\/15 15:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1701043 from  Yonik Seeley  in branch \'dev\\/trunk\' \\n[  https:\\/\\/svn.apache.org\\/r1701043  ] \\n\\n   SOLR-7836  : change SolrCoreState to use a reentrant locking implementation to fix deadlocks              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14729212\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14729212&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14729212\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14729212_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14729212_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/15 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-03T15:08:48+0000\'\u003e03\\/Sep\\/15 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCommit 1701044 from \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yonik%40apache.org\\\" class=\\\"user-hover\\\" rel=\\\"yonik@apache.org\\\"\u003eYonik Seeley\u003c\\/a\u003e in branch \'dev\\/branches\\/branch_5x\'\u003cbr\\/\u003e\\n[ \u003ca href=\\\"https:\\/\\/svn.apache.org\\/r1701044\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttps:\\/\\/svn.apache.org\\/r1701044\u003c\\/a\u003e ]\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-7836\\\" title=\\\"Possible deadlock when closing refcounted index writers.\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-7836\\\"\u003e\u003cdel\u003eSOLR-7836\u003c\\/del\u003e\u003c\\/a\u003e: change SolrCoreState to use a reentrant locking implementation to fix deadlocks\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jira-bot\\\" id=\\\"commentauthor_14729212_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jira-bot\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jira-bot\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e ASF subversion and git services\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14729212_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/15 15:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-03T15:08:48+0000\'\u003e03\\/Sep\\/15 15:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Commit 1701044 from  Yonik Seeley  in branch \'dev\\/branches\\/branch_5x\' \\n[  https:\\/\\/svn.apache.org\\/r1701044  ] \\n\\n   SOLR-7836  : change SolrCoreState to use a reentrant locking implementation to fix deadlocks              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14729227\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14729227&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14729227\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14729227_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14729227_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/15 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-03T15:16:37+0000\'\u003e03\\/Sep\\/15 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNot sure if there will even be a 5.3.1 release.\u003cbr\\/\u003e\\nIf there is, perhaps everything that was committed as part of this issue should go back?  Would be nice to let it bake a while longer in 5x\\/trunk just to make sure that nothing else is broken.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_14729227_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14729227_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Sep\\/15 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-03T15:16:37+0000\'\u003e03\\/Sep\\/15 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Not sure if there will even be a 5.3.1 release. \\nIf there is, perhaps everything that was committed as part of this issue should go back?  Would be nice to let it bake a while longer in 5x\\/trunk just to make sure that nothing else is broken.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14730965\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-7836?focusedCommentId=14730965&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14730965\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14730965_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14730965_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/15 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-04T15:34:43+0000\'\u003e04\\/Sep\\/15 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"yseeley@gmail.com\\\"\u003eYonik Seeley\u003c\\/a\u003e] re: back-porting to 5.3.1. Never mind...\u003c\\/p\u003e\\n\\n\u003cp\u003eI just checked to be sure. Noble cut the 5.3 branch 3 days \u003cem\u003ebefore\u003c\\/em\u003e my first checkin for this ticket. If the problems you found with that check in were in the release a back-port was in order. But  since they\'re not, I see no need.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"erickerickson\\\" id=\\\"commentauthor_14730965_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=erickerickson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"erickerickson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erick Erickson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14730965_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Sep\\/15 15:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2015-09-04T15:34:43+0000\'\u003e04\\/Sep\\/15 15:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Yonik Seeley ] re: back-porting to 5.3.1. Never mind... \\n\\n I just checked to be sure. Noble cut the 5.3 branch 3 days  before  my first checkin for this ticket. If the problems you found with that check in were in the release a back-port was in order. But  since they\'re not, I see no need.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["scope-filter-data"]="{\"createScopeActions\":[],\"scopes\":[]}";
WRM._unparsedData["sidebar-collapsed-by-default"]="true";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:can-manage"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:with-icons"]="false";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:shortcuts"]="[]";
WRM._unparsedData["com.atlassian.jira.projects.shortcuts:project-id"]="12310230";
WRM._unparsedData["sidebar-id"]="\"\u003cdiv class=\\\"aui-sidebar  projects-sidebar sidebar-pending\\\" \u003e\u003cdiv class=\\\"aui-sidebar-wrapper\\\"\u003e\u003cdiv class=\\\"aui-sidebar-body\\\"\u003e\u003cheader class=\\\"aui-page-header\\\"\u003e\u003cdiv class=\\\"aui-page-header-inner\\\"\u003e\u003cdiv class=\\\"aui-page-header-image\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\" class=\\\"jira-project-avatar\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-large aui-avatar-project\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"\\/jira\\/secure\\/projectavatar?pid=12310230&amp;avatarId=22151\\\" alt=\\\"Solr\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e\u003cimg src=\\\"data:image\\/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iaXNvLTg4NTktMSI\\/Pg0KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE4LjEuMSwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPg0KPHN2ZyB2ZXJzaW9uPSIxLjEiIGlkPSJMYXllcl8xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4PSIwcHgiIHk9IjBweCINCgkgdmlld0JveD0iMCAwIDMwMCAzMDAiIHN0eWxlPSJlbmFibGUtYmFja2dyb3VuZDpuZXcgMCAwIDMwMCAzMDA7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJMYXllcl8yIj4NCgk8cGF0aCBzdHlsZT0iZmlsbDojRjc5MjMyOyIgZD0iTTE1MCwwQzY2LjY2NywwLDAsNjYuNjY3LDAsMTUwczY2LjY2NywxNTAsMTUwLDE1MHMxNTAtNjYuNjY3LDE1MC0xNTBTMjMzLjMzMywwLDE1MCwweg0KCQkgTTEzNi42NjcsMTc4LjMzM0wxMjUsMTkwbC00MS42NjctNDBMOTUsMTM4LjMzM2wzMC0zMEwxMzYuNjY3LDEyMGwtMzAsMzBMMTM2LjY2NywxNzguMzMzeiBNMjA1LDE2MS42NjdsLTMwLDMwTDE2My4zMzMsMTgwDQoJCWwzMC0zMGwtMzAtMzBMMTc1LDEwOC4zMzNMMjE2LjY2NywxNTBMMjA1LDE2MS42Njd6Ii8+DQo8L2c+DQo8Zz4NCgk8cG9seWdvbiBzdHlsZT0iZmlsbDojRkZGRkZGOyIgcG9pbnRzPSIxNzUsMTkxLjY2NyAyMDUsMTYxLjY2NyAyMTYuNjY3LDE1MCAxNzUsMTA4LjMzMyAxNjMuMzMzLDEyMCAxOTMuMzMzLDE1MCAxNjMuMzMzLDE4MCAJIi8+DQoJPHBvbHlnb24gc3R5bGU9ImZpbGw6I0ZGRkZGRjsiIHBvaW50cz0iMTI1LDEwOC4zMzMgOTUsMTM4LjMzMyA4My4zMzMsMTUwIDEyNSwxOTAgMTM2LjY2NywxNzguMzMzIDEwNi42NjcsMTUwIDEzNi42NjcsMTIwIAkiLz4NCjwvZz4NCjwvc3ZnPg0K\\\" alt=\\\"Icon indicating the project type\\\" class=\\\"jira-project-avatar-icon\\\" \\/\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-image --\u003e\u003cdiv class=\\\"aui-page-header-main\\\"\u003e\u003ch1\u003e\u003cdiv class=\\\"aui-group aui-group-split\\\"\u003e\u003cdiv class=\\\"aui-item project-title\\\"\u003e\u003ca href=\\\"\\/jira\\/projects\\/SOLR\\/summary\\\" title=\\\"Solr\\\"\u003eSolr\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/h1\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-main --\u003e\u003c\\/div\u003e\u003c!-- .aui-page-header-inner --\u003e\u003c\\/header\u003e\u003c!-- .aui-page-header --\u003e\u003cnav class=\\\"aui-navgroup aui-navgroup-vertical\\\"\u003e\u003cdiv class=\\\"aui-navgroup-inner sidebar-content-container\\\"\u003e\u003cdiv class=\\\"aui-sidebar-group aui-sidebar-group-tier-one\\\" data-id=\\\"sidebar-navigation-panel\\\"\u003e\u003cul class=\\\"aui-nav\\\"\u003e\u003cli class=\\\"aui-nav-selected\\\" \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR\\/issues\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-issue-navigator:sidebar-issue-navigator\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-issues\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Issues\\\"\u003eIssues\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:report-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:report-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large agile-icon-report\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Reports\\\"\u003eReports\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003cli  \u003e\u003ca class=\\\"aui-nav-item \\\" href=\\\"\\/jira\\/projects\\/SOLR?selectedItem=com.atlassian.jira.jira-projects-plugin:components-page\\\" data-link-id=\\\"com.atlassian.jira.jira-projects-plugin:components-page\\\" \u003e\u003cspan class=\\\"aui-icon aui-icon-large icon-sidebar-components\\\"\u003e\u003c\\/span\u003e\u003cspan class=\\\"aui-nav-item-label\\\" title=\\\"Components\\\"\u003eComponents\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/li\u003e\u003c\\/ul\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/nav\u003e\u003c\\/div\u003e\u003cdiv class=\\\"aui-sidebar-footer\\\"\u003e\u003ca class=\\\"aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy\\\" data-tooltip=\\\"Expand sidebar ( [ )\\\" href=\\\"#\\\"\u003e\u003cspan class=\\\"aui-icon aui-icon-small\\\"\u003e\u003c\\/span\u003e\u003c\\/a\u003e\u003c\\/div\u003e\u003c\\/div\u003e\u003c\\/div\u003e\"";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/3pgavk/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-init/jira.webresources:bigpipe-init.js" data-wrm-key="jira.webresources:bigpipe-init" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <form id="jira_request_timing_info" class="dont-default-focus"> 
   <fieldset class="parameters hidden"> 
    <input type="hidden" title="jira.request.start.millis" value="1520341586264"> 
    <input type="hidden" title="jira.request.server.time" value="280"> 
    <input type="hidden" title="jira.request.id" value="786x97485352x3"> 
    <input type="hidden" title="jira.session.expiry.time" value="-"> 
    <input type="hidden" title="jira.session.expiry.in.mins" value="-"> 
    <input id="jiraConcurrentRequests" type="hidden" name="jira.request.concurrent.requests" value="3"> 
    <input type="hidden" title="db.reads.time.in.ms" value="28"> 
    <input type="hidden" title="db.conns.time.in.ms" value="35"> 
   </fieldset> 
  </form> 
  <!--
	                 REQUEST ID : 786x97485352x3
	          REQUEST TIMESTAMP : [06/Mar/2018:13:06:26 +0000]
	               REQUEST TIME : 0.2800
	                 ASESSIONID : -
	        CONCURRENT REQUESTS : 3

	                      db.reads : OpSnapshot{name='db.reads', invocationCount=16, elapsedTotal=28467931, elapsedMin=525904, elapsedMax=16026429, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
	                      db.conns : OpSnapshot{name='db.conns', invocationCount=20, elapsedTotal=35357020, elapsedMin=515698, elapsedMax=16059173, resultSetSize=0, cpuTotal=0, cpuMin=0, cpuMax=0}
-->   
 </body>
</html>