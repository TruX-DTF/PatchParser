<!doctype html>
<html lang="en">
 <head> 
  <meta charset="utf-8"> 
  <meta http-equiv="X-UA-Compatible" content="IE=Edge"> 
  <meta name="application-name" content="JIRA" data-name="jira" data-version="7.6.3">
  <meta name="ajs-viewissue-use-history-api" content="false"> 
  <meta name="ajs-jira-base-url" content="https://issues.apache.org/jira"> 
  <meta name="ajs-serverRenderedViewIssue" content="true"> 
  <meta name="ajs-dev-mode" content="false"> 
  <meta name="ajs-context-path" content="/jira"> 
  <meta name="ajs-version-number" content="7.6.3"> 
  <meta name="ajs-build-number" content="76005"> 
  <meta name="ajs-is-beta" content="false"> 
  <meta name="ajs-is-rc" content="false"> 
  <meta name="ajs-is-snapshot" content="false"> 
  <meta name="ajs-is-milestone" content="false"> 
  <meta name="ajs-remote-user" content=""> 
  <meta name="ajs-remote-user-fullname" content=""> 
  <meta name="ajs-user-locale" content="en_UK"> 
  <meta name="ajs-user-locale-group-separator" content=","> 
  <meta name="ajs-app-title" content="ASF JIRA"> 
  <meta name="ajs-keyboard-shortcuts-enabled" content="true"> 
  <meta name="ajs-keyboard-accesskey-modifier" content="Ctrl+Alt"> 
  <meta name="ajs-enabled-dark-features" content="[&quot;com.atlassian.jira.agile.darkfeature.editable.detailsview&quot;,&quot;nps.survey.inline.dialog&quot;,&quot;com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled&quot;,&quot;jira.plugin.devstatus.phasetwo&quot;,&quot;jira.frother.reporter.field&quot;,&quot;atlassian.rest.xsrf.legacy.enabled&quot;,&quot;jira.issue.status.lozenge&quot;,&quot;com.atlassian.jira.config.BIG_PIPE&quot;,&quot;com.atlassian.jira.projects.issuenavigator&quot;,&quot;com.atlassian.jira.config.PDL&quot;,&quot;jira.plugin.devstatus.phasetwo.enabled&quot;,&quot;atlassian.aui.raphael.disabled&quot;,&quot;app-switcher.new&quot;,&quot;frother.assignee.field&quot;,&quot;com.atlassian.jira.projects.ProjectCentricNavigation.Switch&quot;,&quot;sd.internal.base.off.thread.on.completion.events.enabled&quot;,&quot;jira.onboarding.cyoa&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.enabled&quot;,&quot;sd.slavalue.record.updated.date.enabled&quot;,&quot;com.atlassian.jira.config.ProjectConfig.MENU&quot;,&quot;com.atlassian.jira.projects.sidebar.DEFER_RESOURCES&quot;,&quot;com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled&quot;,&quot;com.atlassian.jira.agile.darkfeature.sprint.goal.enabled&quot;,&quot;jira.zdu.admin-updates-ui&quot;,&quot;jira.zdu.jmx-monitoring&quot;,&quot;sd.sla.improved.rendering.enabled&quot;,&quot;sd.canned.responses.enabled&quot;,&quot;sd.new.settings.sidebar.location.disabled&quot;,&quot;jira.zdu.cluster-upgrade-state&quot;,&quot;com.atlassian.jira.agile.darkfeature.splitissue&quot;,&quot;com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED&quot;,&quot;com.atlassian.feedback.feedback-button-move-to-header-enable&quot;,&quot;jira.export.csv.enabled&quot;]"> 
  <meta name="ajs-in-admin-mode" content="false"> 
  <meta name="ajs-is-sysadmin" content="false"> 
  <meta name="ajs-is-admin" content="false"> 
  <meta name="ajs-outgoing-mail-enabled" content="true"> 
  <meta name="ajs-date-relativize" content="true"> 
  <meta name="ajs-date-time" content="HH:mm"> 
  <meta name="ajs-date-day" content="EEEE HH:mm"> 
  <meta name="ajs-date-dmy" content="dd/MMM/yy"> 
  <meta name="ajs-date-complete" content="dd/MMM/yy HH:mm"> 
  <script type="text/javascript">var AJS=AJS||{};AJS.debug=true;</script> 
  <meta id="atlassian-token" name="atlassian-token" content="A5KQ-2QAV-T4JA-FDED|0e7f2a14b845e28c136cc99db724c0f618d454e1|lout"> 
  <link rel="shortcut icon" href="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/favicon.ico"> 
  <!--[if IE]><![endif]--> 
  <script type="text/javascript">
    (function() {
        var contextPath = '/jira';
        var eventBuffer = [];

        function printDeprecatedMsg() {
            if (console && console.warn) {
                console.warn('DEPRECATED JS - contextPath global variable has been deprecated since 7.4.0. Use `wrm/context-path` module instead.');
            }
        }

        function sendEvent(analytics, postfix) {
            analytics.send({
                name: 'js.globals.contextPath.' + postfix
            });
        }

        function sendDeprecatedEvent(postfix) {
            try {
                var analytics = require('jira/analytics');
                if (eventBuffer.length) {
                    eventBuffer.forEach(function(value) {
                        sendEvent(analytics, value);
                    });
                    eventBuffer = [];
                }

                if (postfix) {
                    sendEvent(analytics, postfix);
                }
            } catch(ex) {
                eventBuffer.push(postfix);
                setTimeout(sendDeprecatedEvent, 1000);
            }
        }

        Object.defineProperty(window, 'contextPath', {
            get: function() {
                printDeprecatedMsg();
                sendDeprecatedEvent('get');
                return contextPath;
            },
            set: function(value) {
                printDeprecatedMsg();
                sendDeprecatedEvent('set');
                contextPath = value;
            }
        });
    })();

</script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.plugins.atlassian-plugins-webresource-plugin:context-path.context-path"]="\"/jira\"";
WRM._unparsedData["jira.webresources:feature-flags.feature-flag-data"]="{\"enabled-feature-keys\":[\"com.atlassian.jira.agile.darkfeature.editable.detailsview\",\"nps.survey.inline.dialog\",\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint.enabled\",\"jira.plugin.devstatus.phasetwo\",\"jira.frother.reporter.field\",\"atlassian.rest.xsrf.legacy.enabled\",\"jira.issue.status.lozenge\",\"com.atlassian.jira.config.BIG_PIPE\",\"com.atlassian.jira.projects.issuenavigator\",\"com.atlassian.jira.config.PDL\",\"jira.plugin.devstatus.phasetwo.enabled\",\"atlassian.aui.raphael.disabled\",\"app-switcher.new\",\"frother.assignee.field\",\"com.atlassian.jira.projects.ProjectCentricNavigation.Switch\",\"sd.internal.base.off.thread.on.completion.events.enabled\",\"jira.onboarding.cyoa\",\"com.atlassian.jira.agile.darkfeature.kanplan.enabled\",\"sd.slavalue.record.updated.date.enabled\",\"com.atlassian.jira.config.ProjectConfig.MENU\",\"com.atlassian.jira.projects.sidebar.DEFER_RESOURCES\",\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions.enabled\",\"com.atlassian.jira.agile.darkfeature.sprint.goal.enabled\",\"jira.zdu.admin-updates-ui\",\"jira.zdu.jmx-monitoring\",\"sd.sla.improved.rendering.enabled\",\"sd.canned.responses.enabled\",\"sd.new.settings.sidebar.location.disabled\",\"jira.zdu.cluster-upgrade-state\",\"com.atlassian.jira.agile.darkfeature.splitissue\",\"com.atlassian.jira.config.CoreFeatures.LICENSE_ROLES_ENABLED\",\"com.atlassian.feedback.feedback-button-move-to-header-enable\",\"jira.export.csv.enabled\"],\"feature-flag-states\":{\"sd.customer.profile.multi.languages\":true,\"sd.customer.portal.transitions\":true,\"sd.customer.portal.transitions.config\":true,\"sd.custom.email.stripping.rules\":false,\"sd.sla.lucene.issue.id.callback.performance\":true,\"sd.new.settings.sidebar.location\":true,\"sd.workload.report.paginator\":true,\"sd.experimental.portal.search.algorithm.default.1\":false,\"sd.customer.portal.help.center.agent.announcement\":true,\"sd.sla.improved.rendering\":false,\"sd.experimental.portal.search.algorithm.default.2\":false,\"sd.customer.feedback.validate.reporter.on.token\":true,\"sd.custom.email.notifications.utf8.csat.star\":true,\"sd.who.create.customers.by.email.setting\":true,\"com.atlassian.jira.issuetable.move.links.hidden\":true,\"jira.renderer.consider.variable.format\":true,\"sd.stats.event.tracking\":true,\"sd.password.helper.dialog\":true,\"sd.canned.responses\":false,\"sd.portal.help.center.customer.signup.secondary.email\":true,\"sd.custom.email.notifications.manage.language\":true,\"sd.use.search.by.permissions\":true,\"sd.slavalue.record.updated.date\":false,\"sd.report.custom.date.range\":false,\"sd.kb.article.helpfulness.report\":false,\"com.atlassian.jira.agile.darkfeature.sprint.goal\":false,\"sd.custom.email.notifications.styling\":true,\"sd.workinghours.new.page.bulldog.1\":false,\"sd.customer.portal.two.step.login\":false,\"sd.automation.psmq.async.executor\":true,\"sd.customer.org.list.page.lazy.search\":true,\"sd.approval.requested.when.handler\":true,\"sd.request.type.field.rest.api.filtering.bugfix\":true,\"sd.automation.then.action.auto.answer.approval\":true,\"com.atlassian.jira.agile.darkfeature.kanplan.epics.and.versions\":false,\"sla.will.only.be.paused.if.they.are.already.started\":true,\"sd.kb.comment.share.stats.collection\":true,\"com.atlassian.jira.upgrade.startup.fix.index\":true,\"sd.customer.orgs.group.participants\":true,\"sd.portal.help.center.customer.signup\":true,\"sd.sla.agent.jql.security.restricted\":true,\"sd.test.feature.flag.x\":true,\"sd.test.feature.flag.y\":false,\"sd.cluster.safe.mail.channel.shutdown\":true,\"sd.email.channel.folders\":false,\"sd.email.analytics.open\":false,\"sd.kb.project.creation.create.link.space\":true,\"sd.workinghours.new.page\":false,\"sd.confluence.anonymous.permission.fix\":true,\"com.atlassian.jira.issuetable.draggable\":true,\"sd.customer.portal.project.agent.announcement\":true,\"sd.automation.audit.log\":true,\"jira.jql.suggestrecentfields\":false,\"sd.canned.responses.check.index.startup\":false,\"sd.new.project.templates\":true,\"sd.custom.email.notifications.custom.rules.simple.ui\":false,\"sd.custom.email.notifications.cut.over\":true,\"sd.dismiss.all.misconfiguration.warnings.setting\":true,\"com.atlassian.jira.agile.darkfeature.optimistic.transitions\":true,\"sd.sla.configurations.export\":true,\"sd.canned.responses.variable.substitution\":true,\"com.atlassian.jira.agile.darkfeature.kanplan\":false,\"sd.internal.base.off.thread.on.completion.events\":false,\"sd.customer.portal.prioties.per.project.fix\":true,\"jira.instrumentation.laas\":false,\"sd.kb.self.service.report\":false,\"sla.improved.request.handling\":true,\"sd.no.schedule.async.upgrade.tasks\":true,\"sd.kb.primary.nav\":true,\"com.atlassian.jira.agile.darkfeature.edit.closed.sprint\":false,\"sd.kb.issueview.panel.phase2\":true,\"sd.email.outsider.comments\":true,\"jira.create.linked.issue\":true,\"sd.kb.issueview.panel\":true,\"jira.sal.host.connect.accessor.existing.transaction.will.create.transactions\":true,\"sd.approvals.light.weight\":false,\"sd.automation.then.webhook\":true,\"sd.respect.inline.edit.issue.off\":true,\"jira.jql.smartautoselectfirst\":false,\"sd.global.portal.search.atlassian.only.tracking\":false,\"sd.automation.if.condition.comment.primary.action\":true,\"jira.priorities.per.project\":true,\"sd.inline.noformat.renderer\":true,\"sd.customer.request.type.create.edit.screens\":true}}";
WRM._unparsedData["jira.webresources:default-comment-security-level.DefaultCommentSecurityLevelHelpLink"]="{\"extraClasses\":\"default-comment-level-help\",\"title\":\"Commenting on an Issue\",\"url\":\"https://docs.atlassian.com/jira/jcore-docs-076/Editing+and+collaborating+on+issues#Editingandcollaboratingonissues-restrictacomment\",\"isLocal\":false}";
WRM._unparsedData["jira.webresources:dateFormatProvider.allFormats"]="{\"dateFormats\":{\"meridiem\":[\"AM\",\"PM\"],\"eras\":[\"BC\",\"AD\"],\"months\":[\"January\",\"February\",\"March\",\"April\",\"May\",\"June\",\"July\",\"August\",\"September\",\"October\",\"November\",\"December\"],\"monthsShort\":[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],\"weekdaysShort\":[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],\"weekdays\":[\"Sunday\",\"Monday\",\"Tuesday\",\"Wednesday\",\"Thursday\",\"Friday\",\"Saturday\"]},\"lookAndFeelFormats\":{\"relativize\":\"true\",\"time\":\"HH:mm\",\"day\":\"EEEE HH:mm\",\"dmy\":\"dd/MMM/yy\",\"complete\":\"dd/MMM/yy HH:mm\"}}";
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:issueviewer.features"]="{\"rteEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.thumbnail-mime-types"]="\"image/png,image/vnd.wap.wbmp,image/x-png,image/jpeg,image/bmp,image/gif\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-dnd-attachment-plugin:dnd-issue-drop-zone.upload-limit"]="\"62914560\"";
WRM._unparsedData["com.atlassian.plugins.helptips.jira-help-tips:help-tip-manager.JiraHelpTipData"]="{\"anonymous\":true}";
WRM._unparsedData["com.atlassian.jira.jira-view-issue-plugin:controller-subtasks.controller.subtasks.parameters"]="{\"url\":\"/rest/api/2/issue/{issueId}/subtask/move\"}";
WRM._unparsedData["com.atlassian.analytics.analytics-client:policy-update-init.policy-update-data-provider"]="false";
WRM._unparsedData["com.atlassian.analytics.analytics-client:programmatic-analytics-init.programmatic-analytics-data-provider"]="false";
WRM._unparsedData["com.atlassian.servicedesk.servicedesk-canned-responses-plugin:canned-responses-data-provider.data"]="{\"substitutionVariables\":{\"issue.summary\":\"Issue summary\",\"issue.description\":\"Issue description\",\"issue.key\":\"Issue key\",\"issue.reporter.name\":\"Issue reporter\",\"issue.resolution\":\"Issue resolution\",\"request.url\":\"Request URL\",\"request.status\":\"Request status\"}}";
WRM._unparsedData["jira.webresources:avatar-picker.data"]="{}";
WRM._unparsedData["com.atlassian.feedback.jira-feedback-plugin:button-resources-init.data"]="{\"jira.feedback.plugin.issue.collector.core\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.default\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"jira.feedback.plugin.issue.collector.service.desk\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector.js?locale=en-UK&collectorId=a698db21\",\"jira.feedback.plugin.issue.collector.software\":\"https://jira.atlassian.com/s/576e9ab86257d4f65f6ea5b6dd50de44-T/en_UK3ljiw5/71006/b6b48b2829824b869586ac216d119363/2.0.11/_/download/batch/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs/com.atlassian.jira.collector.plugin.jira-issue-collector-plugin:issuecollector-embededjs.js?locale=en-UK&collectorId=abbf546d\",\"isHeaderFeedbackButtonEnabled\":true}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:dismissedFlags.flags"]="{\"dismissed\":[]}";
WRM._unparsedData["com.atlassian.jira.jira-header-plugin:newsletter-signup-tip-init.newsletterSignup"]="{\"signupDescription\":\"Get updates, inspiration and best practices from the team behind JIRA.\",\"formUrl\":\"https://www.atlassian.com/apis/exact-target/{0}/subscribe?mailingListId=1401671\",\"signupTitle\":\"Sign up!\",\"signupId\":\"newsletter-signup-tip\",\"showNewsletterTip\":false}";
WRM._unparsedData["com.atlassian.jira.project-templates-plugin:project-templates-plugin-resources.ptAnalyticsData"]="{\"instanceCreatedDate\":\"2011-01-31\"}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-help-links.help-links"]="{\"help\":{\"email.settings\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"managing.queues\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+queues+for+your+team\",\"email.setup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email\",\"request.settings.help.bubble\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\",\"email.settings.suitablerequest\":\"https://docs.atlassian.com/jira/jsd-docs-039/Receiving+requests+by+email#Receivingrequestsbyemail-suitablerequest\",\"sla.import.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Importing+SLAs\",\"documentation.home\":\"https://docs.atlassian.com/jira/jsd-docs-039/JIRA+Service+Desk+Documentation\",\"default\":\"https://docs.atlassian.com/jira/jsd-docs-039/\",\"create.space.help\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base#serving-customers-with-a-knowledge-base-createpermission\",\"email.settings.troubleshooting\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+the+email+channel\",\"admin.notifications.config\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+service+desk+notifications\",\"troubleshoot.requesttype\":\"https://docs.atlassian.com/jira/jsd-docs-039/Troubleshooting+issues+with+request+types\",\"approvals.configuration\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+JIRA+Service+Desk+approvals\",\"setting.up.reports\":\"https://docs.atlassian.com/jira/jsd-docs-039/Setting+up+service+desk+reports\",\"public.signup\":\"https://docs.atlassian.com/jira/jsd-docs-039/Configuring+public+signup\",\"knowledge.base\":\"https://docs.atlassian.com/jira/jsd-docs-039/Serving+customers+with+a+knowledge+base\",\"resolve.permission.scheme.errors\":\"https://docs.atlassian.com/jira/jsd-docs-039/Resolving+permission+scheme+errors\",\"getting.started\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+with+JIRA+Service+Desk\",\"getting.started.agent\":\"https://docs.atlassian.com/jira/jsd-docs-039/Getting+started+for+service+desk+agents\",\"invite.customers\":\"https://docs.atlassian.com/jira/jsd-docs-039/Managing+access+to+your+service+desk\"},\"kb\":{\"default\":\"https://confluence.atlassian.com/display/SDKB/\",\"troubleshooting.user.management.issues\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\",\"legacytransition\":\"https://confluence.atlassian.com/display/SDKB/Replacing+legacy+automatic+transitions+with+automation+rules\",\"umtroubleshoot\":\"https://confluence.atlassian.com/display/SDKB/Troubleshooting+issues+with+service+desk+user+management\"}}";
WRM._unparsedData["com.atlassian.servicedesk.core-ui:util-base-url.base-url"]="\"https://issues.apache.org/jira\"";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.help-data"]="{\"showHelp\":true,\"editorDocumentationUrl\":[\"https://docs.atlassian.com/jira/jcore-docs-076/Visual+editing\"],\"editorDocumentationTitle\":[\"Show me documentation for the visual editor\"]}";
WRM._unparsedData["com.atlassian.jira.plugins.jira-wiki-editor:wiki-editor-resources.thumbnails-allowed"]="false";
WRM._unparsedData["jira.webresources:user-message-flags.adminLockout"]="{}";
WRM._unparsedData["jira.request.correlation-id"]="\"b8aec908417cde\"";
WRM._unparsedData["project-id"]="12310230";
WRM._unparsedData["project-key"]="\"SOLR\"";
WRM._unparsedData["project-name"]="\"Solr\"";
WRM._unparsedData["project-type"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:generic-filters"]="[{\"id\":\"allissues\",\"jql\":\"project = \\\"{0}\\\" ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"All issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[]},{\"id\":\"allopenissues\",\"jql\":\"project = \\\"{0}\\\" AND resolution = Unresolved ORDER BY {1}\",\"defaultOrderby\":\"priority DESC, updated DESC\",\"label\":\"Open issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"resolution\"]},{\"id\":\"doneissues\",\"jql\":\"project = \\\"{0}\\\" AND statusCategory = Done ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Done issues\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"status\"]},{\"id\":\"recentlyviewed\",\"jql\":\"project = \\\"{0}\\\" AND issuekey in issueHistory() ORDER BY {1}\",\"defaultOrderby\":\"lastViewed DESC\",\"label\":\"Viewed recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"issuekey\"]},{\"id\":\"addedrecently\",\"jql\":\"project = \\\"{0}\\\" AND created \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"created DESC\",\"label\":\"Created recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"created\"]},{\"id\":\"resolvedrecently\",\"jql\":\"project = \\\"{0}\\\" AND resolutiondate \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Resolved recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":false,\"fields\":[\"resolutiondate\"]},{\"id\":\"updatedrecently\",\"jql\":\"project = \\\"{0}\\\" AND updated \u003e= -1w ORDER BY {1}\",\"defaultOrderby\":\"updated DESC\",\"label\":\"Updated recently\",\"requiresUser\":false,\"supportsInlineIssueCreate\":true,\"fields\":[\"updated\"]}]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:default-filter-priority"]="[\"allopenissues\",\"allissues\"]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-manage-filters"]="false";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:project-filters"]="[]";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:can-create-issues"]="false";
WRM._unparsedData["projectId"]="12310230";
WRM._unparsedData["projectKey"]="\"SOLR\"";
WRM._unparsedData["projectType"]="\"software\"";
WRM._unparsedData["com.atlassian.jira.jira-projects-issue-navigator:server-rendered"]="true";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/a8a4711bc3f2eb261d8c8fd9fbcbba8b-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/css/_super/batch.css" data-wrm-key="_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/1a6b21131945f6f49ff48336b49ca3fe-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/css/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.css?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" media="all"> 
  <link type="text/css" rel="stylesheet" href="/jira/s/611672383f6cab00ab202241ba6f9d68-T/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources-init/com.atlassian.feedback.jira-feedback-plugin:button-resources-init.css" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources-init" data-wrm-batch-type="resource" media="all"> 
  <script type="text/javascript" src="/jira/s/d8484c9183f546511a8e336a8779bcd9-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1fca1750044f2777c977e8d8cc023344/_/download/contextbatch/js/_super/batch.js?locale=en-UK" data-wrm-key="_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d3b35d835f8f46fc3b53bb4db7f85158-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/37a6e594cbbfd462a8a54d5aa11475c1/_/download/contextbatch/js/project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super/batch.js?agile_global_admin_condition=true&amp;hc-enabled=true&amp;is-server-instance=true&amp;jag=true&amp;jira.create.linked.issue=true&amp;locale=en-UK&amp;nps-acknowledged=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="project.issue.navigator,jira.view.issue,jira.global,atl.general,jira.general,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/71d42e74136d842a3ef4d5d136484843-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/871d45c9f322a22cb3aa9b7948a69803/_/download/contextbatch/js/atl.global,-_super/batch.js?locale=en-UK" data-wrm-key="atl.global,-_super" data-wrm-batch-type="context" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-en/jira.webresources:calendar-en.js" data-wrm-key="jira.webresources:calendar-en" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:calendar-localisation-moment/jira.webresources:calendar-localisation-moment.js" data-wrm-key="jira.webresources:calendar-localisation-moment" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/7.6.3/_/download/batch/com.atlassian.feedback.jira-feedback-plugin:button-resources/com.atlassian.feedback.jira-feedback-plugin:button-resources.js" data-wrm-key="com.atlassian.feedback.jira-feedback-plugin:button-resources" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/95a4826c265852f4904f1e0e7300df68-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/e0de73613a1027de08f3da6a45e1d1a2/_/download/contextbatch/css/jira.global.look-and-feel,-_super/batch.css" data-wrm-key="jira.global.look-and-feel,-_super" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/rest/api/1.0/shortcuts/76005/944bb39eced1b35cfc7194aa02eb5a5a/shortcuts.js?context=issuenavigation&amp;context=issueaction"></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["com.atlassian.jira.jira-issue-nav-components:inline-edit-enabled"]="true";
WRM._unparsedData["should-display-chaperone"]="false";
if(window.WRM._dataArrived)window.WRM._dataArrived();</script> 
  <link type="text/css" rel="stylesheet" href="/jira/s/15712b600e9aecf72ffd9fd3704a0c78-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/css/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.css?jira.create.linked.issue=true&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" media="all"> 
  <script type="text/javascript" src="/jira/s/5a8f0f8b8aa8f96a4f0f7e9e248d62f3-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/6b22a15c7b83f87a47b1757076f43542/_/download/contextbatch/js/com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue/batch.js?jira.create.linked.issue=true&amp;locale=en-UK&amp;richediton=true&amp;sd_operational=true" data-wrm-key="com.atlassian.jira.projects.sidebar.init,-_super,-project.issue.navigator,-jira.view.issue" data-wrm-batch-type="context" data-initially-rendered></script> 
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge"> 
  <meta name="ajs-can-search-users" content="false"> 
  <meta name="ajs-can-edit-watchers" content="false"> 
  <meta name="ajs-default-avatar-url" content="https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10453"> 
  <meta name="ajs-issue-project-type" content="software"> 
  <meta name="ajs-issue-key" content="SOLR-2894"> 
  <meta name="ajs-server-view-issue-is-editable" content="false"> 
  <title>[SOLR-2894] Implement distributed pivot faceting - ASF JIRA</title> 
  <link rel="search" type="application/opensearchdescription+xml" href="/jira/osd.jsp" title="[SOLR-2894] Implement distributed pivot faceting - ASF JIRA"> 
 </head> 
 <body id="jira" class="aui-layout aui-theme-default " data-version="7.6.3"> 
  <div id="page"> 
   <header id="header" role="banner"> 
    <script>
require(["jquery", "jira/license-banner"], function ($, licenseBanner) {
    $(function () {
        licenseBanner.showLicenseBanner("");
        licenseBanner.showLicenseFlag("");
    });
});
</script> 
    <nav class="aui-header aui-dropdown2-trigger-group" role="navigation">
     <div class="aui-header-inner">
      <div class="aui-header-before">
       <a class=" aui-dropdown2-trigger app-switcher-trigger" aria-controls="app-switcher" aria-haspopup="true" role="button" tabindex="0" data-aui-trigger href="#app-switcher"><span class="aui-icon aui-icon-small aui-iconfont-appswitcher">Linked Applications</span></a>
       <div id="app-switcher" class="aui-dropdown2 aui-style-default" role="menu" aria-hidden="true" data-is-switcher="true" data-environment="{&quot;isUserAdmin&quot;:false,&quot;isAppSuggestionAvailable&quot;:false,&quot;isSiteAdminUser&quot;:false}">
        <div role="application">
         <div class="app-switcher-loading">
          Loadingâ€¦
         </div>
        </div>
       </div>
      </div>
      <div class="aui-header-primary">
       <h1 id="logo" class="aui-header-logo aui-header-logo-custom"><a href="https://issues.apache.org/jira/secure/MyJiraHome.jspa"><img src="/jira/s/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/_/jira-logo-scaled.png" alt="ASF JIRA"></a></h1>
       <ul class="aui-nav">
        <li><a href="/jira/secure/Dashboard.jspa" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="home_link" aria-haspopup="true" aria-controls="home_link-content" title="View and manage your dashboards" accesskey="d">Dashboards</a>
         <div class="aui-dropdown2 aui-style-default" id="home_link-content" data-aui-dropdown2-ajax-key="home_link"></div></li>
        <li><a href="/jira/browse/SOLR" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="browse_link" aria-haspopup="true" aria-controls="browse_link-content" title="View recent projects and browse a list of projects" accesskey="p">Projects</a>
         <div class="aui-dropdown2 aui-style-default" id="browse_link-content" data-aui-dropdown2-ajax-key="browse_link"></div></li>
        <li><a href="/jira/issues/" class=" aui-nav-link aui-dropdown2-trigger aui-dropdown2-ajax" id="find_link" aria-haspopup="true" aria-controls="find_link-content" title="Search for issues and view recent issues" accesskey="i">Issues</a>
         <div class="aui-dropdown2 aui-style-default" id="find_link-content" data-aui-dropdown2-ajax-key="find_link"></div></li> 
       </ul>
      </div>
      <div class="aui-header-secondary">
       <ul class="aui-nav">
        <li id="quicksearch-menu"> 
         <form action="/jira/secure/QuickSearch.jspa" method="get" id="quicksearch" class="aui-quicksearch dont-default-focus ajs-dirty-warning-exempt"> 
          <input id="quickSearchInput" class="search" type="text" title="Search" placeholder="Search" name="searchString" accessKey="q"> 
          <input type="submit" class="hidden" value="Search"> 
         </form> </li> 
        <li><a class="jira-feedback-plugin" role="button" aria-haspopup="true" id="jira-header-feedback-link" href="#"><span class="aui-icon aui-icon-small jira-feedback-plugin-icon">Give feedback to Atlassian</span></a></li> 
        <li id="system-help-menu"> <a class="aui-nav-link aui-dropdown2-trigger" id="help_menu" aria-haspopup="true" aria-owns="system-help-menu-content" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="$textUtils.htmlEncode($rootHelpMenuItem.params.target)" title="Help"><span class="aui-icon aui-icon-small aui-iconfont-help">Help</span></a> 
         <div id="system-help-menu-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
           <ul id="jira-help" class="aui-list-truncate"> 
            <li> <a id="view_core_help" class="aui-nav-link " title="Go to the online documentation for JIRA Core" href="https://docs.atlassian.com/jira/jcore-docs-076/" target="_blank">JIRA Core help</a> </li> 
            <li> <a id="keyshortscuthelp" class="aui-nav-link " title="Get more information about JIRA's Keyboard Shortcuts" href="/jira/secure/ViewKeyboardShortcuts!default.jspa" target="_blank">Keyboard Shortcuts</a> </li> 
            <li> <a id="view_about" class="aui-nav-link " title="Get more information about JIRA" href="/jira/secure/AboutPage.jspa">About JIRA</a> </li> 
            <li> <a id="view_credits" class="aui-nav-link " title="See who did what" href="/jira/secure/JiraCreditsPage!default.jspa" target="_blank">JIRA Credits</a> </li> 
           </ul> 
          </div> 
         </div> </li> 
        <li id="user-options"> <a class="aui-nav-link login-link" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-2894">Log In</a> 
         <div id="user-options-content" class="aui-dropdown2 aui-style-default"> 
          <div class="aui-dropdown2-section"> 
          </div> 
         </div> </li> 
       </ul>
      </div>
     </div>
     <!-- .aui-header-inner-->
    </nav>
    <!-- .aui-header --> 
   </header> 
   <section id="content" role="main"> 
    <big-pipe data-id="sidebar-id" unresolved></big-pipe>
    <div class="aui-sidebar  sidebar-placeholder">
     <div class="aui-sidebar-wrapper">
      <div class="aui-sidebar-body"></div>
      <div class="aui-sidebar-footer">
       <a class="aui-button aui-button-subtle aui-sidebar-toggle aui-sidebar-footer-tipsy" data-tooltip="Expand sidebar ( [ )" href="#"><span class="aui-icon aui-icon-small"></span></a>
      </div>
     </div>
    </div>
    <script id="projects-sidebar-init">
    require(['jira/projects/sidebar/expansion-manager'], function(expansionManager) {
        var scriptTag = document.getElementById('projects-sidebar-init');
        var sidebar = AJS.sidebar('.aui-sidebar');
        expansionManager(sidebar);
        scriptTag.parentElement.removeChild(scriptTag);
    });
    </script>
    <div class="aui-page-panel">
     <div class="aui-page-panel-inner">
      <div class="issue-navigator">
       <div class="content">
        <div class="issue-view">
         <div class="navigation-tools">
          <div class="pager-container"></div>
         </div>
         <div class="issue-container">
          <div id="issue-content" class="issue-edit-form">
           <header id="stalker" class="issue-header js-stalker">
            <div class="issue-header-content">
             <header class="aui-page-header">
              <div class="aui-page-header-inner">
               <div class="aui-page-header-image">
                <span id="12310230" class="aui-avatar aui-avatar-large aui-avatar-project"><span class="aui-avatar-inner"><img id="project-avatar" alt="Uploaded image for project: 'Solr'" src="https://issues.apache.org/jira/secure/projectavatar?pid=12310230&amp;avatarId=22151"></span></span>
               </div>
               <!-- .aui-page-header-image -->
               <div class="aui-page-header-main">
                <ol class="aui-nav aui-nav-breadcrumbs">
                 <li><a id="project-name-val" href="/jira/browse/SOLR">Solr</a></li>
                 <li><a class="issue-link" data-issue-key="SOLR-2894" href="/jira/browse/SOLR-2894" id="key-val" rel="12531256">SOLR-2894</a></li>
                </ol>
                <h1 id="summary-val">Implement distributed pivot faceting</h1>
               </div>
               <!-- .aui-page-header-main -->
               <div class="aui-page-header-actions">
                <div id="issue-header-pager"></div>
               </div>
               <!-- .aui-page-header-actions -->
              </div>
              <!-- .aui-page-header-inner -->
             </header>
             <!-- .aui-page-header -->
             <div class="command-bar">
              <div class="ops-cont">
               <div class="ops-menus aui-toolbar">
                <div class="toolbar-split toolbar-split-left">
                 <ul id="opsbar-ops-login-lnk_container" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item"><a id="ops-login-lnk" title="Log In" class="toolbar-trigger" href="/jira/login.jsp?os_destination=%2Fbrowse%2FSOLR-2894"><span class="trigger-label">Log In</span></a></li>
                 </ul>
                 <ul id="opsbar-opsbar-operations" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-transitions" class="toolbar-group pluggable-ops"></ul>
                 <ul id="opsbar-opsbar-admin" class="toolbar-group pluggable-ops"></ul>
                </div>
                <div class="toolbar-split toolbar-split-right">
                 <ul id="opsbar-jira.issue.tools" class="toolbar-group pluggable-ops">
                  <li class="toolbar-item">
                   <div>
                    <a href="#" id="viewissue-export" aria-owns="viewissue-export_drop" aria-haspopup="true" title="Export this issue in another format" class="toolbar-trigger aui-button aui-style-default aui-dropdown2-trigger"><span class="icon icon-default aui-icon aui-icon-small aui-iconfont-export"></span> <span class="dropdown-text">Export</span></a>
                    <div id="viewissue-export_drop" class="aui-style-default aui-dropdown2">
                     <ul>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-xml/SOLR-2894/SOLR-2894.xml" id="jira.issueviews:issue-xml"><span class="trigger-label">XML</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-word/SOLR-2894/SOLR-2894.doc" id="jira.issueviews:issue-word"><span class="trigger-label">Word</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/jira.issueviews:issue-html/SOLR-2894/SOLR-2894.html" id="jira.issueviews:issue-html"><span class="trigger-label">Printable</span></a></li>
                      <li class="aui-list-item"><a href="/jira/si/com.atlassian.jira.plugins.jira-importers-plugin:issue-json/SOLR-2894/SOLR-2894.json" id="com.atlassian.jira.plugins.jira-importers-plugin:issue-json"><span class="trigger-label">JSON</span></a></li>
                     </ul>
                    </div>
                   </div></li>
                 </ul>
                </div>
               </div>
              </div>
             </div>
            </div>
           </header>
           <div class="issue-body-content">
            <div class="aui-group issue-body">
             <div class="aui-item issue-main-column">
              <div id="details-module" class="module toggle-wrap">
               <div id="details-module_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Details</h2>
               </div>
               <div class="mod-content"> 
                <ul id="issuedetails" class="property-list two-cols"> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Type:</strong> 
                   <span id="type-val" class="value"> <img alt="" height="16" src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" title="Improvement - An improvement or enhancement to an existing feature or task." width="16"> Improvement </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Status:</strong> 
                   <span id="status-val" class="value"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done jira-issue-status-lozenge-max-width-medium" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Resolved</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.</span>">Resolved</span> </span> 
                  </div> </li> 
                 <li class="item new"> 
                  <div class="wrap"> 
                   <strong class="name">Priority:</strong> 
                   <span id="priority-val" class="value"> <img alt="" height="16" src="/jira/images/icons/priorities/major.svg" title="Major - Major loss of function." width="16"> Major </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Resolution:</strong> 
                   <span id="resolution-val" class="value resolved"> Fixed </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Affects Version/s:</strong> 
                   <span id="versions-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item item-right"> 
                  <div class="wrap"> 
                   <strong class="name">Fix Version/s:</strong> 
                   <span id="fixfor-val" class="value"> <span class="shorten" id="fixVersions-field"> <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+4.10" title="4.10 Major release after 4.9">4.10</a>, <a href="/jira/issues/?jql=project+%3D+SOLR+AND+fixVersion+%3D+6.0" title="6.0 First 6.x release, Major release after 5.5">6.0</a> </span> </span> 
                  </div> </li> 
                 <li class="item"> 
                  <div class="wrap"> 
                   <strong class="name">Component/s:</strong> 
                   <span id="components-val" class="value"> None </span> 
                  </div> </li> 
                 <li class="item full-width"> 
                  <div class="wrap" id="wrap-labels"> 
                   <strong class="name">Labels:</strong> 
                   <div class="labels-wrap value"> 
                    <span class="labels" id="labels-12531256-value">None</span> 
                   </div> 
                  </div> </li> 
                </ul> 
               </div>
              </div>
              <div id="descriptionmodule" class="module toggle-wrap">
               <div id="descriptionmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Description</h2>
               </div>
               <div class="mod-content">
                <div id="description-val" class="field-ignore-highlight"> 
                 <div class="user-content-block"> 
                  <p>Following up on <a href="https://issues.apache.org/jira/browse/SOLR-792" title="Pivot (ie: Decision Tree) Faceting Component" class="issue-link" data-issue-key="SOLR-792"><del>SOLR-792</del></a>, pivot faceting currently only supports undistributed mode. Distributed pivot faceting needs to be implemented.</p> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="dnd-metadata" class="module toggle-wrap">
               <div id="dnd-metadata_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <div id="dnd-metadata-webpanel" data-can-attach="false" data-project-type="software" data-upload-limit="62914560" data-thumbnails-allowed="false"></div>
               </div>
              </div>
              <div id="attachmentmodule" class="module toggle-wrap">
               <div id="attachmentmodule_heading" class="mod-header">
                <ul class="ops">
                 <li class="drop">
                  <div class="aui-dd-parent">
                   <a href="#" class="icon drop-menu js-default-dropdown" title="Options"><span>Options</span></a>
                   <div class="aui-dropdown-content aui-list">
                    <ul id="attachment-sorting-options" class="aui-list-section aui-first">
                     <li class="aui-list-item"><a id="attachment-sort-key-name" href="/jira/browse/SOLR-2894?attachmentSortBy=fileName#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="viewissue.subtasks.tab.show.all.name"><span>Sort By Name</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-key-date" href="/jira/browse/SOLR-2894?attachmentSortBy=dateTime#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Sort By Date"><span>Sort By Date</span></a></li>
                    </ul>
                    <ul id="attachment-sorting-order-options" class="aui-list-section aui-last">
                     <li class="aui-list-item"><a id="attachment-sort-direction-asc" href="/jira/browse/SOLR-2894?attachmentOrder=asc#attachmentmodule" class="aui-list-checked aui-checked aui-list-item-link" title="Ascending"><span>Ascending</span></a></li>
                     <li class="aui-list-item"><a id="attachment-sort-direction-desc" href="/jira/browse/SOLR-2894?attachmentOrder=desc#attachmentmodule" class="aui-list-checked aui-list-item-link" title="Descending"><span>Descending</span></a></li>
                    </ul>
                   </div>
                  </div></li>
                </ul>
                <h2 class="toggle-title">Attachments</h2>
               </div>
               <div class="mod-content">
                <ol id="file_attachments" class="item-attachments" data-sort-key="fileName" data-sort-order="asc">
                 <li class="attachment-content js-file-attachment" data-attachment-id="12661710" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12661710/48.pivotfails.log.bz2" draggable="true" data-downloadurl="application/x-bzip2:48.pivotfails.log.bz2:https://issues.apache.org/jira/secure/attachment/12661710/48.pivotfails.log.bz2"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12661710/48.pivotfails.log.bz2" title="Latest  14/Aug/14 13:25 - Steve Rowe" draggable="true" data-downloadurl="application/x-bzip2:48.pivotfails.log.bz2:https://issues.apache.org/jira/secure/attachment/12661710/48.pivotfails.log.bz2">48.pivotfails.log.bz2</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-14T13:25:45.800Z">14/Aug/14 13:25</time>
                   </dd>
                   <dd class="attachment-size">
                    6.28 MB
                   </dd>
                   <dd class="attachment-author">
                    Steve Rowe
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12633586" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12633586/dateToObject.patch" draggable="true" data-downloadurl="text/plain:dateToObject.patch:https://issues.apache.org/jira/secure/attachment/12633586/dateToObject.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12633586/dateToObject.patch" title="Latest  09/Mar/14 09:08 - Elran Dvir" draggable="true" data-downloadurl="text/plain:dateToObject.patch:https://issues.apache.org/jira/secure/attachment/12633586/dateToObject.patch">dateToObject.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-03-09T09:08:35.044Z">09/Mar/14 09:08</time>
                   </dd>
                   <dd class="attachment-size">
                    2 kB
                   </dd>
                   <dd class="attachment-author">
                    Elran Dvir
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12644208" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12644208/pivot_mincount_problem.sh" draggable="true" data-downloadurl="application/x-shellscript:pivot_mincount_problem.sh:https://issues.apache.org/jira/secure/attachment/12644208/pivot_mincount_problem.sh"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12644208/pivot_mincount_problem.sh" title="Latest  09/May/14 23:04 - Hoss Man" draggable="true" data-downloadurl="application/x-shellscript:pivot_mincount_problem.sh:https://issues.apache.org/jira/secure/attachment/12644208/pivot_mincount_problem.sh">pivot_mincount_problem.sh</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-09T23:04:53.213Z">09/May/14 23:04</time>
                   </dd>
                   <dd class="attachment-size">
                    305 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12661573" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12661573/pivotfail.log" draggable="true" data-downloadurl="text/x-log:pivotfail.log:https://issues.apache.org/jira/secure/attachment/12661573/pivotfail.log"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12661573/pivotfail.log" title="Latest  13/Aug/14 23:04 - Mark Miller" draggable="true" data-downloadurl="text/x-log:pivotfail.log:https://issues.apache.org/jira/secure/attachment/12661573/pivotfail.log">pivotfail.log</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-13T23:04:05.264Z">13/Aug/14 23:04</time>
                   </dd>
                   <dd class="attachment-size">
                    531 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Miller
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12644671" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12644671/SOLR-2894_cloud_test.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894_cloud_test.patch:https://issues.apache.org/jira/secure/attachment/12644671/SOLR-2894_cloud_test.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12644671/SOLR-2894_cloud_test.patch" title="Latest  13/May/14 18:21 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894_cloud_test.patch:https://issues.apache.org/jira/secure/attachment/12644671/SOLR-2894_cloud_test.patch">SOLR-2894_cloud_test.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-13T18:21:04.147Z">13/May/14 18:21</time>
                   </dd>
                   <dd class="attachment-size">
                    14 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12661493" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12661493/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12661493/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12661493/SOLR-2894.patch" title="Latest  13/Aug/14 18:13 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12661493/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-13T18:13:34.226Z">13/Aug/14 18:13</time>
                   </dd>
                   <dd class="attachment-size">
                    233 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12660499" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12660499/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12660499/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12660499/SOLR-2894.patch" title=" 07/Aug/14 22:57 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12660499/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-07T22:57:58.554Z">07/Aug/14 22:57</time>
                   </dd>
                   <dd class="attachment-size">
                    233 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12660264" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12660264/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12660264/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12660264/SOLR-2894.patch" title=" 06/Aug/14 23:18 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12660264/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-06T23:18:38.646Z">06/Aug/14 23:18</time>
                   </dd>
                   <dd class="attachment-size">
                    233 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12659963" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12659963/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12659963/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12659963/SOLR-2894.patch" title=" 05/Aug/14 21:56 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12659963/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-05T21:56:06.563Z">05/Aug/14 21:56</time>
                   </dd>
                   <dd class="attachment-size">
                    233 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12659665" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12659665/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12659665/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12659665/SOLR-2894.patch" title=" 04/Aug/14 16:18 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12659665/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-08-04T16:18:54.195Z">04/Aug/14 16:18</time>
                   </dd>
                   <dd class="attachment-size">
                    231 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12658554" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12658554/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12658554/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12658554/SOLR-2894.patch" title=" 30/Jul/14 01:16 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12658554/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-30T01:16:21.054Z">30/Jul/14 01:16</time>
                   </dd>
                   <dd class="attachment-size">
                    227 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12658452" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12658452/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12658452/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12658452/SOLR-2894.patch" title=" 29/Jul/14 17:44 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12658452/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-29T17:44:10.030Z">29/Jul/14 17:44</time>
                   </dd>
                   <dd class="attachment-size">
                    218 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12658328" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12658328/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12658328/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12658328/SOLR-2894.patch" title=" 29/Jul/14 01:54 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12658328/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-29T01:54:33.576Z">29/Jul/14 01:54</time>
                   </dd>
                   <dd class="attachment-size">
                    217 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12657956" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12657956/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12657956/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12657956/SOLR-2894.patch" title=" 26/Jul/14 00:59 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12657956/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-26T00:59:58.104Z">26/Jul/14 00:59</time>
                   </dd>
                   <dd class="attachment-size">
                    216 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12657489" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12657489/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12657489/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12657489/SOLR-2894.patch" title=" 23/Jul/14 23:44 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12657489/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-23T23:44:51.644Z">23/Jul/14 23:44</time>
                   </dd>
                   <dd class="attachment-size">
                    211 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12656519" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12656519/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12656519/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12656519/SOLR-2894.patch" title=" 18/Jul/14 15:11 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12656519/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-18T15:11:11.967Z">18/Jul/14 15:11</time>
                   </dd>
                   <dd class="attachment-size">
                    214 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12656135" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12656135/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12656135/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12656135/SOLR-2894.patch" title=" 16/Jul/14 20:58 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12656135/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-16T20:58:11.093Z">16/Jul/14 20:58</time>
                   </dd>
                   <dd class="attachment-size">
                    183 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12655875" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12655875/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12655875/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12655875/SOLR-2894.patch" title=" 15/Jul/14 21:37 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12655875/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-15T21:37:14.870Z">15/Jul/14 21:37</time>
                   </dd>
                   <dd class="attachment-size">
                    182 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12655330" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12655330/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12655330/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12655330/SOLR-2894.patch" title=" 11/Jul/14 23:05 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12655330/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-11T23:05:30.372Z">11/Jul/14 23:05</time>
                   </dd>
                   <dd class="attachment-size">
                    175 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12653725" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12653725/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12653725/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12653725/SOLR-2894.patch" title=" 03/Jul/14 00:12 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12653725/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-07-03T00:12:01.676Z">03/Jul/14 00:12</time>
                   </dd>
                   <dd class="attachment-size">
                    167 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12652989" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12652989/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12652989/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12652989/SOLR-2894.patch" title=" 28/Jun/14 02:04 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12652989/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-06-28T02:04:13.230Z">28/Jun/14 02:04</time>
                   </dd>
                   <dd class="attachment-size">
                    160 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12652920" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12652920/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12652920/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12652920/SOLR-2894.patch" title=" 27/Jun/14 23:43 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12652920/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-06-27T23:43:01.116Z">27/Jun/14 23:43</time>
                   </dd>
                   <dd class="attachment-size">
                    158 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12652705" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12652705/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12652705/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12652705/SOLR-2894.patch" title=" 26/Jun/14 22:39 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12652705/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-06-26T22:39:58.059Z">26/Jun/14 22:39</time>
                   </dd>
                   <dd class="attachment-size">
                    157 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12649978" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12649978/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12649978/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12649978/SOLR-2894.patch" title=" 12/Jun/14 01:24 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12649978/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-06-12T01:24:22.353Z">12/Jun/14 01:24</time>
                   </dd>
                   <dd class="attachment-size">
                    154 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12649719" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12649719/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12649719/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12649719/SOLR-2894.patch" title=" 11/Jun/14 00:57 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12649719/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-06-11T00:57:05.426Z">11/Jun/14 00:57</time>
                   </dd>
                   <dd class="attachment-size">
                    138 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12649619" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12649619/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12649619/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12649619/SOLR-2894.patch" title=" 10/Jun/14 17:22 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12649619/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-06-10T17:22:10.850Z">10/Jun/14 17:22</time>
                   </dd>
                   <dd class="attachment-size">
                    128 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12646308" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12646308/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12646308/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12646308/SOLR-2894.patch" title=" 22/May/14 15:02 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12646308/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-22T15:02:00.031Z">22/May/14 15:02</time>
                   </dd>
                   <dd class="attachment-size">
                    149 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12645824" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12645824/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12645824/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12645824/SOLR-2894.patch" title=" 20/May/14 17:25 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12645824/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-20T17:25:16.304Z">20/May/14 17:25</time>
                   </dd>
                   <dd class="attachment-size">
                    121 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12645627" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12645627/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12645627/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12645627/SOLR-2894.patch" title=" 19/May/14 20:23 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12645627/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-19T20:23:49.318Z">19/May/14 20:23</time>
                   </dd>
                   <dd class="attachment-size">
                    119 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12643458" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12643458/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12643458/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12643458/SOLR-2894.patch" title=" 06/May/14 00:14 - Hoss Man" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12643458/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-06T00:14:33.770Z">06/May/14 00:14</time>
                   </dd>
                   <dd class="attachment-size">
                    99 kB
                   </dd>
                   <dd class="attachment-author">
                    Hoss Man
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12641966" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12641966/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12641966/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12641966/SOLR-2894.patch" title=" 25/Apr/14 17:50 - Mark Miller" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12641966/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-04-25T17:50:21.232Z">25/Apr/14 17:50</time>
                   </dd>
                   <dd class="attachment-size">
                    101 kB
                   </dd>
                   <dd class="attachment-author">
                    Mark Miller
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12639070" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12639070/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12639070/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12639070/SOLR-2894.patch" title=" 07/Apr/14 21:41 - Brett Lucey" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12639070/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-04-07T21:41:47.097Z">07/Apr/14 21:41</time>
                   </dd>
                   <dd class="attachment-size">
                    102 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Lucey
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12633988" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12633988/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12633988/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12633988/SOLR-2894.patch" title=" 11/Mar/14 19:35 - Brett Lucey" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12633988/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-03-11T19:35:41.351Z">11/Mar/14 19:35</time>
                   </dd>
                   <dd class="attachment-size">
                    102 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Lucey
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12632849" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12632849/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12632849/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12632849/SOLR-2894.patch" title=" 05/Mar/14 17:01 - Brett Lucey" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12632849/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-03-05T17:01:19.659Z">05/Mar/14 17:01</time>
                   </dd>
                   <dd class="attachment-size">
                    101 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Lucey
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12630958" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12630958/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12630958/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12630958/SOLR-2894.patch" title=" 25/Feb/14 14:39 - Brett Lucey" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12630958/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-02-25T14:39:15.294Z">25/Feb/14 14:39</time>
                   </dd>
                   <dd class="attachment-size">
                    94 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Lucey
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12629612" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12629612/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12629612/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12629612/SOLR-2894.patch" title=" 18/Feb/14 20:16 - Brett Lucey" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12629612/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-02-18T20:16:02.333Z">18/Feb/14 20:16</time>
                   </dd>
                   <dd class="attachment-size">
                    127 kB
                   </dd>
                   <dd class="attachment-author">
                    Brett Lucey
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12596728" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12596728/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12596728/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12596728/SOLR-2894.patch" title=" 07/Aug/13 22:06 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12596728/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-08-07T22:06:11.890Z">07/Aug/13 22:06</time>
                   </dd>
                   <dd class="attachment-size">
                    135 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12594227" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12594227/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12594227/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12594227/SOLR-2894.patch" title=" 25/Jul/13 18:29 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12594227/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-07-25T18:29:05.994Z">25/Jul/13 18:29</time>
                   </dd>
                   <dd class="attachment-size">
                    116 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12593594" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12593594/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12593594/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12593594/SOLR-2894.patch" title=" 22/Jul/13 21:15 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12593594/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-07-22T21:15:17.753Z">22/Jul/13 21:15</time>
                   </dd>
                   <dd class="attachment-size">
                    113 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12574862" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12574862/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12574862/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12574862/SOLR-2894.patch" title=" 21/Mar/13 19:40 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12574862/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-21T19:40:34.465Z">21/Mar/13 19:40</time>
                   </dd>
                   <dd class="attachment-size">
                    109 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12573195" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12573195/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12573195/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12573195/SOLR-2894.patch" title=" 11/Mar/13 22:17 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12573195/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-11T22:17:32.284Z">11/Mar/13 22:17</time>
                   </dd>
                   <dd class="attachment-size">
                    106 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12572555" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12572555/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12572555/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12572555/SOLR-2894.patch" title=" 07/Mar/13 16:49 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12572555/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-07T16:49:12.350Z">07/Mar/13 16:49</time>
                   </dd>
                   <dd class="attachment-size">
                    98 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12572409" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12572409/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12572409/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12572409/SOLR-2894.patch" title=" 06/Mar/13 22:04 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12572409/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-03-06T22:04:36.261Z">06/Mar/13 22:04</time>
                   </dd>
                   <dd class="attachment-size">
                    101 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12570315" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12570315/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12570315/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12570315/SOLR-2894.patch" title=" 21/Feb/13 15:32 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12570315/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-02-21T15:32:41.448Z">21/Feb/13 15:32</time>
                   </dd>
                   <dd class="attachment-size">
                    141 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12564765" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12564765/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12564765/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12564765/SOLR-2894.patch" title=" 14/Jan/13 20:05 - Chris Russell" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12564765/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-14T20:05:49.266Z">14/Jan/13 20:05</time>
                   </dd>
                   <dd class="attachment-size">
                    60 kB
                   </dd>
                   <dd class="attachment-author">
                    Chris Russell
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12563081" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12563081/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12563081/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12563081/SOLR-2894.patch" title=" 03/Jan/13 15:44 - Chris Russell" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12563081/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2013-01-03T15:44:46.160Z">03/Jan/13 15:44</time>
                   </dd>
                   <dd class="attachment-size">
                    60 kB
                   </dd>
                   <dd class="attachment-author">
                    Chris Russell
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12561977" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12561977/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12561977/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12561977/SOLR-2894.patch" title=" 20/Dec/12 20:08 - Chris Russell" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12561977/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-12-20T20:08:10.633Z">20/Dec/12 20:08</time>
                   </dd>
                   <dd class="attachment-size">
                    51 kB
                   </dd>
                   <dd class="attachment-author">
                    Chris Russell
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12553194" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12553194/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12553194/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12553194/SOLR-2894.patch" title=" 12/Nov/12 21:37 - Chris Russell" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12553194/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-11-12T21:37:07.684Z">12/Nov/12 21:37</time>
                   </dd>
                   <dd class="attachment-size">
                    49 kB
                   </dd>
                   <dd class="attachment-author">
                    Chris Russell
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12532127" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12532127/SOLR-2894.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12532127/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12532127/SOLR-2894.patch" title=" 14/Jun/12 19:35 - Erik Hatcher" draggable="true" data-downloadurl="text/plain:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12532127/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-06-14T19:35:06.176Z">14/Jun/12 19:35</time>
                   </dd>
                   <dd class="attachment-size">
                    94 kB
                   </dd>
                   <dd class="attachment-author">
                    Erik Hatcher
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment earlier-version" data-attachment-id="12517099" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12517099/SOLR-2894.patch" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12517099/SOLR-2894.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-devtools-file" title="File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12517099/SOLR-2894.patch" title=" 05/Mar/12 17:11 - Dan Cooper" draggable="true" data-downloadurl="text/x-patch:SOLR-2894.patch:https://issues.apache.org/jira/secure/attachment/12517099/SOLR-2894.patch">SOLR-2894.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-03-05T17:11:58.843Z">05/Mar/12 17:11</time>
                   </dd>
                   <dd class="attachment-size">
                    94 kB
                   </dd>
                   <dd class="attachment-author">
                    Dan Cooper
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12645331" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12645331/SOLR-2894-mincount-minification.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894-mincount-minification.patch:https://issues.apache.org/jira/secure/attachment/12645331/SOLR-2894-mincount-minification.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12645331/SOLR-2894-mincount-minification.patch" title="Latest  16/May/14 21:27 - Andrew Muldowney" draggable="true" data-downloadurl="text/plain:SOLR-2894-mincount-minification.patch:https://issues.apache.org/jira/secure/attachment/12645331/SOLR-2894-mincount-minification.patch">SOLR-2894-mincount-minification.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2014-05-16T21:27:07.519Z">16/May/14 21:27</time>
                   </dd>
                   <dd class="attachment-size">
                    119 kB
                   </dd>
                   <dd class="attachment-author">
                    Andrew Muldowney
                   </dd>
                  </dl></li>
                 <li class="attachment-content js-file-attachment" data-attachment-id="12538443" data-issue-id="12531256" data-attachment-type="file">
                  <div class="attachment-thumb">
                   <a href="/jira/secure/attachment/12538443/SOLR-2894-reworked.patch" draggable="true" data-downloadurl="text/plain:SOLR-2894-reworked.patch:https://issues.apache.org/jira/secure/attachment/12538443/SOLR-2894-reworked.patch"><span class="aui-icon aui-icon-small attachment-icon aui-iconfont-file-txt" title="Text File"></span></a>
                  </div>
                  <dl>
                   <dt class="attachment-title">
                    <a href="/jira/secure/attachment/12538443/SOLR-2894-reworked.patch" title="Latest  30/Jul/12 22:46 - Dzmitry Zhemchuhou" draggable="true" data-downloadurl="text/plain:SOLR-2894-reworked.patch:https://issues.apache.org/jira/secure/attachment/12538443/SOLR-2894-reworked.patch">SOLR-2894-reworked.patch</a>
                   </dt>
                   <dd class="attachment-delete">
                    <span class="icon"></span>
                   </dd>
                   <dd class="attachment-date">
                    <time class="livestamp" datetime="2012-07-30T22:46:01.756Z">30/Jul/12 22:46</time>
                   </dd>
                   <dd class="attachment-size">
                    47 kB
                   </dd>
                   <dd class="attachment-author">
                    Dzmitry Zhemchuhou
                   </dd>
                  </dl></li>
                </ol>
               </div>
              </div>
              <div id="linkingmodule" class="module toggle-wrap">
               <div id="linkingmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Issue Links</h2>
               </div>
               <div class="mod-content"> 
                <div class="links-container" data-default-link-icon="/jira/images/icons/generic_link_16.png"> 
                 <dl class="links-list "> 
                  <dt title="blocks">
                   blocks
                  </dt> 
                  <dd id="internal-12624562_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21146&amp;avatarType=issuetype" width="16" height="16" title="Sub-task - The sub-task of the issue" alt="Sub-task - The sub-task of the issue"> <span title="SOLR-4212: Let facet queries hang off of pivots"> <a href="/jira/browse/SOLR-4212" data-issue-key="SOLR-4212" class="issue-link link-title resolution">SOLR-4212</a> <span class="link-summary">Let facet queries hang off of pivots</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12732356_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-6329: facet.pivot.mincount=0 doesn't work well in distributed pivot faceting"> <a href="/jira/browse/SOLR-6329" data-issue-key="SOLR-6329" class="issue-link link-title">SOLR-6329</a> <span class="link-summary">facet.pivot.mincount=0 doesn't work well in distributed pivot faceting</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12732409_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-6330: distributed pivot faceting may not work well with some custom FieldTypes"> <a href="/jira/browse/SOLR-6330" data-issue-key="SOLR-6330" class="issue-link link-title">SOLR-6330</a> <span class="link-summary">distributed pivot faceting may not work well with some custom FieldTypes</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12732411_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="SOLR-6331: possible memory optimization for distributed pivot faceting"> <a href="/jira/browse/SOLR-6331" data-issue-key="SOLR-6331" class="issue-link link-title">SOLR-6331</a> <span class="link-summary">possible memory optimization for distributed pivot faceting</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12731867_10032"> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="SOLR-6319: consider increasing over-request amount when sorting by index with mincount > 1"> <a href="/jira/browse/SOLR-6319" data-issue-key="SOLR-6319" class="issue-link link-title">SOLR-6319</a> <span class="link-summary">consider increasing over-request amount when sorting by index with mincount &gt; 1</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12596270_10032" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="SOLR-3583: Percentiles for facets, pivot facets, and distributed pivot facets"> <a href="/jira/browse/SOLR-3583" data-issue-key="SOLR-3583" class="issue-link link-title resolution">SOLR-3583</a> <span class="link-summary">Percentiles for facets, pivot facets, and distributed pivot facets</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list collapsed-links-list"> 
                  <dt title="is related to">
                   is related to
                  </dt> 
                  <dd id="internal-12405278_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21141&amp;avatarType=issuetype" width="16" height="16" title="New Feature - A new feature of the product, which has yet to be developed." alt="New Feature - A new feature of the product, which has yet to be developed."> <span title="SOLR-792: Pivot (ie: Decision Tree) Faceting Component"> <a href="/jira/browse/SOLR-792" data-issue-key="SOLR-792" class="issue-link link-title resolution">SOLR-792</a> <span class="link-summary">Pivot (ie: Decision Tree) Faceting Component</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-green jira-issue-status-lozenge-done aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Closed</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.</span>">Closed</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <dl class="links-list collapsed-links-list"> 
                  <dt title="relates to">
                   relates to
                  </dt> 
                  <dd id="internal-12723171_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-6193: using facet.* parameters as local params inside of facet.field causes problems in distributed search"> <a href="/jira/browse/SOLR-6193" data-issue-key="SOLR-6193" class="issue-link link-title">SOLR-6193</a> <span class="link-summary">using facet.* parameters as local params inside of facet.field causes problems in distributed search</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12734272_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype" width="16" height="16" title="Bug - A problem which impairs or prevents the functions of the product." alt="Bug - A problem which impairs or prevents the functions of the product."> <span title="SOLR-6379: CloudSolrServer can query the wrong replica if a collection has a SolrCore name that matches a collection name."> <a href="/jira/browse/SOLR-6379" data-issue-key="SOLR-6379" class="issue-link link-title">SOLR-6379</a> <span class="link-summary">CloudSolrServer can query the wrong replica if a collection has a SolrCore name that matches a collection name.</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/minor.svg" width="16" height="16" title="Minor - Minor loss of function, or other problem where easy workaround is present." alt="Minor - Minor loss of function, or other problem where easy workaround is present."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                  <dd id="internal-12734654_10030" class="
                                                collapsed-link                    "> 
                   <div class="link-content"> 
                    <p> <img src="/jira/secure/viewavatar?size=xsmall&amp;avatarId=21140&amp;avatarType=issuetype" width="16" height="16" title="Improvement - An improvement or enhancement to an existing feature or task." alt="Improvement - An improvement or enhancement to an existing feature or task."> <span title="SOLR-6386: make secondary ordering of facet.field values (and facet.pivot?) consistently deterministic"> <a href="/jira/browse/SOLR-6386" data-issue-key="SOLR-6386" class="issue-link link-title">SOLR-6386</a> <span class="link-summary">make secondary ordering of facet.field values (and facet.pivot?) consistently deterministic</span> </span> </p> 
                    <ul class="link-snapshot"> 
                     <li class="priority"> <img src="/jira/images/icons/priorities/major.svg" width="16" height="16" title="Major - Major loss of function." alt="Major - Major loss of function."> </li> 
                     <li class="status"> <span class=" jira-issue-status-lozenge aui-lozenge jira-issue-status-lozenge-blue-gray jira-issue-status-lozenge-new aui-lozenge-subtle jira-issue-status-lozenge-max-width-short" data-tooltip="<span class=&quot;jira-issue-status-tooltip-title&quot;>Open</span><br><span class=&quot;jira-issue-status-tooltip-desc&quot;>The issue is open and ready for the assignee to start work on it.</span>">Open</span> </li> 
                    </ul> 
                   </div> 
                  </dd> 
                 </dl> 
                 <div id="show-more-links"> 
                  <button class="aui-button aui-button-link" id="show-more-links-link">Show 5 more links</button> 
                  <span>(1 blocks, 1 is related to, 3 relates to)</span> 
                 </div> 
                </div> 
               </div>
              </div>
              <div id="activitymodule" class="module toggle-wrap">
               <div id="activitymodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Activity</h2>
               </div>
               <div class="mod-content"> 
                <big-pipe data-id="activity-panel-pipe-id" style="height: 70px"> 
                 <div></div> 
                </big-pipe> 
               </div>
              </div>
             </div>
             <div id="viewissuesidebar" class="aui-item issue-side-column">
              <div id="peoplemodule" class="module toggle-wrap">
               <div id="peoplemodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">People</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details" id="peopledetails"> 
                 <li class="people-details"> 
                  <dl> 
                   <dt>
                    Assignee:
                   </dt> 
                   <dd> 
                    <span id="assignee-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_assignee_hossman" rel="hossman" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Hoss Man&quot;,&quot;emailAddress&quot;:&quot;hossman_apachejira@fucit.org&quot;,&quot;username&quot;:&quot;hossman&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="hossman"></span></span> Hoss Man </span> </span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Reporter:
                   </dt> 
                   <dd> 
                    <span id="reporter-val" class="view-issue-field"> <span class="user-hover" id="issue_summary_reporter_ehatcher" rel="ehatcher" data-user="{&quot;avatarUrl&quot;:&quot;https://issues.apache.org/jira/secure/useravatar?size=xsmall&amp;avatarId=10452&quot;,&quot;displayName&quot;:&quot;Erik Hatcher&quot;,&quot;emailAddress&quot;:&quot;ehatcher@apache.org&quot;,&quot;username&quot;:&quot;ehatcher&quot;}"> <span class="aui-avatar aui-avatar-small"><span class="aui-avatar-inner"><img src="https://issues.apache.org/jira/secure/useravatar?size=small&amp;avatarId=10452" alt="ehatcher"></span></span> Erik Hatcher </span> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
                <ul class="item-details"> 
                 <li> 
                  <dl> 
                   <dt>
                    Votes:
                   </dt> 
                   <dd> 
                    <span id="vote-data" class="aui-badge vote-state-off">56</span> 
                    <span id="vote-label" title="You have to be logged in to vote for an issue.">Vote for this issue</span> 
                   </dd> 
                  </dl> 
                  <dl> 
                   <dt>
                    Watchers:
                   </dt> 
                   <dd> 
                    <span id="watcher-data" class="aui-badge watch-state-off">58</span> 
                    <span id="watch-label" title="You have to be logged in to watch an issue.">Start watching this issue</span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
              <div id="datesmodule" class="module toggle-wrap">
               <div id="datesmodule_heading" class="mod-header">
                <ul class="ops"></ul>
                <h2 class="toggle-title">Dates</h2>
               </div>
               <div class="mod-content"> 
                <ul class="item-details"> 
                 <li> 
                  <dl class="dates"> 
                   <dt>
                    Created:
                   </dt> 
                   <dd class="date user-tz" title="13/Nov/11 11:21"> 
                    <span data-name="Created" id="created-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2011-11-13T11:21:17+0000">13/Nov/11 11:21</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Updated:
                   </dt> 
                   <dd class="date user-tz" title="09/May/16 18:50"> 
                    <span data-name="Updated" id="updated-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2016-05-09T18:50:06+0000">09/May/16 18:50</time> </span> 
                   </dd> 
                  </dl> 
                  <dl class="dates"> 
                   <dt>
                    Resolved:
                   </dt> 
                   <dd class="date user-tz" title="20/Aug/14 18:10"> 
                    <span data-name="Resolved" id="resolutiondate-val" data-fieldtype="datetime"> <time class="livestamp" datetime="2014-08-20T18:10:08+0000">20/Aug/14 18:10</time> </span> 
                   </dd> 
                  </dl> </li> 
                </ul> 
               </div>
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
     <!-- .aui-page-panel-inner -->
    </div>
    <!-- .aui-page-panel -->
    <div class="issue-navigator-init"></div> 
   </section> 
   <footer id="footer" role="contentinfo"> 
    <section class="footer-body"> 
     <ul class="atlassian-footer"> 
      <li> Atlassian JIRA <a class="seo-link" rel="nofollow" href="https://www.atlassian.com/software/jira">Project Management Software</a> <span id="footer-build-information">(v7.6.3#76005-<span title="8a4e38d34af948780dbf52044e7aafb13a7cae58" data-commit-id="8a4e38d34af948780dbf52044e7aafb13a7cae58}">sha1:8a4e38d</span>)</span> </li> 
      <li> <a id="about-link" rel="nofollow" href="/jira/secure/AboutPage.jspa/secure/AboutPage.jspa">About JIRA</a> </li> 
      <li> <a id="footer-report-problem-link" rel="nofollow" href="/jira/secure/CreateIssue!default.jspa">Report a problem</a> </li> 
     </ul> 
     <ul class="atlassian-footer"> 
      <li class="licensemessage"> Powered by a free Atlassian <a rel="nofollow" href="http://www.atlassian.com/software/jira">JIRA</a> open source license for n/a, Apache Software Foundation. Try JIRA - <a rel="nofollow" href="http://www.atlassian.com/software/jira">bug tracking software</a> for <i>your</i> team. </li> 
     </ul> 
     <div id="footer-logo">
      <a rel="nofollow" href="http://www.atlassian.com/">Atlassian</a>
     </div> 
    </section> 
    <fieldset class="hidden parameters"> 
     <input type="hidden" title="loggedInUser" value=""> 
     <input type="hidden" title="ajaxTimeout" value="The call to the JIRA server did not complete within the timeout period.  We are unsure of the result of this operation."> 
     <input type="hidden" title="JiraVersion" value="7.6.3"> 
     <input type="hidden" title="ajaxUnauthorised" value="You are not authorised to perform this operation. Please log in."> 
     <input type="hidden" title="baseURL" value="https://issues.apache.org/jira"> 
     <input type="hidden" title="ajaxCommsError" value="The JIRA server could not be contacted. This may be a temporary glitch or the server may be down. "> 
     <input type="hidden" title="ajaxServerError" value="The JIRA server was contacted but has returned an error response. We are unsure of the result of this operation."> 
     <input type="hidden" title="ajaxErrorCloseDialog" value="Close this dialog and press refresh in your browser"> 
     <input type="hidden" title="ajaxErrorDialogHeading" value="Communications Breakdown"> 
     <input type="hidden" title="dirtyMessage" value="You have entered new data on this page. If you navigate away from this page without first saving your data, the changes will be lost."> 
     <input type="hidden" title="dirtyDialogMessage" value="You have entered new data in this dialog. If you navigate away from this dialog without first saving your data, the changes will be lost. Click cancel to return to the dialog."> 
     <input type="hidden" title="keyType" value="Type"> 
     <input type="hidden" title="keyThen" value="then"> 
     <input type="hidden" title="dblClickToExpand" value="Double click to expand"> 
     <input type="hidden" title="actions" value="Actions"> 
     <input type="hidden" title="removeItem" value="Remove"> 
     <input type="hidden" title="workflow" value="Workflow"> 
     <input type="hidden" title="labelNew" value="New Label"> 
     <input type="hidden" title="issueActionsHint" value="Begin typing for available operations or press down to see all"> 
     <input type="hidden" title="closelink" value="Close"> 
     <input type="hidden" title="dotOperations" value="Operations"> 
     <input type="hidden" title="dotLoading" value="Loading..."> 
     <input type="hidden" title="frotherSuggestions" value="Suggestions"> 
     <input type="hidden" title="frotherNomatches" value="No Matches"> 
     <input type="hidden" title="multiselectVersionsError" value="{0} is not a valid version."> 
     <input type="hidden" title="multiselectComponentsError" value="{0} is not a valid component."> 
     <input type="hidden" title="multiselectGenericError" value="The value {0} is invalid."> 
    </fieldset> 
   </footer> 
  </div> 
  <script type="text/javascript" src="/jira/s/d41d8cd98f00b204e9800998ecf8427e-CDN/-juyfor/76005/1c78b578e5c0e813799ab2baea47b6f7/1.0/_/download/batch/jira.webresources:bigpipe-js/jira.webresources:bigpipe-js.js" data-wrm-key="jira.webresources:bigpipe-js" data-wrm-batch-type="resource" data-initially-rendered></script> 
  <script>
window.WRM=window.WRM||{};window.WRM._unparsedData=window.WRM._unparsedData||{};window.WRM._unparsedErrors=window.WRM._unparsedErrors||{};
WRM._unparsedData["activity-panel-pipe-id"]="\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n    \u003cdiv class=\\\"tabwrap tabs2\\\"\u003e\\n\\n        \u003cul id=\\\"issue-tabs\\\" class=\\\"tabs horizontal\\\"\u003e\\n                                \\n            \u003cli  data-id=\\\"all-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\" data-label=\\\"All\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"all-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel\\\"\u003e\u003cstrong\u003eAll\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  class=\\\"active\\\" id=\\\"comment-tabpanel\\\"  data-id=\\\"comment-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\" data-label=\\\"Comments\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel\\\"\u003e\\n                            \u003cstrong tabindex=\\\"0\\\"\u003eComments\u003c\\/strong\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"worklog-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\" data-label=\\\"Work Log\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"worklog-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:worklog-tabpanel\\\"\u003e\u003cstrong\u003eWork Log\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"changehistory-tabpanel\\\" data-key=\\\"com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\" data-label=\\\"History\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"changehistory-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.jira.plugin.system.issuetabpanels:changehistory-tabpanel\\\"\u003e\u003cstrong\u003eHistory\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"activity-stream-issue-tab\\\" data-key=\\\"com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\" data-label=\\\"Activity\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"activity-stream-issue-tab\\\" href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.atlassian.streams.streams-jira-plugin:activity-stream-issue-tab\\\"\u003e\u003cstrong\u003eActivity\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                                \\n            \u003cli  data-id=\\\"transitions-summary-tabpanel\\\" data-key=\\\"com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\" data-label=\\\"Transitions\\\" data-href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\\n                            \u003ca class=\\\"ajax-activity-content\\\" id=\\\"transitions-summary-tabpanel\\\" href=\\\"\\/jira\\/browse\\/SOLR-2894?page=com.googlecode.jira-suite-utilities:transitions-summary-tabpanel\\\"\u003e\u003cstrong\u003eTransitions\u003c\\/strong\u003e\u003c\\/a\u003e\\n                        \u003c\\/li\u003e\\n                \u003c\\/ul\u003e\\n\\n                    \u003cdiv class=\\\"sortwrap\\\"\u003e\\n                                    \u003ca class=\\\"issue-activity-sort-link ajax-activity-content\\\" rel=\\\"nofollow\\\" data-tab-sort data-order=\\\"desc\\\" href=\\\"\\/jira\\/browse\\/SOLR-2894?actionOrder=desc\\\" title=\\\"Ascending order - Click to sort in descending order\\\"\u003e\\n                        \u003cspan class=\\\"aui-icon aui-icon-small aui-iconfont-up\\\"\u003eAscending order - Click to sort in descending order\u003c\\/span\u003e\\n                    \u003c\\/a\u003e\\n                            \u003c\\/div\u003e\\n            \u003c\\/div\u003e\\n    \u003cdiv class=\\\"issuePanelWrapper\\\"\u003e\\n        \u003cdiv class=\\\"issuePanelProgress\\\"\u003e\u003c\\/div\u003e\\n        \u003cdiv class=\\\"issuePanelContainer\\\" id=\\\"issue_actions_container\\\"\u003e\\n                                    \\n\\n\\n\u003cdiv id=\\\"comment-13154368\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13154368&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13154368\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"broubicek\\\" id=\\\"commentauthor_13154368_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=broubicek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"broubicek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ben Roubicek\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13154368_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/11 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-11-21T19:00:01+0000\'\u003e21\\/Nov\\/11 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBased on \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-792\\\" title=\\\"Pivot (ie: Decision Tree) Faceting Component\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-792\\\"\u003e\u003cdel\u003eSOLR-792\u003c\\/del\u003e\u003c\\/a\u003e, it looked like there was some traction in getting distributed pivoting in the trunk codebase beyond the functional prototype.  This feature has a lot of value within my company where we perform 50 separate queries where one would suffice if we had distributed pivot support.    \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"broubicek\\\" id=\\\"commentauthor_13154368_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=broubicek\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"broubicek\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ben Roubicek\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13154368_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Nov\\/11 19:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2011-11-21T19:00:01+0000\'\u003e21\\/Nov\\/11 19:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Based on   SOLR-792  , it looked like there was some traction in getting distributed pivoting in the trunk codebase beyond the functional prototype.  This feature has a lot of value within my company where we perform 50 separate queries where one would suffice if we had distributed pivot support.                  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13190915\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13190915&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13190915\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"alefloch\\\" id=\\\"commentauthor_13190915_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=alefloch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"alefloch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Antoine Le Floc&#39;h\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13190915_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jan\\/12 08:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-23T08:02:35+0000\'\u003e23\\/Jan\\/12 08:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDo you think that this will be available for Solr 4.0 ? I would think that this is very similar to distributing regular facets ?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"alefloch\\\" id=\\\"commentauthor_13190915_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=alefloch\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"alefloch\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Antoine Le Floc&#39;h\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13190915_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jan\\/12 08:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-01-23T08:02:35+0000\'\u003e23\\/Jan\\/12 08:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Do you think that this will be available for Solr 4.0 ? I would think that this is very similar to distributing regular facets ?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13222450\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13222450&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13222450\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dcooper\\\" id=\\\"commentauthor_13222450_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dcooper\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dcooper\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dan Cooper\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13222450_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/12 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-05T17:00:26+0000\'\u003e05\\/Mar\\/12 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAdded a patch to provide distributed pivot faceting.  We\'ve been running this code for a while now and it seems to work OK, also created a unit test to test distributed pivot faceting on a small set of data.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe patch was created against Solr trunk revision 1297102.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt should perform in much the same way as single shard pivot faceting.  It only sorts by count if you specify that option otherwise it returns results in the order they were generated (may be useful is performance is important but ordering is not).  Most will want to specify facet.sort=count.  This patch also supports limiting results using facet.limit.\u003c\\/p\u003e\\n\\n\u003cp\u003eTo do the merge I\'m converting the NamedList objects that get returned by each shard in a giant map (should be more efficient for merging the results) and then converting back into a NamedList when the merge is complete.  This merge should support N depth pivots but I\'ve only properly tested a depth of 2.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve added some new parameters to support the features we require from pivot faceting and thought they may as well go in the patch in case others find them useful.\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003efacet.pivot.limit.method\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eset to \'combined\' if you want only the N number of top results to be returned across all pivots, where N is set by facet.limit. e.g. if you pivoted by country,manufacturer and limited by 5, obviously the top 5 countries would be returned, but only the top 5 manufacturers by combined total would be returned too. e.g. Each country would return the same 5 manufacturers (or less if no results).\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003efacet.pivot.limit.ignore\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eIgnores the specified field from the limiting operations. e.g. if you pivoted by country,manufacturer and limited by 5 and set facet.pivot.limit.ignore=country then you would get all available countries returned (not limited) but only 5 manufacturers for each country.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eCan someone test the patch and give some feedback?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"dcooper\\\" id=\\\"commentauthor_13222450_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=dcooper\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"dcooper\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dan Cooper\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13222450_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/12 17:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-03-05T17:00:26+0000\'\u003e05\\/Mar\\/12 17:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Added a patch to provide distributed pivot faceting.  We\'ve been running this code for a while now and it seems to work OK, also created a unit test to test distributed pivot faceting on a small set of data. \\n\\n The patch was created against Solr trunk revision 1297102. \\n\\n It should perform in much the same way as single shard pivot faceting.  It only sorts by count if you specify that option otherwise it returns results in the order they were generated (may be useful is performance is important but ordering is not).  Most will want to specify facet.sort=count.  This patch also supports limiting results using facet.limit. \\n\\n To do the merge I\'m converting the NamedList objects that get returned by each shard in a giant map (should be more efficient for merging the results) and then converting back into a NamedList when the merge is complete.  This merge should support N depth pivots but I\'ve only properly tested a depth of 2. \\n\\n I\'ve added some new parameters to support the features we require from pivot faceting and thought they may as well go in the patch in case others find them useful. \\n\\n \\n\\t facet.pivot.limit.method\\n\\t \\n\\t\\t set to \'combined\' if you want only the N number of top results to be returned across all pivots, where N is set by facet.limit. e.g. if you pivoted by country,manufacturer and limited by 5, obviously the top 5 countries would be returned, but only the top 5 manufacturers by combined total would be returned too. e.g. Each country would return the same 5 manufacturers (or less if no results). \\n\\t \\n\\t \\n \\n\\n\\n \\n\\t facet.pivot.limit.ignore\\n\\t \\n\\t\\t Ignores the specified field from the limiting operations. e.g. if you pivoted by country,manufacturer and limited by 5 and set facet.pivot.limit.ignore=country then you would get all available countries returned (not limited) but only 5 manufacturers for each country. \\n\\t \\n\\t \\n \\n\\n\\n Can someone test the patch and give some feedback?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13259947\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13259947&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13259947\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13259947_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13259947_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/12 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-23T20:57:41+0000\'\u003e23\\/Apr\\/12 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 23\\/Apr\\/12 21:05\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Dan.\u003cbr\\/\u003e\\nI have been working with your patch, 2894, to Solr and I am having some issues with unit testing.\u003c\\/p\u003e\\n\\n\u003cp\u003eFirst of all the patch doesn\'t seem to apply cleanly:\u003cbr\\/\u003e\\ncrussell@WAT-CRUSSELL \\/cygdrive\\/d\\/matrixdev\\/solr_1297102\\/CBSolr\\/SolrLucene\u003cbr\\/\u003e\\n$ patch -p0 -i \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e.patch\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/EntryCountComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java\u003cbr\\/\u003e\\nHunk #10 FAILED at 797.\u003cbr\\/\u003e\\n1 out of 16 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java.rej\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java\u003cbr\\/\u003e\\nHunk #2 FAILED at 106.\u003cbr\\/\u003e\\n1 out of 2 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java.rej\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotNamedListCountComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/NamedListHelper.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/PivotListEntry.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/handler\\/component\\/DistributedFacetPivotTest.java\u003cbr\\/\u003e\\npatching file solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/common\\/params\\/FacetParams.java\u003cbr\\/\u003e\\n$ patch --version\u003cbr\\/\u003e\\npatch 2.5.8\u003cbr\\/\u003e\\nCopyright (C) 1988 Larry Wall\u003cbr\\/\u003e\\nCopyright (C) 2002 Free Software Foundation, Inc.\u003c\\/p\u003e\\n\\n\u003cp\u003eA lot of the contents of your original patch seemed to be formatting changes like where line breaks should go and how spacing should be handled.\u003cbr\\/\u003e\\nI was able to examine the patch and manually incorporate the changes from the failed chunks.\u003cbr\\/\u003e\\nOne question, on this line (1119) of your patch, why did you choose not to initialize the map as the ones above it are? Couldn\'t that cause an NRE?\u003cbr\\/\u003e\\n+    public SimpleOrderedMap&lt;List&lt;NamedList&lt;Object&gt;&gt;&gt; pivotFacets;\u003c\\/p\u003e\\n\\n\u003cp\u003eWhile looking at DistributedFacetPivotTest.java I noticed an error on line 42.  Your \\\"q\\\" should probably be \\\"\u003cb\u003e:\u003c\\/b\u003e\\\" instead of \\\"*\\\". Edit: asterisk colon asterisk instead of just asterisk.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve attached the patch file I came up with.  I added the initialization and test correction I mentioned.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen I ran the solr\\/lucene unit tests after I patched, there are some unit test failures like this one:\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Testsuite: org.apache.solr.TestDistributedGrouping\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Testcase: testDistribSearch(org.apache.solr.TestDistributedGrouping):       FAILED\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e .facet_counts.size()==5,4skipped=0,0\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e junit.framework.AssertionFailedError: .facet_counts.size()==5,4skipped=0,0\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.solr.BaseDistributedSearchTestCase.compareResponses(BaseDistributedSearchTestCase.java:656)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.solr.BaseDistributedSearchTestCase.query(BaseDistributedSearchTestCase.java:383)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.solr.TestDistributedGrouping.doTest(TestDistributedGrouping.java:51)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:671)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:20)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.LuceneTestCase$SubclassSetupTeardownRule$1.evaluate(LuceneTestCase.java:736)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.LuceneTestCase$InternalSetupTeardownRule$1.evaluate(LuceneTestCase.java:632)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:22)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.LuceneTestCase$TestResultInterceptorRule$1.evaluate(LuceneTestCase.java:531)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.LuceneTestCase$RememberThreadRule$1.evaluate(LuceneTestCase.java:593)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:165)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:57)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:20)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     at org.apache.lucene.util.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:22)\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 2.685 sec\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e ------------- Standard Error -----------------\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e 2520 T1 oas.BaseDistributedSearchTestCase.compareResponses SEVERE Mismatched responses:\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     {responseHeader=\u003c\\/p\u003e\\n{status=0,QTime=19}\\n\u003cp\u003e,grouped={a_si={matches=0,groups=[]}},facet_counts={facet_queries={},facet_fields={a_t={}},facet_dates={},facet_ranges={},facet_pivot={}}}\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e     {responseHeader=\u003c\\/p\u003e\\n{status=0,QTime=18}\\n\u003cp\u003e,grouped={a_si={matches=0,groups=[]}},facet_counts={facet_queries={},facet_fields={a_t={}},facet_dates={},facet_ranges={}}}\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;junit&#93;\u003c\\/span\u003e NOTE: reproduce with: ant test -Dtestcase=TestDistributedGrouping -Dtestmethod=testDistribSearch -Dtests.seed=-c7cfa73dbca93c9:-4751af558bf6f59:3e523b50870b3b1b -Dargs=\\\"-Dfile.encoding=Cp1252\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eIt looks like the facet_pivot is being included in the results of one query, and not the other.  I\'m trying to figure out why this is occurring.\u003cbr\\/\u003e\\nAny insight would be appreciated.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13259947_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13259947_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/12 20:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-23T20:57:41+0000\'\u003e23\\/Apr\\/12 20:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 23\\/Apr\\/12 21:05\\\"\u003eedited\u003c\\/span\u003e                   Hi Dan. \\nI have been working with your patch, 2894, to Solr and I am having some issues with unit testing. \\n\\n First of all the patch doesn\'t seem to apply cleanly: \\ncrussell@WAT-CRUSSELL \\/cygdrive\\/d\\/matrixdev\\/solr_1297102\\/CBSolr\\/SolrLucene \\n$ patch -p0 -i   SOLR-2894  .patch \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/EntryCountComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java \\nHunk #10 FAILED at 797. \\n1 out of 16 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java.rej \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java \\nHunk #2 FAILED at 106. \\n1 out of 2 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java.rej \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotNamedListCountComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/NamedListHelper.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/PivotListEntry.java \\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/handler\\/component\\/DistributedFacetPivotTest.java \\npatching file solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/common\\/params\\/FacetParams.java \\n$ patch --version \\npatch 2.5.8 \\nCopyright (C) 1988 Larry Wall \\nCopyright (C) 2002 Free Software Foundation, Inc. \\n\\n A lot of the contents of your original patch seemed to be formatting changes like where line breaks should go and how spacing should be handled. \\nI was able to examine the patch and manually incorporate the changes from the failed chunks. \\nOne question, on this line (1119) of your patch, why did you choose not to initialize the map as the ones above it are? Couldn\'t that cause an NRE? \\n+    public SimpleOrderedMap&lt;List&lt;NamedList&lt;Object&gt;&gt;&gt; pivotFacets; \\n\\n While looking at DistributedFacetPivotTest.java I noticed an error on line 42.  Your \\\"q\\\" should probably be \\\" : \\\" instead of \\\"*\\\". Edit: asterisk colon asterisk instead of just asterisk. \\n\\n I\'ve attached the patch file I came up with.  I added the initialization and test correction I mentioned. \\n\\n When I ran the solr\\/lucene unit tests after I patched, there are some unit test failures like this one: \\n     &#91;junit&#93;  Testsuite: org.apache.solr.TestDistributedGrouping \\n     &#91;junit&#93;  Testcase: testDistribSearch(org.apache.solr.TestDistributedGrouping):       FAILED \\n     &#91;junit&#93;  .facet_counts.size()==5,4skipped=0,0 \\n     &#91;junit&#93;  junit.framework.AssertionFailedError: .facet_counts.size()==5,4skipped=0,0 \\n     &#91;junit&#93;      at org.apache.solr.BaseDistributedSearchTestCase.compareResponses(BaseDistributedSearchTestCase.java:656) \\n     &#91;junit&#93;      at org.apache.solr.BaseDistributedSearchTestCase.query(BaseDistributedSearchTestCase.java:383) \\n     &#91;junit&#93;      at org.apache.solr.TestDistributedGrouping.doTest(TestDistributedGrouping.java:51) \\n     &#91;junit&#93;      at org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:671) \\n     &#91;junit&#93;      at org.apache.lucene.util.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:20) \\n     &#91;junit&#93;      at org.apache.lucene.util.LuceneTestCase$SubclassSetupTeardownRule$1.evaluate(LuceneTestCase.java:736) \\n     &#91;junit&#93;      at org.apache.lucene.util.LuceneTestCase$InternalSetupTeardownRule$1.evaluate(LuceneTestCase.java:632) \\n     &#91;junit&#93;      at org.apache.lucene.util.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:22) \\n     &#91;junit&#93;      at org.apache.lucene.util.LuceneTestCase$TestResultInterceptorRule$1.evaluate(LuceneTestCase.java:531) \\n     &#91;junit&#93;      at org.apache.lucene.util.LuceneTestCase$RememberThreadRule$1.evaluate(LuceneTestCase.java:593) \\n     &#91;junit&#93;      at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:165) \\n     &#91;junit&#93;      at org.apache.lucene.util.LuceneTestCaseRunner.runChild(LuceneTestCaseRunner.java:57) \\n     &#91;junit&#93;      at org.apache.lucene.util.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:20) \\n     &#91;junit&#93;      at org.apache.lucene.util.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:22) \\n     &#91;junit&#93;  \\n     &#91;junit&#93;  \\n     &#91;junit&#93;  Tests run: 1, Failures: 1, Errors: 0, Time elapsed: 2.685 sec \\n     &#91;junit&#93;  \\n     &#91;junit&#93;  ------------- Standard Error ----------------- \\n     &#91;junit&#93;  2520 T1 oas.BaseDistributedSearchTestCase.compareResponses SEVERE Mismatched responses: \\n     &#91;junit&#93;      {responseHeader= \\n{status=0,QTime=19}\\n ,grouped={a_si={matches=0,groups=[]}},facet_counts={facet_queries={},facet_fields={a_t={}},facet_dates={},facet_ranges={},facet_pivot={}}} \\n     &#91;junit&#93;      {responseHeader= \\n{status=0,QTime=18}\\n ,grouped={a_si={matches=0,groups=[]}},facet_counts={facet_queries={},facet_fields={a_t={}},facet_dates={},facet_ranges={}}} \\n     &#91;junit&#93;  NOTE: reproduce with: ant test -Dtestcase=TestDistributedGrouping -Dtestmethod=testDistribSearch -Dtests.seed=-c7cfa73dbca93c9:-4751af558bf6f59:3e523b50870b3b1b -Dargs=\\\"-Dfile.encoding=Cp1252\\\" \\n\\n It looks like the facet_pivot is being included in the results of one query, and not the other.  I\'m trying to figure out why this is occurring. \\nAny insight would be appreciated.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13259949\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13259949&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13259949\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13259949_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13259949_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/12 20:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-23T20:59:46+0000\'\u003e23\\/Apr\\/12 20:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSome modifications to \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e.patch that I made while trying to get it to patch on rev 1297102.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13259949_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13259949_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/12 20:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-23T20:59:46+0000\'\u003e23\\/Apr\\/12 20:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Some modifications to   SOLR-2894  .patch that I made while trying to get it to patch on rev 1297102.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13260994\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13260994&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13260994\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13260994_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13260994_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/12 20:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-24T20:41:00+0000\'\u003e24\\/Apr\\/12 20:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI figured out the unit test.  It\'s because facet_pivot is different from the other facet_blah in that it only comes back when you request pivots, whereas the others always come back.  In Dan\'s patch he had facet_pivot coming back even when it was empty or not requested, and this did not match the behavior of pivots in a non-distributed setting.  I am working on an update to my patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13260994_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13260994_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/12 20:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-24T20:41:00+0000\'\u003e24\\/Apr\\/12 20:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I figured out the unit test.  It\'s because facet_pivot is different from the other facet_blah in that it only comes back when you request pivots, whereas the others always come back.  In Dan\'s patch he had facet_pivot coming back even when it was empty or not requested, and this did not match the behavior of pivots in a non-distributed setting.  I am working on an update to my patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13261300\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13261300&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13261300\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13261300_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13261300_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/12 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-25T05:08:07+0000\'\u003e25\\/Apr\\/12 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003efacet_pivot will not show up in distrib search if no contents, reversed behavior of sorting to comply with solr standard for facet.sort\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13261300_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13261300_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/12 05:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-04-25T05:08:07+0000\'\u003e25\\/Apr\\/12 05:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    facet_pivot will not show up in distrib search if no contents, reversed behavior of sorting to comply with solr standard for facet.sort              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13294737\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13294737&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13294737\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13294737_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13294737_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jun\\/12 23:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-13T23:55:55+0000\'\u003e13\\/Jun\\/12 23:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eErik: Can you triage this for 4.0? commit if you think it\'s ready, otherwise remove the fix version?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13294737_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13294737_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jun\\/12 23:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-13T23:55:55+0000\'\u003e13\\/Jun\\/12 23:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Erik: Can you triage this for 4.0? commit if you think it\'s ready, otherwise remove the fix version?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13294795\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13294795&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13294795\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13294795_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13294795_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 03:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T03:50:06+0000\'\u003e14\\/Jun\\/12 03:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFor what it\'s worth, we\'re actively using the April 25th version of this patch in production at CareerBuilder (with an older version of trunk) with no issues.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13294795_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13294795_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 03:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T03:50:06+0000\'\u003e14\\/Jun\\/12 03:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    For what it\'s worth, we\'re actively using the April 25th version of this patch in production at CareerBuilder (with an older version of trunk) with no issues.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295026\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13295026&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295026\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295026_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295026_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 13:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T13:37:51+0000\'\u003e14\\/Jun\\/12 13:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTrey - thanks for the positive feedback.  I\'ll apply the patch, run the tests, review the code, and so on.   Might be a couple of weeks, unless I can get to this today.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295026_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295026_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 13:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T13:37:51+0000\'\u003e14\\/Jun\\/12 13:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Trey - thanks for the positive feedback.  I\'ll apply the patch, run the tests, review the code, and so on.   Might be a couple of weeks, unless I can get to this today.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295257\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13295257&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295257\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295257_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295257_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T19:35:06+0000\'\u003e14\\/Jun\\/12 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ePatch updated to 4x branch.\u003c\\/p\u003e\\n\\n\u003cp\u003eSimon, just for you, I removed NamedListHelper as well \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  (folded its one method into PivotFacetHelper)\u003c\\/p\u003e\\n\\n\u003cp\u003eTests pass.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295257_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295257_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T19:35:06+0000\'\u003e14\\/Jun\\/12 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Patch updated to 4x branch. \\n\\n Simon, just for you, I removed NamedListHelper as well    (folded its one method into PivotFacetHelper) \\n\\n Tests pass.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295261\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13295261&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295261\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295261_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295261_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T19:40:18+0000\'\u003e14\\/Jun\\/12 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTrey - would you be in a position to test out the latest patch?   I built my latest one by starting with the March 5, 2012 \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e.patch file.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295261_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295261_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T19:40:18+0000\'\u003e14\\/Jun\\/12 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Trey - would you be in a position to test out the latest patch?   I built my latest one by starting with the March 5, 2012   SOLR-2894  .patch file.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295389\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13295389&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295389\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13295389_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295389_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T23:49:45+0000\'\u003e14\\/Jun\\/12 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eErik, what revision of solr did you apply the patch to? Did you not encounter the issues I encountered?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13295389_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295389_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jun\\/12 23:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-14T23:49:45+0000\'\u003e14\\/Jun\\/12 23:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Erik, what revision of solr did you apply the patch to? Did you not encounter the issues I encountered?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295426\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13295426&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295426\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13295426_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295426_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/12 02:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-15T02:21:16+0000\'\u003e15\\/Jun\\/12 02:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eErik, I can\'t get your patch to apply cleanly to solr 1350445\u003c\\/p\u003e\\n\\n\u003cp\u003e$ patch -p0 -i \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e.patch\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/handler\\/component\\/DistributedFacetPivotTest.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/EntryCountComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotNamedListCountComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java\u003cbr\\/\u003e\\nHunk #2 FAILED at 103.\u003cbr\\/\u003e\\n1 out of 2 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java.rej\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java\u003cbr\\/\u003e\\nHunk #11 FAILED at 799.\u003cbr\\/\u003e\\n1 out of 17 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java.rej\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/PivotListEntry.java\u003cbr\\/\u003e\\npatching file solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/common\\/params\\/FacetParams.java\u003cbr\\/\u003e\\npatching file solr\\/test-framework\\/src\\/java\\/org\\/apache\\/solr\\/BaseDistributedSearchTestCase.java\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13295426_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295426_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/12 02:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-15T02:21:16+0000\'\u003e15\\/Jun\\/12 02:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Erik, I can\'t get your patch to apply cleanly to solr 1350445 \\n\\n $ patch -p0 -i   SOLR-2894  .patch \\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/handler\\/component\\/DistributedFacetPivotTest.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/EntryCountComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotNamedListCountComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java \\nHunk #2 FAILED at 103. \\n1 out of 2 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java.rej \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java \\nHunk #11 FAILED at 799. \\n1 out of 17 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java.rej \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/PivotListEntry.java \\npatching file solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/common\\/params\\/FacetParams.java \\npatching file solr\\/test-framework\\/src\\/java\\/org\\/apache\\/solr\\/BaseDistributedSearchTestCase.java              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13295608\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13295608&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13295608\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295608_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295608_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/12 11:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-15T11:58:40+0000\'\u003e15\\/Jun\\/12 11:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eChris - I generated the patch from an r1350348 checkout (which is not branch_4x as I mentioned above).  It might be a couple of weeks before I can get back to this and sort it out though, unfortunately.  Sorry.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13295608_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13295608_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/12 11:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-15T11:58:40+0000\'\u003e15\\/Jun\\/12 11:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Chris - I generated the patch from an r1350348 checkout (which is not branch_4x as I mentioned above).  It might be a couple of weeks before I can get back to this and sort it out though, unfortunately.  Sorry.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13403341\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13403341&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13403341\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13403341_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403341_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 18:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T18:33:08+0000\'\u003e28\\/Jun\\/12 18:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have posted an enhancement to this patch as \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-3583\\\" title=\\\"Percentiles for facets, pivot facets, and distributed pivot facets\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-3583\\\"\u003e\u003cdel\u003eSOLR-3583\u003c\\/del\u003e\u003c\\/a\u003e.  It is based on the Apr 25th version.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13403341_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13403341_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Jun\\/12 18:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-06-28T18:33:08+0000\'\u003e28\\/Jun\\/12 18:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have posted an enhancement to this patch as   SOLR-3583  .  It is based on the Apr 25th version.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13407459\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13407459&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13407459\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13407459_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13407459_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/12 20:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-05T20:31:53+0000\'\u003e05\\/Jul\\/12 20:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Erik,\u003c\\/p\u003e\\n\\n\u003cp\u003eSorry, I missed your original message asking me if I could test out the latest patch - I\'d be happy to help.  I just tried both your patch and the April 25th patch against the Solr 4.0 Alpha revision and neither applied immediately.  I\'ll see if I can find some time on Sunday to try to get a revision sorted out which will work with the current version.\u003c\\/p\u003e\\n\\n\u003cp\u003eI think there are some changes in the April 24th patch which may need to be re-applied if your changes were based upon the earlier patch.  I\'ll know more once I\'ve had a chance to dig in later this weekend.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks,\u003c\\/p\u003e\\n\\n\u003cp\u003e-Trey\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13407459_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13407459_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Jul\\/12 20:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-05T20:31:53+0000\'\u003e05\\/Jul\\/12 20:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Erik, \\n\\n Sorry, I missed your original message asking me if I could test out the latest patch - I\'d be happy to help.  I just tried both your patch and the April 25th patch against the Solr 4.0 Alpha revision and neither applied immediately.  I\'ll see if I can find some time on Sunday to try to get a revision sorted out which will work with the current version. \\n\\n I think there are some changes in the April 24th patch which may need to be re-applied if your changes were based upon the earlier patch.  I\'ll know more once I\'ve had a chance to dig in later this weekend. \\n\\n Thanks, \\n\\n -Trey              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13412175\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13412175&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13412175\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412175_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412175_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T22:26:14+0000\'\u003e11\\/Jul\\/12 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ebulk fixing the version info for 4.0-ALPHA and 4.0 all affected issues have \\\"hoss20120711-bulk-40-change\\\" in comment\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13412175_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13412175_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jul\\/12 22:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-11T22:26:14+0000\'\u003e11\\/Jul\\/12 22:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    bulk fixing the version info for 4.0-ALPHA and 4.0 all affected issues have \\\"hoss20120711-bulk-40-change\\\" in comment              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13421409\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13421409&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13421409\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13421409_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13421409_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/12 13:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-24T13:43:58+0000\'\u003e24\\/Jul\\/12 13:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNo way I\'m getting to this any time soon, sorry.  Trey - feel free to prod this one forward with more testing\\/feedback.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ehatcher\\\" id=\\\"commentauthor_13421409_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ehatcher\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Erik Hatcher\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13421409_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/12 13:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-24T13:43:58+0000\'\u003e24\\/Jul\\/12 13:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    No way I\'m getting to this any time soon, sorry.  Trey - feel free to prod this one forward with more testing\\/feedback.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13425338\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13425338&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13425338\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"zmitrok\\\" id=\\\"commentauthor_13425338_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=zmitrok\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"zmitrok\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dzmitry Zhemchuhou\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13425338_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/12 22:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-30T22:46:01+0000\'\u003e30\\/Jul\\/12 22:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have reapplied the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e patch from Jun 14th to the trunk while removing most of code formatting changes that were in it. On top of that I changed the FacetComponent.refineFacets() method to add facet_pivot key-value only when there are values in the pivotFacets map, which fixes distributed search unit tests. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"zmitrok\\\" id=\\\"commentauthor_13425338_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=zmitrok\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"zmitrok\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Dzmitry Zhemchuhou\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13425338_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/Jul\\/12 22:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-07-30T22:46:01+0000\'\u003e30\\/Jul\\/12 22:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have reapplied the   SOLR-2894   patch from Jun 14th to the trunk while removing most of code formatting changes that were in it. On top of that I changed the FacetComponent.refineFacets() method to add facet_pivot key-value only when there are values in the pivotFacets map, which fixes distributed search unit tests.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13429829\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13429829&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13429829\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13429829_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13429829_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 03:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T03:43:26+0000\'\u003e07\\/Aug\\/12 03:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003ermuir20120906-bulk-40-change\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13429829_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13429829_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/12 03:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-08-07T03:43:26+0000\'\u003e07\\/Aug\\/12 03:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    rmuir20120906-bulk-40-change              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13452196\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13452196&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13452196\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13452196_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13452196_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Sep\\/12 17:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-10T17:41:57+0000\'\u003e10\\/Sep\\/12 17:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003emoving all 4.0 issues not touched in a month to 4.1\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"rcmuir\\\" id=\\\"commentauthor_13452196_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=rcmuir\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"rcmuir\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Robert Muir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13452196_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Sep\\/12 17:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-10T17:41:57+0000\'\u003e10\\/Sep\\/12 17:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    moving all 4.0 issues not touched in a month to 4.1              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13455182\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13455182&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13455182\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13455182_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13455182_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/12 19:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-13T19:59:13+0000\'\u003e13\\/Sep\\/12 19:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 23\\/Oct\\/12 21:45\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eRegarding facet.pivot.limit.method and facet.limit, it looks like these are not checked on a per-field basis?\u003cbr\\/\u003e\\nSo, if a user sets different limits for different fields and wants \'combined\' limiting, that is not possible?\u003cbr\\/\u003e\\nFor example a user might set:\u003c\\/p\u003e\\n\\n\u003cp\u003ef.field1.facet.limit=10\u003cbr\\/\u003e\\nf.field1.facet.pivot.limit.method=combined\u003cbr\\/\u003e\\nf.field2.facet.limit=20 \u003c\\/p\u003e\\n\\n\u003cp\u003eAnd the combined method will not be used...\u003cbr\\/\u003e\\nIf the user sets facet.pivot.limit.method=combined it looks like the same limit will be used for all fields?  Whatever the global facet.limit is set to?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13455182_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13455182_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Sep\\/12 19:59\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-09-13T19:59:13+0000\'\u003e13\\/Sep\\/12 19:59\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 23\\/Oct\\/12 21:45\\\"\u003eedited\u003c\\/span\u003e                   Regarding facet.pivot.limit.method and facet.limit, it looks like these are not checked on a per-field basis? \\nSo, if a user sets different limits for different fields and wants \'combined\' limiting, that is not possible? \\nFor example a user might set: \\n\\n f.field1.facet.limit=10 \\nf.field1.facet.pivot.limit.method=combined \\nf.field2.facet.limit=20  \\n\\n And the combined method will not be used... \\nIf the user sets facet.pivot.limit.method=combined it looks like the same limit will be used for all fields?  Whatever the global facet.limit is set to?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13482734\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13482734&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13482734\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13482734_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13482734_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/12 21:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-10-23T21:50:56+0000\'\u003e23\\/Oct\\/12 21:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn my experience using this patch, it seems that it does not over-request when enforcing a limit?\u003cbr\\/\u003e\\nThis is problematic because, for example, in a situation where you have many slaves and you are pivoting on a fairly evenly distributed field and setting your facet limit to X, the Xth distinct value for that field by document count on each slave is likely to be different.  The result is that some facet values close to your limit boundary will not get reported for aggregation, which will make your ultimate results somewhat inaccurate.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt was my impression that other facet-based features of solr over-request when there is a limit to combat this situation?  For example if you specify limit 10, the distributed query might have limit 100 or 1000, and then during aggregation it would be limited to the top 10.\u003c\\/p\u003e\\n\\n\u003cp\u003eI am working on similar functionality for this patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13482734_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13482734_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Oct\\/12 21:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-10-23T21:50:56+0000\'\u003e23\\/Oct\\/12 21:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    In my experience using this patch, it seems that it does not over-request when enforcing a limit? \\nThis is problematic because, for example, in a situation where you have many slaves and you are pivoting on a fairly evenly distributed field and setting your facet limit to X, the Xth distinct value for that field by document count on each slave is likely to be different.  The result is that some facet values close to your limit boundary will not get reported for aggregation, which will make your ultimate results somewhat inaccurate. \\n\\n It was my impression that other facet-based features of solr over-request when there is a limit to combat this situation?  For example if you specify limit 10, the distributed query might have limit 100 or 1000, and then during aggregation it would be limited to the top 10. \\n\\n I am working on similar functionality for this patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13492619\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13492619&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13492619\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13492619_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13492619_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/12 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-07T19:29:52+0000\'\u003e07\\/Nov\\/12 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIn regards to my above comment, I have determined that it is because if you specify a limit for a field that you are not requesting facet counts for, solr will not automatically over-request on that field.  \u003cbr\\/\u003e\\ni.e.\u003cbr\\/\u003e\\nfacet.pivot=somefield\u003cbr\\/\u003e\\nf.somefield.facet.limit=10\u003c\\/p\u003e\\n\\n\u003cp\u003eThis will make your pivots weird because the limit of 10 will not be over requested unless you add this line:\u003cbr\\/\u003e\\nfacet.field=somefield\u003c\\/p\u003e\\n\\n\u003cp\u003eSince solr does not do distributed pivoting yet, this has not been an issue yet.\u003cbr\\/\u003e\\nI am working on an update to the patch that will correct this issue.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13492619_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13492619_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/12 19:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-07T19:29:52+0000\'\u003e07\\/Nov\\/12 19:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    In regards to my above comment, I have determined that it is because if you specify a limit for a field that you are not requesting facet counts for, solr will not automatically over-request on that field.   \\ni.e. \\nfacet.pivot=somefield \\nf.somefield.facet.limit=10 \\n\\n This will make your pivots weird because the limit of 10 will not be over requested unless you add this line: \\nfacet.field=somefield \\n\\n Since solr does not do distributed pivoting yet, this has not been an issue yet. \\nI am working on an update to the patch that will correct this issue.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13495296\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13495296&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13495296\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13495296_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13495296_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/12 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-12T14:39:48+0000\'\u003e12\\/Nov\\/12 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 12\\/Nov\\/12 15:10\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eUpdated to apply to trunk 1404975. (Based on Dzmitry\'s update)\u003c\\/p\u003e\\n\\n\u003cp\u003eAdded ability to limit on individual fields. (f.fieldname.facet.limit)\u003cbr\\/\u003e\\nAdded pivot fields to fields being over-requested during distributed queries.\u003cbr\\/\u003e\\nMade it so you can pivot on a single field.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13495296_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13495296_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Nov\\/12 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-11-12T14:39:48+0000\'\u003e12\\/Nov\\/12 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 12\\/Nov\\/12 15:10\\\"\u003eedited\u003c\\/span\u003e                   Updated to apply to trunk 1404975. (Based on Dzmitry\'s update) \\n\\n Added ability to limit on individual fields. (f.fieldname.facet.limit) \\nAdded pivot fields to fields being over-requested during distributed queries. \\nMade it so you can pivot on a single field.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13527907\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13527907&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13527907\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13527907_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527907_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/12 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-10T12:32:25+0000\'\u003e10\\/Dec\\/12 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eJust thought I\'d add some feedback on this valuable patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI run some tests with the latest patch (Nov. 12) and the limit-per-field feature seems to be working alright. (Nice job Chris!)\u003c\\/p\u003e\\n\\n\u003cp\u003eI did, however, encounter 2 other issues (which I guess are related):\u003cbr\\/\u003e\\n(1) There\'s no default sorting method. i.e. if no facet.sort is specified then results are not sorted. (this is a deviation from the current non-distributed pivot faceting behavior)\u003cbr\\/\u003e\\n(2) Sorting per-field does not work. (i.e. f.&lt;field&gt;.facet.sort=&lt;method&gt; does not work)\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13527907_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13527907_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Dec\\/12 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-10T12:32:25+0000\'\u003e10\\/Dec\\/12 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Just thought I\'d add some feedback on this valuable patch. \\n\\n I run some tests with the latest patch (Nov. 12) and the limit-per-field feature seems to be working alright. (Nice job Chris!) \\n\\n I did, however, encounter 2 other issues (which I guess are related): \\n(1) There\'s no default sorting method. i.e. if no facet.sort is specified then results are not sorted. (this is a deviation from the current non-distributed pivot faceting behavior) \\n(2) Sorting per-field does not work. (i.e. f.&lt;field&gt;.facet.sort=&lt;method&gt; does not work)              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13534219\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13534219&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13534219\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13534219_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13534219_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/12 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-17T19:43:38+0000\'\u003e17\\/Dec\\/12 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Shahar.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn regard to #1, there is (count) and there are tests that cover that in DistributedFacetPivotTest.java.  Are you sure the patch applied correctly to your version of solr?\u003c\\/p\u003e\\n\\n\u003cp\u003eIn regard to #2, that is correct.  Does per field sorting work with non-distributed pivots?  I guess it was never implemented by the original author.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13534219_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13534219_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Dec\\/12 19:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-17T19:43:38+0000\'\u003e17\\/Dec\\/12 19:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Shahar. \\n\\n In regard to #1, there is (count) and there are tests that cover that in DistributedFacetPivotTest.java.  Are you sure the patch applied correctly to your version of solr? \\n\\n In regard to #2, that is correct.  Does per field sorting work with non-distributed pivots?  I guess it was never implemented by the original author.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13535829\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13535829&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13535829\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13535829_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13535829_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/12 10:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-19T10:00:38+0000\'\u003e19\\/Dec\\/12 10:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Chris,\u003c\\/p\u003e\\n\\n\u003cp\u003e#1 Yes, I believe the patch applied correctly. Once more, \u003cb\u003edefault\u003c\\/b\u003e sorting method is not defined and I didn\'t see where DistributedFacetPivotTest is testing the default sort. (I did however see where facet.sort is tested after facet.sort=count was explicitly specified).\u003cbr\\/\u003e\\n#2 Yes, Per field sorting works with non-distributed pivots. We were working in a non-distributed configuration up to some point and, until then, per field sorting worked properly (that was on Solr 4.0)\u003c\\/p\u003e\\n\\n\u003cp\u003eWe also encountered another issue when sorting by count:\u003cbr\\/\u003e\\nThere might be a case where 2 of the returned values have the same count. In such a case, the PivotNamedListCountComparator attempts to sort by value. The problem is that when facet.missing=true is specified then one of the 2 values which have the same count may be null (missing) and in such cases the get(\\\"value\\\").toString() operation will fail (NullPointerException).\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13535829_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13535829_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Dec\\/12 10:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-19T10:00:38+0000\'\u003e19\\/Dec\\/12 10:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Chris, \\n\\n #1 Yes, I believe the patch applied correctly. Once more,  default  sorting method is not defined and I didn\'t see where DistributedFacetPivotTest is testing the default sort. (I did however see where facet.sort is tested after facet.sort=count was explicitly specified). \\n#2 Yes, Per field sorting works with non-distributed pivots. We were working in a non-distributed configuration up to some point and, until then, per field sorting worked properly (that was on Solr 4.0) \\n\\n We also encountered another issue when sorting by count: \\nThere might be a case where 2 of the returned values have the same count. In such a case, the PivotNamedListCountComparator attempts to sort by value. The problem is that when facet.missing=true is specified then one of the 2 values which have the same count may be null (missing) and in such cases the get(\\\"value\\\").toString() operation will fail (NullPointerException).              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13537333\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13537333&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13537333\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13537333_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13537333_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/12 20:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-20T20:08:10+0000\'\u003e20\\/Dec\\/12 20:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eImplemented default pivot facet sort.\u003cbr\\/\u003e\\nImplemented per-field pivot facet sorting.\u003cbr\\/\u003e\\nFixed NRE with sorting when facet.missing is on.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13537333_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13537333_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/12 20:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-20T20:08:10+0000\'\u003e20\\/Dec\\/12 20:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Implemented default pivot facet sort. \\nImplemented per-field pivot facet sorting. \\nFixed NRE with sorting when facet.missing is on.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13537334\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13537334&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13537334\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13537334_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13537334_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/12 20:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-20T20:08:20+0000\'\u003e20\\/Dec\\/12 20:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShahar, I have corrected the issues that you mentioned, I believe.\u003cbr\\/\u003e\\nDefault sorting is now count if a facet limit exists, otherwise index.\u003cbr\\/\u003e\\nI fixed the facet.missing stuff, and I went with the sorting convention that the rest of solr seems to have which is that null values always go to the bottom of the list.\u003c\\/p\u003e\\n\\n\u003cp\u003eTry the new patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13537334_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13537334_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Dec\\/12 20:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-20T20:08:20+0000\'\u003e20\\/Dec\\/12 20:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Shahar, I have corrected the issues that you mentioned, I believe. \\nDefault sorting is now count if a facet limit exists, otherwise index. \\nI fixed the facet.missing stuff, and I went with the sorting convention that the rest of solr seems to have which is that null values always go to the bottom of the list. \\n\\n Try the new patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13539395\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13539395&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13539395\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13539395_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13539395_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Dec\\/12 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-25T12:32:47+0000\'\u003e25\\/Dec\\/12 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Chris,\u003c\\/p\u003e\\n\\n\u003cp\u003eI appreciate your efforts on this.\u003cbr\\/\u003e\\nI tried the new patch and run into numerous NPEs and didn\'t get to verify the sorting.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s what I\'m getting:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eSEVERE: null:java.lang.NullPointerException\\n        at java.util.TreeMap.compare(TreeMap.java:1188)\\n        at java.util.TreeMap.put(TreeMap.java:531)\\n        at org.apache.solr.handler.component.PivotFacetHelper.convertPivotsToMaps(PivotFacetHelper.java:317)\\n        at org.apache.solr.handler.component.FacetComponent.countFacets(FacetComponent.java:542)\\n        at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:336)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:309)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1830)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:455)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:276)\\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337) \\n        ....\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAnd also:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003eSEVERE: null:java.lang.NullPointerException\\n        at java.util.TreeMap.getEntry(TreeMap.java:342)\\n        at java.util.TreeMap.get(TreeMap.java:273)\\n        at org.apache.solr.handler.component.FacetComponent.mergePivotFacet(FacetComponent.java:692)\\n        at org.apache.solr.handler.component.FacetComponent.countFacets(FacetComponent.java:552)\\n        at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:336)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:309)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1830)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:455)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:276)\\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337)\\n        ....\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eSince I couldn\'t get to test the sorting fix, I peaked at the PivotNamedListCountComparator fix and I believe it will sort the \\\"null\\\" values on top (due to the return values of handleSortWhenOneValueIsNull) and regardless of the count number (due to the fact that the null values are checked before comparing the counts) - correct me if I\'m wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003eAppreciate your help with this,\u003c\\/p\u003e\\n\\n\u003cp\u003eShahar.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13539395_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13539395_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Dec\\/12 12:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-25T12:32:47+0000\'\u003e25\\/Dec\\/12 12:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Chris, \\n\\n I appreciate your efforts on this. \\nI tried the new patch and run into numerous NPEs and didn\'t get to verify the sorting. \\n\\n Here\'s what I\'m getting: \\n  \\n SEVERE: null:java.lang.NullPointerException\\n        at java.util.TreeMap.compare(TreeMap.java:1188)\\n        at java.util.TreeMap.put(TreeMap.java:531)\\n        at org.apache.solr.handler.component.PivotFacetHelper.convertPivotsToMaps(PivotFacetHelper.java:317)\\n        at org.apache.solr.handler.component.FacetComponent.countFacets(FacetComponent.java:542)\\n        at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:336)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:309)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1830)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:455)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:276)\\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337) \\n        ....\\n \\n  \\n\\n And also: \\n  \\n SEVERE: null:java.lang.NullPointerException\\n        at java.util.TreeMap.getEntry(TreeMap.java:342)\\n        at java.util.TreeMap.get(TreeMap.java:273)\\n        at org.apache.solr.handler.component.FacetComponent.mergePivotFacet(FacetComponent.java:692)\\n        at org.apache.solr.handler.component.FacetComponent.countFacets(FacetComponent.java:552)\\n        at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:336)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:309)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:144)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1830)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:455)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:276)\\n        at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1337)\\n        ....\\n \\n  \\n\\n Since I couldn\'t get to test the sorting fix, I peaked at the PivotNamedListCountComparator fix and I believe it will sort the \\\"null\\\" values on top (due to the return values of handleSortWhenOneValueIsNull) and regardless of the count number (due to the fact that the null values are checked before comparing the counts) - correct me if I\'m wrong. \\n\\n Appreciate your help with this, \\n\\n Shahar.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13540023\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13540023&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13540023\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13540023_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13540023_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Dec\\/12 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-27T16:33:41+0000\'\u003e27\\/Dec\\/12 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThat is odd, it worked when I tested it on my box.  I will take another look.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13540023_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13540023_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Dec\\/12 16:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2012-12-27T16:33:41+0000\'\u003e27\\/Dec\\/12 16:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    That is odd, it worked when I tested it on my box.  I will take another look.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13543002\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13543002&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13543002\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13543002_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13543002_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/13 15:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-03T15:44:46+0000\'\u003e03\\/Jan\\/13 15:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 03\\/Jan\\/13 15:49\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFixed NRE when using facet.missing.\u003cbr\\/\u003e\\nAdded test for over-requesting \\/ refinement.\u003cbr\\/\u003e\\nFixed issue that broke over-requesting when local params were present in facet.field.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn correcting the issue with over-requesting I noticed that no refinement is being done for distributed pivot facets.\u003cbr\\/\u003e\\nThis is an issue because it means that your pivot facet counts may not be correct.\u003cbr\\/\u003e\\nI am working on an enhancement to add refinement for pivot facets.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13543002_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13543002_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/13 15:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-03T15:44:46+0000\'\u003e03\\/Jan\\/13 15:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Chris Russell - 03\\/Jan\\/13 15:49\\\"\u003eedited\u003c\\/span\u003e                   Fixed NRE when using facet.missing. \\nAdded test for over-requesting \\/ refinement. \\nFixed issue that broke over-requesting when local params were present in facet.field. \\n\\n In correcting the issue with over-requesting I noticed that no refinement is being done for distributed pivot facets. \\nThis is an issue because it means that your pivot facet counts may not be correct. \\nI am working on an enhancement to add refinement for pivot facets.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13543004\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13543004&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13543004\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13543004_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13543004_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/13 15:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-03T15:47:05+0000\'\u003e03\\/Jan\\/13 15:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eShahar, I think I\'ve corrected the issues you reported.  Take a look.\u003cbr\\/\u003e\\nAnd yes, the sorting will always put the nulls on one side, although I believe it is the bottom of the list based on my testing.  This matches current single-core behavior from solr, as far as I can tell.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13543004_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13543004_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Jan\\/13 15:47\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-03T15:47:05+0000\'\u003e03\\/Jan\\/13 15:47\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Shahar, I think I\'ve corrected the issues you reported.  Take a look. \\nAnd yes, the sorting will always put the nulls on one side, although I believe it is the bottom of the list based on my testing.  This matches current single-core behavior from solr, as far as I can tell.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13552166\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13552166&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13552166\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13552166_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13552166_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jan\\/13 10:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-13T10:55:28+0000\'\u003e13\\/Jan\\/13 10:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Chris,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the updated patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eI started testing this latest patch and encountered a few problems when NULL values are present:\u003cbr\\/\u003e\\n(1) If, for example, FIELD_A contains null values and FIELD_B does not, then \\\"facet.pivot=FIELD_A,FIELD_B\\\" will return more than 1 entry of NULLs for FIELD_A. To be exact, it return an NULL entry per shard. (In non-distributed search, there is a single NULL entry for FIELD_A)\u003cbr\\/\u003e\\n(2) If facet.pivot=FIELD_B,FIELD_A then one may see that for a given of field FIELD_B there is more than 1 entry of FIELD_A with NULL value. (In non-distributed search, there\'s only 1 entry of a NULL value under a given FIELD_B)\u003c\\/p\u003e\\n\\n\u003cp\u003eIt seems as if there\'s a problem when merging null values from cross-shard pivots.\u003cbr\\/\u003e\\nDoes the relevant test-case include some sort of check on data with null values?\u003c\\/p\u003e\\n\\n\u003cp\u003eAs far as sorting is concerned, results seem to be sorted properly (per field as well).\u003c\\/p\u003e\\n\\n\u003cp\u003eShahar.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13552166_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13552166_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Jan\\/13 10:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-13T10:55:28+0000\'\u003e13\\/Jan\\/13 10:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Chris, \\n\\n Thanks for the updated patch. \\n\\n I started testing this latest patch and encountered a few problems when NULL values are present: \\n(1) If, for example, FIELD_A contains null values and FIELD_B does not, then \\\"facet.pivot=FIELD_A,FIELD_B\\\" will return more than 1 entry of NULLs for FIELD_A. To be exact, it return an NULL entry per shard. (In non-distributed search, there is a single NULL entry for FIELD_A) \\n(2) If facet.pivot=FIELD_B,FIELD_A then one may see that for a given of field FIELD_B there is more than 1 entry of FIELD_A with NULL value. (In non-distributed search, there\'s only 1 entry of a NULL value under a given FIELD_B) \\n\\n It seems as if there\'s a problem when merging null values from cross-shard pivots. \\nDoes the relevant test-case include some sort of check on data with null values? \\n\\n As far as sorting is concerned, results seem to be sorted properly (per field as well). \\n\\n Shahar.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13553060\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13553060&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13553060\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13553060_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13553060_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/13 20:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-14T20:05:49+0000\'\u003e14\\/Jan\\/13 20:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eCorrected null aggregation issues when docs contain null values for fields pivoting on. Added logic to remove local params from pivot QS vars when determining over-request.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13553060_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13553060_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Jan\\/13 20:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-14T20:05:49+0000\'\u003e14\\/Jan\\/13 20:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Corrected null aggregation issues when docs contain null values for fields pivoting on. Added logic to remove local params from pivot QS vars when determining over-request.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13555149\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13555149&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13555149\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jugnooken\\\" id=\\\"commentauthor_13555149_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jugnooken\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jugnooken\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ken Ip\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13555149_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/13 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-16T15:57:04+0000\'\u003e16\\/Jan\\/13 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Chris,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for the patch. Any chance this can be applied to 4_0 or 4_1 branch? We have no problem applying it to truck but it can\'t be applied to 4_0 nor 4_1. Appreciated.\u003c\\/p\u003e\\n\\n\u003cp\u003e\\u279C  lucene_solr_4_1  patch -p0 -i \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e.patch --dry-run\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/handler\\/component\\/DistributedFacetPivotTest.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/SingleDocShardFeeder.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/TestRefinementAndOverrequestingForFieldFacetCounts.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/EntryCountComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotNamedListCountComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java\u003cbr\\/\u003e\\nHunk #1 FAILED at 16.\u003cbr\\/\u003e\\nHunk #2 FAILED at 35.\u003cbr\\/\u003e\\nHunk #5 succeeded at 287 with fuzz 2.\u003cbr\\/\u003e\\n2 out of 5 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java.rej\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/NullGoesLastComparator.java\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java\u003cbr\\/\u003e\\nHunk #1 FAILED at 17.\u003cbr\\/\u003e\\nHunk #2 FAILED at 43.\u003cbr\\/\u003e\\n2 out of 11 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java.rej\u003cbr\\/\u003e\\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/PivotListEntry.java\u003cbr\\/\u003e\\npatching file solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/common\\/params\\/FacetParams.java\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"jugnooken\\\" id=\\\"commentauthor_13555149_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=jugnooken\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"jugnooken\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Ken Ip\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13555149_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jan\\/13 15:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-16T15:57:04+0000\'\u003e16\\/Jan\\/13 15:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Chris, \\n\\n Thanks for the patch. Any chance this can be applied to 4_0 or 4_1 branch? We have no problem applying it to truck but it can\'t be applied to 4_0 nor 4_1. Appreciated. \\n\\n \\u279C  lucene_solr_4_1  patch -p0 -i   SOLR-2894  .patch --dry-run \\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/handler\\/component\\/DistributedFacetPivotTest.java \\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/SingleDocShardFeeder.java \\npatching file solr\\/core\\/src\\/test\\/org\\/apache\\/solr\\/TestRefinementAndOverrequestingForFieldFacetCounts.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/EntryCountComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotNamedListCountComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java \\nHunk #1 FAILED at 16. \\nHunk #2 FAILED at 35. \\nHunk #5 succeeded at 287 with fuzz 2. \\n2 out of 5 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/PivotFacetHelper.java.rej \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/NullGoesLastComparator.java \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java \\nHunk #1 FAILED at 17. \\nHunk #2 FAILED at 43. \\n2 out of 11 hunks FAILED &#8211; saving rejects to file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/handler\\/component\\/FacetComponent.java.rej \\npatching file solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/util\\/PivotListEntry.java \\npatching file solr\\/solrj\\/src\\/java\\/org\\/apache\\/solr\\/common\\/params\\/FacetParams.java              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13563902\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13563902&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13563902\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13563902_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13563902_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/13 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-27T19:40:59+0000\'\u003e27\\/Jan\\/13 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Chris,\u003c\\/p\u003e\\n\\n\u003cp\u003eOnce again, your efforts are much appreciated!!\u003c\\/p\u003e\\n\\n\u003cp\u003eI tested the latest patch (dated Jan. 14th) and the null aggregation issues were indeed resolved - thanks!\u003c\\/p\u003e\\n\\n\u003cp\u003eAny chance this could be integrated into the upcoming release? (4.2?)\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks,\u003c\\/p\u003e\\n\\n\u003cp\u003eShahar.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13563902_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13563902_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/13 19:40\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-27T19:40:59+0000\'\u003e27\\/Jan\\/13 19:40\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Chris, \\n\\n Once again, your efforts are much appreciated!! \\n\\n I tested the latest patch (dated Jan. 14th) and the null aggregation issues were indeed resolved - thanks! \\n\\n Any chance this could be integrated into the upcoming release? (4.2?) \\n\\n Thanks, \\n\\n Shahar.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13563920\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13563920&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13563920\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13563920_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13563920_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/13 20:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-27T20:26:08+0000\'\u003e27\\/Jan\\/13 20:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eKen and Shahar, thank you both for your interest in getting this patch usable with the current and upcoming releases.\u003cbr\\/\u003e\\nAt this point in time, since refinement is not present in distributed pivoting, I would be hesitant to integrate this with release versions of solr.  Indeed, where I work we have put features related to this functionality on hold until refinement can be implemented.\u003cbr\\/\u003e\\nI started working on implementing refinement for distributed pivots a couple of weeks ago and have handed it off to a teammate who will be seeing it through to completion.\u003cbr\\/\u003e\\nCurrently we expect this will take another two to four weeks.\u003cbr\\/\u003e\\nAt that time we will update what is here and look in to backporting \\/ getting this committed.\u003cbr\\/\u003e\\nThanks again.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13563920_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13563920_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jan\\/13 20:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-01-27T20:26:08+0000\'\u003e27\\/Jan\\/13 20:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Ken and Shahar, thank you both for your interest in getting this patch usable with the current and upcoming releases. \\nAt this point in time, since refinement is not present in distributed pivoting, I would be hesitant to integrate this with release versions of solr.  Indeed, where I work we have put features related to this functionality on hold until refinement can be implemented. \\nI started working on implementing refinement for distributed pivots a couple of weeks ago and have handed it off to a teammate who will be seeing it through to completion. \\nCurrently we expect this will take another two to four weeks. \\nAt that time we will update what is here and look in to backporting \\/ getting this committed. \\nThanks again.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13579505\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13579505&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13579505\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13579505_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13579505_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/13 21:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-15T21:14:37+0000\'\u003e15\\/Feb\\/13 21:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 15\\/Feb\\/13 21:21\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAs Chris said above me I\'ve been working on distributed pivot faceting. The model had to be reworked to support this change. The new workflow is each shards result goes into a shardRequest map, those maps are combined and converted into a list what is what is is looked at. The combined results are compared to each shard\'s and refinement requests are made. Once all the refinement requests are made another round of refinement is queued up, this time going one level deeper than the previous refinement requests. Because of the nature of the system distributedprocess(rb) needed to be called from the refinepivotfacets to actually take the enqueued refinement requests and make them into fully fledged refinement queries. This caused some issue where other refinment types would get recalled as their refinement identifier was never cleared, Field facets are slightly modified to have a boolean for \\\"needsRefinements\\\" and one for \\\"wasRefined\\\" to help distinguish.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13579505_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13579505_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Feb\\/13 21:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-15T21:14:37+0000\'\u003e15\\/Feb\\/13 21:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 15\\/Feb\\/13 21:21\\\"\u003eedited\u003c\\/span\u003e                   As Chris said above me I\'ve been working on distributed pivot faceting. The model had to be reworked to support this change. The new workflow is each shards result goes into a shardRequest map, those maps are combined and converted into a list what is what is is looked at. The combined results are compared to each shard\'s and refinement requests are made. Once all the refinement requests are made another round of refinement is queued up, this time going one level deeper than the previous refinement requests. Because of the nature of the system distributedprocess(rb) needed to be called from the refinepivotfacets to actually take the enqueued refinement requests and make them into fully fledged refinement queries. This caused some issue where other refinment types would get recalled as their refinement identifier was never cleared, Field facets are slightly modified to have a boolean for \\\"needsRefinements\\\" and one for \\\"wasRefined\\\" to help distinguish.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13583280\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13583280&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13583280\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13583280_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583280_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 15:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T15:32:41+0000\'\u003e21\\/Feb\\/13 15:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 21\\/Feb\\/13 15:32\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAn update to my previous patch. After more consideration, I\'ve pulled the pivot facet logic out of DistributedProcess and call those specific parts when doing the iterative refinement process to avoid any side effects of other people putting code into DistributedProcess. I\'ve also added better support for null values and added tests to ensure that you can send refinement requests for null values and not blow up the stack.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13583280_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13583280_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Feb\\/13 15:32\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-02-21T15:32:41+0000\'\u003e21\\/Feb\\/13 15:32\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 21\\/Feb\\/13 15:32\\\"\u003eedited\u003c\\/span\u003e                   An update to my previous patch. After more consideration, I\'ve pulled the pivot facet logic out of DistributedProcess and call those specific parts when doing the iterative refinement process to avoid any side effects of other people putting code into DistributedProcess. I\'ve also added better support for null values and added tests to ensure that you can send refinement requests for null values and not blow up the stack.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13594772\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13594772&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13594772\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elyograg\\\" id=\\\"commentauthor_13594772_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elyograg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elyograg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shawn Heisey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13594772_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T15:16:08+0000\'\u003e06\\/Mar\\/13 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAndrew, someone on IRC is trying to apply your patch, but we can\'t find a revision that it will apply to successfully, and there\'s no revision information in the patch.  Also, whatever diff utility you used has put backslashes into the paths and that has to be manually fixed before it\'ll find the files on Linux.  Can you update your source tree to the current version and use \'svn diff\' (or \'git diff\' if you\'ve checked out with git) to create the patch and re-upload?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elyograg\\\" id=\\\"commentauthor_13594772_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elyograg\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elyograg\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shawn Heisey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13594772_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 15:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T15:16:08+0000\'\u003e06\\/Mar\\/13 15:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Andrew, someone on IRC is trying to apply your patch, but we can\'t find a revision that it will apply to successfully, and there\'s no revision information in the patch.  Also, whatever diff utility you used has put backslashes into the paths and that has to be manually fixed before it\'ll find the files on Linux.  Can you update your source tree to the current version and use \'svn diff\' (or \'git diff\' if you\'ve checked out with git) to create the patch and re-upload?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13595170\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13595170&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13595170\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13595170_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595170_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T22:04:36+0000\'\u003e06\\/Mar\\/13 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNew patch file for trunk, its a git patch from trunk solr pulled today, let me know if there are any issues applying.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13595170_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595170_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T22:04:36+0000\'\u003e06\\/Mar\\/13 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    New patch file for trunk, its a git patch from trunk solr pulled today, let me know if there are any issues applying.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13595174\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13595174&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13595174\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13595174_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595174_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T22:07:54+0000\'\u003e06\\/Mar\\/13 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks Andrew - this isn\'t my area of expertise, but hopefully someone will get to this eventually. Lot\'s of votes and watchers \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13595174_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595174_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 22:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T22:07:54+0000\'\u003e06\\/Mar\\/13 22:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks Andrew - this isn\'t my area of expertise, but hopefully someone will get to this eventually. Lot\'s of votes and watchers                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13595202\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13595202&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13595202\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mskidmore\\\" id=\\\"commentauthor_13595202_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mskidmore\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mskidmore\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Monica Skidmore\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595202_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 22:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T22:29:06+0000\'\u003e06\\/Mar\\/13 22:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Andrew!  We\'re upgrading our version of Solr, and this will make our users very happy.  I\'m hoping it will be committed now...\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"mskidmore\\\" id=\\\"commentauthor_13595202_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=mskidmore\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"mskidmore\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Monica Skidmore\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595202_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/13 22:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-06T22:29:06+0000\'\u003e06\\/Mar\\/13 22:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Andrew!  We\'re upgrading our version of Solr, and this will make our users very happy.  I\'m hoping it will be committed now...              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13595885\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13595885&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13595885\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13595885_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595885_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/13 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-07T13:53:27+0000\'\u003e07\\/Mar\\/13 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 13\\/Mar\\/13 10:18\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHey, Andrew. I\'m that someone from IRC. \u003cbr\\/\u003e\\nI managed to apply your patch ( even though a single hunk failed ), but I get a NullPointerException when I attempt a query with 3 pivots.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-style: solid;border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eSEVERE: \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e:java.lang.NullPointerException\\n        at org.apache.solr.handler.component.PivotFacetHelper.getCountFromPath(PivotFacetHelper.java:373)\\n        at org.apache.solr.handler.component.FacetComponent.processTopElement(FacetComponent.java:779)\\n        ...\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e  \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13595885_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13595885_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/13 13:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-07T13:53:27+0000\'\u003e07\\/Mar\\/13 13:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 13\\/Mar\\/13 10:18\\\"\u003eedited\u003c\\/span\u003e                   Hey, Andrew. I\'m that someone from IRC.  \\nI managed to apply your patch ( even though a single hunk failed ), but I get a NullPointerException when I attempt a query with 3 pivots. \\n  \\n SEVERE:  null :java.lang.NullPointerException\\n        at org.apache.solr.handler.component.PivotFacetHelper.getCountFromPath(PivotFacetHelper.java:373)\\n        at org.apache.solr.handler.component.FacetComponent.processTopElement(FacetComponent.java:779)\\n        ...\\n \\n                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13596046\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13596046&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13596046\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13596046_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13596046_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/13 16:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-07T16:49:12+0000\'\u003e07\\/Mar\\/13 16:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis patch applies cleanly to trunk for me, apologies as the last one upon review was flawed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13596046_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13596046_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/13 16:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-07T16:49:12+0000\'\u003e07\\/Mar\\/13 16:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This patch applies cleanly to trunk for me, apologies as the last one upon review was flawed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13596079\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13596079&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13596079\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13596079_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13596079_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/13 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-07T17:27:04+0000\'\u003e07\\/Mar\\/13 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have created a unit test that causes an NPE on a 3 pivot request, I am taking a look now.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13596079_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13596079_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Mar\\/13 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-07T17:27:04+0000\'\u003e07\\/Mar\\/13 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have created a unit test that causes an NPE on a 3 pivot request, I am taking a look now.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13599398\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13599398&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13599398\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13599398_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13599398_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/13 22:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-11T22:17:32+0000\'\u003e11\\/Mar\\/13 22:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFixes the NPEs in 3pivot along with solving a hidden issue with null values when .missing was false and dealt with an issue where the facet.mincount is different from the facet.pivot.mincount (which is true for the default). The mincount issue only showed itself during index sorting.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13599398_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13599398_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/13 22:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-11T22:17:32+0000\'\u003e11\\/Mar\\/13 22:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fixes the NPEs in 3pivot along with solving a hidden issue with null values when .missing was false and dealt with an issue where the facet.mincount is different from the facet.pivot.mincount (which is true for the default). The mincount issue only showed itself during index sorting.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13600972\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13600972&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13600972\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13600972_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13600972_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/13 09:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-13T09:20:27+0000\'\u003e13\\/Mar\\/13 09:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI get the following error with the latest patch.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eorg.apache.solr.search.SyntaxError: Expected identifier at pos 28 str=\u003cspan class=\\\"code-quote\\\"\u003e\'{!terms=xxxx xxxx 2}field1,field2,field3\'\u003c\\/span\u003e\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eAs far as I can tell it seems to occur whenever it encounters values in field1 that end with an integer, or contain non-alphanumeric characters.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13600972_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13600972_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/Mar\\/13 09:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-13T09:20:27+0000\'\u003e13\\/Mar\\/13 09:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I get the following error with the latest patch. \\n  \\n org.apache.solr.search.SyntaxError: Expected identifier at pos 28 str= \'{!terms=xxxx xxxx 2}field1,field2,field3\' \\n \\n  \\n\\n As far as I can tell it seems to occur whenever it encounters values in field1 that end with an integer, or contain non-alphanumeric characters.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13603758\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13603758&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13603758\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13603758_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13603758_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/13 19:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-15T19:48:41+0000\'\u003e15\\/Mar\\/13 19:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe issue lies in how the refinement requests were formatted and how they were parsed on the shard side, I\'ve made changes that should alleviate this issue and I\'ll push out a patch soon\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13603758_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13603758_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Mar\\/13 19:48\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-15T19:48:41+0000\'\u003e15\\/Mar\\/13 19:48\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The issue lies in how the refinement requests were formatted and how they were parsed on the shard side, I\'ve made changes that should alleviate this issue and I\'ll push out a patch soon              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13605053\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13605053&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13605053\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13605053_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13605053_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/13 12:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-18T12:17:24+0000\'\u003e18\\/Mar\\/13 12:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Andrew (and Chris), I just wanted to report a problem that we found in the patch from Jan 14th.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn short, the problem seems to be related to facet.limit and the symptom is that a distributed pivot returns less terms than expected.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s a simple scenario:\u003cbr\\/\u003e\\nIf I run a (non-distributed) pivot such as:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003ehttp:\\/\\/myHost:8999\\/solr\\/core-A\\/select?q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A,field_B&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=count\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003ethen I would get N terms for field_A. (where, in my case, N is in the thousands)\u003c\\/p\u003e\\n\\n\u003cp\u003eBUT, if I run a distributed pivot such as:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003ehttp:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A,field_B&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=count\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003ethen I would get \u003cem\u003eat most\u003c\\/em\u003e 160 terms for field_A.\u003cbr\\/\u003e\\n(Why exactly 160?? I have no idea)\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the other hand, if I use f.&lt;field_name&gt;.facet.limit=-1 then things work as expected. For example:\u003c\\/p\u003e\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003ehttp:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A,field_B&amp;rows=0&amp;f.field_A.facet.limit=-1&amp;f.field_B.facet.limit=-1&amp;facet.sort=count\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eThis will return exactly N terms for field_A as expected.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll appreciate your help with this.\u003c\\/p\u003e\\n\\n\u003cp\u003eShahar.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"shahar.davidson\\\" id=\\\"commentauthor_13605053_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=shahar.davidson\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"shahar.davidson\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Shahar Davidson\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13605053_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/13 12:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-18T12:17:24+0000\'\u003e18\\/Mar\\/13 12:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Andrew (and Chris), I just wanted to report a problem that we found in the patch from Jan 14th. \\n\\n In short, the problem seems to be related to facet.limit and the symptom is that a distributed pivot returns less terms than expected. \\n\\n Here\'s a simple scenario: \\nIf I run a (non-distributed) pivot such as: \\n  \\n http:\\/\\/myHost:8999\\/solr\\/core-A\\/select?q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A,field_B&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=count \\n  \\n then I would get N terms for field_A. (where, in my case, N is in the thousands) \\n\\n BUT, if I run a distributed pivot such as: \\n  \\n http:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A,field_B&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=count \\n  \\n then I would get  at most  160 terms for field_A. \\n(Why exactly 160?? I have no idea) \\n\\n On the other hand, if I use f.&lt;field_name&gt;.facet.limit=-1 then things work as expected. For example: \\n  \\n http:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A,field_B&amp;rows=0&amp;f.field_A.facet.limit=-1&amp;f.field_B.facet.limit=-1&amp;facet.sort=count \\n  \\n This will return exactly N terms for field_A as expected. \\n\\n I\'ll appreciate your help with this. \\n\\n Shahar.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13605228\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13605228&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13605228\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13605228_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13605228_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/13 15:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-18T15:46:44+0000\'\u003e18\\/Mar\\/13 15:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe Jan 14th patch is totally missing the refinement step, so its hard for me to say what problem is causing your issue. Please download the newest patch and let me know if that problem continues.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13605228_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13605228_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Mar\\/13 15:46\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-18T15:46:44+0000\'\u003e18\\/Mar\\/13 15:46\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The Jan 14th patch is totally missing the refinement step, so its hard for me to say what problem is causing your issue. Please download the newest patch and let me know if that problem continues.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13608312\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13608312&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13608312\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"unchadkervishal\\\" id=\\\"commentauthor_13608312_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=unchadkervishal\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"unchadkervishal\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Vishal Deshmukh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608312_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 22:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T22:10:21+0000\'\u003e20\\/Mar\\/13 22:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi, we are looking for this feature desperately. can anyone give ETA on this? Thanks in advance.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"unchadkervishal\\\" id=\\\"commentauthor_13608312_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=unchadkervishal\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"unchadkervishal\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Vishal Deshmukh\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608312_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Mar\\/13 22:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-20T22:10:21+0000\'\u003e20\\/Mar\\/13 22:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, we are looking for this feature desperately. can anyone give ETA on this? Thanks in advance.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13608968\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13608968&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13608968\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13608968_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608968_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 14:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T14:22:57+0000\'\u003e21\\/Mar\\/13 14:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis was built for 4_1_0 but git thinks it\'ll apply to trunk no problem.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis solves a myriad of issues surrounding the formatting of the refinement requests, should support all field types and deals with jagged pivot facet result sets due to nulls or empty data on pivoted fields.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13608968_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13608968_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Mar\\/13 14:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-03-21T14:22:57+0000\'\u003e21\\/Mar\\/13 14:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This was built for 4_1_0 but git thinks it\'ll apply to trunk no problem. \\n\\n This solves a myriad of issues surrounding the formatting of the refinement requests, should support all field types and deals with jagged pivot facet result sets due to nulls or empty data on pivoted fields.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13626417\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13626417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13626417\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steingran\\\" id=\\\"commentauthor_13626417_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steingran\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steingran\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stein J. Gran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13626417_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Apr\\/13 09:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-09T09:22:35+0000\'\u003e09\\/Apr\\/13 09:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAndrew, which version does the latest patch apply to? I\'ve tried applying it to trunk, branch_4x and 4.2.1 without any luck so far. I\'m planning on testing this patch in a SolrCloud environment with lots of pivot facet queries.\u003c\\/p\u003e\\n\\n\u003cp\u003eFor trunk I get this:\u003cbr\\/\u003e\\npatching file `solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/request\\/SimpleFacets.java\'\u003cbr\\/\u003e\\nHunk #1 succeeded at 323 with fuzz 2 (offset 51 lines).\u003cbr\\/\u003e\\nHunk #2 FAILED at 374.\u003cbr\\/\u003e\\n1 out of 2 hunks FAILED &#8211; saving rejects to solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/\u003cbr\\/\u003e\\nrequest\\/SimpleFacets.java.rej\u003c\\/p\u003e\\n\\n\u003cp\u003eThe rej file seems similar for trunk and the 4.2.1 tag\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steingran\\\" id=\\\"commentauthor_13626417_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steingran\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steingran\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stein J. Gran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13626417_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Apr\\/13 09:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-09T09:22:35+0000\'\u003e09\\/Apr\\/13 09:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Andrew, which version does the latest patch apply to? I\'ve tried applying it to trunk, branch_4x and 4.2.1 without any luck so far. I\'m planning on testing this patch in a SolrCloud environment with lots of pivot facet queries. \\n\\n For trunk I get this: \\npatching file `solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/request\\/SimpleFacets.java\' \\nHunk #1 succeeded at 323 with fuzz 2 (offset 51 lines). \\nHunk #2 FAILED at 374. \\n1 out of 2 hunks FAILED &#8211; saving rejects to solr\\/core\\/src\\/java\\/org\\/apache\\/solr\\/ \\nrequest\\/SimpleFacets.java.rej \\n\\n The rej file seems similar for trunk and the 4.2.1 tag              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13626441\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13626441&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13626441\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"sviatoslavlisenkin\\\" id=\\\"commentauthor_13626441_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=sviatoslavlisenkin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"sviatoslavlisenkin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Sviatoslav Lisenkin\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13626441_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Apr\\/13 10:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-09T10:07:39+0000\'\u003e09\\/Apr\\/13 10:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHello, everyone. \u003cbr\\/\u003e\\nI had applied the latest patch two weeks ago (rev.1465879), faced the issues with merging in SimpleFacets class near \'incomingMinCount\' variable, fixed them manually (just renaming). Simple pivot faceting via web UI and sample Solr installation with two nodes worked fine. I really appreciate if someone have a chance to test it under load etc.\u003cbr\\/\u003e\\nHope, this patch (and feature) will be included in the upcoming release.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"sviatoslavlisenkin\\\" id=\\\"commentauthor_13626441_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=sviatoslavlisenkin\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"sviatoslavlisenkin\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Sviatoslav Lisenkin\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13626441_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Apr\\/13 10:07\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-09T10:07:39+0000\'\u003e09\\/Apr\\/13 10:07\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hello, everyone.  \\nI had applied the latest patch two weeks ago (rev.1465879), faced the issues with merging in SimpleFacets class near \'incomingMinCount\' variable, fixed them manually (just renaming). Simple pivot faceting via web UI and sample Solr installation with two nodes worked fine. I really appreciate if someone have a chance to test it under load etc. \\nHope, this patch (and feature) will be included in the upcoming release.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13626656\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13626656&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13626656\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13626656_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13626656_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Apr\\/13 14:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-09T14:33:01+0000\'\u003e09\\/Apr\\/13 14:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt was built for 4.1. There are a few application failures with 4_2 but nothing major from what I\'ve seen.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13626656_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13626656_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Apr\\/13 14:33\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-09T14:33:01+0000\'\u003e09\\/Apr\\/13 14:33\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It was built for 4.1. There are a few application failures with 4_2 but nothing major from what I\'ve seen.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13627641\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13627641&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13627641\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steingran\\\" id=\\\"commentauthor_13627641_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steingran\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steingran\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stein J. Gran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13627641_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/13 09:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-10T09:43:30+0000\'\u003e10\\/Apr\\/13 09:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSviatoslav and Andrew: Thank you, only small changes to the SimpleFacets.java file was necessary to get the patch in for the 4.2.1 tag.\u003c\\/p\u003e\\n\\n\u003cp\u003eI have now been testing the patch in a small SolrCloud environment with two shards (-DnumShards=2), and I have found the following:\u003cbr\\/\u003e\\n1. Distributed pivot facets work great on string fields \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e\u003cbr\\/\u003e\\n2. No values are returned if one of the facet.pivot fields is a date field\u003c\\/p\u003e\\n\\n\u003cp\u003eFor scenario 2:\u003cbr\\/\u003e\\na) There are no error messages in the Solr log file\u003c\\/p\u003e\\n\\n\u003cp\u003eb) The URL I use is \u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/coxitocollection\\/select?facet=true&amp;facet.sort=true&amp;q=*:*&amp;facet.limit=1000&amp;facet.pivot=dateday_datetime,firstreplytime\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/coxitocollection\\/select?facet=true&amp;facet.sort=true&amp;q=*:*&amp;facet.limit=1000&amp;facet.pivot=dateday_datetime,firstreplytime\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ec) If I add \\\"&amp;distrib=false\\\" to the URL, I get values back\u003c\\/p\u003e\\n\\n\u003cp\u003ed) The fields used are defined like this in schema.xml:\u003cbr\\/\u003e\\n&lt;field name=\\\"dateday_datetime\\\" type=\\\"date\\\" indexed=\\\"true\\\" stored=\\\"true\\\" multiValued=\\\"false\\\" \\/&gt;\u003cbr\\/\u003e\\n&lt;field name=\\\"firstreplytime\\\" type=\\\"int\\\" stored=\\\"true\\\" multiValued=\\\"false\\\" \\/&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003ee) I tried using the tdate field instead of date, but this had no effect\u003c\\/p\u003e\\n\\n\u003cp\u003ef) The date and tdate fields are defined like this in schema.xml:\u003cbr\\/\u003e\\n&lt;fieldType name=\\\"date\\\" class=\\\"solr.TrieDateField\\\" precisionStep=\\\"0\\\" positionIncrementGap=\\\"0\\\"\\/&gt;\u003cbr\\/\u003e\\n&lt;fieldType name=\\\"tdate\\\" class=\\\"solr.TrieDateField\\\" precisionStep=\\\"6\\\" positionIncrementGap=\\\"0\\\"\\/&gt;\u003c\\/p\u003e\\n\\n\u003cp\u003eg) If I run with -DnumShards=1 this scenario works great, both with and without \\\"distrib=false\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eh) This was tested with 4.2.1 with the patch from March 21st with the following change: The non-existing variable \\\"mincount\\\" was replaced with \\\"incomingMinCount\\\" in SimpleFacets.java\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steingran\\\" id=\\\"commentauthor_13627641_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steingran\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steingran\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stein J. Gran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13627641_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Apr\\/13 09:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-04-10T09:43:30+0000\'\u003e10\\/Apr\\/13 09:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sviatoslav and Andrew: Thank you, only small changes to the SimpleFacets.java file was necessary to get the patch in for the 4.2.1 tag. \\n\\n I have now been testing the patch in a small SolrCloud environment with two shards (-DnumShards=2), and I have found the following: \\n1. Distributed pivot facets work great on string fields   \\n2. No values are returned if one of the facet.pivot fields is a date field \\n\\n For scenario 2: \\na) There are no error messages in the Solr log file \\n\\n b) The URL I use is  http:\\/\\/localhost:8983\\/solr\\/coxitocollection\\/select?facet=true&amp;facet.sort=true&amp;q=*:*&amp;facet.limit=1000&amp;facet.pivot=dateday_datetime,firstreplytime  \\n\\n c) If I add \\\"&amp;distrib=false\\\" to the URL, I get values back \\n\\n d) The fields used are defined like this in schema.xml: \\n&lt;field name=\\\"dateday_datetime\\\" type=\\\"date\\\" indexed=\\\"true\\\" stored=\\\"true\\\" multiValued=\\\"false\\\" \\/&gt; \\n&lt;field name=\\\"firstreplytime\\\" type=\\\"int\\\" stored=\\\"true\\\" multiValued=\\\"false\\\" \\/&gt; \\n\\n e) I tried using the tdate field instead of date, but this had no effect \\n\\n f) The date and tdate fields are defined like this in schema.xml: \\n&lt;fieldType name=\\\"date\\\" class=\\\"solr.TrieDateField\\\" precisionStep=\\\"0\\\" positionIncrementGap=\\\"0\\\"\\/&gt; \\n&lt;fieldType name=\\\"tdate\\\" class=\\\"solr.TrieDateField\\\" precisionStep=\\\"6\\\" positionIncrementGap=\\\"0\\\"\\/&gt; \\n\\n g) If I run with -DnumShards=1 this scenario works great, both with and without \\\"distrib=false\\\" \\n\\n h) This was tested with 4.2.1 with the patch from March 21st with the following change: The non-existing variable \\\"mincount\\\" was replaced with \\\"incomingMinCount\\\" in SimpleFacets.java              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13661866\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13661866&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13661866\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13661866_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13661866_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/13 09:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-20T09:27:43+0000\'\u003e20\\/May\\/13 09:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eI want to report a problem that we found in the patch of March 21st.\u003cbr\\/\u003e\\nIt seems that the problem Shahar reported is now solved, but there is another similar problem.\u003cbr\\/\u003e\\nIn short, the problem seems to be related to facet.limit per field definition and the symptom is that a distributed pivot returns less terms than expected.\u003cbr\\/\u003e\\nHere\'s a simple scenario:\u003c\\/p\u003e\\n\\n\u003cp\u003eif I run a distributed pivot such as:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=index\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=index\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eit will return exactly number of terms for field_A as expected.\u003c\\/p\u003e\\n\\n\u003cp\u003eOn the other hand, if I use f.&lt;field_name&gt;.facet.limit=-1:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A&amp;rows=0&amp;f.field_A.facet.limit=-1&amp;facet.sort=index\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A&amp;rows=0&amp;f.field_A.facet.limit=-1&amp;facet.sort=index\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003ethen it will return at most 100 terms for field_A.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ll appreciate your help with this.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13661866_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13661866_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/13 09:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-20T09:27:43+0000\'\u003e20\\/May\\/13 09:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n I want to report a problem that we found in the patch of March 21st. \\nIt seems that the problem Shahar reported is now solved, but there is another similar problem. \\nIn short, the problem seems to be related to facet.limit per field definition and the symptom is that a distributed pivot returns less terms than expected. \\nHere\'s a simple scenario: \\n\\n if I run a distributed pivot such as: \\n http:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A&amp;rows=0&amp;facet.limit=-1&amp;facet.sort=index  \\n\\n it will return exactly number of terms for field_A as expected. \\n\\n On the other hand, if I use f.&lt;field_name&gt;.facet.limit=-1: \\n http:\\/\\/myHost:8999\\/solr\\/core-B\\/select?shards=myHost:8999\\/solr\\/core-A&amp;q=*:*&amp;wt=xml&amp;facet=true&amp;facet.pivot=field_A&amp;rows=0&amp;f.field_A.facet.limit=-1&amp;facet.sort=index  \\n\\n then it will return at most 100 terms for field_A. \\n\\n I\'ll appreciate your help with this. \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13670363\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13670363&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13670363\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13670363_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13670363_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/13 14:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-30T14:13:57+0000\'\u003e30\\/May\\/13 14:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI will take a look.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13670363_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13670363_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'30\\/May\\/13 14:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-05-30T14:13:57+0000\'\u003e30\\/May\\/13 14:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I will take a look.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13697420\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13697420&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13697420\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13697420_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13697420_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Jul\\/13 02:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-02T02:12:45+0000\'\u003e02\\/Jul\\/13 02:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eTons of votes and watchers on this issue!\u003cbr\\/\u003e\\n\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\" class=\\\"user-hover\\\" rel=\\\"selah\\\"\u003eChris Russell\u003c\\/a\u003e, \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\" class=\\\"user-hover\\\" rel=\\\"andrew.muldowney\\\"\u003eAndrew Muldowney\u003c\\/a\u003e, and \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\" class=\\\"user-hover\\\" rel=\\\"solrtrey\\\"\u003eTrey Grainger\u003c\\/a\u003e - any luck with this by any chance?  It would be great to get this in 4.4!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13697420_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13697420_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'02\\/Jul\\/13 02:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-02T02:12:45+0000\'\u003e02\\/Jul\\/13 02:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Tons of votes and watchers on this issue! \\n Chris Russell ,  Andrew Muldowney , and  Trey Grainger  - any luck with this by any chance?  It would be great to get this in 4.4!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13708757\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13708757&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13708757\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13708757_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13708757_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jul\\/13 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-15T18:11:09+0000\'\u003e15\\/Jul\\/13 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIm working on this patch again, looking into the limit issue and the fact that exclusion tags aren\'t being respected. They both boil down to improperly formatted refinement requests, so I\'m going through and cleaning those up to look more and more like the distributed field facet code. Should also have time to get to the datetime problem, where you cannot refine on datetimes because the datetime format returned by the shards is not queryable when refining.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13708757_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13708757_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jul\\/13 18:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-15T18:11:09+0000\'\u003e15\\/Jul\\/13 18:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Im working on this patch again, looking into the limit issue and the fact that exclusion tags aren\'t being respected. They both boil down to improperly formatted refinement requests, so I\'m going through and cleaning those up to look more and more like the distributed field facet code. Should also have time to get to the datetime problem, where you cannot refine on datetimes because the datetime format returned by the shards is not queryable when refining.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13709360\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13709360&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13709360\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13709360_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13709360_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/13 02:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-16T02:04:16+0000\'\u003e16\\/Jul\\/13 02:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e@\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=Otis\\\" class=\\\"user-hover\\\" rel=\\\"otis\\\"\u003eOtis Gospodnetic\u003c\\/a\u003e, we have this patch live in production for several use cases (as a pre-requisite for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-3583\\\" title=\\\"Percentiles for facets, pivot facets, and distributed pivot facets\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-3583\\\"\u003e\u003cdel\u003eSOLR-3583\u003c\\/del\u003e\u003c\\/a\u003e, which we\'ve also worked on @CareerBuilder), but the currently known issues which would prevent this from being committed include:\u003cbr\\/\u003e\\n1) Tags and Excludes are not being respected beyond the first level\u003cbr\\/\u003e\\n2) The facet.limit=-1 issue (not returning all values)\u003cbr\\/\u003e\\n3) The lack of support for datetimes\u003c\\/p\u003e\\n\\n\u003cp\u003eWe need #1 and Andrew is working on a project currently to fix this.  He\'s also looking to fix #3 and find a reasonably scalable solution to #2.  I\'m not sure when the Solr 4.4 vote is going to be, but it\'ll probably be a few more weeks until this patch is all wrapped up.\u003c\\/p\u003e\\n\\n\u003cp\u003eMeanwhile, if anyone else finds any issues with the patch, please let us know so they can be looked into.  Thanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13709360_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13709360_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Jul\\/13 02:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-16T02:04:16+0000\'\u003e16\\/Jul\\/13 02:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    @ Otis Gospodnetic , we have this patch live in production for several use cases (as a pre-requisite for   SOLR-3583  , which we\'ve also worked on @CareerBuilder), but the currently known issues which would prevent this from being committed include: \\n1) Tags and Excludes are not being respected beyond the first level \\n2) The facet.limit=-1 issue (not returning all values) \\n3) The lack of support for datetimes \\n\\n We need #1 and Andrew is working on a project currently to fix this.  He\'s also looking to fix #3 and find a reasonably scalable solution to #2.  I\'m not sure when the Solr 4.4 vote is going to be, but it\'ll probably be a few more weeks until this patch is all wrapped up. \\n\\n Meanwhile, if anyone else finds any issues with the patch, please let us know so they can be looked into.  Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13715674\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13715674&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13715674\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13715674_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13715674_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jul\\/13 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-22T21:15:17+0000\'\u003e22\\/Jul\\/13 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 22\\/Jul\\/13 21:22\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBuilt on 4_4\u003cbr\\/\u003e\\nThis version fixes the following:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) Indecisive faceting not being respected on refinement queries\u003cbr\\/\u003e\\n2) Key not being respected\u003cbr\\/\u003e\\n3) Facet.offset not being respected\u003cbr\\/\u003e\\n4) datetimes breaking when trying to refine\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eOne point of contention is this:\u003cbr\\/\u003e\\nThe SolrExampleTests.java (for the SolrJ stuff) had a check that required pivot facet boolean results as strict Boolean.TRUE as opposed to the string \\\"true\\\".\u003c\\/p\u003e\\n\\n\u003cp\u003eThis came about from the change that was required to fix datetime. \u003c\\/p\u003e\\n\\n\u003cp\u003eI can\'t find anywhere else where we require a boolean field\'s value to equal Boolean.True so I think this test was just an artifact of how the original pivot facetting code was written.\u003c\\/p\u003e\\n\\n\u003cp\u003eAs it stands now the SolrExampleTests.doPivotFacetTest:1151 has been changed to \\\"true\\\" instead of Boolean.TRUE\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13715674_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13715674_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Jul\\/13 21:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-22T21:15:17+0000\'\u003e22\\/Jul\\/13 21:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 22\\/Jul\\/13 21:22\\\"\u003eedited\u003c\\/span\u003e                   Built on 4_4 \\nThis version fixes the following: \\n\\n 1) Indecisive faceting not being respected on refinement queries \\n2) Key not being respected \\n3) Facet.offset not being respected \\n4) datetimes breaking when trying to refine \\n\\n\\n One point of contention is this: \\nThe SolrExampleTests.java (for the SolrJ stuff) had a check that required pivot facet boolean results as strict Boolean.TRUE as opposed to the string \\\"true\\\". \\n\\n This came about from the change that was required to fix datetime.  \\n\\n I can\'t find anywhere else where we require a boolean field\'s value to equal Boolean.True so I think this test was just an artifact of how the original pivot facetting code was written. \\n\\n As it stands now the SolrExampleTests.doPivotFacetTest:1151 has been changed to \\\"true\\\" instead of Boolean.TRUE              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13716169\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13716169&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13716169\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13716169_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13716169_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jul\\/13 06:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-23T06:52:21+0000\'\u003e23\\/Jul\\/13 06:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAndrew, Thank you very much for the fix!\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes this version fix the issue of f.field.facet.limit not being respected?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13716169_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13716169_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jul\\/13 06:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-23T06:52:21+0000\'\u003e23\\/Jul\\/13 06:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Andrew, Thank you very much for the fix! \\n\\n Does this version fix the issue of f.field.facet.limit not being respected? \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13716428\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13716428&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13716428\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13716428_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13716428_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jul\\/13 14:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-23T14:38:35+0000\'\u003e23\\/Jul\\/13 14:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 23\\/Jul\\/13 14:38\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eYes, it should\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13716428_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13716428_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Jul\\/13 14:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-23T14:38:35+0000\'\u003e23\\/Jul\\/13 14:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 23\\/Jul\\/13 14:38\\\"\u003eedited\u003c\\/span\u003e                   Yes, it should              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13718122\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13718122&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13718122\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13718122_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13718122_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/13 08:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-24T08:39:49+0000\'\u003e24\\/Jul\\/13 08:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Andrew, \u003c\\/p\u003e\\n\\n\u003cp\u003eI have tried applying latest patch to 4.2.1 and there were a few problems.\u003cbr\\/\u003e\\nWhich version does it apply to?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13718122_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13718122_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/13 08:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-24T08:39:49+0000\'\u003e24\\/Jul\\/13 08:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Andrew,  \\n\\n I have tried applying latest patch to 4.2.1 and there were a few problems. \\nWhich version does it apply to? \\n\\n Thanks.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13718429\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13718429&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13718429\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13718429_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13718429_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/13 14:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-24T14:45:22+0000\'\u003e24\\/Jul\\/13 14:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\" class=\\\"user-hover\\\" rel=\\\"elrand\\\"\u003eElran Dvir\u003c\\/a\u003e - didn\'t try applying it yet, but 99.9% sure it is\\/was the trunk.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13718429_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13718429_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/13 14:45\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-24T14:45:22+0000\'\u003e24\\/Jul\\/13 14:45\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Elran Dvir  - didn\'t try applying it yet, but 99.9% sure it is\\/was the trunk.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13718527\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13718527&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13718527\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13718527_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13718527_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/13 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-24T16:15:55+0000\'\u003e24\\/Jul\\/13 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI built it for 4_4.\u003c\\/p\u003e\\n\\n\u003cp\u003eBut I didn\'t have trouble patching it to 4_2_1. Did you pull from git or svn?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13718527_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13718527_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Jul\\/13 16:15\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-24T16:15:55+0000\'\u003e24\\/Jul\\/13 16:15\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I built it for 4_4. \\n\\n But I didn\'t have trouble patching it to 4_2_1. Did you pull from git or svn?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13719417\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13719417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13719417\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13719417_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13719417_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/13 09:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-25T09:12:50+0000\'\u003e25\\/Jul\\/13 09:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have downloaded the source code from Solr\'s website.\u003cbr\\/\u003e\\nThen opened it with my IDE: Intellij.\u003cbr\\/\u003e\\nwhen I tried applying the patch, Intellij reported there were problems with some files.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13719417_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13719417_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/13 09:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-25T09:12:50+0000\'\u003e25\\/Jul\\/13 09:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have downloaded the source code from Solr\'s website. \\nThen opened it with my IDE: Intellij. \\nwhen I tried applying the patch, Intellij reported there were problems with some files. \\n\\n Thanks.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13719885\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13719885&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13719885\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13719885_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13719885_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/13 18:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-25T18:29:05+0000\'\u003e25\\/Jul\\/13 18:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFixed an issue where commas in string fields would cause infinite refinement loops.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13719885_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13719885_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Jul\\/13 18:29\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-07-25T18:29:05+0000\'\u003e25\\/Jul\\/13 18:29\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fixed an issue where commas in string fields would cause infinite refinement loops.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13726461\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13726461&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13726461\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steingran\\\" id=\\\"commentauthor_13726461_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steingran\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steingran\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stein J. Gran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13726461_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/13 14:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-01T14:10:27+0000\'\u003e01\\/Aug\\/13 14:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have now re-tested the scenarios I used on April 10th (see my comment above from that date), and all of those issues I found then are now resolved \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e I applied the July 25th patch to the lucene_solr_4_4 branch (Github) and performed the tests on this version.\u003c\\/p\u003e\\n\\n\u003cp\u003eWell done Andrew \u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/smile.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e  Thumbs up from me.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"steingran\\\" id=\\\"commentauthor_13726461_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=steingran\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"steingran\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Stein J. Gran\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13726461_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'01\\/Aug\\/13 14:10\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-01T14:10:27+0000\'\u003e01\\/Aug\\/13 14:10\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have now re-tested the scenarios I used on April 10th (see my comment above from that date), and all of those issues I found then are now resolved   I applied the July 25th patch to the lucene_solr_4_4 branch (Github) and performed the tests on this version. \\n\\n Well done Andrew    Thumbs up from me.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13731408\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13731408&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13731408\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13731408_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13731408_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Aug\\/13 22:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-06T22:52:44+0000\'\u003e06\\/Aug\\/13 22:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve found a small error which causes largely sharded (30+) data to spiral out of control on refinement requests.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve fixed the error on a previous version of solr and I\'ll be forward porting it to my 4_4 build by tomorrow.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you are having issues with complex string fields this should help.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13731408_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13731408_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Aug\\/13 22:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-06T22:52:44+0000\'\u003e06\\/Aug\\/13 22:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve found a small error which causes largely sharded (30+) data to spiral out of control on refinement requests. \\n\\n I\'ve fixed the error on a previous version of solr and I\'ll be forward porting it to my 4_4 build by tomorrow. \\n\\n If you are having issues with complex string fields this should help.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13731433\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13731433&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13731433\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13731433_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13731433_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Aug\\/13 23:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-06T23:20:43+0000\'\u003e06\\/Aug\\/13 23:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\" class=\\\"user-hover\\\" rel=\\\"andrew.muldowney\\\"\u003eAndrew Muldowney\u003c\\/a\u003e - I didn\'t have time to link issues, but \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=joel.bernstein\\\" class=\\\"user-hover\\\" rel=\\\"joel.bernstein\\\"\u003eJoel Bernstein\u003c\\/a\u003e is working on at least one issue that is, if I recall correctly, an alternative implementation of this....\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13731433_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13731433_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Aug\\/13 23:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-06T23:20:43+0000\'\u003e06\\/Aug\\/13 23:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Andrew Muldowney  - I didn\'t have time to link issues, but  Joel Bernstein  is working on at least one issue that is, if I recall correctly, an alternative implementation of this....              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13732818\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13732818&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13732818\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13732818_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13732818_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/13 22:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-07T22:06:11+0000\'\u003e07\\/Aug\\/13 22:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFixed the run-away-but-eventually-coalesing refinement query issue\u003c\\/p\u003e\\n\\n\u003cp\u003eAt this point all known issues have been resolved.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13732818_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13732818_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Aug\\/13 22:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-07T22:06:11+0000\'\u003e07\\/Aug\\/13 22:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Fixed the run-away-but-eventually-coalesing refinement query issue \\n\\n At this point all known issues have been resolved.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13743793\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13743793&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13743793\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13743793_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13743793_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/13 13:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-19T13:13:11+0000\'\u003e19\\/Aug\\/13 13:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 19\\/Aug\\/13 13:14\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHey, Andrew. Really appreciate the effort here!\u003cbr\\/\u003e\\nI am seeing this error with the latest patch.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e\u003cspan class=\\\"code-quote\\\"\u003e\\\"error\\\"\u003c\\/span\u003e: {\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"msg\\\"\u003c\\/span\u003e: \u003cspan class=\\\"code-quote\\\"\u003e\\\"java.lang.RuntimeException: Invalid version (expected 2, but 60) or the data in not in \u003cspan class=\\\"code-quote\\\"\u003e\'javabin\'\u003c\\/span\u003e format\\\"\u003c\\/span\u003e,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"trace\\\"\u003c\\/span\u003e: \u003cspan class=\\\"code-quote\\\"\u003e\\\"org.apache.solr.common.SolrException: java.lang.RuntimeException: Invalid version (expected 2, but 60) or the data in not in \u003cspan class=\\\"code-quote\\\"\u003e\'javabin\'\u003c\\/span\u003e format\\\\n\\\\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:302)\\\\n\\\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\\\\n\\\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1850)\\\\n\\\\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:703)\\\\n\\\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:406)\\\\n\\\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195)\\\\n\\\\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\\\\n\\\\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\\\\n\\\\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\\\\n\\\\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\\\\n\\\\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\\\\n\\\\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\\\\n\\\\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\\\\n\\\\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\\\\n\\\\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)\\\\n\\\\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\\\\n\\\\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\\\\n\\\\tat java.lang.\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.run(\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.java:724)\\\\nCaused by: java.lang.RuntimeException: Invalid version (expected 2, but 60) or the data in not in \u003cspan class=\\\"code-quote\\\"\u003e\'javabin\'\u003c\\/span\u003e format\\\\n\\\\tat org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:110)\\\\n\\\\tat org.apache.solr.client.solrj.impl.BinaryResponseParser.processResponse(BinaryResponseParser.java:41)\\\\n\\\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:407)\\\\n\\\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:180)\\\\n\\\\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:155)\\\\n\\\\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:118)\\\\n\\\\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\\\\n\\\\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\\\\n\\\\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\\\\n\\\\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\\\\n\\\\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\\\\n\\\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\\\\n\\\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\\\\n\\\\t... 1 more\\\\n\\\"\u003c\\/span\u003e,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"code\\\"\u003c\\/span\u003e: 500\\n  }\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eTrying it with 2 pivots across 8 shards with a total of ~3 million docs.\u003cbr\\/\u003e\\nNot sure what\'s causing it, but let me know if I can do anything to help!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13743793_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13743793_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/13 13:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-19T13:13:11+0000\'\u003e19\\/Aug\\/13 13:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 19\\/Aug\\/13 13:14\\\"\u003eedited\u003c\\/span\u003e                   Hey, Andrew. Really appreciate the effort here! \\nI am seeing this error with the latest patch. \\n  \\n  \\\"error\\\" : {\\n     \\\"msg\\\" :  \\\"java.lang.RuntimeException: Invalid version (expected 2, but 60) or the data in not in  \'javabin\'  format\\\" ,\\n     \\\"trace\\\" :  \\\"org.apache.solr.common.SolrException: java.lang.RuntimeException: Invalid version (expected 2, but 60) or the data in not in  \'javabin\'  format\\\\n\\\\tat org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:302)\\\\n\\\\tat org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\\\\n\\\\tat org.apache.solr.core.SolrCore.execute(SolrCore.java:1850)\\\\n\\\\tat org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:703)\\\\n\\\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:406)\\\\n\\\\tat org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195)\\\\n\\\\tat org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\\\\n\\\\tat org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\\\\n\\\\tat org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\\\\n\\\\tat org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\\\\n\\\\tat org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\\\\n\\\\tat org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\\\\n\\\\tat org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\\\\n\\\\tat org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\\\\n\\\\tat org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)\\\\n\\\\tat org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\\\\n\\\\tat org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\\\\n\\\\tat java.lang. Thread .run( Thread .java:724)\\\\nCaused by: java.lang.RuntimeException: Invalid version (expected 2, but 60) or the data in not in  \'javabin\'  format\\\\n\\\\tat org.apache.solr.common.util.JavaBinCodec.unmarshal(JavaBinCodec.java:110)\\\\n\\\\tat org.apache.solr.client.solrj.impl.BinaryResponseParser.processResponse(BinaryResponseParser.java:41)\\\\n\\\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:407)\\\\n\\\\tat org.apache.solr.client.solrj.impl.HttpSolrServer.request(HttpSolrServer.java:180)\\\\n\\\\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:155)\\\\n\\\\tat org.apache.solr.handler.component.HttpShardHandler$1.call(HttpShardHandler.java:118)\\\\n\\\\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\\\\n\\\\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\\\\n\\\\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:471)\\\\n\\\\tat java.util.concurrent.FutureTask$Sync.innerRun(FutureTask.java:334)\\\\n\\\\tat java.util.concurrent.FutureTask.run(FutureTask.java:166)\\\\n\\\\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1145)\\\\n\\\\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:615)\\\\n\\\\t... 1 more\\\\n\\\" ,\\n     \\\"code\\\" : 500\\n  }\\n \\n  \\n Trying it with 2 pivots across 8 shards with a total of ~3 million docs. \\nNot sure what\'s causing it, but let me know if I can do anything to help!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13743842\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13743842&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13743842\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13743842_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13743842_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/13 14:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-19T14:23:51+0000\'\u003e19\\/Aug\\/13 14:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWhat are your exact field types? What is your query?\u003cbr\\/\u003e\\nFrom what I\'m seeing online that error is because a shard failed for some reason. Knowing why a shard failed will yield a much better error message.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13743842_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13743842_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/Aug\\/13 14:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-19T14:23:51+0000\'\u003e19\\/Aug\\/13 14:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    What are your exact field types? What is your query? \\nFrom what I\'m seeing online that error is because a shard failed for some reason. Knowing why a shard failed will yield a much better error message.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13744859\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13744859&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13744859\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13744859_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13744859_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/13 11:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-20T11:05:21+0000\'\u003e20\\/Aug\\/13 11:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 20\\/Aug\\/13 11:12\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eits a pretty simple query: q=&lt;star&gt;:&lt;star&gt;&amp;facet=on&amp;facet.pivot=fieldA,fieldB , both regular single valued solr.TextFields with solr.LowerCaseFilterFactory filters. All shards work well individually.\u003cbr\\/\u003e\\nI\'m looking at the logs but unfortunately I\'m not seeing any other error messages there.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt works as long as I use less than 6 shards. With 6 or more it fails with that error, regardless of which shards I use.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13744859_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13744859_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/13 11:05\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-20T11:05:21+0000\'\u003e20\\/Aug\\/13 11:05\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 20\\/Aug\\/13 11:12\\\"\u003eedited\u003c\\/span\u003e                   its a pretty simple query: q=&lt;star&gt;:&lt;star&gt;&amp;facet=on&amp;facet.pivot=fieldA,fieldB , both regular single valued solr.TextFields with solr.LowerCaseFilterFactory filters. All shards work well individually. \\nI\'m looking at the logs but unfortunately I\'m not seeing any other error messages there. \\n\\n It works as long as I use less than 6 shards. With 6 or more it fails with that error, regardless of which shards I use.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13745106\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13745106&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13745106\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13745106_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13745106_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/13 16:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-20T16:36:32+0000\'\u003e20\\/Aug\\/13 16:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIt shouldn\'t be a shard amount issue, were running this patch on a 50 shard cluster over several servers with solid results.\u003cbr\\/\u003e\\nTry the shards.tolerant=true parameter on your distributed search? It supposedly includes error information if available. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13745106_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13745106_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/Aug\\/13 16:36\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-20T16:36:32+0000\'\u003e20\\/Aug\\/13 16:36\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    It shouldn\'t be a shard amount issue, were running this patch on a 50 shard cluster over several servers with solid results. \\nTry the shards.tolerant=true parameter on your distributed search? It supposedly includes error information if available.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13745938\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13745938&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13745938\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13745938_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13745938_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/13 10:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-21T10:58:24+0000\'\u003e21\\/Aug\\/13 10:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 22\\/Aug\\/13 12:31\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eshards.tolerant=true did indeed yield a more descriptive error:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eERROR - 2013-08-21 12:54:17.392; org.apache.solr.common.SolrException; \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e:java.lang.NullPointerException\\n        at org.apache.solr.handler.component.FacetComponent.refinePivotFacets(FacetComponent.java:882)\\n        at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:411)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1850)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:703)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:406)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195)\\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)\\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\\n        at java.lang.\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.run(\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.java:724\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI also reindexed everything replacing the values of all string fields with their corresponding hashes in order to see if the error could be caused by some odd strings, but the same error occurs.\u003cbr\\/\u003e\\nI am also seeing this error after i switched to MD5 hashes for document IDs:\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eERROR - 2013-08-22 14:28:25.248; org.apache.solr.common.SolrException; \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e:java.lang.NullPointerException\\n        at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:903)\\n        at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:649)\\n        at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:628)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1850)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:703)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:406)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195)\\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)\\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\\n        at java.lang.\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.run(\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.java:724\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13745938_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13745938_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'21\\/Aug\\/13 10:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-21T10:58:24+0000\'\u003e21\\/Aug\\/13 10:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 22\\/Aug\\/13 12:31\\\"\u003eedited\u003c\\/span\u003e                   shards.tolerant=true did indeed yield a more descriptive error: \\n  \\n ERROR - 2013-08-21 12:54:17.392; org.apache.solr.common.SolrException;  null :java.lang.NullPointerException\\n        at org.apache.solr.handler.component.FacetComponent.refinePivotFacets(FacetComponent.java:882)\\n        at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:411)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1850)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:703)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:406)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195)\\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)\\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\\n        at java.lang. Thread .run( Thread .java:724\\n \\n  \\n\\n I also reindexed everything replacing the values of all string fields with their corresponding hashes in order to see if the error could be caused by some odd strings, but the same error occurs. \\nI am also seeing this error after i switched to MD5 hashes for document IDs: \\n  \\n ERROR - 2013-08-22 14:28:25.248; org.apache.solr.common.SolrException;  null :java.lang.NullPointerException\\n        at org.apache.solr.handler.component.QueryComponent.mergeIds(QueryComponent.java:903)\\n        at org.apache.solr.handler.component.QueryComponent.handleRegularResponses(QueryComponent.java:649)\\n        at org.apache.solr.handler.component.QueryComponent.handleResponses(QueryComponent.java:628)\\n        at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311)\\n        at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135)\\n        at org.apache.solr.core.SolrCore.execute(SolrCore.java:1850)\\n        at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:703)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:406)\\n        at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:195)\\n        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:235)\\n        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:206)\\n        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:233)\\n        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:191)\\n        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:127)\\n        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:102)\\n        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:109)\\n        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:298)\\n        at org.apache.coyote.http11.Http11Processor.process(Http11Processor.java:857)\\n        at org.apache.coyote.http11.Http11Protocol$Http11ConnectionHandler.process(Http11Protocol.java:588)\\n        at org.apache.tomcat.util.net.JIoEndpoint$Worker.run(JIoEndpoint.java:489)\\n        at java.lang. Thread .run( Thread .java:724\\n \\n               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13747675\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13747675&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13747675\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13747675_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13747675_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/13 17:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-22T17:21:03+0000\'\u003e22\\/Aug\\/13 17:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe first error occurs on a line where the refinement response is being mined for its information. The line asks for the value and it gets an NPE. Does your data contain nulls? I have code in to deal with that situation but its possible I\'m missing an edge case. Do you have any suggestions for a test case that would create this error?\u003c\\/p\u003e\\n\\n\u003cp\u003eThe second error never gets to anything I\'ve changed so I think MD5ing your docIDs is causing all sorts of other issues unrelated to this patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13747675_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13747675_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/Aug\\/13 17:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-22T17:21:03+0000\'\u003e22\\/Aug\\/13 17:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The first error occurs on a line where the refinement response is being mined for its information. The line asks for the value and it gets an NPE. Does your data contain nulls? I have code in to deal with that situation but its possible I\'m missing an edge case. Do you have any suggestions for a test case that would create this error? \\n\\n The second error never gets to anything I\'ve changed so I think MD5ing your docIDs is causing all sorts of other issues unrelated to this patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13748428\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13748428&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13748428\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13748428_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13748428_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/13 09:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-23T09:44:47+0000\'\u003e23\\/Aug\\/13 09:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 23\\/Aug\\/13 13:29\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI thought the issue might be related to me not assigning those fields values in every document, but I tried reindexing giving them all values and the error still occurs.\u003cbr\\/\u003e\\nI tampered with the source a bit, and managed to trace the error to srsp.getSolrResponse().getResponse(), meaning getSolrResponse() is returning null. Hope that helps.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"killscreen\\\" id=\\\"commentauthor_13748428_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=killscreen\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"killscreen\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e William Harris\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13748428_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Aug\\/13 09:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-23T09:44:47+0000\'\u003e23\\/Aug\\/13 09:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"William Harris - 23\\/Aug\\/13 13:29\\\"\u003eedited\u003c\\/span\u003e                   I thought the issue might be related to me not assigning those fields values in every document, but I tried reindexing giving them all values and the error still occurs. \\nI tampered with the source a bit, and managed to trace the error to srsp.getSolrResponse().getResponse(), meaning getSolrResponse() is returning null. Hope that helps.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13749549\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13749549&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13749549\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13749549_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13749549_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Aug\\/13 06:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-25T06:38:10+0000\'\u003e25\\/Aug\\/13 06:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Andrew,\u003c\\/p\u003e\\n\\n\u003cp\u003ein class PivotFacetProcessor in function doPivots, I have noticed a change in the code.\u003cbr\\/\u003e\\nthe current implementation is:\u003cbr\\/\u003e\\n        SimpleOrderedMap&lt;Object&gt; pivot = new SimpleOrderedMap&lt;Object&gt;();\u003cbr\\/\u003e\\n        pivot.add( \\\"field\\\", field );\u003cbr\\/\u003e\\n        if (null == fieldValue) \u003c\\/p\u003e\\n{\\n          pivot.add( \\\"value\\\", null );\\n        }\\n\u003cp\u003e else \u003c\\/p\u003e\\n{\\n          termval = new BytesRef();\\n          ftype.readableToIndexed(fieldValue, termval);\\n          pivot.add( \\\"value\\\", fieldValue );\\n        }\\n\u003cp\u003e        pivot.add( \\\"count\\\", kv.getValue() );\u003c\\/p\u003e\\n\\n\u003cp\u003eIt means we are getting the values as strings in pivots.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn the past the implementation was \\\"pivot.add( \\\"value\\\", ftype.toObject(sfield, termval))\\\"  - meaning we were getting the values as objects.\u003cbr\\/\u003e\\nI am using SolrJ and it\'s very important to me to get the values as objects.\u003c\\/p\u003e\\n\\n\u003cp\u003eIs there a reason not returning the values as objects?\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you very much.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13749549_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13749549_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Aug\\/13 06:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-25T06:38:10+0000\'\u003e25\\/Aug\\/13 06:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Andrew, \\n\\n in class PivotFacetProcessor in function doPivots, I have noticed a change in the code. \\nthe current implementation is: \\n        SimpleOrderedMap&lt;Object&gt; pivot = new SimpleOrderedMap&lt;Object&gt;(); \\n        pivot.add( \\\"field\\\", field ); \\n        if (null == fieldValue)  \\n{\\n          pivot.add( \\\"value\\\", null );\\n        }\\n  else  \\n{\\n          termval = new BytesRef();\\n          ftype.readableToIndexed(fieldValue, termval);\\n          pivot.add( \\\"value\\\", fieldValue );\\n        }\\n         pivot.add( \\\"count\\\", kv.getValue() ); \\n\\n It means we are getting the values as strings in pivots. \\n\\n In the past the implementation was \\\"pivot.add( \\\"value\\\", ftype.toObject(sfield, termval))\\\"  - meaning we were getting the values as objects. \\nI am using SolrJ and it\'s very important to me to get the values as objects. \\n\\n Is there a reason not returning the values as objects? \\n\\n Thank you very much.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13750109\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13750109&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13750109\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13750109_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13750109_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Aug\\/13 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-26T14:34:12+0000\'\u003e26\\/Aug\\/13 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI wrote about that on 22\\/Jul\\/13 22:15.\u003c\\/p\u003e\\n\\n\u003cp\u003eBy having it .ToObject it was taking an internal datetime reference and giving me the pretty format, which was nonconvertible when trying to do refinement on that value. I\'m not sure where the .ToObject call should go now as the datetimes in facets never seem to come out in that pretty format.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13750109_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13750109_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Aug\\/13 14:34\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-08-26T14:34:12+0000\'\u003e26\\/Aug\\/13 14:34\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I wrote about that on 22\\/Jul\\/13 22:15. \\n\\n By having it .ToObject it was taking an internal datetime reference and giving me the pretty format, which was nonconvertible when trying to do refinement on that value. I\'m not sure where the .ToObject call should go now as the datetimes in facets never seem to come out in that pretty format.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13814729\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13814729&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13814729\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13814729_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13814729_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/13 09:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-06T09:12:24+0000\'\u003e06\\/Nov\\/13 09:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Andrew,\u003c\\/p\u003e\\n\\n\u003cp\u003eSorry for the long delay.\u003cbr\\/\u003e\\nI am still seeing the issue I reported on 20\\/May\\/13 12:27 (f.field_A.facet.limit=-1 returns at most 100 terms for field_A).\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso, can you please dircet me to the line of code where datetimes are breaking when trying to refine (caused by \\\"pivot.add( \\\"value\\\", ftype.toObject(sfield, termval))\\\")\u003cbr\\/\u003e\\nI need pivot to return values as objects.\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you very much.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13814729_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13814729_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/13 09:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-06T09:12:24+0000\'\u003e06\\/Nov\\/13 09:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Andrew, \\n\\n Sorry for the long delay. \\nI am still seeing the issue I reported on 20\\/May\\/13 12:27 (f.field_A.facet.limit=-1 returns at most 100 terms for field_A). \\n\\n Also, can you please dircet me to the line of code where datetimes are breaking when trying to refine (caused by \\\"pivot.add( \\\"value\\\", ftype.toObject(sfield, termval))\\\") \\nI need pivot to return values as objects. \\n\\n Thank you very much.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13814953\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13814953&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13814953\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13814953_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13814953_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/13 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-06T15:17:49+0000\'\u003e06\\/Nov\\/13 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBy returning an object you get a pretty date format that does not work when doing:\u003cbr\\/\u003e\\ngetListedTermCounts(field,firstFieldsValues); -PivotFacetProcessor::104\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen it attempts to convert the pretty date it has into the datatype of the field it will fail to do so.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13814953_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13814953_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Nov\\/13 15:17\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-06T15:17:49+0000\'\u003e06\\/Nov\\/13 15:17\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    By returning an object you get a pretty date format that does not work when doing: \\ngetListedTermCounts(field,firstFieldsValues); -PivotFacetProcessor::104 \\n\\n When it attempts to convert the pretty date it has into the datatype of the field it will fail to do so.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13815993\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13815993&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13815993\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13815993_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13815993_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/13 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-07T14:26:06+0000\'\u003e07\\/Nov\\/13 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI exained the code.\u003cbr\\/\u003e\\nIt seems that the refinement process occures before doPivots (where  the call \\\"ftype.toObject(sfield, termval))\\\" was).\u003cbr\\/\u003e\\nSo it seems toObject shouldn\'t affect the refinement process .\u003cbr\\/\u003e\\nWhat am I missing?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13815993_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13815993_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/13 14:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-07T14:26:06+0000\'\u003e07\\/Nov\\/13 14:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I exained the code. \\nIt seems that the refinement process occures before doPivots (where  the call \\\"ftype.toObject(sfield, termval))\\\" was). \\nSo it seems toObject shouldn\'t affect the refinement process . \\nWhat am I missing? \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13816058\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13816058&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13816058\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13816058_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13816058_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/13 15:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-07T15:41:07+0000\'\u003e07\\/Nov\\/13 15:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eDoPivots is called on every shard once to get each shard\'s response. It has built into it support for refinement but this first run through has no refinement information yet.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen the master box sends out its refinement requests, DoPivots is run again on the shards recieving requests, at this point it utilizes the refinement steps DoPivots has, and blows up on dates, because instead of getting something like \\\"1995-12-31T23:59:59Z\\\" it gets \\\"Tuesday December 12th, 1995 at 23:59\\\". The latter does not convert to the former, so the entire thing blows up.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13816058_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13816058_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Nov\\/13 15:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-07T15:41:07+0000\'\u003e07\\/Nov\\/13 15:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    DoPivots is called on every shard once to get each shard\'s response. It has built into it support for refinement but this first run through has no refinement information yet. \\n\\n When the master box sends out its refinement requests, DoPivots is run again on the shards recieving requests, at this point it utilizes the refinement steps DoPivots has, and blows up on dates, because instead of getting something like \\\"1995-12-31T23:59:59Z\\\" it gets \\\"Tuesday December 12th, 1995 at 23:59\\\". The latter does not convert to the former, so the entire thing blows up.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13818422\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13818422&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13818422\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13818422_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13818422_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/13 11:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-10T11:37:05+0000\'\u003e10\\/Nov\\/13 11:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI didn\'t manage to make ditributed pivot on date field to blow up with toObject.\u003cbr\\/\u003e\\nCan you please attach an example query that blows Solr up and I\'ll adjust it to my environment? \u003c\\/p\u003e\\n\\n\u003cp\u003eThanks. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13818422_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13818422_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Nov\\/13 11:37\'\u003e\u003ctime class=\'livestamp\' datetime=\'2013-11-10T11:37:05+0000\'\u003e10\\/Nov\\/13 11:37\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I didn\'t manage to make ditributed pivot on date field to blow up with toObject. \\nCan you please attach an example query that blows Solr up and I\'ll adjust it to my environment?  \\n\\n Thanks.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13894547\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13894547&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13894547\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13894547_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13894547_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/14 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-07T14:03:02+0000\'\u003e07\\/Feb\\/14 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eFYI, the last distributed pivot facet patch functionally works, but there are some sub-optimal data structures being used and some unnecessary duplicate processing of values.  As a result, we found that for certain worst-case scenarios (i.e. data is not randomly distributed across Solr cores and requires significant refinement) pivot facets with multiple levels could take over a minute to aggregate and process results. This was using a dataset of several hundred million documents and dozens of pivot facets across 120 Solr cores distributed over 20 servers, so it is a more extreme use-case than most will encounter.\u003c\\/p\u003e\\n\\n\u003cp\u003eNevertheless, we\'ve refactored the code and data structures and brought the processing time from over a minute down to less than a second using the above configuration. We plan to post the patch within the next week.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13894547_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13894547_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/14 14:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-07T14:03:02+0000\'\u003e07\\/Feb\\/14 14:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    FYI, the last distributed pivot facet patch functionally works, but there are some sub-optimal data structures being used and some unnecessary duplicate processing of values.  As a result, we found that for certain worst-case scenarios (i.e. data is not randomly distributed across Solr cores and requires significant refinement) pivot facets with multiple levels could take over a minute to aggregate and process results. This was using a dataset of several hundred million documents and dozens of pivot facets across 120 Solr cores distributed over 20 servers, so it is a more extreme use-case than most will encounter. \\n\\n Nevertheless, we\'ve refactored the code and data structures and brought the processing time from over a minute down to less than a second using the above configuration. We plan to post the patch within the next week.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13894554\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13894554&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13894554\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13894554_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13894554_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/14 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-07T14:11:02+0000\'\u003e07\\/Feb\\/14 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSweet, nice work Trey!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"yseeley@gmail.com\\\" id=\\\"commentauthor_13894554_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=yseeley%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"yseeley@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Yonik Seeley\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13894554_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Feb\\/14 14:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-07T14:11:02+0000\'\u003e07\\/Feb\\/14 14:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Sweet, nice work Trey!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13895413\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13895413&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13895413\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13895413_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13895413_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/14 03:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-08T03:38:36+0000\'\u003e08\\/Feb\\/14 03:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks, Yonik. I worked on the architecture and design, but it\'s really been a team effort by several of us at CB. Chris worked with the initial patch, Andrew hardened it, and Brett (who will post the next version) focused on the soon-to-be-posted performance optimizations. We\'re deploying the new version to production right now to sanity check it before posting the patch, but I think the upcoming version will finally be ready for review for committing.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13895413_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13895413_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/Feb\\/14 03:38\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-08T03:38:36+0000\'\u003e08\\/Feb\\/14 03:38\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks, Yonik. I worked on the architecture and design, but it\'s really been a team effort by several of us at CB. Chris worked with the initial patch, Andrew hardened it, and Brett (who will post the next version) focused on the soon-to-be-posted performance optimizations. We\'re deploying the new version to production right now to sanity check it before posting the patch, but I think the upcoming version will finally be ready for review for committing.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13904524\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13904524&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13904524\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13904524_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13904524_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/14 20:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-18T20:16:02+0000\'\u003e18\\/Feb\\/14 20:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is the updated version of our implementation of Pivot Facets, as mentioned by Trey.  We have significantly improved performance for cases which involve a large number of shards through changing the underlying data structure and the way that data from the shards is merged together.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13904524_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13904524_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'18\\/Feb\\/14 20:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-18T20:16:02+0000\'\u003e18\\/Feb\\/14 20:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is the updated version of our implementation of Pivot Facets, as mentioned by Trey.  We have significantly improved performance for cases which involve a large number of shards through changing the underlying data structure and the way that data from the shards is merged together.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13910397\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13910397&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13910397\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13910397_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13910397_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/14 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-24T15:21:49+0000\'\u003e24\\/Feb\\/14 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrett (and your team), thank you very much for your hard work. We\'ve been having a lot of performance issues with using the previous version patch (which we love), and initial testing shows they are now resolved.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe did also notice a few issues:\u003c\\/p\u003e\\n\\n\u003cp\u003e1) f.field.facet.limit=-1 is not being respected (as reported by me on 20\\/May\\/13 10:27)\u003c\\/p\u003e\\n\\n\u003cp\u003e2) pivot queries are returning String instead of Object (as reported by me on 25\\/Aug\\/13 07:38) except for boolean fields. \u003cbr\\/\u003e\\nI know the reason is there was a problem with datetime fields. I changed it back to toObject and I can\'t reproduce any issues running unit test locally via maven.\u003cbr\\/\u003e\\nI\'d be glad to help fix this problem, if anyone can create a simple test case that fails ?\u003c\\/p\u003e\\n\\n\u003cp\u003e3) The following query throws an exception:\u003c\\/p\u003e\\n\\n\u003cp\u003eq=\u003cb\u003e:\u003c\\/b\u003e&amp;rows=0&amp;f.fieldA.facet.sort=index&amp;f.fieldA.facet.limit=-1&amp;f.fieldA.facet.missing=true&amp;f.fieldA.facet.mincount=1&amp;f.fieldB.facet.sort=index&amp;f.fieldB.facet.limit=-1&amp;f.fieldB.facet.missing=true&amp;f.fieldB.facet.mincount=1&amp;facet=true&amp;facet.pivot=fieldA,fieldB&amp;shards=127.0.0.1:8983\\/solr\\/shardA,127.0.0.1:8983\\/solr\\/shardB\u003c\\/p\u003e\\n\\n\u003cp\u003ejava.lang.IllegalArgumentException: fromIndex(0) &gt; toIndex(-1) at java.util.ArrayList.subListRangeCheck(ArrayList.java:975) at java.util.ArrayList.subList(ArrayList.java:965) at org.apache.solr.handler.component.PivotFacetField.refineNextLevelOfFacets(PivotFacetField.java:276) at org.apache.solr.handler.component.PivotFacetField.queuePivotRefinementRequests(PivotFacetField.java:231) at org.apache.solr.handler.component.PivotFacet.queuePivotRefinementRequests(PivotFacet.java:86) at org.apache.solr.handler.component.FacetComponent.countFacets(FacetComponent.java:565) at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:413) at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311) at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135) at org.apache.solr.core.SolrCore.execute(SolrCore.java:1904) at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:659) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:362) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:158) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1474) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:499) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:428) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255) at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) at org.eclipse.jetty.server.Server.handle(Server.java:370) at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489) at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53) at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:949) at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:1011) at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:644) at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235) at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72) at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) at java.lang.Thread.run(Thread.java:804)\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you again for this great patch!\u003c\\/p\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13910397_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13910397_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/14 15:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-24T15:21:49+0000\'\u003e24\\/Feb\\/14 15:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Brett (and your team), thank you very much for your hard work. We\'ve been having a lot of performance issues with using the previous version patch (which we love), and initial testing shows they are now resolved. \\n\\n We did also notice a few issues: \\n\\n 1) f.field.facet.limit=-1 is not being respected (as reported by me on 20\\/May\\/13 10:27) \\n\\n 2) pivot queries are returning String instead of Object (as reported by me on 25\\/Aug\\/13 07:38) except for boolean fields.  \\nI know the reason is there was a problem with datetime fields. I changed it back to toObject and I can\'t reproduce any issues running unit test locally via maven. \\nI\'d be glad to help fix this problem, if anyone can create a simple test case that fails ? \\n\\n 3) The following query throws an exception: \\n\\n q= : &amp;rows=0&amp;f.fieldA.facet.sort=index&amp;f.fieldA.facet.limit=-1&amp;f.fieldA.facet.missing=true&amp;f.fieldA.facet.mincount=1&amp;f.fieldB.facet.sort=index&amp;f.fieldB.facet.limit=-1&amp;f.fieldB.facet.missing=true&amp;f.fieldB.facet.mincount=1&amp;facet=true&amp;facet.pivot=fieldA,fieldB&amp;shards=127.0.0.1:8983\\/solr\\/shardA,127.0.0.1:8983\\/solr\\/shardB \\n\\n java.lang.IllegalArgumentException: fromIndex(0) &gt; toIndex(-1) at java.util.ArrayList.subListRangeCheck(ArrayList.java:975) at java.util.ArrayList.subList(ArrayList.java:965) at org.apache.solr.handler.component.PivotFacetField.refineNextLevelOfFacets(PivotFacetField.java:276) at org.apache.solr.handler.component.PivotFacetField.queuePivotRefinementRequests(PivotFacetField.java:231) at org.apache.solr.handler.component.PivotFacet.queuePivotRefinementRequests(PivotFacet.java:86) at org.apache.solr.handler.component.FacetComponent.countFacets(FacetComponent.java:565) at org.apache.solr.handler.component.FacetComponent.handleResponses(FacetComponent.java:413) at org.apache.solr.handler.component.SearchHandler.handleRequestBody(SearchHandler.java:311) at org.apache.solr.handler.RequestHandlerBase.handleRequest(RequestHandlerBase.java:135) at org.apache.solr.core.SolrCore.execute(SolrCore.java:1904) at org.apache.solr.servlet.SolrDispatchFilter.execute(SolrDispatchFilter.java:659) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:362) at org.apache.solr.servlet.SolrDispatchFilter.doFilter(SolrDispatchFilter.java:158) at org.eclipse.jetty.servlet.ServletHandler$CachedChain.doFilter(ServletHandler.java:1474) at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:499) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:137) at org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:557) at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:231) at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1086) at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:428) at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:193) at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1020) at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:135) at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:255) at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:154) at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:116) at org.eclipse.jetty.server.Server.handle(Server.java:370) at org.eclipse.jetty.server.AbstractHttpConnection.handleRequest(AbstractHttpConnection.java:489) at org.eclipse.jetty.server.BlockingHttpConnection.handleRequest(BlockingHttpConnection.java:53) at org.eclipse.jetty.server.AbstractHttpConnection.headerComplete(AbstractHttpConnection.java:949) at org.eclipse.jetty.server.AbstractHttpConnection$RequestHandler.headerComplete(AbstractHttpConnection.java:1011) at org.eclipse.jetty.http.HttpParser.parseNext(HttpParser.java:644) at org.eclipse.jetty.http.HttpParser.parseAvailable(HttpParser.java:235) at org.eclipse.jetty.server.BlockingHttpConnection.handle(BlockingHttpConnection.java:72) at org.eclipse.jetty.server.bio.SocketConnector$ConnectorEndPoint.run(SocketConnector.java:264) at org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:608) at org.eclipse.jetty.util.thread.QueuedThreadPool$3.run(QueuedThreadPool.java:543) at java.lang.Thread.run(Thread.java:804) \\n\\n Thank you again for this great patch! \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13910562\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13910562&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13910562\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13910562_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13910562_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/14 17:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-24T17:41:57+0000\'\u003e24\\/Feb\\/14 17:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe are at DevNexus today and tomorrow, but Brett, Andrew and I will look at it on Weds. Thanks for the feedback.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13910562_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13910562_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Feb\\/14 17:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-24T17:41:57+0000\'\u003e24\\/Feb\\/14 17:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We are at DevNexus today and tomorrow, but Brett, Andrew and I will look at it on Weds. Thanks for the feedback.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13911259\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13911259&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13911259\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13911259_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13911259_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/14 05:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-25T05:25:28+0000\'\u003e25\\/Feb\\/14 05:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eElran &#8211; Thanks for the feedback.  I\'m glad to hear the performance issues have been fixed.  The exception is being thrown because the facet limit is -1 which causes an attempt to allocate a negatively sized sub list.  If you need a work around for the short term, just avoid using that for the facet limit.  I will try to fix that this week.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13911259_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13911259_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/14 05:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-25T05:25:28+0000\'\u003e25\\/Feb\\/14 05:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Elran &#8211; Thanks for the feedback.  I\'m glad to hear the performance issues have been fixed.  The exception is being thrown because the facet limit is -1 which causes an attempt to allocate a negatively sized sub list.  If you need a work around for the short term, just avoid using that for the facet limit.  I will try to fix that this week.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13911620\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13911620&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13911620\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13911620_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13911620_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/14 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-25T14:39:15+0000\'\u003e25\\/Feb\\/14 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is an update to the previous patch I uploaded which excludes whitespace changes and eliminates dead code.  This does not yet include a fix for the -1 facet limit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13911620_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13911620_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Feb\\/14 14:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-25T14:39:15+0000\'\u003e25\\/Feb\\/14 14:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is an update to the previous patch I uploaded which excludes whitespace changes and eliminates dead code.  This does not yet include a fix for the -1 facet limit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13912660\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13912660&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13912660\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13912660_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13912660_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/14 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-26T09:03:22+0000\'\u003e26\\/Feb\\/14 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBy the way, when I profiled our very slow distributed pivot, I noticed most of the time is wasted in val.get\u003cimg class=\\\"emoticon\\\" src=\\\"\\/jira\\/images\\/icons\\/emoticons\\/information.png\\\" height=\\\"16\\\" width=\\\"16\\\" align=\\\"absmiddle\\\" alt=\\\"\\\" border=\\\"0\\\"\\/\u003e in trimExcessValuesBasedUponFacetLimitAndOffset in PivotFacetHelper.java.\u003cbr\\/\u003e\\nThe following change (in the first two lines of the function) has shown a significant improvement:\u003cbr\\/\u003e\\n List&lt;NamedList&lt;Object&gt;&gt; newVal = new LinkedList&lt;NamedList&lt;Object&gt;&gt;();\u003cbr\\/\u003e\\n if (val == null) return val;\u003cbr\\/\u003e\\nto:\u003cbr\\/\u003e\\nif (val == null) return val;\u003cbr\\/\u003e\\nList&lt;NamedList&lt;Object&gt;&gt; newVal = new ArrayList&lt;NamedList&lt;Object&gt;&gt;(val.size());\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13912660_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13912660_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Feb\\/14 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-26T09:03:22+0000\'\u003e26\\/Feb\\/14 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    By the way, when I profiled our very slow distributed pivot, I noticed most of the time is wasted in val.get  in trimExcessValuesBasedUponFacetLimitAndOffset in PivotFacetHelper.java. \\nThe following change (in the first two lines of the function) has shown a significant improvement: \\n List&lt;NamedList&lt;Object&gt;&gt; newVal = new LinkedList&lt;NamedList&lt;Object&gt;&gt;(); \\n if (val == null) return val; \\nto: \\nif (val == null) return val; \\nList&lt;NamedList&lt;Object&gt;&gt; newVal = new ArrayList&lt;NamedList&lt;Object&gt;&gt;(val.size()); \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13916293\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13916293&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13916293\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13916293_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13916293_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/14 20:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-28T20:06:25+0000\'\u003e28\\/Feb\\/14 20:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Elran,\u003c\\/p\u003e\\n\\n\u003cp\u003eRegarding the string\\/object issue:  We have not been able to revert back to toObject for all data types because doing so results in the following exception being thrown by the testDistribSearch case of DistributedFacetPivotTest.\u003cbr\\/\u003e\\norg.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Invalid Date String:\'Sat Sep 01 08:30:00 BOT 2012\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is part of the test case which demonstrates the issue:\u003cbr\\/\u003e\\n    \\/\\/datetime\u003cbr\\/\u003e\\n    this.query( \\\"q\\\", \\\"\u003cb\u003e:\u003c\\/b\u003e\\\",\u003cbr\\/\u003e\\n                \\\"rows\\\", \\\"0\\\",\u003cbr\\/\u003e\\n                \\\"facet\\\",\\\"true\\\",\u003cbr\\/\u003e\\n                \\\"facet.pivot\\\",\\\"hiredate_dt,place_s,company_t\\\",\u003cbr\\/\u003e\\n                \\\"f.hiredate_dt.facet.limit\\\",\\\"2\\\",\u003cbr\\/\u003e\\n                \\\"f.hiredate_dt.facet.offset\\\",\\\"1\\\",\u003cbr\\/\u003e\\n            FacetParams.FACET_LIMIT, \\\"4\\\"); \\/\\/test default sort (count)\u003c\\/p\u003e\\n\\n\u003cp\u003eI am producing that error by running:\u003cbr\\/\u003e\\nant -Dtests.class=\\\"org.apache.solr.handler.component.DistributedFacetPivotTest\\\" clean test\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13916293_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13916293_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'28\\/Feb\\/14 20:06\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-02-28T20:06:25+0000\'\u003e28\\/Feb\\/14 20:06\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Elran, \\n\\n Regarding the string\\/object issue:  We have not been able to revert back to toObject for all data types because doing so results in the following exception being thrown by the testDistribSearch case of DistributedFacetPivotTest. \\norg.apache.solr.client.solrj.impl.HttpSolrServer$RemoteSolrException: Invalid Date String:\'Sat Sep 01 08:30:00 BOT 2012 \\n\\n This is part of the test case which demonstrates the issue: \\n    \\/\\/datetime \\n    this.query( \\\"q\\\", \\\" : \\\", \\n                \\\"rows\\\", \\\"0\\\", \\n                \\\"facet\\\",\\\"true\\\", \\n                \\\"facet.pivot\\\",\\\"hiredate_dt,place_s,company_t\\\", \\n                \\\"f.hiredate_dt.facet.limit\\\",\\\"2\\\", \\n                \\\"f.hiredate_dt.facet.offset\\\",\\\"1\\\", \\n            FacetParams.FACET_LIMIT, \\\"4\\\"); \\/\\/test default sort (count) \\n\\n I am producing that error by running: \\nant -Dtests.class=\\\"org.apache.solr.handler.component.DistributedFacetPivotTest\\\" clean test              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13920417\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13920417&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13920417\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13920417_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13920417_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/14 02:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-05T02:49:10+0000\'\u003e05\\/Mar\\/14 02:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe have been trying to finish up the distributed pivot facet patch to submit it for committing, but we\'ve run into one issue raised in the JIRA issue for the patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eDistributed field facets appear to convert all values to strings, and refine on those strings when needed.  The solrj test cases around the distributed field facets also expect all values to be represented as strings.  Please correct me if I\'m wrong.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe most recent revision of the patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e converts all values to strings as well, except in the case of booleans.  If we don\'t have this exception, the solrj test case of distributed pivot facets will fail because there is an assert verifying that the value returned is Boolean.TRUE rather than \\\"true\\\".  If we do not convert object values to strings, we are unable to refine on date time\'s because the format will be incorrect and the date time class is unable to convert it back.\u003c\\/p\u003e\\n\\n\u003cp\u003eOur feeling is that this assert is incorrect and that it should be looking for the string true.  Changing this test case would allow us to bring the behavior of distributed pivot facets into consistency with the behavior of distributed field facets.  We didn\'t want to just go ahead and make that change because it would change the behavior of solrj.\u003c\\/p\u003e\\n\\n\u003cp\u003eIt appears our options are:\u003cbr\\/\u003e\\n1.  Convert all values to strings.  Modify the solrj test case to expect this.  We feel this makes things consistent and is the ideal option.\u003cbr\\/\u003e\\n2.  Convert all values exception booleans to strings.\u003cbr\\/\u003e\\n3.  Leave all values except datettimes as is.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe are just looking for some input from the community prior to adding this change to our patch.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13920417_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13920417_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/14 02:49\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-05T02:49:10+0000\'\u003e05\\/Mar\\/14 02:49\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We have been trying to finish up the distributed pivot facet patch to submit it for committing, but we\'ve run into one issue raised in the JIRA issue for the patch. \\n\\n Distributed field facets appear to convert all values to strings, and refine on those strings when needed.  The solrj test cases around the distributed field facets also expect all values to be represented as strings.  Please correct me if I\'m wrong. \\n\\n The most recent revision of the patch for   SOLR-2894   converts all values to strings as well, except in the case of booleans.  If we don\'t have this exception, the solrj test case of distributed pivot facets will fail because there is an assert verifying that the value returned is Boolean.TRUE rather than \\\"true\\\".  If we do not convert object values to strings, we are unable to refine on date time\'s because the format will be incorrect and the date time class is unable to convert it back. \\n\\n Our feeling is that this assert is incorrect and that it should be looking for the string true.  Changing this test case would allow us to bring the behavior of distributed pivot facets into consistency with the behavior of distributed field facets.  We didn\'t want to just go ahead and make that change because it would change the behavior of solrj. \\n\\n It appears our options are: \\n1.  Convert all values to strings.  Modify the solrj test case to expect this.  We feel this makes things consistent and is the ideal option. \\n2.  Convert all values exception booleans to strings. \\n3.  Leave all values except datettimes as is. \\n\\n We are just looking for some input from the community prior to adding this change to our patch.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13920946\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13920946&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13920946\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13920946_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13920946_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/14 15:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-05T15:11:08+0000\'\u003e05\\/Mar\\/14 15:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think we should preserve object values in disruibuted pivot, as in regular pivot.\u003cbr\\/\u003e\\nI want to help fix the toObject problem with datetime fields.\u003cbr\\/\u003e\\nI tried to apply the most recent patch to the latest Solr trunk revision. There were some problems applying it.\u003cbr\\/\u003e\\nCan you please create a new patch against latest Solr trunk revision, or indicate which revision the patch was created againt?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13920946_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13920946_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/14 15:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-05T15:11:08+0000\'\u003e05\\/Mar\\/14 15:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think we should preserve object values in disruibuted pivot, as in regular pivot. \\nI want to help fix the toObject problem with datetime fields. \\nI tried to apply the most recent patch to the latest Solr trunk revision. There were some problems applying it. \\nCan you please create a new patch against latest Solr trunk revision, or indicate which revision the patch was created againt? \\n\\n Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13921047\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13921047&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13921047\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13921047_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13921047_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/14 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-05T17:01:19+0000\'\u003e05\\/Mar\\/14 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThis is an updated patch which should apply cleanly against trunk.  I\'ve used this against revision 885cdea13918fee0c49d5ac0c5fa1fd286d5b466.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis should include a fix for the unlimited facet that Elran brought up.  It does not address the toObject issue being discussed.\u003c\\/p\u003e\\n\\n\u003cp\u003eDoes anyone have additional input or thoughts as to which route to go with the toObject\\/string issue?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13921047_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13921047_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'05\\/Mar\\/14 17:01\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-05T17:01:19+0000\'\u003e05\\/Mar\\/14 17:01\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    This is an updated patch which should apply cleanly against trunk.  I\'ve used this against revision 885cdea13918fee0c49d5ac0c5fa1fd286d5b466. \\n\\n This should include a fix for the unlimited facet that Elran brought up.  It does not address the toObject issue being discussed. \\n\\n Does anyone have additional input or thoughts as to which route to go with the toObject\\/string issue?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13922092\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13922092&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13922092\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13922092_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13922092_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/14 07:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-06T07:13:24+0000\'\u003e06\\/Mar\\/14 07:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the patch.\u003cbr\\/\u003e\\nI will take a lool at the toObject problem with datetime fields.\u003cbr\\/\u003e\\nDoes the patch fix issues 1 and 3 I reported on February 24?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13922092_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13922092_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/14 07:13\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-06T07:13:24+0000\'\u003e06\\/Mar\\/14 07:13\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the patch. \\nI will take a lool at the toObject problem with datetime fields. \\nDoes the patch fix issues 1 and 3 I reported on February 24? \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13922686\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13922686&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13922686\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13922686_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13922686_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/14 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-06T16:11:20+0000\'\u003e06\\/Mar\\/14 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eElran - A facet limit of -1 in distributed pivot facets is not a use case we use in our environment, but we did go ahead and make the fixes in order to support the community.  I\'ve tested the changes locally on a box with success and added unit tests around it, but we have not yet deployed those changes to a production cluster.  The exception you were seeing was directly related to the facet limit being negative, and that has been fixed in the patch I uploaded yesterday.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13922686_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13922686_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/Mar\\/14 16:11\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-06T16:11:20+0000\'\u003e06\\/Mar\\/14 16:11\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Elran - A facet limit of -1 in distributed pivot facets is not a use case we use in our environment, but we did go ahead and make the fixes in order to support the community.  I\'ve tested the changes locally on a box with success and added unit tests around it, but we have not yet deployed those changes to a production cluster.  The exception you were seeing was directly related to the facet limit being negative, and that has been fixed in the patch I uploaded yesterday.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13925156\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13925156&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13925156\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13925156_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925156_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Mar\\/14 09:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-09T09:08:05+0000\'\u003e09\\/Mar\\/14 09:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think I solved the the toObject problem with datetime fields.\u003cbr\\/\u003e\\nPlease see the patch attached.\u003cbr\\/\u003e\\nAll tests pass now.\u003cbr\\/\u003e\\nLet me know what you think.\u003cbr\\/\u003e\\nThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13925156_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925156_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Mar\\/14 09:08\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-09T09:08:05+0000\'\u003e09\\/Mar\\/14 09:08\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think I solved the the toObject problem with datetime fields. \\nPlease see the patch attached. \\nAll tests pass now. \\nLet me know what you think. \\nThanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13925211\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13925211&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13925211\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13925211_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925211_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Mar\\/14 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-09T15:00:17+0000\'\u003e09\\/Mar\\/14 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have checked the latest patch.\u003cbr\\/\u003e\\nProblem 3 (field with negative limit threw exception) is now solved. Thanks!\u003cbr\\/\u003e\\nBut I still see problem 1 (f.field.facet.limit=-1 is not being respected).\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you very much.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13925211_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925211_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/Mar\\/14 15:00\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-09T15:00:17+0000\'\u003e09\\/Mar\\/14 15:00\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have checked the latest patch. \\nProblem 3 (field with negative limit threw exception) is now solved. Thanks! \\nBut I still see problem 1 (f.field.facet.limit=-1 is not being respected). \\n\\n Thank you very much.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13925768\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13925768&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13925768\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13925768_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925768_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/14 14:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-10T14:44:37+0000\'\u003e10\\/Mar\\/14 14:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eElran - Can you give me an example test case or query for which the -1 facet limit fails?  I\'ll be glad to take a look and fix it if I can reproduce an issue with it.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13925768_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925768_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/14 14:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-10T14:44:37+0000\'\u003e10\\/Mar\\/14 14:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Elran - Can you give me an example test case or query for which the -1 facet limit fails?  I\'ll be glad to take a look and fix it if I can reproduce an issue with it.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13925787\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13925787&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13925787\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13925787_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925787_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/14 15:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-10T15:22:13+0000\'\u003e10\\/Mar\\/14 15:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi,\u003c\\/p\u003e\\n\\n\u003cp\u003eI don\'t know where I should exactly put the test in DistributedFacetPivotTest, but this the test:\u003cbr\\/\u003e\\n1)index more than 100 docs (you can index docs only with id)\u003cbr\\/\u003e\\n2)run  the following query:\u003cbr\\/\u003e\\nthis.query( \\\"q\\\", \\\"\u003cb\u003e:\u003c\\/b\u003e\\\",\u003cbr\\/\u003e\\n            \\\"rows\\\", \\\"0\\\",\u003cbr\\/\u003e\\n            \\\"facet\\\",\\\"true\\\",\u003cbr\\/\u003e\\n            \\\"facet.pivot\\\",\\\"id\\\",\u003cbr\\/\u003e\\n            \\\"f.id.facet.limit\\\",\\\"-1\\\");\u003c\\/p\u003e\\n\\n\u003cp\u003eyou expect to get as many ids as you indexed, but you will get only 100.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13925787_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925787_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/14 15:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-10T15:22:13+0000\'\u003e10\\/Mar\\/14 15:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi, \\n\\n I don\'t know where I should exactly put the test in DistributedFacetPivotTest, but this the test: \\n1)index more than 100 docs (you can index docs only with id) \\n2)run  the following query: \\nthis.query( \\\"q\\\", \\\" : \\\", \\n            \\\"rows\\\", \\\"0\\\", \\n            \\\"facet\\\",\\\"true\\\", \\n            \\\"facet.pivot\\\",\\\"id\\\", \\n            \\\"f.id.facet.limit\\\",\\\"-1\\\"); \\n\\n you expect to get as many ids as you indexed, but you will get only 100. \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13925995\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13925995&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13925995\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13925995_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925995_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/14 18:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-10T18:21:07+0000\'\u003e10\\/Mar\\/14 18:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eElran, interesting, does that happen if you use facet.limit=-1 instead of the f.fieldname.facet.limit syntax?  I am wondering if some code is checking the global limit but not the per-field limit.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"selah\\\" id=\\\"commentauthor_13925995_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=selah\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"selah\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Chris Russell\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13925995_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Mar\\/14 18:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-10T18:21:07+0000\'\u003e10\\/Mar\\/14 18:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Elran, interesting, does that happen if you use facet.limit=-1 instead of the f.fieldname.facet.limit syntax?  I am wondering if some code is checking the global limit but not the per-field limit.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13930026\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13930026&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13930026\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13930026_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13930026_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/14 06:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-11T06:56:18+0000\'\u003e11\\/Mar\\/14 06:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eNo.\u003cbr\\/\u003e\\nIt doesn\'t happen when I use facet.limit=-1 instead of the f.fieldname.facet.limit syntax.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13930026_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13930026_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/14 06:56\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-11T06:56:18+0000\'\u003e11\\/Mar\\/14 06:56\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    No. \\nIt doesn\'t happen when I use facet.limit=-1 instead of the f.fieldname.facet.limit syntax. \\n\\n Thanks.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13930835\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13930835&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13930835\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13930835_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13930835_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/14 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-11T19:35:41+0000\'\u003e11\\/Mar\\/14 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve uploaded the newest version of the patch.  This includes a fix for the -1 facet limit when specified on a specific field and incorporates Elran\'s toObject fix.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13930835_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13930835_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Mar\\/14 19:35\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-11T19:35:41+0000\'\u003e11\\/Mar\\/14 19:35\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve uploaded the newest version of the patch.  This includes a fix for the -1 facet limit when specified on a specific field and incorporates Elran\'s toObject fix.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13932304\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13932304&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13932304\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ajlemke\\\" id=\\\"commentauthor_13932304_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ajlemke\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ajlemke\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e AJ Lemke\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13932304_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/14 20:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-12T20:26:32+0000\'\u003e12\\/Mar\\/14 20:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThanks for the hard work on this.  \u003c\\/p\u003e\\n\\n\u003cp\u003eAfter applying the patch (to trunk) I noticed that the results for the pivot facet have changed from the example given here:\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/wiki.apache.org\\/solr\\/SimpleFacetParameters#Pivot_.28ie_Decision_Tree.29_Faceting-1\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/wiki.apache.org\\/solr\\/SimpleFacetParameters#Pivot_.28ie_Decision_Tree.29_Faceting-1\u003c\\/a\u003e\u003cbr\\/\u003e\\nMy results:  \u003ca href=\\\"http:\\/\\/pastebin.com\\/zs9rWMC5\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/pastebin.com\\/zs9rWMC5\u003c\\/a\u003e\u003cbr\\/\u003e\\nIs this expected behavior?\u003c\\/p\u003e\\n\\n\u003cp\u003eAlso I am getting \\\"java.lang.String cannot be cast to org.apache.lucene.util.BytesRef\\\" errors when sorting boolean fields.\u003cbr\\/\u003e\\n\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?wt=json&amp;q=*:*&amp;fl=*\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?wt=json&amp;q=*:*&amp;fl=*\u003c\\/a\u003e, score&amp;sort=inStock desc\u003cbr\\/\u003e\\nMy results: \u003ca href=\\\"http:\\/\\/pastebin.com\\/x9QnGfZA\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/pastebin.com\\/x9QnGfZA\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eMy environment: \u003ca href=\\\"http:\\/\\/pastebin.com\\/AyMAwXD3\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/pastebin.com\\/AyMAwXD3\u003c\\/a\u003e\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ajlemke\\\" id=\\\"commentauthor_13932304_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ajlemke\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ajlemke\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e AJ Lemke\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13932304_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Mar\\/14 20:26\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-12T20:26:32+0000\'\u003e12\\/Mar\\/14 20:26\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Thanks for the hard work on this.   \\n\\n After applying the patch (to trunk) I noticed that the results for the pivot facet have changed from the example given here: \\n http:\\/\\/wiki.apache.org\\/solr\\/SimpleFacetParameters#Pivot_.28ie_Decision_Tree.29_Faceting-1  \\nMy results:   http:\\/\\/pastebin.com\\/zs9rWMC5  \\nIs this expected behavior? \\n\\n Also I am getting \\\"java.lang.String cannot be cast to org.apache.lucene.util.BytesRef\\\" errors when sorting boolean fields. \\n http:\\/\\/localhost:8983\\/solr\\/select?wt=json&amp;q=*:*&amp;fl=* , score&amp;sort=inStock desc \\nMy results:  http:\\/\\/pastebin.com\\/x9QnGfZA  \\n\\n My environment:  http:\\/\\/pastebin.com\\/AyMAwXD3               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13935726\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13935726&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13935726\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13935726_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13935726_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/14 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-14T22:04:08+0000\'\u003e14\\/Mar\\/14 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAJ - It appears that the pivot output is different in trunk because the example data has changed.  I manually checked it against the trunk example data and the counts you are seeing look to be correct.  The wiki is just based on older example files.\u003c\\/p\u003e\\n\\n\u003cp\u003eI tried your second query on a 4.2 box and a trunk box and neither of them had an exception thrown.  Do you get that error with the same version of Solr without using this patch?  If so, that might be something worth raising on the solr users list.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13935726_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13935726_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/Mar\\/14 22:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-14T22:04:08+0000\'\u003e14\\/Mar\\/14 22:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    AJ - It appears that the pivot output is different in trunk because the example data has changed.  I manually checked it against the trunk example data and the counts you are seeing look to be correct.  The wiki is just based on older example files. \\n\\n I tried your second query on a 4.2 box and a trunk box and neither of them had an exception thrown.  Do you get that error with the same version of Solr without using this patch?  If so, that might be something worth raising on the solr users list.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13945336\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13945336&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13945336\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ajlemke\\\" id=\\\"commentauthor_13945336_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ajlemke\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ajlemke\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e AJ Lemke\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13945336_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Mar\\/14 16:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-24T16:50:45+0000\'\u003e24\\/Mar\\/14 16:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"AJ Lemke - 24\\/Mar\\/14 16:54\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrett,\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen looking at the the output of the pivot, the data type has changed from a struct to an array. \u003cbr\\/\u003e\\nIs this the expected behavior or is the data type for each of the pivot facets to remain as a struct and I am experiencing a bug? \u003c\\/p\u003e\\n\\n\u003cp\u003eExamples:\u003cbr\\/\u003e\\n4.7 pre patch:\u003cbr\\/\u003e\\n{\u003cbr\\/\u003e\\n  field: \\\"cat\\\",\u003cbr\\/\u003e\\n  value: \\\"electronics\\\",\u003cbr\\/\u003e\\n  count: 12,\u003cbr\\/\u003e\\n  pivot: [\u003cbr\\/\u003e\\n    \u003c\\/p\u003e\\n{field: \\\"popularity\\\",value: 7,count: 4}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n    \u003c\\/p\u003e\\n{field: \\\"popularity\\\",value: 6,count: 3}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n    \u003c\\/p\u003e\\n{field: \\\"popularity\\\",value: 1,count: 2}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n    \u003c\\/p\u003e\\n{field: \\\"popularity\\\",value: 0,count: 1}\\n\u003cp\u003e,\u003cbr\\/\u003e\\n    \u003c\\/p\u003e\\n{field: \\\"popularity\\\",value: 5,count: 1}\\n\u003cp\u003e,\u003c\\/p\u003e\\n    {field: \\\"popularity\\\",value: 10,count: 1}\\n\u003cp\u003e  ]\u003cbr\\/\u003e\\n},\u003c\\/p\u003e\\n\\n\u003cp\u003ePost Patch:\u003cbr\\/\u003e\\n[\u003cbr\\/\u003e\\n  \\\"field\\\",\u003cbr\\/\u003e\\n  \\\"cat\\\",\u003cbr\\/\u003e\\n  \\\"value\\\",\u003cbr\\/\u003e\\n  \\\"electronics\\\",\u003cbr\\/\u003e\\n  \\\"count\\\",\u003cbr\\/\u003e\\n  12,\u003cbr\\/\u003e\\n  \\\"pivot\\\",\u003cbr\\/\u003e\\n  [\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,7,&quot;count&quot;,4&#93;\u003c\\/span\u003e,\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,6,&quot;count&quot;,3&#93;\u003c\\/span\u003e,\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,1,&quot;count&quot;,2&#93;\u003c\\/span\u003e,\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,0,&quot;count&quot;,1&#93;\u003c\\/span\u003e,\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,5,&quot;count&quot;,1&#93;\u003c\\/span\u003e,\u003cbr\\/\u003e\\n    \u003cspan class=\\\"error\\\"\u003e&#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,10,&quot;count&quot;,1&#93;\u003c\\/span\u003e\u003cbr\\/\u003e\\n  ]\u003cbr\\/\u003e\\n],\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eEdit: formatting.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ajlemke\\\" id=\\\"commentauthor_13945336_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ajlemke\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ajlemke\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e AJ Lemke\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13945336_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Mar\\/14 16:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-03-24T16:50:45+0000\'\u003e24\\/Mar\\/14 16:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"AJ Lemke - 24\\/Mar\\/14 16:54\\\"\u003eedited\u003c\\/span\u003e                   Brett, \\n\\n When looking at the the output of the pivot, the data type has changed from a struct to an array.  \\nIs this the expected behavior or is the data type for each of the pivot facets to remain as a struct and I am experiencing a bug?  \\n\\n Examples: \\n4.7 pre patch: \\n{ \\n  field: \\\"cat\\\", \\n  value: \\\"electronics\\\", \\n  count: 12, \\n  pivot: [ \\n     \\n{field: \\\"popularity\\\",value: 7,count: 4}\\n , \\n     \\n{field: \\\"popularity\\\",value: 6,count: 3}\\n , \\n     \\n{field: \\\"popularity\\\",value: 1,count: 2}\\n , \\n     \\n{field: \\\"popularity\\\",value: 0,count: 1}\\n , \\n     \\n{field: \\\"popularity\\\",value: 5,count: 1}\\n , \\n    {field: \\\"popularity\\\",value: 10,count: 1}\\n   ] \\n}, \\n\\n Post Patch: \\n[ \\n  \\\"field\\\", \\n  \\\"cat\\\", \\n  \\\"value\\\", \\n  \\\"electronics\\\", \\n  \\\"count\\\", \\n  12, \\n  \\\"pivot\\\", \\n  [ \\n     &#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,7,&quot;count&quot;,4&#93; , \\n     &#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,6,&quot;count&quot;,3&#93; , \\n     &#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,1,&quot;count&quot;,2&#93; , \\n     &#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,0,&quot;count&quot;,1&#93; , \\n     &#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,5,&quot;count&quot;,1&#93; , \\n     &#91;&quot;field&quot;,&quot;popularity&quot;,&quot;value&quot;,10,&quot;count&quot;,1&#93;  \\n  ] \\n], \\n\\n\\n Edit: formatting.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13959081\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13959081&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13959081\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13959081_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13959081_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Apr\\/14 18:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-03T18:51:07+0000\'\u003e03\\/Apr\\/14 18:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi AJ,\u003c\\/p\u003e\\n\\n\u003cp\u003eI just pulled the latest code from the repo, and when I patched the tip of the 4.7 branch with the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e patch, I am not able to reproduce this issue.  (Revision 5981529c65d4ae671895948f43d8770daa58746b)  This is the output I get using a pivot facet of cat,popularity.  I used this url while running the example: \u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?wt=json&amp;q=*:*&amp;rows=0&amp;facet=true&amp;facet.pivot=cat,popularity\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?wt=json&amp;q=*:*&amp;rows=0&amp;facet=true&amp;facet.pivot=cat,popularity\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e[\u003cbr\\/\u003e\\n        {\u003cbr\\/\u003e\\n          \\\"field\\\": \\\"cat\\\",\u003cbr\\/\u003e\\n          \\\"value\\\": \\\"electronics\\\",\u003cbr\\/\u003e\\n          \\\"count\\\": 12,\u003cbr\\/\u003e\\n          \\\"pivot\\\": [\u003cbr\\/\u003e\\n            \u003c\\/p\u003e\\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 7, \\\"count\\\": 4 }\\n\u003cp\u003e,\u003cbr\\/\u003e\\n            \u003c\\/p\u003e\\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 6, \\\"count\\\": 3 }\\n\u003cp\u003e,\u003cbr\\/\u003e\\n            \u003c\\/p\u003e\\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 1, \\\"count\\\": 2 }\\n\u003cp\u003e,\u003cbr\\/\u003e\\n            \u003c\\/p\u003e\\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 0, \\\"count\\\": 1 }\\n\u003cp\u003e,\u003cbr\\/\u003e\\n            \u003c\\/p\u003e\\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 5, \\\"count\\\": 1 }\\n\u003cp\u003e,\u003c\\/p\u003e\\n            { \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 10, \\\"count\\\": 1 }\\n\u003cp\u003e          ]\u003cbr\\/\u003e\\n        }, \u003cbr\\/\u003e\\n\\t... \u003cbr\\/\u003e\\n]\u003c\\/p\u003e\\n\\n\u003cp\u003eCould you try with this same revision, applying only the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e patch and let me know if you see something different?\u003c\\/p\u003e\\n\\n\u003cp\u003e-Brett\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13959081_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13959081_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'03\\/Apr\\/14 18:51\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-03T18:51:07+0000\'\u003e03\\/Apr\\/14 18:51\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi AJ, \\n\\n I just pulled the latest code from the repo, and when I patched the tip of the 4.7 branch with the   SOLR-2894   patch, I am not able to reproduce this issue.  (Revision 5981529c65d4ae671895948f43d8770daa58746b)  This is the output I get using a pivot facet of cat,popularity.  I used this url while running the example:  http:\\/\\/localhost:8983\\/solr\\/select?wt=json&amp;q=*:*&amp;rows=0&amp;facet=true&amp;facet.pivot=cat,popularity  \\n\\n [ \\n        { \\n          \\\"field\\\": \\\"cat\\\", \\n          \\\"value\\\": \\\"electronics\\\", \\n          \\\"count\\\": 12, \\n          \\\"pivot\\\": [ \\n             \\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 7, \\\"count\\\": 4 }\\n , \\n             \\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 6, \\\"count\\\": 3 }\\n , \\n             \\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 1, \\\"count\\\": 2 }\\n , \\n             \\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 0, \\\"count\\\": 1 }\\n , \\n             \\n{ \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 5, \\\"count\\\": 1 }\\n , \\n            { \\\"field\\\": \\\"popularity\\\", \\\"value\\\": 10, \\\"count\\\": 1 }\\n           ] \\n        },  \\n\\t...  \\n] \\n\\n Could you try with this same revision, applying only the   SOLR-2894   patch and let me know if you see something different? \\n\\n -Brett              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13960125\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13960125&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13960125\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ajlemke\\\" id=\\\"commentauthor_13960125_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ajlemke\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ajlemke\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e AJ Lemke\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13960125_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Apr\\/14 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-04T16:58:38+0000\'\u003e04\\/Apr\\/14 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Brett,\u003c\\/p\u003e\\n\\n\u003cp\u003eI grabbed revision \\\"5981529c65d4ae671895948f43d8770daa58746b\\\" from the git repository and ran my tests.  \u003cbr\\/\u003e\\nI am seeing still seeing the pivots as arrays rather than JSON objects.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf I change numShards to 1 I see the the pivots as an array of objects.\u003cbr\\/\u003e\\n(\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=1&amp;replicationFactor=2&amp;maxShardsPerNode=4\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=1&amp;replicationFactor=2&amp;maxShardsPerNode=4\u003c\\/a\u003e)\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"cat\\\"\u003c\\/span\u003e,\\n    value: \u003cspan class=\\\"code-quote\\\"\u003e\\\"electronics\\\"\u003c\\/span\u003e,\\n    count: 12,\\n    pivot: [\\n        {field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,value: 7,count: 4},\\n        {field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,value: 6,count: 3},\\n        {field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,value: 1,count: 2},\\n        {field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,value: 0,count: 1},\\n        {field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,value: 5,count: 1},\\n        {field: \u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,value: 10,count: 1}\\n    ]\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eIf I change numShards to &gt; 1 I see the the pivots as an array of arrays.\u003cbr\\/\u003e\\n(\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=2&amp;replicationFactor=2&amp;maxShardsPerNode=4\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=2&amp;replicationFactor=2&amp;maxShardsPerNode=4\u003c\\/a\u003e)\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"cat\\\"\u003c\\/span\u003e,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"electronics\\\"\u003c\\/span\u003e,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,\\n    12,\\n    \u003cspan class=\\\"code-quote\\\"\u003e\\\"pivot\\\"\u003c\\/span\u003e,\\n    [\\n        [\u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,7,\u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,4],\\n        [\u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,6,\u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,3],\\n        [\u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,1,\u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,2],\\n        [\u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,0,\u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,1],\\n        [\u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,5,\u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,1],\\n        [\u003cspan class=\\\"code-quote\\\"\u003e\\\"field\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"popularity\\\"\u003c\\/span\u003e,\u003cspan class=\\\"code-quote\\\"\u003e\\\"value\\\"\u003c\\/span\u003e,10,\u003cspan class=\\\"code-quote\\\"\u003e\\\"count\\\"\u003c\\/span\u003e,1]\\n    ]\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI am using Windows 7 as my test environment and starting with this batch file:\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eBatch File\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eecho Deleting Temp Data\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\n\\necho Copying the example folder\\nxcopy \\/s \\/e \\/y \\/i D:\\\\dev\\\\lucene-solr\\\\solr\\\\example D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\nxcopy \\/s \\/e \\/y \\/i D:\\\\dev\\\\lucene-solr\\\\solr\\\\example D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\n\\necho removing the collection1 folder\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\\\solr\\\\collection1\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\\\solr\\\\collection1\\n\\necho Starting Solr Processes\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\nstart cmd \\/c java -DzkRun -jar start.jar\\nsleep 10\\n\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\nstart cmd \\/c java -Djetty.port=7574 -DzkRun -DzkHost=localhost:9983 -jar start.jar\\n\\necho All Solr Processes started\\n\\nsleep 10\\n\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\example\\\\scripts\\\\cloud-scripts\\ncmd \\/c zkcli.bat -zkhost localhost:9983 -cmd upconfig -confdir D:\\\\dev\\\\lucene-solr\\\\solr\\\\example\\\\solr\\\\collection1\\\\conf -confname collection1\\ncmd \\/c zkcli.bat -zkhost localhost:9983 -cmd linkconfig -collection collection1 -confname collection1\\necho Zookeeper updated to contain collection1\\n\\ncmd \\/c curl \u003cspan class=\\\"code-quote\\\"\u003e\\\"http:\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=2&amp;replicationFactor=2&amp;maxShardsPerNode=4\\\"\u003c\\/span\u003e\\n\u003c\\/span\u003ecmd \\/c curl \u003cspan class=\\\"code-quote\\\"\u003e\\\"http:\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=RELOAD&amp;name=collection1\\\"\u003c\\/span\u003e\\n\u003c\\/span\u003e\\nsleep 10\\n\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\example\\\\exampledocs\\ncmd \\/c java -Dtype=text\\/xml -Doptimize=yes -Durl=http:\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/localhost:8983\\/solr\\/collection1\\/update -jar post.jar *.xml\\n\u003c\\/span\u003ecmd \\/c java -Dtype=text\\/csv -Doptimize=yes -Durl=http:\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/localhost:8983\\/solr\\/collection1\\/update -jar post.jar *.csv\\n\u003c\\/span\u003ecmd \\/c java -Dtype=application\\/json -Doptimize=yes -Durl=http:\u003cspan class=\\\"code-comment\\\"\u003e\\/\\/localhost:8983\\/solr\\/collection1\\/update -jar post.jar *.json\\n\u003c\\/span\u003eecho Collection1 has been bootstrapped and optimized\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eCould you show me how you are starting yours?\u003c\\/p\u003e\\n\\n\u003cp\u003eAJ\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"ajlemke\\\" id=\\\"commentauthor_13960125_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=ajlemke\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"ajlemke\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e AJ Lemke\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13960125_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'04\\/Apr\\/14 16:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-04T16:58:38+0000\'\u003e04\\/Apr\\/14 16:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hi Brett, \\n\\n I grabbed revision \\\"5981529c65d4ae671895948f43d8770daa58746b\\\" from the git repository and ran my tests.   \\nI am seeing still seeing the pivots as arrays rather than JSON objects. \\n\\n If I change numShards to 1 I see the the pivots as an array of objects. \\n( http:\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=1&amp;replicationFactor=2&amp;maxShardsPerNode=4 ) \\n  \\n     field:  \\\"cat\\\" ,\\n    value:  \\\"electronics\\\" ,\\n    count: 12,\\n    pivot: [\\n        {field:  \\\"popularity\\\" ,value: 7,count: 4},\\n        {field:  \\\"popularity\\\" ,value: 6,count: 3},\\n        {field:  \\\"popularity\\\" ,value: 1,count: 2},\\n        {field:  \\\"popularity\\\" ,value: 0,count: 1},\\n        {field:  \\\"popularity\\\" ,value: 5,count: 1},\\n        {field:  \\\"popularity\\\" ,value: 10,count: 1}\\n    ]\\n \\n  \\n\\n If I change numShards to &gt; 1 I see the the pivots as an array of arrays. \\n( http:\\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=2&amp;replicationFactor=2&amp;maxShardsPerNode=4 ) \\n  \\n      \\\"field\\\" ,\\n     \\\"cat\\\" ,\\n     \\\"value\\\" ,\\n     \\\"electronics\\\" ,\\n     \\\"count\\\" ,\\n    12,\\n     \\\"pivot\\\" ,\\n    [\\n        [ \\\"field\\\" , \\\"popularity\\\" , \\\"value\\\" ,7, \\\"count\\\" ,4],\\n        [ \\\"field\\\" , \\\"popularity\\\" , \\\"value\\\" ,6, \\\"count\\\" ,3],\\n        [ \\\"field\\\" , \\\"popularity\\\" , \\\"value\\\" ,1, \\\"count\\\" ,2],\\n        [ \\\"field\\\" , \\\"popularity\\\" , \\\"value\\\" ,0, \\\"count\\\" ,1],\\n        [ \\\"field\\\" , \\\"popularity\\\" , \\\"value\\\" ,5, \\\"count\\\" ,1],\\n        [ \\\"field\\\" , \\\"popularity\\\" , \\\"value\\\" ,10, \\\"count\\\" ,1]\\n    ]\\n \\n  \\n\\n I am using Windows 7 as my test environment and starting with this batch file: \\n\\n   Batch File   \\n echo Deleting Temp Data\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\n\\necho Copying the example folder\\nxcopy \\/s \\/e \\/y \\/i D:\\\\dev\\\\lucene-solr\\\\solr\\\\example D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\nxcopy \\/s \\/e \\/y \\/i D:\\\\dev\\\\lucene-solr\\\\solr\\\\example D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\n\\necho removing the collection1 folder\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\\\solr\\\\collection1\\nrmdir \\/s \\/q D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\\\solr\\\\collection1\\n\\necho Starting Solr Processes\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\node1\\nstart cmd \\/c java -DzkRun -jar start.jar\\nsleep 10\\n\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\node2\\nstart cmd \\/c java -Djetty.port=7574 -DzkRun -DzkHost=localhost:9983 -jar start.jar\\n\\necho All Solr Processes started\\n\\nsleep 10\\n\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\example\\\\scripts\\\\cloud-scripts\\ncmd \\/c zkcli.bat -zkhost localhost:9983 -cmd upconfig -confdir D:\\\\dev\\\\lucene-solr\\\\solr\\\\example\\\\solr\\\\collection1\\\\conf -confname collection1\\ncmd \\/c zkcli.bat -zkhost localhost:9983 -cmd linkconfig -collection collection1 -confname collection1\\necho Zookeeper updated to contain collection1\\n\\ncmd \\/c curl  \\\"http: \\/\\/localhost:8983\\/solr\\/admin\\/collections?action=CREATE&amp;name=collection1&amp;numShards=2&amp;replicationFactor=2&amp;maxShardsPerNode=4\\\" \\n cmd \\/c curl  \\\"http: \\/\\/localhost:8983\\/solr\\/admin\\/collections?action=RELOAD&amp;name=collection1\\\" \\n \\nsleep 10\\n\\ncd D:\\\\dev\\\\lucene-solr\\\\solr\\\\example\\\\exampledocs\\ncmd \\/c java -Dtype=text\\/xml -Doptimize=yes -Durl=http: \\/\\/localhost:8983\\/solr\\/collection1\\/update -jar post.jar *.xml\\n cmd \\/c java -Dtype=text\\/csv -Doptimize=yes -Durl=http: \\/\\/localhost:8983\\/solr\\/collection1\\/update -jar post.jar *.csv\\n cmd \\/c java -Dtype=application\\/json -Doptimize=yes -Durl=http: \\/\\/localhost:8983\\/solr\\/collection1\\/update -jar post.jar *.json\\n echo Collection1 has been bootstrapped and optimized\\n \\n  \\n\\n Could you show me how you are starting yours? \\n\\n AJ              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13962111\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13962111&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13962111\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13962111_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13962111_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Apr\\/14 18:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-07T18:31:49+0000\'\u003e07\\/Apr\\/14 18:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Lucey - 07\\/Apr\\/14 18:32\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi AJ,\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for all that info.  It was super helpful and I\'ve narrowed down the issue.  If you\'d like to fix it on your setup, you only need to make two changes to PivotFacetValue.java.  At the top, add an import for org.apache.solr.common.util.SimpleOrderedMap, and in the convertToNamedList() function in that file, change this line:\u003cbr\\/\u003e\\n NamedList&lt;Object&gt; newList = new NamedList&lt;Object&gt;();\u003cbr\\/\u003e\\nto\u003cbr\\/\u003e\\n NamedList&lt;Object&gt; newList = new SimpleOrderedMap&lt;Object&gt;();\u003c\\/p\u003e\\n\\n\u003cp\u003eI will be posting a new \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e patch within the next day or two, but that patch will be for trunk and will likely not apply cleanly to the 4.7 branch.  If you need this working in 4.7, make the above changes.  If you are using trunk, then this fix will be incorporated into the upcoming patch.\u003c\\/p\u003e\\n\\n\u003cp\u003e-Brett\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13962111_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13962111_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Apr\\/14 18:31\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-07T18:31:49+0000\'\u003e07\\/Apr\\/14 18:31\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Lucey - 07\\/Apr\\/14 18:32\\\"\u003eedited\u003c\\/span\u003e                   Hi AJ, \\n\\n Thanks for all that info.  It was super helpful and I\'ve narrowed down the issue.  If you\'d like to fix it on your setup, you only need to make two changes to PivotFacetValue.java.  At the top, add an import for org.apache.solr.common.util.SimpleOrderedMap, and in the convertToNamedList() function in that file, change this line: \\n NamedList&lt;Object&gt; newList = new NamedList&lt;Object&gt;(); \\nto \\n NamedList&lt;Object&gt; newList = new SimpleOrderedMap&lt;Object&gt;(); \\n\\n I will be posting a new   SOLR-2894   patch within the next day or two, but that patch will be for trunk and will likely not apply cleanly to the 4.7 branch.  If you need this working in 4.7, make the above changes.  If you are using trunk, then this fix will be incorporated into the upcoming patch. \\n\\n -Brett              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13962294\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13962294&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13962294\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13962294_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13962294_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Apr\\/14 21:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-07T21:41:47+0000\'\u003e07\\/Apr\\/14 21:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'ve uploaded a patch to include changes needed to patch against trunk. (Revision caccba783be7c9f4d7b25c992ed4c49e5a2bddf7).  Additionally, this fixes the JSON output formatting issue discovered by AJ.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13962294_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13962294_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'07\\/Apr\\/14 21:41\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-07T21:41:47+0000\'\u003e07\\/Apr\\/14 21:41\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'ve uploaded a patch to include changes needed to patch against trunk. (Revision caccba783be7c9f4d7b25c992ed4c49e5a2bddf7).  Additionally, this fixes the JSON output formatting issue discovered by AJ.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13971291\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13971291&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13971291\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13971291_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13971291_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/14 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-16T12:57:41+0000\'\u003e16\\/Apr\\/14 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMove issue to Solr 4.9.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"thetaphi\\\" id=\\\"commentauthor_13971291_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=thetaphi\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"thetaphi\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Uwe Schindler\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13971291_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/Apr\\/14 12:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-16T12:57:41+0000\'\u003e16\\/Apr\\/14 12:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Move issue to Solr 4.9.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13973094\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13973094&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13973094\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13973094_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13973094_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Apr\\/14 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-17T16:03:15+0000\'\u003e17\\/Apr\\/14 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAfter nearly 2 years of on-and-off development, I think this patch is finally ready to be committed. Brett\'s most recent patch includes significant performance improvements as well as fixes to all of the reported issues and edge cases mentioned by the others currently using this patch. We have just finished a large spike of work to get this ready for commit, so I\'d love to get it pushed in soon unless there are any objections.\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=ehatcher\\\" class=\\\"user-hover\\\" rel=\\\"ehatcher\\\"\u003eErik Hatcher\u003c\\/a\u003e, do you have any time to review this for suitability to be committed (since you are the reporter)? If there is anything additional that needs to be changed, I\'ll happily sign us up (either myself or someone on my team at CareerBuilder) to do it it will help.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13973094_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13973094_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'17\\/Apr\\/14 16:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-17T16:03:15+0000\'\u003e17\\/Apr\\/14 16:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    After nearly 2 years of on-and-off development, I think this patch is finally ready to be committed. Brett\'s most recent patch includes significant performance improvements as well as fixes to all of the reported issues and edge cases mentioned by the others currently using this patch. We have just finished a large spike of work to get this ready for commit, so I\'d love to get it pushed in soon unless there are any objections. \\n\\n  Erik Hatcher , do you have any time to review this for suitability to be committed (since you are the reporter)? If there is anything additional that needs to be changed, I\'ll happily sign us up (either myself or someone on my team at CareerBuilder) to do it it will help.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13978002\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13978002&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13978002\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13978002_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13978002_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/14 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-23T09:03:12+0000\'\u003e23\\/Apr\\/14 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe have encountered a Java heap memory problem using distributed pivots \\u2013 perhaps someone can shed some light on it.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe scenario is as follows:\u003cbr\\/\u003e\\nWe run Solr 4.4 (with patch for \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e) with 20 cores and the maximum java heap size is 1.5 GB.\u003cbr\\/\u003e\\nThe following query with distributed facet pivot generates an out of memory exception:\u003cbr\\/\u003e\\nrows=0&amp;\u003cbr\\/\u003e\\nq=\u003cb\u003e:\u003c\\/b\u003e&amp;\u003cbr\\/\u003e\\nfacet=true&amp;\u003cbr\\/\u003e\\nfacet.pivot=f1,f2,f3,f4,f5&amp;\u003cbr\\/\u003e\\nf.f1.facet.sort=count&amp;\u003cbr\\/\u003e\\nf.f1.facet.limit=10&amp;\u003cbr\\/\u003e\\nf.f1.facet.missing=true&amp;\u003cbr\\/\u003e\\nf.f1.facet.mincount=1&amp;\u003cbr\\/\u003e\\nf.f2.facet.sort=index&amp;\u003cbr\\/\u003e\\nf.f2.facet.limit=-1&amp;\u003cbr\\/\u003e\\nf.f2.facet.missing=true&amp;\u003cbr\\/\u003e\\nf.f2.facet.mincount=1&amp;\u003cbr\\/\u003e\\nf.f3.facet.sort=index&amp;\u003cbr\\/\u003e\\nf.f3.facet.limit=-1&amp;\u003cbr\\/\u003e\\nf.f3.facet.missing=true&amp;\u003cbr\\/\u003e\\nf.f3.facet.mincount=1&amp;\u003cbr\\/\u003e\\nf.f4.facet.sort=index&amp;\u003cbr\\/\u003e\\nf.f4.facet.limit=-1&amp;\u003cbr\\/\u003e\\nf.f4.facet.missing=true&amp;\u003cbr\\/\u003e\\nf.f4.facet.mincount=1&amp;\u003cbr\\/\u003e\\nf.f5.facet.sort=index&amp;\u003cbr\\/\u003e\\nf.f5.facet.limit=-1&amp;\u003cbr\\/\u003e\\nf.f5.facet.missing=true&amp;\u003cbr\\/\u003e\\nf.f5.facet.mincount=1&amp;\u003cbr\\/\u003e\\nshards=127.0.0.1:8983\\/solr\\/shard1,127.0.0.1:8983\\/solr\\/shard2\u003c\\/p\u003e\\n\\n\u003cp\u003eNumber of docs in each shard:\u003cbr\\/\u003e\\nshard1: 16,234\u003cbr\\/\u003e\\nshard2: 169,089\u003c\\/p\u003e\\n\\n\u003cp\u003eThese are the fields terms\' distribution:\u003cbr\\/\u003e\\nf1: shard1 - 16,046, shard2 - 38\u003cbr\\/\u003e\\nf2: all shards - 232\u003cbr\\/\u003e\\nf3: all shards - 53\u003cbr\\/\u003e\\nf4: all shards - 6\u003cbr\\/\u003e\\nf5: all shards - 10\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen we use a maximum java heap size of 8GB, the query finishes. It seems about of 6GB is used for pivoting.\u003cbr\\/\u003e\\nIt doesn\\u2019t seem reasonable that the facet.pivot on 2 cores with 200,000 docs requires that much memory.\u003c\\/p\u003e\\n\\n\u003cp\u003eWe tried looking into the code a little and it seems the sharded queries run with facet.pivot.mincount=-1 as part of the refinement process.\u003cbr\\/\u003e\\nWe also noticed that in this scenario, the parameter skipRefinementAtThisLevel in the method queuePivotRefinementRequests in the class PivotFacetField is false.\u003cbr\\/\u003e\\nWe think all of this is the cause of the memory consumption \\u2013 but we couldn\'t pinpoint the underlying issue.\u003c\\/p\u003e\\n\\n\u003cp\u003eIs there a way to alter the algorithm to consume less memory?\u003cbr\\/\u003e\\nIf anyone can explain offline the way refinement works here, we would be happy to try and help resolve this.\u003c\\/p\u003e\\n\\n\u003cp\u003eThank you very much.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13978002_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13978002_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/14 09:03\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-23T09:03:12+0000\'\u003e23\\/Apr\\/14 09:03\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We have encountered a Java heap memory problem using distributed pivots \\u2013 perhaps someone can shed some light on it. \\n\\n The scenario is as follows: \\nWe run Solr 4.4 (with patch for   SOLR-2894  ) with 20 cores and the maximum java heap size is 1.5 GB. \\nThe following query with distributed facet pivot generates an out of memory exception: \\nrows=0&amp; \\nq= : &amp; \\nfacet=true&amp; \\nfacet.pivot=f1,f2,f3,f4,f5&amp; \\nf.f1.facet.sort=count&amp; \\nf.f1.facet.limit=10&amp; \\nf.f1.facet.missing=true&amp; \\nf.f1.facet.mincount=1&amp; \\nf.f2.facet.sort=index&amp; \\nf.f2.facet.limit=-1&amp; \\nf.f2.facet.missing=true&amp; \\nf.f2.facet.mincount=1&amp; \\nf.f3.facet.sort=index&amp; \\nf.f3.facet.limit=-1&amp; \\nf.f3.facet.missing=true&amp; \\nf.f3.facet.mincount=1&amp; \\nf.f4.facet.sort=index&amp; \\nf.f4.facet.limit=-1&amp; \\nf.f4.facet.missing=true&amp; \\nf.f4.facet.mincount=1&amp; \\nf.f5.facet.sort=index&amp; \\nf.f5.facet.limit=-1&amp; \\nf.f5.facet.missing=true&amp; \\nf.f5.facet.mincount=1&amp; \\nshards=127.0.0.1:8983\\/solr\\/shard1,127.0.0.1:8983\\/solr\\/shard2 \\n\\n Number of docs in each shard: \\nshard1: 16,234 \\nshard2: 169,089 \\n\\n These are the fields terms\' distribution: \\nf1: shard1 - 16,046, shard2 - 38 \\nf2: all shards - 232 \\nf3: all shards - 53 \\nf4: all shards - 6 \\nf5: all shards - 10 \\n\\n When we use a maximum java heap size of 8GB, the query finishes. It seems about of 6GB is used for pivoting. \\nIt doesn\\u2019t seem reasonable that the facet.pivot on 2 cores with 200,000 docs requires that much memory. \\n\\n We tried looking into the code a little and it seems the sharded queries run with facet.pivot.mincount=-1 as part of the refinement process. \\nWe also noticed that in this scenario, the parameter skipRefinementAtThisLevel in the method queuePivotRefinementRequests in the class PivotFacetField is false. \\nWe think all of this is the cause of the memory consumption \\u2013 but we couldn\'t pinpoint the underlying issue. \\n\\n Is there a way to alter the algorithm to consume less memory? \\nIf anyone can explain offline the way refinement works here, we would be happy to try and help resolve this. \\n\\n Thank you very much.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13978442\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13978442&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13978442\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13978442_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13978442_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/14 16:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-23T16:52:43+0000\'\u003e23\\/Apr\\/14 16:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Lucey - 23\\/Apr\\/14 16:54\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Elran,\u003c\\/p\u003e\\n\\n\u003cp\u003eHaving a mincount of -1 for the shards is correct.  The reason is that while a given shard may have a count lower than mincount for a given term, the aggregate total count for that value when combined with the other shards could exceed the mincount, so we do need to know about it.  For example, consider a mincount of 10.  If we have 3 shards with a count of 5 for a term of \\\"Boston\\\", we would still need to know about these because the total count would be 15, and would be higher than the mincount.\u003c\\/p\u003e\\n\\n\u003cp\u003eI would expect the skipRefinementAtThisLevel to be false for the top level pivot facet, and true for each other level.  Are you seeing otherwise?\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you were to set a facet.limit of 10 for all levels of the pivot, what is the memory usage like?\u003c\\/p\u003e\\n\\n\u003cp\u003e-Brett\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13978442_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13978442_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'23\\/Apr\\/14 16:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-23T16:52:43+0000\'\u003e23\\/Apr\\/14 16:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Lucey - 23\\/Apr\\/14 16:54\\\"\u003eedited\u003c\\/span\u003e                   Hi Elran, \\n\\n Having a mincount of -1 for the shards is correct.  The reason is that while a given shard may have a count lower than mincount for a given term, the aggregate total count for that value when combined with the other shards could exceed the mincount, so we do need to know about it.  For example, consider a mincount of 10.  If we have 3 shards with a count of 5 for a term of \\\"Boston\\\", we would still need to know about these because the total count would be 15, and would be higher than the mincount. \\n\\n I would expect the skipRefinementAtThisLevel to be false for the top level pivot facet, and true for each other level.  Are you seeing otherwise? \\n\\n If you were to set a facet.limit of 10 for all levels of the pivot, what is the memory usage like? \\n\\n -Brett              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13979128\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13979128&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13979128\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13979128_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13979128_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/14 00:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-24T00:22:10+0000\'\u003e24\\/Apr\\/14 00:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eWe should get this in to get more feedback. Wish I had some time to tackle it, but I won\'t in the near term.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13979128_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13979128_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/14 00:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-24T00:22:10+0000\'\u003e24\\/Apr\\/14 00:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    We should get this in to get more feedback. Wish I had some time to tackle it, but I won\'t in the near term.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13979420\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13979420&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13979420\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13979420_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13979420_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/14 07:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-24T07:58:31+0000\'\u003e24\\/Apr\\/14 07:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eBrett, thanks for your response.\u003c\\/p\u003e\\n\\n\u003cp\u003e&gt;&gt;Having a mincount of -1 for the shards is correct. The reason is that while a given shard may have a count lower than mincount for a given term, the aggregate total count for that value &gt;&gt;when combined with the other shards could exceed the mincount, so we do need to know about it. For example, consider a mincount of 10. If we have 3 shards with a count of 5 for a term &gt;&gt;of \\\"Boston\\\", we would still need to know about these because the total count would be 15, and would be higher than the mincount.\u003cbr\\/\u003e\\nIf mincount of 1 is asked for a field, couldn\'t it be more efficient? Is mincount of -1 necessary in this case?\u003cbr\\/\u003e\\n&gt;&gt;I would expect the skipRefinementAtThisLevel to be false for the top level pivot facet, and true for each other level. Are you seeing otherwise? \u003cbr\\/\u003e\\nNo. You are right.\u003cbr\\/\u003e\\n&gt;&gt;If you were to set a facet.limit of 10 for all levels of the pivot, what is the memory usage like?\u003cbr\\/\u003e\\nThe memory usage in this case is about 200 MB.\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks again. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_13979420_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13979420_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/14 07:58\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-24T07:58:31+0000\'\u003e24\\/Apr\\/14 07:58\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Brett, thanks for your response. \\n\\n &gt;&gt;Having a mincount of -1 for the shards is correct. The reason is that while a given shard may have a count lower than mincount for a given term, the aggregate total count for that value &gt;&gt;when combined with the other shards could exceed the mincount, so we do need to know about it. For example, consider a mincount of 10. If we have 3 shards with a count of 5 for a term &gt;&gt;of \\\"Boston\\\", we would still need to know about these because the total count would be 15, and would be higher than the mincount. \\nIf mincount of 1 is asked for a field, couldn\'t it be more efficient? Is mincount of -1 necessary in this case? \\n&gt;&gt;I would expect the skipRefinementAtThisLevel to be false for the top level pivot facet, and true for each other level. Are you seeing otherwise?  \\nNo. You are right. \\n&gt;&gt;If you were to set a facet.limit of 10 for all levels of the pivot, what is the memory usage like? \\nThe memory usage in this case is about 200 MB. \\n\\n Thanks again.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13979898\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13979898&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13979898\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13979898_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13979898_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/14 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-24T16:19:09+0000\'\u003e24\\/Apr\\/14 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Lucey - 24\\/Apr\\/14 16:21\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eAndrew actually raised that question to me yesterday as well and I spent a little bit of time looking into it.  For the initial request to a shard, we only lower the mincount to 0 if the facet limit is set to something other than -1.  If the facet limit is -1, we lower the mincount to 1.  In your case, this would the limit would be 10 for the top level pivot, so we know we will (at most) get back 15 terms from each shard in this case.  Because we are only faceting on a limited number of terms, having a mincount of 0 here provides us the benefit of potentially avoiding refinement.  In refinement requests, we still need to know when a shard has responded to us with it\'s count for a term, so the mincount is -1 in that case because we are interested in the term even if the count is zero.  It allows us to mark the shard as having responded and continue on.  It\'s possible that we might be able to change this, but at the point of refinement, it\'s a rather targeted request so I don\'t expect there to be a significant benefit to doing so.  In your case, with the facet limit being -1 on f2-f5, no refinement would be performed anyway.\u003c\\/p\u003e\\n\\n\u003cp\u003eWhen we designed this implementation, the most important factor for us was speed, and we were willing to get it at a cost of memory.  By making these changes, we reduced queries which previously took around 70 seconds for us down to around 600 milliseconds.  I suspect that the biggest factor in the poor memory utilization is the wide open nature of using a facet.limit of -1, especially on a pivot so deep.  Keep in mind that for each level of depth you add to a pivot, memory and time required will grow exponentially.\u003c\\/p\u003e\\n\\n\u003cp\u003eDon\'t forget that if you are querying a node and all of the shards are located within the same Java VM, you are incurring the memory cost of both shards plus the node responding to the user query all within the same heap.\u003c\\/p\u003e\\n\\n\u003cp\u003eI took a quick look at the code today while waiting for some other processes to finish, and I don\'t see any obvious low hanging fruit to free up memory.  \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13979898_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13979898_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'24\\/Apr\\/14 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-24T16:19:09+0000\'\u003e24\\/Apr\\/14 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Brett Lucey - 24\\/Apr\\/14 16:21\\\"\u003eedited\u003c\\/span\u003e                   Andrew actually raised that question to me yesterday as well and I spent a little bit of time looking into it.  For the initial request to a shard, we only lower the mincount to 0 if the facet limit is set to something other than -1.  If the facet limit is -1, we lower the mincount to 1.  In your case, this would the limit would be 10 for the top level pivot, so we know we will (at most) get back 15 terms from each shard in this case.  Because we are only faceting on a limited number of terms, having a mincount of 0 here provides us the benefit of potentially avoiding refinement.  In refinement requests, we still need to know when a shard has responded to us with it\'s count for a term, so the mincount is -1 in that case because we are interested in the term even if the count is zero.  It allows us to mark the shard as having responded and continue on.  It\'s possible that we might be able to change this, but at the point of refinement, it\'s a rather targeted request so I don\'t expect there to be a significant benefit to doing so.  In your case, with the facet limit being -1 on f2-f5, no refinement would be performed anyway. \\n\\n When we designed this implementation, the most important factor for us was speed, and we were willing to get it at a cost of memory.  By making these changes, we reduced queries which previously took around 70 seconds for us down to around 600 milliseconds.  I suspect that the biggest factor in the poor memory utilization is the wide open nature of using a facet.limit of -1, especially on a pivot so deep.  Keep in mind that for each level of depth you add to a pivot, memory and time required will grow exponentially. \\n\\n Don\'t forget that if you are querying a node and all of the shards are located within the same Java VM, you are incurring the memory cost of both shards plus the node responding to the user query all within the same heap. \\n\\n I took a quick look at the code today while waiting for some other processes to finish, and I don\'t see any obvious low hanging fruit to free up memory.                \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13980597\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13980597&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13980597\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13980597_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13980597_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 01:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T01:20:15+0000\'\u003e25\\/Apr\\/14 01:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003e&gt;&gt;\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\" class=\\\"user-hover\\\" rel=\\\"markrmiller@gmail.com\\\"\u003eMark Miller\u003c\\/a\u003e said:\u003cbr\\/\u003e\\n&gt;&gt;We should get this in to get more feedback. Wish I had some time to tackle it, but I won\'t in the near term. \u003c\\/p\u003e\\n\\n\u003cp\u003eIs there a committer who has interest in this issue and would be willing to look over it for (hopefully) getting it pushed into trunk?  It\'s the top voted for and the top watched issue in Solr right now, so there\'s clearly a lot of community interest. Thanks!\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13980597_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13980597_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 01:20\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T01:20:15+0000\'\u003e25\\/Apr\\/14 01:20\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    &gt;&gt; Mark Miller  said: \\n&gt;&gt;We should get this in to get more feedback. Wish I had some time to tackle it, but I won\'t in the near term.  \\n\\n Is there a committer who has interest in this issue and would be willing to look over it for (hopefully) getting it pushed into trunk?  It\'s the top voted for and the top watched issue in Solr right now, so there\'s clearly a lot of community interest. Thanks!              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13980624\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13980624&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13980624\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13980624_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13980624_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 02:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T02:09:44+0000\'\u003e25\\/Apr\\/14 02:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eIf nobody volunteers, since this doesn\'t change existing behaviour (right?) I suggest just committing it and improving it from there once people start using it and suggesting improvements\\/bug fixes.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"otis\\\" id=\\\"commentauthor_13980624_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=otis\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"otis\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Otis Gospodnetic\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13980624_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 02:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T02:09:44+0000\'\u003e25\\/Apr\\/14 02:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    If nobody volunteers, since this doesn\'t change existing behaviour (right?) I suggest just committing it and improving it from there once people start using it and suggesting improvements\\/bug fixes.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13980662\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13980662&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13980662\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13980662_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13980662_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 03:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T03:52:23+0000\'\u003e25\\/Apr\\/14 03:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Trey Grainger - 25\\/Apr\\/14 03:54\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHi Otis, I appreciate your interest here. That\'s correct: no previously working behavior was changed, and there are two things added with this patch: 1) distributed support, and 2) support for a single-level pivot facets (this previously threw an exception but is now supported: facet.pivot=aSingleFieldName).\u003c\\/p\u003e\\n\\n\u003cp\u003eFor context on #2, we found no good reason to disallow a single-level pivot facet (functions like a field facet but with the pivot facet output format), it made implementing distributed pivot faceting easier since a single level could be considered when refining, and there was work in some downstream issues like \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-3583\\\" title=\\\"Percentiles for facets, pivot facets, and distributed pivot facets\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-3583\\\"\u003e\u003cdel\u003eSOLR-3583\u003c\\/del\u003e\u003c\\/a\u003e (adding percentiles and other stats to pivot facets) which was dependent upon being able to easily alternate between any number of facet levels for analytics purposes, so we just added the support for a single level. This also makes it easier to build analytics tools without having to arbitrarily alternate between field facets and pivot facets and their corresponding output formats based upon the number of levels.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe end result is that no previously working capabilities have been modified, but distributed support for any number of pivot levels has been added, which should make this safe to commit to trunk.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"solrtrey\\\" id=\\\"commentauthor_13980662_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=solrtrey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"solrtrey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Trey Grainger\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13980662_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 03:52\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T03:52:23+0000\'\u003e25\\/Apr\\/14 03:52\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Trey Grainger - 25\\/Apr\\/14 03:54\\\"\u003eedited\u003c\\/span\u003e                   Hi Otis, I appreciate your interest here. That\'s correct: no previously working behavior was changed, and there are two things added with this patch: 1) distributed support, and 2) support for a single-level pivot facets (this previously threw an exception but is now supported: facet.pivot=aSingleFieldName). \\n\\n For context on #2, we found no good reason to disallow a single-level pivot facet (functions like a field facet but with the pivot facet output format), it made implementing distributed pivot faceting easier since a single level could be considered when refining, and there was work in some downstream issues like   SOLR-3583   (adding percentiles and other stats to pivot facets) which was dependent upon being able to easily alternate between any number of facet levels for analytics purposes, so we just added the support for a single level. This also makes it easier to build analytics tools without having to arbitrarily alternate between field facets and pivot facets and their corresponding output formats based upon the number of levels. \\n\\n The end result is that no previously working capabilities have been modified, but distributed support for any number of pivot levels has been added, which should make this safe to commit to trunk.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13981308\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13981308&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13981308\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13981308_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13981308_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T17:50:21+0000\'\u003e25\\/Apr\\/14 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI have not worked on faceting code in the past, so this is really not my area.\u003c\\/p\u003e\\n\\n\u003cp\u003eHowever, here is a patch I just worked up to apply against 5x. I had to make some small changes - DateField is deprecated and there was an ndate field in the tests that could not be found. I removed it in this patch. I also fixed a few issues around licenses and formatting - this patch passes precommit except for a nocommit at the DateField change - someone should review if that change has any other ramifications. All tests pass.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis code does touch some existing faceting code in a way that demands a deeper review I think, but until I have a lot more time, I\'m not the man for that job. Perhaps \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/ViewProfile.jspa?name=hossman_lucene%40fucit.org\\\" class=\\\"user-hover\\\" rel=\\\"hossman_lucene@fucit.org\\\"\u003eChris Hostetter (Unused)\u003c\\/a\u003e?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"markrmiller@gmail.com\\\" id=\\\"commentauthor_13981308_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=markrmiller%40gmail.com\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"markrmiller@gmail.com\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Mark Miller\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13981308_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'25\\/Apr\\/14 17:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-04-25T17:50:21+0000\'\u003e25\\/Apr\\/14 17:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I have not worked on faceting code in the past, so this is really not my area. \\n\\n However, here is a patch I just worked up to apply against 5x. I had to make some small changes - DateField is deprecated and there was an ndate field in the tests that could not be found. I removed it in this patch. I also fixed a few issues around licenses and formatting - this patch passes precommit except for a nocommit at the DateField change - someone should review if that change has any other ramifications. All tests pass. \\n\\n This code does touch some existing faceting code in a way that demands a deeper review I think, but until I have a lot more time, I\'m not the man for that job. Perhaps  Chris Hostetter (Unused) ?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13990122\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13990122&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13990122\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13990122_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13990122_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 00:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T00:14:33+0000\'\u003e06\\/May\\/14 00:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m going to spend some time this week reviewing the state of things.\u003c\\/p\u003e\\n\\n\u003cp\u003eFirst up, some minor tweaks to the latest patch...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003efixed a typo in TestDistributedSearch (\\\"facet.fiedl\\\" -&gt; \\\"facet.field\\\")\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ethis is my biggest anoyance about most of our existing distributed serach tests &#8211; they just assert that queries return the same thing as single node tests, but don\'t assert anything about the response, so mistakes in the input, or mistakes in indexing hte docs, resulting in a useless test aren\'t caught)\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ethis also relates to marks comment about removing \\\"ndate\\\" since that field no longer exists in the test configs - using tdate_a &amp; tdate_b here should be fine\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eremoved the \\\"nocommit\\\" mark mentioned regarding DateField - that method moved to TrieDateField so his fix is correct.\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eSome comments\\/questions based on what I\'ve reviewed so far (note: many of these comments\\/questions come from a place of genuine ignorance since i\'ve only reviewed about 30% of the patch so far)...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eeven at a glance, it\'s obvious the SimpleFacets changes are a simple refactoring and totally fine.\u003c\\/li\u003e\\n\\t\u003cli\u003eIn FacetComponent - Setting asside the core pivot facet changes...\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eMost of the other changes in seem like straight forward (and much needed!) variable renaming (+1) to help eliminate ambiguity between the existing field faceting refinement and the new pivot faceting refinement\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ethe new \\\"fieldsToOverRequestOn\\\" Map confuses me in a few ways...\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003eAs is, i don\'t understand why this is a Map and not a Set.\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eSome odd conditional logic is used when iterating over this \\\"Set\\\" to determine the overrequest limit - i\'m still trying to wrap my head arround this but in particular the comment \u003ctt\u003e\\/\\/ dff has the info, the params have been scrubbed\u003c\\/tt\u003e confuses me &#8211; where are these params \\\"scrubbed\\\" ?\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eI like these new explict overrequest count\\/ratio params, and i get that the end-game here is that they can be used to affect the amount of overrequest done for both fact.field and facet.pivot &#8211; but i\'m not understanding the value of building up this \\\"fieldsToOverRequestOn\\\" set of names (for every shard request) and then iterating over it and consulting \u003cb\u003eeither\u003c\\/b\u003e the DFF or the params to decide which limit value to use on the shard requests, and then (conditionally?) removing the limit\\/offset\\/overrequest params from the shard requests.  Wouldn\'t it be simplier to have modifyRequest \u003cb\u003ealways\u003c\\/b\u003e remove the limit\\/offset\\/overrequest params from the shard params, and then have the individual code paths (for both facet.field &amp; facet.pivot) take responsibility for adding back the new limit params based on the overrequest calculations using the \u003cb\u003eoriginal\u003c\\/b\u003e request params (ie: \u003ctt\u003erb.req.getParams()\u003c\\/tt\u003e).\u003c\\/li\u003e\\n\\t\\t\\t\u003cli\u003eMy chief concern here being that (at first glance) this change seems like it adds a small amount of overhead to the overrequest limit calculations, and makes this bit of code more confusing, w\\/o any obvious (to me) advantage.\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eI don\'t yet understand the need for the new \\\"PURPOSE_REFINE_PIVOT_FACETS\\\" stage of shard requests? ... can someone clarify why  pivot facets can\'t just be refined during the existing \\\"PURPOSE_REFINE_FACETS\\\" stage?\u003c\\/li\u003e\\n\\t\u003cli\u003eI notice that the new DistributedFacetPivotTest directly extends BaseDistributedSearchTestCase and uses a fixed shard count, and indexes some docs directly to certain clients\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eis there something about the functionality (or about the test) that requires certain data locality (ie: certain docs on same shard) to work?\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eif not: is there any other reason we can\'t switch this over to a Cloud based test with a variable numbers of shards and compairons against the control collection?\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13990122_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13990122_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 00:14\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T00:14:33+0000\'\u003e06\\/May\\/14 00:14\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I\'m going to spend some time this week reviewing the state of things. \\n\\n First up, some minor tweaks to the latest patch... \\n\\n \\n\\t fixed a typo in TestDistributedSearch (\\\"facet.fiedl\\\" -&gt; \\\"facet.field\\\")\\n\\t \\n\\t\\t this is my biggest anoyance about most of our existing distributed serach tests &#8211; they just assert that queries return the same thing as single node tests, but don\'t assert anything about the response, so mistakes in the input, or mistakes in indexing hte docs, resulting in a useless test aren\'t caught) \\n\\t\\t this also relates to marks comment about removing \\\"ndate\\\" since that field no longer exists in the test configs - using tdate_a &amp; tdate_b here should be fine \\n\\t \\n\\t \\n\\t removed the \\\"nocommit\\\" mark mentioned regarding DateField - that method moved to TrieDateField so his fix is correct. \\n \\n\\n\\n\\n Some comments\\/questions based on what I\'ve reviewed so far (note: many of these comments\\/questions come from a place of genuine ignorance since i\'ve only reviewed about 30% of the patch so far)... \\n\\n \\n\\t even at a glance, it\'s obvious the SimpleFacets changes are a simple refactoring and totally fine. \\n\\t In FacetComponent - Setting asside the core pivot facet changes...\\n\\t \\n\\t\\t Most of the other changes in seem like straight forward (and much needed!) variable renaming (+1) to help eliminate ambiguity between the existing field faceting refinement and the new pivot faceting refinement \\n\\t\\t the new \\\"fieldsToOverRequestOn\\\" Map confuses me in a few ways...\\n\\t\\t \\n\\t\\t\\t As is, i don\'t understand why this is a Map and not a Set. \\n\\t\\t\\t Some odd conditional logic is used when iterating over this \\\"Set\\\" to determine the overrequest limit - i\'m still trying to wrap my head arround this but in particular the comment  \\/\\/ dff has the info, the params have been scrubbed  confuses me &#8211; where are these params \\\"scrubbed\\\" ? \\n\\t\\t\\t I like these new explict overrequest count\\/ratio params, and i get that the end-game here is that they can be used to affect the amount of overrequest done for both fact.field and facet.pivot &#8211; but i\'m not understanding the value of building up this \\\"fieldsToOverRequestOn\\\" set of names (for every shard request) and then iterating over it and consulting  either  the DFF or the params to decide which limit value to use on the shard requests, and then (conditionally?) removing the limit\\/offset\\/overrequest params from the shard requests.  Wouldn\'t it be simplier to have modifyRequest  always  remove the limit\\/offset\\/overrequest params from the shard params, and then have the individual code paths (for both facet.field &amp; facet.pivot) take responsibility for adding back the new limit params based on the overrequest calculations using the  original  request params (ie:  rb.req.getParams() ). \\n\\t\\t\\t My chief concern here being that (at first glance) this change seems like it adds a small amount of overhead to the overrequest limit calculations, and makes this bit of code more confusing, w\\/o any obvious (to me) advantage. \\n\\t\\t \\n\\t\\t \\n\\t \\n\\t \\n\\t I don\'t yet understand the need for the new \\\"PURPOSE_REFINE_PIVOT_FACETS\\\" stage of shard requests? ... can someone clarify why  pivot facets can\'t just be refined during the existing \\\"PURPOSE_REFINE_FACETS\\\" stage? \\n\\t I notice that the new DistributedFacetPivotTest directly extends BaseDistributedSearchTestCase and uses a fixed shard count, and indexes some docs directly to certain clients\\n\\t \\n\\t\\t is there something about the functionality (or about the test) that requires certain data locality (ie: certain docs on same shard) to work? \\n\\t\\t if not: is there any other reason we can\'t switch this over to a Cloud based test with a variable numbers of shards and compairons against the control collection? \\n\\t \\n\\t \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13990941\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13990941&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13990941\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13990941_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13990941_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 18:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T18:23:31+0000\'\u003e06\\/May\\/14 18:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI spoke with Andrew regarding the tests.  The test does do some Query() testing to verify that the output of distributed and single node is the same, however further down it does to explicit testing.  He said it\'s important that we don\'t use the variable number of shards in this particular because it exercises a number of specific sharding situations to ensure that we get the correct answers.\u003c\\/p\u003e\\n\\n\u003cp\u003eLooking at fieldsToOverRequestOn, I think you are correct.  It looks like this probably could be a set.  I suspect this is an artifact of multiple pass-throughs at the implementation of this feature.  I will spend some time on this on Thursday to see if I can clean this area up and make it a little more straight forward.\u003c\\/p\u003e\\n\\n\u003cp\u003eRegarding PURPOSE_REFINE_PIVOT_FACETS:  If it was truly needed, we probably could use a single purpose at a very slight cost.  Keep in mind that the purposes are OR\'d together, so they should happen in the same shard request.  Having two different purposes allows us to call refineFacets and\\/or refinePivotFacets only as needed to avoid looping through the shard responses an extra time.  If your comment is more to the effect that the loop in refineFacets() and refinePivotFacets() could be merged into a single loop &#8211; that\'s probably true and if you feel it\'s a better route to go, let me know and I can work on that change.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13990941_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13990941_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 18:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T18:23:31+0000\'\u003e06\\/May\\/14 18:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I spoke with Andrew regarding the tests.  The test does do some Query() testing to verify that the output of distributed and single node is the same, however further down it does to explicit testing.  He said it\'s important that we don\'t use the variable number of shards in this particular because it exercises a number of specific sharding situations to ensure that we get the correct answers. \\n\\n Looking at fieldsToOverRequestOn, I think you are correct.  It looks like this probably could be a set.  I suspect this is an artifact of multiple pass-throughs at the implementation of this feature.  I will spend some time on this on Thursday to see if I can clean this area up and make it a little more straight forward. \\n\\n Regarding PURPOSE_REFINE_PIVOT_FACETS:  If it was truly needed, we probably could use a single purpose at a very slight cost.  Keep in mind that the purposes are OR\'d together, so they should happen in the same shard request.  Having two different purposes allows us to call refineFacets and\\/or refinePivotFacets only as needed to avoid looping through the shard responses an extra time.  If your comment is more to the effect that the loop in refineFacets() and refinePivotFacets() could be merged into a single loop &#8211; that\'s probably true and if you feel it\'s a better route to go, let me know and I can work on that change.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13991118\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13991118&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13991118\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13991118_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13991118_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 20:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T20:55:54+0000\'\u003e06\\/May\\/14 20:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eHe said it\'s important that we don\'t use the variable number of shards in this particular because it exercises a number of specific sharding situations to ensure that we get the correct answers.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ethat makes complete sense &#8211; i just wanted to make sure it\'s a \u003cem\u003etest\u003c\\/em\u003e requirement and not a \u003cem\u003efeature\u003c\\/em\u003e requirement.  We should definitely comment the test to that effect, and add a more randomized cloud based test with some dynamic shard assignment as well to try and help catch strange edge cases.  I\'ll try to work on that to help me better understand the feature (in general, it\'s been a long time since i looved at pivot faceting)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI will spend some time on this on Thursday to see if I can clean this area up and make it a little more straight forward.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003ethat would be great, thanks.  The Map vs Set aspect would be a trivial improvement, but in general i\'m more concerned about the odd flow &#8211; it seems like something that could easily bite us in the ass later when people try to maintain it.  It seems like it would be a lot more straight forward to:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ehave modifyRequest unconditionally remove all limit\\/offset\\/overrequest params from the shard requests\u003c\\/li\u003e\\n\\t\u003cli\u003ehave a simple \\\"getOverrequestLimitAmount(String fieldName)\\\" method in the FacetInfo class (that consults the \u003cem\u003eoriginal\u003c\\/em\u003e request params)\u003c\\/li\u003e\\n\\t\u003cli\u003ehave each code path (facet.field &amp; facet.pivot &amp; whatever down the road...) that sets params on the shard request and cares about over requesting call \u003ctt\u003esreq.params.set(pre + FACET_LIMIT, getOverrequestLimitAmount(fieldName))\u003c\\/tt\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cblockquote\u003e\u003cp\u003eHaving two different purposes allows us to call refineFacets and\\/or refinePivotFacets only as needed to avoid looping through the shard responses an extra time. If your comment is more to the effect that the loop in refineFacets() and refinePivotFacets() could be merged into a single loop...\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t have an opinion, i just wanted to understand the purpose of the new \\\"PURPOSE\\\" (heh) since we don\'t have a special one for range facets or query facets &#8211; but in hindsight i realize that of course we don\'t: those don\'t need refinement. \u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13991118_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13991118_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 20:55\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T20:55:54+0000\'\u003e06\\/May\\/14 20:55\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     He said it\'s important that we don\'t use the variable number of shards in this particular because it exercises a number of specific sharding situations to ensure that we get the correct answers.  \\n\\n that makes complete sense &#8211; i just wanted to make sure it\'s a  test  requirement and not a  feature  requirement.  We should definitely comment the test to that effect, and add a more randomized cloud based test with some dynamic shard assignment as well to try and help catch strange edge cases.  I\'ll try to work on that to help me better understand the feature (in general, it\'s been a long time since i looved at pivot faceting) \\n\\n  I will spend some time on this on Thursday to see if I can clean this area up and make it a little more straight forward.  \\n\\n that would be great, thanks.  The Map vs Set aspect would be a trivial improvement, but in general i\'m more concerned about the odd flow &#8211; it seems like something that could easily bite us in the ass later when people try to maintain it.  It seems like it would be a lot more straight forward to: \\n \\n\\t have modifyRequest unconditionally remove all limit\\/offset\\/overrequest params from the shard requests \\n\\t have a simple \\\"getOverrequestLimitAmount(String fieldName)\\\" method in the FacetInfo class (that consults the  original  request params) \\n\\t have each code path (facet.field &amp; facet.pivot &amp; whatever down the road...) that sets params on the shard request and cares about over requesting call  sreq.params.set(pre + FACET_LIMIT, getOverrequestLimitAmount(fieldName))  \\n \\n\\n\\n  Having two different purposes allows us to call refineFacets and\\/or refinePivotFacets only as needed to avoid looping through the shard responses an extra time. If your comment is more to the effect that the loop in refineFacets() and refinePivotFacets() could be merged into a single loop...  \\n\\n I don\'t have an opinion, i just wanted to understand the purpose of the new \\\"PURPOSE\\\" (heh) since we don\'t have a special one for range facets or query facets &#8211; but in hindsight i realize that of course we don\'t: those don\'t need refinement.               \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13991142\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13991142&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13991142\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13991142_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13991142_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 21:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T21:12:53+0000\'\u003e06\\/May\\/14 21:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\\n\u003cp\u003eI don\'t have an opinion, i just wanted to understand the purpose of the new \\\"PURPOSE\\\" (heh) since we don\'t have a special one for range facets or query facets \\u2013 but in hindsight i realize that of course we don\'t: those don\'t need refinement.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003ePrimarily it\'s just for performance.  Field facet refinement should only occur once, but pivot facet refinement may occur a number of times due to the tiering.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13991142_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13991142_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'06\\/May\\/14 21:12\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-06T21:12:53+0000\'\u003e06\\/May\\/14 21:12\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    \\n I don\'t have an opinion, i just wanted to understand the purpose of the new \\\"PURPOSE\\\" (heh) since we don\'t have a special one for range facets or query facets \\u2013 but in hindsight i realize that of course we don\'t: those don\'t need refinement.  \\n Primarily it\'s just for performance.  Field facet refinement should only occur once, but pivot facet refinement may occur a number of times due to the tiering.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13993233\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13993233&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13993233\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13993233_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13993233_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/May\\/14 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-08T22:53:30+0000\'\u003e08\\/May\\/14 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\\n\u003cp\u003eI still haven\'t had a chance to really dig into the implementation details of the patch, but i wanted to spend some time testing things out from a user perspective...\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003eOne of the first things i noticed, is that the refinement requests seem to be extra verbose.  For example, given this user request (using the example data, with a 2 shard cloud setup):\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,inStock&amp;facet.limit=3&amp;facet.pivot=manu_id_s,inStock\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,inStock&amp;facet.limit=3&amp;facet.pivot=manu_id_s,inStock\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is what the refinement requests in the logs of each shard looked like...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e3434041 [qtp1282186295-19] INFO  org.apache.solr.core.SolrCore  \\u2013 [collection1] webapp=\\/solr path=\\/select params={manu_id_s,inStock_8__terms=samsung&amp;facet=true&amp;sort=id+desc&amp;facet.limit=3&amp;manu_id_s,inStock_9__terms=viewsonic&amp;distrib=false&amp;cat,inStock_1__terms=search&amp;wt=javabin&amp;version=2&amp;rows=0&amp;manu_id_s,inStock_6__terms=maxtor&amp;manu_id_s,inStock_7__terms=nor&amp;NOW=1399584452682&amp;shard.url=http:\\/\\/127.0.1.1:8983\\/solr\\/collection1\\/&amp;df=text&amp;cat,inStock_2__terms=software&amp;q=*:*&amp;manu_id_s,inStock_3__terms=canon&amp;manu_id_s,inStock_4__terms=ati&amp;facet.pivot.mincount=-1&amp;isShard=true&amp;cat,inStock_0__terms=hard+drive&amp;facet.pivot={!terms%3D$cat,inStock_0__terms}cat,inStock&amp;facet.pivot={!terms%3D$cat,inStock_1__terms}cat,inStock&amp;facet.pivot={!terms%3D$cat,inStock_2__terms}cat,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_3__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_4__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_5__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_6__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_7__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_8__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_9__terms}manu_id_s,inStock&amp;manu_id_s,inStock_5__terms=eu} hits=14 status=0 QTime=3 \\n\\n3424918 [qtp1282186295-16] INFO  org.apache.solr.core.SolrCore  \\u2013 [collection1] webapp=\\/solr path=\\/select params={cat,inStock_10__terms=memory&amp;manu_id_s,inStock_15__terms=dell&amp;facet=true&amp;manu_id_s,inStock_12__terms=apple&amp;sort=id+desc&amp;facet.limit=3&amp;manu_id_s,inStock_13__terms=asus&amp;manu_id_s,inStock_16__terms=uk&amp;distrib=false&amp;wt=javabin&amp;manu_id_s,inStock_14__terms=boa&amp;version=2&amp;rows=0&amp;NOW=1399584452682&amp;shard.url=http:\\/\\/127.0.1.1:7574\\/solr\\/collection1\\/&amp;df=text&amp;manu_id_s,inStock_11__terms=corsair&amp;q=*:*&amp;facet.pivot.mincount=-1&amp;isShard=true&amp;facet.pivot={!terms%3D$cat,inStock_10__terms}cat,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_11__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_12__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_13__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_14__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_15__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_16__terms}manu_id_s,inStock} hits=18 status=0 QTime=2 \\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eOr if we prune that down to just the interesting params (as far as pivot faceting goes)...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eshard1\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003efacet.pivot.mincount=-1\\ncat,inStock_0__terms=hard+drive\\ncat,inStock_1__terms=search\\ncat,inStock_2__terms=software\\nmanu_id_s,inStock_3__terms=canon\\nmanu_id_s,inStock_4__terms=ati\\nmanu_id_s,inStock_5__terms=eu\\nmanu_id_s,inStock_6__terms=maxtor\\nmanu_id_s,inStock_7__terms=nor\\nmanu_id_s,inStock_8__terms=samsung\\nmanu_id_s,inStock_9__terms=viewsonic\\nfacet.pivot={!terms=$cat,inStock_0__terms}cat,inStock\\nfacet.pivot={!terms=$cat,inStock_1__terms}cat,inStock\\nfacet.pivot={!terms=$cat,inStock_2__terms}cat,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_3__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_4__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_5__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_6__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_7__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_8__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_9__terms}manu_id_s,inStock\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eshard2\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003efacet.pivot.mincount=-1\\ncat,inStock_10__terms=memory\\nmanu_id_s,inStock_11__terms=corsair\\nmanu_id_s,inStock_12__terms=apple\\nmanu_id_s,inStock_13__terms=asus\\nmanu_id_s,inStock_14__terms=boa\\nmanu_id_s,inStock_15__terms=dell\\nmanu_id_s,inStock_16__terms=uk\\nfacet.pivot={!terms=$cat,inStock_10__terms}cat,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_11__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_12__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_13__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_14__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_15__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_16__terms}manu_id_s,inStock\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI believe that what\'s going on here is basically:\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003etop level params are being used for the individual terms that need refined (which is smart, helps eliminate risk of terms needing special escaping with local params)\u003c\\/li\u003e\\n\\t\u003cli\u003ethe top level param names for these terms that need refined use a per-(user)request \\\"global\\\" counter to ensure that they are unique (+1)\u003c\\/li\u003e\\n\\t\u003cli\u003ethe top level term param names also include the facet.pivot spec they are needed for &#8211; this seems redundant since the counter is clearly global (even across multiple \\\"facet.pivot\\\" specs)\u003c\\/li\u003e\\n\\t\u003cli\u003ethese top leve term param names are then added only to the shard requests where refinement is actually needed for those terms (+1) and are referenced as variables in facet.pivot commands using the \\\"terms\\\" local param (which the shards evidently look for to know when this is a refinement request)\u003c\\/li\u003e\\n\\t\u003cli\u003ebecause many terms may need refinement, that means each user specified \u003ctt\u003efacet.pivot=X,Y\u003c\\/tt\u003e param results in \u003cb\u003emany\u003c\\/b\u003e shard params of \u003ctt\u003efacet.pivot={!terms=$N}X,Y\u003c\\/tt\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eI realize that local params don\'t play nice with multi-valued params at all, let alone make it easy to use a single variable to refer to a multi-valued param &#8211; But wouldn\'t it be simpler (and less verbose over the wire) to just ignore Solr\'s built in param variable derefrencing and instead generate 1 unique param name to use for \u003cb\u003eall\u003c\\/b\u003e the terms we care about (for each unique pivot spec), and then refer to that name once in a local param for a \u003cem\u003esingle\u003c\\/em\u003e facet.pivot param (which the pivot facet could would then go and explicitly fetch from the top level SolrParams as a multi-value) \u003c\\/p\u003e\\n\\n\u003cp\u003eThe result being, that instead of the refinement requests shows above, the refinement requests for each shard could be something much simpler like...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eshard1_proposed\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003efacet.pivot.mincount=-1\\n_fpt_1=hard+drive\\n_fpt_1=search\\n_fpt_1=software\\n_fpt_2=canon\\n_fpt_2=ati\\n_fpt_2=eu\\n_fpt_2=maxtor\\n_fpt_2=nor\\n_fpt_2=samsung\\n_fpt_2=viewsonic\\nfacet.pivot={!fpt=1}cat,inStock\\nfacet.pivot={!fpt=2}manu_id_s,inStock\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedHeader panelHeader\\\" style=\\\"border-bottom-width: 1px;\\\"\u003e\u003cb\u003eshard2_proposed\u003c\\/b\u003e\u003c\\/div\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003efacet.pivot.mincount=-1\\n_fpt_1=memory\\n_fpt_2=corsair\\n_fpt_2=apple\\n_fpt_2=asus\\n_fpt_2=boa\\n_fpt_2=dell\\n_fpt_2=uk\\nfacet.pivot={!fpt=1}cat,inStock\\nfacet.pivot={!fpt=2}manu_id_s,inStock\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e(where \u003ctt\u003e&#95;fpt&#95;\u003c\\/tt\u003e is just a short prefix for \\\"facet pivot terms\\\" that i pulled out of my ass)\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003eAnother thing I noticed is that with my 2 shard exampledocs setup, the following URL seems to send the pivot faceting into an infinite loop of refinement requests (note the typo: there\'s a space embeded in a field name \u003ctt\u003emanu_id_s != manu_+id_s\u003c\\/tt\u003e )...\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e...not clear what\'s going on there, but definitely something that needs fixed before committing (\\\"garbage in -&gt; garbage out\\\" is one thing, \\\"garbage in -&gt; crash your cluster\\\" is another)\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003ethe multi-level refinement is sooooooo sweet.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13993233_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13993233_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'08\\/May\\/14 22:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-08T22:53:30+0000\'\u003e08\\/May\\/14 22:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                   \\n I still haven\'t had a chance to really dig into the implementation details of the patch, but i wanted to spend some time testing things out from a user perspective... \\n\\n \\n\\n One of the first things i noticed, is that the refinement requests seem to be extra verbose.  For example, given this user request (using the example data, with a 2 shard cloud setup): \\n\\n  http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,inStock&amp;facet.limit=3&amp;facet.pivot=manu_id_s,inStock  \\n\\n This is what the refinement requests in the logs of each shard looked like... \\n\\n  \\n 3434041 [qtp1282186295-19] INFO  org.apache.solr.core.SolrCore  \\u2013 [collection1] webapp=\\/solr path=\\/select params={manu_id_s,inStock_8__terms=samsung&amp;facet=true&amp;sort=id+desc&amp;facet.limit=3&amp;manu_id_s,inStock_9__terms=viewsonic&amp;distrib=false&amp;cat,inStock_1__terms=search&amp;wt=javabin&amp;version=2&amp;rows=0&amp;manu_id_s,inStock_6__terms=maxtor&amp;manu_id_s,inStock_7__terms=nor&amp;NOW=1399584452682&amp;shard.url=http:\\/\\/127.0.1.1:8983\\/solr\\/collection1\\/&amp;df=text&amp;cat,inStock_2__terms=software&amp;q=*:*&amp;manu_id_s,inStock_3__terms=canon&amp;manu_id_s,inStock_4__terms=ati&amp;facet.pivot.mincount=-1&amp;isShard=true&amp;cat,inStock_0__terms=hard+drive&amp;facet.pivot={!terms%3D$cat,inStock_0__terms}cat,inStock&amp;facet.pivot={!terms%3D$cat,inStock_1__terms}cat,inStock&amp;facet.pivot={!terms%3D$cat,inStock_2__terms}cat,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_3__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_4__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_5__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_6__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_7__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_8__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_9__terms}manu_id_s,inStock&amp;manu_id_s,inStock_5__terms=eu} hits=14 status=0 QTime=3 \\n\\n3424918 [qtp1282186295-16] INFO  org.apache.solr.core.SolrCore  \\u2013 [collection1] webapp=\\/solr path=\\/select params={cat,inStock_10__terms=memory&amp;manu_id_s,inStock_15__terms=dell&amp;facet=true&amp;manu_id_s,inStock_12__terms=apple&amp;sort=id+desc&amp;facet.limit=3&amp;manu_id_s,inStock_13__terms=asus&amp;manu_id_s,inStock_16__terms=uk&amp;distrib=false&amp;wt=javabin&amp;manu_id_s,inStock_14__terms=boa&amp;version=2&amp;rows=0&amp;NOW=1399584452682&amp;shard.url=http:\\/\\/127.0.1.1:7574\\/solr\\/collection1\\/&amp;df=text&amp;manu_id_s,inStock_11__terms=corsair&amp;q=*:*&amp;facet.pivot.mincount=-1&amp;isShard=true&amp;facet.pivot={!terms%3D$cat,inStock_10__terms}cat,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_11__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_12__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_13__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_14__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_15__terms}manu_id_s,inStock&amp;facet.pivot={!terms%3D$manu_id_s,inStock_16__terms}manu_id_s,inStock} hits=18 status=0 QTime=2 \\n \\n  \\n\\n Or if we prune that down to just the interesting params (as far as pivot faceting goes)... \\n\\n   shard1   \\n facet.pivot.mincount=-1\\ncat,inStock_0__terms=hard+drive\\ncat,inStock_1__terms=search\\ncat,inStock_2__terms=software\\nmanu_id_s,inStock_3__terms=canon\\nmanu_id_s,inStock_4__terms=ati\\nmanu_id_s,inStock_5__terms=eu\\nmanu_id_s,inStock_6__terms=maxtor\\nmanu_id_s,inStock_7__terms=nor\\nmanu_id_s,inStock_8__terms=samsung\\nmanu_id_s,inStock_9__terms=viewsonic\\nfacet.pivot={!terms=$cat,inStock_0__terms}cat,inStock\\nfacet.pivot={!terms=$cat,inStock_1__terms}cat,inStock\\nfacet.pivot={!terms=$cat,inStock_2__terms}cat,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_3__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_4__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_5__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_6__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_7__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_8__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_9__terms}manu_id_s,inStock\\n \\n  \\n\\n   shard2   \\n facet.pivot.mincount=-1\\ncat,inStock_10__terms=memory\\nmanu_id_s,inStock_11__terms=corsair\\nmanu_id_s,inStock_12__terms=apple\\nmanu_id_s,inStock_13__terms=asus\\nmanu_id_s,inStock_14__terms=boa\\nmanu_id_s,inStock_15__terms=dell\\nmanu_id_s,inStock_16__terms=uk\\nfacet.pivot={!terms=$cat,inStock_10__terms}cat,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_11__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_12__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_13__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_14__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_15__terms}manu_id_s,inStock\\nfacet.pivot={!terms=$manu_id_s,inStock_16__terms}manu_id_s,inStock\\n \\n  \\n\\n I believe that what\'s going on here is basically: \\n\\n \\n\\t top level params are being used for the individual terms that need refined (which is smart, helps eliminate risk of terms needing special escaping with local params) \\n\\t the top level param names for these terms that need refined use a per-(user)request \\\"global\\\" counter to ensure that they are unique (+1) \\n\\t the top level term param names also include the facet.pivot spec they are needed for &#8211; this seems redundant since the counter is clearly global (even across multiple \\\"facet.pivot\\\" specs) \\n\\t these top leve term param names are then added only to the shard requests where refinement is actually needed for those terms (+1) and are referenced as variables in facet.pivot commands using the \\\"terms\\\" local param (which the shards evidently look for to know when this is a refinement request) \\n\\t because many terms may need refinement, that means each user specified  facet.pivot=X,Y  param results in  many  shard params of  facet.pivot={!terms=$N}X,Y  \\n \\n\\n\\n I realize that local params don\'t play nice with multi-valued params at all, let alone make it easy to use a single variable to refer to a multi-valued param &#8211; But wouldn\'t it be simpler (and less verbose over the wire) to just ignore Solr\'s built in param variable derefrencing and instead generate 1 unique param name to use for  all  the terms we care about (for each unique pivot spec), and then refer to that name once in a local param for a  single  facet.pivot param (which the pivot facet could would then go and explicitly fetch from the top level SolrParams as a multi-value)  \\n\\n The result being, that instead of the refinement requests shows above, the refinement requests for each shard could be something much simpler like... \\n\\n   shard1_proposed   \\n facet.pivot.mincount=-1\\n_fpt_1=hard+drive\\n_fpt_1=search\\n_fpt_1=software\\n_fpt_2=canon\\n_fpt_2=ati\\n_fpt_2=eu\\n_fpt_2=maxtor\\n_fpt_2=nor\\n_fpt_2=samsung\\n_fpt_2=viewsonic\\nfacet.pivot={!fpt=1}cat,inStock\\nfacet.pivot={!fpt=2}manu_id_s,inStock\\n \\n  \\n\\n   shard2_proposed   \\n facet.pivot.mincount=-1\\n_fpt_1=memory\\n_fpt_2=corsair\\n_fpt_2=apple\\n_fpt_2=asus\\n_fpt_2=boa\\n_fpt_2=dell\\n_fpt_2=uk\\nfacet.pivot={!fpt=1}cat,inStock\\nfacet.pivot={!fpt=2}manu_id_s,inStock\\n \\n  \\n\\n (where  &#95;fpt&#95;  is just a short prefix for \\\"facet pivot terms\\\" that i pulled out of my ass) \\n\\n \\n\\n Another thing I noticed is that with my 2 shard exampledocs setup, the following URL seems to send the pivot faceting into an infinite loop of refinement requests (note the typo: there\'s a space embeded in a field name  manu_id_s != manu_+id_s  )... \\n\\n  http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3  \\n\\n ...not clear what\'s going on there, but definitely something that needs fixed before committing (\\\"garbage in -&gt; garbage out\\\" is one thing, \\\"garbage in -&gt; crash your cluster\\\" is another) \\n\\n \\n\\n the multi-level refinement is sooooooo sweet.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13994027\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13994027&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13994027\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13994027_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13994027_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/14 23:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-09T23:04:53+0000\'\u003e09\\/May\\/14 23:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eSomething\'s wonky with the way mincount is handled - if you run the attached \\\"pivot_mincount_problem.sh\\\" script while a 2 node cluster is running with th example configs you can see the problem by comparing these 3 URLs...\u003c\\/p\u003e\\n\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ePivot1: \u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;facet=true&amp;facet.pivot=multi_50_ss,single_100_s&amp;facet.limit=10\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;facet=true&amp;facet.pivot=multi_50_ss,single_100_s&amp;facet.limit=10\u003c\\/a\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003eFilter: \u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;fq=multi_50_ss:35&amp;fq=single_100_s:79\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;fq=multi_50_ss:35&amp;fq=single_100_s:79\u003c\\/a\u003e\u003c\\/li\u003e\\n\\t\u003cli\u003ePivot2: \u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;facet=true&amp;facet.pivot=multi_50_ss,single_100_s&amp;facet.limit=10&amp;facet.pivot.mincount=10\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;facet=true&amp;facet.pivot=multi_50_ss,single_100_s&amp;facet.limit=10&amp;facet.pivot.mincount=10\u003c\\/a\u003e\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\\n\u003cp\u003eAccording to the \\\"Pivot1\\\" URL, there are 4244 total docs matching the query, of those 586 match \u003ctt\u003emulti_50_ss:35\u003c\\/tt\u003e and of those 13 match \u003ctt\u003esingle_100_s:79\u003c\\/tt\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003eThis all jives with what the \\\"Filter\\\" URL tells us (where we ignore the pivot facets and just apply those as filters)\u003c\\/p\u003e\\n\\n\u003cp\u003eBut if we add \u003ctt\u003efacet.pivot.mincount=10\u003c\\/tt\u003e to the original pivot request to get the \\\"Pivot2\\\" URL, no values for single_100_s make the cut as sub-facets of the 586 \u003ctt\u003emulti_50_ss:35\u003c\\/tt\u003e docs.\u003c\\/p\u003e\\n\\n\u003cp\u003eLooking at the logs of the shard queries, it appears that \u003ctt\u003efacet.pivot.mincount=-1\u003c\\/tt\u003e is set \u003cem\u003eonly\u003c\\/em\u003e on the refinement queries, but non in the initial sub-shard queries (where the limit over requesting happens to find the top terms).  So terms that don\'t match above the mincount on at least one \u003cem\u003esingle\u003c\\/em\u003e shard won\'t be considered at all for the cumulative total.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13994027_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13994027_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'09\\/May\\/14 23:04\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-09T23:04:53+0000\'\u003e09\\/May\\/14 23:04\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Something\'s wonky with the way mincount is handled - if you run the attached \\\"pivot_mincount_problem.sh\\\" script while a 2 node cluster is running with th example configs you can see the problem by comparing these 3 URLs... \\n\\n\\n \\n\\t Pivot1:  http:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;facet=true&amp;facet.pivot=multi_50_ss,single_100_s&amp;facet.limit=10  \\n\\t Filter:  http:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;fq=multi_50_ss:35&amp;fq=single_100_s:79  \\n\\t Pivot2:  http:\\/\\/localhost:8983\\/solr\\/select?rows=0&amp;wt=json&amp;indent=true&amp;q=single_7_s:%284%205%206%29&amp;facet=true&amp;facet.pivot=multi_50_ss,single_100_s&amp;facet.limit=10&amp;facet.pivot.mincount=10  \\n \\n\\n\\n\\n According to the \\\"Pivot1\\\" URL, there are 4244 total docs matching the query, of those 586 match  multi_50_ss:35  and of those 13 match  single_100_s:79  \\n\\n This all jives with what the \\\"Filter\\\" URL tells us (where we ignore the pivot facets and just apply those as filters) \\n\\n But if we add  facet.pivot.mincount=10  to the original pivot request to get the \\\"Pivot2\\\" URL, no values for single_100_s make the cut as sub-facets of the 586  multi_50_ss:35  docs. \\n\\n Looking at the logs of the shard queries, it appears that  facet.pivot.mincount=-1  is set  only  on the refinement queries, but non in the initial sub-shard queries (where the limit over requesting happens to find the top terms).  So terms that don\'t match above the mincount on at least one  single  shard won\'t be considered at all for the cumulative total.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13995229\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13995229&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13995229\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13995229_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13995229_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/14 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-12T16:44:00+0000\'\u003e12\\/May\\/14 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHmn.  Yes, both of those sound concerning.  I will take a look this week and get those squared away.  I did a bit of work last week to clean up the dff parameters block, but I still need to work out a few kinks there.  Let me know if you encounter anything else and I will continue to address these issues.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13995229_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13995229_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/14 16:44\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-12T16:44:00+0000\'\u003e12\\/May\\/14 16:44\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hmn.  Yes, both of those sound concerning.  I will take a look this week and get those squared away.  I did a bit of work last week to clean up the dff parameters block, but I still need to work out a few kinks there.  Let me know if you encounter anything else and I will continue to address these issues.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13995457\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13995457&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13995457\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13995457_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13995457_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/14 18:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-12T18:50:35+0000\'\u003e12\\/May\\/14 18:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHoss -\u003c\\/p\u003e\\n\\n\u003cp\u003eI am working to prioritize the changes you\'ve brought up.  While the size of the shard parameters may not strictly be as efficient as possible, is it such that we can run with that for now and circle back to this at a later point, or are you uncomfortable with including the parameters as is in the initial commit?\u003c\\/p\u003e\\n\\n\u003cp\u003e-Brett\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13995457_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13995457_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/May\\/14 18:50\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-12T18:50:35+0000\'\u003e12\\/May\\/14 18:50\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hoss - \\n\\n I am working to prioritize the changes you\'ve brought up.  While the size of the shard parameters may not strictly be as efficient as possible, is it such that we can run with that for now and circle back to this at a later point, or are you uncomfortable with including the parameters as is in the initial commit? \\n\\n -Brett              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13996656\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13996656&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13996656\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13996656_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13996656_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/May\\/14 17:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-13T17:18:03+0000\'\u003e13\\/May\\/14 17:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eAnother thing I noticed is that with my 2 shard exampledocs setup, the following URL seems to send the pivot faceting into an infinite loop of refinement requests (note the typo: there\'s a space embeded in a field name \u003ctt\u003emanu_id_s != manu_+id_s\u003c\\/tt\u003e )...\u003c\\/p\u003e\\n\\n\u003cp\u003e\u003ca href=\\\"http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003ehttp:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3\u003c\\/a\u003e\u003c\\/p\u003e\\n\\n\u003cp\u003e...not clear what\'s going on there, but definitely something that needs fixed before committing (\\\"garbage in -&gt; garbage out\\\" is one thing, \\\"garbage in -&gt; crash your cluster\\\" is another)\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI\'m not able to reproduce this.  Could you tell me a little more about your setup?  I am trying to recreate using the example data split to the two shards.  (a-m example files on shard1, n-z on shard2).  I\'ve run your script and added your data as well, and then gone to the URL you provided and added a \u003ctt\u003e&amp;shards=localhost:8983\\/solr,localhost:7574\\/solr\u003c\\/tt\u003e onto it.  It comes back each time without locking up.  I am using revision \u003ctt\u003e566d6371c77fd07d11f2e1b3033a669e26692a58\u003c\\/tt\u003e with only the \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e patch applied.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"brett.lucey\\\" id=\\\"commentauthor_13996656_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=brett.lucey\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"brett.lucey\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Brett Lucey\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13996656_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/May\\/14 17:18\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-13T17:18:03+0000\'\u003e13\\/May\\/14 17:18\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Another thing I noticed is that with my 2 shard exampledocs setup, the following URL seems to send the pivot faceting into an infinite loop of refinement requests (note the typo: there\'s a space embeded in a field name  manu_id_s != manu_+id_s  )... \\n\\n  http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3  \\n\\n ...not clear what\'s going on there, but definitely something that needs fixed before committing (\\\"garbage in -&gt; garbage out\\\" is one thing, \\\"garbage in -&gt; crash your cluster\\\" is another)  \\n\\n I\'m not able to reproduce this.  Could you tell me a little more about your setup?  I am trying to recreate using the example data split to the two shards.  (a-m example files on shard1, n-z on shard2).  I\'ve run your script and added your data as well, and then gone to the URL you provided and added a  &amp;shards=localhost:8983\\/solr,localhost:7574\\/solr  onto it.  It comes back each time without locking up.  I am using revision  566d6371c77fd07d11f2e1b3033a669e26692a58  with only the   SOLR-2894   patch applied.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13996730\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13996730&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13996730\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13996730_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13996730_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/May\\/14 18:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-13T18:21:04+0000\'\u003e13\\/May\\/14 18:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'m not able to reproduce this. Could you tell me a little more about your setup?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003etrunk, with patch applied, build the example and then run the \u003ca href=\\\"https:\\/\\/cwiki.apache.org\\/confluence\\/display\\/solr\\/Getting+Started+with+SolrCloud#GettingStartedwithSolrCloud-SimpleTwo-ShardClusterontheSameMachine\\\" class=\\\"external-link\\\" rel=\\\"nofollow\\\"\u003eSimple Two-Shard Cluster\u003c\\/a\u003e ...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003ehossman@frisbee:~\\/lucene\\/dev\\/solr$ cp -r example node1\\nhossman@frisbee:~\\/lucene\\/dev\\/solr$ cp -r example node2\\n\\n# in term1...\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/node1$ java -DzkRun -DnumShards=2 -Dbootstrap_confdir=.\\/solr\\/collection1\\/conf -Dcollection.configName=myconf -jar start.jar\\n\\n# wait for node1 startup, then in term2...\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/node2$ java -Djetty.port=7574 -DzkHost=localhost:9983 -jar start.jar\\n\\n# wait for node2 startup, then in term3...\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/example\\/exampledocs$ java -jar post.jar *.xml\\nSimplePostTool version 1.5\\nPosting files to base url http:\\/\\/localhost:8983\\/solr\\/update using content-type application\\/xml..\\n...\\n14 files indexed.\\nCOMMITting Solr index changes to http:\\/\\/localhost:8983\\/solr\\/update..\\nTime spent: 0:00:01.763\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/example\\/exampledocs$ curl \'http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3\' &gt; \\/dev\\/null\\n\\n# watch the logs in term1 and term2 go spinning like mad\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhile the size of the shard parameters may not strictly be as efficient as possible, is it such that we can run with that for now and circle back to this at a later point, or are you uncomfortable with including the parameters as is in the initial commit?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmm... not sure how i feel about it w\\/o more testing - from what i was seeing, with non-trivial field names, term values, and facet.limit the refinements requests were getting \u003cb\u003eHUGE\u003c\\/b\u003e so I suspect it\'s something we\'re going to want to tackle before releasing &#8211; but refactoring it to be smaller definitely seems like something that should be a lower priority to some of the correctness related issues we\'re finding, and adding more tests (so we can be confident the refactoring is correct)\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003eI\'m attaching a \\\"\u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-2894\\\" title=\\\"Implement distributed pivot faceting\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-2894\\\"\u003e\u003cdel\u003eSOLR-2894\u003c\\/del\u003e\u003c\\/a\u003e_cloud_test.patch\\\" that contains a new cloud based randomized test i\'ve been working at off and on over the last few days (I created it as a standalone patch because i didn\'t want to conflict with anything Brett might be in the middle of, and it was easy to do - kept me focused on the test and not dabbling with the internals).  \u003c\\/p\u003e\\n\\n\u003cp\u003eThe test builds up a bunch of random docs, then does a handfull of random pivot facet queries.  For each pivot query, it recursively walks the pivot response executing verification queries using \\\"fq\\\" params it builds up from the pivot constraints &#8211; so if pivot.facet=a,b,c says that \\\"a\\\" has a term \\\"x\\\" with 4 matching docs, it adds an \\\"fq=a:x\\\" to the original query and checks the count; then it looks a the pivot terms for field \\\"b\\\" under \\\"a:x\\\" and also executes a query for each of them with another fq added, etc...\u003c\\/p\u003e\\n\\n\u003cp\u003eAs is, the patch currently passes, but that\'s only because of a few nocommits...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003erandomization of mincount is disabled due to the refinement bug i mentioned before\u003c\\/li\u003e\\n\\t\u003cli\u003eit\'s currently only doing pivots on 2 string fields (one multivalued and one single valued) ... any attempts at pivot faceting the numeric\\/date\\/boolean fields (already included in the docs) causes an NPE in the SolrJ QueryResponse class (i haven\'t investigated why yet)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13996730_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13996730_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'13\\/May\\/14 18:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-13T18:21:04+0000\'\u003e13\\/May\\/14 18:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'m not able to reproduce this. Could you tell me a little more about your setup?  \\n\\n trunk, with patch applied, build the example and then run the  Simple Two-Shard Cluster  ... \\n\\n  \\n hossman@frisbee:~\\/lucene\\/dev\\/solr$ cp -r example node1\\nhossman@frisbee:~\\/lucene\\/dev\\/solr$ cp -r example node2\\n\\n# in term1...\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/node1$ java -DzkRun -DnumShards=2 -Dbootstrap_confdir=.\\/solr\\/collection1\\/conf -Dcollection.configName=myconf -jar start.jar\\n\\n# wait for node1 startup, then in term2...\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/node2$ java -Djetty.port=7574 -DzkHost=localhost:9983 -jar start.jar\\n\\n# wait for node2 startup, then in term3...\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/example\\/exampledocs$ java -jar post.jar *.xml\\nSimplePostTool version 1.5\\nPosting files to base url http:\\/\\/localhost:8983\\/solr\\/update using content-type application\\/xml..\\n...\\n14 files indexed.\\nCOMMITting Solr index changes to http:\\/\\/localhost:8983\\/solr\\/update..\\nTime spent: 0:00:01.763\\nhossman@frisbee:~\\/lucene\\/dev\\/solr\\/example\\/exampledocs$ curl \'http:\\/\\/localhost:8983\\/solr\\/select?q=*:*&amp;sort=id+desc&amp;rows=2&amp;facet=true&amp;facet.pivot=cat,manu_+id_s,inStock&amp;facet.limit=3\' &gt; \\/dev\\/null\\n\\n# watch the logs in term1 and term2 go spinning like mad\\n \\n  \\n\\n \\n\\n  While the size of the shard parameters may not strictly be as efficient as possible, is it such that we can run with that for now and circle back to this at a later point, or are you uncomfortable with including the parameters as is in the initial commit?  \\n\\n Hmm... not sure how i feel about it w\\/o more testing - from what i was seeing, with non-trivial field names, term values, and facet.limit the refinements requests were getting  HUGE  so I suspect it\'s something we\'re going to want to tackle before releasing &#8211; but refactoring it to be smaller definitely seems like something that should be a lower priority to some of the correctness related issues we\'re finding, and adding more tests (so we can be confident the refactoring is correct) \\n\\n \\n\\n I\'m attaching a \\\"  SOLR-2894  _cloud_test.patch\\\" that contains a new cloud based randomized test i\'ve been working at off and on over the last few days (I created it as a standalone patch because i didn\'t want to conflict with anything Brett might be in the middle of, and it was easy to do - kept me focused on the test and not dabbling with the internals).   \\n\\n The test builds up a bunch of random docs, then does a handfull of random pivot facet queries.  For each pivot query, it recursively walks the pivot response executing verification queries using \\\"fq\\\" params it builds up from the pivot constraints &#8211; so if pivot.facet=a,b,c says that \\\"a\\\" has a term \\\"x\\\" with 4 matching docs, it adds an \\\"fq=a:x\\\" to the original query and checks the count; then it looks a the pivot terms for field \\\"b\\\" under \\\"a:x\\\" and also executes a query for each of them with another fq added, etc... \\n\\n As is, the patch currently passes, but that\'s only because of a few nocommits... \\n\\n \\n\\t randomization of mincount is disabled due to the refinement bug i mentioned before \\n\\t it\'s currently only doing pivots on 2 string fields (one multivalued and one single valued) ... any attempts at pivot faceting the numeric\\/date\\/boolean fields (already included in the docs) causes an NPE in the SolrJ QueryResponse class (i haven\'t investigated why yet) \\n \\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13998067\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13998067&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13998067\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13998067_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13998067_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/May\\/14 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-14T21:19:49+0000\'\u003e14\\/May\\/14 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHey Hoss, I\'m working with Brett to clear up these issues and get 2894 commited.\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve done the work on the MinCount and simplified the logic and made it a fair bit easier to read and fixed the issue with pivot facets. The example you showed with the second query failing to return results has been rectified.\u003c\\/p\u003e\\n\\n\u003cp\u003eLets talk about the refinement terms. We can easily shorten the name of the !terms we use because as you\'ve correctly asserted that the number makes them unique the rest is just filler. But I don\'t understand how your example functions under the covers.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\\n\u003cp\u003eshard2_proposed\u003cbr\\/\u003e\\nfacet.pivot.mincount=-1\u003cbr\\/\u003e\\n_fpt_1=memory\u003cbr\\/\u003e\\n_fpt_2=corsair\u003cbr\\/\u003e\\n_fpt_2=apple\u003cbr\\/\u003e\\n_fpt_2=asus\u003cbr\\/\u003e\\n_fpt_2=boa\u003cbr\\/\u003e\\n_fpt_2=dell\u003cbr\\/\u003e\\n_fpt_2=uk\u003cbr\\/\u003e\\nfacet.pivot={&#33;fpt=1}cat,inStock\u003cbr\\/\u003e\\nfacet.pivot={&#33;fpt=2}manu_id_s,inStock\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cp\u003eWhat under the covers is used to make _fpt_2 match up to fpt=2 ? The one-to-many relation alters my understanding of how this works.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_13998067_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13998067_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'14\\/May\\/14 21:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-14T21:19:49+0000\'\u003e14\\/May\\/14 21:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hey Hoss, I\'m working with Brett to clear up these issues and get 2894 commited. \\n\\n I\'ve done the work on the MinCount and simplified the logic and made it a fair bit easier to read and fixed the issue with pivot facets. The example you showed with the second query failing to return results has been rectified. \\n\\n Lets talk about the refinement terms. We can easily shorten the name of the !terms we use because as you\'ve correctly asserted that the number makes them unique the rest is just filler. But I don\'t understand how your example functions under the covers. \\n\\n \\n shard2_proposed \\nfacet.pivot.mincount=-1 \\n_fpt_1=memory \\n_fpt_2=corsair \\n_fpt_2=apple \\n_fpt_2=asus \\n_fpt_2=boa \\n_fpt_2=dell \\n_fpt_2=uk \\nfacet.pivot={&#33;fpt=1}cat,inStock \\nfacet.pivot={&#33;fpt=2}manu_id_s,inStock  \\n What under the covers is used to make _fpt_2 match up to fpt=2 ? The one-to-many relation alters my understanding of how this works.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-13998875\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=13998875&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13998875\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13998875_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13998875_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/May\\/14 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-15T16:19:27+0000\'\u003e15\\/May\\/14 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI\'ve done the work on the MinCount and simplified the logic and made it a fair bit easier to read and fixed the issue with pivot facets. The example you showed with the second query failing to return results has been rectified.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eawesome.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eWhat under the covers is used to make _fpt_2 match up to fpt=2 ? The one-to-many relation alters my understanding of how this works.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI haven\'t been getting much sleep lately, so forgive me if i\'m misunderstanding your question or if my answer is obvious giberish:  I think what i had in mind before was just a few lines of new code in the pivot-refinement logic that runs on the shards to construct a param name for hte top levle multi-valued param using the numeric id, that the pivot could would lookup directly instead of relying on local param variable dereferencing &#8211; which as mentioned, doesn\'t support any sort of 1-to-many variable refs.\u003c\\/p\u003e\\n\\n\u003cp\u003e(i don\'t have the patch in front of me in an editor, so i\'ll make up variable names and do this mostly in psuedo-code)...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003eSolrParams reqParams = req.getParams()\\n\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e[] allPivots = reqParams.getParams(\u003cspan class=\\\"code-quote\\\"\u003e\\\"facet.pivot\\\"\u003c\\/span\u003e)\\n\u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e pivot : allPivots) {\\n  SolrParams localParams = parseLocalParams(pivot)\\n  \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e refine_id = localParams.get(\u003cspan class=\\\"code-quote\\\"\u003e\\\"fpt\\\"\u003c\\/span\u003e)\\n  \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e (refine_id == \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e) {\\n    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ TODO: not a refinement ... \u003cspan class=\\\"code-keyword\\\"\u003edo\u003c\\/span\u003e full pivoting\\n\u003c\\/span\u003e  } \u003cspan class=\\\"code-keyword\\\"\u003eelse\u003c\\/span\u003e {\\n    \u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e[] refinements = reqParams.getParams(\u003cspan class=\\\"code-quote\\\"\u003e\\\"_fpt_\\\"\u003c\\/span\u003e + refine_id)\\n    \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e (\u003cspan class=\\\"code-object\\\"\u003eString\u003c\\/span\u003e r : refinements) {\\n      \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/ TODO: compute the refinement count \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e \u003cspan class=\\\"code-quote\\\"\u003e\\\"r\\\"\u003c\\/span\u003e relative to the current \u003cspan class=\\\"code-quote\\\"\u003e\\\"pivot\\\"\u003c\\/span\u003e\\n\u003c\\/span\u003e    }\\n  }\\n}\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003e...does that make sense?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_13998875_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_13998875_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/May\\/14 16:19\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-15T16:19:27+0000\'\u003e15\\/May\\/14 16:19\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I\'ve done the work on the MinCount and simplified the logic and made it a fair bit easier to read and fixed the issue with pivot facets. The example you showed with the second query failing to return results has been rectified.  \\n\\n awesome. \\n\\n  What under the covers is used to make _fpt_2 match up to fpt=2 ? The one-to-many relation alters my understanding of how this works.  \\n\\n I haven\'t been getting much sleep lately, so forgive me if i\'m misunderstanding your question or if my answer is obvious giberish:  I think what i had in mind before was just a few lines of new code in the pivot-refinement logic that runs on the shards to construct a param name for hte top levle multi-valued param using the numeric id, that the pivot could would lookup directly instead of relying on local param variable dereferencing &#8211; which as mentioned, doesn\'t support any sort of 1-to-many variable refs. \\n\\n (i don\'t have the patch in front of me in an editor, so i\'ll make up variable names and do this mostly in psuedo-code)... \\n\\n  \\n SolrParams reqParams = req.getParams()\\n String [] allPivots = reqParams.getParams( \\\"facet.pivot\\\" )\\n for  ( String  pivot : allPivots) {\\n  SolrParams localParams = parseLocalParams(pivot)\\n   String  refine_id = localParams.get( \\\"fpt\\\" )\\n   if  (refine_id ==  null ) {\\n     \\/\\/ TODO: not a refinement ...  do  full pivoting\\n   }  else  {\\n     String [] refinements = reqParams.getParams( \\\"_fpt_\\\"  + refine_id)\\n     for  ( String  r : refinements) {\\n       \\/\\/ TODO: compute the refinement count  for   \\\"r\\\"  relative to the current  \\\"pivot\\\" \\n     }\\n  }\\n}\\n \\n  \\n\\n ...does that make sense?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14000337\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14000337&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14000337\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14000337_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14000337_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/14 21:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-16T21:27:07+0000\'\u003e16\\/May\\/14 21:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 16\\/May\\/14 21:28\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThank you Hoss, that explanation gave me everything I needed. \u003c\\/p\u003e\\n\\n\u003cp\u003eSo this patch breaks up the \\\"modifyRequest\\\" block into three parts. First is the global removal and then running of the \\\"modifyRequestForFieldFacets\\\" and \\\"modifyRequestForPivotFacets\\\" and includes the changed mincount for pivot facet fields.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis also changes the refinement queries from\u003cbr\\/\u003e\\n facet.pivot={!terms=$cat,inStock_10__terms}cat,inStock\u003cbr\\/\u003e\\nto\u003cbr\\/\u003e\\nfacet.pivot={!fpt=1}cat,inStock\u003c\\/p\u003e\\n\\n\u003cp\u003eThis caused some problems since before each term had its own facet.pivot and thusly its own context and PivotFacetProcessor. \u003cbr\\/\u003e\\nNow that we only have one context for all the refinement requests we needed to manage our DocSet since it gets messed with. But those issues seem to be fixed.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14000337_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14000337_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'16\\/May\\/14 21:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-16T21:27:07+0000\'\u003e16\\/May\\/14 21:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 16\\/May\\/14 21:28\\\"\u003eedited\u003c\\/span\u003e                   Thank you Hoss, that explanation gave me everything I needed.  \\n\\n So this patch breaks up the \\\"modifyRequest\\\" block into three parts. First is the global removal and then running of the \\\"modifyRequestForFieldFacets\\\" and \\\"modifyRequestForPivotFacets\\\" and includes the changed mincount for pivot facet fields. \\n\\n This also changes the refinement queries from \\n facet.pivot={!terms=$cat,inStock_10__terms}cat,inStock \\nto \\nfacet.pivot={!fpt=1}cat,inStock \\n\\n This caused some problems since before each term had its own facet.pivot and thusly its own context and PivotFacetProcessor.  \\nNow that we only have one context for all the refinement requests we needed to manage our DocSet since it gets messed with. But those issues seem to be fixed.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14002327\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14002327&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14002327\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14002327_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14002327_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/May\\/14 20:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-19T20:23:49+0000\'\u003e19\\/May\\/14 20:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eThe latest patch upload has included Brett\'s change, along with the changes I outlined earlier.\u003c\\/p\u003e\\n\\n\u003cp\u003eHoss, I think we\'ve addressed everything up to this point. I\'ve got time to correct any other issues you find.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14002327_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14002327_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'19\\/May\\/14 20:23\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-19T20:23:49+0000\'\u003e19\\/May\\/14 20:23\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    The latest patch upload has included Brett\'s change, along with the changes I outlined earlier. \\n\\n Hoss, I think we\'ve addressed everything up to this point. I\'ve got time to correct any other issues you find.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14003672\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14003672&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14003672\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14003672_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14003672_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/14 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-20T17:25:16+0000\'\u003e20\\/May\\/14 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI haven\'t had a lot of time to review the updatd patch in depth, but I did spend some time trying to improve TestCloudPivotFacet to resolve some of the nocommits &#8211; but i\'m still seeing failures...\u003c\\/p\u003e\\n\\n\u003cp\u003e1) I realized the \\\"depth\\\" check i was trying to do was bogus and commented it out (still need to purge the code - didn\'t want to muck with that until the rest of the test was passing more reliably)\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e2) the NPE I mentioned in QueryResponse.readPivots is still happening, but i realized that it has nothing to do with the datatype of the fields being pivoted on &#8211; it only seemed that way because of the poor randomization of values getting put in the single valued string fields vs the multivalued fields in the old version of the test.\u003c\\/p\u003e\\n\\n\u003cp\u003eThe bug seems to pop up in \u003cem\u003esome\u003c\\/em\u003e cases where a pivot constraint has no sub-pivots.  Normally this results in a NamedList with 3 keys (field,value,count) &#8211; the 4th \\\"pivot\\\" key is only included if there is a list of at least 1 sub-pivot.  But in some cases (I can\'t explain from looking at the code why) the server is responding back with a 4th entry using hte key \\\"pivot\\\" but the value is \\\"null\\\"\u003c\\/p\u003e\\n\\n\u003cp\u003eWe need to get to the bottom of this &#8211; it\'s not clear if there is a bug preventing real sub-pivot constraints from being returned correctly, or if this is just a mistake in the code where it\'s putting \\\"null\\\" in the NamedList instead of not adding anything at all (in which case it might be tempting to make QueryResponse.readPivots smart enough to deal with it, but if we did that it would still be broken for older clients &#8211; best to stick with teh current API semantics)\u003c\\/p\u003e\\n\\n\\n\u003cp\u003eIn the attached patch update, this seed will fail showing the null sub-pivots problem...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e\\n   [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=testDistribSearch -Dtests.seed=680E68425E7CA1BA -Dtests.slow=true -Dtests.locale=es_US -Dtests.timezone=Canada\\/Eastern -Dtests.file.encoding=UTF-8\\n   [junit4] FAILURE 41.7s | TestCloudPivotFacet.testDistribSearch &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.AssertionError: Server sent back \'null\' for sub pivots?\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([680E68425E7CA1BA:E9E8E65A2923C186]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.readPivots(QueryResponse.java:383)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.extractFacetInfo(QueryResponse.java:363)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.setResponse(QueryResponse.java:148)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.&lt;init&gt;(QueryResponse.java:91)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:91)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:301)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:161)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.doTest(TestCloudPivotFacet.java:145)\\n\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\\n\u003cp\u003e3) Independent (i think) from the NPE issue, there is still something wonky with the refined counts when mincount is specified...\u003c\\/p\u003e\\n\\n\u003cp\u003eHere for example is a seed that gets based the QueryResponse.readPivots, but then fails the numFound validation queries used to check the pivot counts...\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e   [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=testDistribSearch -Dtests.seed=F08A107C384690FC -Dtests.slow=true -Dtests.locale=ar_LY -Dtests.timezone=Jamaica -Dtests.file.encoding=UTF-8\\n   [junit4] FAILURE 27.0s | TestCloudPivotFacet.testDistribSearch &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.AssertionError: {main({main(facet.pivot.mincount=9),extra({main(facet.limit=12),extra({main(facet.pivot=pivot_y_s%2Cpivot_x_s1),extra(facet=true&amp;facet.pivot=pivot_x_s1%2Cpivot_x_s)})})}),extra(rows=0&amp;q=id%3A%5B*+TO+503%5D)} ==&gt; pivot_y_s,pivot_x_s1: {params(rows=0),defaults({main(rows=0&amp;q=id%3A%5B*+TO+503%5D),extra(fq=%7B%21term+f%3Dpivot_y_s%7D)})} expected:&lt;9&gt; but was:&lt;14&gt;\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([F08A107C384690FC:716C9E644F19F0C0]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:190)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.doTest(TestCloudPivotFacet.java:145)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:863)\\n   [junit4]    &gt; \\tat java.lang.Thread.run(Thread.java:744)\\n   [junit4]    &gt; Caused by: java.lang.AssertionError: pivot_y_s,pivot_x_s1: {params(rows=0),defaults({main(rows=0&amp;q=id%3A%5B*+TO+503%5D),extra(fq=%7B%21term+f%3Dpivot_y_s%7D)})} expected:&lt;9&gt; but was:&lt;14&gt;\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertNumFound(TestCloudPivotFacet.java:403)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:208)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:176)\\n   [junit4]    &gt; \\t... 42 more\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\\n\u003cp\u003eThis is saying that while doing a request with a pivot on the \\\"pivot_y_s,pivot_x_s1\\\" fields it looped over the (top level) pivot constraints in \\\"pivot_y_s\\\" - and for one of those term values (it just happens to be the empty string \\\"\\\") it got a pivot count of 9, but when it executed a query filtering the main results on that term (\\\"fq={!term f=pivot_y_s}\\\") the total number of results found were 14.\u003c\\/p\u003e\\n\\n\u003cp\u003eIf you comment out the line of the test that sets the FACET_PIVOT_MINCOUNT param, this seed stats to pass, suggesting that it\'s almost certianly the mincount logic that\'s putting a kink in the correctness of the final refined counts.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14003672_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14003672_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'20\\/May\\/14 17:25\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-20T17:25:16+0000\'\u003e20\\/May\\/14 17:25\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I haven\'t had a lot of time to review the updatd patch in depth, but I did spend some time trying to improve TestCloudPivotFacet to resolve some of the nocommits &#8211; but i\'m still seeing failures... \\n\\n 1) I realized the \\\"depth\\\" check i was trying to do was bogus and commented it out (still need to purge the code - didn\'t want to muck with that until the rest of the test was passing more reliably) \\n\\n\\n 2) the NPE I mentioned in QueryResponse.readPivots is still happening, but i realized that it has nothing to do with the datatype of the fields being pivoted on &#8211; it only seemed that way because of the poor randomization of values getting put in the single valued string fields vs the multivalued fields in the old version of the test. \\n\\n The bug seems to pop up in  some  cases where a pivot constraint has no sub-pivots.  Normally this results in a NamedList with 3 keys (field,value,count) &#8211; the 4th \\\"pivot\\\" key is only included if there is a list of at least 1 sub-pivot.  But in some cases (I can\'t explain from looking at the code why) the server is responding back with a 4th entry using hte key \\\"pivot\\\" but the value is \\\"null\\\" \\n\\n We need to get to the bottom of this &#8211; it\'s not clear if there is a bug preventing real sub-pivot constraints from being returned correctly, or if this is just a mistake in the code where it\'s putting \\\"null\\\" in the NamedList instead of not adding anything at all (in which case it might be tempting to make QueryResponse.readPivots smart enough to deal with it, but if we did that it would still be broken for older clients &#8211; best to stick with teh current API semantics) \\n\\n\\n In the attached patch update, this seed will fail showing the null sub-pivots problem... \\n\\n  \\n \\n   [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=testDistribSearch -Dtests.seed=680E68425E7CA1BA -Dtests.slow=true -Dtests.locale=es_US -Dtests.timezone=Canada\\/Eastern -Dtests.file.encoding=UTF-8\\n   [junit4] FAILURE 41.7s | TestCloudPivotFacet.testDistribSearch &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.AssertionError: Server sent back \'null\' for sub pivots?\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([680E68425E7CA1BA:E9E8E65A2923C186]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.readPivots(QueryResponse.java:383)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.extractFacetInfo(QueryResponse.java:363)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.setResponse(QueryResponse.java:148)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.response.QueryResponse.&lt;init&gt;(QueryResponse.java:91)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.request.QueryRequest.process(QueryRequest.java:91)\\n   [junit4]    &gt; \\tat org.apache.solr.client.solrj.SolrServer.query(SolrServer.java:301)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:161)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.doTest(TestCloudPivotFacet.java:145)\\n\\n \\n  \\n\\n\\n\\n 3) Independent (i think) from the NPE issue, there is still something wonky with the refined counts when mincount is specified... \\n\\n Here for example is a seed that gets based the QueryResponse.readPivots, but then fails the numFound validation queries used to check the pivot counts... \\n\\n  \\n    [junit4]   2&gt; NOTE: reproduce with: ant test  -Dtestcase=TestCloudPivotFacet -Dtests.method=testDistribSearch -Dtests.seed=F08A107C384690FC -Dtests.slow=true -Dtests.locale=ar_LY -Dtests.timezone=Jamaica -Dtests.file.encoding=UTF-8\\n   [junit4] FAILURE 27.0s | TestCloudPivotFacet.testDistribSearch &lt;&lt;&lt;\\n   [junit4]    &gt; Throwable #1: java.lang.AssertionError: {main({main(facet.pivot.mincount=9),extra({main(facet.limit=12),extra({main(facet.pivot=pivot_y_s%2Cpivot_x_s1),extra(facet=true&amp;facet.pivot=pivot_x_s1%2Cpivot_x_s)})})}),extra(rows=0&amp;q=id%3A%5B*+TO+503%5D)} ==&gt; pivot_y_s,pivot_x_s1: {params(rows=0),defaults({main(rows=0&amp;q=id%3A%5B*+TO+503%5D),extra(fq=%7B%21term+f%3Dpivot_y_s%7D)})} expected:&lt;9&gt; but was:&lt;14&gt;\\n   [junit4]    &gt; \\tat __randomizedtesting.SeedInfo.seed([F08A107C384690FC:716C9E644F19F0C0]:0)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:190)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.doTest(TestCloudPivotFacet.java:145)\\n   [junit4]    &gt; \\tat org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:863)\\n   [junit4]    &gt; \\tat java.lang.Thread.run(Thread.java:744)\\n   [junit4]    &gt; Caused by: java.lang.AssertionError: pivot_y_s,pivot_x_s1: {params(rows=0),defaults({main(rows=0&amp;q=id%3A%5B*+TO+503%5D),extra(fq=%7B%21term+f%3Dpivot_y_s%7D)})} expected:&lt;9&gt; but was:&lt;14&gt;\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertNumFound(TestCloudPivotFacet.java:403)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:208)\\n   [junit4]    &gt; \\tat org.apache.solr.cloud.TestCloudPivotFacet.assertPivotCountsAreCorrect(TestCloudPivotFacet.java:176)\\n   [junit4]    &gt; \\t... 42 more\\n \\n  \\n\\n\\n This is saying that while doing a request with a pivot on the \\\"pivot_y_s,pivot_x_s1\\\" fields it looped over the (top level) pivot constraints in \\\"pivot_y_s\\\" - and for one of those term values (it just happens to be the empty string \\\"\\\") it got a pivot count of 9, but when it executed a query filtering the main results on that term (\\\"fq={!term f=pivot_y_s}\\\") the total number of results found were 14. \\n\\n If you comment out the line of the test that sets the FACET_PIVOT_MINCOUNT param, this seed stats to pass, suggesting that it\'s almost certianly the mincount logic that\'s putting a kink in the correctness of the final refined counts.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14005984\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14005984&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14005984\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14005984_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14005984_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/May\\/14 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-22T15:02:00+0000\'\u003e22\\/May\\/14 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 22\\/May\\/14 15:41\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eMe and Brett discovered serveral bugs with our mincount and the changes I made to our refinement requests that resulted in the odd behavior you were seeing.  Not everything is super happy. I get what look like solrcloud errors when running certain seeds\u003cbr\\/\u003e\\nI forgot this patch also comments out the randomUsableUnicodeString to just be a simple string, BUT I\'ve changed it back on my box and It seems to be fine.\u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e215 T12 oasc.SolrResourceLoader.locateSolrHome using system property solr.solr.home: ..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\n5216 T12 oasc.SolrResourceLoader.&lt;init&gt; \u003cspan class=\\\"code-keyword\\\"\u003enew\u003c\\/span\u003e SolrResourceLoader \u003cspan class=\\\"code-keyword\\\"\u003efor\u003c\\/span\u003e directory: \u003cspan class=\\\"code-quote\\\"\u003e\'..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\\\\'\u003c\\/span\u003e\\n5421 T12 oasc.ConfigSolr.fromFile Loading container configuration from D:\\\\hmm\\\\lucene-solr\\\\..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\\\solr.xml\\n5422 T12 oass.SolrDispatchFilter.init ERROR Could not start Solr. Check solr\\/home property and the logs\\n5483 T12 oasc.SolrException.log ERROR \u003cspan class=\\\"code-keyword\\\"\u003enull\u003c\\/span\u003e:org.apache.solr.common.SolrException: Could not load SOLR configuration\\n\\t\\tat org.apache.solr.core.ConfigSolr.fromFile(ConfigSolr.java:71)\\n\\t\\tat org.apache.solr.core.ConfigSolr.fromSolrHome(ConfigSolr.java:96)\\n\\t\\tat org.apache.solr.servlet.SolrDispatchFilter.loadConfigSolr(SolrDispatchFilter.java:157)\\n\\t\\tat org.apache.solr.servlet.SolrDispatchFilter.createCoreContainer(SolrDispatchFilter.java:188)\\n\\t\\tat org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:137)\\n\\t\\tat org.eclipse.jetty.servlet.FilterHolder.doStart(FilterHolder.java:119)\\n\\t\\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.initialize(ServletHandler.java:719)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.updateMappings(ServletHandler.java:1309)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.setFilterMappings(ServletHandler.java:1345)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.addFilterMapping(ServletHandler.java:1085)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.addFilterWithMapping(ServletHandler.java:931)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.addFilterWithMapping(ServletHandler.java:888)\\n\\t\\tat org.eclipse.jetty.servlet.ServletContextHandler.addFilter(ServletContextHandler.java:340)\\n\\t\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$1.lifeCycleStarted(JettySolrRunner.java:327)\\n\\t\\tat org.eclipse.jetty.util.component.AbstractLifeCycle.setStarted(AbstractLifeCycle.java:174)\\n\\t\\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:65)\\n\\t\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner.start(JettySolrRunner.java:432)\\n\\t\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner.start(JettySolrRunner.java:405)\\n\\t\\tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.createJetty(AbstractFullDistribZkTestBase.java:481)\\n\\t\\tat org.apache.solr.BaseDistributedSearchTestCase.createJetty(BaseDistributedSearchTestCase.java:351)\\n\\t\\tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.createServers(AbstractFullDistribZkTestBase.java:282)\\n\\t\\tat org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:863)\\n\\t\\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\\n\\t\\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\\n\\t\\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\\n\\t\\tat java.lang.reflect.Method.invoke(Method.java:606)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1618)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:827)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:863)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:877)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\\n\\t\\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\\n\\t\\tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:51)\\n\\t\\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\\n\\t\\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\\n\\t\\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\\n\\t\\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:360)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:793)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:453)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:836)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:738)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:772)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:783)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\\n\\t\\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\\n\\t\\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\\n\\t\\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\\n\\t\\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\\n\\t\\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:360)\\n\\t\\tat java.lang.\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.run(\u003cspan class=\\\"code-object\\\"\u003eThread\u003c\\/span\u003e.java:724)\\n\\tCaused by: org.apache.solr.common.SolrException: solr.xml does not exist in D:\\\\hmm\\\\lucene-solr\\\\..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\\\solr.xml cannot start Solr\\n\\t\\tat org.apache.solr.core.ConfigSolr.fromFile(ConfigSolr.java:62)\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eI\'ve run your TestCloudPivotFacet test a bunch of times and I only get ZK errors, no value mismatch or null sub-pivots.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14005984_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14005984_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'22\\/May\\/14 15:02\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-05-22T15:02:00+0000\'\u003e22\\/May\\/14 15:02\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 22\\/May\\/14 15:41\\\"\u003eedited\u003c\\/span\u003e                   Me and Brett discovered serveral bugs with our mincount and the changes I made to our refinement requests that resulted in the odd behavior you were seeing.  Not everything is super happy. I get what look like solrcloud errors when running certain seeds \\nI forgot this patch also comments out the randomUsableUnicodeString to just be a simple string, BUT I\'ve changed it back on my box and It seems to be fine. \\n  \\n 215 T12 oasc.SolrResourceLoader.locateSolrHome using system property solr.solr.home: ..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\n5216 T12 oasc.SolrResourceLoader.&lt;init&gt;  new  SolrResourceLoader  for  directory:  \'..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\\\\' \\n5421 T12 oasc.ConfigSolr.fromFile Loading container configuration from D:\\\\hmm\\\\lucene-solr\\\\..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\\\solr.xml\\n5422 T12 oass.SolrDispatchFilter.init ERROR Could not start Solr. Check solr\\/home property and the logs\\n5483 T12 oasc.SolrException.log ERROR  null :org.apache.solr.common.SolrException: Could not load SOLR configuration\\n\\t\\tat org.apache.solr.core.ConfigSolr.fromFile(ConfigSolr.java:71)\\n\\t\\tat org.apache.solr.core.ConfigSolr.fromSolrHome(ConfigSolr.java:96)\\n\\t\\tat org.apache.solr.servlet.SolrDispatchFilter.loadConfigSolr(SolrDispatchFilter.java:157)\\n\\t\\tat org.apache.solr.servlet.SolrDispatchFilter.createCoreContainer(SolrDispatchFilter.java:188)\\n\\t\\tat org.apache.solr.servlet.SolrDispatchFilter.init(SolrDispatchFilter.java:137)\\n\\t\\tat org.eclipse.jetty.servlet.FilterHolder.doStart(FilterHolder.java:119)\\n\\t\\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:64)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.initialize(ServletHandler.java:719)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.updateMappings(ServletHandler.java:1309)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.setFilterMappings(ServletHandler.java:1345)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.addFilterMapping(ServletHandler.java:1085)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.addFilterWithMapping(ServletHandler.java:931)\\n\\t\\tat org.eclipse.jetty.servlet.ServletHandler.addFilterWithMapping(ServletHandler.java:888)\\n\\t\\tat org.eclipse.jetty.servlet.ServletContextHandler.addFilter(ServletContextHandler.java:340)\\n\\t\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner$1.lifeCycleStarted(JettySolrRunner.java:327)\\n\\t\\tat org.eclipse.jetty.util.component.AbstractLifeCycle.setStarted(AbstractLifeCycle.java:174)\\n\\t\\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:65)\\n\\t\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner.start(JettySolrRunner.java:432)\\n\\t\\tat org.apache.solr.client.solrj.embedded.JettySolrRunner.start(JettySolrRunner.java:405)\\n\\t\\tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.createJetty(AbstractFullDistribZkTestBase.java:481)\\n\\t\\tat org.apache.solr.BaseDistributedSearchTestCase.createJetty(BaseDistributedSearchTestCase.java:351)\\n\\t\\tat org.apache.solr.cloud.AbstractFullDistribZkTestBase.createServers(AbstractFullDistribZkTestBase.java:282)\\n\\t\\tat org.apache.solr.BaseDistributedSearchTestCase.testDistribSearch(BaseDistributedSearchTestCase.java:863)\\n\\t\\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\\n\\t\\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)\\n\\t\\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\\n\\t\\tat java.lang.reflect.Method.invoke(Method.java:606)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner.invoke(RandomizedRunner.java:1618)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$6.evaluate(RandomizedRunner.java:827)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$7.evaluate(RandomizedRunner.java:863)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$8.evaluate(RandomizedRunner.java:877)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\\n\\t\\tat org.apache.lucene.util.TestRuleSetupTeardownChained$1.evaluate(TestRuleSetupTeardownChained.java:50)\\n\\t\\tat org.apache.lucene.util.TestRuleFieldCacheSanity$1.evaluate(TestRuleFieldCacheSanity.java:51)\\n\\t\\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\\n\\t\\tat org.apache.lucene.util.TestRuleThreadAndTestName$1.evaluate(TestRuleThreadAndTestName.java:49)\\n\\t\\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\\n\\t\\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:360)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl.forkTimeoutingTask(ThreadLeakControl.java:793)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$3.evaluate(ThreadLeakControl.java:453)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner.runSingleTest(RandomizedRunner.java:836)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$3.evaluate(RandomizedRunner.java:738)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$4.evaluate(RandomizedRunner.java:772)\\n\\t\\tat com.carrotsearch.randomizedtesting.RandomizedRunner$5.evaluate(RandomizedRunner.java:783)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesRestoreRule$1.evaluate(SystemPropertiesRestoreRule.java:53)\\n\\t\\tat org.apache.lucene.util.AbstractBeforeAfterRule$1.evaluate(AbstractBeforeAfterRule.java:46)\\n\\t\\tat org.apache.lucene.util.TestRuleStoreClassName$1.evaluate(TestRuleStoreClassName.java:42)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.SystemPropertiesInvariantRule$1.evaluate(SystemPropertiesInvariantRule.java:55)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.NoShadowingOrOverridesOnMethodsRule$1.evaluate(NoShadowingOrOverridesOnMethodsRule.java:39)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat org.apache.lucene.util.TestRuleAssertionsRequired$1.evaluate(TestRuleAssertionsRequired.java:43)\\n\\t\\tat org.apache.lucene.util.TestRuleMarkFailure$1.evaluate(TestRuleMarkFailure.java:48)\\n\\t\\tat org.apache.lucene.util.TestRuleIgnoreAfterMaxFailures$1.evaluate(TestRuleIgnoreAfterMaxFailures.java:65)\\n\\t\\tat org.apache.lucene.util.TestRuleIgnoreTestSuites$1.evaluate(TestRuleIgnoreTestSuites.java:55)\\n\\t\\tat com.carrotsearch.randomizedtesting.rules.StatementAdapter.evaluate(StatementAdapter.java:36)\\n\\t\\tat com.carrotsearch.randomizedtesting.ThreadLeakControl$StatementRunner.run(ThreadLeakControl.java:360)\\n\\t\\tat java.lang. Thread .run( Thread .java:724)\\n\\tCaused by: org.apache.solr.common.SolrException: solr.xml does not exist in D:\\\\hmm\\\\lucene-solr\\\\..\\\\..\\\\C:\\\\Users\\\\AMULDO~1\\\\AppData\\\\Local\\\\Temp\\\\solr.cloud.TestCloudPivotFacet-A515DED004CF1660-001\\\\tempDir-002\\\\solr.xml cannot start Solr\\n\\t\\tat org.apache.solr.core.ConfigSolr.fromFile(ConfigSolr.java:62)\\n \\n  \\n\\n I\'ve run your TestCloudPivotFacet test a bunch of times and I only get ZK errors, no value mismatch or null sub-pivots.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14026707\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14026707&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14026707\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14026707_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14026707_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/14 17:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-10T17:22:10+0000\'\u003e10\\/Jun\\/14 17:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eStarted getting back into this yesterday (i should have several large blocks of time for this issue this week &amp; next week)...\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eMe and Brett discovered serveral bugs with our mincount and the changes I made to our refinement requests that resulted in the odd behavior you were seeing. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAwesome! ... glad to see the test was useful.\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eNot everything is super happy. I get what look like solrcloud errors when running certain seeds\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eHmmm... that is a weird error.  People sometimes see errors in solr tests that use threads related to timing and\\/or assertions of things that haven\'t happened yet - but i don\'t remember ever seeing anything like this type of problem with initialization of the cores.\u003c\\/p\u003e\\n\\n\u003cp\u003edo these failures reproduce for you with the same seeds?  can you post the full reproduce line that you get with these failures?\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eI forgot this patch also comments out the randomUsableUnicodeString to just be a simple string, BUT I\'ve changed it back on my box and It seems to be fine.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eyep &#8211; it also still had one of my nocommits so that it was \u003cem\u003eonly\u003c\\/em\u003e pivoting on string fields, but even w\\/o that it\'s worked great for me on many iterations.\u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003eRevised patch - mostly cleaning up the lingering issues in TestCloudPivotFacet but a few other minor fixes of stuff i noticed.\u003c\\/p\u003e\\n\\n\u003cp\u003eDetailed changes compared to previous patch...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eremoved \\\"TestDistributedSearch.java.orig\\\" that seems to have been included in patch by mistake\u003c\\/li\u003e\\n\\t\u003cli\u003ecleanup TestCloudPivotFacet\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003efixed randomUsableUnicodeString()\u003c\\/li\u003e\\n\\t\\t\u003cli\u003efix nocommit about testing pivot on non-string fields\u003c\\/li\u003e\\n\\t\\t\u003cli\u003efixed the depth checking (we can assert the \u003cb\u003emax\u003c\\/b\u003e depth, but that\'s it)\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eremoved weird (unused) \\\"int ss = 2\\\" that got added to assertNumFound\\n\\t\\t\u003cul\u003e\\n\\t\\t\\t\u003cli\u003ewas also in some dead code in PivotFacetProcessor?\u003c\\/li\u003e\\n\\t\\t\u003c\\/ul\u003e\\n\\t\\t\u003c\\/li\u003e\\n\\t\\t\u003cli\u003erefactored cut\\/pate methods from Cursor test into baseclass\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eI removed the NullGoesLastComparator class and replaced it with a compareWithNullLast helper method in PivotFacetField (and added a unit test for it)\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ethe Comparator contract is pretty explicit about null, and this class violated that\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eit was only being used for simple method calls, not passed to anything that explicitly needed a Comparator, so there wasn\'t a strong need for a standalone class\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003eMy \\\"next step\\\" plans...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003ereview DistributedFacetPivotTest in depth more - add more strong assertions\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eat first glance, it looks like a lot of the test is following the example of most existing distrib tests of relying on comparisons between the controlClient and the distrib client &#8211; in my opinion that\'s a bad pattern, and i\'d like to add some explicit assertions on the results of all the \u003ctt\u003ethis.query(...)\u003c\\/tt\u003e calls\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003ere-review the new pivot code (and the changes to facet code) in general\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eit\'s been a while since my last skim, and i know you\'ve tweaked a bunch based on my previous comments\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ei\'ll take a stab at adding more javadocs to some of the new methods as i make sense of them\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ewhere possible, i\'m going to try to add unit tests for some of the new low level methods you\'ve introduced &#8211; largely as a way to help ensure i understand what they do\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14026707_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14026707_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'10\\/Jun\\/14 17:22\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-10T17:22:10+0000\'\u003e10\\/Jun\\/14 17:22\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Started getting back into this yesterday (i should have several large blocks of time for this issue this week &amp; next week)... \\n\\n  Me and Brett discovered serveral bugs with our mincount and the changes I made to our refinement requests that resulted in the odd behavior you were seeing.   \\n\\n Awesome! ... glad to see the test was useful. \\n\\n  Not everything is super happy. I get what look like solrcloud errors when running certain seeds  \\n\\n Hmmm... that is a weird error.  People sometimes see errors in solr tests that use threads related to timing and\\/or assertions of things that haven\'t happened yet - but i don\'t remember ever seeing anything like this type of problem with initialization of the cores. \\n\\n do these failures reproduce for you with the same seeds?  can you post the full reproduce line that you get with these failures? \\n\\n  I forgot this patch also comments out the randomUsableUnicodeString to just be a simple string, BUT I\'ve changed it back on my box and It seems to be fine.  \\n\\n yep &#8211; it also still had one of my nocommits so that it was  only  pivoting on string fields, but even w\\/o that it\'s worked great for me on many iterations. \\n\\n \\n\\n Revised patch - mostly cleaning up the lingering issues in TestCloudPivotFacet but a few other minor fixes of stuff i noticed. \\n\\n Detailed changes compared to previous patch... \\n\\n \\n\\t removed \\\"TestDistributedSearch.java.orig\\\" that seems to have been included in patch by mistake \\n\\t cleanup TestCloudPivotFacet\\n\\t \\n\\t\\t fixed randomUsableUnicodeString() \\n\\t\\t fix nocommit about testing pivot on non-string fields \\n\\t\\t fixed the depth checking (we can assert the  max  depth, but that\'s it) \\n\\t\\t removed weird (unused) \\\"int ss = 2\\\" that got added to assertNumFound\\n\\t\\t \\n\\t\\t\\t was also in some dead code in PivotFacetProcessor? \\n\\t\\t \\n\\t\\t \\n\\t\\t refactored cut\\/pate methods from Cursor test into baseclass \\n\\t \\n\\t \\n\\t I removed the NullGoesLastComparator class and replaced it with a compareWithNullLast helper method in PivotFacetField (and added a unit test for it)\\n\\t \\n\\t\\t the Comparator contract is pretty explicit about null, and this class violated that \\n\\t\\t it was only being used for simple method calls, not passed to anything that explicitly needed a Comparator, so there wasn\'t a strong need for a standalone class \\n\\t \\n\\t \\n \\n\\n\\n \\n\\n My \\\"next step\\\" plans... \\n\\n \\n\\t review DistributedFacetPivotTest in depth more - add more strong assertions\\n\\t \\n\\t\\t at first glance, it looks like a lot of the test is following the example of most existing distrib tests of relying on comparisons between the controlClient and the distrib client &#8211; in my opinion that\'s a bad pattern, and i\'d like to add some explicit assertions on the results of all the  this.query(...)  calls \\n\\t \\n\\t \\n\\t re-review the new pivot code (and the changes to facet code) in general\\n\\t \\n\\t\\t it\'s been a while since my last skim, and i know you\'ve tweaked a bunch based on my previous comments \\n\\t\\t i\'ll take a stab at adding more javadocs to some of the new methods as i make sense of them \\n\\t\\t where possible, i\'m going to try to add unit tests for some of the new low level methods you\'ve introduced &#8211; largely as a way to help ensure i understand what they do \\n\\t \\n\\t \\n \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14027285\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14027285&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14027285\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14027285_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14027285_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/14 00:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-11T00:57:05+0000\'\u003e11\\/Jun\\/14 00:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003ereview DistributedFacetPivotTest in depth more - add more strong assertions\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eAttaching updated patch with progress along this line: in addition so some new explicit assertions, it also includes some refactoring &amp; simplification of setupDistributedPivotFacetDocuments\u003c\\/p\u003e\\n\\n\u003cp\u003eOne thing that jumped out at me when reviewing this is even though the test does some queries with large overrequest params as well disabling overrequest, there doesn\'t seem to be any assertions about how the overrequesting affects the results &#8211; in fact, because of how the controlClient is compared with the distributed client, it seems that with this sample data disabling overrequest doesn\'t even change the results at all.\u003c\\/p\u003e\\n\\n\u003cp\u003eI definitely want to add some test logic around that &#8211; if for no other reason then to prove that \u003cb\u003ewhen\u003c\\/b\u003e the overrequesting is used, it can help with finding constraints in the long tail\u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14027285_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14027285_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'11\\/Jun\\/14 00:57\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-11T00:57:05+0000\'\u003e11\\/Jun\\/14 00:57\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     review DistributedFacetPivotTest in depth more - add more strong assertions  \\n\\n Attaching updated patch with progress along this line: in addition so some new explicit assertions, it also includes some refactoring &amp; simplification of setupDistributedPivotFacetDocuments \\n\\n One thing that jumped out at me when reviewing this is even though the test does some queries with large overrequest params as well disabling overrequest, there doesn\'t seem to be any assertions about how the overrequesting affects the results &#8211; in fact, because of how the controlClient is compared with the distributed client, it seems that with this sample data disabling overrequest doesn\'t even change the results at all. \\n\\n I definitely want to add some test logic around that &#8211; if for no other reason then to prove that  when  the overrequesting is used, it can help with finding constraints in the long tail \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14028689\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14028689&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14028689\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14028689_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14028689_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T01:24:22+0000\'\u003e12\\/Jun\\/14 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI definitely want to add some test logic around that \\u2013 if for no other reason then to prove that when the overrequesting is used, it can help with finding constraints in the long tail\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eUpdated patch...\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003enew DistributedFacetPivotLongTailTest\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ecrafts the shard distribution specifically to demonstrate that overrequesting is affecting things as expected\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003esplit DistributedFacetPivotTest into DistributedFacetPivotSmallTest and DistributedFacetPivotLargeTest\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003ethis was already 2 very different sets of data with two very differnet styles of asserting expected results &#8211; so i went ahead and split it up\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eNow there isn\'t the weird suprise that halfway through a test all the data is deleted and new data is added and more asertions are made.\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eBrett &amp; Andrew: would really appreciate if you guys could review my changes to your existing test as well as the new LongTail test and help sanity check that the assertions all look correct.\u003c\\/p\u003e\\n\\n\u003cp\u003eAssuming you guys don\'t spot any problems with the tests: next up i\'ll move back into reviewing the code more in depth, and documenting\\/refactoring\\/unit-testing as needed to help myself understand all this awesomeness you guys have added.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14028689_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14028689_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 01:24\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T01:24:22+0000\'\u003e12\\/Jun\\/14 01:24\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I definitely want to add some test logic around that \\u2013 if for no other reason then to prove that when the overrequesting is used, it can help with finding constraints in the long tail  \\n\\n Updated patch... \\n \\n\\t new DistributedFacetPivotLongTailTest\\n\\t \\n\\t\\t crafts the shard distribution specifically to demonstrate that overrequesting is affecting things as expected \\n\\t \\n\\t \\n\\t split DistributedFacetPivotTest into DistributedFacetPivotSmallTest and DistributedFacetPivotLargeTest\\n\\t \\n\\t\\t this was already 2 very different sets of data with two very differnet styles of asserting expected results &#8211; so i went ahead and split it up \\n\\t\\t Now there isn\'t the weird suprise that halfway through a test all the data is deleted and new data is added and more asertions are made. \\n\\t \\n\\t \\n \\n\\n\\n Brett &amp; Andrew: would really appreciate if you guys could review my changes to your existing test as well as the new LongTail test and help sanity check that the assertions all look correct. \\n\\n Assuming you guys don\'t spot any problems with the tests: next up i\'ll move back into reviewing the code more in depth, and documenting\\/refactoring\\/unit-testing as needed to help myself understand all this awesomeness you guys have added.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14029319\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14029319&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14029319\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14029319_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029319_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T16:21:06+0000\'\u003e12\\/Jun\\/14 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 12\\/Jun\\/14 16:34\\\"\u003eedited\u003c\\/span\u003e \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI\'m on it. \u003cbr\\/\u003e\\nI\'m loving all these added asserts. I\'ve added a few asserts that test the exact data that proves refinement worked,  I\'ll work through the whole changeset and post up what I\'ve got.\u003c\\/p\u003e\\n\\n\u003cp\u003eI want to bring up a separate issue that we\'ve been dealing with in this patch.\u003c\\/p\u003e\\n\\n\u003cp\u003eSolrJ and its response types. I\'m fairly certain that field facets always return the value of any field as a string, so \\\"true\\\" instead of boolean.true and dates in the external format not the pretty printed format. This isn\'t wholly true in pivot facets right now and it causes some wierdness in the code. \u003cbr\\/\u003e\\nI\'d personally like to just use the string data types like field facet does, and remove the hacky functionality that sends back objects for solrJ\u003cbr\\/\u003e\\nHoss, thoughts?\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n                                            \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14029319_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029319_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 16:21\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T16:21:06+0000\'\u003e12\\/Jun\\/14 16:21\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e   - \u003cspan class=\\\"redText subText\\\" title=\\\"Andrew Muldowney - 12\\/Jun\\/14 16:34\\\"\u003eedited\u003c\\/span\u003e                   I\'m on it.  \\nI\'m loving all these added asserts. I\'ve added a few asserts that test the exact data that proves refinement worked,  I\'ll work through the whole changeset and post up what I\'ve got. \\n\\n I want to bring up a separate issue that we\'ve been dealing with in this patch. \\n\\n SolrJ and its response types. I\'m fairly certain that field facets always return the value of any field as a string, so \\\"true\\\" instead of boolean.true and dates in the external format not the pretty printed format. This isn\'t wholly true in pivot facets right now and it causes some wierdness in the code.  \\nI\'d personally like to just use the string data types like field facet does, and remove the hacky functionality that sends back objects for solrJ \\nHoss, thoughts?              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14029461\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14029461&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14029461\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14029461_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029461_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T17:27:59+0000\'\u003e12\\/Jun\\/14 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eThis isn\'t wholly true in pivot facets right now and it causes some wierdness in the code.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\u003cblockquote\u003e\u003cp\u003eI\'d personally like to just use the string data types like field facet does, and remove the hacky functionality that sends back objects for solrJ\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCan you elaborate on what kind of weirdness\\/hacky functionality you are talking about?\u003c\\/p\u003e\\n\\n\u003cp\u003epersonally i\'m a big fan of the fact that the facet.pivot returns the correct data types for the corresponding FieldType &#8211; i think that\'s a big improvement over facet.field.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14029461_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029461_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 17:27\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T17:27:59+0000\'\u003e12\\/Jun\\/14 17:27\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     This isn\'t wholly true in pivot facets right now and it causes some wierdness in the code.  \\n  I\'d personally like to just use the string data types like field facet does, and remove the hacky functionality that sends back objects for solrJ  \\n\\n Can you elaborate on what kind of weirdness\\/hacky functionality you are talking about? \\n\\n personally i\'m a big fan of the fact that the facet.pivot returns the correct data types for the corresponding FieldType &#8211; i think that\'s a big improvement over facet.field.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14029531\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14029531&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14029531\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14029531_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029531_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 18:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T18:09:38+0000\'\u003e12\\/Jun\\/14 18:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eCan you elaborate on what kind of weirdness\\/hacky functionality you are talking about?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eIn the PivotFacetProcessor (shards) we .toObject each value. This is weird in the non-distributed mode because nothing clears up those into strings for the response -XML or JSON. This is a problem with dates, because \\\"2012-11-01T12:30:00Z\\\" becomes \\\"Nov 1 4:30 EST 2012\\\". I don\'t know what methods get run after process in the non-distrib mode that we could hook into to change these values back into what they should be.\u003c\\/p\u003e\\n\\n\u003cp\u003eIn distributed this can be trouble because when trying to assign a refinement path we must get the .toexternal value of the datefield so that it can be properly looked up in the index. Elran has a fix for this, which works fine but we\'ll need to extend this to the PivotFacetValue\'s ConvertToNamedList for the output reponse to look right and we end up having conditionals for dates in a bunch of places.\u003c\\/p\u003e\\n\\n\u003cp\u003eMost other datatypes are fine, but date is the worst of this set.\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14029531_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029531_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 18:09\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T18:09:38+0000\'\u003e12\\/Jun\\/14 18:09\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     Can you elaborate on what kind of weirdness\\/hacky functionality you are talking about?  \\n\\n In the PivotFacetProcessor (shards) we .toObject each value. This is weird in the non-distributed mode because nothing clears up those into strings for the response -XML or JSON. This is a problem with dates, because \\\"2012-11-01T12:30:00Z\\\" becomes \\\"Nov 1 4:30 EST 2012\\\". I don\'t know what methods get run after process in the non-distrib mode that we could hook into to change these values back into what they should be. \\n\\n In distributed this can be trouble because when trying to assign a refinement path we must get the .toexternal value of the datefield so that it can be properly looked up in the index. Elran has a fix for this, which works fine but we\'ll need to extend this to the PivotFacetValue\'s ConvertToNamedList for the output reponse to look right and we end up having conditionals for dates in a bunch of places. \\n\\n Most other datatypes are fine, but date is the worst of this set.              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14029605\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14029605&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14029605\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14029605_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029605_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T18:53:15+0000\'\u003e12\\/Jun\\/14 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eHoss, I can\'t find any faults with your test additions\u003c\\/p\u003e\\n\\n\u003cp\u003eI\'d add \u003c\\/p\u003e\\n\u003cdiv class=\\\"code panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"codeContent panelContent\\\"\u003e\\n\u003cpre class=\\\"code-java\\\"\u003e    \u003cspan class=\\\"code-comment\\\"\u003e\\/\\/Microsoft will come back wrong \u003cspan class=\\\"code-keyword\\\"\u003eif\u003c\\/span\u003e refinement was not done correctly\\n\u003c\\/span\u003e    PivotField microsoft = firstPlace.getPivot().get(1);\\n    assertEquals(\u003cspan class=\\\"code-quote\\\"\u003e\\\"company_t\\\"\u003c\\/span\u003e, microsoft.getField());\\n    assertEquals(\u003cspan class=\\\"code-quote\\\"\u003e\\\"microsoft\\\"\u003c\\/span\u003e,microsoft.getValue());\\n    assertEquals(56,microsoft.getCount());\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\u003cp\u003eto the \u003cbr\\/\u003e\\n\\/\\/ basic check w\\/ limit &amp; default sort (count) \u003cbr\\/\u003e\\nin the distributedpivotfacetlargetest\u003c\\/p\u003e\\n\\n\u003cp\u003eThe microsoft pivot is the key value that is wrong if refinement didn\'t work, so might as well sanity check it.\u003c\\/p\u003e\\n\\n\u003cp\u003eOtherwise you\'ve just included the CursorPagingTest which is probably from a different patch?\u003c\\/p\u003e\\n\\n\u003cp\u003eThanks for your help making this patch better\u003c\\/p\u003e \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"andrew.muldowney\\\" id=\\\"commentauthor_14029605_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=andrew.muldowney\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"andrew.muldowney\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Andrew Muldowney\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14029605_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'12\\/Jun\\/14 18:53\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-12T18:53:15+0000\'\u003e12\\/Jun\\/14 18:53\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    Hoss, I can\'t find any faults with your test additions \\n\\n I\'d add  \\n  \\n      \\/\\/Microsoft will come back wrong  if  refinement was not done correctly\\n     PivotField microsoft = firstPlace.getPivot().get(1);\\n    assertEquals( \\\"company_t\\\" , microsoft.getField());\\n    assertEquals( \\\"microsoft\\\" ,microsoft.getValue());\\n    assertEquals(56,microsoft.getCount());\\n \\n  \\n to the  \\n\\/\\/ basic check w\\/ limit &amp; default sort (count)  \\nin the distributedpivotfacetlargetest \\n\\n The microsoft pivot is the key value that is wrong if refinement didn\'t work, so might as well sanity check it. \\n\\n Otherwise you\'ve just included the CursorPagingTest which is probably from a different patch? \\n\\n Thanks for your help making this patch better              \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14031792\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14031792&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14031792\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_14031792_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14031792_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/14 06:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-15T06:16:05+0000\'\u003e15\\/Jun\\/14 06:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI think it\'s very important to keep pivot\'s response values as objects. \u003cbr\\/\u003e\\nWe should consider changing facet\'s  response values from string to object.\u003cbr\\/\u003e\\nIn objects, there is , ofcourse, more information than strings. \u003cbr\\/\u003e\\nFor example, there is no ability in Solr to sort by index desc. With objects it can be done in the client. \u003c\\/p\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"elrand\\\" id=\\\"commentauthor_14031792_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=elrand\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"elrand\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Elran Dvir\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14031792_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'15\\/Jun\\/14 06:16\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-15T06:16:05+0000\'\u003e15\\/Jun\\/14 06:16\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I think it\'s very important to keep pivot\'s response values as objects.  \\nWe should consider changing facet\'s  response values from string to object. \\nIn objects, there is , ofcourse, more information than strings.  \\nFor example, there is no ability in Solr to sort by index desc. With objects it can be done in the client.  \\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14045284\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14045284&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14045284\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14045284_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14045284_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/14 22:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-26T22:39:58+0000\'\u003e26\\/Jun\\/14 22:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cblockquote\u003e\u003cp\u003eI think it\'s very important to keep pivot\'s response values as objects. \u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003e+1\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eIn the PivotFacetProcessor (shards) we .toObject each value. This is weird in the non-distributed mode because nothing clears up those into strings for the response -XML or JSON. This is a problem with dates, because \\\"2012-11-01T12:30:00Z\\\" becomes \\\"Nov 1 4:30 EST 2012\\\". I don\'t know what methods get run after process in the non-distrib mode that we could hook into to change these values back into what they should be.\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eI don\'t think that\'s weird &#8211; i think the toObject() call you have is exactly what it should be &#8211; i\'m not really following your point about the XML or JSON responses, the response writers already know how to handle the various Object types that (Like Dates, and Integers, etc...) that might be included.\u003c\\/p\u003e\\n\\n\u003cp\u003eBased on your comment about PivotFacetValue\'s convertToNamedList, i \u003cb\u003ethink\u003c\\/b\u003e what you mean is that the main underlying problem with using the real Object representation of the values is that when you then want to build up the paths in PivotFacetValue\'s \u003cem\u003ecreateFromNamedList\u003c\\/em\u003e for the purposes of the refinement queries, there is no corrollary to \\\"toObject\\\" that can be used.\u003c\\/p\u003e\\n\\n\u003cp\u003eThis is very similar to the problem we encountered in \u003ca href=\\\"https:\\/\\/issues.apache.org\\/jira\\/browse\\/SOLR-5354\\\" title=\\\"Distributed sort is broken with CUSTOM FieldType\\\" class=\\\"issue-link\\\" data-issue-key=\\\"SOLR-5354\\\"\u003e\u003cdel\u003eSOLR-5354\u003c\\/del\u003e\u003c\\/a\u003e &#8211; the solution there was a new FieldType methd specific to marshalling and unmarshalling sort values.  we can\'t simply re-use that new method as is because the Objects used as Sort values don\'t neccessarily have a 1-to-1 corrispondence with the Objects that matter here.  \u003c\\/p\u003e\\n\\n\u003cp\u003eIdeally there should be a similar method on the FieldType for doing this, that let\'s you round trip the output of FieldType.toObject() for the purposes of building up a simple query string &#8211; but that doesn\'t exist at the moment.\u003c\\/p\u003e\\n\\n\u003cp\u003eMy vote would be to leave the code the way it is right now (assuming it can toString() anything except a \\\"Date\\\" object) and open a new issue to improve on this for custom FieldTypes at a later date.  That way people who want to go ahead and use Distributed Pivot Faceting for out of the box field types like Strings\\/Dates\\/Numbers can, and have the benefits of well structured objects in the response &#8211; w\\/o waiting on a more robust solution that can work with arbitrary custom field types. (which can come later)\u003c\\/p\u003e\\n\\n\u003cblockquote\u003e\u003cp\u003eOtherwise you\'ve just included the CursorPagingTest which is probably from a different patch?\u003c\\/p\u003e\u003c\\/blockquote\u003e\\n\\n\u003cp\u003eCursorPagingTest is included in the patch because of methods refactored up into SolrTestCaseJ4 for use in this patch.\u003c\\/p\u003e\\n\\n\\n\u003cp\u003e&#8212; \u003c\\/p\u003e\\n\\n\u003cp\u003eI\'ve been making my way further through the code review slowly &#8211; Attaching a revised patch...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eupdated to trunk\u003c\\/li\u003e\\n\\t\u003cli\u003eadded microsoft asserts to DistributedFacetPivotLargeTest (per Andrew)\u003c\\/li\u003e\\n\\t\u003cli\u003emake FacetParams.FACET_OVERREQUEST package-private since it\'s not a usable param (just a base)\u003c\\/li\u003e\\n\\t\u003cli\u003eStrUtils\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003emore javadocs\u003c\\/li\u003e\\n\\t\\t\u003cli\u003enew escapeTextWithSeparator test -&gt; TestUtils\u003c\\/li\u003e\\n\\t\\t\u003cli\u003erefactor duplicated code with existing \\\"join\\\" method into new private method\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003ePivotListEntry\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003emore javadocs\u003c\\/li\u003e\\n\\t\\t\u003cli\u003ekill some dead code (multiple enums with same index?)\u003c\\/li\u003e\\n\\t\\t\u003cli\u003erefactored to leverage standard java Enum plumbing better\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003ePivotFacetValue\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eadded a nocommit regarding custom fieldtypes to createFromNamedList that we either need a better solution to the Object-&gt;String problem, or we need to file a new issue prior to commiting and update the comment\u003c\\/li\u003e\\n\\t\\t\u003cli\u003eswitched if-else-if-else-if on PivotListEntry instances to be an enum switch\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14045284_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14045284_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'26\\/Jun\\/14 22:39\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-26T22:39:58+0000\'\u003e26\\/Jun\\/14 22:39\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                     I think it\'s very important to keep pivot\'s response values as objects.   \\n\\n +1 \\n\\n  In the PivotFacetProcessor (shards) we .toObject each value. This is weird in the non-distributed mode because nothing clears up those into strings for the response -XML or JSON. This is a problem with dates, because \\\"2012-11-01T12:30:00Z\\\" becomes \\\"Nov 1 4:30 EST 2012\\\". I don\'t know what methods get run after process in the non-distrib mode that we could hook into to change these values back into what they should be.  \\n\\n I don\'t think that\'s weird &#8211; i think the toObject() call you have is exactly what it should be &#8211; i\'m not really following your point about the XML or JSON responses, the response writers already know how to handle the various Object types that (Like Dates, and Integers, etc...) that might be included. \\n\\n Based on your comment about PivotFacetValue\'s convertToNamedList, i  think  what you mean is that the main underlying problem with using the real Object representation of the values is that when you then want to build up the paths in PivotFacetValue\'s  createFromNamedList  for the purposes of the refinement queries, there is no corrollary to \\\"toObject\\\" that can be used. \\n\\n This is very similar to the problem we encountered in   SOLR-5354   &#8211; the solution there was a new FieldType methd specific to marshalling and unmarshalling sort values.  we can\'t simply re-use that new method as is because the Objects used as Sort values don\'t neccessarily have a 1-to-1 corrispondence with the Objects that matter here.   \\n\\n Ideally there should be a similar method on the FieldType for doing this, that let\'s you round trip the output of FieldType.toObject() for the purposes of building up a simple query string &#8211; but that doesn\'t exist at the moment. \\n\\n My vote would be to leave the code the way it is right now (assuming it can toString() anything except a \\\"Date\\\" object) and open a new issue to improve on this for custom FieldTypes at a later date.  That way people who want to go ahead and use Distributed Pivot Faceting for out of the box field types like Strings\\/Dates\\/Numbers can, and have the benefits of well structured objects in the response &#8211; w\\/o waiting on a more robust solution that can work with arbitrary custom field types. (which can come later) \\n\\n  Otherwise you\'ve just included the CursorPagingTest which is probably from a different patch?  \\n\\n CursorPagingTest is included in the patch because of methods refactored up into SolrTestCaseJ4 for use in this patch. \\n\\n\\n &#8212;  \\n\\n I\'ve been making my way further through the code review slowly &#8211; Attaching a revised patch... \\n\\n \\n\\t updated to trunk \\n\\t added microsoft asserts to DistributedFacetPivotLargeTest (per Andrew) \\n\\t make FacetParams.FACET_OVERREQUEST package-private since it\'s not a usable param (just a base) \\n\\t StrUtils\\n\\t \\n\\t\\t more javadocs \\n\\t\\t new escapeTextWithSeparator test -&gt; TestUtils \\n\\t\\t refactor duplicated code with existing \\\"join\\\" method into new private method \\n\\t \\n\\t \\n\\t PivotListEntry\\n\\t \\n\\t\\t more javadocs \\n\\t\\t kill some dead code (multiple enums with same index?) \\n\\t\\t refactored to leverage standard java Enum plumbing better \\n\\t \\n\\t \\n\\t PivotFacetValue\\n\\t \\n\\t\\t added a nocommit regarding custom fieldtypes to createFromNamedList that we either need a better solution to the Object-&gt;String problem, or we need to file a new issue prior to commiting and update the comment \\n\\t\\t switched if-else-if-else-if on PivotListEntry instances to be an enum switch \\n\\t \\n\\t \\n \\n\\n\\n             \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n\u003c\\/div\u003e\\n                             \\n\\n\\n\u003cdiv id=\\\"comment-14046533\\\" class=\\\"issue-data-block activity-comment twixi-block  expanded\\\"\u003e\\n    \u003cdiv class=\\\"twixi-wrap verbose actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Collapse comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-expanded\\\"\u003e\u003cspan\u003eHide\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-links\\\"\u003e\\n                \u003ca href=\\\"\\/jira\\/browse\\/SOLR-2894?focusedCommentId=14046533&page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-14046533\\\"\\n                   title=\\\"Right click and copy link for a permanent link to this comment.\\\" class=\\\"activitymodule-link issue-comment-action\\\"\u003e\\n                    \u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-link\\\"\u003ePermalink\u003c\\/span\u003e\u003c\\/a\u003e\\n                                            \u003c\\/div\u003e\\n            \u003cdiv class=\\\"action-details\\\"\u003e        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14046533_verbose\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14046533_verbose subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/14 23:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-27T23:43:01+0000\'\u003e27\\/Jun\\/14 23:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e  \u003c\\/div\u003e\\n        \u003c\\/div\u003e\\n        \u003cdiv class=\\\"action-body flooded\\\"\u003e\u003cp\u003eI started reviewing again this afternoon and made a few more tweaks but then quickly encountered a troubling situation:\u003c\\/p\u003e\\n\\n\u003cp\u003eThere seems to be some set of circumstances that can cause pivot refinement to go into an (infinite?) ridiculously long loop.\u003c\\/p\u003e\\n\\n\u003cp\u003eHere\'s an example log snippet from a test run that i eventually had to explicitly kill after several minutes (normally it finishes in ~40 seconds on my laptop)..\u003c\\/p\u003e\\n\\n\u003cdiv class=\\\"preformatted panel\\\" style=\\\"border-width: 1px;\\\"\u003e\u003cdiv class=\\\"preformattedContent panelContent\\\"\u003e\\n\u003cpre\u003e...\\n   [junit4]   2&gt; 365476 T48 C473 P35623 oasc.SolrCore.execute [collection1] webapp= path=\\/select params={facet.limit=14&amp;facet.pivot={!fpt%3D3557}pivot_y_s,pivot_l1&amp;isShard=true&amp;distrib=false&amp;facet=true&amp;shard.url=https:\\/\\/127.0.0.1:35623\\/collection1\\/|https:\\/\\/127.0.0.1:35174\\/collection1\\/&amp;version=2&amp;q=*:*&amp;NOW=1403905534861&amp;facet.pivot.mincount=-1&amp;rows=0&amp;fpt3557=-8197981690463795098&amp;fpt3557=-7333481702750443698&amp;fpt3557=-5750361150833026124&amp;fpt3557=-1254664925684537075&amp;fpt3557=-790491513359287891&amp;fpt3557=-259812169693239119&amp;fpt3557=5005&amp;fpt3557=5023&amp;fpt3557=434325197357513755&amp;fpt3557=1208379606676285112&amp;fpt3557=2157244738088160377&amp;fpt3557=4049867752092041147&amp;wt=javabin} hits=384 status=0 QTime=3 \\n   [junit4]   2&gt; 365484 T53 C473 P35623 oasc.SolrCore.execute [collection1] webapp= path=\\/select params={facet.limit=14&amp;facet.pivot={!fpt%3D3558}pivot_y_s,pivot_l1&amp;isShard=true&amp;distrib=false&amp;facet=true&amp;shard.url=https:\\/\\/127.0.0.1:35623\\/collection1\\/|https:\\/\\/127.0.0.1:35174\\/collection1\\/&amp;version=2&amp;q=*:*&amp;NOW=1403905534861&amp;facet.pivot.mincount=-1&amp;rows=0&amp;fpt3558=-8197981690463795098&amp;fpt3558=-7333481702750443698&amp;fpt3558=-5750361150833026124&amp;fpt3558=-1254664925684537075&amp;fpt3558=-790491513359287891&amp;fpt3558=-259812169693239119&amp;fpt3558=5005&amp;fpt3558=5023&amp;fpt3558=434325197357513755&amp;fpt3558=1208379606676285112&amp;fpt3558=2157244738088160377&amp;fpt3558=4049867752092041147&amp;wt=javabin} hits=384 status=0 QTime=3 \\n   [junit4]   2&gt; 365493 T50 C473 P35623 oasc.SolrCore.execute [collection1] webapp= path=\\/select params={facet.limit=14&amp;facet.pivot={!fpt%3D3559}pivot_y_s,pivot_l1&amp;isShard=true&amp;distrib=false&amp;facet=true&amp;shard.url=https:\\/\\/127.0.0.1:35623\\/collection1\\/|https:\\/\\/127.0.0.1:35174\\/collection1\\/&amp;version=2&amp;q=*:*&amp;NOW=1403905534861&amp;facet.pivot.mincount=-1&amp;rows=0&amp;fpt3559=-8197981690463795098&amp;fpt3559=-7333481702750443698&amp;fpt3559=-5750361150833026124&amp;fpt3559=-1254664925684537075&amp;fpt3559=-790491513359287891&amp;fpt3559=-259812169693239119&amp;fpt3559=5005&amp;fpt3559=5023&amp;fpt3559=434325197357513755&amp;fpt3559=1208379606676285112&amp;fpt3559=2157244738088160377&amp;fpt3559=4049867752092041147&amp;wt=javabin} hits=384 status=0 QTime=5 \\n...\\n\u003c\\/pre\u003e\\n\u003c\\/div\u003e\u003c\\/div\u003e\\n\\n\u003cp\u003eA few things to note about those above log lines:\u003c\\/p\u003e\\n\u003cul\u003e\\n\\t\u003cli\u003ewith the seed used in this run there was only 740 total docs in the index\u003c\\/li\u003e\\n\\t\u003cli\u003eall three of those requests were made to the same shard\\/core (C473) on the same port (P35623)\u003c\\/li\u003e\\n\\t\u003cli\u003ethe \\\"pivot_l1\\\" field being refined in these requests is a single valued long field - which means even if every random value generated for it were unique, in an index with 740 docs there can only be 740 possible long values here.\u003c\\/li\u003e\\n\\t\u003cli\u003ethese requests are already upto fpt=3559 &#8211; \u003cem\u003eway\u003c\\/em\u003e more refinements then should be neccessary for this field\u003c\\/li\u003e\\n\\t\u003cli\u003ethe shard is being asked to refine the same pivot values over and over again (but with increasing \\\"fpt#####\\\" keys)\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n\\n\\n\u003cp\u003eUnfortunately while trying to get to the bottom of this, i realized the way the test was picking the random pivots it used wasn\'t reproducible with a consistent test seed.  I\'ve fixed that, but now i need to hammer on this test some more to try and reproduce again with a reliable seed. \u003c\\/p\u003e\\n\\n\u003chr \\/\u003e\\n\\n\u003cp\u003eSmall changes to the patch ...\u003c\\/p\u003e\\n\\n\u003cul\u003e\\n\\t\u003cli\u003eTestCloudPivotFacet\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003eadded explicit sort to String[] fieldNames so buildRandomPivot would reproduce with consistent seed\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\\t\u003cli\u003eSimpleFacets tweaks i made before encountering the test bug:\\n\\t\u003cul\u003e\\n\\t\\t\u003cli\u003emore javadocs on some subtly diff methods\u003c\\/li\u003e\\n\\t\\t\u003cli\u003echange the new getTermCounts(String,Integer,DocSet) to private since it\'s only used as a helper for the other public methods\u003c\\/li\u003e\\n\\t\u003c\\/ul\u003e\\n\\t\u003c\\/li\u003e\\n\u003c\\/ul\u003e\\n \u003c\\/div\u003e\\n    \u003c\\/div\u003e\\n    \u003cdiv class=\\\"twixi-wrap concise actionContainer\\\"\u003e\\n        \u003cdiv class=\\\"action-head\\\"\u003e\\n            \u003ca href=\\\"#\\\" title=\\\"Expand comment\\\" class=\\\"twixi\\\"\u003e\u003cspan class=\\\"icon-default aui-icon aui-icon-small aui-iconfont-collapsed\\\"\u003e\u003cspan\u003eShow\u003c\\/span\u003e\u003c\\/span\u003e\u003c\\/a\u003e\\n            \u003cdiv class=\\\"action-details flooded\\\"\u003e\\n                        \\n    \\n    \\n    \\n                \\n\\n    \u003ca class=\\\"user-hover user-avatar\\\" rel=\\\"hossman\\\" id=\\\"commentauthor_14046533_concise\\\" href=\\\"\\/jira\\/secure\\/ViewProfile.jspa?name=hossman\\\"\u003e\u003cspan class=\\\"aui-avatar aui-avatar-xsmall\\\"\u003e\u003cspan class=\\\"aui-avatar-inner\\\"\u003e\u003cimg src=\\\"https:\\/\\/issues.apache.org\\/jira\\/secure\\/useravatar?size=xsmall&amp;avatarId=10452\\\" alt=\\\"hossman\\\" \\/\u003e\u003c\\/span\u003e\u003c\\/span\u003e Hoss Man\u003c\\/a\u003e\\n added a comment  - \u003cspan class=\'commentdate_14046533_concise subText\'\u003e\u003cspan class=\'date user-tz\' title=\'27\\/Jun\\/14 23:43\'\u003e\u003ctime class=\'livestamp\' datetime=\'2014-06-27T23:43:01+0000\'\u003e27\\/Jun\\/14 23:43\u003c\\/time\u003e\u003c\\/span\u003e\u003c\\/span\u003e                    I started reviewing again this afternoon and made a few more tweaks but then quickly encountered a troubling situation: \\n\\n There seems to be some set of circumstances that can cause pivot refinement to go into an (infinite?) ridiculously long loop. \\n\\n Here\'s an example log snippet from a test run that i eventually had to explicitly kill after several minutes (normally it finishes in ~40 seconds on my laptop).. \\n\\n  \\n ...\\n   [junit4]   2&gt; 365476 T48 C473 P35623 oasc.SolrCore.execute [collection1] webapp= path=\\/select params={facet.limit=14&amp;facet.pivot={!fpt%3D3557}pivot_y_s,pivot_l1&amp;isShard=true&amp;distrib=false&amp;facet=true&amp;shard.url=https:\\/\\/127.0.0.1:35623\\/collection1\\/|https:\\/\\/127.0.0.1:35174\\/collection1\\/&amp;version=2&amp;q=*:*&amp;NOW=1403905534861&amp;facet.pivot.mincount=-1&amp;rows=0&amp;fpt3557=-8197981690463795098&amp;fpt3557=-7333481702750443698&amp;fpt3557=-5750361150833026124&amp;fpt3557=-1254664925684537075&amp;fpt3557=-790491513359287891&amp;fpt3557=-259812169693239119&amp;fpt3557=5005&amp;fpt3557=5023&amp;fpt3557=434325197357513755&amp;fpt3557=1208379606676285112&amp;fpt3557=2157244738088160377&amp;fpt3557=4049867752092041147&amp;wt=javabin} hits=384 status=0 QTime=3 \\n   [junit4]   2&gt; 365484 T53 C473 P35623 oasc.SolrCore.execute [collection1] webapp= path=\\/select params={facet.limit=14&amp;facet.pivot={!fpt%3D3558}pivot_y_s,pivot_l1&amp;isShard=true&amp;distrib=false&amp;facet=true&amp;shard.url=https:\\/\\/127.0.0.1:35623\\/collection1\\/|https:\\/\\/127.0.0.1:35174\\/collection1\\/&amp;version=2&amp;q=*:*&amp;NOW=1403905534861&amp;facet.pivot.mincount=-1&amp;rows=0&amp;fpt3558=-8197981690463795098&amp;fpt3558=-7333481702750443698&amp;fpt3558=-5750361150833026124&amp;fpt3558=-1254664925684537075&amp;fpt3558=-790491513359287891&amp;fpt3558=-259812169693239119&amp;fpt3558=5005&amp;fpt3558=5023&amp;fpt3558=434325197357513755&amp;fpt3558=1208379606676285112&amp;fpt3558=2157244738088160377&amp;fpt3558=4049867752092041147&amp;wt=javabin} hits=384 status=0 QTime=3 \\n   [junit4]   2&gt; 365493 T50 C473 P35623 oasc.SolrCore.execute [collection1] webapp= path=\\/select params={facet.limit=14&amp;facet.pivot={!fpt%3D3559}pivot_y_s,pivot_l1&amp;isShard=true&amp;distrib=false&amp;facet=true&amp;shard.url=https:\\/\\/127.0.0.1:35623\\/collection1\\/|https:\\/\\/127.0.0.1:35174\\/collection1\\/&amp;version=2&amp;q=*:*&amp;NOW=1403905534861&amp;facet.pivot.mincount=-1&amp;rows=0&amp;fpt3559=-8197981690463795098&amp;fpt3559=-7333481702750443698&amp;fpt3559=-5750361150833026124&amp;fpt3559=-12546649256845</script>
 </body>
</html>